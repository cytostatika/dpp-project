<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Futhark.Transform.FirstOrderTransform</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">futhark-0.22.0: An optimising compiler for a functional, array-oriented language.</span><ul class="links" id="page-menu"><li><a href="src/Futhark.Transform.FirstOrderTransform.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Futhark.Transform.FirstOrderTransform</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>The code generator cannot handle the array combinators (<code>map</code> and
 friends), so this module was written to transform them into the
 equivalent do-loops.  The transformation is currently rather naive,
 and - it's certainly worth considering when we can express such
 transformations in-place.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:transformFunDef">transformFunDef</a> :: (<a href="Futhark-MonadFreshNames.html#t:MonadFreshNames" title="Futhark.MonadFreshNames">MonadFreshNames</a> m, <a href="Futhark-Transform-FirstOrderTransform.html#t:FirstOrderRep" title="Futhark.Transform.FirstOrderTransform">FirstOrderRep</a> torep) =&gt; <a href="Futhark-IR-Prop-Scope.html#t:Scope" title="Futhark.IR.Prop.Scope">Scope</a> torep -&gt; <a href="Futhark-IR-Syntax.html#t:FunDef" title="Futhark.IR.Syntax">FunDef</a> <a href="Futhark-IR-SOACS.html#t:SOACS" title="Futhark.IR.SOACS">SOACS</a> -&gt; m (<a href="Futhark-IR-Syntax.html#t:FunDef" title="Futhark.IR.Syntax">FunDef</a> torep)</li><li class="src short"><a href="#v:transformConsts">transformConsts</a> :: (<a href="Futhark-MonadFreshNames.html#t:MonadFreshNames" title="Futhark.MonadFreshNames">MonadFreshNames</a> m, <a href="Futhark-Transform-FirstOrderTransform.html#t:FirstOrderRep" title="Futhark.Transform.FirstOrderTransform">FirstOrderRep</a> torep) =&gt; <a href="Futhark-IR-Syntax.html#t:Stms" title="Futhark.IR.Syntax">Stms</a> <a href="Futhark-IR-SOACS.html#t:SOACS" title="Futhark.IR.SOACS">SOACS</a> -&gt; m (<a href="Futhark-IR-Syntax.html#t:Stms" title="Futhark.IR.Syntax">Stms</a> torep)</li><li class="src short"><span class="keyword">type</span> <a href="#t:FirstOrderRep">FirstOrderRep</a> rep = (<a href="Futhark-Builder-Class.html#t:Buildable" title="Futhark.Builder.Class">Buildable</a> rep, <a href="Futhark-Builder.html#t:BuilderOps" title="Futhark.Builder">BuilderOps</a> rep, <a href="Futhark-IR-Rep.html#t:LetDec" title="Futhark.IR.Rep">LetDec</a> <a href="Futhark-IR-SOACS.html#t:SOACS" title="Futhark.IR.SOACS">SOACS</a> ~ <a href="Futhark-IR-Rep.html#t:LetDec" title="Futhark.IR.Rep">LetDec</a> rep, <a href="Futhark-IR-Rep.html#t:LParamInfo" title="Futhark.IR.Rep">LParamInfo</a> <a href="Futhark-IR-SOACS.html#t:SOACS" title="Futhark.IR.SOACS">SOACS</a> ~ <a href="Futhark-IR-Rep.html#t:LParamInfo" title="Futhark.IR.Rep">LParamInfo</a> rep, <a href="Futhark-IR-Prop-Aliases.html#t:CanBeAliased" title="Futhark.IR.Prop.Aliases">CanBeAliased</a> (<a href="Futhark-IR-Rep.html#t:Op" title="Futhark.IR.Rep">Op</a> rep))</li><li class="src short"><span class="keyword">type</span> <a href="#t:Transformer">Transformer</a> m = (<a href="Futhark-Builder-Class.html#t:MonadBuilder" title="Futhark.Builder.Class">MonadBuilder</a> m, <a href="Futhark-IR-Prop-Scope.html#t:LocalScope" title="Futhark.IR.Prop.Scope">LocalScope</a> (<a href="Futhark-Builder-Class.html#t:Rep" title="Futhark.Builder.Class">Rep</a> m) m, <a href="Futhark-Builder-Class.html#t:Buildable" title="Futhark.Builder.Class">Buildable</a> (<a href="Futhark-Builder-Class.html#t:Rep" title="Futhark.Builder.Class">Rep</a> m), <a href="Futhark-Builder.html#t:BuilderOps" title="Futhark.Builder">BuilderOps</a> (<a href="Futhark-Builder-Class.html#t:Rep" title="Futhark.Builder.Class">Rep</a> m), <a href="Futhark-IR-Rep.html#t:LParamInfo" title="Futhark.IR.Rep">LParamInfo</a> <a href="Futhark-IR-SOACS.html#t:SOACS" title="Futhark.IR.SOACS">SOACS</a> ~ <a href="Futhark-IR-Rep.html#t:LParamInfo" title="Futhark.IR.Rep">LParamInfo</a> (<a href="Futhark-Builder-Class.html#t:Rep" title="Futhark.Builder.Class">Rep</a> m), <a href="Futhark-IR-Prop-Aliases.html#t:CanBeAliased" title="Futhark.IR.Prop.Aliases">CanBeAliased</a> (<a href="Futhark-IR-Rep.html#t:Op" title="Futhark.IR.Rep">Op</a> (<a href="Futhark-Builder-Class.html#t:Rep" title="Futhark.Builder.Class">Rep</a> m)))</li><li class="src short"><a href="#v:transformStmRecursively">transformStmRecursively</a> :: (<a href="Futhark-Transform-FirstOrderTransform.html#t:Transformer" title="Futhark.Transform.FirstOrderTransform">Transformer</a> m, <a href="Futhark-IR-Rep.html#t:LetDec" title="Futhark.IR.Rep">LetDec</a> (<a href="Futhark-Builder-Class.html#t:Rep" title="Futhark.Builder.Class">Rep</a> m) ~ <a href="Futhark-IR-Rep.html#t:LetDec" title="Futhark.IR.Rep">LetDec</a> <a href="Futhark-IR-SOACS.html#t:SOACS" title="Futhark.IR.SOACS">SOACS</a>) =&gt; <a href="Futhark-IR-SOACS.html#t:Stm" title="Futhark.IR.SOACS">Stm</a> -&gt; m ()</li><li class="src short"><a href="#v:transformLambda">transformLambda</a> :: (<a href="Futhark-MonadFreshNames.html#t:MonadFreshNames" title="Futhark.MonadFreshNames">MonadFreshNames</a> m, <a href="Futhark-Builder-Class.html#t:Buildable" title="Futhark.Builder.Class">Buildable</a> rep, <a href="Futhark-Builder.html#t:BuilderOps" title="Futhark.Builder">BuilderOps</a> rep, <a href="Futhark-IR-Prop-Scope.html#t:LocalScope" title="Futhark.IR.Prop.Scope">LocalScope</a> somerep m, <a href="Futhark-IR-Prop-Scope.html#t:SameScope" title="Futhark.IR.Prop.Scope">SameScope</a> somerep rep, <a href="Futhark-IR-Rep.html#t:LetDec" title="Futhark.IR.Rep">LetDec</a> rep ~ <a href="Futhark-IR-Rep.html#t:LetDec" title="Futhark.IR.Rep">LetDec</a> <a href="Futhark-IR-SOACS.html#t:SOACS" title="Futhark.IR.SOACS">SOACS</a>, <a href="Futhark-IR-Prop-Aliases.html#t:CanBeAliased" title="Futhark.IR.Prop.Aliases">CanBeAliased</a> (<a href="Futhark-IR-Rep.html#t:Op" title="Futhark.IR.Rep">Op</a> rep)) =&gt; <a href="Futhark-IR-SOACS.html#t:Lambda" title="Futhark.IR.SOACS">Lambda</a> -&gt; m (<a href="Futhark-IR-Syntax.html#t:Lambda" title="Futhark.IR.Syntax">Lambda</a> rep)</li><li class="src short"><a href="#v:transformSOAC">transformSOAC</a> :: <a href="Futhark-Transform-FirstOrderTransform.html#t:Transformer" title="Futhark.Transform.FirstOrderTransform">Transformer</a> m =&gt; <a href="Futhark-IR-Syntax.html#t:Pat" title="Futhark.IR.Syntax">Pat</a> (<a href="Futhark-Builder-Class.html#t:Rep" title="Futhark.Builder.Class">Rep</a> m) -&gt; <a href="Futhark-IR-SOACS-SOAC.html#t:SOAC" title="Futhark.IR.SOACS.SOAC">SOAC</a> (<a href="Futhark-Builder-Class.html#t:Rep" title="Futhark.Builder.Class">Rep</a> m) -&gt; m ()</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:transformFunDef" class="def">transformFunDef</a> :: (<a href="Futhark-MonadFreshNames.html#t:MonadFreshNames" title="Futhark.MonadFreshNames">MonadFreshNames</a> m, <a href="Futhark-Transform-FirstOrderTransform.html#t:FirstOrderRep" title="Futhark.Transform.FirstOrderTransform">FirstOrderRep</a> torep) =&gt; <a href="Futhark-IR-Prop-Scope.html#t:Scope" title="Futhark.IR.Prop.Scope">Scope</a> torep -&gt; <a href="Futhark-IR-Syntax.html#t:FunDef" title="Futhark.IR.Syntax">FunDef</a> <a href="Futhark-IR-SOACS.html#t:SOACS" title="Futhark.IR.SOACS">SOACS</a> -&gt; m (<a href="Futhark-IR-Syntax.html#t:FunDef" title="Futhark.IR.Syntax">FunDef</a> torep) <a href="src/Futhark.Transform.FirstOrderTransform.html#transformFunDef" class="link">Source</a> <a href="#v:transformFunDef" class="selflink">#</a></p><div class="doc"><p>First-order-transform a single function, with the given scope
 provided by top-level constants.</p></div></div><div class="top"><p class="src"><a id="v:transformConsts" class="def">transformConsts</a> :: (<a href="Futhark-MonadFreshNames.html#t:MonadFreshNames" title="Futhark.MonadFreshNames">MonadFreshNames</a> m, <a href="Futhark-Transform-FirstOrderTransform.html#t:FirstOrderRep" title="Futhark.Transform.FirstOrderTransform">FirstOrderRep</a> torep) =&gt; <a href="Futhark-IR-Syntax.html#t:Stms" title="Futhark.IR.Syntax">Stms</a> <a href="Futhark-IR-SOACS.html#t:SOACS" title="Futhark.IR.SOACS">SOACS</a> -&gt; m (<a href="Futhark-IR-Syntax.html#t:Stms" title="Futhark.IR.Syntax">Stms</a> torep) <a href="src/Futhark.Transform.FirstOrderTransform.html#transformConsts" class="link">Source</a> <a href="#v:transformConsts" class="selflink">#</a></p><div class="doc"><p>First-order-transform these top-level constants.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:FirstOrderRep" class="def">FirstOrderRep</a> rep = (<a href="Futhark-Builder-Class.html#t:Buildable" title="Futhark.Builder.Class">Buildable</a> rep, <a href="Futhark-Builder.html#t:BuilderOps" title="Futhark.Builder">BuilderOps</a> rep, <a href="Futhark-IR-Rep.html#t:LetDec" title="Futhark.IR.Rep">LetDec</a> <a href="Futhark-IR-SOACS.html#t:SOACS" title="Futhark.IR.SOACS">SOACS</a> ~ <a href="Futhark-IR-Rep.html#t:LetDec" title="Futhark.IR.Rep">LetDec</a> rep, <a href="Futhark-IR-Rep.html#t:LParamInfo" title="Futhark.IR.Rep">LParamInfo</a> <a href="Futhark-IR-SOACS.html#t:SOACS" title="Futhark.IR.SOACS">SOACS</a> ~ <a href="Futhark-IR-Rep.html#t:LParamInfo" title="Futhark.IR.Rep">LParamInfo</a> rep, <a href="Futhark-IR-Prop-Aliases.html#t:CanBeAliased" title="Futhark.IR.Prop.Aliases">CanBeAliased</a> (<a href="Futhark-IR-Rep.html#t:Op" title="Futhark.IR.Rep">Op</a> rep)) <a href="src/Futhark.Transform.FirstOrderTransform.html#FirstOrderRep" class="link">Source</a> <a href="#t:FirstOrderRep" class="selflink">#</a></p><div class="doc"><p>The constraints that must hold for a rep in order to be the
 target of first-order transformation.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:Transformer" class="def">Transformer</a> m = (<a href="Futhark-Builder-Class.html#t:MonadBuilder" title="Futhark.Builder.Class">MonadBuilder</a> m, <a href="Futhark-IR-Prop-Scope.html#t:LocalScope" title="Futhark.IR.Prop.Scope">LocalScope</a> (<a href="Futhark-Builder-Class.html#t:Rep" title="Futhark.Builder.Class">Rep</a> m) m, <a href="Futhark-Builder-Class.html#t:Buildable" title="Futhark.Builder.Class">Buildable</a> (<a href="Futhark-Builder-Class.html#t:Rep" title="Futhark.Builder.Class">Rep</a> m), <a href="Futhark-Builder.html#t:BuilderOps" title="Futhark.Builder">BuilderOps</a> (<a href="Futhark-Builder-Class.html#t:Rep" title="Futhark.Builder.Class">Rep</a> m), <a href="Futhark-IR-Rep.html#t:LParamInfo" title="Futhark.IR.Rep">LParamInfo</a> <a href="Futhark-IR-SOACS.html#t:SOACS" title="Futhark.IR.SOACS">SOACS</a> ~ <a href="Futhark-IR-Rep.html#t:LParamInfo" title="Futhark.IR.Rep">LParamInfo</a> (<a href="Futhark-Builder-Class.html#t:Rep" title="Futhark.Builder.Class">Rep</a> m), <a href="Futhark-IR-Prop-Aliases.html#t:CanBeAliased" title="Futhark.IR.Prop.Aliases">CanBeAliased</a> (<a href="Futhark-IR-Rep.html#t:Op" title="Futhark.IR.Rep">Op</a> (<a href="Futhark-Builder-Class.html#t:Rep" title="Futhark.Builder.Class">Rep</a> m))) <a href="src/Futhark.Transform.FirstOrderTransform.html#Transformer" class="link">Source</a> <a href="#t:Transformer" class="selflink">#</a></p><div class="doc"><p>The constraints that a monad must uphold in order to be used for
 first-order transformation.</p></div></div><div class="top"><p class="src"><a id="v:transformStmRecursively" class="def">transformStmRecursively</a> :: (<a href="Futhark-Transform-FirstOrderTransform.html#t:Transformer" title="Futhark.Transform.FirstOrderTransform">Transformer</a> m, <a href="Futhark-IR-Rep.html#t:LetDec" title="Futhark.IR.Rep">LetDec</a> (<a href="Futhark-Builder-Class.html#t:Rep" title="Futhark.Builder.Class">Rep</a> m) ~ <a href="Futhark-IR-Rep.html#t:LetDec" title="Futhark.IR.Rep">LetDec</a> <a href="Futhark-IR-SOACS.html#t:SOACS" title="Futhark.IR.SOACS">SOACS</a>) =&gt; <a href="Futhark-IR-SOACS.html#t:Stm" title="Futhark.IR.SOACS">Stm</a> -&gt; m () <a href="src/Futhark.Transform.FirstOrderTransform.html#transformStmRecursively" class="link">Source</a> <a href="#v:transformStmRecursively" class="selflink">#</a></p><div class="doc"><p>First transform any nested <code><a href="Futhark-IR-SOACS.html#t:Body" title="Futhark.IR.SOACS">Body</a></code> or <code><a href="Futhark-IR-SOACS.html#t:Lambda" title="Futhark.IR.SOACS">Lambda</a></code> elements, then
 apply <code><a href="Futhark-Transform-FirstOrderTransform.html#v:transformSOAC" title="Futhark.Transform.FirstOrderTransform">transformSOAC</a></code> if the expression is a SOAC.</p></div></div><div class="top"><p class="src"><a id="v:transformLambda" class="def">transformLambda</a> :: (<a href="Futhark-MonadFreshNames.html#t:MonadFreshNames" title="Futhark.MonadFreshNames">MonadFreshNames</a> m, <a href="Futhark-Builder-Class.html#t:Buildable" title="Futhark.Builder.Class">Buildable</a> rep, <a href="Futhark-Builder.html#t:BuilderOps" title="Futhark.Builder">BuilderOps</a> rep, <a href="Futhark-IR-Prop-Scope.html#t:LocalScope" title="Futhark.IR.Prop.Scope">LocalScope</a> somerep m, <a href="Futhark-IR-Prop-Scope.html#t:SameScope" title="Futhark.IR.Prop.Scope">SameScope</a> somerep rep, <a href="Futhark-IR-Rep.html#t:LetDec" title="Futhark.IR.Rep">LetDec</a> rep ~ <a href="Futhark-IR-Rep.html#t:LetDec" title="Futhark.IR.Rep">LetDec</a> <a href="Futhark-IR-SOACS.html#t:SOACS" title="Futhark.IR.SOACS">SOACS</a>, <a href="Futhark-IR-Prop-Aliases.html#t:CanBeAliased" title="Futhark.IR.Prop.Aliases">CanBeAliased</a> (<a href="Futhark-IR-Rep.html#t:Op" title="Futhark.IR.Rep">Op</a> rep)) =&gt; <a href="Futhark-IR-SOACS.html#t:Lambda" title="Futhark.IR.SOACS">Lambda</a> -&gt; m (<a href="Futhark-IR-Syntax.html#t:Lambda" title="Futhark.IR.Syntax">Lambda</a> rep) <a href="src/Futhark.Transform.FirstOrderTransform.html#transformLambda" class="link">Source</a> <a href="#v:transformLambda" class="selflink">#</a></p><div class="doc"><p>Recursively first-order-transform a lambda.</p></div></div><div class="top"><p class="src"><a id="v:transformSOAC" class="def">transformSOAC</a> :: <a href="Futhark-Transform-FirstOrderTransform.html#t:Transformer" title="Futhark.Transform.FirstOrderTransform">Transformer</a> m =&gt; <a href="Futhark-IR-Syntax.html#t:Pat" title="Futhark.IR.Syntax">Pat</a> (<a href="Futhark-Builder-Class.html#t:Rep" title="Futhark.Builder.Class">Rep</a> m) -&gt; <a href="Futhark-IR-SOACS-SOAC.html#t:SOAC" title="Futhark.IR.SOACS.SOAC">SOAC</a> (<a href="Futhark-Builder-Class.html#t:Rep" title="Futhark.Builder.Class">Rep</a> m) -&gt; m () <a href="src/Futhark.Transform.FirstOrderTransform.html#transformSOAC" class="link">Source</a> <a href="#v:transformSOAC" class="selflink">#</a></p><div class="doc"><p>Transform a single <code><a href="Futhark-IR-SOACS-SOAC.html#t:SOAC" title="Futhark.IR.SOACS.SOAC">SOAC</a></code> into a do-loop.  The body of the lambda
 is untouched, and may or may not contain further <code><a href="Futhark-IR-SOACS-SOAC.html#t:SOAC" title="Futhark.IR.SOACS.SOAC">SOAC</a></code>s depending
 on the given rep.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.24.0</p></div></body></html>