<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Futhark.IR.Prop.Reshape</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">futhark-0.22.0: An optimising compiler for a functional, array-oriented language.</span><ul class="links" id="page-menu"><li><a href="src/Futhark.IR.Prop.Reshape.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Futhark.IR.Prop.Reshape</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Basic tools</a></li><li><a href="#g:2">Construction</a></li><li><a href="#g:3">Execution</a></li><li><a href="#g:4">Inspection</a></li><li><a href="#g:5">Simplification</a></li><li><a href="#g:6">Shape calculations</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Facilities for creating, inspecting, and simplifying reshape and
 coercion operations.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:newDim">newDim</a> :: <a href="Futhark-IR-Syntax.html#t:DimChange" title="Futhark.IR.Syntax">DimChange</a> d -&gt; d</li><li class="src short"><a href="#v:newDims">newDims</a> :: <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> d -&gt; [d]</li><li class="src short"><a href="#v:newShape">newShape</a> :: <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> <a href="Futhark-IR-Syntax-Core.html#t:SubExp" title="Futhark.IR.Syntax.Core">SubExp</a> -&gt; <a href="Futhark-IR-Syntax-Core.html#t:Shape" title="Futhark.IR.Syntax.Core">Shape</a></li><li class="src short"><a href="#v:shapeCoerce">shapeCoerce</a> :: [<a href="Futhark-IR-Syntax-Core.html#t:SubExp" title="Futhark.IR.Syntax.Core">SubExp</a>] -&gt; <a href="Language-Futhark-Core.html#t:VName" title="Language.Futhark.Core">VName</a> -&gt; <a href="Futhark-IR-Syntax.html#t:Exp" title="Futhark.IR.Syntax">Exp</a> rep</li><li class="src short"><a href="#v:reshapeOuter">reshapeOuter</a> :: <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> <a href="Futhark-IR-Syntax-Core.html#t:SubExp" title="Futhark.IR.Syntax.Core">SubExp</a> -&gt; Int -&gt; <a href="Futhark-IR-Syntax-Core.html#t:Shape" title="Futhark.IR.Syntax.Core">Shape</a> -&gt; <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> <a href="Futhark-IR-Syntax-Core.html#t:SubExp" title="Futhark.IR.Syntax.Core">SubExp</a></li><li class="src short"><a href="#v:reshapeInner">reshapeInner</a> :: <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> <a href="Futhark-IR-Syntax-Core.html#t:SubExp" title="Futhark.IR.Syntax.Core">SubExp</a> -&gt; Int -&gt; <a href="Futhark-IR-Syntax-Core.html#t:Shape" title="Futhark.IR.Syntax.Core">Shape</a> -&gt; <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> <a href="Futhark-IR-Syntax-Core.html#t:SubExp" title="Futhark.IR.Syntax.Core">SubExp</a></li><li class="src short"><a href="#v:shapeCoercion">shapeCoercion</a> :: <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> d -&gt; Maybe [d]</li><li class="src short"><a href="#v:fuseReshape">fuseReshape</a> :: Eq d =&gt; <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> d -&gt; <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> d -&gt; <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> d</li><li class="src short"><a href="#v:informReshape">informReshape</a> :: Eq d =&gt; [d] -&gt; <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> d -&gt; <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> d</li><li class="src short"><a href="#v:reshapeIndex">reshapeIndex</a> :: <a href="Futhark-Util-IntegralExp.html#t:IntegralExp" title="Futhark.Util.IntegralExp">IntegralExp</a> num =&gt; [num] -&gt; [num] -&gt; [num] -&gt; [num]</li><li class="src short"><a href="#v:flattenIndex">flattenIndex</a> :: <a href="Futhark-Util-IntegralExp.html#t:IntegralExp" title="Futhark.Util.IntegralExp">IntegralExp</a> num =&gt; [num] -&gt; [num] -&gt; num</li><li class="src short"><a href="#v:unflattenIndex">unflattenIndex</a> :: <a href="Futhark-Util-IntegralExp.html#t:IntegralExp" title="Futhark.Util.IntegralExp">IntegralExp</a> num =&gt; [num] -&gt; num -&gt; [num]</li><li class="src short"><a href="#v:sliceSizes">sliceSizes</a> :: <a href="Futhark-Util-IntegralExp.html#t:IntegralExp" title="Futhark.Util.IntegralExp">IntegralExp</a> num =&gt; [num] -&gt; [num]</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Basic tools</h1></a><div class="top"><p class="src"><a id="v:newDim" class="def">newDim</a> :: <a href="Futhark-IR-Syntax.html#t:DimChange" title="Futhark.IR.Syntax">DimChange</a> d -&gt; d <a href="src/Futhark.IR.Prop.Reshape.html#newDim" class="link">Source</a> <a href="#v:newDim" class="selflink">#</a></p><div class="doc"><p>The new dimension.</p></div></div><div class="top"><p class="src"><a id="v:newDims" class="def">newDims</a> :: <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> d -&gt; [d] <a href="src/Futhark.IR.Prop.Reshape.html#newDims" class="link">Source</a> <a href="#v:newDims" class="selflink">#</a></p><div class="doc"><p>The new dimensions resulting from a reshape operation.</p></div></div><div class="top"><p class="src"><a id="v:newShape" class="def">newShape</a> :: <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> <a href="Futhark-IR-Syntax-Core.html#t:SubExp" title="Futhark.IR.Syntax.Core">SubExp</a> -&gt; <a href="Futhark-IR-Syntax-Core.html#t:Shape" title="Futhark.IR.Syntax.Core">Shape</a> <a href="src/Futhark.IR.Prop.Reshape.html#newShape" class="link">Source</a> <a href="#v:newShape" class="selflink">#</a></p><div class="doc"><p>The new shape resulting from a reshape operation.</p></div></div><a href="#g:2" id="g:2"><h1>Construction</h1></a><div class="top"><p class="src"><a id="v:shapeCoerce" class="def">shapeCoerce</a> :: [<a href="Futhark-IR-Syntax-Core.html#t:SubExp" title="Futhark.IR.Syntax.Core">SubExp</a>] -&gt; <a href="Language-Futhark-Core.html#t:VName" title="Language.Futhark.Core">VName</a> -&gt; <a href="Futhark-IR-Syntax.html#t:Exp" title="Futhark.IR.Syntax">Exp</a> rep <a href="src/Futhark.IR.Prop.Reshape.html#shapeCoerce" class="link">Source</a> <a href="#v:shapeCoerce" class="selflink">#</a></p><div class="doc"><p>Construct a <code><a href="Futhark-IR-Syntax.html#v:Reshape" title="Futhark.IR.Syntax">Reshape</a></code> where all dimension changes are
 <code><a href="Futhark-IR-Syntax.html#v:DimCoercion" title="Futhark.IR.Syntax">DimCoercion</a></code>s.</p></div></div><a href="#g:3" id="g:3"><h1>Execution</h1></a><div class="top"><p class="src"><a id="v:reshapeOuter" class="def">reshapeOuter</a> :: <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> <a href="Futhark-IR-Syntax-Core.html#t:SubExp" title="Futhark.IR.Syntax.Core">SubExp</a> -&gt; Int -&gt; <a href="Futhark-IR-Syntax-Core.html#t:Shape" title="Futhark.IR.Syntax.Core">Shape</a> -&gt; <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> <a href="Futhark-IR-Syntax-Core.html#t:SubExp" title="Futhark.IR.Syntax.Core">SubExp</a> <a href="src/Futhark.IR.Prop.Reshape.html#reshapeOuter" class="link">Source</a> <a href="#v:reshapeOuter" class="selflink">#</a></p><div class="doc"><p><code>reshapeOuter newshape n oldshape</code> returns a <code><a href="Futhark-IR-Syntax.html#v:Reshape" title="Futhark.IR.Syntax">Reshape</a></code> expression
 that replaces the outer <code>n</code> dimensions of <code>oldshape</code> with <code>newshape</code>.</p></div></div><div class="top"><p class="src"><a id="v:reshapeInner" class="def">reshapeInner</a> :: <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> <a href="Futhark-IR-Syntax-Core.html#t:SubExp" title="Futhark.IR.Syntax.Core">SubExp</a> -&gt; Int -&gt; <a href="Futhark-IR-Syntax-Core.html#t:Shape" title="Futhark.IR.Syntax.Core">Shape</a> -&gt; <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> <a href="Futhark-IR-Syntax-Core.html#t:SubExp" title="Futhark.IR.Syntax.Core">SubExp</a> <a href="src/Futhark.IR.Prop.Reshape.html#reshapeInner" class="link">Source</a> <a href="#v:reshapeInner" class="selflink">#</a></p><div class="doc"><p><code>reshapeInner newshape n oldshape</code> returns a <code><a href="Futhark-IR-Syntax.html#v:Reshape" title="Futhark.IR.Syntax">Reshape</a></code> expression
 that replaces the inner <code>m-n</code> dimensions (where <code>m</code> is the rank of
 <code>oldshape</code>) of <code>src</code> with <code>newshape</code>.</p></div></div><a href="#g:4" id="g:4"><h1>Inspection</h1></a><div class="top"><p class="src"><a id="v:shapeCoercion" class="def">shapeCoercion</a> :: <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> d -&gt; Maybe [d] <a href="src/Futhark.IR.Prop.Reshape.html#shapeCoercion" class="link">Source</a> <a href="#v:shapeCoercion" class="selflink">#</a></p><div class="doc"><p>If the shape change is nothing but shape coercions, return the new dimensions.  Otherwise, return
 <code>Nothing</code>.</p></div></div><a href="#g:5" id="g:5"><h1>Simplification</h1></a><div class="top"><p class="src"><a id="v:fuseReshape" class="def">fuseReshape</a> :: Eq d =&gt; <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> d -&gt; <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> d -&gt; <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> d <a href="src/Futhark.IR.Prop.Reshape.html#fuseReshape" class="link">Source</a> <a href="#v:fuseReshape" class="selflink">#</a></p><div class="doc"><p><code>fuseReshape s1 s2</code> creates a new <code><a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a></code> that is
 semantically the same as first applying <code>s1</code> and then <code>s2</code>.  This
 may take advantage of properties of <code><a href="Futhark-IR-Syntax.html#v:DimCoercion" title="Futhark.IR.Syntax">DimCoercion</a></code> versus <code><a href="Futhark-IR-Syntax.html#v:DimNew" title="Futhark.IR.Syntax">DimNew</a></code>
 to preserve information.</p></div></div><div class="top"><p class="src"><a id="v:informReshape" class="def">informReshape</a> :: Eq d =&gt; [d] -&gt; <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> d -&gt; <a href="Futhark-IR-Syntax.html#t:ShapeChange" title="Futhark.IR.Syntax">ShapeChange</a> d <a href="src/Futhark.IR.Prop.Reshape.html#informReshape" class="link">Source</a> <a href="#v:informReshape" class="selflink">#</a></p><div class="doc"><p>Given concrete information about the shape of the source array,
 convert some <code><a href="Futhark-IR-Syntax.html#v:DimNew" title="Futhark.IR.Syntax">DimNew</a></code>s into <code><a href="Futhark-IR-Syntax.html#v:DimCoercion" title="Futhark.IR.Syntax">DimCoercion</a></code>s.</p></div></div><a href="#g:6" id="g:6"><h1>Shape calculations</h1></a><div class="top"><p class="src"><a id="v:reshapeIndex" class="def">reshapeIndex</a> :: <a href="Futhark-Util-IntegralExp.html#t:IntegralExp" title="Futhark.Util.IntegralExp">IntegralExp</a> num =&gt; [num] -&gt; [num] -&gt; [num] -&gt; [num] <a href="src/Futhark.IR.Prop.Reshape.html#reshapeIndex" class="link">Source</a> <a href="#v:reshapeIndex" class="selflink">#</a></p><div class="doc"><p><code>reshapeIndex to_dims from_dims is</code> transforms the index list
 <code>is</code> (which is into an array of shape <code>from_dims</code>) into an index
 list <code>is'</code>, which is into an array of shape <code>to_dims</code>.  <code>is</code> must
 have the same length as <code>from_dims</code>, and <code>is'</code> will have the same
 length as <code>to_dims</code>.</p></div></div><div class="top"><p class="src"><a id="v:flattenIndex" class="def">flattenIndex</a> :: <a href="Futhark-Util-IntegralExp.html#t:IntegralExp" title="Futhark.Util.IntegralExp">IntegralExp</a> num =&gt; [num] -&gt; [num] -&gt; num <a href="src/Futhark.IR.Prop.Reshape.html#flattenIndex" class="link">Source</a> <a href="#v:flattenIndex" class="selflink">#</a></p><div class="doc"><p><code>flattenIndex dims is</code> computes the flat index of <code>is</code> into an
 array with dimensions <code>dims</code>.  The length of <code>dims</code> and <code>is</code> must
 be the same.</p></div></div><div class="top"><p class="src"><a id="v:unflattenIndex" class="def">unflattenIndex</a> :: <a href="Futhark-Util-IntegralExp.html#t:IntegralExp" title="Futhark.Util.IntegralExp">IntegralExp</a> num =&gt; [num] -&gt; num -&gt; [num] <a href="src/Futhark.IR.Prop.Reshape.html#unflattenIndex" class="link">Source</a> <a href="#v:unflattenIndex" class="selflink">#</a></p><div class="doc"><p><code>unflattenIndex dims i</code> computes a list of indices into an array
 with dimension <code>dims</code> given the flat index <code>i</code>.  The resulting list
 will have the same size as <code>dims</code>.</p></div></div><div class="top"><p class="src"><a id="v:sliceSizes" class="def">sliceSizes</a> :: <a href="Futhark-Util-IntegralExp.html#t:IntegralExp" title="Futhark.Util.IntegralExp">IntegralExp</a> num =&gt; [num] -&gt; [num] <a href="src/Futhark.IR.Prop.Reshape.html#sliceSizes" class="link">Source</a> <a href="#v:sliceSizes" class="selflink">#</a></p><div class="doc"><p>Given a length <code>n</code> list of dimensions <code>dims</code>, <code>sizeSizes dims</code>
 will compute a length <code>n+1</code> list of the size of each possible array
 slice.  The first element of this list will be the product of
 <code>dims</code>, and the last element will be 1.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.24.0</p></div></body></html>