<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">-- | @futhark pkg@</span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Futhark.CLI.Pkg</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CLI.Pkg.html#main"><span class="hs-identifier">main</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Codec.Archive.Zip</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Zip</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LBS</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">intercalate</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isPrefixOf</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.IO</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Pkg.Info.html"><span class="hs-identifier">Futhark.Pkg.Info</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Pkg.Solve.html"><span class="hs-identifier">Futhark.Pkg.Solve</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Pkg.Types.html"><span class="hs-identifier">Futhark.Pkg.Types</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Util.html"><span class="hs-identifier">Futhark.Util</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Util.html#directoryContents"><span class="hs-identifier">directoryContents</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Util.html#maxinum"><span class="hs-identifier">maxinum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Util.Log.html"><span class="hs-identifier">Futhark.Util.Log</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Util.Options.html"><span class="hs-identifier">Futhark.Util.Options</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Environment</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Exit</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath.Posix</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Posix</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-comment">--- Installing packages</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="annot"><a href="Futhark.CLI.Pkg.html#installInDir"><span class="hs-identifier hs-type">installInDir</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Pkg.Types.html#BuildList"><span class="hs-identifier hs-type">BuildList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CLI.Pkg.html#PkgM"><span class="hs-identifier hs-type">PkgM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span id="installInDir"><span class="annot"><span class="annottext">installInDir :: BuildList -&gt; FilePath -&gt; PkgM ()
</span><a href="Futhark.CLI.Pkg.html#installInDir"><span class="hs-identifier hs-var hs-var">installInDir</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Pkg.Types.html#BuildList"><span class="hs-identifier hs-type">BuildList</span></a></span><span> </span><span id="local-6989586621684573221"><span class="annot"><span class="annottext">Map Text SemVer
</span><a href="#local-6989586621684573221"><span class="hs-identifier hs-var">bl</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684573220"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573220"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684573201"><span class="annot"><span class="annottext">putEntry :: FilePath -&gt; FilePath -&gt; Entry -&gt; IO (Maybe FilePath)
</span><a href="#local-6989586621684573201"><span class="hs-identifier hs-var hs-var">putEntry</span></a></span></span><span> </span><span id="local-6989586621684573200"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573200"><span class="hs-identifier hs-var">from_dir</span></a></span></span><span> </span><span id="local-6989586621684573199"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573199"><span class="hs-identifier hs-var">pdir</span></a></span></span><span> </span><span id="local-6989586621684573198"><span class="annot"><span class="annottext">Entry
</span><a href="#local-6989586621684573198"><span class="hs-identifier hs-var">entry</span></a></span></span><span>
</span><span id="line-37"></span><span>        </span><span class="hs-comment">-- The archive may contain all kinds of other stuff that we don't want.</span><span>
</span><span id="line-38"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; Bool
</span><a href="#local-6989586621684573196"><span class="hs-identifier hs-var">isInPkgDir</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573200"><span class="hs-identifier hs-var">from_dir</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Bool) -&gt; FilePath -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Entry -&gt; FilePath
</span><span class="hs-identifier hs-var hs-var">Zip.eRelativePath</span></span><span> </span><span class="annot"><span class="annottext">Entry
</span><a href="#local-6989586621684573198"><span class="hs-identifier hs-var">entry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Bool
</span><span class="hs-identifier hs-var">hasTrailingPathSeparator</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Entry -&gt; FilePath
</span><span class="hs-identifier hs-var hs-var">Zip.eRelativePath</span></span><span> </span><span class="annot"><span class="annottext">Entry
</span><a href="#local-6989586621684573198"><span class="hs-identifier hs-var">entry</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-40"></span><span>          </span><span class="annot"><span class="annottext">Maybe FilePath -&gt; IO (Maybe FilePath)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-41"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-42"></span><span>          </span><span class="hs-comment">-- Since we are writing to paths indicated in a zipfile we</span><span>
</span><span id="line-43"></span><span>          </span><span class="hs-comment">-- downloaded from the wild Internet, we are going to be a</span><span>
</span><span id="line-44"></span><span>          </span><span class="hs-comment">-- little bit paranoid.  Specifically, we want to avoid</span><span>
</span><span id="line-45"></span><span>          </span><span class="hs-comment">-- writing outside of the 'lib/' directory.  We do this by</span><span>
</span><span id="line-46"></span><span>          </span><span class="hs-comment">-- bailing out if the path contains any '..' components.  We</span><span>
</span><span id="line-47"></span><span>          </span><span class="hs-comment">-- have to use System.FilePath.Posix, because the zip library</span><span>
</span><span id="line-48"></span><span>          </span><span class="hs-comment">-- claims to encode filepaths with '/' directory seperators no</span><span>
</span><span id="line-49"></span><span>          </span><span class="hs-comment">-- matter the host OS.</span><span>
</span><span id="line-50"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;..&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath]
</span><span class="hs-identifier hs-var">Posix.splitPath</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Entry -&gt; FilePath
</span><span class="hs-identifier hs-var hs-var">Zip.eRelativePath</span></span><span> </span><span class="annot"><span class="annottext">Entry
</span><a href="#local-6989586621684573198"><span class="hs-identifier hs-var">entry</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-51"></span><span>            </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
forall (m :: * -&gt; *) a. MonadFail m =&gt; FilePath -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO ()) -&gt; FilePath -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-52"></span><span>              </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Zip archive for &quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573199"><span class="hs-identifier hs-var">pdir</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot; contains suspicious path: &quot;</span></span><span>
</span><span id="line-53"></span><span>                </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Entry -&gt; FilePath
</span><span class="hs-identifier hs-var hs-var">Zip.eRelativePath</span></span><span> </span><span class="annot"><span class="annottext">Entry
</span><a href="#local-6989586621684573198"><span class="hs-identifier hs-var">entry</span></a></span><span>
</span><span id="line-54"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684573189"><span class="annot"><span class="annottext">f :: FilePath
</span><a href="#local-6989586621684573189"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573199"><span class="hs-identifier hs-var">pdir</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><span class="hs-identifier hs-var">makeRelative</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573200"><span class="hs-identifier hs-var">from_dir</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Entry -&gt; FilePath
</span><span class="hs-identifier hs-var hs-var">Zip.eRelativePath</span></span><span> </span><span class="annot"><span class="annottext">Entry
</span><a href="#local-6989586621684573198"><span class="hs-identifier hs-var">entry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">createDirectoryIfMissing</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO ()) -&gt; FilePath -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath
</span><span class="hs-identifier hs-var">takeDirectory</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573189"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-56"></span><span>          </span><span class="annot"><span class="annottext">FilePath -&gt; ByteString -&gt; IO ()
</span><span class="hs-identifier hs-var">LBS.writeFile</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573189"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ()) -&gt; ByteString -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Entry -&gt; ByteString
</span><span class="hs-identifier hs-var">Zip.fromEntry</span></span><span> </span><span class="annot"><span class="annottext">Entry
</span><a href="#local-6989586621684573198"><span class="hs-identifier hs-var">entry</span></a></span><span>
</span><span id="line-57"></span><span>          </span><span class="annot"><span class="annottext">Maybe FilePath -&gt; IO (Maybe FilePath)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe FilePath -&gt; IO (Maybe FilePath))
-&gt; Maybe FilePath -&gt; IO (Maybe FilePath)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573189"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span>      </span><span id="local-6989586621684573196"><span class="annot"><span class="annottext">isInPkgDir :: FilePath -&gt; FilePath -&gt; Bool
</span><a href="#local-6989586621684573196"><span class="hs-identifier hs-var hs-var">isInPkgDir</span></a></span></span><span> </span><span id="local-6989586621684573180"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573180"><span class="hs-identifier hs-var">from_dir</span></a></span></span><span> </span><span id="local-6989586621684573179"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573179"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-60"></span><span>        </span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath]
</span><span class="hs-identifier hs-var">Posix.splitPath</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573180"><span class="hs-identifier hs-var">from_dir</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; [FilePath] -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><span class="hs-operator hs-var">`isPrefixOf`</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath]
</span><span class="hs-identifier hs-var">Posix.splitPath</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573179"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span>  </span><span class="annot"><span class="annottext">[(Text, SemVer)] -&gt; ((Text, SemVer) -&gt; PkgM ()) -&gt; PkgM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Text SemVer -&gt; [(Text, SemVer)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">Map Text SemVer
</span><a href="#local-6989586621684573221"><span class="hs-identifier hs-var">bl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((Text, SemVer) -&gt; PkgM ()) -&gt; PkgM ())
-&gt; ((Text, SemVer) -&gt; PkgM ()) -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621684573176"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684573176"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684573175"><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684573175"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-63"></span><span>    </span><span id="local-6989586621684573174"><span class="annot"><span class="annottext">PkgRevInfo PkgM
</span><a href="#local-6989586621684573174"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SemVer -&gt; PkgM (PkgRevInfo PkgM)
forall (m :: * -&gt; *).
MonadPkgRegistry m =&gt;
Text -&gt; SemVer -&gt; m (PkgRevInfo m)
</span><a href="Futhark.Pkg.Info.html#lookupPackageRev"><span class="hs-identifier hs-var">lookupPackageRev</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684573176"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684573175"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span id="local-6989586621684573172"><span class="annot"><span class="annottext">Archive
</span><a href="#local-6989586621684573172"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PkgRevInfo PkgM -&gt; PkgM Archive
forall (m :: * -&gt; *).
(MonadLogger m, MonadIO m, MonadFail m) =&gt;
PkgRevInfo m -&gt; m Archive
</span><a href="Futhark.Pkg.Info.html#downloadZipball"><span class="hs-identifier hs-var">downloadZipball</span></a></span><span> </span><span class="annot"><span class="annottext">PkgRevInfo PkgM
</span><a href="#local-6989586621684573174"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span id="local-6989586621684573170"><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684573170"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GetManifest PkgM -&gt; PkgM PkgManifest
forall (m :: * -&gt; *). GetManifest m -&gt; m PkgManifest
</span><a href="Futhark.Pkg.Info.html#getManifest"><span class="hs-identifier hs-var hs-var">getManifest</span></a></span><span> </span><span class="annot"><span class="annottext">(GetManifest PkgM -&gt; PkgM PkgManifest)
-&gt; GetManifest PkgM -&gt; PkgM PkgManifest
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PkgRevInfo PkgM -&gt; GetManifest PkgM
forall (m :: * -&gt; *). PkgRevInfo m -&gt; GetManifest m
</span><a href="Futhark.Pkg.Info.html#pkgRevGetManifest"><span class="hs-identifier hs-var hs-var">pkgRevGetManifest</span></a></span><span> </span><span class="annot"><span class="annottext">PkgRevInfo PkgM
</span><a href="#local-6989586621684573174"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-comment">-- Compute the directory in the zipball that should contain the</span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-comment">-- package files.</span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684573162"><span class="annot"><span class="annottext">noPkgDir :: PkgM a
</span><a href="#local-6989586621684573162"><span class="hs-identifier hs-var hs-var">noPkgDir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-70"></span><span>          </span><span class="annot"><span class="annottext">FilePath -&gt; PkgM a
forall (m :: * -&gt; *) a. MonadFail m =&gt; FilePath -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; PkgM a) -&gt; FilePath -&gt; PkgM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-71"></span><span>            </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;futhark.pkg for &quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684573176"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;-&quot;</span></span><span>
</span><span id="line-72"></span><span>              </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SemVer -&gt; Text
</span><span class="hs-identifier hs-var">prettySemVer</span></span><span> </span><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684573175"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>              </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot; does not define a package path.&quot;</span></span><span>
</span><span id="line-74"></span><span>    </span><span id="local-6989586621684573159"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573159"><span class="hs-identifier hs-var">from_dir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PkgM FilePath
-&gt; (FilePath -&gt; PkgM FilePath) -&gt; Maybe FilePath -&gt; PkgM FilePath
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">PkgM FilePath
forall {a}. PkgM a
</span><a href="#local-6989586621684573162"><span class="hs-identifier hs-var">noPkgDir</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; PkgM FilePath
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; PkgM FilePath)
-&gt; (FilePath -&gt; FilePath) -&gt; FilePath -&gt; PkgM FilePath
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PkgRevInfo PkgM -&gt; FilePath
forall (m :: * -&gt; *). PkgRevInfo m -&gt; FilePath
</span><a href="Futhark.Pkg.Info.html#pkgRevZipballDir"><span class="hs-identifier hs-var hs-var">pkgRevZipballDir</span></a></span><span> </span><span class="annot"><span class="annottext">PkgRevInfo PkgM
</span><a href="#local-6989586621684573174"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe FilePath -&gt; PkgM FilePath)
-&gt; Maybe FilePath -&gt; PkgM FilePath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PkgManifest -&gt; Maybe FilePath
</span><a href="Futhark.Pkg.Types.html#pkgDir"><span class="hs-identifier hs-var">pkgDir</span></a></span><span> </span><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684573170"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-comment">-- The directory in the local file system that will contain the</span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-comment">-- package files.</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684573154"><span class="annot"><span class="annottext">pdir :: FilePath
</span><a href="#local-6989586621684573154"><span class="hs-identifier hs-var hs-var">pdir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573220"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684573176"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-comment">-- Remove any existing directory for this package.  This is a bit</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-comment">-- inefficient, as the likelihood that the old ``lib`` directory</span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-comment">-- already contains the correct version is rather high.  We should</span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-comment">-- have a way to recognise this situation, and not download the</span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-comment">-- zipball in that case.</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">removePathForcibly</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573154"><span class="hs-identifier hs-var">pdir</span></a></span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">createDirectoryIfMissing</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573154"><span class="hs-identifier hs-var">pdir</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span>    </span><span id="local-6989586621684573151"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684573151"><span class="hs-identifier hs-var">written</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-88"></span><span>      </span><span class="annot"><span class="annottext">[Maybe FilePath] -&gt; [FilePath]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe FilePath] -&gt; [FilePath])
-&gt; PkgM [Maybe FilePath] -&gt; PkgM [FilePath]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO [Maybe FilePath] -&gt; PkgM [Maybe FilePath]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Entry -&gt; IO (Maybe FilePath)) -&gt; [Entry] -&gt; IO [Maybe FilePath]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; Entry -&gt; IO (Maybe FilePath)
</span><a href="#local-6989586621684573201"><span class="hs-identifier hs-var">putEntry</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573159"><span class="hs-identifier hs-var">from_dir</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573154"><span class="hs-identifier hs-var">pdir</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Entry] -&gt; IO [Maybe FilePath]) -&gt; [Entry] -&gt; IO [Maybe FilePath]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Archive -&gt; [Entry]
</span><span class="hs-identifier hs-var hs-var">Zip.zEntries</span></span><span> </span><span class="annot"><span class="annottext">Archive
</span><a href="#local-6989586621684573172"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; PkgM () -&gt; PkgM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FilePath] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684573151"><span class="hs-identifier hs-var">written</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PkgM () -&gt; PkgM ()) -&gt; PkgM () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-91"></span><span>      </span><span class="annot"><span class="annottext">FilePath -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadFail m =&gt; FilePath -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; PkgM ()) -&gt; FilePath -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-92"></span><span>        </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Zip archive for package &quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684573176"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-93"></span><span>          </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot; does not contain any files in &quot;</span></span><span>
</span><span id="line-94"></span><span>          </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573159"><span class="hs-identifier hs-var">from_dir</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="annot"><a href="Futhark.CLI.Pkg.html#libDir"><span class="hs-identifier hs-type">libDir</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CLI.Pkg.html#libNewDir"><span class="hs-identifier hs-type">libNewDir</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CLI.Pkg.html#libOldDir"><span class="hs-identifier hs-type">libOldDir</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-97"></span><span class="hs-special">(</span><span id="libDir"><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.CLI.Pkg.html#libDir"><span class="hs-identifier hs-var">libDir</span></a></span></span><span class="hs-special">,</span><span> </span><span id="libNewDir"><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.CLI.Pkg.html#libNewDir"><span class="hs-identifier hs-var">libNewDir</span></a></span></span><span class="hs-special">,</span><span> </span><span id="libOldDir"><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.CLI.Pkg.html#libOldDir"><span class="hs-identifier hs-var">libOldDir</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;lib&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;lib~new&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;lib~old&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- | Install the packages listed in the build list in the @lib@</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- directory of the current working directory.  Since we are touching</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- the file system, we are going to be very paranoid.  In particular,</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- we want to avoid corrupting the @lib@ directory if something fails</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- along the way.</span><span>
</span><span id="line-104"></span><span class="hs-comment">--</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- The procedure is as follows:</span><span>
</span><span id="line-106"></span><span class="hs-comment">--</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- 1) Create a directory @lib~new@.  Delete an existing @lib~new@ if</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- necessary.</span><span>
</span><span id="line-109"></span><span class="hs-comment">--</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- 2) Populate @lib~new@ based on the build list.</span><span>
</span><span id="line-111"></span><span class="hs-comment">--</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- 3) Rename @lib@ to @lib~old@.  Delete an existing @lib~old@ if</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- necessary.</span><span>
</span><span id="line-114"></span><span class="hs-comment">--</span><span>
</span><span id="line-115"></span><span class="hs-comment">-- 4) Rename @lib~new@ to @lib@</span><span>
</span><span id="line-116"></span><span class="hs-comment">--</span><span>
</span><span id="line-117"></span><span class="hs-comment">-- 5) If the current package has package path @p@, move @lib~old/p@ to</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- @lib~new/p@.</span><span>
</span><span id="line-119"></span><span class="hs-comment">--</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- 6) Delete @lib~old@.</span><span>
</span><span id="line-121"></span><span class="hs-comment">--</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- Since POSIX at least guarantees atomic renames, the only place this</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- can fail is between steps 3, 4, and 5.  In that case, at least the</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- @lib~old@ will still exist and can be put back by the user.</span><span>
</span><span id="line-125"></span><span class="annot"><a href="Futhark.CLI.Pkg.html#installBuildList"><span class="hs-identifier hs-type">installBuildList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Futhark.Pkg.Types.html#PkgPath"><span class="hs-identifier hs-type">PkgPath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Pkg.Types.html#BuildList"><span class="hs-identifier hs-type">BuildList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CLI.Pkg.html#PkgM"><span class="hs-identifier hs-type">PkgM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span id="installBuildList"><span class="annot"><span class="annottext">installBuildList :: Maybe Text -&gt; BuildList -&gt; PkgM ()
</span><a href="Futhark.CLI.Pkg.html#installBuildList"><span class="hs-identifier hs-var hs-var">installBuildList</span></a></span></span><span> </span><span id="local-6989586621684573136"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621684573136"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621684573135"><span class="annot"><span class="annottext">BuildList
</span><a href="#local-6989586621684573135"><span class="hs-identifier hs-var">bl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-127"></span><span>  </span><span id="local-6989586621684573134"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684573134"><span class="hs-identifier hs-var">libdir_exists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; PkgM Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; PkgM Bool) -&gt; IO Bool -&gt; PkgM Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesDirectoryExist</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.CLI.Pkg.html#libDir"><span class="hs-identifier hs-var">libDir</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-comment">-- 1</span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">removePathForcibly</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.CLI.Pkg.html#libNewDir"><span class="hs-identifier hs-var">libNewDir</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">createDirectoryIfMissing</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.CLI.Pkg.html#libNewDir"><span class="hs-identifier hs-var">libNewDir</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-comment">-- 2</span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><span class="annottext">BuildList -&gt; FilePath -&gt; PkgM ()
</span><a href="Futhark.CLI.Pkg.html#installInDir"><span class="hs-identifier hs-var">installInDir</span></a></span><span> </span><span class="annot"><span class="annottext">BuildList
</span><a href="#local-6989586621684573135"><span class="hs-identifier hs-var">bl</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.CLI.Pkg.html#libNewDir"><span class="hs-identifier hs-var">libNewDir</span></a></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-comment">-- 3</span><span>
</span><span id="line-138"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; PkgM () -&gt; PkgM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684573134"><span class="hs-identifier hs-var">libdir_exists</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgM () -&gt; PkgM ()) -&gt; PkgM () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-140"></span><span>      </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">removePathForcibly</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.CLI.Pkg.html#libOldDir"><span class="hs-identifier hs-var">libOldDir</span></a></span><span>
</span><span id="line-141"></span><span>      </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">renameDirectory</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.CLI.Pkg.html#libDir"><span class="hs-identifier hs-var">libDir</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.CLI.Pkg.html#libOldDir"><span class="hs-identifier hs-var">libOldDir</span></a></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-comment">-- 4</span><span>
</span><span id="line-144"></span><span>  </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">renameDirectory</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.CLI.Pkg.html#libNewDir"><span class="hs-identifier hs-var">libNewDir</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.CLI.Pkg.html#libDir"><span class="hs-identifier hs-var">libDir</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-comment">-- 5</span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><a href="Futhark.Pkg.Types.html#pkgPathFilePath"><span class="hs-identifier hs-var">pkgPathFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; FilePath) -&gt; Maybe Text -&gt; Maybe FilePath
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621684573136"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-148"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684573130"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573130"><span class="hs-identifier hs-var">pfp</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684573134"><span class="hs-identifier hs-var">libdir_exists</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-149"></span><span>      </span><span id="local-6989586621684573129"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684573129"><span class="hs-identifier hs-var">pkgdir_exists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesDirectoryExist</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO Bool) -&gt; FilePath -&gt; IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.CLI.Pkg.html#libOldDir"><span class="hs-identifier hs-var">libOldDir</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573130"><span class="hs-identifier hs-var">pfp</span></a></span><span>
</span><span id="line-150"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684573129"><span class="hs-identifier hs-var">pkgdir_exists</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-151"></span><span>        </span><span class="hs-comment">-- Ensure the parent directories exist so that we can move the</span><span>
</span><span id="line-152"></span><span>        </span><span class="hs-comment">-- package directory directly.</span><span>
</span><span id="line-153"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">createDirectoryIfMissing</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO ()) -&gt; FilePath -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath
</span><span class="hs-identifier hs-var">takeDirectory</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; FilePath) -&gt; FilePath -&gt; FilePath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.CLI.Pkg.html#libDir"><span class="hs-identifier hs-var">libDir</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573130"><span class="hs-identifier hs-var">pfp</span></a></span><span>
</span><span id="line-154"></span><span>        </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">renameDirectory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.CLI.Pkg.html#libOldDir"><span class="hs-identifier hs-var">libOldDir</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573130"><span class="hs-identifier hs-var">pfp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.CLI.Pkg.html#libDir"><span class="hs-identifier hs-var">libDir</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573130"><span class="hs-identifier hs-var">pfp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><span class="annottext">Maybe FilePath
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; PkgM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-comment">-- 6</span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; PkgM () -&gt; PkgM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684573134"><span class="hs-identifier hs-var">libdir_exists</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgM () -&gt; PkgM ()) -&gt; PkgM () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">removePathForcibly</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.CLI.Pkg.html#libOldDir"><span class="hs-identifier hs-var">libOldDir</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="annot"><a href="Futhark.CLI.Pkg.html#getPkgManifest"><span class="hs-identifier hs-type">getPkgManifest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CLI.Pkg.html#PkgM"><span class="hs-identifier hs-type">PkgM</span></a></span><span> </span><span class="annot"><a href="Futhark.Pkg.Types.html#PkgManifest"><span class="hs-identifier hs-type">PkgManifest</span></a></span><span>
</span><span id="line-161"></span><span id="getPkgManifest"><span class="annot"><span class="annottext">getPkgManifest :: PkgM PkgManifest
</span><a href="Futhark.CLI.Pkg.html#getPkgManifest"><span class="hs-identifier hs-var hs-var">getPkgManifest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-162"></span><span>  </span><span id="local-6989586621684573127"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684573127"><span class="hs-identifier hs-var">file_exists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; PkgM Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; PkgM Bool) -&gt; IO Bool -&gt; PkgM Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesFileExist</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.Pkg.Types.html#futharkPkg"><span class="hs-identifier hs-var">futharkPkg</span></a></span><span>
</span><span id="line-163"></span><span>  </span><span id="local-6989586621684573124"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684573124"><span class="hs-identifier hs-var">dir_exists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; PkgM Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; PkgM Bool) -&gt; IO Bool -&gt; PkgM Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesDirectoryExist</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.Pkg.Types.html#futharkPkg"><span class="hs-identifier hs-var">futharkPkg</span></a></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684573127"><span class="hs-identifier hs-var">file_exists</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684573124"><span class="hs-identifier hs-var">dir_exists</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO PkgManifest -&gt; PkgM PkgManifest
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO PkgManifest -&gt; PkgM PkgManifest)
-&gt; IO PkgManifest -&gt; PkgM PkgManifest
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO PkgManifest
</span><a href="Futhark.Pkg.Types.html#parsePkgManifestFromFile"><span class="hs-identifier hs-var">parsePkgManifestFromFile</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.Pkg.Types.html#futharkPkg"><span class="hs-identifier hs-var">futharkPkg</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-168"></span><span>      </span><span class="annot"><span class="annottext">FilePath -&gt; PkgM PkgManifest
forall (m :: * -&gt; *) a. MonadFail m =&gt; FilePath -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; PkgM PkgManifest) -&gt; FilePath -&gt; PkgM PkgManifest
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-169"></span><span>        </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.Pkg.Types.html#futharkPkg"><span class="hs-identifier hs-var">futharkPkg</span></a></span><span>
</span><span id="line-170"></span><span>          </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot; exists, but it is a directory!  What in Odin's beard...&quot;</span></span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><span class="annottext">(Bool, Bool)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO PkgManifest -&gt; PkgM PkgManifest
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO PkgManifest -&gt; PkgM PkgManifest)
-&gt; IO PkgManifest -&gt; PkgM PkgManifest
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-172"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.Pkg.Types.html#futharkPkg"><span class="hs-identifier hs-var">futharkPkg</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; not found - pretending it's empty.&quot;</span></span><span>
</span><span id="line-173"></span><span>      </span><span class="annot"><span class="annottext">PkgManifest -&gt; IO PkgManifest
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PkgManifest -&gt; IO PkgManifest) -&gt; PkgManifest -&gt; IO PkgManifest
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; PkgManifest
</span><a href="Futhark.Pkg.Types.html#newPkgManifest"><span class="hs-identifier hs-var">newPkgManifest</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="annot"><a href="Futhark.CLI.Pkg.html#putPkgManifest"><span class="hs-identifier hs-type">putPkgManifest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Pkg.Types.html#PkgManifest"><span class="hs-identifier hs-type">PkgManifest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CLI.Pkg.html#PkgM"><span class="hs-identifier hs-type">PkgM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span id="putPkgManifest"><span class="annot"><span class="annottext">putPkgManifest :: PkgManifest -&gt; PkgM ()
</span><a href="Futhark.CLI.Pkg.html#putPkgManifest"><span class="hs-identifier hs-var hs-var">putPkgManifest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ())
-&gt; (PkgManifest -&gt; IO ()) -&gt; PkgManifest -&gt; PkgM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.Pkg.Types.html#futharkPkg"><span class="hs-identifier hs-var">futharkPkg</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; (PkgManifest -&gt; Text) -&gt; PkgManifest -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PkgManifest -&gt; Text
</span><a href="Futhark.Pkg.Types.html#prettyPkgManifest"><span class="hs-identifier hs-var">prettyPkgManifest</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">--- The CLI</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="hs-keyword">newtype</span><span> </span><span id="PkgConfig"><span class="annot"><a href="Futhark.CLI.Pkg.html#PkgConfig"><span class="hs-identifier hs-var">PkgConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PkgConfig"><span class="annot"><a href="Futhark.CLI.Pkg.html#PkgConfig"><span class="hs-identifier hs-var">PkgConfig</span></a></span></span><span> </span><span class="hs-special">{</span><span id="pkgVerbose"><span class="annot"><span class="annottext">PkgConfig -&gt; Bool
</span><a href="Futhark.CLI.Pkg.html#pkgVerbose"><span class="hs-identifier hs-var hs-var">pkgVerbose</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">}</span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="hs-comment">-- | The monad in which futhark-pkg runs.</span><span>
</span><span id="line-183"></span><span class="hs-keyword">newtype</span><span> </span><span id="PkgM"><span class="annot"><a href="Futhark.CLI.Pkg.html#PkgM"><span class="hs-identifier hs-var">PkgM</span></a></span></span><span> </span><span id="local-6989586621684573532"><span class="annot"><a href="#local-6989586621684573532"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PkgM"><span class="annot"><a href="Futhark.CLI.Pkg.html#PkgM"><span class="hs-identifier hs-var">PkgM</span></a></span></span><span> </span><span class="hs-special">{</span><span id="unPkgM"><span class="annot"><span class="annottext">forall a.
PkgM a -&gt; ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) a
</span><a href="Futhark.CLI.Pkg.html#unPkgM"><span class="hs-identifier hs-var hs-var">unPkgM</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Futhark.CLI.Pkg.html#PkgConfig"><span class="hs-identifier hs-type">PkgConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Pkg.Info.html#PkgRegistry"><span class="hs-identifier hs-type">PkgRegistry</span></a></span><span> </span><span class="annot"><a href="Futhark.CLI.Pkg.html#PkgM"><span class="hs-identifier hs-type">PkgM</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621684573532"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684573105"><span id="local-6989586621684573111"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; PkgM a -&gt; PkgM b)
-&gt; (forall a b. a -&gt; PkgM b -&gt; PkgM a) -&gt; Functor PkgM
forall a b. a -&gt; PkgM b -&gt; PkgM a
forall a b. (a -&gt; b) -&gt; PkgM a -&gt; PkgM b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: forall a b. a -&gt; PkgM b -&gt; PkgM a
$c&lt;$ :: forall a b. a -&gt; PkgM b -&gt; PkgM a
fmap :: forall a b. (a -&gt; b) -&gt; PkgM a -&gt; PkgM b
$cfmap :: forall a b. (a -&gt; b) -&gt; PkgM a -&gt; PkgM b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684573075"><span id="local-6989586621684573080"><span id="local-6989586621684573085"><span id="local-6989586621684573090"><span id="local-6989586621684573096"><span class="annot"><span class="annottext">Functor PkgM
Functor PkgM
-&gt; (forall a. a -&gt; PkgM a)
-&gt; (forall a b. PkgM (a -&gt; b) -&gt; PkgM a -&gt; PkgM b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; PkgM a -&gt; PkgM b -&gt; PkgM c)
-&gt; (forall a b. PkgM a -&gt; PkgM b -&gt; PkgM b)
-&gt; (forall a b. PkgM a -&gt; PkgM b -&gt; PkgM a)
-&gt; Applicative PkgM
forall a. a -&gt; PkgM a
forall a b. PkgM a -&gt; PkgM b -&gt; PkgM a
forall a b. PkgM a -&gt; PkgM b -&gt; PkgM b
forall a b. PkgM (a -&gt; b) -&gt; PkgM a -&gt; PkgM b
forall a b c. (a -&gt; b -&gt; c) -&gt; PkgM a -&gt; PkgM b -&gt; PkgM c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
&lt;* :: forall a b. PkgM a -&gt; PkgM b -&gt; PkgM a
$c&lt;* :: forall a b. PkgM a -&gt; PkgM b -&gt; PkgM a
*&gt; :: forall a b. PkgM a -&gt; PkgM b -&gt; PkgM b
$c*&gt; :: forall a b. PkgM a -&gt; PkgM b -&gt; PkgM b
liftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; PkgM a -&gt; PkgM b -&gt; PkgM c
$cliftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; PkgM a -&gt; PkgM b -&gt; PkgM c
&lt;*&gt; :: forall a b. PkgM (a -&gt; b) -&gt; PkgM a -&gt; PkgM b
$c&lt;*&gt; :: forall a b. PkgM (a -&gt; b) -&gt; PkgM a -&gt; PkgM b
pure :: forall a. a -&gt; PkgM a
$cpure :: forall a. a -&gt; PkgM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684573066"><span class="annot"><span class="annottext">Monad PkgM
Monad PkgM -&gt; (forall a. IO a -&gt; PkgM a) -&gt; MonadIO PkgM
forall a. IO a -&gt; PkgM a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. IO a -&gt; m a) -&gt; MonadIO m
liftIO :: forall a. IO a -&gt; PkgM a
$cliftIO :: forall a. IO a -&gt; PkgM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684573045"><span id="local-6989586621684573050"><span id="local-6989586621684573056"><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Futhark.CLI.Pkg.html#PkgConfig"><span class="hs-identifier hs-type">PkgConfig</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621684573032"><span id="local-6989586621684573034"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="Futhark.CLI.Pkg.html#PkgM"><span class="hs-identifier hs-type">PkgM</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><a href="Futhark.CLI.Pkg.html#PkgM"><span class="hs-identifier hs-type">PkgM</span></a></span><span> </span><span id="local-6989586621684573027"><span class="annot"><span class="annottext">ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) a
</span><a href="#local-6989586621684573027"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621684573026"><span class="annot"><span class="annottext">&gt;&gt;= :: forall a b. PkgM a -&gt; (a -&gt; PkgM b) -&gt; PkgM b
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&gt;&gt;=</span></span></span><span> </span><span id="local-6989586621684573025"><span class="annot"><span class="annottext">a -&gt; PkgM b
</span><a href="#local-6989586621684573025"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) b -&gt; PkgM b
forall a.
ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) a -&gt; PkgM a
</span><a href="Futhark.CLI.Pkg.html#PkgM"><span class="hs-identifier hs-var">PkgM</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) b -&gt; PkgM b)
-&gt; ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) b -&gt; PkgM b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) a
</span><a href="#local-6989586621684573027"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) a
-&gt; (a -&gt; ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) b)
-&gt; ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">PkgM b -&gt; ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) b
forall a.
PkgM a -&gt; ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) a
</span><a href="Futhark.CLI.Pkg.html#unPkgM"><span class="hs-identifier hs-var hs-var">unPkgM</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgM b -&gt; ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) b)
-&gt; (a -&gt; PkgM b)
-&gt; a
-&gt; ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; PkgM b
</span><a href="#local-6989586621684573025"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="Futhark.CLI.Pkg.html#PkgM"><span class="hs-identifier hs-type">PkgM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-190"></span><span>  </span><span id="local-6989586621684573016"><span class="annot"><span class="annottext">fail :: forall a. FilePath -&gt; PkgM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">fail</span></span></span><span> </span><span id="local-6989586621684573015"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573015"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; PkgM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; PkgM a) -&gt; IO a -&gt; PkgM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-191"></span><span>    </span><span id="local-6989586621684573014"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573014"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO FilePath
</span><span class="hs-identifier hs-var">getProgName</span></span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO ()) -&gt; FilePath -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573014"><span class="hs-identifier hs-var">prog</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684573015"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span class="annot"><span class="annottext">IO a
forall a. IO a
</span><span class="hs-identifier hs-var">exitFailure</span></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621684573001"><span class="annot"><a href="Futhark.Pkg.Info.html#MonadPkgRegistry"><span class="hs-identifier hs-type">MonadPkgRegistry</span></a></span><span> </span><span class="annot"><a href="Futhark.CLI.Pkg.html#PkgM"><span class="hs-identifier hs-type">PkgM</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-196"></span><span>  </span><span id="local-6989586621684572995"><span class="annot"><span class="annottext">putPkgRegistry :: PkgRegistry PkgM -&gt; PkgM ()
</span><a href="Futhark.Pkg.Info.html#putPkgRegistry"><span class="hs-identifier hs-var hs-var hs-var hs-var">putPkgRegistry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) () -&gt; PkgM ()
forall a.
ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) a -&gt; PkgM a
</span><a href="Futhark.CLI.Pkg.html#PkgM"><span class="hs-identifier hs-var">PkgM</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) () -&gt; PkgM ())
-&gt; (PkgRegistry PkgM
    -&gt; ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) ())
-&gt; PkgRegistry PkgM
-&gt; PkgM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PkgRegistry PkgM
-&gt; ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span>
</span><span id="line-197"></span><span>  </span><span id="local-6989586621684572990"><span class="annot"><span class="annottext">getPkgRegistry :: PkgM (PkgRegistry PkgM)
</span><a href="Futhark.Pkg.Info.html#getPkgRegistry"><span class="hs-identifier hs-var hs-var hs-var hs-var">getPkgRegistry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) (PkgRegistry PkgM)
-&gt; PkgM (PkgRegistry PkgM)
forall a.
ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) a -&gt; PkgM a
</span><a href="Futhark.CLI.Pkg.html#PkgM"><span class="hs-identifier hs-var">PkgM</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) (PkgRegistry PkgM)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621684572982"><span class="annot"><a href="Futhark.Util.Log.html#MonadLogger"><span class="hs-identifier hs-type">MonadLogger</span></a></span><span> </span><span class="annot"><a href="Futhark.CLI.Pkg.html#PkgM"><span class="hs-identifier hs-type">PkgM</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-200"></span><span>  </span><span id="local-6989586621684572975"><span class="annot"><span class="annottext">addLog :: Log -&gt; PkgM ()
</span><a href="Futhark.Util.Log.html#addLog"><span class="hs-identifier hs-var hs-var hs-var hs-var">addLog</span></a></span></span><span> </span><span id="local-6989586621684572973"><span class="annot"><span class="annottext">Log
</span><a href="#local-6989586621684572973"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-201"></span><span>    </span><span id="local-6989586621684572972"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684572972"><span class="hs-identifier hs-var">verbose</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PkgConfig -&gt; Bool) -&gt; PkgM Bool
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">PkgConfig -&gt; Bool
</span><a href="Futhark.CLI.Pkg.html#pkgVerbose"><span class="hs-identifier hs-var hs-var">pkgVerbose</span></a></span><span>
</span><span id="line-202"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; PkgM () -&gt; PkgM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684572972"><span class="hs-identifier hs-var">verbose</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgM () -&gt; PkgM ()) -&gt; PkgM () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.hPutStrLn</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stderr</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Log -&gt; Text
</span><a href="Futhark.Util.Log.html#toText"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">Log
</span><a href="#local-6989586621684572973"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span id="local-6989586621684573447"><span class="annot"><a href="Futhark.CLI.Pkg.html#runPkgM"><span class="hs-identifier hs-type">runPkgM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CLI.Pkg.html#PkgConfig"><span class="hs-identifier hs-type">PkgConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CLI.Pkg.html#PkgM"><span class="hs-identifier hs-type">PkgM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684573447"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621684573447"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-205"></span><span id="runPkgM"><span class="annot"><span class="annottext">runPkgM :: forall a. PkgConfig -&gt; PkgM a -&gt; IO a
</span><a href="Futhark.CLI.Pkg.html#runPkgM"><span class="hs-identifier hs-var hs-var">runPkgM</span></a></span></span><span> </span><span id="local-6989586621684572963"><span class="annot"><span class="annottext">PkgConfig
</span><a href="#local-6989586621684572963"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CLI.Pkg.html#PkgM"><span class="hs-identifier hs-type">PkgM</span></a></span><span> </span><span id="local-6989586621684572962"><span class="annot"><span class="annottext">ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) a
</span><a href="#local-6989586621684572962"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT (PkgRegistry PkgM) IO a -&gt; PkgRegistry PkgM -&gt; IO a
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><span class="hs-identifier hs-var">evalStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) a
-&gt; PkgConfig -&gt; StateT (PkgRegistry PkgM) IO a
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">ReaderT PkgConfig (StateT (PkgRegistry PkgM) IO) a
</span><a href="#local-6989586621684572962"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">PkgConfig
</span><a href="#local-6989586621684572963"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PkgRegistry PkgM
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="annot"><a href="Futhark.CLI.Pkg.html#cmdMain"><span class="hs-identifier hs-type">cmdMain</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-208"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CLI.Pkg.html#PkgConfig"><span class="hs-identifier hs-type">PkgConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-212"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span id="cmdMain"><span class="annot"><span class="annottext">cmdMain :: FilePath
-&gt; ([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#cmdMain"><span class="hs-identifier hs-var hs-var">cmdMain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PkgConfig
-&gt; [FunOptDescr PkgConfig]
-&gt; FilePath
-&gt; ([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
forall cfg.
cfg
-&gt; [FunOptDescr cfg]
-&gt; FilePath
-&gt; ([FilePath] -&gt; cfg -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
</span><a href="Futhark.Util.Options.html#mainWithOptions"><span class="hs-identifier hs-var">mainWithOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; PkgConfig
</span><a href="Futhark.CLI.Pkg.html#PkgConfig"><span class="hs-identifier hs-var">PkgConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FunOptDescr PkgConfig]
forall {a}. [OptDescr (Either a (PkgConfig -&gt; PkgConfig))]
</span><a href="#local-6989586621684572957"><span class="hs-identifier hs-var">options</span></a></span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-215"></span><span>    </span><span id="local-6989586621684572957"><span class="annot"><span class="annottext">options :: [OptDescr (Either a (PkgConfig -&gt; PkgConfig))]
</span><a href="#local-6989586621684572957"><span class="hs-identifier hs-var hs-var">options</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-216"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FilePath
-&gt; [FilePath]
-&gt; ArgDescr (Either a (PkgConfig -&gt; PkgConfig))
-&gt; FilePath
-&gt; OptDescr (Either a (PkgConfig -&gt; PkgConfig))
forall a.
FilePath -&gt; [FilePath] -&gt; ArgDescr a -&gt; FilePath -&gt; OptDescr a
</span><span class="hs-identifier hs-var">Option</span></span><span>
</span><span id="line-217"></span><span>          </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;v&quot;</span></span><span>
</span><span id="line-218"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;verbose&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-219"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either a (PkgConfig -&gt; PkgConfig)
-&gt; ArgDescr (Either a (PkgConfig -&gt; PkgConfig))
forall a. a -&gt; ArgDescr a
</span><span class="hs-identifier hs-var">NoArg</span></span><span> </span><span class="annot"><span class="annottext">(Either a (PkgConfig -&gt; PkgConfig)
 -&gt; ArgDescr (Either a (PkgConfig -&gt; PkgConfig)))
-&gt; Either a (PkgConfig -&gt; PkgConfig)
-&gt; ArgDescr (Either a (PkgConfig -&gt; PkgConfig))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PkgConfig -&gt; PkgConfig) -&gt; Either a (PkgConfig -&gt; PkgConfig)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">((PkgConfig -&gt; PkgConfig) -&gt; Either a (PkgConfig -&gt; PkgConfig))
-&gt; (PkgConfig -&gt; PkgConfig) -&gt; Either a (PkgConfig -&gt; PkgConfig)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684572954"><span class="annot"><span class="annottext">PkgConfig
</span><a href="#local-6989586621684572954"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PkgConfig
</span><a href="#local-6989586621684572954"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">pkgVerbose :: Bool
</span><a href="Futhark.CLI.Pkg.html#pkgVerbose"><span class="hs-identifier hs-var">pkgVerbose</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>          </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Write running diagnostics to stderr.&quot;</span></span><span>
</span><span id="line-221"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="annot"><a href="Futhark.CLI.Pkg.html#doFmt"><span class="hs-identifier hs-type">doFmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span id="doFmt"><span class="annot"><span class="annottext">doFmt :: FilePath -&gt; [FilePath] -&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#doFmt"><span class="hs-identifier hs-var hs-var">doFmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">()
-&gt; [FunOptDescr ()]
-&gt; FilePath
-&gt; ([FilePath] -&gt; () -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
forall cfg.
cfg
-&gt; [FunOptDescr cfg]
-&gt; FilePath
-&gt; ([FilePath] -&gt; cfg -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
</span><a href="Futhark.Util.Options.html#mainWithOptions"><span class="hs-identifier hs-var">mainWithOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">(([FilePath] -&gt; () -&gt; Maybe (IO ()))
 -&gt; FilePath -&gt; [FilePath] -&gt; IO ())
-&gt; ([FilePath] -&gt; () -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684572952"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572952"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572952"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Maybe (IO ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Maybe (IO ())) -&gt; IO () -&gt; Maybe (IO ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-227"></span><span>      </span><span id="local-6989586621684572951"><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572951"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO PkgManifest
</span><a href="Futhark.Pkg.Types.html#parsePkgManifestFromFile"><span class="hs-identifier hs-var">parsePkgManifestFromFile</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.Pkg.Types.html#futharkPkg"><span class="hs-identifier hs-var">futharkPkg</span></a></span><span>
</span><span id="line-228"></span><span>      </span><span class="annot"><span class="annottext">FilePath -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.Pkg.Types.html#futharkPkg"><span class="hs-identifier hs-var">futharkPkg</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PkgManifest -&gt; Text
</span><a href="Futhark.Pkg.Types.html#prettyPkgManifest"><span class="hs-identifier hs-var">prettyPkgManifest</span></a></span><span> </span><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572951"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-229"></span><span>    </span><span class="annot"><span class="annottext">[FilePath]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (IO ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="annot"><a href="Futhark.CLI.Pkg.html#doCheck"><span class="hs-identifier hs-type">doCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span id="doCheck"><span class="annot"><span class="annottext">doCheck :: FilePath -&gt; [FilePath] -&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#doCheck"><span class="hs-identifier hs-var hs-var">doCheck</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
-&gt; ([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#cmdMain"><span class="hs-identifier hs-var">cmdMain</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;check&quot;</span></span><span> </span><span class="annot"><span class="annottext">(([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
 -&gt; FilePath -&gt; [FilePath] -&gt; IO ())
-&gt; ([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684572949"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572949"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621684572948"><span class="annot"><span class="annottext">PkgConfig
</span><a href="#local-6989586621684572948"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572949"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Maybe (IO ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Maybe (IO ())) -&gt; IO () -&gt; Maybe (IO ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-235"></span><span>      </span><span class="annot"><span class="annottext">PkgConfig -&gt; PkgM () -&gt; IO ()
forall a. PkgConfig -&gt; PkgM a -&gt; IO a
</span><a href="Futhark.CLI.Pkg.html#runPkgM"><span class="hs-identifier hs-var">runPkgM</span></a></span><span> </span><span class="annot"><span class="annottext">PkgConfig
</span><a href="#local-6989586621684572948"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgM () -&gt; IO ()) -&gt; PkgM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-236"></span><span>        </span><span id="local-6989586621684572947"><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572947"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PkgM PkgManifest
</span><a href="Futhark.CLI.Pkg.html#getPkgManifest"><span class="hs-identifier hs-var">getPkgManifest</span></a></span><span>
</span><span id="line-237"></span><span>        </span><span id="local-6989586621684572946"><span class="annot"><span class="annottext">BuildList
</span><a href="#local-6989586621684572946"><span class="hs-identifier hs-var">bl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PkgRevDeps -&gt; PkgM BuildList
forall (m :: * -&gt; *).
MonadPkgRegistry m =&gt;
PkgRevDeps -&gt; m BuildList
</span><a href="Futhark.Pkg.Solve.html#solveDeps"><span class="hs-identifier hs-var">solveDeps</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgRevDeps -&gt; PkgM BuildList) -&gt; PkgRevDeps -&gt; PkgM BuildList
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PkgManifest -&gt; PkgRevDeps
</span><a href="Futhark.Pkg.Types.html#pkgRevDeps"><span class="hs-identifier hs-var">pkgRevDeps</span></a></span><span> </span><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572947"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Dependencies chosen:&quot;</span></span><span>
</span><span id="line-240"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStr</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BuildList -&gt; Text
</span><a href="Futhark.Pkg.Types.html#prettyBuildList"><span class="hs-identifier hs-var">prettyBuildList</span></a></span><span> </span><span class="annot"><span class="annottext">BuildList
</span><a href="#local-6989586621684572946"><span class="hs-identifier hs-var">bl</span></a></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Commented (Maybe Text) -&gt; Maybe Text
forall a. Commented a -&gt; a
</span><a href="Futhark.Pkg.Types.html#commented"><span class="hs-identifier hs-var hs-var">commented</span></a></span><span> </span><span class="annot"><span class="annottext">(Commented (Maybe Text) -&gt; Maybe Text)
-&gt; Commented (Maybe Text) -&gt; Maybe Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PkgManifest -&gt; Commented (Maybe Text)
</span><a href="Futhark.Pkg.Types.html#manifestPkgPath"><span class="hs-identifier hs-var hs-var">manifestPkgPath</span></a></span><span> </span><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572947"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-243"></span><span>          </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; PkgM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684572939"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572939"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-245"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684572938"><span class="annot"><span class="annottext">pdir :: FilePath
</span><a href="#local-6989586621684572938"><span class="hs-identifier hs-var hs-var">pdir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;lib&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572939"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span>            </span><span id="local-6989586621684572937"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684572937"><span class="hs-identifier hs-var">pdir_exists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; PkgM Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; PkgM Bool) -&gt; IO Bool -&gt; PkgM Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesDirectoryExist</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572938"><span class="hs-identifier hs-var">pdir</span></a></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; PkgM () -&gt; PkgM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684572937"><span class="hs-identifier hs-var">pdir_exists</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgM () -&gt; PkgM ()) -&gt; PkgM () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-250"></span><span>              </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-251"></span><span>                </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Problem: the directory &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572938"><span class="hs-identifier hs-var">pdir</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; does not exist.&quot;</span></span><span>
</span><span id="line-252"></span><span>                </span><span class="annot"><span class="annottext">IO ()
forall a. IO a
</span><span class="hs-identifier hs-var">exitFailure</span></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span>            </span><span id="local-6989586621684572935"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684572935"><span class="hs-identifier hs-var">anything</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-255"></span><span>              </span><span class="annot"><span class="annottext">IO Bool -&gt; PkgM Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; PkgM Bool) -&gt; IO Bool -&gt; PkgM Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-256"></span><span>                </span><span class="annot"><span class="annottext">(FilePath -&gt; Bool) -&gt; [FilePath] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;.fut&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Bool) -&gt; (FilePath -&gt; FilePath) -&gt; FilePath -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath
</span><span class="hs-identifier hs-var">takeExtension</span></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>                  </span><span class="annot"><span class="annottext">([FilePath] -&gt; Bool) -&gt; IO [FilePath] -&gt; IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO [FilePath]
</span><a href="Futhark.Util.html#directoryContents"><span class="hs-identifier hs-var">directoryContents</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;lib&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572939"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; PkgM () -&gt; PkgM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684572935"><span class="hs-identifier hs-var">anything</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgM () -&gt; PkgM ()) -&gt; PkgM () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-259"></span><span>              </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-260"></span><span>                </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Problem: the directory &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572938"><span class="hs-identifier hs-var">pdir</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; does not contain any .fut files.&quot;</span></span><span>
</span><span id="line-261"></span><span>                </span><span class="annot"><span class="annottext">IO ()
forall a. IO a
</span><span class="hs-identifier hs-var">exitFailure</span></span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><span class="annottext">[FilePath]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (IO ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="annot"><a href="Futhark.CLI.Pkg.html#doSync"><span class="hs-identifier hs-type">doSync</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span id="doSync"><span class="annot"><span class="annottext">doSync :: FilePath -&gt; [FilePath] -&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#doSync"><span class="hs-identifier hs-var hs-var">doSync</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
-&gt; ([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#cmdMain"><span class="hs-identifier hs-var">cmdMain</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">(([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
 -&gt; FilePath -&gt; [FilePath] -&gt; IO ())
-&gt; ([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684572931"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572931"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621684572930"><span class="annot"><span class="annottext">PkgConfig
</span><a href="#local-6989586621684572930"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572931"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Maybe (IO ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Maybe (IO ())) -&gt; IO () -&gt; Maybe (IO ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-268"></span><span>      </span><span class="annot"><span class="annottext">PkgConfig -&gt; PkgM () -&gt; IO ()
forall a. PkgConfig -&gt; PkgM a -&gt; IO a
</span><a href="Futhark.CLI.Pkg.html#runPkgM"><span class="hs-identifier hs-var">runPkgM</span></a></span><span> </span><span class="annot"><span class="annottext">PkgConfig
</span><a href="#local-6989586621684572930"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgM () -&gt; IO ()) -&gt; PkgM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-269"></span><span>        </span><span id="local-6989586621684572929"><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572929"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PkgM PkgManifest
</span><a href="Futhark.CLI.Pkg.html#getPkgManifest"><span class="hs-identifier hs-var">getPkgManifest</span></a></span><span>
</span><span id="line-270"></span><span>        </span><span id="local-6989586621684572928"><span class="annot"><span class="annottext">BuildList
</span><a href="#local-6989586621684572928"><span class="hs-identifier hs-var">bl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PkgRevDeps -&gt; PkgM BuildList
forall (m :: * -&gt; *).
MonadPkgRegistry m =&gt;
PkgRevDeps -&gt; m BuildList
</span><a href="Futhark.Pkg.Solve.html#solveDeps"><span class="hs-identifier hs-var">solveDeps</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgRevDeps -&gt; PkgM BuildList) -&gt; PkgRevDeps -&gt; PkgM BuildList
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PkgManifest -&gt; PkgRevDeps
</span><a href="Futhark.Pkg.Types.html#pkgRevDeps"><span class="hs-identifier hs-var">pkgRevDeps</span></a></span><span> </span><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572929"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-271"></span><span>        </span><span class="annot"><span class="annottext">Maybe Text -&gt; BuildList -&gt; PkgM ()
</span><a href="Futhark.CLI.Pkg.html#installBuildList"><span class="hs-identifier hs-var">installBuildList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Commented (Maybe Text) -&gt; Maybe Text
forall a. Commented a -&gt; a
</span><a href="Futhark.Pkg.Types.html#commented"><span class="hs-identifier hs-var hs-var">commented</span></a></span><span> </span><span class="annot"><span class="annottext">(Commented (Maybe Text) -&gt; Maybe Text)
-&gt; Commented (Maybe Text) -&gt; Maybe Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PkgManifest -&gt; Commented (Maybe Text)
</span><a href="Futhark.Pkg.Types.html#manifestPkgPath"><span class="hs-identifier hs-var hs-var">manifestPkgPath</span></a></span><span> </span><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572929"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BuildList
</span><a href="#local-6989586621684572928"><span class="hs-identifier hs-var">bl</span></a></span><span>
</span><span id="line-272"></span><span>    </span><span class="annot"><span class="annottext">[FilePath]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (IO ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span class="annot"><a href="Futhark.CLI.Pkg.html#doAdd"><span class="hs-identifier hs-type">doAdd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span id="doAdd"><span class="annot"><span class="annottext">doAdd :: FilePath -&gt; [FilePath] -&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#doAdd"><span class="hs-identifier hs-var hs-var">doAdd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
-&gt; ([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#cmdMain"><span class="hs-identifier hs-var">cmdMain</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;PKGPATH&quot;</span></span><span> </span><span class="annot"><span class="annottext">(([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
 -&gt; FilePath -&gt; [FilePath] -&gt; IO ())
-&gt; ([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684572926"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572926"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621684572925"><span class="annot"><span class="annottext">PkgConfig
</span><a href="#local-6989586621684572925"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572926"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621684572924"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572924"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684572923"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572923"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621684572922"><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684572922"><span class="hs-identifier hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either (ParseErrorBundle Text Void) SemVer
</span><a href="Futhark.Pkg.Types.html#parseVersion"><span class="hs-identifier hs-var">parseVersion</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Either (ParseErrorBundle Text Void) SemVer)
-&gt; Text -&gt; Either (ParseErrorBundle Text Void) SemVer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572923"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Maybe (IO ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Maybe (IO ())) -&gt; IO () -&gt; Maybe (IO ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PkgConfig -&gt; PkgM () -&gt; IO ()
forall a. PkgConfig -&gt; PkgM a -&gt; IO a
</span><a href="Futhark.CLI.Pkg.html#runPkgM"><span class="hs-identifier hs-var">runPkgM</span></a></span><span> </span><span class="annot"><span class="annottext">PkgConfig
</span><a href="#local-6989586621684572925"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgM () -&gt; IO ()) -&gt; PkgM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SemVer -&gt; PkgM ()
</span><a href="#local-6989586621684572920"><span class="hs-identifier hs-var">doAdd'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572924"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684572922"><span class="hs-identifier hs-var">v'</span></a></span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621684572919"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572919"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-279"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; Maybe (IO ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Maybe (IO ())) -&gt; IO () -&gt; Maybe (IO ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-280"></span><span>        </span><span class="annot"><span class="annottext">PkgConfig -&gt; PkgM () -&gt; IO ()
forall a. PkgConfig -&gt; PkgM a -&gt; IO a
</span><a href="Futhark.CLI.Pkg.html#runPkgM"><span class="hs-identifier hs-var">runPkgM</span></a></span><span> </span><span class="annot"><span class="annottext">PkgConfig
</span><a href="#local-6989586621684572925"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgM () -&gt; IO ()) -&gt; PkgM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-281"></span><span>          </span><span class="hs-comment">-- Look up the newest revision of the package.</span><span>
</span><span id="line-282"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; SemVer -&gt; PkgM ()
</span><a href="#local-6989586621684572920"><span class="hs-identifier hs-var">doAdd'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572919"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SemVer -&gt; PkgM ()) -&gt; PkgM SemVer -&gt; PkgM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; PkgM SemVer
forall (m :: * -&gt; *). MonadPkgRegistry m =&gt; Text -&gt; m SemVer
</span><a href="Futhark.Pkg.Info.html#lookupNewestRev"><span class="hs-identifier hs-var">lookupNewestRev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572919"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>    </span><span class="annot"><span class="annottext">[FilePath]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (IO ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-285"></span><span>    </span><span id="local-6989586621684572920"><span class="annot"><span class="annottext">doAdd' :: Text -&gt; SemVer -&gt; PkgM ()
</span><a href="#local-6989586621684572920"><span class="hs-identifier hs-var hs-var">doAdd'</span></a></span></span><span> </span><span id="local-6989586621684572879"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572879"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621684572878"><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684572878"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-286"></span><span>      </span><span id="local-6989586621684572877"><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572877"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PkgM PkgManifest
</span><a href="Futhark.CLI.Pkg.html#getPkgManifest"><span class="hs-identifier hs-var">getPkgManifest</span></a></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span>      </span><span class="hs-comment">-- See if this package (and its dependencies) even exists.  We</span><span>
</span><span id="line-289"></span><span>      </span><span class="hs-comment">-- do this by running the solver with the dependencies already</span><span>
</span><span id="line-290"></span><span>      </span><span class="hs-comment">-- in the manifest, plus this new one.  The Monoid instance for</span><span>
</span><span id="line-291"></span><span>      </span><span class="hs-comment">-- PkgRevDeps is left-biased, so we are careful to use the new</span><span>
</span><span id="line-292"></span><span>      </span><span class="hs-comment">-- version for this package.</span><span>
</span><span id="line-293"></span><span>      </span><span class="annot"><span class="annottext">BuildList
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PkgRevDeps -&gt; PkgM BuildList
forall (m :: * -&gt; *).
MonadPkgRegistry m =&gt;
PkgRevDeps -&gt; m BuildList
</span><a href="Futhark.Pkg.Solve.html#solveDeps"><span class="hs-identifier hs-var">solveDeps</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgRevDeps -&gt; PkgM BuildList) -&gt; PkgRevDeps -&gt; PkgM BuildList
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Text (SemVer, Maybe Text) -&gt; PkgRevDeps
</span><a href="Futhark.Pkg.Types.html#PkgRevDeps"><span class="hs-identifier hs-var">PkgRevDeps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; (SemVer, Maybe Text) -&gt; Map Text (SemVer, Maybe Text)
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572879"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684572878"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PkgRevDeps -&gt; PkgRevDeps -&gt; PkgRevDeps
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">PkgManifest -&gt; PkgRevDeps
</span><a href="Futhark.Pkg.Types.html#pkgRevDeps"><span class="hs-identifier hs-var">pkgRevDeps</span></a></span><span> </span><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572877"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span>      </span><span class="hs-comment">-- We either replace any existing occurence of package 'p', or</span><span>
</span><span id="line-296"></span><span>      </span><span class="hs-comment">-- we add a new one.</span><span>
</span><span id="line-297"></span><span>      </span><span id="local-6989586621684572874"><span class="annot"><span class="annottext">PkgRevInfo PkgM
</span><a href="#local-6989586621684572874"><span class="hs-identifier hs-var">p_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SemVer -&gt; PkgM (PkgRevInfo PkgM)
forall (m :: * -&gt; *).
MonadPkgRegistry m =&gt;
Text -&gt; SemVer -&gt; m (PkgRevInfo m)
</span><a href="Futhark.Pkg.Info.html#lookupPackageRev"><span class="hs-identifier hs-var">lookupPackageRev</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572879"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684572878"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-298"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684572865"><span class="annot"><span class="annottext">hash :: Maybe Text
</span><a href="#local-6989586621684572865"><span class="hs-identifier hs-var hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SemVer -&gt; Word
</span><span class="hs-identifier hs-var hs-var">_svMajor</span></span><span> </span><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684572878"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SemVer -&gt; Word
</span><span class="hs-identifier hs-var hs-var">_svMinor</span></span><span> </span><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684572878"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SemVer -&gt; Word
</span><span class="hs-identifier hs-var hs-var">_svPatch</span></span><span> </span><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684572878"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-299"></span><span>            </span><span class="hs-comment">-- We do not perform hash-pinning for</span><span>
</span><span id="line-300"></span><span>            </span><span class="hs-comment">-- (0,0,0)-versions, because these already embed a</span><span>
</span><span id="line-301"></span><span>            </span><span class="hs-comment">-- specific revision ID into their version number.</span><span>
</span><span id="line-302"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-303"></span><span>            </span><span class="annot"><span class="annottext">(Word, Word, Word)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe Text) -&gt; Text -&gt; Maybe Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PkgRevInfo PkgM -&gt; Text
forall (m :: * -&gt; *). PkgRevInfo m -&gt; Text
</span><a href="Futhark.Pkg.Info.html#pkgRevCommit"><span class="hs-identifier hs-var hs-var">pkgRevCommit</span></a></span><span> </span><span class="annot"><span class="annottext">PkgRevInfo PkgM
</span><a href="#local-6989586621684572874"><span class="hs-identifier hs-var">p_info</span></a></span><span>
</span><span id="line-304"></span><span>          </span><span id="local-6989586621684572860"><span class="annot"><span class="annottext">req :: Required
</span><a href="#local-6989586621684572860"><span class="hs-identifier hs-var hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SemVer -&gt; Maybe Text -&gt; Required
</span><a href="Futhark.Pkg.Types.html#Required"><span class="hs-identifier hs-var">Required</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572879"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684572878"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621684572865"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-305"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621684572858"><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572858"><span class="hs-identifier hs-var">m'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684572857"><span class="annot"><span class="annottext">Maybe Required
</span><a href="#local-6989586621684572857"><span class="hs-identifier hs-var">prev_r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Required -&gt; PkgManifest -&gt; (PkgManifest, Maybe Required)
</span><a href="Futhark.Pkg.Types.html#addRequiredToManifest"><span class="hs-identifier hs-var">addRequiredToManifest</span></a></span><span> </span><span class="annot"><span class="annottext">Required
</span><a href="#local-6989586621684572860"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572877"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Required
</span><a href="#local-6989586621684572857"><span class="hs-identifier hs-var">prev_r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-308"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684572855"><span class="annot"><span class="annottext">Required
</span><a href="#local-6989586621684572855"><span class="hs-identifier hs-var">prev_r'</span></a></span></span><span>
</span><span id="line-309"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Required -&gt; SemVer
</span><a href="Futhark.Pkg.Types.html#requiredPkgRev"><span class="hs-identifier hs-var hs-var">requiredPkgRev</span></a></span><span> </span><span class="annot"><span class="annottext">Required
</span><a href="#local-6989586621684572855"><span class="hs-identifier hs-var">prev_r'</span></a></span><span> </span><span class="annot"><span class="annottext">SemVer -&gt; SemVer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684572878"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-310"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Package already at version &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SemVer -&gt; Text
</span><span class="hs-identifier hs-var">prettySemVer</span></span><span> </span><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684572878"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;; nothing to do.&quot;</span></span><span>
</span><span id="line-311"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-312"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-313"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-314"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Replaced &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572879"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-315"></span><span>                  </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SemVer -&gt; Text
</span><span class="hs-identifier hs-var">prettySemVer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Required -&gt; SemVer
</span><a href="Futhark.Pkg.Types.html#requiredPkgRev"><span class="hs-identifier hs-var hs-var">requiredPkgRev</span></a></span><span> </span><span class="annot"><span class="annottext">Required
</span><a href="#local-6989586621684572855"><span class="hs-identifier hs-var">prev_r'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>                  </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; =&gt; &quot;</span></span><span>
</span><span id="line-317"></span><span>                  </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SemVer -&gt; Text
</span><span class="hs-identifier hs-var">prettySemVer</span></span><span> </span><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684572878"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-318"></span><span>                  </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-319"></span><span>        </span><span class="annot"><span class="annottext">Maybe Required
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-320"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Added new required package &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572879"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SemVer -&gt; Text
</span><span class="hs-identifier hs-var">prettySemVer</span></span><span> </span><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684572878"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-321"></span><span>      </span><span class="annot"><span class="annottext">PkgManifest -&gt; PkgM ()
</span><a href="Futhark.CLI.Pkg.html#putPkgManifest"><span class="hs-identifier hs-var">putPkgManifest</span></a></span><span> </span><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572858"><span class="hs-identifier hs-var">m'</span></a></span><span>
</span><span id="line-322"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Remember to run 'futhark pkg sync'.&quot;</span></span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span class="annot"><a href="Futhark.CLI.Pkg.html#doRemove"><span class="hs-identifier hs-type">doRemove</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span id="doRemove"><span class="annot"><span class="annottext">doRemove :: FilePath -&gt; [FilePath] -&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#doRemove"><span class="hs-identifier hs-var hs-var">doRemove</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
-&gt; ([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#cmdMain"><span class="hs-identifier hs-var">cmdMain</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;PKGPATH&quot;</span></span><span> </span><span class="annot"><span class="annottext">(([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
 -&gt; FilePath -&gt; [FilePath] -&gt; IO ())
-&gt; ([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684572852"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572852"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621684572851"><span class="annot"><span class="annottext">PkgConfig
</span><a href="#local-6989586621684572851"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572852"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-327"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621684572850"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572850"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Maybe (IO ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Maybe (IO ())) -&gt; IO () -&gt; Maybe (IO ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PkgConfig -&gt; PkgM () -&gt; IO ()
forall a. PkgConfig -&gt; PkgM a -&gt; IO a
</span><a href="Futhark.CLI.Pkg.html#runPkgM"><span class="hs-identifier hs-var">runPkgM</span></a></span><span> </span><span class="annot"><span class="annottext">PkgConfig
</span><a href="#local-6989586621684572851"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgM () -&gt; IO ()) -&gt; PkgM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; PkgM ()
</span><a href="#local-6989586621684572849"><span class="hs-identifier hs-var">doRemove'</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; PkgM ()) -&gt; Text -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572850"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-328"></span><span>    </span><span class="annot"><span class="annottext">[FilePath]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (IO ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-329"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-330"></span><span>    </span><span id="local-6989586621684572849"><span class="annot"><span class="annottext">doRemove' :: Text -&gt; PkgM ()
</span><a href="#local-6989586621684572849"><span class="hs-identifier hs-var hs-var">doRemove'</span></a></span></span><span> </span><span id="local-6989586621684572829"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572829"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-331"></span><span>      </span><span id="local-6989586621684572828"><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572828"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PkgM PkgManifest
</span><a href="Futhark.CLI.Pkg.html#getPkgManifest"><span class="hs-identifier hs-var">getPkgManifest</span></a></span><span>
</span><span id="line-332"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PkgManifest -&gt; Maybe (PkgManifest, Required)
</span><a href="Futhark.Pkg.Types.html#removeRequiredFromManifest"><span class="hs-identifier hs-var">removeRequiredFromManifest</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572829"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572828"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-333"></span><span>        </span><span class="annot"><span class="annottext">Maybe (PkgManifest, Required)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-334"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;No package &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572829"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; found in &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.Pkg.Types.html#futharkPkg"><span class="hs-identifier hs-var">futharkPkg</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-335"></span><span>          </span><span class="annot"><span class="annottext">IO ()
forall a. IO a
</span><span class="hs-identifier hs-var">exitFailure</span></span><span>
</span><span id="line-336"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684572826"><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572826"><span class="hs-identifier hs-var">m'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684572825"><span class="annot"><span class="annottext">Required
</span><a href="#local-6989586621684572825"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-337"></span><span>          </span><span class="annot"><span class="annottext">PkgManifest -&gt; PkgM ()
</span><a href="Futhark.CLI.Pkg.html#putPkgManifest"><span class="hs-identifier hs-var">putPkgManifest</span></a></span><span> </span><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572826"><span class="hs-identifier hs-var">m'</span></a></span><span>
</span><span id="line-338"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Removed &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572829"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SemVer -&gt; Text
</span><span class="hs-identifier hs-var">prettySemVer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Required -&gt; SemVer
</span><a href="Futhark.Pkg.Types.html#requiredPkgRev"><span class="hs-identifier hs-var hs-var">requiredPkgRev</span></a></span><span> </span><span class="annot"><span class="annottext">Required
</span><a href="#local-6989586621684572825"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span class="annot"><a href="Futhark.CLI.Pkg.html#doInit"><span class="hs-identifier hs-type">doInit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span id="doInit"><span class="annot"><span class="annottext">doInit :: FilePath -&gt; [FilePath] -&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#doInit"><span class="hs-identifier hs-var hs-var">doInit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
-&gt; ([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#cmdMain"><span class="hs-identifier hs-var">cmdMain</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;PKGPATH&quot;</span></span><span> </span><span class="annot"><span class="annottext">(([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
 -&gt; FilePath -&gt; [FilePath] -&gt; IO ())
-&gt; ([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684572823"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572823"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621684572822"><span class="annot"><span class="annottext">PkgConfig
</span><a href="#local-6989586621684572822"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-342"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572823"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621684572821"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572821"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Maybe (IO ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Maybe (IO ())) -&gt; IO () -&gt; Maybe (IO ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PkgConfig -&gt; PkgM () -&gt; IO ()
forall a. PkgConfig -&gt; PkgM a -&gt; IO a
</span><a href="Futhark.CLI.Pkg.html#runPkgM"><span class="hs-identifier hs-var">runPkgM</span></a></span><span> </span><span class="annot"><span class="annottext">PkgConfig
</span><a href="#local-6989586621684572822"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgM () -&gt; IO ()) -&gt; PkgM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; PkgM ()
</span><a href="#local-6989586621684572820"><span class="hs-identifier hs-var">doCreate'</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; PkgM ()) -&gt; Text -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572821"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-344"></span><span>    </span><span class="annot"><span class="annottext">[FilePath]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (IO ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-346"></span><span>    </span><span id="local-6989586621684572812"><span class="annot"><span class="annottext">validPkgPath :: Text -&gt; Bool
</span><a href="#local-6989586621684572812"><span class="hs-identifier hs-var hs-var">validPkgPath</span></a></span></span><span> </span><span id="local-6989586621684572811"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572811"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-347"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Bool) -&gt; [FilePath] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;..&quot;</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([FilePath] -&gt; Bool) -&gt; [FilePath] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath]
</span><span class="hs-identifier hs-var">splitDirectories</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; [FilePath]) -&gt; FilePath -&gt; [FilePath]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572811"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span>    </span><span id="local-6989586621684572820"><span class="annot"><span class="annottext">doCreate' :: Text -&gt; PkgM ()
</span><a href="#local-6989586621684572820"><span class="hs-identifier hs-var hs-var">doCreate'</span></a></span></span><span> </span><span id="local-6989586621684572775"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572775"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-350"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; PkgM () -&gt; PkgM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><a href="#local-6989586621684572812"><span class="hs-identifier hs-var">validPkgPath</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572775"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PkgM () -&gt; PkgM ()) -&gt; (IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-351"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Not a valid package path: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572775"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-352"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Note: package paths are usually URIs.&quot;</span></span><span>
</span><span id="line-353"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Note: 'futhark init' is only needed when creating a package, not to use packages.&quot;</span></span><span>
</span><span id="line-354"></span><span>        </span><span class="annot"><span class="annottext">IO ()
forall a. IO a
</span><span class="hs-identifier hs-var">exitFailure</span></span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span>      </span><span id="local-6989586621684572774"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684572774"><span class="hs-identifier hs-var">exists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; PkgM Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; PkgM Bool) -&gt; IO Bool -&gt; PkgM Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">(||)</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool -&gt; Bool) -&gt; IO Bool -&gt; IO (Bool -&gt; Bool)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesFileExist</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.Pkg.Types.html#futharkPkg"><span class="hs-identifier hs-var">futharkPkg</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Bool -&gt; Bool) -&gt; IO Bool -&gt; IO Bool
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesDirectoryExist</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.Pkg.Types.html#futharkPkg"><span class="hs-identifier hs-var">futharkPkg</span></a></span><span>
</span><span id="line-357"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; PkgM () -&gt; PkgM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684572774"><span class="hs-identifier hs-var">exists</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgM () -&gt; PkgM ()) -&gt; PkgM () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-358"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-359"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.Pkg.Types.html#futharkPkg"><span class="hs-identifier hs-var">futharkPkg</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; already exists.&quot;</span></span><span>
</span><span id="line-360"></span><span>          </span><span class="annot"><span class="annottext">IO ()
forall a. IO a
</span><span class="hs-identifier hs-var">exitFailure</span></span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">createDirectoryIfMissing</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO ()) -&gt; FilePath -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;lib&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572775"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-363"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Created directory &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;lib&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572775"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span>      </span><span class="annot"><span class="annottext">PkgManifest -&gt; PkgM ()
</span><a href="Futhark.CLI.Pkg.html#putPkgManifest"><span class="hs-identifier hs-var">putPkgManifest</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgManifest -&gt; PkgM ()) -&gt; PkgManifest -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; PkgManifest
</span><a href="Futhark.Pkg.Types.html#newPkgManifest"><span class="hs-identifier hs-var">newPkgManifest</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; PkgManifest) -&gt; Maybe Text -&gt; PkgManifest
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572775"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-366"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Wrote &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="Futhark.Pkg.Types.html#futharkPkg"><span class="hs-identifier hs-var">futharkPkg</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span class="annot"><a href="Futhark.CLI.Pkg.html#doUpgrade"><span class="hs-identifier hs-type">doUpgrade</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span id="doUpgrade"><span class="annot"><span class="annottext">doUpgrade :: FilePath -&gt; [FilePath] -&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#doUpgrade"><span class="hs-identifier hs-var hs-var">doUpgrade</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
-&gt; ([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#cmdMain"><span class="hs-identifier hs-var">cmdMain</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">(([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
 -&gt; FilePath -&gt; [FilePath] -&gt; IO ())
-&gt; ([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684572772"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572772"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621684572771"><span class="annot"><span class="annottext">PkgConfig
</span><a href="#local-6989586621684572771"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-370"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572772"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-371"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Maybe (IO ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Maybe (IO ())) -&gt; IO () -&gt; Maybe (IO ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-372"></span><span>      </span><span class="annot"><span class="annottext">PkgConfig -&gt; PkgM () -&gt; IO ()
forall a. PkgConfig -&gt; PkgM a -&gt; IO a
</span><a href="Futhark.CLI.Pkg.html#runPkgM"><span class="hs-identifier hs-var">runPkgM</span></a></span><span> </span><span class="annot"><span class="annottext">PkgConfig
</span><a href="#local-6989586621684572771"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgM () -&gt; IO ()) -&gt; PkgM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-373"></span><span>        </span><span id="local-6989586621684572770"><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572770"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PkgM PkgManifest
</span><a href="Futhark.CLI.Pkg.html#getPkgManifest"><span class="hs-identifier hs-var">getPkgManifest</span></a></span><span>
</span><span id="line-374"></span><span>        </span><span id="local-6989586621684572769"><span class="annot"><span class="annottext">Commented [Either Text Required]
</span><a href="#local-6989586621684572769"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([Either Text Required] -&gt; PkgM [Either Text Required])
-&gt; Commented [Either Text Required]
-&gt; PkgM (Commented [Either Text Required])
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either Text Required -&gt; PkgM (Either Text Required))
-&gt; [Either Text Required] -&gt; PkgM [Either Text Required]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Required -&gt; PkgM Required)
-&gt; Either Text Required -&gt; PkgM (Either Text Required)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">Required -&gt; PkgM Required
forall {m :: * -&gt; *}. MonadPkgRegistry m =&gt; Required -&gt; m Required
</span><a href="#local-6989586621684572767"><span class="hs-identifier hs-var">upgrade</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Commented [Either Text Required]
 -&gt; PkgM (Commented [Either Text Required]))
-&gt; Commented [Either Text Required]
-&gt; PkgM (Commented [Either Text Required])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PkgManifest -&gt; Commented [Either Text Required]
</span><a href="Futhark.Pkg.Types.html#manifestRequire"><span class="hs-identifier hs-var hs-var">manifestRequire</span></a></span><span> </span><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572770"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-375"></span><span>        </span><span class="annot"><span class="annottext">PkgManifest -&gt; PkgM ()
</span><a href="Futhark.CLI.Pkg.html#putPkgManifest"><span class="hs-identifier hs-var">putPkgManifest</span></a></span><span> </span><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572770"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">manifestRequire :: Commented [Either Text Required]
</span><a href="Futhark.Pkg.Types.html#manifestRequire"><span class="hs-identifier hs-var">manifestRequire</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Commented [Either Text Required]
</span><a href="#local-6989586621684572769"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-376"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Commented [Either Text Required]
</span><a href="#local-6989586621684572769"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">Commented [Either Text Required]
-&gt; Commented [Either Text Required] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PkgManifest -&gt; Commented [Either Text Required]
</span><a href="Futhark.Pkg.Types.html#manifestRequire"><span class="hs-identifier hs-var hs-var">manifestRequire</span></a></span><span> </span><span class="annot"><span class="annottext">PkgManifest
</span><a href="#local-6989586621684572770"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-377"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Nothing to upgrade.&quot;</span></span><span>
</span><span id="line-378"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; IO () -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Remember to run 'futhark pkg sync'.&quot;</span></span><span>
</span><span id="line-379"></span><span>    </span><span class="annot"><span class="annottext">[FilePath]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (IO ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-381"></span><span>    </span><span id="local-6989586621684572767"><span class="annot"><span class="annottext">upgrade :: Required -&gt; m Required
</span><a href="#local-6989586621684572767"><span class="hs-identifier hs-var hs-var">upgrade</span></a></span></span><span> </span><span id="local-6989586621684572736"><span class="annot"><span class="annottext">Required
</span><a href="#local-6989586621684572736"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-382"></span><span>      </span><span id="local-6989586621684572735"><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684572735"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; m SemVer
forall (m :: * -&gt; *). MonadPkgRegistry m =&gt; Text -&gt; m SemVer
</span><a href="Futhark.Pkg.Info.html#lookupNewestRev"><span class="hs-identifier hs-var">lookupNewestRev</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m SemVer) -&gt; Text -&gt; m SemVer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Required -&gt; Text
</span><a href="Futhark.Pkg.Types.html#requiredPkg"><span class="hs-identifier hs-var hs-var">requiredPkg</span></a></span><span> </span><span class="annot"><span class="annottext">Required
</span><a href="#local-6989586621684572736"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-383"></span><span>      </span><span id="local-6989586621684572733"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572733"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PkgRevInfo m -&gt; Text
forall (m :: * -&gt; *). PkgRevInfo m -&gt; Text
</span><a href="Futhark.Pkg.Info.html#pkgRevCommit"><span class="hs-identifier hs-var hs-var">pkgRevCommit</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgRevInfo m -&gt; Text) -&gt; m (PkgRevInfo m) -&gt; m Text
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SemVer -&gt; m (PkgRevInfo m)
forall (m :: * -&gt; *).
MonadPkgRegistry m =&gt;
Text -&gt; SemVer -&gt; m (PkgRevInfo m)
</span><a href="Futhark.Pkg.Info.html#lookupPackageRev"><span class="hs-identifier hs-var">lookupPackageRev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Required -&gt; Text
</span><a href="Futhark.Pkg.Types.html#requiredPkg"><span class="hs-identifier hs-var hs-var">requiredPkg</span></a></span><span> </span><span class="annot"><span class="annottext">Required
</span><a href="#local-6989586621684572736"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684572735"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684572735"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SemVer -&gt; SemVer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Required -&gt; SemVer
</span><a href="Futhark.Pkg.Types.html#requiredPkgRev"><span class="hs-identifier hs-var hs-var">requiredPkgRev</span></a></span><span> </span><span class="annot"><span class="annottext">Required
</span><a href="#local-6989586621684572736"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-386"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-387"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-388"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Upgraded &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Required -&gt; Text
</span><a href="Futhark.Pkg.Types.html#requiredPkg"><span class="hs-identifier hs-var hs-var">requiredPkg</span></a></span><span> </span><span class="annot"><span class="annottext">Required
</span><a href="#local-6989586621684572736"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-389"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SemVer -&gt; Text
</span><span class="hs-identifier hs-var">prettySemVer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Required -&gt; SemVer
</span><a href="Futhark.Pkg.Types.html#requiredPkgRev"><span class="hs-identifier hs-var hs-var">requiredPkgRev</span></a></span><span> </span><span class="annot"><span class="annottext">Required
</span><a href="#local-6989586621684572736"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; =&gt; &quot;</span></span><span>
</span><span id="line-391"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SemVer -&gt; Text
</span><span class="hs-identifier hs-var">prettySemVer</span></span><span> </span><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684572735"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-392"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span>      </span><span class="annot"><span class="annottext">Required -&gt; m Required
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-395"></span><span>        </span><span class="annot"><span class="annottext">Required
</span><a href="#local-6989586621684572736"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-396"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">requiredPkgRev :: SemVer
</span><a href="Futhark.Pkg.Types.html#requiredPkgRev"><span class="hs-identifier hs-var">requiredPkgRev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SemVer
</span><a href="#local-6989586621684572735"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-397"></span><span>            </span><span class="annot"><span class="annottext">requiredHash :: Maybe Text
</span><a href="Futhark.Pkg.Types.html#requiredHash"><span class="hs-identifier hs-var">requiredHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572733"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-398"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span class="annot"><a href="Futhark.CLI.Pkg.html#doVersions"><span class="hs-identifier hs-type">doVersions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span id="doVersions"><span class="annot"><span class="annottext">doVersions :: FilePath -&gt; [FilePath] -&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#doVersions"><span class="hs-identifier hs-var hs-var">doVersions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
-&gt; ([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#cmdMain"><span class="hs-identifier hs-var">cmdMain</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;PKGPATH&quot;</span></span><span> </span><span class="annot"><span class="annottext">(([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
 -&gt; FilePath -&gt; [FilePath] -&gt; IO ())
-&gt; ([FilePath] -&gt; PkgConfig -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684572729"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572729"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621684572728"><span class="annot"><span class="annottext">PkgConfig
</span><a href="#local-6989586621684572728"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-402"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572729"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-403"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621684572727"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572727"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Maybe (IO ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Maybe (IO ())) -&gt; IO () -&gt; Maybe (IO ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PkgConfig -&gt; PkgM () -&gt; IO ()
forall a. PkgConfig -&gt; PkgM a -&gt; IO a
</span><a href="Futhark.CLI.Pkg.html#runPkgM"><span class="hs-identifier hs-var">runPkgM</span></a></span><span> </span><span class="annot"><span class="annottext">PkgConfig
</span><a href="#local-6989586621684572728"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgM () -&gt; IO ()) -&gt; PkgM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; PkgM ()
</span><a href="#local-6989586621684572726"><span class="hs-identifier hs-var">doVersions'</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; PkgM ()) -&gt; Text -&gt; PkgM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572727"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-404"></span><span>    </span><span class="annot"><span class="annottext">[FilePath]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (IO ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-405"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-406"></span><span>    </span><span id="local-6989586621684572726"><span class="annot"><span class="annottext">doVersions' :: Text -&gt; PkgM ()
</span><a href="#local-6989586621684572726"><span class="hs-identifier hs-var hs-var">doVersions'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-407"></span><span>      </span><span class="annot"><span class="annottext">(SemVer -&gt; PkgM ()) -&gt; [SemVer] -&gt; PkgM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; PkgM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PkgM ()) -&gt; (SemVer -&gt; IO ()) -&gt; SemVer -&gt; PkgM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; (SemVer -&gt; Text) -&gt; SemVer -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SemVer -&gt; Text
</span><span class="hs-identifier hs-var">prettySemVer</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([SemVer] -&gt; PkgM ())
-&gt; (PkgInfo PkgM -&gt; [SemVer]) -&gt; PkgInfo PkgM -&gt; PkgM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map SemVer (PkgRevInfo PkgM) -&gt; [SemVer]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">M.keys</span></span><span> </span><span class="annot"><span class="annottext">(Map SemVer (PkgRevInfo PkgM) -&gt; [SemVer])
-&gt; (PkgInfo PkgM -&gt; Map SemVer (PkgRevInfo PkgM))
-&gt; PkgInfo PkgM
-&gt; [SemVer]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PkgInfo PkgM -&gt; Map SemVer (PkgRevInfo PkgM)
forall (m :: * -&gt; *). PkgInfo m -&gt; Map SemVer (PkgRevInfo m)
</span><a href="Futhark.Pkg.Info.html#pkgVersions"><span class="hs-identifier hs-var hs-var">pkgVersions</span></a></span><span>
</span><span id="line-408"></span><span>        </span><span class="annot"><span class="annottext">(PkgInfo PkgM -&gt; PkgM ())
-&gt; (Text -&gt; PkgM (PkgInfo PkgM)) -&gt; Text -&gt; PkgM ()
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; PkgM (PkgInfo PkgM)
forall (m :: * -&gt; *). MonadPkgRegistry m =&gt; Text -&gt; m (PkgInfo m)
</span><a href="Futhark.Pkg.Info.html#lookupPackage"><span class="hs-identifier hs-var">lookupPackage</span></a></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span class="hs-comment">-- | Run @futhark pkg@.</span><span>
</span><span id="line-411"></span><span class="annot"><a href="Futhark.CLI.Pkg.html#main"><span class="hs-identifier hs-type">main</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span id="main"><span class="annot"><span class="annottext">main :: FilePath -&gt; [FilePath] -&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#main"><span class="hs-identifier hs-var hs-var">main</span></a></span></span><span> </span><span id="local-6989586621684572715"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572715"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span id="local-6989586621684572714"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572714"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-413"></span><span>  </span><span class="hs-comment">-- Avoid Git asking for credentials.  We prefer failure.</span><span>
</span><span id="line-414"></span><span>  </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">setEnv</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;GIT_TERMINAL_PROMPT&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684572696"><span class="annot"><span class="annottext">commands :: [(FilePath, (FilePath -&gt; [FilePath] -&gt; IO (), Text))]
</span><a href="#local-6989586621684572696"><span class="hs-identifier hs-var hs-var">commands</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-417"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;add&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-418"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#doAdd"><span class="hs-identifier hs-var">doAdd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Add another required package to futhark.pkg.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>          </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-420"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;check&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-421"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#doCheck"><span class="hs-identifier hs-var">doCheck</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Check that futhark.pkg is satisfiable.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>          </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-423"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;init&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-424"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#doInit"><span class="hs-identifier hs-var">doInit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Create a new futhark.pkg and a lib/ skeleton.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>          </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-426"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;fmt&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-427"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#doFmt"><span class="hs-identifier hs-var">doFmt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Reformat futhark.pkg.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>          </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-429"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;sync&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-430"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#doSync"><span class="hs-identifier hs-var">doSync</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Populate lib/ as specified by futhark.pkg.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>          </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-432"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;remove&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-433"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#doRemove"><span class="hs-identifier hs-var">doRemove</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Remove a required package from futhark.pkg.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>          </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-435"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;upgrade&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-436"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#doUpgrade"><span class="hs-identifier hs-var">doUpgrade</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Upgrade all packages to newest versions.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-437"></span><span>          </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-438"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;versions&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-439"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; IO ()
</span><a href="Futhark.CLI.Pkg.html#doVersions"><span class="hs-identifier hs-var">doVersions</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;List available versions for a package.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-442"></span><span>      </span><span id="local-6989586621684572688"><span class="annot"><span class="annottext">usage :: FilePath
</span><a href="#local-6989586621684572688"><span class="hs-identifier hs-var hs-var">usage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;options... &lt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; FilePath
forall a. [a] -&gt; [[a]] -&gt; [a]
</span><span class="hs-identifier hs-var">intercalate</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;|&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((FilePath, (FilePath -&gt; [FilePath] -&gt; IO (), Text)) -&gt; FilePath)
-&gt; [(FilePath, (FilePath -&gt; [FilePath] -&gt; IO (), Text))]
-&gt; [FilePath]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(FilePath, (FilePath -&gt; [FilePath] -&gt; IO (), Text)) -&gt; FilePath
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(FilePath, (FilePath -&gt; [FilePath] -&gt; IO (), Text))]
</span><a href="#local-6989586621684572696"><span class="hs-identifier hs-var">commands</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;&gt;&quot;</span></span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572714"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-444"></span><span>    </span><span id="local-6989586621684572687"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572687"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684572686"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572686"><span class="hs-identifier hs-var">args'</span></a></span></span><span>
</span><span id="line-445"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684572685"><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; IO ()
</span><a href="#local-6989586621684572685"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath
-&gt; [(FilePath, (FilePath -&gt; [FilePath] -&gt; IO (), Text))]
-&gt; Maybe (FilePath -&gt; [FilePath] -&gt; IO (), Text)
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572687"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">[(FilePath, (FilePath -&gt; [FilePath] -&gt; IO (), Text))]
</span><a href="#local-6989586621684572696"><span class="hs-identifier hs-var">commands</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-446"></span><span>        </span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; IO ()
</span><a href="#local-6989586621684572685"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FilePath] -&gt; FilePath
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572715"><span class="hs-identifier hs-var">prog</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572687"><span class="hs-identifier hs-var">cmd</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572686"><span class="hs-identifier hs-var">args'</span></a></span><span>
</span><span id="line-447"></span><span>    </span><span class="annot"><span class="annottext">[FilePath]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-448"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684572672"><span class="annot"><span class="annottext">bad :: p -&gt; () -&gt; Maybe (IO b)
</span><a href="#local-6989586621684572672"><span class="hs-identifier hs-var hs-var">bad</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO b -&gt; Maybe (IO b)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(IO b -&gt; Maybe (IO b)) -&gt; IO b -&gt; Maybe (IO b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-449"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684572664"><span class="annot"><span class="annottext">k :: Int
</span><a href="#local-6989586621684572664"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a (f :: * -&gt; *). (Num a, Ord a, Foldable f) =&gt; f a -&gt; a
</span><a href="Futhark.Util.html#maxinum"><span class="hs-identifier hs-var">maxinum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((FilePath, (FilePath -&gt; [FilePath] -&gt; IO (), Text)) -&gt; Int)
-&gt; [(FilePath, (FilePath -&gt; [FilePath] -&gt; IO (), Text))] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Int)
-&gt; ((FilePath, (FilePath -&gt; [FilePath] -&gt; IO (), Text))
    -&gt; FilePath)
-&gt; (FilePath, (FilePath -&gt; [FilePath] -&gt; IO (), Text))
-&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(FilePath, (FilePath -&gt; [FilePath] -&gt; IO (), Text)) -&gt; FilePath
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(FilePath, (FilePath -&gt; [FilePath] -&gt; IO (), Text))]
</span><a href="#local-6989586621684572696"><span class="hs-identifier hs-var">commands</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span>
</span><span id="line-450"></span><span>            </span><span class="annot"><span class="annottext">Text -&gt; IO b
forall {b}. Text -&gt; IO b
</span><a href="#local-6989586621684572661"><span class="hs-identifier hs-var">usageMsg</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO b) -&gt; Text -&gt; IO b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-451"></span><span>              </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.unlines</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-452"></span><span>                </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&lt;command&gt; ...:&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Commands:&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-453"></span><span>                  </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; [Text]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;   &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572659"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Char -&gt; FilePath
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684572664"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572659"><span class="hs-identifier hs-var">cmd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572657"><span class="hs-identifier hs-var">desc</span></a></span><span>
</span><span id="line-454"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684572659"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572659"><span class="hs-identifier hs-var">cmd</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; IO ()
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684572657"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572657"><span class="hs-identifier hs-var">desc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(FilePath, (FilePath -&gt; [FilePath] -&gt; IO (), Text))]
</span><a href="#local-6989586621684572696"><span class="hs-identifier hs-var">commands</span></a></span><span>
</span><span id="line-455"></span><span>                     </span><span class="hs-special">]</span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span>      </span><span class="annot"><span class="annottext">()
-&gt; [FunOptDescr ()]
-&gt; FilePath
-&gt; ([FilePath] -&gt; () -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
forall cfg.
cfg
-&gt; [FunOptDescr cfg]
-&gt; FilePath
-&gt; ([FilePath] -&gt; cfg -&gt; Maybe (IO ()))
-&gt; FilePath
-&gt; [FilePath]
-&gt; IO ()
</span><a href="Futhark.Util.Options.html#mainWithOptions"><span class="hs-identifier hs-var">mainWithOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572688"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; () -&gt; Maybe (IO ())
forall {p} {b}. p -&gt; () -&gt; Maybe (IO b)
</span><a href="#local-6989586621684572672"><span class="hs-identifier hs-var">bad</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572715"><span class="hs-identifier hs-var">prog</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621684572714"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-458"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-459"></span><span>    </span><span id="local-6989586621684572661"><span class="annot"><span class="annottext">usageMsg :: Text -&gt; IO b
</span><a href="#local-6989586621684572661"><span class="hs-identifier hs-var hs-var">usageMsg</span></a></span></span><span> </span><span id="local-6989586621684572650"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572650"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-460"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Usage: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621684572715"><span class="hs-identifier hs-var">prog</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; [--version] [--help] &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684572650"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-461"></span><span>      </span><span class="annot"><span class="annottext">IO b
forall a. IO a
</span><span class="hs-identifier hs-var">exitFailure</span></span><span>
</span><span id="line-462"></span></pre></body></html>