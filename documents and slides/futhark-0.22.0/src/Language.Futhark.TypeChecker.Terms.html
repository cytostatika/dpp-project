<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveFunctor #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">-- | Facilities for type-checking Futhark terms.  Checking a term</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- requires a little more context to track uniqueness and such.</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Type inference is implemented through a variation of</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- Hindley-Milner.  The main complication is supporting the rich</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- number of built-in language constructs, as well as uniqueness</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- types.  This is mostly done in an ad hoc way, and many programs</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- will require the programmer to fall back on type annotations.</span><span>
</span><span id="line-15"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.Futhark.TypeChecker.Terms</span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkOneExp"><span class="hs-identifier">checkOneExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkFunDef"><span class="hs-identifier">checkFunDef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">where</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">find</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">foldl'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">partition</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html"><span class="hs-identifier">Futhark.IR.Primitive</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#intByteSize"><span class="hs-identifier">intByteSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Util.Pretty.html"><span class="hs-identifier">Futhark.Util.Pretty</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">group</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">space</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.html"><span class="hs-identifier">Language.Futhark</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.Traversals.html"><span class="hs-identifier">Language.Futhark.Traversals</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Match.html"><span class="hs-identifier">Language.Futhark.TypeChecker.Match</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html"><span class="hs-identifier">Language.Futhark.TypeChecker.Monad</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Semantic.html#BoundV"><span class="hs-identifier">BoundV</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.DoLoop.html"><span class="hs-identifier">Language.Futhark.TypeChecker.Terms.DoLoop</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html"><span class="hs-identifier">Language.Futhark.TypeChecker.Terms.Monad</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html"><span class="hs-identifier">Language.Futhark.TypeChecker.Terms.Pat</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Types.html"><span class="hs-identifier">Language.Futhark.TypeChecker.Types</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html"><span class="hs-identifier">Language.Futhark.TypeChecker.Unify</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#Usage"><span class="hs-identifier">Usage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mod</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#overloadedTypeVars"><span class="hs-identifier hs-type">overloadedTypeVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#Constraints"><span class="hs-identifier hs-type">Constraints</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Names"><span class="hs-identifier hs-type">Names</span></a></span><span>
</span><span id="line-44"></span><span id="overloadedTypeVars"><span class="annot"><span class="annottext">overloadedTypeVars :: Constraints -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#overloadedTypeVars"><span class="hs-identifier hs-var hs-var">overloadedTypeVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Set VName] -&gt; Set VName
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Set VName] -&gt; Set VName)
-&gt; (Constraints -&gt; [Set VName]) -&gt; Constraints -&gt; Set VName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Int, Constraint) -&gt; Set VName)
-&gt; [(Int, Constraint)] -&gt; [Set VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Int, Constraint) -&gt; Set VName
forall {a}. (a, Constraint) -&gt; Set VName
</span><a href="#local-6989586621684562579"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">([(Int, Constraint)] -&gt; [Set VName])
-&gt; (Constraints -&gt; [(Int, Constraint)])
-&gt; Constraints
-&gt; [Set VName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Constraints -&gt; [(Int, Constraint)]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-46"></span><span>    </span><span id="local-6989586621684562579"><span class="annot"><span class="annottext">f :: (a, Constraint) -&gt; Set VName
</span><a href="#local-6989586621684562579"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#HasFields"><span class="hs-identifier hs-type">HasFields</span></a></span><span> </span><span id="local-6989586621684562572"><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) ())
</span><a href="#local-6989586621684562572"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Usage
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Set VName] -&gt; Set VName
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Set VName] -&gt; Set VName) -&gt; [Set VName] -&gt; Set VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) () -&gt; Set VName)
-&gt; [TypeBase (DimDecl VName) ()] -&gt; [Set VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; Set VName
forall as dim. Monoid as =&gt; TypeBase dim as -&gt; Set VName
</span><a href="Language.Futhark.Prop.html#typeVars"><span class="hs-identifier hs-var">typeVars</span></a></span><span> </span><span class="annot"><span class="annottext">([TypeBase (DimDecl VName) ()] -&gt; [Set VName])
-&gt; [TypeBase (DimDecl VName) ()] -&gt; [Set VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) ())
-&gt; [TypeBase (DimDecl VName) ()]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) ())
</span><a href="#local-6989586621684562572"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><a href="#local-6989586621684562579"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(a, Constraint)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set VName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">--- Basic checking</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-comment">-- | Determine if the two types are identical, ignoring uniqueness.</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- Mismatched dimensions are turned into fresh rigid type variables.</span><span>
</span><span id="line-53"></span><span class="hs-comment">-- Causes a 'TypeError' if they fail to match, and otherwise returns</span><span>
</span><span id="line-54"></span><span class="hs-comment">-- one of them.</span><span>
</span><span id="line-55"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#unifyBranchTypes"><span class="hs-identifier hs-type">unifyBranchTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span id="unifyBranchTypes"><span class="annot"><span class="annottext">unifyBranchTypes :: SrcLoc
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#unifyBranchTypes"><span class="hs-identifier hs-var hs-var">unifyBranchTypes</span></a></span></span><span> </span><span id="local-6989586621684562568"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562568"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621684562567"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562567"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621684562566"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562566"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><span class="annottext">Checking
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
forall a. Checking -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#onFailure"><span class="hs-identifier hs-var">onFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) () -&gt; Checking
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#CheckingBranches"><span class="hs-identifier hs-var">CheckingBranches</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562567"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562566"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
 -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName]))
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><span class="annottext">Usage
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; m (TypeBase (DimDecl VName) Aliasing, [VName])
</span><a href="Language.Futhark.TypeChecker.Unify.html#unifyMostCommon"><span class="hs-identifier hs-var">unifyMostCommon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; String -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562568"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unification of branch results&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562567"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562566"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#unifyBranches"><span class="hs-identifier hs-type">unifyBranches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span id="unifyBranches"><span class="annot"><span class="annottext">unifyBranches :: SrcLoc
-&gt; Exp
-&gt; Exp
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#unifyBranches"><span class="hs-identifier hs-var hs-var">unifyBranches</span></a></span></span><span> </span><span id="local-6989586621684562559"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562559"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621684562558"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562558"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621684562557"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562557"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-62"></span><span>  </span><span id="local-6989586621684562556"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562556"><span class="hs-identifier hs-var">e1_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562558"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-63"></span><span>  </span><span id="local-6989586621684562554"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562554"><span class="hs-identifier hs-var">e2_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562557"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><span class="annottext">SrcLoc
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#unifyBranchTypes"><span class="hs-identifier hs-var">unifyBranchTypes</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562559"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562556"><span class="hs-identifier hs-var">e1_t</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562554"><span class="hs-identifier hs-var">e2_t</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span id="local-6989586621684564020"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#sliceShape"><span class="hs-identifier hs-type">sliceShape</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-67"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#Rigidity"><span class="hs-identifier hs-type">Rigidity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><a href="Language.Futhark.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#DimDecl"><span class="hs-identifier hs-type">DimDecl</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621684564020"><span class="hs-keyword hs-type">as</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#DimDecl"><span class="hs-identifier hs-type">DimDecl</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621684564020"><span class="hs-keyword hs-type">as</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-71"></span><span id="sliceShape"><span class="annot"><span class="annottext">sliceShape :: forall as.
Maybe (SrcLoc, Rigidity)
-&gt; Slice
-&gt; TypeBase (DimDecl VName) as
-&gt; TermTypeM (TypeBase (DimDecl VName) as, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#sliceShape"><span class="hs-identifier hs-var hs-var">sliceShape</span></a></span></span><span> </span><span id="local-6989586621684562548"><span class="annot"><span class="annottext">Maybe (SrcLoc, Rigidity)
</span><a href="#local-6989586621684562548"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621684562547"><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684562547"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span id="local-6989586621684562546"><span class="annot"><span class="annottext">t :: TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684562546"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span id="local-6989586621684562544"><span class="annot"><span class="annottext">as
</span><a href="#local-6989586621684562544"><span class="hs-identifier hs-var">als</span></a></span></span><span> </span><span id="local-6989586621684562543"><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684562543"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621684562542"><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562542"><span class="hs-identifier hs-var">et</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ShapeDecl"><span class="hs-identifier hs-type">ShapeDecl</span></a></span><span> </span><span id="local-6989586621684562540"><span class="annot"><span class="annottext">[DimDecl VName]
</span><a href="#local-6989586621684562540"><span class="hs-identifier hs-var">orig_dims</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><span class="annottext">StateT [VName] TermTypeM (TypeBase (DimDecl VName) as)
-&gt; [VName] -&gt; TermTypeM (TypeBase (DimDecl VName) as, [VName])
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var hs-var">runStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DimDecl VName] -&gt; TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684562538"><span class="hs-identifier hs-var">setDims</span></a></span><span> </span><span class="annot"><span class="annottext">([DimDecl VName] -&gt; TypeBase (DimDecl VName) as)
-&gt; StateT [VName] TermTypeM [DimDecl VName]
-&gt; StateT [VName] TermTypeM (TypeBase (DimDecl VName) as)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Slice
-&gt; [DimDecl VName] -&gt; StateT [VName] TermTypeM [DimDecl VName]
forall {t :: (* -&gt; *) -&gt; * -&gt; *}.
(MonadTrans t, MonadState [VName] (t TermTypeM)) =&gt;
Slice -&gt; [DimDecl VName] -&gt; t TermTypeM [DimDecl VName]
</span><a href="#local-6989586621684562536"><span class="hs-identifier hs-var">adjustDims</span></a></span><span> </span><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684562547"><span class="hs-identifier hs-var">slice</span></a></span><span> </span><span class="annot"><span class="annottext">[DimDecl VName]
</span><a href="#local-6989586621684562540"><span class="hs-identifier hs-var">orig_dims</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-74"></span><span>    </span><span id="local-6989586621684562538"><span class="annot"><span class="annottext">setDims :: [DimDecl VName] -&gt; TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684562538"><span class="hs-identifier hs-var hs-var">setDims</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TypeBase (DimDecl VName) as -&gt; TypeBase (DimDecl VName) as
forall dim as. Int -&gt; TypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Prop.html#stripArray"><span class="hs-identifier hs-var">stripArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DimDecl VName] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[DimDecl VName]
</span><a href="#local-6989586621684562540"><span class="hs-identifier hs-var">orig_dims</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684562546"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><a href="#local-6989586621684562538"><span class="hs-identifier hs-var">setDims</span></a></span><span> </span><span id="local-6989586621684562532"><span class="annot"><span class="annottext">[DimDecl VName]
</span><a href="#local-6989586621684562532"><span class="hs-identifier hs-var">dims'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">as
-&gt; Uniqueness
-&gt; ScalarTypeBase (DimDecl VName) ()
-&gt; ShapeDecl (DimDecl VName)
-&gt; TypeBase (DimDecl VName) as
forall dim as.
as
-&gt; Uniqueness
-&gt; ScalarTypeBase dim ()
-&gt; ShapeDecl dim
-&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Array"><span class="hs-identifier hs-var">Array</span></a></span><span> </span><span class="annot"><span class="annottext">as
</span><a href="#local-6989586621684562544"><span class="hs-identifier hs-var">als</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684562543"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562542"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="annot"><span class="annottext">(ShapeDecl (DimDecl VName) -&gt; TypeBase (DimDecl VName) as)
-&gt; ShapeDecl (DimDecl VName) -&gt; TypeBase (DimDecl VName) as
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[DimDecl VName] -&gt; ShapeDecl (DimDecl VName)
forall dim. [dim] -&gt; ShapeDecl dim
</span><a href="Language.Futhark.Syntax.html#ShapeDecl"><span class="hs-identifier hs-var">ShapeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">[DimDecl VName]
</span><a href="#local-6989586621684562532"><span class="hs-identifier hs-var">dims'</span></a></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-comment">-- If the result is supposed to be a nonrigid size variable, then</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-comment">-- don't bother trying to create non-existential sizes.  This is</span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-comment">-- necessary to make programs type-check without too much</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-comment">-- ceremony; see e.g. tests/inplace5.fut.</span><span>
</span><span id="line-81"></span><span>    </span><span id="local-6989586621684562531"><span class="annot"><span class="annottext">isRigid :: Rigidity -&gt; Bool
</span><a href="#local-6989586621684562531"><span class="hs-identifier hs-var hs-var">isRigid</span></a></span></span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#Rigid"><span class="hs-identifier hs-type">Rigid</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><a href="#local-6989586621684562531"><span class="hs-identifier hs-var">isRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Rigidity
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-83"></span><span>    </span><span id="local-6989586621684562529"><span class="annot"><span class="annottext">refine_sizes :: Bool
</span><a href="#local-6989586621684562529"><span class="hs-identifier hs-var hs-var">refine_sizes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; ((SrcLoc, Rigidity) -&gt; Bool) -&gt; Maybe (SrcLoc, Rigidity) -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rigidity -&gt; Bool
</span><a href="#local-6989586621684562531"><span class="hs-identifier hs-var">isRigid</span></a></span><span> </span><span class="annot"><span class="annottext">(Rigidity -&gt; Bool)
-&gt; ((SrcLoc, Rigidity) -&gt; Rigidity) -&gt; (SrcLoc, Rigidity) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(SrcLoc, Rigidity) -&gt; Rigidity
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (SrcLoc, Rigidity)
</span><a href="#local-6989586621684562548"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span>    </span><span id="local-6989586621684562499"><span class="annot"><span class="annottext">sliceSize :: DimDecl VName
-&gt; Maybe Exp
-&gt; Maybe Exp
-&gt; Maybe Exp
-&gt; t TermTypeM (DimDecl VName)
</span><a href="#local-6989586621684562499"><span class="hs-identifier hs-var hs-var">sliceSize</span></a></span></span><span> </span><span id="local-6989586621684562498"><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684562498"><span class="hs-identifier hs-var">orig_d</span></a></span></span><span> </span><span id="local-6989586621684562497"><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562497"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621684562496"><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562496"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span id="local-6989586621684562495"><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562495"><span class="hs-identifier hs-var">stride</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-86"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (SrcLoc, Rigidity)
</span><a href="#local-6989586621684562548"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-87"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684562494"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562494"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#Rigid"><span class="hs-identifier hs-type">Rigid</span></a></span><span> </span><span class="annot"><span class="annottext">RigidSource
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-88"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621684562493"><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684562493"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562492"><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684562492"><span class="hs-identifier hs-var">ext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-89"></span><span>            </span><span class="annot"><span class="annottext">TermTypeM (DimDecl VName, Maybe VName)
-&gt; t TermTypeM (DimDecl VName, Maybe VName)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TermTypeM (DimDecl VName, Maybe VName)
 -&gt; t TermTypeM (DimDecl VName, Maybe VName))
-&gt; (SizeSource -&gt; TermTypeM (DimDecl VName, Maybe VName))
-&gt; SizeSource
-&gt; t TermTypeM (DimDecl VName, Maybe VName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; SizeSource -&gt; TermTypeM (DimDecl VName, Maybe VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#extSize"><span class="hs-identifier hs-var">extSize</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562494"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(SizeSource -&gt; t TermTypeM (DimDecl VName, Maybe VName))
-&gt; SizeSource -&gt; t TermTypeM (DimDecl VName, Maybe VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-90"></span><span>              </span><span class="annot"><span class="annottext">Maybe (DimDecl VName)
-&gt; Maybe (ExpBase NoInfo VName)
-&gt; Maybe (ExpBase NoInfo VName)
-&gt; Maybe (ExpBase NoInfo VName)
-&gt; SizeSource
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#SourceSlice"><span class="hs-identifier hs-var">SourceSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (DimDecl VName)
</span><a href="#local-6989586621684562488"><span class="hs-identifier hs-var">orig_d'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; ExpBase NoInfo VName
</span><a href="Language.Futhark.Traversals.html#bareExp"><span class="hs-identifier hs-var">bareExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; ExpBase NoInfo VName)
-&gt; Maybe Exp -&gt; Maybe (ExpBase NoInfo VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562497"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; ExpBase NoInfo VName
</span><a href="Language.Futhark.Traversals.html#bareExp"><span class="hs-identifier hs-var">bareExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; ExpBase NoInfo VName)
-&gt; Maybe Exp -&gt; Maybe (ExpBase NoInfo VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562496"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; ExpBase NoInfo VName
</span><a href="Language.Futhark.Traversals.html#bareExp"><span class="hs-identifier hs-var">bareExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; ExpBase NoInfo VName)
-&gt; Maybe Exp -&gt; Maybe (ExpBase NoInfo VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562495"><span class="hs-identifier hs-var">stride</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>          </span><span class="annot"><span class="annottext">([VName] -&gt; [VName]) -&gt; t TermTypeM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe VName -&gt; [VName]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684562492"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; [VName] -&gt; [VName]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>          </span><span class="annot"><span class="annottext">DimDecl VName -&gt; t TermTypeM (DimDecl VName)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684562493"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-93"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684562484"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562484"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Rigidity
</span><a href="Language.Futhark.TypeChecker.Unify.html#Nonrigid"><span class="hs-identifier hs-var">Nonrigid</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-94"></span><span>          </span><span class="annot"><span class="annottext">TermTypeM (DimDecl VName) -&gt; t TermTypeM (DimDecl VName)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TermTypeM (DimDecl VName) -&gt; t TermTypeM (DimDecl VName))
-&gt; TermTypeM (DimDecl VName) -&gt; t TermTypeM (DimDecl VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; DimDecl VName
forall vn. QualName vn -&gt; DimDecl vn
</span><a href="Language.Futhark.Syntax.html#NamedDim"><span class="hs-identifier hs-var">NamedDim</span></a></span><span> </span><span class="annot"><span class="annottext">(QualName VName -&gt; DimDecl VName)
-&gt; (VName -&gt; QualName VName) -&gt; VName -&gt; DimDecl VName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; DimDecl VName)
-&gt; TermTypeM VName -&gt; TermTypeM (DimDecl VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Rigidity -&gt; Name -&gt; TermTypeM VName
forall (m :: * -&gt; *).
MonadUnify m =&gt;
SrcLoc -&gt; Rigidity -&gt; Name -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Unify.html#newDimVar"><span class="hs-identifier hs-var">newDimVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562484"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Rigidity
</span><a href="Language.Futhark.TypeChecker.Unify.html#Nonrigid"><span class="hs-identifier hs-var">Nonrigid</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;slice_dim&quot;</span></span><span>
</span><span id="line-95"></span><span>        </span><span class="annot"><span class="annottext">Maybe (SrcLoc, Rigidity)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-96"></span><span>          </span><span id="local-6989586621684562479"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562479"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TermTypeM VName -&gt; t TermTypeM VName
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TermTypeM VName -&gt; t TermTypeM VName)
-&gt; TermTypeM VName -&gt; t TermTypeM VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TermTypeM VName
forall (m :: * -&gt; *). MonadTypeChecker m =&gt; Name -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Monad.html#newID"><span class="hs-identifier hs-var">newID</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;slice_anydim&quot;</span></span><span>
</span><span id="line-97"></span><span>          </span><span class="annot"><span class="annottext">([VName] -&gt; [VName]) -&gt; t TermTypeM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562479"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; [VName] -&gt; [VName]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>          </span><span class="annot"><span class="annottext">DimDecl VName -&gt; t TermTypeM (DimDecl VName)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(DimDecl VName -&gt; t TermTypeM (DimDecl VName))
-&gt; DimDecl VName -&gt; t TermTypeM (DimDecl VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; DimDecl VName
forall vn. QualName vn -&gt; DimDecl vn
</span><a href="Language.Futhark.Syntax.html#NamedDim"><span class="hs-identifier hs-var">NamedDim</span></a></span><span> </span><span class="annot"><span class="annottext">(QualName VName -&gt; DimDecl VName)
-&gt; QualName VName -&gt; DimDecl VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562479"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-99"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-100"></span><span>        </span><span class="hs-comment">-- The original size does not matter if the slice is fully specified.</span><span>
</span><span id="line-101"></span><span>        </span><span id="local-6989586621684562488"><span class="annot"><span class="annottext">orig_d' :: Maybe (DimDecl VName)
</span><a href="#local-6989586621684562488"><span class="hs-identifier hs-var hs-var">orig_d'</span></a></span></span><span>
</span><span id="line-102"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe Exp -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562497"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Exp -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562496"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (DimDecl VName)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-103"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DimDecl VName -&gt; Maybe (DimDecl VName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684562498"><span class="hs-identifier hs-var">orig_d</span></a></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span>    </span><span id="local-6989586621684562536"><span class="annot"><span class="annottext">adjustDims :: Slice -&gt; [DimDecl VName] -&gt; t TermTypeM [DimDecl VName]
</span><a href="#local-6989586621684562536"><span class="hs-identifier hs-var hs-var">adjustDims</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#DimFix"><span class="hs-identifier hs-type">DimFix</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684562451"><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684562451"><span class="hs-identifier hs-var">idxes'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DimDecl VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684562450"><span class="annot"><span class="annottext">[DimDecl VName]
</span><a href="#local-6989586621684562450"><span class="hs-identifier hs-var">dims</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-106"></span><span>      </span><span class="annot"><span class="annottext">Slice -&gt; [DimDecl VName] -&gt; t TermTypeM [DimDecl VName]
</span><a href="#local-6989586621684562536"><span class="hs-identifier hs-var">adjustDims</span></a></span><span> </span><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684562451"><span class="hs-identifier hs-var">idxes'</span></a></span><span> </span><span class="annot"><span class="annottext">[DimDecl VName]
</span><a href="#local-6989586621684562450"><span class="hs-identifier hs-var">dims</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-comment">-- Pat match some known slices to be non-existential.</span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><a href="#local-6989586621684562536"><span class="hs-identifier hs-var">adjustDims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#DimSlice"><span class="hs-identifier hs-type">DimSlice</span></a></span><span> </span><span id="local-6989586621684562448"><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562448"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621684562447"><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562447"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span id="local-6989586621684562446"><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562446"><span class="hs-identifier hs-var">stride</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684562445"><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684562445"><span class="hs-identifier hs-var">idxes'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DimDecl VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684562444"><span class="annot"><span class="annottext">[DimDecl VName]
</span><a href="#local-6989586621684562444"><span class="hs-identifier hs-var">dims</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684562529"><span class="hs-identifier hs-var">refine_sizes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; (Exp -&gt; Bool) -&gt; Maybe Exp -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int64 -&gt; Maybe Int64 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Maybe Int64
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Int64 -&gt; Bool) -&gt; (Exp -&gt; Maybe Int64) -&gt; Exp -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Maybe Int64
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#isInt64"><span class="hs-identifier hs-var">isInt64</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562448"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684562442"><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684562442"><span class="hs-identifier hs-var">j'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Maybe (DimDecl VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#maybeDimFromExp"><span class="hs-identifier hs-var">maybeDimFromExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Maybe (DimDecl VName))
-&gt; Maybe Exp -&gt; Maybe (DimDecl VName)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562447"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; (Exp -&gt; Bool) -&gt; Maybe Exp -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int64 -&gt; Maybe Int64 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Maybe Int64
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Int64 -&gt; Bool) -&gt; (Exp -&gt; Maybe Int64) -&gt; Exp -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Maybe Int64
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#isInt64"><span class="hs-identifier hs-var">isInt64</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562446"><span class="hs-identifier hs-var">stride</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-113"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684562442"><span class="hs-identifier hs-var">j'</span></a></span><span> </span><span class="annot"><span class="annottext">DimDecl VName -&gt; [DimDecl VName] -&gt; [DimDecl VName]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([DimDecl VName] -&gt; [DimDecl VName])
-&gt; t TermTypeM [DimDecl VName] -&gt; t TermTypeM [DimDecl VName]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Slice -&gt; [DimDecl VName] -&gt; t TermTypeM [DimDecl VName]
</span><a href="#local-6989586621684562536"><span class="hs-identifier hs-var">adjustDims</span></a></span><span> </span><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684562445"><span class="hs-identifier hs-var">idxes'</span></a></span><span> </span><span class="annot"><span class="annottext">[DimDecl VName]
</span><a href="#local-6989586621684562444"><span class="hs-identifier hs-var">dims</span></a></span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><a href="#local-6989586621684562536"><span class="hs-identifier hs-var">adjustDims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#DimSlice"><span class="hs-identifier hs-type">DimSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Exp
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe Exp
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span id="local-6989586621684562439"><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562439"><span class="hs-identifier hs-var">stride</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684562438"><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684562438"><span class="hs-identifier hs-var">idxes'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684562437"><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684562437"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684562436"><span class="annot"><span class="annottext">[DimDecl VName]
</span><a href="#local-6989586621684562436"><span class="hs-identifier hs-var">dims</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684562529"><span class="hs-identifier hs-var">refine_sizes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; (Exp -&gt; Bool) -&gt; Maybe Exp -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; (Int64 -&gt; Bool) -&gt; Maybe Int64 -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; Int64 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int64 -&gt; Bool) -&gt; (Int64 -&gt; Int64) -&gt; Int64 -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Int64
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Int64 -&gt; Bool) -&gt; (Exp -&gt; Maybe Int64) -&gt; Exp -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Maybe Int64
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#isInt64"><span class="hs-identifier hs-var">isInt64</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562439"><span class="hs-identifier hs-var">stride</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-117"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684562437"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">DimDecl VName -&gt; [DimDecl VName] -&gt; [DimDecl VName]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([DimDecl VName] -&gt; [DimDecl VName])
-&gt; t TermTypeM [DimDecl VName] -&gt; t TermTypeM [DimDecl VName]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Slice -&gt; [DimDecl VName] -&gt; t TermTypeM [DimDecl VName]
</span><a href="#local-6989586621684562536"><span class="hs-identifier hs-var">adjustDims</span></a></span><span> </span><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684562438"><span class="hs-identifier hs-var">idxes'</span></a></span><span> </span><span class="annot"><span class="annottext">[DimDecl VName]
</span><a href="#local-6989586621684562436"><span class="hs-identifier hs-var">dims</span></a></span><span>
</span><span id="line-118"></span><span>    </span><span class="annot"><a href="#local-6989586621684562536"><span class="hs-identifier hs-var">adjustDims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#DimSlice"><span class="hs-identifier hs-type">DimSlice</span></a></span><span> </span><span id="local-6989586621684562434"><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562434"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621684562433"><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562433"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span id="local-6989586621684562432"><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562432"><span class="hs-identifier hs-var">stride</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684562431"><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684562431"><span class="hs-identifier hs-var">idxes'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684562430"><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684562430"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684562429"><span class="annot"><span class="annottext">[DimDecl VName]
</span><a href="#local-6989586621684562429"><span class="hs-identifier hs-var">dims</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-119"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DimDecl VName -&gt; [DimDecl VName] -&gt; [DimDecl VName])
-&gt; t TermTypeM (DimDecl VName)
-&gt; t TermTypeM ([DimDecl VName] -&gt; [DimDecl VName])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">DimDecl VName
-&gt; Maybe Exp
-&gt; Maybe Exp
-&gt; Maybe Exp
-&gt; t TermTypeM (DimDecl VName)
forall {t :: (* -&gt; *) -&gt; * -&gt; *}.
(MonadTrans t, MonadState [VName] (t TermTypeM)) =&gt;
DimDecl VName
-&gt; Maybe Exp
-&gt; Maybe Exp
-&gt; Maybe Exp
-&gt; t TermTypeM (DimDecl VName)
</span><a href="#local-6989586621684562499"><span class="hs-identifier hs-var">sliceSize</span></a></span><span> </span><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684562430"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562434"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562433"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562432"><span class="hs-identifier hs-var">stride</span></a></span><span> </span><span class="annot"><span class="annottext">t TermTypeM ([DimDecl VName] -&gt; [DimDecl VName])
-&gt; t TermTypeM [DimDecl VName] -&gt; t TermTypeM [DimDecl VName]
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Slice -&gt; [DimDecl VName] -&gt; t TermTypeM [DimDecl VName]
</span><a href="#local-6989586621684562536"><span class="hs-identifier hs-var">adjustDims</span></a></span><span> </span><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684562431"><span class="hs-identifier hs-var">idxes'</span></a></span><span> </span><span class="annot"><span class="annottext">[DimDecl VName]
</span><a href="#local-6989586621684562429"><span class="hs-identifier hs-var">dims</span></a></span><span>
</span><span id="line-120"></span><span>    </span><span class="annot"><a href="#local-6989586621684562536"><span class="hs-identifier hs-var">adjustDims</span></a></span><span> </span><span class="annot"><span class="annottext">Slice
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684562428"><span class="annot"><span class="annottext">[DimDecl VName]
</span><a href="#local-6989586621684562428"><span class="hs-identifier hs-var">dims</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-121"></span><span>      </span><span class="annot"><span class="annottext">[DimDecl VName] -&gt; t TermTypeM [DimDecl VName]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">[DimDecl VName]
</span><a href="#local-6989586621684562428"><span class="hs-identifier hs-var">dims</span></a></span><span>
</span><span id="line-122"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#sliceShape"><span class="hs-identifier hs-var">sliceShape</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SrcLoc, Rigidity)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Slice
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684562427"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684562427"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) as, [VName])
-&gt; TermTypeM (TypeBase (DimDecl VName) as, [VName])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684562427"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">--- Main checkers</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-comment">-- The closure of a lambda or local function are those variables that</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- it references, and which local to the current top-level function.</span><span>
</span><span id="line-128"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#lexicalClosure"><span class="hs-identifier hs-type">lexicalClosure</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Occurrences"><span class="hs-identifier hs-type">Occurrences</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Aliasing"><span class="hs-identifier hs-type">Aliasing</span></a></span><span>
</span><span id="line-129"></span><span id="lexicalClosure"><span class="annot"><span class="annottext">lexicalClosure :: [PatBase Info VName] -&gt; Occurrences -&gt; TermTypeM Aliasing
</span><a href="Language.Futhark.TypeChecker.Terms.html#lexicalClosure"><span class="hs-identifier hs-var hs-var">lexicalClosure</span></a></span></span><span> </span><span id="local-6989586621684562424"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684562424"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621684562423"><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684562423"><span class="hs-identifier hs-var">closure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-130"></span><span>  </span><span id="local-6989586621684562422"><span class="annot"><span class="annottext">Map VName ValBinding
</span><a href="#local-6989586621684562422"><span class="hs-identifier hs-var">vtable</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TermEnv -&gt; Map VName ValBinding)
-&gt; TermTypeM (Map VName ValBinding)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">((TermEnv -&gt; Map VName ValBinding)
 -&gt; TermTypeM (Map VName ValBinding))
-&gt; (TermEnv -&gt; Map VName ValBinding)
-&gt; TermTypeM (Map VName ValBinding)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TermScope -&gt; Map VName ValBinding
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#scopeVtable"><span class="hs-identifier hs-var hs-var">scopeVtable</span></a></span><span> </span><span class="annot"><span class="annottext">(TermScope -&gt; Map VName ValBinding)
-&gt; (TermEnv -&gt; TermScope) -&gt; TermEnv -&gt; Map VName ValBinding
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TermEnv -&gt; TermScope
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#termScope"><span class="hs-identifier hs-var hs-var">termScope</span></a></span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684562417"><span class="annot"><span class="annottext">isLocal :: VName -&gt; Bool
</span><a href="#local-6989586621684562417"><span class="hs-identifier hs-var hs-var">isLocal</span></a></span></span><span> </span><span id="local-6989586621684562416"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562416"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562416"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Map VName ValBinding -&gt; Maybe ValBinding
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-operator hs-var">`M.lookup`</span></span><span> </span><span class="annot"><span class="annottext">Map VName ValBinding
</span><a href="#local-6989586621684562422"><span class="hs-identifier hs-var">vtable</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-132"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#BoundV"><span class="hs-identifier hs-type">BoundV</span></a></span><span> </span><span class="annot"><span class="annottext">Locality
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Local"><span class="hs-identifier hs-var">Local</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><span class="annottext">Maybe ValBinding
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-134"></span><span>  </span><span class="annot"><span class="annottext">Aliasing -&gt; TermTypeM Aliasing
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Aliasing -&gt; TermTypeM Aliasing)
-&gt; (Set VName -&gt; Aliasing) -&gt; Set VName -&gt; TermTypeM Aliasing
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Alias) -&gt; Set VName -&gt; Aliasing
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">S.map</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Alias
</span><a href="Language.Futhark.Syntax.html#AliasBound"><span class="hs-identifier hs-var">AliasBound</span></a></span><span> </span><span class="annot"><span class="annottext">(Set VName -&gt; Aliasing)
-&gt; (Set VName -&gt; Set VName) -&gt; Set VName -&gt; Aliasing
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Bool) -&gt; Set VName -&gt; Set VName
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.filter</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Bool
</span><a href="#local-6989586621684562417"><span class="hs-identifier hs-var">isLocal</span></a></span><span> </span><span class="annot"><span class="annottext">(Set VName -&gt; TermTypeM Aliasing)
-&gt; Set VName -&gt; TermTypeM Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><span class="annottext">Occurrences -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#allOccurring"><span class="hs-identifier hs-var">allOccurring</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684562423"><span class="hs-identifier hs-var">closure</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">S.\\</span></span><span> </span><span class="annot"><span class="annottext">[Set VName] -&gt; Set VName
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; Set VName)
-&gt; [PatBase Info VName] -&gt; [Set VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Set VName
forall (f :: * -&gt; *) vn.
(Functor f, Ord vn) =&gt;
PatBase f vn -&gt; Set vn
</span><a href="Language.Futhark.Prop.html#patNames"><span class="hs-identifier hs-var">patNames</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684562424"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#noAliasesIfOverloaded"><span class="hs-identifier hs-type">noAliasesIfOverloaded</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span>
</span><span id="line-138"></span><span id="noAliasesIfOverloaded"><span class="annot"><span class="annottext">noAliasesIfOverloaded :: TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.html#noAliasesIfOverloaded"><span class="hs-identifier hs-var hs-var">noAliasesIfOverloaded</span></a></span></span><span> </span><span id="local-6989586621684562405"><span class="annot"><span class="annottext">t :: TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562405"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684562402"><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684562402"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621684562401"><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621684562401"><span class="hs-identifier hs-var">tn</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-139"></span><span>  </span><span id="local-6989586621684562400"><span class="annot"><span class="annottext">Maybe Constraint
</span><a href="#local-6989586621684562400"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Int, Constraint) -&gt; Constraint)
-&gt; Maybe (Int, Constraint) -&gt; Maybe Constraint
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(Int, Constraint) -&gt; Constraint
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Int, Constraint) -&gt; Maybe Constraint)
-&gt; (Constraints -&gt; Maybe (Int, Constraint))
-&gt; Constraints
-&gt; Maybe Constraint
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Constraints -&gt; Maybe (Int, Constraint)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeName -&gt; VName
</span><a href="Language.Futhark.Syntax.html#typeLeaf"><span class="hs-identifier hs-var hs-var">typeLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621684562401"><span class="hs-identifier hs-var">tn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Constraints -&gt; Maybe Constraint)
-&gt; TermTypeM Constraints -&gt; TermTypeM (Maybe Constraint)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TermTypeM Constraints
forall (m :: * -&gt; *). MonadUnify m =&gt; m Constraints
</span><a href="Language.Futhark.TypeChecker.Unify.html#getConstraints"><span class="hs-identifier hs-var">getConstraints</span></a></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Constraint
</span><a href="#local-6989586621684562400"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#Overloaded"><span class="hs-identifier hs-type">Overloaded</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing))
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) Aliasing
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Aliasing
-&gt; Uniqueness
-&gt; TypeName
-&gt; [TypeArg (DimDecl VName)]
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall dim as.
as
-&gt; Uniqueness -&gt; TypeName -&gt; [TypeArg dim] -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684562402"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621684562401"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-142"></span><span>    </span><span class="annot"><span class="annottext">Maybe Constraint
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562405"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-143"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#noAliasesIfOverloaded"><span class="hs-identifier hs-var">noAliasesIfOverloaded</span></a></span><span> </span><span id="local-6989586621684562396"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562396"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-144"></span><span>  </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562396"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkAscript"><span class="hs-identifier hs-type">checkAscript</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedTypeDecl"><span class="hs-identifier hs-type">UncheckedTypeDecl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-149"></span><span>  </span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedExp"><span class="hs-identifier hs-type">UncheckedExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.html#TypeDecl"><span class="hs-identifier hs-type">TypeDecl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span id="checkAscript"><span class="annot"><span class="annottext">checkAscript :: SrcLoc
-&gt; UncheckedTypeDecl
-&gt; ExpBase NoInfo Name
-&gt; TermTypeM (TypeDecl, Exp)
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkAscript"><span class="hs-identifier hs-var hs-var">checkAscript</span></a></span></span><span> </span><span id="local-6989586621684562393"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562393"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeDecl"><span class="hs-identifier hs-type">TypeDecl</span></a></span><span> </span><span id="local-6989586621684562391"><span class="annot"><span class="annottext">UncheckedTypeExp
</span><a href="#local-6989586621684562391"><span class="hs-identifier hs-var">te</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) ())
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684562389"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562389"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684562388"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684562388"><span class="hs-identifier hs-var">te'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562387"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562387"><span class="hs-identifier hs-var">decl_t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UncheckedTypeExp
-&gt; TermTypeM (TypeExp VName, TypeBase (DimDecl VName) (), [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#checkTypeExpNonrigid"><span class="hs-identifier hs-var">checkTypeExpNonrigid</span></a></span><span> </span><span class="annot"><span class="annottext">UncheckedTypeExp
</span><a href="#local-6989586621684562391"><span class="hs-identifier hs-var">te</span></a></span><span>
</span><span id="line-153"></span><span>  </span><span id="local-6989586621684562385"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562385"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562389"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-154"></span><span>  </span><span id="local-6989586621684562383"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562383"><span class="hs-identifier hs-var">e_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ())
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562385"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span>  </span><span class="annot"><span class="annottext">Checking -&gt; TermTypeM () -&gt; TermTypeM ()
forall a. Checking -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#onFailure"><span class="hs-identifier hs-var">onFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) () -&gt; Checking
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#CheckingAscription"><span class="hs-identifier hs-var">CheckingAscription</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562387"><span class="hs-identifier hs-var">decl_t</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562383"><span class="hs-identifier hs-var">e_t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM () -&gt; TermTypeM ()) -&gt; TermTypeM () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><span class="annottext">Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; String -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562393"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;type ascription&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562387"><span class="hs-identifier hs-var">decl_t</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562383"><span class="hs-identifier hs-var">e_t</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-comment">-- We also have to make sure that uniqueness matches.  This is done</span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-comment">-- explicitly, because uniqueness is ignored by unification.</span><span>
</span><span id="line-161"></span><span>  </span><span id="local-6989586621684562380"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562380"><span class="hs-identifier hs-var">e_t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall a (m :: * -&gt; *). (Substitutable a, MonadUnify m) =&gt; a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Unify.html#normTypeFully"><span class="hs-identifier hs-var">normTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562383"><span class="hs-identifier hs-var">e_t</span></a></span><span>
</span><span id="line-162"></span><span>  </span><span id="local-6989586621684562378"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562378"><span class="hs-identifier hs-var">decl_t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall a (m :: * -&gt; *). (Substitutable a, MonadUnify m) =&gt; a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Unify.html#normTypeFully"><span class="hs-identifier hs-var">normTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562387"><span class="hs-identifier hs-var">decl_t</span></a></span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TermTypeM () -&gt; TermTypeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; TypeBase () ()
forall vn as. TypeBase (DimDecl vn) as -&gt; TypeBase () as
</span><a href="Language.Futhark.Prop.html#noSizes"><span class="hs-identifier hs-var">noSizes</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562380"><span class="hs-identifier hs-var">e_t'</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase () () -&gt; TypeBase () () -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.Types.html#subtypeOf"><span class="hs-operator hs-var">`subtypeOf`</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; TypeBase () ()
forall vn as. TypeBase (DimDecl vn) as -&gt; TypeBase () as
</span><a href="Language.Futhark.Prop.html#noSizes"><span class="hs-identifier hs-var">noSizes</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562378"><span class="hs-identifier hs-var">decl_t'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM () -&gt; TermTypeM ()) -&gt; TermTypeM () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TermTypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562393"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM ()) -&gt; Doc -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-165"></span><span>      </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Type&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562380"><span class="hs-identifier hs-var">e_t'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;is not a subtype of&quot;</span></span><span>
</span><span id="line-166"></span><span>        </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562378"><span class="hs-identifier hs-var">decl_t'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span>  </span><span class="annot"><span class="annottext">(TypeDecl, Exp) -&gt; TermTypeM (TypeDecl, Exp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeExp VName -&gt; Info (TypeBase (DimDecl VName) ()) -&gt; TypeDecl
forall (f :: * -&gt; *) vn.
TypeExp vn -&gt; f (TypeBase (DimDecl VName) ()) -&gt; TypeDeclBase f vn
</span><a href="Language.Futhark.Syntax.html#TypeDecl"><span class="hs-identifier hs-var">TypeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684562388"><span class="hs-identifier hs-var">te'</span></a></span><span> </span><span class="annot"><span class="annottext">(Info (TypeBase (DimDecl VName) ()) -&gt; TypeDecl)
-&gt; Info (TypeBase (DimDecl VName) ()) -&gt; TypeDecl
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; Info (TypeBase (DimDecl VName) ())
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562378"><span class="hs-identifier hs-var">decl_t'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562385"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkCoerce"><span class="hs-identifier hs-type">checkCoerce</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-171"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-172"></span><span>  </span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedTypeDecl"><span class="hs-identifier hs-type">UncheckedTypeDecl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-173"></span><span>  </span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedExp"><span class="hs-identifier hs-type">UncheckedExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-174"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.html#TypeDecl"><span class="hs-identifier hs-type">TypeDecl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span id="checkCoerce"><span class="annot"><span class="annottext">checkCoerce :: SrcLoc
-&gt; UncheckedTypeDecl
-&gt; ExpBase NoInfo Name
-&gt; TermTypeM (TypeDecl, Exp, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkCoerce"><span class="hs-identifier hs-var hs-var">checkCoerce</span></a></span></span><span> </span><span id="local-6989586621684562368"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562368"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeDecl"><span class="hs-identifier hs-type">TypeDecl</span></a></span><span> </span><span id="local-6989586621684562367"><span class="annot"><span class="annottext">UncheckedTypeExp
</span><a href="#local-6989586621684562367"><span class="hs-identifier hs-var">te</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) ())
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684562366"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562366"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684562365"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684562365"><span class="hs-identifier hs-var">te'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562364"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562364"><span class="hs-identifier hs-var">decl_t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562363"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684562363"><span class="hs-identifier hs-var">ext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UncheckedTypeExp
-&gt; RigidSource
-&gt; TermTypeM (TypeExp VName, TypeBase (DimDecl VName) (), [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#checkTypeExpRigid"><span class="hs-identifier hs-var">checkTypeExpRigid</span></a></span><span> </span><span class="annot"><span class="annottext">UncheckedTypeExp
</span><a href="#local-6989586621684562367"><span class="hs-identifier hs-var">te</span></a></span><span> </span><span class="annot"><span class="annottext">RigidSource
</span><a href="Language.Futhark.TypeChecker.Unify.html#RigidCoerce"><span class="hs-identifier hs-var">RigidCoerce</span></a></span><span>
</span><span id="line-177"></span><span>  </span><span id="local-6989586621684562360"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562360"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562366"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-178"></span><span>  </span><span id="local-6989586621684562359"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562359"><span class="hs-identifier hs-var">e_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ())
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562360"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684562358"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562358"><span class="hs-identifier hs-var">e_t_nonrigid</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map VName (DimDecl VName)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-181"></span><span>    </span><span class="annot"><span class="annottext">SrcLoc
-&gt; Rigidity
-&gt; Name
-&gt; TypeBase (DimDecl VName) ()
-&gt; TermTypeM
     (TypeBase (DimDecl VName) (), Map VName (DimDecl VName))
forall als.
SrcLoc
-&gt; Rigidity
-&gt; Name
-&gt; TypeBase (DimDecl VName) als
-&gt; TermTypeM
     (TypeBase (DimDecl VName) als, Map VName (DimDecl VName))
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#allDimsFreshInType"><span class="hs-identifier hs-var">allDimsFreshInType</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562368"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Rigidity
</span><a href="Language.Futhark.TypeChecker.Unify.html#Nonrigid"><span class="hs-identifier hs-var">Nonrigid</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;coerce_d&quot;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562359"><span class="hs-identifier hs-var">e_t</span></a></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>  </span><span class="annot"><span class="annottext">Checking -&gt; TermTypeM () -&gt; TermTypeM ()
forall a. Checking -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#onFailure"><span class="hs-identifier hs-var">onFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) () -&gt; Checking
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#CheckingAscription"><span class="hs-identifier hs-var">CheckingAscription</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562364"><span class="hs-identifier hs-var">decl_t</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562359"><span class="hs-identifier hs-var">e_t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM () -&gt; TermTypeM ()) -&gt; TermTypeM () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-184"></span><span>    </span><span class="annot"><span class="annottext">Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; String -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562368"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;type ascription&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562364"><span class="hs-identifier hs-var">decl_t</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562358"><span class="hs-identifier hs-var">e_t_nonrigid</span></a></span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-comment">-- We also have to make sure that uniqueness matches.  This is done</span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-comment">-- explicitly, because uniqueness is ignored by unification.</span><span>
</span><span id="line-188"></span><span>  </span><span id="local-6989586621684562356"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562356"><span class="hs-identifier hs-var">e_t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall a (m :: * -&gt; *). (Substitutable a, MonadUnify m) =&gt; a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Unify.html#normTypeFully"><span class="hs-identifier hs-var">normTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562359"><span class="hs-identifier hs-var">e_t</span></a></span><span>
</span><span id="line-189"></span><span>  </span><span id="local-6989586621684562355"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562355"><span class="hs-identifier hs-var">decl_t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall a (m :: * -&gt; *). (Substitutable a, MonadUnify m) =&gt; a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Unify.html#normTypeFully"><span class="hs-identifier hs-var">normTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562364"><span class="hs-identifier hs-var">decl_t</span></a></span><span>
</span><span id="line-190"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TermTypeM () -&gt; TermTypeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; TypeBase () ()
forall vn as. TypeBase (DimDecl vn) as -&gt; TypeBase () as
</span><a href="Language.Futhark.Prop.html#noSizes"><span class="hs-identifier hs-var">noSizes</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562356"><span class="hs-identifier hs-var">e_t'</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase () () -&gt; TypeBase () () -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.Types.html#subtypeOf"><span class="hs-operator hs-var">`subtypeOf`</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; TypeBase () ()
forall vn as. TypeBase (DimDecl vn) as -&gt; TypeBase () as
</span><a href="Language.Futhark.Prop.html#noSizes"><span class="hs-identifier hs-var">noSizes</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562355"><span class="hs-identifier hs-var">decl_t'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM () -&gt; TermTypeM ()) -&gt; TermTypeM () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TermTypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562368"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM ()) -&gt; Doc -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-192"></span><span>      </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Type&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562356"><span class="hs-identifier hs-var">e_t'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;is not a subtype of&quot;</span></span><span>
</span><span id="line-193"></span><span>        </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562355"><span class="hs-identifier hs-var">decl_t'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>  </span><span class="annot"><span class="annottext">(TypeDecl, Exp, [VName]) -&gt; TermTypeM (TypeDecl, Exp, [VName])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeExp VName -&gt; Info (TypeBase (DimDecl VName) ()) -&gt; TypeDecl
forall (f :: * -&gt; *) vn.
TypeExp vn -&gt; f (TypeBase (DimDecl VName) ()) -&gt; TypeDeclBase f vn
</span><a href="Language.Futhark.Syntax.html#TypeDecl"><span class="hs-identifier hs-var">TypeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684562365"><span class="hs-identifier hs-var">te'</span></a></span><span> </span><span class="annot"><span class="annottext">(Info (TypeBase (DimDecl VName) ()) -&gt; TypeDecl)
-&gt; Info (TypeBase (DimDecl VName) ()) -&gt; TypeDecl
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; Info (TypeBase (DimDecl VName) ())
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562355"><span class="hs-identifier hs-var">decl_t'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562360"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684562363"><span class="hs-identifier hs-var">ext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#unscopeType"><span class="hs-identifier hs-type">unscopeType</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-198"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-199"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-200"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span id="unscopeType"><span class="annot"><span class="annottext">unscopeType :: SrcLoc
-&gt; Map VName (IdentBase Info VName)
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#unscopeType"><span class="hs-identifier hs-var hs-var">unscopeType</span></a></span></span><span> </span><span id="local-6989586621684562352"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562352"><span class="hs-identifier hs-var">tloc</span></a></span></span><span> </span><span id="local-6989586621684562351"><span class="annot"><span class="annottext">Map VName (IdentBase Info VName)
</span><a href="#local-6989586621684562351"><span class="hs-identifier hs-var">unscoped</span></a></span></span><span> </span><span id="local-6989586621684562350"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562350"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684562349"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562349"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562348"><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684562348"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (Map VName VName) TermTypeM (TypeBase (DimDecl VName) Aliasing)
-&gt; Map VName VName
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, Map VName VName)
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var hs-var">runStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Set VName
 -&gt; DimPos
 -&gt; DimDecl VName
 -&gt; StateT (Map VName VName) TermTypeM (DimDecl VName))
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; StateT
     (Map VName VName) TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall (f :: * -&gt; *) fdim tdim als.
Applicative f =&gt;
(Set VName -&gt; DimPos -&gt; fdim -&gt; f tdim)
-&gt; TypeBase fdim als -&gt; f (TypeBase tdim als)
</span><a href="Language.Futhark.Prop.html#traverseDims"><span class="hs-identifier hs-var">traverseDims</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName
-&gt; DimPos
-&gt; DimDecl VName
-&gt; StateT (Map VName VName) TermTypeM (DimDecl VName)
forall {t :: (* -&gt; *) -&gt; * -&gt; *} {m :: * -&gt; *} {p}.
(MonadState (Map VName VName) (t m), MonadTrans t, MonadUnify m) =&gt;
Set VName -&gt; p -&gt; DimDecl VName -&gt; t m (DimDecl VName)
</span><a href="#local-6989586621684562346"><span class="hs-identifier hs-var">onDim</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562350"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map VName VName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-204"></span><span>  </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing, [VName])
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562349"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; (Aliasing -&gt; Aliasing) -&gt; TypeBase (DimDecl VName) Aliasing
forall dim asf ast.
TypeBase dim asf -&gt; (asf -&gt; ast) -&gt; TypeBase dim ast
</span><a href="Language.Futhark.Prop.html#addAliases"><span class="hs-operator hs-var">`addAliases`</span></a></span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; Alias) -&gt; Aliasing -&gt; Aliasing
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">S.map</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Alias
</span><a href="#local-6989586621684562344"><span class="hs-identifier hs-var">unAlias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map VName VName -&gt; [VName]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684562348"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-206"></span><span>    </span><span id="local-6989586621684562346"><span class="annot"><span class="annottext">onDim :: Set VName -&gt; p -&gt; DimDecl VName -&gt; t m (DimDecl VName)
</span><a href="#local-6989586621684562346"><span class="hs-identifier hs-var hs-var">onDim</span></a></span></span><span> </span><span id="local-6989586621684562330"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684562330"><span class="hs-identifier hs-var">bound</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#NamedDim"><span class="hs-identifier hs-type">NamedDim</span></a></span><span> </span><span id="local-6989586621684562329"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684562329"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684562328"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562328"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">(IdentBase Info VName -&gt; SrcLoc)
-&gt; Maybe (IdentBase Info VName) -&gt; Maybe SrcLoc
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName
-&gt; Map VName (IdentBase Info VName) -&gt; Maybe (IdentBase Info VName)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName VName -&gt; VName
forall vn. QualName vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#qualLeaf"><span class="hs-identifier hs-var hs-var">qualLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684562329"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map VName (IdentBase Info VName)
</span><a href="#local-6989586621684562351"><span class="hs-identifier hs-var">unscoped</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-208"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; VName
forall vn. QualName vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#qualLeaf"><span class="hs-identifier hs-var hs-var">qualLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684562329"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684562330"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-209"></span><span>        </span><span class="annot"><span class="annottext">SrcLoc -&gt; VName -&gt; t m (DimDecl VName)
forall {t :: (* -&gt; *) -&gt; * -&gt; *} {m :: * -&gt; *}.
(MonadState (Map VName VName) (t m), MonadTrans t, MonadUnify m) =&gt;
SrcLoc -&gt; VName -&gt; t m (DimDecl VName)
</span><a href="#local-6989586621684562323"><span class="hs-identifier hs-var">inst</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562328"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; t m (DimDecl VName)) -&gt; VName -&gt; t m (DimDecl VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; VName
forall vn. QualName vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#qualLeaf"><span class="hs-identifier hs-var hs-var">qualLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684562329"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-210"></span><span>    </span><span class="annot"><a href="#local-6989586621684562346"><span class="hs-identifier hs-var">onDim</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684562322"><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684562322"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DimDecl VName -&gt; t m (DimDecl VName)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684562322"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span>    </span><span id="local-6989586621684562323"><span class="annot"><span class="annottext">inst :: SrcLoc -&gt; VName -&gt; t m (DimDecl VName)
</span><a href="#local-6989586621684562323"><span class="hs-identifier hs-var hs-var">inst</span></a></span></span><span> </span><span id="local-6989586621684562301"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562301"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621684562300"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562300"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-213"></span><span>      </span><span id="local-6989586621684562299"><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684562299"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Map VName VName -&gt; Maybe VName) -&gt; t m (Maybe VName)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">((Map VName VName -&gt; Maybe VName) -&gt; t m (Maybe VName))
-&gt; (Map VName VName -&gt; Maybe VName) -&gt; t m (Maybe VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Map VName VName -&gt; Maybe VName
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562300"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-214"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684562299"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-215"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684562297"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562297"><span class="hs-identifier hs-var">d'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DimDecl VName -&gt; t m (DimDecl VName)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(DimDecl VName -&gt; t m (DimDecl VName))
-&gt; DimDecl VName -&gt; t m (DimDecl VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; DimDecl VName
forall vn. QualName vn -&gt; DimDecl vn
</span><a href="Language.Futhark.Syntax.html#NamedDim"><span class="hs-identifier hs-var">NamedDim</span></a></span><span> </span><span class="annot"><span class="annottext">(QualName VName -&gt; DimDecl VName)
-&gt; QualName VName -&gt; DimDecl VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562297"><span class="hs-identifier hs-var">d'</span></a></span><span>
</span><span id="line-216"></span><span>        </span><span class="annot"><span class="annottext">Maybe VName
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-217"></span><span>          </span><span id="local-6989586621684562296"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562296"><span class="hs-identifier hs-var">d'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m VName -&gt; t m VName
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m VName -&gt; t m VName) -&gt; m VName -&gt; t m VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Rigidity -&gt; Name -&gt; m VName
forall (m :: * -&gt; *).
MonadUnify m =&gt;
SrcLoc -&gt; Rigidity -&gt; Name -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Unify.html#newDimVar"><span class="hs-identifier hs-var">newDimVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562352"><span class="hs-identifier hs-var">tloc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RigidSource -&gt; Rigidity
</span><a href="Language.Futhark.TypeChecker.Unify.html#Rigid"><span class="hs-identifier hs-var">Rigid</span></a></span><span> </span><span class="annot"><span class="annottext">(RigidSource -&gt; Rigidity) -&gt; RigidSource -&gt; Rigidity
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; VName -&gt; RigidSource
</span><a href="Language.Futhark.TypeChecker.Unify.html#RigidOutOfScope"><span class="hs-identifier hs-var">RigidOutOfScope</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562301"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562300"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;d&quot;</span></span><span>
</span><span id="line-218"></span><span>          </span><span class="annot"><span class="annottext">(Map VName VName -&gt; Map VName VName) -&gt; t m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((Map VName VName -&gt; Map VName VName) -&gt; t m ())
-&gt; (Map VName VName -&gt; Map VName VName) -&gt; t m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; VName -&gt; Map VName VName -&gt; Map VName VName
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562300"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562296"><span class="hs-identifier hs-var">d'</span></a></span><span>
</span><span id="line-219"></span><span>          </span><span class="annot"><span class="annottext">DimDecl VName -&gt; t m (DimDecl VName)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(DimDecl VName -&gt; t m (DimDecl VName))
-&gt; DimDecl VName -&gt; t m (DimDecl VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; DimDecl VName
forall vn. QualName vn -&gt; DimDecl vn
</span><a href="Language.Futhark.Syntax.html#NamedDim"><span class="hs-identifier hs-var">NamedDim</span></a></span><span> </span><span class="annot"><span class="annottext">(QualName VName -&gt; DimDecl VName)
-&gt; QualName VName -&gt; DimDecl VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562296"><span class="hs-identifier hs-var">d'</span></a></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span>    </span><span id="local-6989586621684562344"><span class="annot"><span class="annottext">unAlias :: Alias -&gt; Alias
</span><a href="#local-6989586621684562344"><span class="hs-identifier hs-var hs-var">unAlias</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AliasBound"><span class="hs-identifier hs-type">AliasBound</span></a></span><span> </span><span id="local-6989586621684562292"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562292"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562292"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Map VName (IdentBase Info VName) -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><span class="hs-operator hs-var">`M.member`</span></span><span> </span><span class="annot"><span class="annottext">Map VName (IdentBase Info VName)
</span><a href="#local-6989586621684562351"><span class="hs-identifier hs-var">unscoped</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Alias
</span><a href="Language.Futhark.Syntax.html#AliasFree"><span class="hs-identifier hs-var">AliasFree</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562292"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-222"></span><span>    </span><span class="annot"><a href="#local-6989586621684562344"><span class="hs-identifier hs-var">unAlias</span></a></span><span> </span><span id="local-6989586621684562289"><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621684562289"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621684562289"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="hs-comment">-- When a function result is not immediately bound to a name, we need</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- to invent a name for it so we can track it during aliasing</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- (uniqueness-error54.fut, uniqueness-error55.fut).</span><span>
</span><span id="line-227"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#addResultAliases"><span class="hs-identifier hs-type">addResultAliases</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#NameReason"><span class="hs-identifier hs-type">NameReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span>
</span><span id="line-228"></span><span id="addResultAliases"><span class="annot"><span class="annottext">addResultAliases :: NameReason
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.html#addResultAliases"><span class="hs-identifier hs-var hs-var">addResultAliases</span></a></span></span><span> </span><span id="local-6989586621684562287"><span class="annot"><span class="annottext">NameReason
</span><a href="#local-6989586621684562287"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span id="local-6989586621684562285"><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) Aliasing)
</span><a href="#local-6989586621684562285"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-229"></span><span>  </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) Aliasing
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; (Map Name (TypeBase (DimDecl VName) Aliasing)
    -&gt; ScalarTypeBase (DimDecl VName) Aliasing)
-&gt; Map Name (TypeBase (DimDecl VName) Aliasing)
-&gt; TypeBase (DimDecl VName) Aliasing
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) Aliasing)
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall dim as. Map Name (TypeBase dim as) -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-var">Record</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Name (TypeBase (DimDecl VName) Aliasing)
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; TermTypeM (Map Name (TypeBase (DimDecl VName) Aliasing))
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing))
-&gt; Map Name (TypeBase (DimDecl VName) Aliasing)
-&gt; TermTypeM (Map Name (TypeBase (DimDecl VName) Aliasing))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameReason
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.html#addResultAliases"><span class="hs-identifier hs-var">addResultAliases</span></a></span><span> </span><span class="annot"><span class="annottext">NameReason
</span><a href="#local-6989586621684562287"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) Aliasing)
</span><a href="#local-6989586621684562285"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-230"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#addResultAliases"><span class="hs-identifier hs-var">addResultAliases</span></a></span><span> </span><span id="local-6989586621684562283"><span class="annot"><span class="annottext">NameReason
</span><a href="#local-6989586621684562283"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Sum"><span class="hs-identifier hs-type">Sum</span></a></span><span> </span><span id="local-6989586621684562281"><span class="annot"><span class="annottext">Map Name [TypeBase (DimDecl VName) Aliasing]
</span><a href="#local-6989586621684562281"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-231"></span><span>  </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) Aliasing
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; (Map Name [TypeBase (DimDecl VName) Aliasing]
    -&gt; ScalarTypeBase (DimDecl VName) Aliasing)
-&gt; Map Name [TypeBase (DimDecl VName) Aliasing]
-&gt; TypeBase (DimDecl VName) Aliasing
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map Name [TypeBase (DimDecl VName) Aliasing]
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall dim as. Map Name [TypeBase dim as] -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Sum"><span class="hs-identifier hs-var">Sum</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Name [TypeBase (DimDecl VName) Aliasing]
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; TermTypeM (Map Name [TypeBase (DimDecl VName) Aliasing])
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">([TypeBase (DimDecl VName) Aliasing]
 -&gt; TermTypeM [TypeBase (DimDecl VName) Aliasing])
-&gt; Map Name [TypeBase (DimDecl VName) Aliasing]
-&gt; TermTypeM (Map Name [TypeBase (DimDecl VName) Aliasing])
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing))
-&gt; [TypeBase (DimDecl VName) Aliasing]
-&gt; TermTypeM [TypeBase (DimDecl VName) Aliasing]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameReason
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.html#addResultAliases"><span class="hs-identifier hs-var">addResultAliases</span></a></span><span> </span><span class="annot"><span class="annottext">NameReason
</span><a href="#local-6989586621684562283"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Name [TypeBase (DimDecl VName) Aliasing]
</span><a href="#local-6989586621684562281"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-232"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#addResultAliases"><span class="hs-identifier hs-var">addResultAliases</span></a></span><span> </span><span id="local-6989586621684562280"><span class="annot"><span class="annottext">NameReason
</span><a href="#local-6989586621684562280"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span id="local-6989586621684562279"><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684562279"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span id="local-6989586621684562278"><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684562278"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621684562277"><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621684562277"><span class="hs-identifier hs-var">tn</span></a></span></span><span> </span><span id="local-6989586621684562276"><span class="annot"><span class="annottext">[TypeArg (DimDecl VName)]
</span><a href="#local-6989586621684562276"><span class="hs-identifier hs-var">targs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-233"></span><span>  </span><span id="local-6989586621684562275"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562275"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TermTypeM VName
forall (m :: * -&gt; *). MonadTypeChecker m =&gt; Name -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Monad.html#newID"><span class="hs-identifier hs-var">newID</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;internal_app_result&quot;</span></span><span>
</span><span id="line-234"></span><span>  </span><span class="annot"><span class="annottext">(TermTypeState -&gt; TermTypeState) -&gt; TermTypeM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((TermTypeState -&gt; TermTypeState) -&gt; TermTypeM ())
-&gt; (TermTypeState -&gt; TermTypeState) -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684562274"><span class="annot"><span class="annottext">TermTypeState
</span><a href="#local-6989586621684562274"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermTypeState
</span><a href="#local-6989586621684562274"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">stateNames :: Map VName NameReason
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#stateNames"><span class="hs-identifier hs-var">stateNames</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; NameReason -&gt; Map VName NameReason -&gt; Map VName NameReason
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562275"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">NameReason
</span><a href="#local-6989586621684562280"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(Map VName NameReason -&gt; Map VName NameReason)
-&gt; Map VName NameReason -&gt; Map VName NameReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TermTypeState -&gt; Map VName NameReason
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#stateNames"><span class="hs-identifier hs-var hs-var">stateNames</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeState
</span><a href="#local-6989586621684562274"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-235"></span><span>  </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing))
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) Aliasing
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Aliasing
-&gt; Uniqueness
-&gt; TypeName
-&gt; [TypeArg (DimDecl VName)]
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall dim as.
as
-&gt; Uniqueness -&gt; TypeName -&gt; [TypeArg dim] -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Alias -&gt; Aliasing -&gt; Aliasing
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Alias
</span><a href="Language.Futhark.Syntax.html#AliasFree"><span class="hs-identifier hs-var">AliasFree</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562275"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684562279"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684562278"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621684562277"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeArg (DimDecl VName)]
</span><a href="#local-6989586621684562276"><span class="hs-identifier hs-var">targs</span></a></span><span>
</span><span id="line-236"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#addResultAliases"><span class="hs-identifier hs-var">addResultAliases</span></a></span><span> </span><span class="annot"><span class="annottext">NameReason
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span id="local-6989586621684562271"><span class="annot"><span class="annottext">t :: ScalarTypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562271"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562271"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#addResultAliases"><span class="hs-identifier hs-var">addResultAliases</span></a></span><span> </span><span class="annot"><span class="annottext">NameReason
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span id="local-6989586621684562269"><span class="annot"><span class="annottext">t :: ScalarTypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562269"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-type">Arrow</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562269"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#addResultAliases"><span class="hs-identifier hs-var">addResultAliases</span></a></span><span> </span><span id="local-6989586621684562267"><span class="annot"><span class="annottext">NameReason
</span><a href="#local-6989586621684562267"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span id="local-6989586621684562266"><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684562266"><span class="hs-identifier hs-var">als</span></a></span></span><span> </span><span id="local-6989586621684562265"><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684562265"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621684562264"><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562264"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621684562263"><span class="annot"><span class="annottext">ShapeDecl (DimDecl VName)
</span><a href="#local-6989586621684562263"><span class="hs-identifier hs-var">shape</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-239"></span><span>  </span><span id="local-6989586621684562262"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562262"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TermTypeM VName
forall (m :: * -&gt; *). MonadTypeChecker m =&gt; Name -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Monad.html#newID"><span class="hs-identifier hs-var">newID</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;internal_app_result&quot;</span></span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><span class="annottext">(TermTypeState -&gt; TermTypeState) -&gt; TermTypeM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((TermTypeState -&gt; TermTypeState) -&gt; TermTypeM ())
-&gt; (TermTypeState -&gt; TermTypeState) -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684562261"><span class="annot"><span class="annottext">TermTypeState
</span><a href="#local-6989586621684562261"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermTypeState
</span><a href="#local-6989586621684562261"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">stateNames :: Map VName NameReason
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#stateNames"><span class="hs-identifier hs-var">stateNames</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; NameReason -&gt; Map VName NameReason -&gt; Map VName NameReason
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562262"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">NameReason
</span><a href="#local-6989586621684562267"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(Map VName NameReason -&gt; Map VName NameReason)
-&gt; Map VName NameReason -&gt; Map VName NameReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TermTypeState -&gt; Map VName NameReason
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#stateNames"><span class="hs-identifier hs-var hs-var">stateNames</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeState
</span><a href="#local-6989586621684562261"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-241"></span><span>  </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing))
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Aliasing
-&gt; Uniqueness
-&gt; ScalarTypeBase (DimDecl VName) ()
-&gt; ShapeDecl (DimDecl VName)
-&gt; TypeBase (DimDecl VName) Aliasing
forall dim as.
as
-&gt; Uniqueness
-&gt; ScalarTypeBase dim ()
-&gt; ShapeDecl dim
-&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Array"><span class="hs-identifier hs-var">Array</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Alias -&gt; Aliasing -&gt; Aliasing
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Alias
</span><a href="Language.Futhark.Syntax.html#AliasFree"><span class="hs-identifier hs-var">AliasFree</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562262"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684562266"><span class="hs-identifier hs-var">als</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684562265"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562264"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeDecl (DimDecl VName)
</span><a href="#local-6989586621684562263"><span class="hs-identifier hs-var">shape</span></a></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="hs-comment">-- 'checkApplyExp' is like 'checkExp', but tries to find the &quot;root</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- function&quot;, for better error messages.</span><span>
</span><span id="line-245"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkApplyExp"><span class="hs-identifier hs-type">checkApplyExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedExp"><span class="hs-identifier hs-type">UncheckedExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#ApplyOp"><span class="hs-identifier hs-type">ApplyOp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span id="checkApplyExp"><span class="annot"><span class="annottext">checkApplyExp :: ExpBase NoInfo Name -&gt; TermTypeM (Exp, ApplyOp)
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkApplyExp"><span class="hs-identifier hs-var hs-var">checkApplyExp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621684562257"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562257"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621684562256"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562256"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (Diet, Maybe VName)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684562255"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562255"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoInfo AppRes
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-247"></span><span>  </span><span id="local-6989586621684562254"><span class="annot"><span class="annottext">Arg
</span><a href="#local-6989586621684562254"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Arg
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkArg"><span class="hs-identifier hs-var">checkArg</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562256"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684562252"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562252"><span class="hs-identifier hs-var">e1'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684562251"><span class="annot"><span class="annottext">Maybe (QualName VName)
</span><a href="#local-6989586621684562251"><span class="hs-identifier hs-var">fname</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562250"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684562250"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM (Exp, ApplyOp)
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkApplyExp"><span class="hs-identifier hs-var">checkApplyExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562257"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-249"></span><span>  </span><span id="local-6989586621684562249"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562249"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expType"><span class="hs-identifier hs-var">expType</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562252"><span class="hs-identifier hs-var">e1'</span></a></span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684562247"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562247"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562246"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562246"><span class="hs-identifier hs-var">rt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562245"><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684562245"><span class="hs-identifier hs-var">argext</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562244"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684562244"><span class="hs-identifier hs-var">exts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; ApplyOp
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Arg
-&gt; TermTypeM
     (TypeBase (DimDecl VName) Aliasing,
      TypeBase (DimDecl VName) Aliasing, Maybe VName, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkApply"><span class="hs-identifier hs-var">checkApply</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562255"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (QualName VName)
</span><a href="#local-6989586621684562251"><span class="hs-identifier hs-var">fname</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684562250"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562249"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Arg
</span><a href="#local-6989586621684562254"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-251"></span><span>  </span><span id="local-6989586621684562242"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562242"><span class="hs-identifier hs-var">rt'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NameReason
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.html#addResultAliases"><span class="hs-identifier hs-var">addResultAliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (QualName VName) -&gt; SrcLoc -&gt; NameReason
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#NameAppRes"><span class="hs-identifier hs-var">NameAppRes</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (QualName VName)
</span><a href="#local-6989586621684562251"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562255"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562246"><span class="hs-identifier hs-var">rt</span></a></span><span>
</span><span id="line-252"></span><span>  </span><span class="annot"><span class="annottext">(Exp, ApplyOp) -&gt; TermTypeM (Exp, ApplyOp)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">AppExpBase Info VName -&gt; Info AppRes -&gt; Exp
forall (f :: * -&gt; *) vn.
AppExpBase f vn -&gt; f AppRes -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-var">AppExp</span></a></span><span>
</span><span id="line-254"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
-&gt; Exp
-&gt; Info (Diet, Maybe VName)
-&gt; SrcLoc
-&gt; AppExpBase Info VName
forall (f :: * -&gt; *) vn.
ExpBase f vn
-&gt; ExpBase f vn
-&gt; f (Diet, Maybe VName)
-&gt; SrcLoc
-&gt; AppExpBase f vn
</span><a href="Language.Futhark.Syntax.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562252"><span class="hs-identifier hs-var">e1'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg -&gt; Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#argExp"><span class="hs-identifier hs-var">argExp</span></a></span><span> </span><span class="annot"><span class="annottext">Arg
</span><a href="#local-6989586621684562254"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Diet, Maybe VName) -&gt; Info (Diet, Maybe VName)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Diet
forall shape as. TypeBase shape as -&gt; Diet
</span><a href="Language.Futhark.Prop.html#diet"><span class="hs-identifier hs-var">diet</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562247"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684562245"><span class="hs-identifier hs-var">argext</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562255"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppRes -&gt; Info AppRes
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">(AppRes -&gt; Info AppRes) -&gt; AppRes -&gt; Info AppRes
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; [VName] -&gt; AppRes
</span><a href="Language.Futhark.Syntax.html#AppRes"><span class="hs-identifier hs-var">AppRes</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562242"><span class="hs-identifier hs-var">rt'</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684562244"><span class="hs-identifier hs-var">exts</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-256"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (QualName VName)
</span><a href="#local-6989586621684562251"><span class="hs-identifier hs-var">fname</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684562250"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkApplyExp"><span class="hs-identifier hs-var">checkApplyExp</span></a></span><span> </span><span id="local-6989586621684562236"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562236"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-259"></span><span>  </span><span id="local-6989586621684562235"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562235"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562236"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-260"></span><span>  </span><span class="annot"><span class="annottext">(Exp, ApplyOp) -&gt; TermTypeM (Exp, ApplyOp)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562235"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-262"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562235"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-263"></span><span>          </span><span class="annot"><a href="Language.Futhark.Syntax.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684562233"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684562233"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span class="annot"><span class="annottext">Info (TypeBase (DimDecl VName) Aliasing)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; Maybe (QualName VName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684562233"><span class="hs-identifier hs-var">qn</span></a></span><span>
</span><span id="line-264"></span><span>          </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (QualName VName)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-265"></span><span>        </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-266"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-type">checkExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedExp"><span class="hs-identifier hs-type">UncheckedExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-270"></span><span id="checkExp"><span class="annot"><span class="annottext">checkExp :: ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var hs-var">checkExp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span> </span><span id="local-6989586621684562231"><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684562231"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span id="local-6989586621684562230"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562230"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-271"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimValue -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn. PrimValue -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#Literal"><span class="hs-identifier hs-var">Literal</span></a></span><span> </span><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684562231"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562230"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-272"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#StringLit"><span class="hs-identifier hs-type">StringLit</span></a></span><span> </span><span id="local-6989586621684562228"><span class="annot"><span class="annottext">[Word8]
</span><a href="#local-6989586621684562228"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621684562227"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562227"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-273"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Word8] -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn. [Word8] -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#StringLit"><span class="hs-identifier hs-var">StringLit</span></a></span><span> </span><span class="annot"><span class="annottext">[Word8]
</span><a href="#local-6989586621684562228"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562227"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-274"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#IntLit"><span class="hs-identifier hs-type">IntLit</span></a></span><span> </span><span id="local-6989586621684562225"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621684562225"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684562224"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562224"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-275"></span><span>  </span><span id="local-6989586621684562223"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562223"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Name -&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall (m :: * -&gt; *) als dim.
(MonadUnify m, Monoid als) =&gt;
SrcLoc -&gt; Name -&gt; m (TypeBase dim als)
</span><a href="Language.Futhark.TypeChecker.Unify.html#newTypeVar"><span class="hs-identifier hs-var">newTypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562224"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;t&quot;</span></span><span>
</span><span id="line-276"></span><span>  </span><span class="annot"><span class="annottext">[PrimType] -&gt; Usage -&gt; TypeBase (DimDecl VName) () -&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
[PrimType] -&gt; Usage -&gt; TypeBase (DimDecl VName) () -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#mustBeOneOf"><span class="hs-identifier hs-var">mustBeOneOf</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimType]
</span><a href="Language.Futhark.TypeChecker.Monad.html#anyNumberType"><span class="hs-identifier hs-var">anyNumberType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; String -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562224"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;integer literal&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562223"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-277"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer
-&gt; Info (TypeBase (DimDecl VName) Aliasing) -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn.
Integer
-&gt; f (TypeBase (DimDecl VName) Aliasing) -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#IntLit"><span class="hs-identifier hs-var">IntLit</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621684562225"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; Info (TypeBase (DimDecl VName) Aliasing))
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. TypeBase dim as -&gt; TypeBase dim Aliasing
</span><a href="Language.Futhark.Prop.html#fromStruct"><span class="hs-identifier hs-var">fromStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562223"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562224"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-278"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#FloatLit"><span class="hs-identifier hs-type">FloatLit</span></a></span><span> </span><span id="local-6989586621684562217"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621684562217"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684562216"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562216"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-279"></span><span>  </span><span id="local-6989586621684562215"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562215"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Name -&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall (m :: * -&gt; *) als dim.
(MonadUnify m, Monoid als) =&gt;
SrcLoc -&gt; Name -&gt; m (TypeBase dim als)
</span><a href="Language.Futhark.TypeChecker.Unify.html#newTypeVar"><span class="hs-identifier hs-var">newTypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562216"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;t&quot;</span></span><span>
</span><span id="line-280"></span><span>  </span><span class="annot"><span class="annottext">[PrimType] -&gt; Usage -&gt; TypeBase (DimDecl VName) () -&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
[PrimType] -&gt; Usage -&gt; TypeBase (DimDecl VName) () -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#mustBeOneOf"><span class="hs-identifier hs-var">mustBeOneOf</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimType]
</span><a href="Language.Futhark.TypeChecker.Monad.html#anyFloatType"><span class="hs-identifier hs-var">anyFloatType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; String -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562216"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;float literal&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562215"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-281"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Info (TypeBase (DimDecl VName) Aliasing) -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn.
Double
-&gt; f (TypeBase (DimDecl VName) Aliasing) -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#FloatLit"><span class="hs-identifier hs-var">FloatLit</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621684562217"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; Info (TypeBase (DimDecl VName) Aliasing))
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. TypeBase dim as -&gt; TypeBase dim Aliasing
</span><a href="Language.Futhark.Prop.html#fromStruct"><span class="hs-identifier hs-var">fromStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562215"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562216"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-282"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TupLit"><span class="hs-identifier hs-type">TupLit</span></a></span><span> </span><span id="local-6989586621684562212"><span class="annot"><span class="annottext">[ExpBase NoInfo Name]
</span><a href="#local-6989586621684562212"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621684562211"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562211"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-283"></span><span>  </span><span class="annot"><span class="annottext">[Exp] -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn. [ExpBase f vn] -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#TupLit"><span class="hs-identifier hs-var">TupLit</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp] -&gt; SrcLoc -&gt; Exp)
-&gt; TermTypeM [Exp] -&gt; TermTypeM (SrcLoc -&gt; Exp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(ExpBase NoInfo Name -&gt; TermTypeM Exp)
-&gt; [ExpBase NoInfo Name] -&gt; TermTypeM [Exp]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpBase NoInfo Name]
</span><a href="#local-6989586621684562212"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM (SrcLoc -&gt; Exp) -&gt; TermTypeM SrcLoc -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; TermTypeM SrcLoc
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562211"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-284"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RecordLit"><span class="hs-identifier hs-type">RecordLit</span></a></span><span> </span><span id="local-6989586621684562208"><span class="annot"><span class="annottext">[FieldBase NoInfo Name]
</span><a href="#local-6989586621684562208"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621684562207"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562207"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-285"></span><span>  </span><span id="local-6989586621684562206"><span class="annot"><span class="annottext">[FieldBase Info VName]
</span><a href="#local-6989586621684562206"><span class="hs-identifier hs-var">fs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT (Map Name SrcLoc) TermTypeM [FieldBase Info VName]
-&gt; Map Name SrcLoc -&gt; TermTypeM [FieldBase Info VName]
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><span class="hs-identifier hs-var">evalStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FieldBase NoInfo Name
 -&gt; StateT (Map Name SrcLoc) TermTypeM (FieldBase Info VName))
-&gt; [FieldBase NoInfo Name]
-&gt; StateT (Map Name SrcLoc) TermTypeM [FieldBase Info VName]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">FieldBase NoInfo Name
-&gt; StateT (Map Name SrcLoc) TermTypeM (FieldBase Info VName)
forall {t :: (* -&gt; *) -&gt; * -&gt; *}.
(MonadState (Map Name SrcLoc) (t TermTypeM), MonadTrans t) =&gt;
FieldBase NoInfo Name -&gt; t TermTypeM (FieldBase Info VName)
</span><a href="#local-6989586621684562204"><span class="hs-identifier hs-var">checkField</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldBase NoInfo Name]
</span><a href="#local-6989586621684562208"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Name SrcLoc
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FieldBase Info VName] -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn. [FieldBase f vn] -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#RecordLit"><span class="hs-identifier hs-var">RecordLit</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldBase Info VName]
</span><a href="#local-6989586621684562206"><span class="hs-identifier hs-var">fs'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562207"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-288"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-289"></span><span>    </span><span id="local-6989586621684562204"><span class="annot"><span class="annottext">checkField :: FieldBase NoInfo Name -&gt; t TermTypeM (FieldBase Info VName)
</span><a href="#local-6989586621684562204"><span class="hs-identifier hs-var hs-var">checkField</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RecordFieldExplicit"><span class="hs-identifier hs-type">RecordFieldExplicit</span></a></span><span> </span><span id="local-6989586621684562165"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684562165"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621684562164"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562164"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684562163"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562163"><span class="hs-identifier hs-var">rloc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-290"></span><span>      </span><span class="annot"><span class="annottext">Name -&gt; SrcLoc -&gt; t TermTypeM ()
forall {a} {b} {t :: (* -&gt; *) -&gt; * -&gt; *} {m :: * -&gt; *} {a}.
(MonadState (Map a b) (t m), Ord a, MonadTrans t,
 MonadTypeChecker m, Pretty a, Located a, Located b) =&gt;
a -&gt; a -&gt; t m ()
</span><a href="#local-6989586621684562162"><span class="hs-identifier hs-var">errIfAlreadySet</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684562165"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562163"><span class="hs-identifier hs-var">rloc</span></a></span><span>
</span><span id="line-291"></span><span>      </span><span class="annot"><span class="annottext">(Map Name SrcLoc -&gt; Map Name SrcLoc) -&gt; t TermTypeM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((Map Name SrcLoc -&gt; Map Name SrcLoc) -&gt; t TermTypeM ())
-&gt; (Map Name SrcLoc -&gt; Map Name SrcLoc) -&gt; t TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SrcLoc -&gt; Map Name SrcLoc -&gt; Map Name SrcLoc
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684562165"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562163"><span class="hs-identifier hs-var">rloc</span></a></span><span>
</span><span id="line-292"></span><span>      </span><span class="annot"><span class="annottext">Name -&gt; Exp -&gt; SrcLoc -&gt; FieldBase Info VName
forall (f :: * -&gt; *) vn.
Name -&gt; ExpBase f vn -&gt; SrcLoc -&gt; FieldBase f vn
</span><a href="Language.Futhark.Syntax.html#RecordFieldExplicit"><span class="hs-identifier hs-var">RecordFieldExplicit</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684562165"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; SrcLoc -&gt; FieldBase Info VName)
-&gt; t TermTypeM Exp -&gt; t TermTypeM (SrcLoc -&gt; FieldBase Info VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TermTypeM Exp -&gt; t TermTypeM Exp
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562164"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t TermTypeM (SrcLoc -&gt; FieldBase Info VName)
-&gt; t TermTypeM SrcLoc -&gt; t TermTypeM (FieldBase Info VName)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; t TermTypeM SrcLoc
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562163"><span class="hs-identifier hs-var">rloc</span></a></span><span>
</span><span id="line-293"></span><span>    </span><span class="annot"><a href="#local-6989586621684562204"><span class="hs-identifier hs-var">checkField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RecordFieldImplicit"><span class="hs-identifier hs-type">RecordFieldImplicit</span></a></span><span> </span><span id="local-6989586621684562160"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684562160"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684562159"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562159"><span class="hs-identifier hs-var">rloc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-294"></span><span>      </span><span class="annot"><span class="annottext">Name -&gt; SrcLoc -&gt; t TermTypeM ()
forall {a} {b} {t :: (* -&gt; *) -&gt; * -&gt; *} {m :: * -&gt; *} {a}.
(MonadState (Map a b) (t m), Ord a, MonadTrans t,
 MonadTypeChecker m, Pretty a, Located a, Located b) =&gt;
a -&gt; a -&gt; t m ()
</span><a href="#local-6989586621684562162"><span class="hs-identifier hs-var">errIfAlreadySet</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684562160"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562159"><span class="hs-identifier hs-var">rloc</span></a></span><span>
</span><span id="line-295"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#QualName"><span class="hs-identifier hs-type">QualName</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684562157"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562157"><span class="hs-identifier hs-var">name'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562156"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562156"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TermTypeM (QualName VName, TypeBase (DimDecl VName) Aliasing)
-&gt; t TermTypeM (QualName VName, TypeBase (DimDecl VName) Aliasing)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TermTypeM (QualName VName, TypeBase (DimDecl VName) Aliasing)
 -&gt; t TermTypeM (QualName VName, TypeBase (DimDecl VName) Aliasing))
-&gt; TermTypeM (QualName VName, TypeBase (DimDecl VName) Aliasing)
-&gt; t TermTypeM (QualName VName, TypeBase (DimDecl VName) Aliasing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; QualName Name
-&gt; TermTypeM (QualName VName, TypeBase (DimDecl VName) Aliasing)
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
SrcLoc
-&gt; QualName Name
-&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Monad.html#lookupVar"><span class="hs-identifier hs-var">lookupVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562159"><span class="hs-identifier hs-var">rloc</span></a></span><span> </span><span class="annot"><span class="annottext">(QualName Name
 -&gt; TermTypeM (QualName VName, TypeBase (DimDecl VName) Aliasing))
-&gt; QualName Name
-&gt; TermTypeM (QualName VName, TypeBase (DimDecl VName) Aliasing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; QualName Name
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684562160"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-296"></span><span>      </span><span class="annot"><span class="annottext">(Map Name SrcLoc -&gt; Map Name SrcLoc) -&gt; t TermTypeM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((Map Name SrcLoc -&gt; Map Name SrcLoc) -&gt; t TermTypeM ())
-&gt; (Map Name SrcLoc -&gt; Map Name SrcLoc) -&gt; t TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SrcLoc -&gt; Map Name SrcLoc -&gt; Map Name SrcLoc
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684562160"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562159"><span class="hs-identifier hs-var">rloc</span></a></span><span>
</span><span id="line-297"></span><span>      </span><span class="annot"><span class="annottext">FieldBase Info VName -&gt; t TermTypeM (FieldBase Info VName)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(FieldBase Info VName -&gt; t TermTypeM (FieldBase Info VName))
-&gt; FieldBase Info VName -&gt; t TermTypeM (FieldBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
-&gt; SrcLoc
-&gt; FieldBase Info VName
forall (f :: * -&gt; *) vn.
vn
-&gt; f (TypeBase (DimDecl VName) Aliasing)
-&gt; SrcLoc
-&gt; FieldBase f vn
</span><a href="Language.Futhark.Syntax.html#RecordFieldImplicit"><span class="hs-identifier hs-var">RecordFieldImplicit</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562157"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562156"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562159"><span class="hs-identifier hs-var">rloc</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span>    </span><span id="local-6989586621684562162"><span class="annot"><span class="annottext">errIfAlreadySet :: a -&gt; a -&gt; t m ()
</span><a href="#local-6989586621684562162"><span class="hs-identifier hs-var hs-var">errIfAlreadySet</span></a></span></span><span> </span><span id="local-6989586621684562127"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684562127"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621684562126"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684562126"><span class="hs-identifier hs-var">rloc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-300"></span><span>      </span><span id="local-6989586621684562125"><span class="annot"><span class="annottext">Maybe b
</span><a href="#local-6989586621684562125"><span class="hs-identifier hs-var">maybe_sloc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Map a b -&gt; Maybe b) -&gt; t m (Maybe b)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">((Map a b -&gt; Maybe b) -&gt; t m (Maybe b))
-&gt; (Map a b -&gt; Maybe b) -&gt; t m (Maybe b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Map a b -&gt; Maybe b
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684562127"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-301"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe b
</span><a href="#local-6989586621684562125"><span class="hs-identifier hs-var">maybe_sloc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-302"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684562124"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621684562124"><span class="hs-identifier hs-var">sloc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-303"></span><span>          </span><span class="annot"><span class="annottext">m () -&gt; t m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; t m ()) -&gt; (Doc -&gt; m ()) -&gt; Doc -&gt; t m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Notes -&gt; Doc -&gt; m ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684562126"><span class="hs-identifier hs-var">rloc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; t m ()) -&gt; Doc -&gt; t m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-304"></span><span>            </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Field&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684562127"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>              </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;previously defined at&quot;</span></span><span>
</span><span id="line-306"></span><span>              </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b -&gt; String
forall a b. (Located a, Located b) =&gt; a -&gt; b -&gt; String
</span><a href="Language.Futhark.Core.html#locStrRel"><span class="hs-identifier hs-var">locStrRel</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684562126"><span class="hs-identifier hs-var">rloc</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621684562124"><span class="hs-identifier hs-var">sloc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-307"></span><span>        </span><span class="annot"><span class="annottext">Maybe b
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; t m ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ArrayLit"><span class="hs-identifier hs-type">ArrayLit</span></a></span><span> </span><span id="local-6989586621684562120"><span class="annot"><span class="annottext">[ExpBase NoInfo Name]
</span><a href="#local-6989586621684562120"><span class="hs-identifier hs-var">all_es</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) Aliasing)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684562119"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562119"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-309"></span><span>  </span><span class="hs-comment">-- Construct the result type and unify all elements with it.  We</span><span>
</span><span id="line-310"></span><span>  </span><span class="hs-comment">-- only create a type variable for empty arrays; otherwise we use</span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-comment">-- the type of the first element.  This significantly cuts down on</span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-comment">-- the number of type variables generated for pathologically large</span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-comment">-- multidimensional array literals.</span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[ExpBase NoInfo Name]
</span><a href="#local-6989586621684562120"><span class="hs-identifier hs-var">all_es</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-316"></span><span>      </span><span id="local-6989586621684562118"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562118"><span class="hs-identifier hs-var">et</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Name -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall (m :: * -&gt; *) als dim.
(MonadUnify m, Monoid als) =&gt;
SrcLoc -&gt; Name -&gt; m (TypeBase dim als)
</span><a href="Language.Futhark.TypeChecker.Unify.html#newTypeVar"><span class="hs-identifier hs-var">newTypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562119"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;t&quot;</span></span><span>
</span><span id="line-317"></span><span>      </span><span id="local-6989586621684562117"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562117"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; ShapeDecl (DimDecl VName)
-&gt; Uniqueness
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall dim as.
(Pretty (ShapeDecl dim), Monoid as) =&gt;
SrcLoc
-&gt; TypeBase dim as
-&gt; ShapeDecl dim
-&gt; Uniqueness
-&gt; TermTypeM (TypeBase dim as)
</span><a href="Language.Futhark.TypeChecker.Terms.html#arrayOfM"><span class="hs-identifier hs-var">arrayOfM</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562119"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562118"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DimDecl VName] -&gt; ShapeDecl (DimDecl VName)
forall dim. [dim] -&gt; ShapeDecl dim
</span><a href="Language.Futhark.Syntax.html#ShapeDecl"><span class="hs-identifier hs-var">ShapeDecl</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; DimDecl VName
forall vn. Int -&gt; DimDecl vn
</span><a href="Language.Futhark.Syntax.html#ConstDim"><span class="hs-identifier hs-var">ConstDim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Unique"><span class="hs-identifier hs-var">Unique</span></a></span><span>
</span><span id="line-318"></span><span>      </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Info (TypeBase (DimDecl VName) Aliasing) -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn.
[ExpBase f vn]
-&gt; f (TypeBase (DimDecl VName) Aliasing) -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#ArrayLit"><span class="hs-identifier hs-var">ArrayLit</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562117"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562119"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-319"></span><span>    </span><span id="local-6989586621684562113"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562113"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684562112"><span class="annot"><span class="annottext">[ExpBase NoInfo Name]
</span><a href="#local-6989586621684562112"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-320"></span><span>      </span><span id="local-6989586621684562111"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562111"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562113"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-321"></span><span>      </span><span id="local-6989586621684562110"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562110"><span class="hs-identifier hs-var">et</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expType"><span class="hs-identifier hs-var">expType</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562111"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-322"></span><span>      </span><span id="local-6989586621684562109"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621684562109"><span class="hs-identifier hs-var">es'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ExpBase NoInfo Name -&gt; TermTypeM Exp)
-&gt; [ExpBase NoInfo Name] -&gt; TermTypeM [Exp]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; TypeBase (DimDecl VName) () -&gt; Exp -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#unifies"><span class="hs-identifier hs-var">unifies</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;type of first array element&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562110"><span class="hs-identifier hs-var">et</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp)
-&gt; (ExpBase NoInfo Name -&gt; TermTypeM Exp)
-&gt; ExpBase NoInfo Name
-&gt; TermTypeM Exp
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ExpBase NoInfo Name]
</span><a href="#local-6989586621684562112"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-323"></span><span>      </span><span id="local-6989586621684562106"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562106"><span class="hs-identifier hs-var">et'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall a (m :: * -&gt; *). (Substitutable a, MonadUnify m) =&gt; a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Unify.html#normTypeFully"><span class="hs-identifier hs-var">normTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562110"><span class="hs-identifier hs-var">et</span></a></span><span>
</span><span id="line-324"></span><span>      </span><span id="local-6989586621684562105"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562105"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; ShapeDecl (DimDecl VName)
-&gt; Uniqueness
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall dim as.
(Pretty (ShapeDecl dim), Monoid as) =&gt;
SrcLoc
-&gt; TypeBase dim as
-&gt; ShapeDecl dim
-&gt; Uniqueness
-&gt; TermTypeM (TypeBase dim as)
</span><a href="Language.Futhark.TypeChecker.Terms.html#arrayOfM"><span class="hs-identifier hs-var">arrayOfM</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562119"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562106"><span class="hs-identifier hs-var">et'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DimDecl VName] -&gt; ShapeDecl (DimDecl VName)
forall dim. [dim] -&gt; ShapeDecl dim
</span><a href="Language.Futhark.Syntax.html#ShapeDecl"><span class="hs-identifier hs-var">ShapeDecl</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; DimDecl VName
forall vn. Int -&gt; DimDecl vn
</span><a href="Language.Futhark.Syntax.html#ConstDim"><span class="hs-identifier hs-var">ConstDim</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; DimDecl VName) -&gt; Int -&gt; DimDecl VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ExpBase NoInfo Name] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[ExpBase NoInfo Name]
</span><a href="#local-6989586621684562120"><span class="hs-identifier hs-var">all_es</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Unique"><span class="hs-identifier hs-var">Unique</span></a></span><span>
</span><span id="line-325"></span><span>      </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Info (TypeBase (DimDecl VName) Aliasing) -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn.
[ExpBase f vn]
-&gt; f (TypeBase (DimDecl VName) Aliasing) -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#ArrayLit"><span class="hs-identifier hs-var">ArrayLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562111"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; [Exp] -&gt; [Exp]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621684562109"><span class="hs-identifier hs-var">es'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562105"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562119"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-326"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Range"><span class="hs-identifier hs-type">Range</span></a></span><span> </span><span id="local-6989586621684562103"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562103"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621684562102"><span class="annot"><span class="annottext">Maybe (ExpBase NoInfo Name)
</span><a href="#local-6989586621684562102"><span class="hs-identifier hs-var">maybe_step</span></a></span></span><span> </span><span id="local-6989586621684562101"><span class="annot"><span class="annottext">Inclusiveness (ExpBase NoInfo Name)
</span><a href="#local-6989586621684562101"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span id="local-6989586621684562100"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562100"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoInfo AppRes
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-327"></span><span>  </span><span id="local-6989586621684562099"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562099"><span class="hs-identifier hs-var">start'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; [PrimType] -&gt; Exp -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#require"><span class="hs-identifier hs-var">require</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;use in range expression&quot;</span></span><span> </span><span class="annot"><span class="annottext">[PrimType]
</span><a href="Language.Futhark.TypeChecker.Monad.html#anySignedType"><span class="hs-identifier hs-var">anySignedType</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; TermTypeM Exp -&gt; TermTypeM Exp
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562103"><span class="hs-identifier hs-var">start</span></a></span><span>
</span><span id="line-328"></span><span>  </span><span id="local-6989586621684562096"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562096"><span class="hs-identifier hs-var">start_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ())
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562099"><span class="hs-identifier hs-var">start'</span></a></span><span>
</span><span id="line-329"></span><span>  </span><span id="local-6989586621684562095"><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562095"><span class="hs-identifier hs-var">maybe_step'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (ExpBase NoInfo Name)
</span><a href="#local-6989586621684562102"><span class="hs-identifier hs-var">maybe_step</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-330"></span><span>    </span><span class="annot"><span class="annottext">Maybe (ExpBase NoInfo Name)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Exp -&gt; TermTypeM (Maybe Exp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe Exp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-331"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684562094"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562094"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-332"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684562090"><span class="annot"><span class="annottext">warning :: TermTypeM ()
</span><a href="#local-6989586621684562090"><span class="hs-identifier hs-var hs-var">warning</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Doc -&gt; TermTypeM ()
forall (m :: * -&gt; *) loc.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Doc -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Monad.html#warn"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562100"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;First and second element of range are identical, this will produce an empty array.&quot;</span></span><span>
</span><span id="line-333"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562103"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562094"><span class="hs-identifier hs-var">step</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-334"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span> </span><span id="local-6989586621684562088"><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684562088"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span> </span><span id="local-6989586621684562087"><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684562087"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TermTypeM () -&gt; TermTypeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684562088"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">PrimValue -&gt; PrimValue -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684562087"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TermTypeM ()
</span><a href="#local-6989586621684562090"><span class="hs-identifier hs-var">warning</span></a></span><span>
</span><span id="line-335"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684562085"><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684562085"><span class="hs-identifier hs-var">x_name</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) Aliasing)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684562084"><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684562084"><span class="hs-identifier hs-var">y_name</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) Aliasing)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TermTypeM () -&gt; TermTypeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684562085"><span class="hs-identifier hs-var">x_name</span></a></span><span> </span><span class="annot"><span class="annottext">QualName Name -&gt; QualName Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684562084"><span class="hs-identifier hs-var">y_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TermTypeM ()
</span><a href="#local-6989586621684562090"><span class="hs-identifier hs-var">warning</span></a></span><span>
</span><span id="line-336"></span><span>        </span><span class="annot"><span class="annottext">(ExpBase NoInfo Name, ExpBase NoInfo Name)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TermTypeM ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>      </span><span class="annot"><span class="annottext">Exp -&gt; Maybe Exp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Maybe Exp) -&gt; TermTypeM Exp -&gt; TermTypeM (Maybe Exp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; TypeBase (DimDecl VName) () -&gt; Exp -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#unifies"><span class="hs-identifier hs-var">unifies</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;use in range expression&quot;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562096"><span class="hs-identifier hs-var">start_t</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; TermTypeM Exp -&gt; TermTypeM Exp
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562094"><span class="hs-identifier hs-var">step</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684562082"><span class="annot"><span class="annottext">unifyRange :: ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="#local-6989586621684562082"><span class="hs-identifier hs-var hs-var">unifyRange</span></a></span></span><span> </span><span id="local-6989586621684562081"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562081"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TypeBase (DimDecl VName) () -&gt; Exp -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#unifies"><span class="hs-identifier hs-var">unifies</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;use in range expression&quot;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562096"><span class="hs-identifier hs-var">start_t</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; TermTypeM Exp -&gt; TermTypeM Exp
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562081"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-340"></span><span>  </span><span id="local-6989586621684562080"><span class="annot"><span class="annottext">Inclusiveness Exp
</span><a href="#local-6989586621684562080"><span class="hs-identifier hs-var">end'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ExpBase NoInfo Name -&gt; TermTypeM Exp)
-&gt; Inclusiveness (ExpBase NoInfo Name)
-&gt; TermTypeM (Inclusiveness Exp)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="#local-6989586621684562082"><span class="hs-identifier hs-var">unifyRange</span></a></span><span> </span><span class="annot"><span class="annottext">Inclusiveness (ExpBase NoInfo Name)
</span><a href="#local-6989586621684562101"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span>  </span><span id="local-6989586621684562079"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562079"><span class="hs-identifier hs-var">end_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Inclusiveness Exp
</span><a href="#local-6989586621684562080"><span class="hs-identifier hs-var">end'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-343"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#DownToExclusive"><span class="hs-identifier hs-type">DownToExclusive</span></a></span><span> </span><span id="local-6989586621684562077"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562077"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expType"><span class="hs-identifier hs-var">expType</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562077"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-344"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#ToInclusive"><span class="hs-identifier hs-type">ToInclusive</span></a></span><span> </span><span id="local-6989586621684562075"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562075"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expType"><span class="hs-identifier hs-var">expType</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562075"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-345"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#UpToExclusive"><span class="hs-identifier hs-type">UpToExclusive</span></a></span><span> </span><span id="local-6989586621684562073"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562073"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expType"><span class="hs-identifier hs-var">expType</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562073"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-comment">-- Special case some ranges to give them a known size.</span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684562072"><span class="annot"><span class="annottext">dimFromBound :: Exp -&gt; TermTypeM (DimDecl VName, Maybe VName)
</span><a href="#local-6989586621684562072"><span class="hs-identifier hs-var hs-var">dimFromBound</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; SizeSource)
-&gt; Exp -&gt; TermTypeM (DimDecl VName, Maybe VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#dimFromExp"><span class="hs-identifier hs-var">dimFromExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpBase NoInfo VName -&gt; SizeSource
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#SourceBound"><span class="hs-identifier hs-var">SourceBound</span></a></span><span> </span><span class="annot"><span class="annottext">(ExpBase NoInfo VName -&gt; SizeSource)
-&gt; (Exp -&gt; ExpBase NoInfo VName) -&gt; Exp -&gt; SizeSource
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; ExpBase NoInfo VName
</span><a href="Language.Futhark.Traversals.html#bareExp"><span class="hs-identifier hs-var">bareExp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684562069"><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684562069"><span class="hs-identifier hs-var">dim</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562068"><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684562068"><span class="hs-identifier hs-var">retext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Maybe Int64
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#isInt64"><span class="hs-identifier hs-var">isInt64</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562099"><span class="hs-identifier hs-var">start'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Maybe Int64
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#isInt64"><span class="hs-identifier hs-var">isInt64</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Maybe Int64) -&gt; Maybe Exp -&gt; Maybe (Maybe Int64)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562095"><span class="hs-identifier hs-var">maybe_step'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Inclusiveness Exp
</span><a href="#local-6989586621684562080"><span class="hs-identifier hs-var">end'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-351"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#UpToExclusive"><span class="hs-identifier hs-type">UpToExclusive</span></a></span><span> </span><span id="local-6989586621684562067"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562067"><span class="hs-identifier hs-var">end''</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Signed"><span class="hs-identifier hs-type">Signed</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562079"><span class="hs-identifier hs-var">end_t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-353"></span><span>          </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (DimDecl VName, Maybe VName)
</span><a href="#local-6989586621684562072"><span class="hs-identifier hs-var">dimFromBound</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562067"><span class="hs-identifier hs-var">end''</span></a></span><span>
</span><span id="line-354"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Maybe Int64)
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#UpToExclusive"><span class="hs-identifier hs-type">UpToExclusive</span></a></span><span> </span><span id="local-6989586621684562064"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562064"><span class="hs-identifier hs-var">end''</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Signed"><span class="hs-identifier hs-type">Signed</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562079"><span class="hs-identifier hs-var">end_t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-356"></span><span>          </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (DimDecl VName, Maybe VName)
</span><a href="#local-6989586621684562072"><span class="hs-identifier hs-var">dimFromBound</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562064"><span class="hs-identifier hs-var">end''</span></a></span><span>
</span><span id="line-357"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#ToInclusive"><span class="hs-identifier hs-type">ToInclusive</span></a></span><span> </span><span id="local-6989586621684562063"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562063"><span class="hs-identifier hs-var">end''</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Signed"><span class="hs-identifier hs-type">Signed</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562079"><span class="hs-identifier hs-var">end_t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-359"></span><span>          </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (DimDecl VName, Maybe VName)
</span><a href="#local-6989586621684562072"><span class="hs-identifier hs-var">dimFromBound</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562063"><span class="hs-identifier hs-var">end''</span></a></span><span>
</span><span id="line-360"></span><span>      </span><span class="annot"><span class="annottext">(Maybe Int64, Maybe (Maybe Int64), Inclusiveness Exp)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-361"></span><span>        </span><span id="local-6989586621684562062"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562062"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Rigidity -&gt; Name -&gt; TermTypeM VName
forall (m :: * -&gt; *).
MonadUnify m =&gt;
SrcLoc -&gt; Rigidity -&gt; Name -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Unify.html#newDimVar"><span class="hs-identifier hs-var">newDimVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562100"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RigidSource -&gt; Rigidity
</span><a href="Language.Futhark.TypeChecker.Unify.html#Rigid"><span class="hs-identifier hs-var">Rigid</span></a></span><span> </span><span class="annot"><span class="annottext">RigidSource
</span><a href="Language.Futhark.TypeChecker.Unify.html#RigidRange"><span class="hs-identifier hs-var">RigidRange</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;range_dim&quot;</span></span><span>
</span><span id="line-362"></span><span>        </span><span class="annot"><span class="annottext">(DimDecl VName, Maybe VName)
-&gt; TermTypeM (DimDecl VName, Maybe VName)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName VName -&gt; DimDecl VName
forall vn. QualName vn -&gt; DimDecl vn
</span><a href="Language.Futhark.Syntax.html#NamedDim"><span class="hs-identifier hs-var">NamedDim</span></a></span><span> </span><span class="annot"><span class="annottext">(QualName VName -&gt; DimDecl VName)
-&gt; QualName VName -&gt; DimDecl VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562062"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Maybe VName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684562062"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span>  </span><span id="local-6989586621684562060"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562060"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; TypeBase (DimDecl VName) ()
-&gt; ShapeDecl (DimDecl VName)
-&gt; Uniqueness
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall dim as.
(Pretty (ShapeDecl dim), Monoid as) =&gt;
SrcLoc
-&gt; TypeBase dim as
-&gt; ShapeDecl dim
-&gt; Uniqueness
-&gt; TermTypeM (TypeBase dim as)
</span><a href="Language.Futhark.TypeChecker.Terms.html#arrayOfM"><span class="hs-identifier hs-var">arrayOfM</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562100"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562096"><span class="hs-identifier hs-var">start_t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DimDecl VName] -&gt; ShapeDecl (DimDecl VName)
forall dim. [dim] -&gt; ShapeDecl dim
</span><a href="Language.Futhark.Syntax.html#ShapeDecl"><span class="hs-identifier hs-var">ShapeDecl</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684562069"><span class="hs-identifier hs-var">dim</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Unique"><span class="hs-identifier hs-var">Unique</span></a></span><span>
</span><span id="line-365"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684562057"><span class="annot"><span class="annottext">res :: AppRes
</span><a href="#local-6989586621684562057"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; [VName] -&gt; AppRes
</span><a href="Language.Futhark.Syntax.html#AppRes"><span class="hs-identifier hs-var">AppRes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684562060"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
-&gt; Aliasing -&gt; TypeBase (DimDecl VName) Aliasing
forall dim asf ast. TypeBase dim asf -&gt; ast -&gt; TypeBase dim ast
</span><a href="Language.Futhark.Prop.html#setAliases"><span class="hs-operator hs-var">`setAliases`</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe VName -&gt; [VName]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684562068"><span class="hs-identifier hs-var">retext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppExpBase Info VName -&gt; Info AppRes -&gt; Exp
forall (f :: * -&gt; *) vn.
AppExpBase f vn -&gt; f AppRes -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-var">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
-&gt; Maybe Exp
-&gt; Inclusiveness Exp
-&gt; SrcLoc
-&gt; AppExpBase Info VName
forall (f :: * -&gt; *) vn.
ExpBase f vn
-&gt; Maybe (ExpBase f vn)
-&gt; Inclusiveness (ExpBase f vn)
-&gt; SrcLoc
-&gt; AppExpBase f vn
</span><a href="Language.Futhark.Syntax.html#Range"><span class="hs-identifier hs-var">Range</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562099"><span class="hs-identifier hs-var">start'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Exp
</span><a href="#local-6989586621684562095"><span class="hs-identifier hs-var">maybe_step'</span></a></span><span> </span><span class="annot"><span class="annottext">Inclusiveness Exp
</span><a href="#local-6989586621684562080"><span class="hs-identifier hs-var">end'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562100"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppRes -&gt; Info AppRes
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">AppRes
</span><a href="#local-6989586621684562057"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Ascript"><span class="hs-identifier hs-type">Ascript</span></a></span><span> </span><span id="local-6989586621684562054"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562054"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684562053"><span class="annot"><span class="annottext">UncheckedTypeDecl
</span><a href="#local-6989586621684562053"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span id="local-6989586621684562052"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562052"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684562051"><span class="annot"><span class="annottext">TypeDecl
</span><a href="#local-6989586621684562051"><span class="hs-identifier hs-var">decl'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562050"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562050"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; UncheckedTypeDecl
-&gt; ExpBase NoInfo Name
-&gt; TermTypeM (TypeDecl, Exp)
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkAscript"><span class="hs-identifier hs-var">checkAscript</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562052"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">UncheckedTypeDecl
</span><a href="#local-6989586621684562053"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562054"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-370"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TypeDecl -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn.
ExpBase f vn -&gt; TypeDeclBase f vn -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#Ascript"><span class="hs-identifier hs-var">Ascript</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562050"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">TypeDecl
</span><a href="#local-6989586621684562051"><span class="hs-identifier hs-var">decl'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562052"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-371"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Coerce"><span class="hs-identifier hs-type">Coerce</span></a></span><span> </span><span id="local-6989586621684562048"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562048"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684562047"><span class="annot"><span class="annottext">UncheckedTypeDecl
</span><a href="#local-6989586621684562047"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span id="local-6989586621684562046"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562046"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoInfo AppRes
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684562045"><span class="annot"><span class="annottext">TypeDecl
</span><a href="#local-6989586621684562045"><span class="hs-identifier hs-var">decl'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562044"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562044"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562043"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684562043"><span class="hs-identifier hs-var">ext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; UncheckedTypeDecl
-&gt; ExpBase NoInfo Name
-&gt; TermTypeM (TypeDecl, Exp, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkCoerce"><span class="hs-identifier hs-var">checkCoerce</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562046"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">UncheckedTypeDecl
</span><a href="#local-6989586621684562047"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562048"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-373"></span><span>  </span><span id="local-6989586621684562042"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562042"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562044"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-374"></span><span>  </span><span id="local-6989586621684562041"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562041"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([VName]
 -&gt; DimDecl VName -&gt; DimDecl VName -&gt; TermTypeM (DimDecl VName))
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall as (m :: * -&gt; *) d1 d2.
(Monoid as, Monad m) =&gt;
([VName] -&gt; d1 -&gt; d2 -&gt; m d1)
-&gt; TypeBase d1 as -&gt; TypeBase d2 as -&gt; m (TypeBase d1 as)
</span><a href="Language.Futhark.Prop.html#matchDims"><span class="hs-identifier hs-var">matchDims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DimDecl VName -&gt; TermTypeM (DimDecl VName))
-&gt; DimDecl VName -&gt; DimDecl VName -&gt; TermTypeM (DimDecl VName)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">((DimDecl VName -&gt; TermTypeM (DimDecl VName))
 -&gt; DimDecl VName -&gt; DimDecl VName -&gt; TermTypeM (DimDecl VName))
-&gt; ([VName] -&gt; DimDecl VName -&gt; TermTypeM (DimDecl VName))
-&gt; [VName]
-&gt; DimDecl VName
-&gt; DimDecl VName
-&gt; TermTypeM (DimDecl VName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(DimDecl VName -&gt; TermTypeM (DimDecl VName))
-&gt; [VName] -&gt; DimDecl VName -&gt; TermTypeM (DimDecl VName)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">DimDecl VName -&gt; TermTypeM (DimDecl VName)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562042"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing))
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. TypeBase dim as -&gt; TypeBase dim Aliasing
</span><a href="Language.Futhark.Prop.html#fromStruct"><span class="hs-identifier hs-var">fromStruct</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; TypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Info (TypeBase (DimDecl VName) ()) -&gt; TypeBase (DimDecl VName) ()
forall a. Info a -&gt; a
</span><a href="Language.Futhark.Syntax.html#unInfo"><span class="hs-identifier hs-var hs-var">unInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Info (TypeBase (DimDecl VName) ()) -&gt; TypeBase (DimDecl VName) ())
-&gt; Info (TypeBase (DimDecl VName) ())
-&gt; TypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeDecl -&gt; Info (TypeBase (DimDecl VName) ())
forall (f :: * -&gt; *) vn.
TypeDeclBase f vn -&gt; f (TypeBase (DimDecl VName) ())
</span><a href="Language.Futhark.Syntax.html#expandedType"><span class="hs-identifier hs-var hs-var">expandedType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeDecl
</span><a href="#local-6989586621684562045"><span class="hs-identifier hs-var">decl'</span></a></span><span>
</span><span id="line-375"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppExpBase Info VName -&gt; Info AppRes -&gt; Exp
forall (f :: * -&gt; *) vn.
AppExpBase f vn -&gt; f AppRes -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-var">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; TypeDecl -&gt; SrcLoc -&gt; AppExpBase Info VName
forall (f :: * -&gt; *) vn.
ExpBase f vn -&gt; TypeDeclBase f vn -&gt; SrcLoc -&gt; AppExpBase f vn
</span><a href="Language.Futhark.Syntax.html#Coerce"><span class="hs-identifier hs-var">Coerce</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562044"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">TypeDecl
</span><a href="#local-6989586621684562045"><span class="hs-identifier hs-var">decl'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562046"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppRes -&gt; Info AppRes
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">(AppRes -&gt; Info AppRes) -&gt; AppRes -&gt; Info AppRes
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; [VName] -&gt; AppRes
</span><a href="Language.Futhark.Syntax.html#AppRes"><span class="hs-identifier hs-var">AppRes</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562041"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684562043"><span class="hs-identifier hs-var">ext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#BinOp"><span class="hs-identifier hs-type">BinOp</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684562035"><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684562035"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562034"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562034"><span class="hs-identifier hs-var">oploc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684562033"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562033"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) (), Maybe VName)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684562032"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562032"><span class="hs-identifier hs-var">e2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) (), Maybe VName)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684562031"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562031"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoInfo AppRes
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-377"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684562030"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684562030"><span class="hs-identifier hs-var">op'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562029"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562029"><span class="hs-identifier hs-var">ftype</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; QualName Name
-&gt; TermTypeM (QualName VName, TypeBase (DimDecl VName) Aliasing)
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
SrcLoc
-&gt; QualName Name
-&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Monad.html#lookupVar"><span class="hs-identifier hs-var">lookupVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562034"><span class="hs-identifier hs-var">oploc</span></a></span><span> </span><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684562035"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-378"></span><span>  </span><span id="local-6989586621684562028"><span class="annot"><span class="annottext">Arg
</span><a href="#local-6989586621684562028"><span class="hs-identifier hs-var">e1_arg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Arg
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkArg"><span class="hs-identifier hs-var">checkArg</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562033"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-379"></span><span>  </span><span id="local-6989586621684562027"><span class="annot"><span class="annottext">Arg
</span><a href="#local-6989586621684562027"><span class="hs-identifier hs-var">e2_arg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Arg
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkArg"><span class="hs-identifier hs-var">checkArg</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562032"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-comment">-- Note that the application to the first operand cannot fix any</span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-comment">-- existential sizes, because it must by necessity be a function.</span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684562026"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562026"><span class="hs-identifier hs-var">p1_t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562025"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562025"><span class="hs-identifier hs-var">rt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562024"><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684562024"><span class="hs-identifier hs-var">p1_ext</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; ApplyOp
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Arg
-&gt; TermTypeM
     (TypeBase (DimDecl VName) Aliasing,
      TypeBase (DimDecl VName) Aliasing, Maybe VName, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkApply"><span class="hs-identifier hs-var">checkApply</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562031"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName VName -&gt; Maybe (QualName VName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684562030"><span class="hs-identifier hs-var">op'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562029"><span class="hs-identifier hs-var">ftype</span></a></span><span> </span><span class="annot"><span class="annottext">Arg
</span><a href="#local-6989586621684562028"><span class="hs-identifier hs-var">e1_arg</span></a></span><span>
</span><span id="line-384"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684562023"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562023"><span class="hs-identifier hs-var">p2_t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562022"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562022"><span class="hs-identifier hs-var">rt'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562021"><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684562021"><span class="hs-identifier hs-var">p2_ext</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562020"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684562020"><span class="hs-identifier hs-var">retext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; ApplyOp
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Arg
-&gt; TermTypeM
     (TypeBase (DimDecl VName) Aliasing,
      TypeBase (DimDecl VName) Aliasing, Maybe VName, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkApply"><span class="hs-identifier hs-var">checkApply</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562031"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName VName -&gt; Maybe (QualName VName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684562030"><span class="hs-identifier hs-var">op'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562025"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Arg
</span><a href="#local-6989586621684562027"><span class="hs-identifier hs-var">e2_arg</span></a></span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-387"></span><span>    </span><span class="annot"><span class="annottext">AppExpBase Info VName -&gt; Info AppRes -&gt; Exp
forall (f :: * -&gt; *) vn.
AppExpBase f vn -&gt; f AppRes -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-var">AppExp</span></a></span><span>
</span><span id="line-388"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(QualName VName, SrcLoc)
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
-&gt; (Exp, Info (TypeBase (DimDecl VName) (), Maybe VName))
-&gt; (Exp, Info (TypeBase (DimDecl VName) (), Maybe VName))
-&gt; SrcLoc
-&gt; AppExpBase Info VName
forall (f :: * -&gt; *) vn.
(QualName vn, SrcLoc)
-&gt; f (TypeBase (DimDecl VName) Aliasing)
-&gt; (ExpBase f vn, f (TypeBase (DimDecl VName) (), Maybe VName))
-&gt; (ExpBase f vn, f (TypeBase (DimDecl VName) (), Maybe VName))
-&gt; SrcLoc
-&gt; AppExpBase f vn
</span><a href="Language.Futhark.Syntax.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span>
</span><span id="line-389"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684562030"><span class="hs-identifier hs-var">op'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562034"><span class="hs-identifier hs-var">oploc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562029"><span class="hs-identifier hs-var">ftype</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg -&gt; Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#argExp"><span class="hs-identifier hs-var">argExp</span></a></span><span> </span><span class="annot"><span class="annottext">Arg
</span><a href="#local-6989586621684562028"><span class="hs-identifier hs-var">e1_arg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) (), Maybe VName)
-&gt; Info (TypeBase (DimDecl VName) (), Maybe VName)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562026"><span class="hs-identifier hs-var">p1_t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684562024"><span class="hs-identifier hs-var">p1_ext</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg -&gt; Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#argExp"><span class="hs-identifier hs-var">argExp</span></a></span><span> </span><span class="annot"><span class="annottext">Arg
</span><a href="#local-6989586621684562027"><span class="hs-identifier hs-var">e2_arg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) (), Maybe VName)
-&gt; Info (TypeBase (DimDecl VName) (), Maybe VName)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562023"><span class="hs-identifier hs-var">p2_t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684562021"><span class="hs-identifier hs-var">p2_ext</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>          </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562031"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-394"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppRes -&gt; Info AppRes
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; [VName] -&gt; AppRes
</span><a href="Language.Futhark.Syntax.html#AppRes"><span class="hs-identifier hs-var">AppRes</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562022"><span class="hs-identifier hs-var">rt'</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684562020"><span class="hs-identifier hs-var">retext</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Project"><span class="hs-identifier hs-type">Project</span></a></span><span> </span><span id="local-6989586621684562018"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684562018"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621684562017"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562017"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684562016"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562016"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-397"></span><span>  </span><span id="local-6989586621684562015"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562015"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562017"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-398"></span><span>  </span><span id="local-6989586621684562014"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562014"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expType"><span class="hs-identifier hs-var">expType</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562015"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-399"></span><span>  </span><span id="local-6989586621684562013"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562013"><span class="hs-identifier hs-var">kt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Usage
-&gt; Name
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage
-&gt; Name
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; m (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Unify.html#mustHaveField"><span class="hs-identifier hs-var">mustHaveField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; String -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562016"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Usage) -&gt; String -&gt; Usage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;projection of field &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="Language.Futhark.Core.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684562018"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684562018"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562014"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-400"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; Exp -&gt; Info (TypeBase (DimDecl VName) Aliasing) -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn.
Name
-&gt; ExpBase f vn
-&gt; f (TypeBase (DimDecl VName) Aliasing)
-&gt; SrcLoc
-&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#Project"><span class="hs-identifier hs-var">Project</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684562018"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562015"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684562013"><span class="hs-identifier hs-var">kt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562016"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-401"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#If"><span class="hs-identifier hs-type">If</span></a></span><span> </span><span id="local-6989586621684562008"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562008"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621684562007"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562007"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621684562006"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562006"><span class="hs-identifier hs-var">e3</span></a></span></span><span> </span><span id="local-6989586621684562005"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562005"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoInfo AppRes
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-402"></span><span>  </span><span class="annot"><span class="annottext">TermTypeM Exp
-&gt; (Exp -&gt; Occurrences -&gt; TermTypeM Exp) -&gt; TermTypeM Exp
forall a b.
TermTypeM a -&gt; (a -&gt; Occurrences -&gt; TermTypeM b) -&gt; TermTypeM b
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#sequentially"><span class="hs-identifier hs-var">sequentially</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM Exp
</span><a href="#local-6989586621684562003"><span class="hs-identifier hs-var">checkCond</span></a></span><span> </span><span class="annot"><span class="annottext">((Exp -&gt; Occurrences -&gt; TermTypeM Exp) -&gt; TermTypeM Exp)
-&gt; (Exp -&gt; Occurrences -&gt; TermTypeM Exp) -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684562002"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562002"><span class="hs-identifier hs-var">e1'</span></a></span></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-403"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621684562001"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562001"><span class="hs-identifier hs-var">e2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684562000"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562000"><span class="hs-identifier hs-var">e3'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561999"><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684561999"><span class="hs-identifier hs-var">dflow</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TermTypeM (Exp, Exp) -&gt; TermTypeM ((Exp, Exp), Occurrences)
forall a. TermTypeM a -&gt; TermTypeM (a, Occurrences)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#tapOccurrences"><span class="hs-identifier hs-var">tapOccurrences</span></a></span><span> </span><span class="annot"><span class="annottext">(TermTypeM (Exp, Exp) -&gt; TermTypeM ((Exp, Exp), Occurrences))
-&gt; TermTypeM (Exp, Exp) -&gt; TermTypeM ((Exp, Exp), Occurrences)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562007"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM Exp -&gt; TermTypeM Exp -&gt; TermTypeM (Exp, Exp)
forall a b. TermTypeM a -&gt; TermTypeM b -&gt; TermTypeM (a, b)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#alternative"><span class="hs-operator hs-var">`alternative`</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562006"><span class="hs-identifier hs-var">e3</span></a></span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684561996"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561996"><span class="hs-identifier hs-var">brancht</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561995"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561995"><span class="hs-identifier hs-var">retext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; Exp
-&gt; Exp
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#unifyBranches"><span class="hs-identifier hs-var">unifyBranches</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562005"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562001"><span class="hs-identifier hs-var">e2'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562000"><span class="hs-identifier hs-var">e3'</span></a></span><span>
</span><span id="line-406"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561993"><span class="annot"><span class="annottext">t' :: TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561993"><span class="hs-identifier hs-var hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; (Aliasing -&gt; Aliasing) -&gt; TypeBase (DimDecl VName) Aliasing
forall dim asf ast.
TypeBase dim asf -&gt; (asf -&gt; ast) -&gt; TypeBase dim ast
</span><a href="Language.Futhark.Prop.html#addAliases"><span class="hs-identifier hs-var">addAliases</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561996"><span class="hs-identifier hs-var">brancht</span></a></span><span> </span><span class="annot"><span class="annottext">((Aliasing -&gt; Aliasing) -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; (Aliasing -&gt; Aliasing) -&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; Bool) -&gt; Aliasing -&gt; Aliasing
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.filter</span></span><span> </span><span class="annot"><span class="annottext">((Alias -&gt; Bool) -&gt; Aliasing -&gt; Aliasing)
-&gt; (Alias -&gt; Bool) -&gt; Aliasing -&gt; Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.notMember`</span></span><span> </span><span class="annot"><span class="annottext">Occurrences -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#allConsumed"><span class="hs-identifier hs-var">allConsumed</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684561999"><span class="hs-identifier hs-var">dflow</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Bool) -&gt; (Alias -&gt; VName) -&gt; Alias -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; VName
</span><a href="Language.Futhark.Syntax.html#aliasVar"><span class="hs-identifier hs-var hs-var">aliasVar</span></a></span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span>    </span><span class="annot"><span class="annottext">Usage
-&gt; String -&gt; TypeBase (DimDecl VName) Aliasing -&gt; TermTypeM ()
forall (m :: * -&gt; *) dim as.
(MonadUnify m, Pretty (ShapeDecl dim), Monoid as) =&gt;
Usage -&gt; String -&gt; TypeBase dim as -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#zeroOrderType"><span class="hs-identifier hs-var">zeroOrderType</span></a></span><span>
</span><span id="line-409"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; String -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562005"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;returning value of this type from 'if' expression&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;type returned from branch&quot;</span></span><span>
</span><span id="line-411"></span><span>      </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561993"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span>    </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppExpBase Info VName -&gt; Info AppRes -&gt; Exp
forall (f :: * -&gt; *) vn.
AppExpBase f vn -&gt; f AppRes -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-var">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp -&gt; SrcLoc -&gt; AppExpBase Info VName
forall (f :: * -&gt; *) vn.
ExpBase f vn
-&gt; ExpBase f vn -&gt; ExpBase f vn -&gt; SrcLoc -&gt; AppExpBase f vn
</span><a href="Language.Futhark.Syntax.html#If"><span class="hs-identifier hs-var">If</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562002"><span class="hs-identifier hs-var">e1'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562001"><span class="hs-identifier hs-var">e2'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684562000"><span class="hs-identifier hs-var">e3'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684562005"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppRes -&gt; Info AppRes
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">(AppRes -&gt; Info AppRes) -&gt; AppRes -&gt; Info AppRes
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; [VName] -&gt; AppRes
</span><a href="Language.Futhark.Syntax.html#AppRes"><span class="hs-identifier hs-var">AppRes</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561993"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561995"><span class="hs-identifier hs-var">retext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-415"></span><span>    </span><span id="local-6989586621684562003"><span class="annot"><span class="annottext">checkCond :: TermTypeM Exp
</span><a href="#local-6989586621684562003"><span class="hs-identifier hs-var hs-var">checkCond</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-416"></span><span>      </span><span id="local-6989586621684561981"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561981"><span class="hs-identifier hs-var">e1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684562008"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-417"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561980"><span class="annot"><span class="annottext">bool :: TypeBase dim as
</span><a href="#local-6989586621684561980"><span class="hs-identifier hs-var hs-var">bool</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase dim as -&gt; TypeBase dim as
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase dim as -&gt; TypeBase dim as)
-&gt; ScalarTypeBase dim as -&gt; TypeBase dim as
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; ScalarTypeBase dim as
forall dim as. PrimType -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Language.Futhark.Syntax.html#Bool"><span class="hs-identifier hs-var">Bool</span></a></span><span>
</span><span id="line-418"></span><span>      </span><span id="local-6989586621684561978"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561978"><span class="hs-identifier hs-var">e1_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ())
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expType"><span class="hs-identifier hs-var">expType</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561981"><span class="hs-identifier hs-var">e1'</span></a></span><span>
</span><span id="line-419"></span><span>      </span><span class="annot"><span class="annottext">Checking -&gt; TermTypeM () -&gt; TermTypeM ()
forall a. Checking -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#onFailure"><span class="hs-identifier hs-var">onFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TypeBase (DimDecl VName) ()]
-&gt; TypeBase (DimDecl VName) () -&gt; Checking
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#CheckingRequired"><span class="hs-identifier hs-var">CheckingRequired</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
forall {dim} {as}. TypeBase dim as
</span><a href="#local-6989586621684561980"><span class="hs-identifier hs-var">bool</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561978"><span class="hs-identifier hs-var">e1_t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM () -&gt; TermTypeM ()) -&gt; TermTypeM () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-420"></span><span>        </span><span class="annot"><span class="annottext">Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; String -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561981"><span class="hs-identifier hs-var">e1'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;use as 'if' condition&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
forall {dim} {as}. TypeBase dim as
</span><a href="#local-6989586621684561980"><span class="hs-identifier hs-var">bool</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561978"><span class="hs-identifier hs-var">e1_t</span></a></span><span>
</span><span id="line-421"></span><span>      </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561981"><span class="hs-identifier hs-var">e1'</span></a></span><span>
</span><span id="line-422"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Parens"><span class="hs-identifier hs-type">Parens</span></a></span><span> </span><span id="local-6989586621684561975"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561975"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684561974"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561974"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-423"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn. ExpBase f vn -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#Parens"><span class="hs-identifier hs-var">Parens</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; SrcLoc -&gt; Exp)
-&gt; TermTypeM Exp -&gt; TermTypeM (SrcLoc -&gt; Exp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561975"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM (SrcLoc -&gt; Exp) -&gt; TermTypeM SrcLoc -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; TermTypeM SrcLoc
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561974"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-424"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#QualParens"><span class="hs-identifier hs-type">QualParens</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684561972"><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684561972"><span class="hs-identifier hs-var">modname</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561971"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561971"><span class="hs-identifier hs-var">modnameloc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684561970"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561970"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684561969"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561969"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-425"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684561968"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561968"><span class="hs-identifier hs-var">modname'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561967"><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684561967"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; QualName Name -&gt; TermTypeM (QualName VName, Mod)
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
SrcLoc -&gt; QualName Name -&gt; m (QualName VName, Mod)
</span><a href="Language.Futhark.TypeChecker.Monad.html#lookupMod"><span class="hs-identifier hs-var">lookupMod</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561969"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684561972"><span class="hs-identifier hs-var">modname</span></a></span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684561967"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-427"></span><span>    </span><span class="annot"><a href="Language.Futhark.Semantic.html#ModEnv"><span class="hs-identifier hs-type">ModEnv</span></a></span><span> </span><span id="local-6989586621684561964"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684561964"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TermEnv -&gt; TermEnv) -&gt; TermTypeM Exp -&gt; TermTypeM Exp
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermEnv -&gt; Env -&gt; TermEnv
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#withEnv"><span class="hs-operator hs-var">`withEnv`</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; Env -&gt; Env
</span><a href="#local-6989586621684561961"><span class="hs-identifier hs-var">qualifyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561968"><span class="hs-identifier hs-var">modname'</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684561964"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM Exp -&gt; TermTypeM Exp) -&gt; TermTypeM Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-428"></span><span>      </span><span id="local-6989586621684561960"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561960"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561970"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-429"></span><span>      </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(QualName VName, SrcLoc) -&gt; Exp -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn.
(QualName vn, SrcLoc) -&gt; ExpBase f vn -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#QualParens"><span class="hs-identifier hs-var">QualParens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561968"><span class="hs-identifier hs-var">modname'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561971"><span class="hs-identifier hs-var">modnameloc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561960"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561969"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-430"></span><span>    </span><span class="annot"><a href="Language.Futhark.Semantic.html#ModFun"><span class="hs-identifier hs-type">ModFun</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-431"></span><span>      </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TermTypeM Exp
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561969"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM Exp) -&gt; (Doc -&gt; Doc) -&gt; Doc -&gt; TermTypeM Exp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Language.Futhark.TypeChecker.Monad.html#withIndexLink"><span class="hs-identifier hs-var">withIndexLink</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;module-is-parametric&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM Exp) -&gt; Doc -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-432"></span><span>        </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Module&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">QualName Name -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684561972"><span class="hs-identifier hs-var">modname</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot; is a parametric module.&quot;</span></span><span>
</span><span id="line-433"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-434"></span><span>    </span><span id="local-6989586621684561961"><span class="annot"><span class="annottext">qualifyEnv :: QualName VName -&gt; Env -&gt; Env
</span><a href="#local-6989586621684561961"><span class="hs-identifier hs-var hs-var">qualifyEnv</span></a></span></span><span> </span><span id="local-6989586621684561957"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561957"><span class="hs-identifier hs-var">modname'</span></a></span></span><span> </span><span id="local-6989586621684561956"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684561956"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-435"></span><span>      </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684561956"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">envNameMap :: NameMap
</span><a href="Language.Futhark.Semantic.html#envNameMap"><span class="hs-identifier hs-var">envNameMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(QualName VName -&gt; QualName VName) -&gt; NameMap -&gt; NameMap
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName VName -&gt; QualName VName -&gt; QualName VName
forall {vn}. QualName vn -&gt; QualName vn -&gt; QualName vn
</span><a href="#local-6989586621684561953"><span class="hs-identifier hs-var">qualify'</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561957"><span class="hs-identifier hs-var">modname'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(NameMap -&gt; NameMap) -&gt; NameMap -&gt; NameMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; NameMap
</span><a href="Language.Futhark.Semantic.html#envNameMap"><span class="hs-identifier hs-var hs-var">envNameMap</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684561956"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-436"></span><span>    </span><span id="local-6989586621684561953"><span class="annot"><span class="annottext">qualify' :: QualName vn -&gt; QualName vn -&gt; QualName vn
</span><a href="#local-6989586621684561953"><span class="hs-identifier hs-var hs-var">qualify'</span></a></span></span><span> </span><span id="local-6989586621684561952"><span class="annot"><span class="annottext">QualName vn
</span><a href="#local-6989586621684561952"><span class="hs-identifier hs-var">modname'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#QualName"><span class="hs-identifier hs-type">QualName</span></a></span><span> </span><span id="local-6989586621684561951"><span class="annot"><span class="annottext">[vn]
</span><a href="#local-6989586621684561951"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span id="local-6989586621684561950"><span class="annot"><span class="annottext">vn
</span><a href="#local-6989586621684561950"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-437"></span><span>      </span><span class="annot"><span class="annottext">[vn] -&gt; vn -&gt; QualName vn
forall vn. [vn] -&gt; vn -&gt; QualName vn
</span><a href="Language.Futhark.Syntax.html#QualName"><span class="hs-identifier hs-var">QualName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName vn -&gt; [vn]
forall vn. QualName vn -&gt; [vn]
</span><a href="Language.Futhark.Syntax.html#qualQuals"><span class="hs-identifier hs-var hs-var">qualQuals</span></a></span><span> </span><span class="annot"><span class="annottext">QualName vn
</span><a href="#local-6989586621684561952"><span class="hs-identifier hs-var">modname'</span></a></span><span> </span><span class="annot"><span class="annottext">[vn] -&gt; [vn] -&gt; [vn]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QualName vn -&gt; vn
forall vn. QualName vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#qualLeaf"><span class="hs-identifier hs-var hs-var">qualLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">QualName vn
</span><a href="#local-6989586621684561952"><span class="hs-identifier hs-var">modname'</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[vn] -&gt; [vn] -&gt; [vn]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[vn]
</span><a href="#local-6989586621684561951"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">vn
</span><a href="#local-6989586621684561950"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-438"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684561948"><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684561948"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684561947"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561947"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-comment">-- The qualifiers of a variable is divided into two parts: first a</span><span>
</span><span id="line-440"></span><span>  </span><span class="hs-comment">-- possibly-empty sequence of module qualifiers, followed by a</span><span>
</span><span id="line-441"></span><span>  </span><span class="hs-comment">-- possible-empty sequence of record field accesses.  We use scope</span><span>
</span><span id="line-442"></span><span>  </span><span class="hs-comment">-- information to perform the split, by taking qualifiers off the</span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-comment">-- end until we find a module.</span><span>
</span><span id="line-444"></span><span>
</span><span id="line-445"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684561946"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561946"><span class="hs-identifier hs-var">qn'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561945"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561945"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561944"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561944"><span class="hs-identifier hs-var">fields</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name]
-&gt; Name
-&gt; TermTypeM
     (QualName VName, TypeBase (DimDecl VName) Aliasing, [Name])
forall {e} {m :: * -&gt; *}.
(MonadError e m, MonadTypeChecker m) =&gt;
[Name]
-&gt; Name
-&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing, [Name])
</span><a href="#local-6989586621684561943"><span class="hs-identifier hs-var">findRootVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName Name -&gt; [Name]
forall vn. QualName vn -&gt; [vn]
</span><a href="Language.Futhark.Syntax.html#qualQuals"><span class="hs-identifier hs-var hs-var">qualQuals</span></a></span><span> </span><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684561948"><span class="hs-identifier hs-var">qn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName Name -&gt; Name
forall vn. QualName vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#qualLeaf"><span class="hs-identifier hs-var hs-var">qualLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684561948"><span class="hs-identifier hs-var">qn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span>  </span><span class="annot"><span class="annottext">(Exp -&gt; Name -&gt; TermTypeM Exp) -&gt; Exp -&gt; [Name] -&gt; TermTypeM Exp
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Name -&gt; TermTypeM Exp
</span><a href="#local-6989586621684561941"><span class="hs-identifier hs-var">checkField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName VName
-&gt; Info (TypeBase (DimDecl VName) Aliasing) -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn.
QualName vn
-&gt; f (TypeBase (DimDecl VName) Aliasing) -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561946"><span class="hs-identifier hs-var">qn'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561945"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561947"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561944"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-448"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-449"></span><span>    </span><span id="local-6989586621684561943"><span class="annot"><span class="annottext">findRootVar :: [Name]
-&gt; Name
-&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing, [Name])
</span><a href="#local-6989586621684561943"><span class="hs-identifier hs-var hs-var">findRootVar</span></a></span></span><span> </span><span id="local-6989586621684561925"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561925"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span id="local-6989586621684561924"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561924"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-450"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(QualName VName, TypeBase (DimDecl VName) Aliasing)
-&gt; (QualName VName, TypeBase (DimDecl VName) Aliasing, [Name])
forall {a} {b} {a}. (a, b) -&gt; (a, b, [a])
</span><a href="#local-6989586621684561923"><span class="hs-identifier hs-var">whenFound</span></a></span><span> </span><span class="annot"><span class="annottext">((QualName VName, TypeBase (DimDecl VName) Aliasing)
 -&gt; (QualName VName, TypeBase (DimDecl VName) Aliasing, [Name]))
-&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing)
-&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing, [Name])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; QualName Name
-&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing)
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
SrcLoc
-&gt; QualName Name
-&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Monad.html#lookupVar"><span class="hs-identifier hs-var">lookupVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561947"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; Name -&gt; QualName Name
forall vn. [vn] -&gt; vn -&gt; QualName vn
</span><a href="Language.Futhark.Syntax.html#QualName"><span class="hs-identifier hs-var">QualName</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561925"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561924"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (QualName VName, TypeBase (DimDecl VName) Aliasing, [Name])
-&gt; (e
    -&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing, [Name]))
-&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing, [Name])
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catchError`</span></span><span> </span><span class="annot"><span class="annottext">[Name]
-&gt; Name
-&gt; e
-&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing, [Name])
</span><a href="#local-6989586621684561921"><span class="hs-identifier hs-var">notFound</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561925"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561924"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span>    </span><span id="local-6989586621684561923"><span class="annot"><span class="annottext">whenFound :: (a, b) -&gt; (a, b, [a])
</span><a href="#local-6989586621684561923"><span class="hs-identifier hs-var hs-var">whenFound</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684561920"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684561920"><span class="hs-identifier hs-var">qn'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561919"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621684561919"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684561920"><span class="hs-identifier hs-var">qn'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621684561919"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span>    </span><span id="local-6989586621684561921"><span class="annot"><span class="annottext">notFound :: [Name]
-&gt; Name
-&gt; e
-&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing, [Name])
</span><a href="#local-6989586621684561921"><span class="hs-identifier hs-var hs-var">notFound</span></a></span></span><span> </span><span id="local-6989586621684561918"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561918"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span id="local-6989586621684561917"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561917"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621684561916"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621684561916"><span class="hs-identifier hs-var">err</span></a></span></span><span>
</span><span id="line-455"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561918"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">e -&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing, [Name])
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621684561916"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-456"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-457"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621684561913"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561913"><span class="hs-identifier hs-var">qn'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561912"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561912"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561911"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561911"><span class="hs-identifier hs-var">fields</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-458"></span><span>          </span><span class="annot"><span class="annottext">[Name]
-&gt; Name
-&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing, [Name])
</span><a href="#local-6989586621684561943"><span class="hs-identifier hs-var">findRootVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; [Name]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">init</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561918"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; Name
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561918"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>            </span><span class="annot"><span class="annottext">m (QualName VName, TypeBase (DimDecl VName) Aliasing, [Name])
-&gt; (e
    -&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing, [Name]))
-&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing, [Name])
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catchError`</span></span><span> </span><span class="annot"><span class="annottext">m (QualName VName, TypeBase (DimDecl VName) Aliasing, [Name])
-&gt; e
-&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing, [Name])
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e -&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing, [Name])
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621684561916"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>        </span><span class="annot"><span class="annottext">(QualName VName, TypeBase (DimDecl VName) Aliasing, [Name])
-&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing, [Name])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561913"><span class="hs-identifier hs-var">qn'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561912"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561911"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; [Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561917"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span>
</span><span id="line-462"></span><span>    </span><span id="local-6989586621684561941"><span class="annot"><span class="annottext">checkField :: Exp -&gt; Name -&gt; TermTypeM Exp
</span><a href="#local-6989586621684561941"><span class="hs-identifier hs-var hs-var">checkField</span></a></span></span><span> </span><span id="local-6989586621684561904"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561904"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684561903"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561903"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-463"></span><span>      </span><span id="local-6989586621684561902"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561902"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expType"><span class="hs-identifier hs-var">expType</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561904"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-464"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561898"><span class="annot"><span class="annottext">usage :: Usage
</span><a href="#local-6989586621684561898"><span class="hs-identifier hs-var hs-var">usage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; String -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561947"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Usage) -&gt; String -&gt; Usage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;projection of field &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="Language.Futhark.Core.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561903"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>      </span><span id="local-6989586621684561897"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561897"><span class="hs-identifier hs-var">kt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Usage
-&gt; Name
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage
-&gt; Name
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; m (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Unify.html#mustHaveField"><span class="hs-identifier hs-var">mustHaveField</span></a></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684561898"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561903"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561902"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-466"></span><span>      </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; Exp -&gt; Info (TypeBase (DimDecl VName) Aliasing) -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn.
Name
-&gt; ExpBase f vn
-&gt; f (TypeBase (DimDecl VName) Aliasing)
-&gt; SrcLoc
-&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#Project"><span class="hs-identifier hs-var">Project</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561903"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561904"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561897"><span class="hs-identifier hs-var">kt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561947"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-467"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Negate"><span class="hs-identifier hs-type">Negate</span></a></span><span> </span><span id="local-6989586621684561895"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561895"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621684561894"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561894"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-468"></span><span>  </span><span id="local-6989586621684561893"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561893"><span class="hs-identifier hs-var">arg'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; [PrimType] -&gt; Exp -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#require"><span class="hs-identifier hs-var">require</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;numeric negation&quot;</span></span><span> </span><span class="annot"><span class="annottext">[PrimType]
</span><a href="Language.Futhark.TypeChecker.Monad.html#anyNumberType"><span class="hs-identifier hs-var">anyNumberType</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; TermTypeM Exp -&gt; TermTypeM Exp
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561895"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-469"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn. ExpBase f vn -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#Negate"><span class="hs-identifier hs-var">Negate</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561893"><span class="hs-identifier hs-var">arg'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561894"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-470"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Not"><span class="hs-identifier hs-type">Not</span></a></span><span> </span><span id="local-6989586621684561891"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561891"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621684561890"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561890"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-471"></span><span>  </span><span id="local-6989586621684561889"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561889"><span class="hs-identifier hs-var">arg'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; [PrimType] -&gt; Exp -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#require"><span class="hs-identifier hs-var">require</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;logical negation&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType
</span><a href="Language.Futhark.Syntax.html#Bool"><span class="hs-identifier hs-var">Bool</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; [PrimType] -&gt; [PrimType]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[PrimType]
</span><a href="Language.Futhark.TypeChecker.Monad.html#anyIntType"><span class="hs-identifier hs-var">anyIntType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; TermTypeM Exp -&gt; TermTypeM Exp
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561891"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-472"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn. ExpBase f vn -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#Not"><span class="hs-identifier hs-var">Not</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561889"><span class="hs-identifier hs-var">arg'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561890"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-473"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span id="local-6989586621684561887"><span class="annot"><span class="annottext">e :: ExpBase NoInfo Name
</span><a href="#local-6989586621684561887"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">NoInfo AppRes
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp, ApplyOp) -&gt; Exp
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Exp, ApplyOp) -&gt; Exp)
-&gt; TermTypeM (Exp, ApplyOp) -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM (Exp, ApplyOp)
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkApplyExp"><span class="hs-identifier hs-var">checkApplyExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561887"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-474"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#LetPat"><span class="hs-identifier hs-type">LetPat</span></a></span><span> </span><span id="local-6989586621684561885"><span class="annot"><span class="annottext">[SizeBinder Name]
</span><a href="#local-6989586621684561885"><span class="hs-identifier hs-var">sizes</span></a></span></span><span> </span><span id="local-6989586621684561884"><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684561884"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684561883"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561883"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684561882"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561882"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621684561881"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561881"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoInfo AppRes
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-475"></span><span>  </span><span class="annot"><span class="annottext">TermTypeM Exp
-&gt; (Exp -&gt; Occurrences -&gt; TermTypeM Exp) -&gt; TermTypeM Exp
forall a b.
TermTypeM a -&gt; (a -&gt; Occurrences -&gt; TermTypeM b) -&gt; TermTypeM b
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#sequentially"><span class="hs-identifier hs-var">sequentially</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561883"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Exp -&gt; Occurrences -&gt; TermTypeM Exp) -&gt; TermTypeM Exp)
-&gt; (Exp -&gt; Occurrences -&gt; TermTypeM Exp) -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684561880"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561880"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span id="local-6989586621684561879"><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684561879"><span class="hs-identifier hs-var">e_occs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-476"></span><span>    </span><span class="hs-comment">-- Not technically an ascription, but we want the pattern to have</span><span>
</span><span id="line-477"></span><span>    </span><span class="hs-comment">-- exactly the type of 'e'.</span><span>
</span><span id="line-478"></span><span>    </span><span id="local-6989586621684561878"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561878"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expType"><span class="hs-identifier hs-var">expType</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561880"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-479"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Occurrences -&gt; Maybe Occurrence
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#anyConsumption"><span class="hs-identifier hs-var">anyConsumption</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684561879"><span class="hs-identifier hs-var">e_occs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-480"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684561876"><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621684561876"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-481"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561872"><span class="annot"><span class="annottext">msg :: String
</span><a href="#local-6989586621684561872"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;type computed with consumption at &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; String
forall a. Located a =&gt; a -&gt; String
</span><a href="Language.Futhark.Core.html#locStr"><span class="hs-identifier hs-var">locStr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Occurrence -&gt; SrcLoc
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#location"><span class="hs-identifier hs-var hs-var">location</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621684561876"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-482"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Usage
-&gt; String -&gt; TypeBase (DimDecl VName) Aliasing -&gt; TermTypeM ()
forall (m :: * -&gt; *) dim as.
(MonadUnify m, Pretty (ShapeDecl dim), Monoid as) =&gt;
Usage -&gt; String -&gt; TypeBase dim as -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#zeroOrderType"><span class="hs-identifier hs-var">zeroOrderType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; String -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561881"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;consumption in right-hand side of 'let'-binding&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684561872"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561878"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-483"></span><span>      </span><span class="annot"><span class="annottext">Maybe Occurrence
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TermTypeM ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span>    </span><span class="annot"><span class="annottext">TermTypeM Exp -&gt; TermTypeM Exp
forall a. TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#incLevel"><span class="hs-identifier hs-var">incLevel</span></a></span><span> </span><span class="annot"><span class="annottext">(TermTypeM Exp -&gt; TermTypeM Exp)
-&gt; (([SizeBinder VName] -&gt; TermTypeM Exp) -&gt; TermTypeM Exp)
-&gt; ([SizeBinder VName] -&gt; TermTypeM Exp)
-&gt; TermTypeM Exp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[SizeBinder Name]
-&gt; ([SizeBinder VName] -&gt; TermTypeM Exp) -&gt; TermTypeM Exp
forall a.
[SizeBinder Name]
-&gt; ([SizeBinder VName] -&gt; TermTypeM a) -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingSizes"><span class="hs-identifier hs-var">bindingSizes</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder Name]
</span><a href="#local-6989586621684561885"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="annot"><span class="annottext">(([SizeBinder VName] -&gt; TermTypeM Exp) -&gt; TermTypeM Exp)
-&gt; ([SizeBinder VName] -&gt; TermTypeM Exp) -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684561867"><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684561867"><span class="hs-identifier hs-var">sizes'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-486"></span><span>      </span><span class="annot"><span class="annottext">[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; (PatBase Info VName -&gt; TermTypeM Exp)
-&gt; TermTypeM Exp
forall a.
[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; (PatBase Info VName -&gt; TermTypeM a)
-&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingPat"><span class="hs-identifier hs-var">bindingPat</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684561867"><span class="hs-identifier hs-var">sizes'</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684561884"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Ascribed"><span class="hs-identifier hs-var">Ascribed</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561878"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PatBase Info VName -&gt; TermTypeM Exp) -&gt; TermTypeM Exp)
-&gt; (PatBase Info VName -&gt; TermTypeM Exp) -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684561864"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561864"><span class="hs-identifier hs-var">pat'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-487"></span><span>        </span><span id="local-6989586621684561863"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561863"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561882"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-488"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621684561862"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561862"><span class="hs-identifier hs-var">body_t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561861"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561861"><span class="hs-identifier hs-var">retext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-489"></span><span>          </span><span class="annot"><span class="annottext">SrcLoc
-&gt; Map VName (IdentBase Info VName)
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#unscopeType"><span class="hs-identifier hs-var">unscopeType</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561881"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SizeBinder VName] -&gt; Map VName (IdentBase Info VName)
</span><a href="#local-6989586621684561860"><span class="hs-identifier hs-var">sizesMap</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684561867"><span class="hs-identifier hs-var">sizes'</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName (IdentBase Info VName)
-&gt; Map VName (IdentBase Info VName)
-&gt; Map VName (IdentBase Info VName)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Map VName (IdentBase Info VName)
forall (f :: * -&gt; *).
Functor f =&gt;
PatBase f VName -&gt; Map VName (IdentBase f VName)
</span><a href="Language.Futhark.Prop.html#patternMap"><span class="hs-identifier hs-var">patternMap</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561864"><span class="hs-identifier hs-var">pat'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName]))
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561863"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span>        </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppExpBase Info VName -&gt; Info AppRes -&gt; Exp
forall (f :: * -&gt; *) vn.
AppExpBase f vn -&gt; f AppRes -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-var">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SizeBinder VName]
-&gt; PatBase Info VName
-&gt; Exp
-&gt; Exp
-&gt; SrcLoc
-&gt; AppExpBase Info VName
forall (f :: * -&gt; *) vn.
[SizeBinder vn]
-&gt; PatBase f vn
-&gt; ExpBase f vn
-&gt; ExpBase f vn
-&gt; SrcLoc
-&gt; AppExpBase f vn
</span><a href="Language.Futhark.Syntax.html#LetPat"><span class="hs-identifier hs-var">LetPat</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684561867"><span class="hs-identifier hs-var">sizes'</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561864"><span class="hs-identifier hs-var">pat'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561880"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561863"><span class="hs-identifier hs-var">body'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561881"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppRes -&gt; Info AppRes
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">(AppRes -&gt; Info AppRes) -&gt; AppRes -&gt; Info AppRes
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; [VName] -&gt; AppRes
</span><a href="Language.Futhark.Syntax.html#AppRes"><span class="hs-identifier hs-var">AppRes</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561862"><span class="hs-identifier hs-var">body_t</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561861"><span class="hs-identifier hs-var">retext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-493"></span><span>    </span><span id="local-6989586621684561860"><span class="annot"><span class="annottext">sizesMap :: [SizeBinder VName] -&gt; Map VName (IdentBase Info VName)
</span><a href="#local-6989586621684561860"><span class="hs-identifier hs-var hs-var">sizesMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SizeBinder VName -&gt; Map VName (IdentBase Info VName))
-&gt; [SizeBinder VName] -&gt; Map VName (IdentBase Info VName)
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">SizeBinder VName -&gt; Map VName (IdentBase Info VName)
forall {vn}. SizeBinder vn -&gt; Map vn (IdentBase Info vn)
</span><a href="#local-6989586621684561854"><span class="hs-identifier hs-var">onSize</span></a></span><span>
</span><span id="line-494"></span><span>    </span><span id="local-6989586621684561854"><span class="annot"><span class="annottext">onSize :: SizeBinder vn -&gt; Map vn (IdentBase Info vn)
</span><a href="#local-6989586621684561854"><span class="hs-identifier hs-var hs-var">onSize</span></a></span></span><span> </span><span id="local-6989586621684561851"><span class="annot"><span class="annottext">SizeBinder vn
</span><a href="#local-6989586621684561851"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-495"></span><span>      </span><span class="annot"><span class="annottext">vn -&gt; IdentBase Info vn -&gt; Map vn (IdentBase Info vn)
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SizeBinder vn -&gt; vn
forall vn. SizeBinder vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#sizeName"><span class="hs-identifier hs-var hs-var">sizeName</span></a></span><span> </span><span class="annot"><span class="annottext">SizeBinder vn
</span><a href="#local-6989586621684561851"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IdentBase Info vn -&gt; Map vn (IdentBase Info vn))
-&gt; IdentBase Info vn -&gt; Map vn (IdentBase Info vn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-496"></span><span>        </span><span class="annot"><span class="annottext">vn
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
-&gt; SrcLoc
-&gt; IdentBase Info vn
forall (f :: * -&gt; *) vn.
vn
-&gt; f (TypeBase (DimDecl VName) Aliasing)
-&gt; SrcLoc
-&gt; IdentBase f vn
</span><a href="Language.Futhark.Syntax.html#Ident"><span class="hs-identifier hs-var">Ident</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SizeBinder vn -&gt; vn
forall vn. SizeBinder vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#sizeName"><span class="hs-identifier hs-var hs-var">sizeName</span></a></span><span> </span><span class="annot"><span class="annottext">SizeBinder vn
</span><a href="#local-6989586621684561851"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) Aliasing
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall dim as. PrimType -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimType -&gt; ScalarTypeBase (DimDecl VName) Aliasing)
-&gt; PrimType -&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Language.Futhark.Syntax.html#Signed"><span class="hs-identifier hs-var">Signed</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SizeBinder vn -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">SizeBinder vn
</span><a href="#local-6989586621684561851"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#LetFun"><span class="hs-identifier hs-type">LetFun</span></a></span><span> </span><span id="local-6989586621684561846"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561846"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684561845"><span class="annot"><span class="annottext">[TypeParamBase Name]
</span><a href="#local-6989586621684561845"><span class="hs-identifier hs-var">tparams</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561844"><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684561844"><span class="hs-identifier hs-var">params</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561843"><span class="annot"><span class="annottext">Maybe UncheckedTypeExp
</span><a href="#local-6989586621684561843"><span class="hs-identifier hs-var">maybe_retdecl</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NoInfo StructRetType
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561842"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561842"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684561841"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561841"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621684561840"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561840"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoInfo AppRes
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-498"></span><span>  </span><span class="annot"><span class="annottext">TermTypeM
  ([TypeParamBase VName], [PatBase Info VName],
   Maybe (TypeExp VName), StructRetType, Exp)
-&gt; (([TypeParamBase VName], [PatBase Info VName],
     Maybe (TypeExp VName), StructRetType, Exp)
    -&gt; Occurrences -&gt; TermTypeM Exp)
-&gt; TermTypeM Exp
forall a b.
TermTypeM a -&gt; (a -&gt; Occurrences -&gt; TermTypeM b) -&gt; TermTypeM b
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#sequentially"><span class="hs-identifier hs-var">sequentially</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name, Maybe UncheckedTypeExp, [TypeParamBase Name],
 [PatBase NoInfo Name], ExpBase NoInfo Name, SrcLoc)
-&gt; TermTypeM
     ([TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkBinding"><span class="hs-identifier hs-var">checkBinding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561846"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe UncheckedTypeExp
</span><a href="#local-6989586621684561843"><span class="hs-identifier hs-var">maybe_retdecl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TypeParamBase Name]
</span><a href="#local-6989586621684561845"><span class="hs-identifier hs-var">tparams</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684561844"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561842"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561840"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((([TypeParamBase VName], [PatBase Info VName],
   Maybe (TypeExp VName), StructRetType, Exp)
  -&gt; Occurrences -&gt; TermTypeM Exp)
 -&gt; TermTypeM Exp)
-&gt; (([TypeParamBase VName], [PatBase Info VName],
     Maybe (TypeExp VName), StructRetType, Exp)
    -&gt; Occurrences -&gt; TermTypeM Exp)
-&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-499"></span><span>    </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621684561838"><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684561838"><span class="hs-identifier hs-var">tparams'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561837"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684561837"><span class="hs-identifier hs-var">params'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561836"><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684561836"><span class="hs-identifier hs-var">maybe_retdecl'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561835"><span class="annot"><span class="annottext">StructRetType
</span><a href="#local-6989586621684561835"><span class="hs-identifier hs-var">rettype</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561834"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561834"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684561833"><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684561833"><span class="hs-identifier hs-var">closure</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-500"></span><span>      </span><span id="local-6989586621684561832"><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561832"><span class="hs-identifier hs-var">closure'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName] -&gt; Occurrences -&gt; TermTypeM Aliasing
</span><a href="Language.Futhark.TypeChecker.Terms.html#lexicalClosure"><span class="hs-identifier hs-var">lexicalClosure</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684561837"><span class="hs-identifier hs-var">params'</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684561833"><span class="hs-identifier hs-var">closure</span></a></span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span>      </span><span class="annot"><span class="annottext">[(Namespace, Name)] -&gt; TermTypeM Exp -&gt; TermTypeM Exp
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
[(Namespace, Name)] -&gt; m a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#bindSpaced"><span class="hs-identifier hs-var">bindSpaced</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561846"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TermTypeM Exp -&gt; TermTypeM Exp) -&gt; TermTypeM Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-503"></span><span>        </span><span id="local-6989586621684561829"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684561829"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Namespace -&gt; Name -&gt; SrcLoc -&gt; TermTypeM VName
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
Namespace -&gt; Name -&gt; SrcLoc -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Monad.html#checkName"><span class="hs-identifier hs-var">checkName</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561846"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561840"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561827"><span class="annot"><span class="annottext">arrow :: (PName, TypeBase dim ())
-&gt; RetTypeBase dim () -&gt; RetTypeBase dim ()
</span><a href="#local-6989586621684561827"><span class="hs-identifier hs-var hs-var">arrow</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684561826"><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684561826"><span class="hs-identifier hs-var">xp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561825"><span class="annot"><span class="annottext">TypeBase dim ()
</span><a href="#local-6989586621684561825"><span class="hs-identifier hs-var">xt</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684561824"><span class="annot"><span class="annottext">RetTypeBase dim ()
</span><a href="#local-6989586621684561824"><span class="hs-identifier hs-var">yt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; TypeBase dim () -&gt; RetTypeBase dim ()
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TypeBase dim () -&gt; RetTypeBase dim ())
-&gt; TypeBase dim () -&gt; RetTypeBase dim ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase dim () -&gt; TypeBase dim ()
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase dim () -&gt; TypeBase dim ())
-&gt; ScalarTypeBase dim () -&gt; TypeBase dim ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">()
-&gt; PName
-&gt; TypeBase dim ()
-&gt; RetTypeBase dim ()
-&gt; ScalarTypeBase dim ()
forall dim as.
as
-&gt; PName
-&gt; TypeBase dim as
-&gt; RetTypeBase dim as
-&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-var">Arrow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684561826"><span class="hs-identifier hs-var">xp</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase dim ()
</span><a href="#local-6989586621684561825"><span class="hs-identifier hs-var">xt</span></a></span><span> </span><span class="annot"><span class="annottext">RetTypeBase dim ()
</span><a href="#local-6989586621684561824"><span class="hs-identifier hs-var">yt</span></a></span><span>
</span><span id="line-506"></span><span>            </span><span class="annot"><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-type">RetType</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561821"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561821"><span class="hs-identifier hs-var">ftype</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; StructRetType -&gt; StructRetType)
-&gt; StructRetType -&gt; [PatBase Info VName] -&gt; StructRetType
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PName, TypeBase (DimDecl VName) ())
-&gt; StructRetType -&gt; StructRetType
forall {dim}.
(PName, TypeBase dim ())
-&gt; RetTypeBase dim () -&gt; RetTypeBase dim ()
</span><a href="#local-6989586621684561827"><span class="hs-identifier hs-var">arrow</span></a></span><span> </span><span class="annot"><span class="annottext">((PName, TypeBase (DimDecl VName) ())
 -&gt; StructRetType -&gt; StructRetType)
-&gt; (PatBase Info VName -&gt; (PName, TypeBase (DimDecl VName) ()))
-&gt; PatBase Info VName
-&gt; StructRetType
-&gt; StructRetType
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; (PName, TypeBase (DimDecl VName) ())
</span><a href="Language.Futhark.Prop.html#patternParam"><span class="hs-identifier hs-var">patternParam</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StructRetType
</span><a href="#local-6989586621684561835"><span class="hs-identifier hs-var">rettype</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684561837"><span class="hs-identifier hs-var">params'</span></a></span><span>
</span><span id="line-507"></span><span>            </span><span id="local-6989586621684561818"><span class="annot"><span class="annottext">entry :: ValBinding
</span><a href="#local-6989586621684561818"><span class="hs-identifier hs-var hs-var">entry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Locality
-&gt; [TypeParamBase VName]
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; ValBinding
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#BoundV"><span class="hs-identifier hs-var">BoundV</span></a></span><span> </span><span class="annot"><span class="annottext">Locality
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Local"><span class="hs-identifier hs-var">Local</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684561838"><span class="hs-identifier hs-var">tparams'</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing -&gt; ValBinding)
-&gt; TypeBase (DimDecl VName) Aliasing -&gt; ValBinding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561821"><span class="hs-identifier hs-var">ftype</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
-&gt; Aliasing -&gt; TypeBase (DimDecl VName) Aliasing
forall dim asf ast. TypeBase dim asf -&gt; ast -&gt; TypeBase dim ast
</span><a href="Language.Futhark.Prop.html#setAliases"><span class="hs-operator hs-var">`setAliases`</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561832"><span class="hs-identifier hs-var">closure'</span></a></span><span>
</span><span id="line-508"></span><span>            </span><span id="local-6989586621684561811"><span class="annot"><span class="annottext">bindF :: TermScope -&gt; TermScope
</span><a href="#local-6989586621684561811"><span class="hs-identifier hs-var hs-var">bindF</span></a></span></span><span> </span><span id="local-6989586621684561810"><span class="annot"><span class="annottext">TermScope
</span><a href="#local-6989586621684561810"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-509"></span><span>              </span><span class="annot"><span class="annottext">TermScope
</span><a href="#local-6989586621684561810"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-510"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scopeVtable :: Map VName ValBinding
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#scopeVtable"><span class="hs-identifier hs-var">scopeVtable</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-511"></span><span>                    </span><span class="annot"><span class="annottext">VName -&gt; ValBinding -&gt; Map VName ValBinding -&gt; Map VName ValBinding
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684561829"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">ValBinding
</span><a href="#local-6989586621684561818"><span class="hs-identifier hs-var">entry</span></a></span><span> </span><span class="annot"><span class="annottext">(Map VName ValBinding -&gt; Map VName ValBinding)
-&gt; Map VName ValBinding -&gt; Map VName ValBinding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TermScope -&gt; Map VName ValBinding
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#scopeVtable"><span class="hs-identifier hs-var hs-var">scopeVtable</span></a></span><span> </span><span class="annot"><span class="annottext">TermScope
</span><a href="#local-6989586621684561810"><span class="hs-identifier hs-var">scope</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-512"></span><span>                  </span><span class="annot"><span class="annottext">scopeNameMap :: NameMap
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#scopeNameMap"><span class="hs-identifier hs-var">scopeNameMap</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-513"></span><span>                    </span><span class="annot"><span class="annottext">(Namespace, Name) -&gt; QualName VName -&gt; NameMap -&gt; NameMap
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561846"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684561829"><span class="hs-identifier hs-var">name'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(NameMap -&gt; NameMap) -&gt; NameMap -&gt; NameMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-514"></span><span>                      </span><span class="annot"><span class="annottext">TermScope -&gt; NameMap
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#scopeNameMap"><span class="hs-identifier hs-var hs-var">scopeNameMap</span></a></span><span> </span><span class="annot"><span class="annottext">TermScope
</span><a href="#local-6989586621684561810"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-515"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-516"></span><span>        </span><span id="local-6989586621684561808"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561808"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TermScope -&gt; TermScope) -&gt; TermTypeM Exp -&gt; TermTypeM Exp
forall a. (TermScope -&gt; TermScope) -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#localScope"><span class="hs-identifier hs-var">localScope</span></a></span><span> </span><span class="annot"><span class="annottext">TermScope -&gt; TermScope
</span><a href="#local-6989586621684561811"><span class="hs-identifier hs-var">bindF</span></a></span><span> </span><span class="annot"><span class="annottext">(TermTypeM Exp -&gt; TermTypeM Exp) -&gt; TermTypeM Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561841"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span>        </span><span class="hs-comment">-- We fake an ident here, but it's OK as it can't be a size</span><span>
</span><span id="line-519"></span><span>        </span><span class="hs-comment">-- anyway.</span><span>
</span><span id="line-520"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561804"><span class="annot"><span class="annottext">fake_ident :: IdentBase Info VName
</span><a href="#local-6989586621684561804"><span class="hs-identifier hs-var hs-var">fake_ident</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
-&gt; SrcLoc
-&gt; IdentBase Info VName
forall (f :: * -&gt; *) vn.
vn
-&gt; f (TypeBase (DimDecl VName) Aliasing)
-&gt; SrcLoc
-&gt; IdentBase f vn
</span><a href="Language.Futhark.Syntax.html#Ident"><span class="hs-identifier hs-var">Ident</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684561829"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; Info (TypeBase (DimDecl VName) Aliasing))
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. TypeBase dim as -&gt; TypeBase dim Aliasing
</span><a href="Language.Futhark.Prop.html#fromStruct"><span class="hs-identifier hs-var">fromStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561821"><span class="hs-identifier hs-var">ftype</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-521"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621684561803"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561803"><span class="hs-identifier hs-var">body_t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561802"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561802"><span class="hs-identifier hs-var">ext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-522"></span><span>          </span><span class="annot"><span class="annottext">SrcLoc
-&gt; Map VName (IdentBase Info VName)
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#unscopeType"><span class="hs-identifier hs-var">unscopeType</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561840"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; IdentBase Info VName -&gt; Map VName (IdentBase Info VName)
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684561829"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684561804"><span class="hs-identifier hs-var">fake_ident</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-523"></span><span>            </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName]))
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561808"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span>        </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-526"></span><span>          </span><span class="annot"><span class="annottext">AppExpBase Info VName -&gt; Info AppRes -&gt; Exp
forall (f :: * -&gt; *) vn.
AppExpBase f vn -&gt; f AppRes -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-var">AppExp</span></a></span><span>
</span><span id="line-527"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">VName
-&gt; ([TypeParamBase VName], [PatBase Info VName],
    Maybe (TypeExp VName), Info StructRetType, Exp)
-&gt; Exp
-&gt; SrcLoc
-&gt; AppExpBase Info VName
forall (f :: * -&gt; *) vn.
vn
-&gt; ([TypeParamBase vn], [PatBase f vn], Maybe (TypeExp vn),
    f StructRetType, ExpBase f vn)
-&gt; ExpBase f vn
-&gt; SrcLoc
-&gt; AppExpBase f vn
</span><a href="Language.Futhark.Syntax.html#LetFun"><span class="hs-identifier hs-var">LetFun</span></a></span><span>
</span><span id="line-528"></span><span>                </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684561829"><span class="hs-identifier hs-var">name'</span></a></span><span>
</span><span id="line-529"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684561838"><span class="hs-identifier hs-var">tparams'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684561837"><span class="hs-identifier hs-var">params'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684561836"><span class="hs-identifier hs-var">maybe_retdecl'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StructRetType -&gt; Info StructRetType
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">StructRetType
</span><a href="#local-6989586621684561835"><span class="hs-identifier hs-var">rettype</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561834"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span>                </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561808"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-531"></span><span>                </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561840"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-532"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-533"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppRes -&gt; Info AppRes
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">(AppRes -&gt; Info AppRes) -&gt; AppRes -&gt; Info AppRes
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; [VName] -&gt; AppRes
</span><a href="Language.Futhark.Syntax.html#AppRes"><span class="hs-identifier hs-var">AppRes</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561803"><span class="hs-identifier hs-var">body_t</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561802"><span class="hs-identifier hs-var">ext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#LetWith"><span class="hs-identifier hs-type">LetWith</span></a></span><span> </span><span id="local-6989586621684561800"><span class="annot"><span class="annottext">IdentBase NoInfo Name
</span><a href="#local-6989586621684561800"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span id="local-6989586621684561799"><span class="annot"><span class="annottext">IdentBase NoInfo Name
</span><a href="#local-6989586621684561799"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621684561798"><span class="annot"><span class="annottext">SliceBase NoInfo Name
</span><a href="#local-6989586621684561798"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span id="local-6989586621684561797"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561797"><span class="hs-identifier hs-var">ve</span></a></span></span><span> </span><span id="local-6989586621684561796"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561796"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621684561795"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561795"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoInfo AppRes
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-535"></span><span>  </span><span class="annot"><span class="annottext">TermTypeM (IdentBase Info VName)
-&gt; (IdentBase Info VName -&gt; Occurrences -&gt; TermTypeM Exp)
-&gt; TermTypeM Exp
forall a b.
TermTypeM a -&gt; (a -&gt; Occurrences -&gt; TermTypeM b) -&gt; TermTypeM b
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#sequentially"><span class="hs-identifier hs-var">sequentially</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdentBase NoInfo Name -&gt; TermTypeM (IdentBase Info VName)
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkIdent"><span class="hs-identifier hs-var">checkIdent</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase NoInfo Name
</span><a href="#local-6989586621684561799"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((IdentBase Info VName -&gt; Occurrences -&gt; TermTypeM Exp)
 -&gt; TermTypeM Exp)
-&gt; (IdentBase Info VName -&gt; Occurrences -&gt; TermTypeM Exp)
-&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684561793"><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684561793"><span class="hs-identifier hs-var">src'</span></a></span></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-536"></span><span>    </span><span id="local-6989586621684561792"><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684561792"><span class="hs-identifier hs-var">slice'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SliceBase NoInfo Name -&gt; TermTypeM Slice
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkSlice"><span class="hs-identifier hs-var">checkSlice</span></a></span><span> </span><span class="annot"><span class="annottext">SliceBase NoInfo Name
</span><a href="#local-6989586621684561798"><span class="hs-identifier hs-var">slice</span></a></span><span>
</span><span id="line-537"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684561790"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561790"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; Name
-&gt; Int
-&gt; TermTypeM
     (TypeBase (DimDecl VName) (), TypeBase (DimDecl VName) ())
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#newArrayType"><span class="hs-identifier hs-var">newArrayType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdentBase NoInfo Name -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">IdentBase NoInfo Name
</span><a href="#local-6989586621684561799"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;src&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Int
 -&gt; TermTypeM
      (TypeBase (DimDecl VName) (), TypeBase (DimDecl VName) ()))
-&gt; Int
-&gt; TermTypeM
     (TypeBase (DimDecl VName) (), TypeBase (DimDecl VName) ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Slice -&gt; Int
</span><a href="Language.Futhark.TypeChecker.Terms.html#sliceDims"><span class="hs-identifier hs-var">sliceDims</span></a></span><span> </span><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684561792"><span class="hs-identifier hs-var">slice'</span></a></span><span>
</span><span id="line-538"></span><span>    </span><span class="annot"><span class="annottext">Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; String -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561795"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;type of target array&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561790"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) () -&gt; TermTypeM ())
-&gt; TypeBase (DimDecl VName) () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ())
-&gt; TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Info (TypeBase (DimDecl VName) Aliasing)
-&gt; TypeBase (DimDecl VName) Aliasing
forall a. Info a -&gt; a
</span><a href="Language.Futhark.Syntax.html#unInfo"><span class="hs-identifier hs-var hs-var">unInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Info (TypeBase (DimDecl VName) Aliasing)
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
-&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall (f :: * -&gt; *) vn.
IdentBase f vn -&gt; f (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.Syntax.html#identType"><span class="hs-identifier hs-var hs-var">identType</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684561793"><span class="hs-identifier hs-var">src'</span></a></span><span>
</span><span id="line-539"></span><span>
</span><span id="line-540"></span><span>    </span><span class="hs-comment">-- Need the fully normalised type here to get the proper aliasing information.</span><span>
</span><span id="line-541"></span><span>    </span><span id="local-6989586621684561786"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561786"><span class="hs-identifier hs-var">src_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall a (m :: * -&gt; *). (Substitutable a, MonadUnify m) =&gt; a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Unify.html#normTypeFully"><span class="hs-identifier hs-var">normTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing))
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Info (TypeBase (DimDecl VName) Aliasing)
-&gt; TypeBase (DimDecl VName) Aliasing
forall a. Info a -&gt; a
</span><a href="Language.Futhark.Syntax.html#unInfo"><span class="hs-identifier hs-var hs-var">unInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Info (TypeBase (DimDecl VName) Aliasing)
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
-&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall (f :: * -&gt; *) vn.
IdentBase f vn -&gt; f (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.Syntax.html#identType"><span class="hs-identifier hs-var hs-var">identType</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684561793"><span class="hs-identifier hs-var">src'</span></a></span><span>
</span><span id="line-542"></span><span>
</span><span id="line-543"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684561785"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561785"><span class="hs-identifier hs-var">elemt</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (SrcLoc, Rigidity)
-&gt; Slice
-&gt; TypeBase (DimDecl VName) ()
-&gt; TermTypeM (TypeBase (DimDecl VName) (), [VName])
forall as.
Maybe (SrcLoc, Rigidity)
-&gt; Slice
-&gt; TypeBase (DimDecl VName) as
-&gt; TermTypeM (TypeBase (DimDecl VName) as, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#sliceShape"><span class="hs-identifier hs-var">sliceShape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SrcLoc, Rigidity) -&gt; Maybe (SrcLoc, Rigidity)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561795"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Rigidity
</span><a href="Language.Futhark.TypeChecker.Unify.html#Nonrigid"><span class="hs-identifier hs-var">Nonrigid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684561792"><span class="hs-identifier hs-var">slice'</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) ()
 -&gt; TermTypeM (TypeBase (DimDecl VName) (), [VName]))
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
-&gt; TermTypeM (TypeBase (DimDecl VName) (), [VName])
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall a (m :: * -&gt; *). (Substitutable a, MonadUnify m) =&gt; a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Unify.html#normTypeFully"><span class="hs-identifier hs-var">normTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561790"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; TermTypeM () -&gt; TermTypeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Bool
forall shape as. TypeBase shape as -&gt; Bool
</span><a href="Language.Futhark.Prop.html#unique"><span class="hs-identifier hs-var">unique</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561786"><span class="hs-identifier hs-var">src_t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM () -&gt; TermTypeM ()) -&gt; TermTypeM () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Doc -&gt; TermTypeM ()
forall (m :: * -&gt; *) b. MonadTypeChecker m =&gt; SrcLoc -&gt; Doc -&gt; m b
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#notConsumable"><span class="hs-identifier hs-var">notConsumable</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561795"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM ()) -&gt; Doc -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Doc
forall v. IsName v =&gt; v -&gt; Doc
</span><a href="Language.Futhark.Pretty.html#pprName"><span class="hs-identifier hs-var">pprName</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Doc) -&gt; Name -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IdentBase NoInfo Name -&gt; Name
forall (f :: * -&gt; *) vn. IdentBase f vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#identName"><span class="hs-identifier hs-var hs-var">identName</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase NoInfo Name
</span><a href="#local-6989586621684561799"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span>    </span><span class="annot"><span class="annottext">TermTypeM Exp
-&gt; (Exp -&gt; Occurrences -&gt; TermTypeM Exp) -&gt; TermTypeM Exp
forall a b.
TermTypeM a -&gt; (a -&gt; Occurrences -&gt; TermTypeM b) -&gt; TermTypeM b
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#sequentially"><span class="hs-identifier hs-var">sequentially</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; TypeBase (DimDecl VName) () -&gt; Exp -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#unifies"><span class="hs-identifier hs-var">unifies</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;type of target array&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561785"><span class="hs-identifier hs-var">elemt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; TermTypeM Exp -&gt; TermTypeM Exp
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561797"><span class="hs-identifier hs-var">ve</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Exp -&gt; Occurrences -&gt; TermTypeM Exp) -&gt; TermTypeM Exp)
-&gt; (Exp -&gt; Occurrences -&gt; TermTypeM Exp) -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684561780"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561780"><span class="hs-identifier hs-var">ve'</span></a></span></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-548"></span><span>      </span><span id="local-6989586621684561779"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561779"><span class="hs-identifier hs-var">ve_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561780"><span class="hs-identifier hs-var">ve'</span></a></span><span>
</span><span id="line-549"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TermTypeM () -&gt; TermTypeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Alias
</span><a href="Language.Futhark.Syntax.html#AliasBound"><span class="hs-identifier hs-var">AliasBound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; VName
forall (f :: * -&gt; *) vn. IdentBase f vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#identName"><span class="hs-identifier hs-var hs-var">identName</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684561793"><span class="hs-identifier hs-var">src'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Aliasing -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Aliasing
forall as shape. Monoid as =&gt; TypeBase shape as -&gt; as
</span><a href="Language.Futhark.Prop.html#aliases"><span class="hs-identifier hs-var">aliases</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561779"><span class="hs-identifier hs-var">ve_t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM () -&gt; TermTypeM ()) -&gt; TermTypeM () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-550"></span><span>        </span><span class="annot"><span class="annottext">IdentBase NoInfo Name
-&gt; ExpBase NoInfo Name -&gt; SrcLoc -&gt; TermTypeM ()
forall arr src a.
(Pretty arr, Pretty src) =&gt;
arr -&gt; src -&gt; SrcLoc -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#badLetWithValue"><span class="hs-identifier hs-var">badLetWithValue</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase NoInfo Name
</span><a href="#local-6989586621684561799"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561797"><span class="hs-identifier hs-var">ve</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561795"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-551"></span><span>
</span><span id="line-552"></span><span>      </span><span class="annot"><span class="annottext">IdentBase NoInfo Name
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; (IdentBase Info VName -&gt; TermTypeM Exp)
-&gt; TermTypeM Exp
forall a.
IdentBase NoInfo Name
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; (IdentBase Info VName -&gt; TermTypeM a)
-&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingIdent"><span class="hs-identifier hs-var">bindingIdent</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase NoInfo Name
</span><a href="#local-6989586621684561800"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561786"><span class="hs-identifier hs-var">src_t</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Aliasing -&gt; TypeBase (DimDecl VName) Aliasing
forall dim asf ast. TypeBase dim asf -&gt; ast -&gt; TypeBase dim ast
</span><a href="Language.Futhark.Prop.html#setAliases"><span class="hs-operator hs-var">`setAliases`</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
forall a. Set a
</span><span class="hs-identifier hs-var">S.empty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((IdentBase Info VName -&gt; TermTypeM Exp) -&gt; TermTypeM Exp)
-&gt; (IdentBase Info VName -&gt; TermTypeM Exp) -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684561774"><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684561774"><span class="hs-identifier hs-var">dest'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-553"></span><span>        </span><span id="local-6989586621684561773"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561773"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; TermTypeM Exp -&gt; TermTypeM Exp
forall a. IdentBase Info VName -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#consuming"><span class="hs-identifier hs-var">consuming</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684561793"><span class="hs-identifier hs-var">src'</span></a></span><span> </span><span class="annot"><span class="annottext">(TermTypeM Exp -&gt; TermTypeM Exp) -&gt; TermTypeM Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561796"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-554"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621684561771"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561771"><span class="hs-identifier hs-var">body_t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561770"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561770"><span class="hs-identifier hs-var">ext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-555"></span><span>          </span><span class="annot"><span class="annottext">SrcLoc
-&gt; Map VName (IdentBase Info VName)
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#unscopeType"><span class="hs-identifier hs-var">unscopeType</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561795"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; IdentBase Info VName -&gt; Map VName (IdentBase Info VName)
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; VName
forall (f :: * -&gt; *) vn. IdentBase f vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#identName"><span class="hs-identifier hs-var hs-var">identName</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684561774"><span class="hs-identifier hs-var">dest'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684561774"><span class="hs-identifier hs-var">dest'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>            </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName]))
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561773"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-557"></span><span>        </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppExpBase Info VName -&gt; Info AppRes -&gt; Exp
forall (f :: * -&gt; *) vn.
AppExpBase f vn -&gt; f AppRes -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-var">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdentBase Info VName
-&gt; IdentBase Info VName
-&gt; Slice
-&gt; Exp
-&gt; Exp
-&gt; SrcLoc
-&gt; AppExpBase Info VName
forall (f :: * -&gt; *) vn.
IdentBase f vn
-&gt; IdentBase f vn
-&gt; SliceBase f vn
-&gt; ExpBase f vn
-&gt; ExpBase f vn
-&gt; SrcLoc
-&gt; AppExpBase f vn
</span><a href="Language.Futhark.Syntax.html#LetWith"><span class="hs-identifier hs-var">LetWith</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684561774"><span class="hs-identifier hs-var">dest'</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684561793"><span class="hs-identifier hs-var">src'</span></a></span><span> </span><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684561792"><span class="hs-identifier hs-var">slice'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561780"><span class="hs-identifier hs-var">ve'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561773"><span class="hs-identifier hs-var">body'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561795"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppRes -&gt; Info AppRes
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">(AppRes -&gt; Info AppRes) -&gt; AppRes -&gt; Info AppRes
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; [VName] -&gt; AppRes
</span><a href="Language.Futhark.Syntax.html#AppRes"><span class="hs-identifier hs-var">AppRes</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561771"><span class="hs-identifier hs-var">body_t</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561770"><span class="hs-identifier hs-var">ext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-558"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Update"><span class="hs-identifier hs-type">Update</span></a></span><span> </span><span id="local-6989586621684561768"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561768"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621684561767"><span class="annot"><span class="annottext">SliceBase NoInfo Name
</span><a href="#local-6989586621684561767"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span id="local-6989586621684561766"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561766"><span class="hs-identifier hs-var">ve</span></a></span></span><span> </span><span id="local-6989586621684561765"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561765"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-559"></span><span>  </span><span id="local-6989586621684561764"><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684561764"><span class="hs-identifier hs-var">slice'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SliceBase NoInfo Name -&gt; TermTypeM Slice
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkSlice"><span class="hs-identifier hs-var">checkSlice</span></a></span><span> </span><span class="annot"><span class="annottext">SliceBase NoInfo Name
</span><a href="#local-6989586621684561767"><span class="hs-identifier hs-var">slice</span></a></span><span>
</span><span id="line-560"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684561763"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561763"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; Name
-&gt; Int
-&gt; TermTypeM
     (TypeBase (DimDecl VName) (), TypeBase (DimDecl VName) ())
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#newArrayType"><span class="hs-identifier hs-var">newArrayType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561768"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;src&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Int
 -&gt; TermTypeM
      (TypeBase (DimDecl VName) (), TypeBase (DimDecl VName) ()))
-&gt; Int
-&gt; TermTypeM
     (TypeBase (DimDecl VName) (), TypeBase (DimDecl VName) ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Slice -&gt; Int
</span><a href="Language.Futhark.TypeChecker.Terms.html#sliceDims"><span class="hs-identifier hs-var">sliceDims</span></a></span><span> </span><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684561764"><span class="hs-identifier hs-var">slice'</span></a></span><span>
</span><span id="line-561"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684561762"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561762"><span class="hs-identifier hs-var">elemt</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (SrcLoc, Rigidity)
-&gt; Slice
-&gt; TypeBase (DimDecl VName) ()
-&gt; TermTypeM (TypeBase (DimDecl VName) (), [VName])
forall as.
Maybe (SrcLoc, Rigidity)
-&gt; Slice
-&gt; TypeBase (DimDecl VName) as
-&gt; TermTypeM (TypeBase (DimDecl VName) as, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#sliceShape"><span class="hs-identifier hs-var">sliceShape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SrcLoc, Rigidity) -&gt; Maybe (SrcLoc, Rigidity)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561765"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Rigidity
</span><a href="Language.Futhark.TypeChecker.Unify.html#Nonrigid"><span class="hs-identifier hs-var">Nonrigid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684561764"><span class="hs-identifier hs-var">slice'</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) ()
 -&gt; TermTypeM (TypeBase (DimDecl VName) (), [VName]))
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
-&gt; TermTypeM (TypeBase (DimDecl VName) (), [VName])
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall a (m :: * -&gt; *). (Substitutable a, MonadUnify m) =&gt; a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Unify.html#normTypeFully"><span class="hs-identifier hs-var">normTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561763"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-562"></span><span>
</span><span id="line-563"></span><span>  </span><span class="annot"><span class="annottext">TermTypeM Exp
-&gt; (Exp -&gt; Occurrences -&gt; TermTypeM Exp) -&gt; TermTypeM Exp
forall a b.
TermTypeM a -&gt; (a -&gt; Occurrences -&gt; TermTypeM b) -&gt; TermTypeM b
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#sequentially"><span class="hs-identifier hs-var">sequentially</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561766"><span class="hs-identifier hs-var">ve</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM Exp -&gt; (Exp -&gt; TermTypeM Exp) -&gt; TermTypeM Exp
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; TypeBase (DimDecl VName) () -&gt; Exp -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#unifies"><span class="hs-identifier hs-var">unifies</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;type of target array&quot;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561762"><span class="hs-identifier hs-var">elemt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Exp -&gt; Occurrences -&gt; TermTypeM Exp) -&gt; TermTypeM Exp)
-&gt; (Exp -&gt; Occurrences -&gt; TermTypeM Exp) -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684561761"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561761"><span class="hs-identifier hs-var">ve'</span></a></span></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-564"></span><span>    </span><span class="annot"><span class="annottext">TermTypeM Exp
-&gt; (Exp -&gt; Occurrences -&gt; TermTypeM Exp) -&gt; TermTypeM Exp
forall a b.
TermTypeM a -&gt; (a -&gt; Occurrences -&gt; TermTypeM b) -&gt; TermTypeM b
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#sequentially"><span class="hs-identifier hs-var">sequentially</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561768"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM Exp -&gt; (Exp -&gt; TermTypeM Exp) -&gt; TermTypeM Exp
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; TypeBase (DimDecl VName) () -&gt; Exp -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#unifies"><span class="hs-identifier hs-var">unifies</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;type of target array&quot;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561763"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Exp -&gt; Occurrences -&gt; TermTypeM Exp) -&gt; TermTypeM Exp)
-&gt; (Exp -&gt; Occurrences -&gt; TermTypeM Exp) -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684561760"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561760"><span class="hs-identifier hs-var">src'</span></a></span></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-565"></span><span>      </span><span id="local-6989586621684561759"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561759"><span class="hs-identifier hs-var">src_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561760"><span class="hs-identifier hs-var">src'</span></a></span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TermTypeM () -&gt; TermTypeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Bool
forall shape as. TypeBase shape as -&gt; Bool
</span><a href="Language.Futhark.Prop.html#unique"><span class="hs-identifier hs-var">unique</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561759"><span class="hs-identifier hs-var">src_t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM () -&gt; TermTypeM ()) -&gt; TermTypeM () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Doc -&gt; TermTypeM ()
forall (m :: * -&gt; *) b. MonadTypeChecker m =&gt; SrcLoc -&gt; Doc -&gt; m b
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#notConsumable"><span class="hs-identifier hs-var">notConsumable</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561765"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM ()) -&gt; Doc -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561768"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-568"></span><span>
</span><span id="line-569"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561756"><span class="annot"><span class="annottext">src_als :: Aliasing
</span><a href="#local-6989586621684561756"><span class="hs-identifier hs-var hs-var">src_als</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Aliasing
forall as shape. Monoid as =&gt; TypeBase shape as -&gt; as
</span><a href="Language.Futhark.Prop.html#aliases"><span class="hs-identifier hs-var">aliases</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561759"><span class="hs-identifier hs-var">src_t</span></a></span><span>
</span><span id="line-570"></span><span>      </span><span id="local-6989586621684561755"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561755"><span class="hs-identifier hs-var">ve_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561761"><span class="hs-identifier hs-var">ve'</span></a></span><span>
</span><span id="line-571"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TermTypeM () -&gt; TermTypeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Aliasing -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">S.null</span></span><span> </span><span class="annot"><span class="annottext">(Aliasing -&gt; Bool) -&gt; Aliasing -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561756"><span class="hs-identifier hs-var">src_als</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing -&gt; Aliasing -&gt; Aliasing
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`S.intersection`</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Aliasing
forall as shape. Monoid as =&gt; TypeBase shape as -&gt; as
</span><a href="Language.Futhark.Prop.html#aliases"><span class="hs-identifier hs-var">aliases</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561755"><span class="hs-identifier hs-var">ve_t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM () -&gt; TermTypeM ()) -&gt; TermTypeM () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
-&gt; ExpBase NoInfo Name -&gt; SrcLoc -&gt; TermTypeM ()
forall arr src a.
(Pretty arr, Pretty src) =&gt;
arr -&gt; src -&gt; SrcLoc -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#badLetWithValue"><span class="hs-identifier hs-var">badLetWithValue</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561768"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561766"><span class="hs-identifier hs-var">ve</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561765"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-572"></span><span>
</span><span id="line-573"></span><span>      </span><span class="annot"><span class="annottext">SrcLoc -&gt; Aliasing -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#consume"><span class="hs-identifier hs-var">consume</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561765"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561756"><span class="hs-identifier hs-var">src_als</span></a></span><span>
</span><span id="line-574"></span><span>      </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Slice -&gt; Exp -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn.
ExpBase f vn
-&gt; SliceBase f vn -&gt; ExpBase f vn -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#Update"><span class="hs-identifier hs-var">Update</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561760"><span class="hs-identifier hs-var">src'</span></a></span><span> </span><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684561764"><span class="hs-identifier hs-var">slice'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561761"><span class="hs-identifier hs-var">ve'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561765"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span class="hs-comment">-- Record updates are a bit hacky, because we do not have row typing</span><span>
</span><span id="line-577"></span><span class="hs-comment">-- (yet?).  For now, we only permit record updates where we know the</span><span>
</span><span id="line-578"></span><span class="hs-comment">-- full type up to the field we are updating.</span><span>
</span><span id="line-579"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RecordUpdate"><span class="hs-identifier hs-type">RecordUpdate</span></a></span><span> </span><span id="local-6989586621684561750"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561750"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621684561749"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561749"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span id="local-6989586621684561748"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561748"><span class="hs-identifier hs-var">ve</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684561747"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561747"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-580"></span><span>  </span><span id="local-6989586621684561746"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561746"><span class="hs-identifier hs-var">src'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561750"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-581"></span><span>  </span><span id="local-6989586621684561745"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561745"><span class="hs-identifier hs-var">ve'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561748"><span class="hs-identifier hs-var">ve</span></a></span><span>
</span><span id="line-582"></span><span>  </span><span id="local-6989586621684561744"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561744"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561746"><span class="hs-identifier hs-var">src'</span></a></span><span>
</span><span id="line-583"></span><span>  </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; Name -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing))
-&gt; TypeBase (DimDecl VName) Aliasing -&gt; [Name] -&gt; TermTypeM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">foldM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name
 -&gt; TypeBase (DimDecl VName) Aliasing
 -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing))
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Name
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">((Name
  -&gt; TypeBase (DimDecl VName) Aliasing
  -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing))
 -&gt; TypeBase (DimDecl VName) Aliasing
 -&gt; Name
 -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing))
-&gt; (Name
    -&gt; TypeBase (DimDecl VName) Aliasing
    -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing))
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Name
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Usage
-&gt; Name
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage
-&gt; Name
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; m (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Unify.html#mustHaveField"><span class="hs-identifier hs-var">mustHaveField</span></a></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684561741"><span class="hs-identifier hs-var">usage</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561744"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561749"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-584"></span><span>  </span><span id="local-6989586621684561740"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561740"><span class="hs-identifier hs-var">ve_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expType"><span class="hs-identifier hs-var">expType</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561745"><span class="hs-identifier hs-var">ve'</span></a></span><span>
</span><span id="line-585"></span><span>  </span><span id="local-6989586621684561739"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561739"><span class="hs-identifier hs-var">updated_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name]
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall {as}.
[Name]
-&gt; TypeBase (DimDecl VName) as
-&gt; TypeBase (DimDecl VName) as
-&gt; TermTypeM (TypeBase (DimDecl VName) as)
</span><a href="#local-6989586621684561738"><span class="hs-identifier hs-var">updateField</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561749"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561740"><span class="hs-identifier hs-var">ve_t</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing))
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561746"><span class="hs-identifier hs-var">src'</span></a></span><span>
</span><span id="line-586"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp
-&gt; [Name]
-&gt; Exp
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
-&gt; SrcLoc
-&gt; Exp
forall (f :: * -&gt; *) vn.
ExpBase f vn
-&gt; [Name]
-&gt; ExpBase f vn
-&gt; f (TypeBase (DimDecl VName) Aliasing)
-&gt; SrcLoc
-&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#RecordUpdate"><span class="hs-identifier hs-var">RecordUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561746"><span class="hs-identifier hs-var">src'</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561749"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561745"><span class="hs-identifier hs-var">ve'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561739"><span class="hs-identifier hs-var">updated_t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561747"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-587"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-588"></span><span>    </span><span id="local-6989586621684561741"><span class="annot"><span class="annottext">usage :: Usage
</span><a href="#local-6989586621684561741"><span class="hs-identifier hs-var hs-var">usage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; String -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561747"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;record update&quot;</span></span><span>
</span><span id="line-589"></span><span>    </span><span id="local-6989586621684561738"><span class="annot"><span class="annottext">updateField :: [Name]
-&gt; TypeBase (DimDecl VName) as
-&gt; TypeBase (DimDecl VName) as
-&gt; TermTypeM (TypeBase (DimDecl VName) as)
</span><a href="#local-6989586621684561738"><span class="hs-identifier hs-var hs-var">updateField</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621684561719"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561719"><span class="hs-identifier hs-var">ve_t</span></a></span></span><span> </span><span id="local-6989586621684561718"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561718"><span class="hs-identifier hs-var">src_t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-590"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684561717"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561717"><span class="hs-identifier hs-var">src_t'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map VName (DimDecl VName)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; Rigidity
-&gt; Name
-&gt; TypeBase (DimDecl VName) as
-&gt; TermTypeM
     (TypeBase (DimDecl VName) as, Map VName (DimDecl VName))
forall als.
SrcLoc
-&gt; Rigidity
-&gt; Name
-&gt; TypeBase (DimDecl VName) als
-&gt; TermTypeM
     (TypeBase (DimDecl VName) als, Map VName (DimDecl VName))
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#allDimsFreshInType"><span class="hs-identifier hs-var">allDimsFreshInType</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561747"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Rigidity
</span><a href="Language.Futhark.TypeChecker.Unify.html#Nonrigid"><span class="hs-identifier hs-var">Nonrigid</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;any&quot;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561718"><span class="hs-identifier hs-var">src_t</span></a></span><span>
</span><span id="line-591"></span><span>      </span><span class="annot"><span class="annottext">Checking -&gt; TermTypeM () -&gt; TermTypeM ()
forall a. Checking -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#onFailure"><span class="hs-identifier hs-var">onFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name]
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; Checking
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#CheckingRecordUpdate"><span class="hs-identifier hs-var">CheckingRecordUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561749"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561717"><span class="hs-identifier hs-var">src_t'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561719"><span class="hs-identifier hs-var">ve_t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM () -&gt; TermTypeM ()) -&gt; TermTypeM () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-592"></span><span>        </span><span class="annot"><span class="annottext">Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684561741"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561717"><span class="hs-identifier hs-var">src_t'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561719"><span class="hs-identifier hs-var">ve_t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span>      </span><span class="hs-comment">-- Important that we return ve_t so that we get the right aliases.</span><span>
</span><span id="line-594"></span><span>      </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
-&gt; TermTypeM (TypeBase (DimDecl VName) as)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561719"><span class="hs-identifier hs-var">ve_t</span></a></span><span>
</span><span id="line-595"></span><span>    </span><span class="annot"><a href="#local-6989586621684561738"><span class="hs-identifier hs-var">updateField</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684561715"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561715"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684561714"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561714"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684561713"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561713"><span class="hs-identifier hs-var">ve_t</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span id="local-6989586621684561712"><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) as)
</span><a href="#local-6989586621684561712"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-596"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684561711"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561711"><span class="hs-identifier hs-var">f_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; Map Name (TypeBase (DimDecl VName) as)
-&gt; Maybe (TypeBase (DimDecl VName) as)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561715"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) as)
</span><a href="#local-6989586621684561712"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-597"></span><span>        </span><span id="local-6989586621684561710"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561710"><span class="hs-identifier hs-var">f_t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name]
-&gt; TypeBase (DimDecl VName) as
-&gt; TypeBase (DimDecl VName) as
-&gt; TermTypeM (TypeBase (DimDecl VName) as)
</span><a href="#local-6989586621684561738"><span class="hs-identifier hs-var">updateField</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561714"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561713"><span class="hs-identifier hs-var">ve_t</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561711"><span class="hs-identifier hs-var">f_t</span></a></span><span>
</span><span id="line-598"></span><span>        </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
-&gt; TermTypeM (TypeBase (DimDecl VName) as)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) as
 -&gt; TermTypeM (TypeBase (DimDecl VName) as))
-&gt; TypeBase (DimDecl VName) as
-&gt; TermTypeM (TypeBase (DimDecl VName) as)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) as -&gt; TypeBase (DimDecl VName) as
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) as -&gt; TypeBase (DimDecl VName) as)
-&gt; ScalarTypeBase (DimDecl VName) as -&gt; TypeBase (DimDecl VName) as
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) as)
-&gt; ScalarTypeBase (DimDecl VName) as
forall dim as. Map Name (TypeBase dim as) -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-var">Record</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Name (TypeBase (DimDecl VName) as)
 -&gt; ScalarTypeBase (DimDecl VName) as)
-&gt; Map Name (TypeBase (DimDecl VName) as)
-&gt; ScalarTypeBase (DimDecl VName) as
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; TypeBase (DimDecl VName) as
-&gt; Map Name (TypeBase (DimDecl VName) as)
-&gt; Map Name (TypeBase (DimDecl VName) as)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561715"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561710"><span class="hs-identifier hs-var">f_t'</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) as)
</span><a href="#local-6989586621684561712"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-599"></span><span>    </span><span class="annot"><a href="#local-6989586621684561738"><span class="hs-identifier hs-var">updateField</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-600"></span><span>      </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TermTypeM (TypeBase (DimDecl VName) as)
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561747"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM (TypeBase (DimDecl VName) as))
-&gt; (Doc -&gt; Doc) -&gt; Doc -&gt; TermTypeM (TypeBase (DimDecl VName) as)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Language.Futhark.TypeChecker.Monad.html#withIndexLink"><span class="hs-identifier hs-var">withIndexLink</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;record-type-not-known&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM (TypeBase (DimDecl VName) as))
-&gt; Doc -&gt; TermTypeM (TypeBase (DimDecl VName) as)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-601"></span><span>        </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Full type of&quot;</span></span><span>
</span><span id="line-602"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
</span><span class="hs-identifier hs-var">indent</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561750"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc
</span><a href="Futhark.Util.Pretty.html#textwrap"><span class="hs-identifier hs-var">textwrap</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; is not known at this point.  Add a type annotation to the original record to disambiguate.&quot;</span></span><span>
</span><span id="line-604"></span><span>
</span><span id="line-605"></span><span class="hs-comment">--</span><span>
</span><span id="line-606"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span id="local-6989586621684561705"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561705"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684561704"><span class="annot"><span class="annottext">SliceBase NoInfo Name
</span><a href="#local-6989586621684561704"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span id="local-6989586621684561703"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561703"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoInfo AppRes
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-607"></span><span>  </span><span id="local-6989586621684561702"><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684561702"><span class="hs-identifier hs-var">slice'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SliceBase NoInfo Name -&gt; TermTypeM Slice
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkSlice"><span class="hs-identifier hs-var">checkSlice</span></a></span><span> </span><span class="annot"><span class="annottext">SliceBase NoInfo Name
</span><a href="#local-6989586621684561704"><span class="hs-identifier hs-var">slice</span></a></span><span>
</span><span id="line-608"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684561701"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561701"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; Name
-&gt; Int
-&gt; TermTypeM
     (TypeBase (DimDecl VName) (), TypeBase (DimDecl VName) ())
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#newArrayType"><span class="hs-identifier hs-var">newArrayType</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561703"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;e&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Int
 -&gt; TermTypeM
      (TypeBase (DimDecl VName) (), TypeBase (DimDecl VName) ()))
-&gt; Int
-&gt; TermTypeM
     (TypeBase (DimDecl VName) (), TypeBase (DimDecl VName) ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Slice -&gt; Int
</span><a href="Language.Futhark.TypeChecker.Terms.html#sliceDims"><span class="hs-identifier hs-var">sliceDims</span></a></span><span> </span><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684561702"><span class="hs-identifier hs-var">slice'</span></a></span><span>
</span><span id="line-609"></span><span>  </span><span id="local-6989586621684561700"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561700"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; TypeBase (DimDecl VName) () -&gt; Exp -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#unifies"><span class="hs-identifier hs-var">unifies</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;being indexed at&quot;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561701"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; TermTypeM Exp -&gt; TermTypeM Exp
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561705"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-610"></span><span>  </span><span class="hs-comment">-- XXX, the RigidSlice here will be overridden in sliceShape with a proper value.</span><span>
</span><span id="line-611"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684561699"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561699"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561698"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561698"><span class="hs-identifier hs-var">retext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-612"></span><span>    </span><span class="annot"><span class="annottext">Maybe (SrcLoc, Rigidity)
-&gt; Slice
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
forall as.
Maybe (SrcLoc, Rigidity)
-&gt; Slice
-&gt; TypeBase (DimDecl VName) as
-&gt; TermTypeM (TypeBase (DimDecl VName) as, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#sliceShape"><span class="hs-identifier hs-var">sliceShape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SrcLoc, Rigidity) -&gt; Maybe (SrcLoc, Rigidity)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561703"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RigidSource -&gt; Rigidity
</span><a href="Language.Futhark.TypeChecker.Unify.html#Rigid"><span class="hs-identifier hs-var">Rigid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (DimDecl VName) -&gt; String -&gt; RigidSource
</span><a href="Language.Futhark.TypeChecker.Unify.html#RigidSlice"><span class="hs-identifier hs-var">RigidSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (DimDecl VName)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684561702"><span class="hs-identifier hs-var">slice'</span></a></span><span>
</span><span id="line-613"></span><span>      </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName]))
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561700"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-614"></span><span>
</span><span id="line-615"></span><span>  </span><span class="hs-comment">-- Remove aliases if the result is an overloaded type, because that</span><span>
</span><span id="line-616"></span><span>  </span><span class="hs-comment">-- will certainly not be aliased.</span><span>
</span><span id="line-617"></span><span>  </span><span id="local-6989586621684561696"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561696"><span class="hs-identifier hs-var">t''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.html#noAliasesIfOverloaded"><span class="hs-identifier hs-var">noAliasesIfOverloaded</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561699"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-618"></span><span>
</span><span id="line-619"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppExpBase Info VName -&gt; Info AppRes -&gt; Exp
forall (f :: * -&gt; *) vn.
AppExpBase f vn -&gt; f AppRes -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-var">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Slice -&gt; SrcLoc -&gt; AppExpBase Info VName
forall (f :: * -&gt; *) vn.
ExpBase f vn -&gt; SliceBase f vn -&gt; SrcLoc -&gt; AppExpBase f vn
</span><a href="Language.Futhark.Syntax.html#Index"><span class="hs-identifier hs-var">Index</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561700"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684561702"><span class="hs-identifier hs-var">slice'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561703"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppRes -&gt; Info AppRes
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">(AppRes -&gt; Info AppRes) -&gt; AppRes -&gt; Info AppRes
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; [VName] -&gt; AppRes
</span><a href="Language.Futhark.Syntax.html#AppRes"><span class="hs-identifier hs-var">AppRes</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561696"><span class="hs-identifier hs-var">t''</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561698"><span class="hs-identifier hs-var">retext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Assert"><span class="hs-identifier hs-type">Assert</span></a></span><span> </span><span id="local-6989586621684561694"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561694"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621684561693"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561693"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo String
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684561692"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561692"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-621"></span><span>  </span><span id="local-6989586621684561691"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561691"><span class="hs-identifier hs-var">e1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; [PrimType] -&gt; Exp -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#require"><span class="hs-identifier hs-var">require</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;being asserted&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PrimType
</span><a href="Language.Futhark.Syntax.html#Bool"><span class="hs-identifier hs-var">Bool</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; TermTypeM Exp -&gt; TermTypeM Exp
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561694"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-622"></span><span>  </span><span id="local-6989586621684561690"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561690"><span class="hs-identifier hs-var">e2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561693"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-623"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Info String -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn.
ExpBase f vn -&gt; ExpBase f vn -&gt; f String -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#Assert"><span class="hs-identifier hs-var">Assert</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561691"><span class="hs-identifier hs-var">e1'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561690"><span class="hs-identifier hs-var">e2'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Info String
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561694"><span class="hs-identifier hs-var">e1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561692"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-624"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span id="local-6989586621684561688"><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684561688"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621684561687"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561687"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621684561686"><span class="annot"><span class="annottext">Maybe UncheckedTypeExp
</span><a href="#local-6989586621684561686"><span class="hs-identifier hs-var">rettype_te</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (Aliasing, StructRetType)
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684561685"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561685"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-625"></span><span>  </span><span class="annot"><span class="annottext">TermTypeM Exp -&gt; TermTypeM Exp
forall a. TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#removeSeminullOccurrences"><span class="hs-identifier hs-var">removeSeminullOccurrences</span></a></span><span> </span><span class="annot"><span class="annottext">(TermTypeM Exp -&gt; TermTypeM Exp)
-&gt; (([TypeParamBase VName]
     -&gt; [PatBase Info VName] -&gt; TermTypeM Exp)
    -&gt; TermTypeM Exp)
-&gt; ([TypeParamBase VName] -&gt; [PatBase Info VName] -&gt; TermTypeM Exp)
-&gt; TermTypeM Exp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TermTypeM Exp -&gt; TermTypeM Exp
forall a. TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#noUnique"><span class="hs-identifier hs-var">noUnique</span></a></span><span> </span><span class="annot"><span class="annottext">(TermTypeM Exp -&gt; TermTypeM Exp)
-&gt; (([TypeParamBase VName]
     -&gt; [PatBase Info VName] -&gt; TermTypeM Exp)
    -&gt; TermTypeM Exp)
-&gt; ([TypeParamBase VName] -&gt; [PatBase Info VName] -&gt; TermTypeM Exp)
-&gt; TermTypeM Exp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TermTypeM Exp -&gt; TermTypeM Exp
forall a. TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#incLevel"><span class="hs-identifier hs-var">incLevel</span></a></span><span> </span><span class="annot"><span class="annottext">(TermTypeM Exp -&gt; TermTypeM Exp)
-&gt; (([TypeParamBase VName]
     -&gt; [PatBase Info VName] -&gt; TermTypeM Exp)
    -&gt; TermTypeM Exp)
-&gt; ([TypeParamBase VName] -&gt; [PatBase Info VName] -&gt; TermTypeM Exp)
-&gt; TermTypeM Exp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase Name]
-&gt; [PatBase NoInfo Name]
-&gt; ([TypeParamBase VName] -&gt; [PatBase Info VName] -&gt; TermTypeM Exp)
-&gt; TermTypeM Exp
forall a.
[TypeParamBase Name]
-&gt; [PatBase NoInfo Name]
-&gt; ([TypeParamBase VName] -&gt; [PatBase Info VName] -&gt; TermTypeM a)
-&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingParams"><span class="hs-identifier hs-var">bindingParams</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684561688"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">(([TypeParamBase VName] -&gt; [PatBase Info VName] -&gt; TermTypeM Exp)
 -&gt; TermTypeM Exp)
-&gt; ([TypeParamBase VName] -&gt; [PatBase Info VName] -&gt; TermTypeM Exp)
-&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561681"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684561681"><span class="hs-identifier hs-var">params'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-626"></span><span>    </span><span id="local-6989586621684561680"><span class="annot"><span class="annottext">Maybe (TypeExp VName, TypeBase (DimDecl VName) (), [VName])
</span><a href="#local-6989586621684561680"><span class="hs-identifier hs-var">rettype_checked</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(UncheckedTypeExp
 -&gt; TermTypeM (TypeExp VName, TypeBase (DimDecl VName) (), [VName]))
-&gt; Maybe UncheckedTypeExp
-&gt; TermTypeM
     (Maybe (TypeExp VName, TypeBase (DimDecl VName) (), [VName]))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">UncheckedTypeExp
-&gt; TermTypeM (TypeExp VName, TypeBase (DimDecl VName) (), [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#checkTypeExpNonrigid"><span class="hs-identifier hs-var">checkTypeExpNonrigid</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UncheckedTypeExp
</span><a href="#local-6989586621684561686"><span class="hs-identifier hs-var">rettype_te</span></a></span><span>
</span><span id="line-627"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561679"><span class="annot"><span class="annottext">declared_rettype :: Maybe (TypeBase (DimDecl VName) ())
</span><a href="#local-6989586621684561679"><span class="hs-identifier hs-var hs-var">declared_rettype</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-628"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName, TypeBase (DimDecl VName) (), [VName])
</span><a href="#local-6989586621684561680"><span class="hs-identifier hs-var">rettype_checked</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-629"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeExp VName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561678"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561678"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; Maybe (TypeBase (DimDecl VName) ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561678"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-630"></span><span>            </span><span class="annot"><span class="annottext">Maybe (TypeExp VName, TypeBase (DimDecl VName) (), [VName])
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (TypeBase (DimDecl VName) ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-631"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684561677"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561677"><span class="hs-identifier hs-var">body'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561676"><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684561676"><span class="hs-identifier hs-var">closure</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-632"></span><span>      </span><span class="annot"><span class="annottext">TermTypeM Exp -&gt; TermTypeM (Exp, Occurrences)
forall a. TermTypeM a -&gt; TermTypeM (a, Occurrences)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#tapOccurrences"><span class="hs-identifier hs-var">tapOccurrences</span></a></span><span> </span><span class="annot"><span class="annottext">(TermTypeM Exp -&gt; TermTypeM (Exp, Occurrences))
-&gt; TermTypeM Exp -&gt; TermTypeM (Exp, Occurrences)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
-&gt; ExpBase NoInfo Name
-&gt; Maybe (TypeBase (DimDecl VName) ())
-&gt; SrcLoc
-&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkFunBody"><span class="hs-identifier hs-var">checkFunBody</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684561681"><span class="hs-identifier hs-var">params'</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561687"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeBase (DimDecl VName) ())
</span><a href="#local-6989586621684561679"><span class="hs-identifier hs-var">declared_rettype</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561685"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-633"></span><span>    </span><span id="local-6989586621684561674"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561674"><span class="hs-identifier hs-var">body_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561677"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-634"></span><span>
</span><span id="line-635"></span><span>    </span><span id="local-6989586621684561673"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684561673"><span class="hs-identifier hs-var">params''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; TermTypeM (PatBase Info VName))
-&gt; [PatBase Info VName] -&gt; TermTypeM [PatBase Info VName]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall e. ASTMappable e =&gt; e -&gt; TermTypeM e
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#updateTypes"><span class="hs-identifier hs-var">updateTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684561681"><span class="hs-identifier hs-var">params'</span></a></span><span>
</span><span id="line-636"></span><span>
</span><span id="line-637"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684561671"><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684561671"><span class="hs-identifier hs-var">rettype'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561670"><span class="annot"><span class="annottext">StructRetType
</span><a href="#local-6989586621684561670"><span class="hs-identifier hs-var">rettype_st</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-638"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName, TypeBase (DimDecl VName) (), [VName])
</span><a href="#local-6989586621684561680"><span class="hs-identifier hs-var">rettype_checked</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-639"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684561669"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684561669"><span class="hs-identifier hs-var">te</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561668"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561668"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561667"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561667"><span class="hs-identifier hs-var">ext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-640"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561666"><span class="annot"><span class="annottext">st_structural :: TypeBase () ()
</span><a href="#local-6989586621684561666"><span class="hs-identifier hs-var hs-var">st_structural</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; TypeBase () ()
forall dim as. TypeBase dim as -&gt; TypeBase () ()
</span><a href="Language.Futhark.Prop.html#toStructural"><span class="hs-identifier hs-var">toStructural</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561668"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-641"></span><span>          </span><span class="annot"><span class="annottext">SrcLoc
-&gt; TypeBase () ()
-&gt; [PatBase Info VName]
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkReturnAlias"><span class="hs-identifier hs-var">checkReturnAlias</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561685"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase () ()
</span><a href="#local-6989586621684561666"><span class="hs-identifier hs-var">st_structural</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684561673"><span class="hs-identifier hs-var">params''</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561674"><span class="hs-identifier hs-var">body_t</span></a></span><span>
</span><span id="line-642"></span><span>          </span><span class="annot"><span class="annottext">(Maybe (TypeExp VName), StructRetType)
-&gt; TermTypeM (Maybe (TypeExp VName), StructRetType)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeExp VName -&gt; Maybe (TypeExp VName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684561669"><span class="hs-identifier hs-var">te</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; TypeBase (DimDecl VName) () -&gt; StructRetType
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561667"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561668"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span>        </span><span class="annot"><span class="annottext">Maybe (TypeExp VName, TypeBase (DimDecl VName) (), [VName])
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-644"></span><span>          </span><span id="local-6989586621684561663"><span class="annot"><span class="annottext">StructRetType
</span><a href="#local-6989586621684561663"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-645"></span><span>            </span><span class="annot"><span class="annottext">[PatBase Info VName]
-&gt; TypeBase (DimDecl VName) () -&gt; TermTypeM StructRetType
forall {m :: * -&gt; *}.
MonadUnify m =&gt;
[PatBase Info VName]
-&gt; TypeBase (DimDecl VName) () -&gt; m StructRetType
</span><a href="#local-6989586621684561662"><span class="hs-identifier hs-var">inferReturnSizes</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684561673"><span class="hs-identifier hs-var">params''</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) () -&gt; TermTypeM StructRetType)
-&gt; (TypeBase (DimDecl VName) Aliasing
    -&gt; TypeBase (DimDecl VName) ())
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM StructRetType
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing -&gt; TermTypeM StructRetType)
-&gt; TypeBase (DimDecl VName) Aliasing -&gt; TermTypeM StructRetType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-646"></span><span>              </span><span class="annot"><span class="annottext">[PatBase Info VName]
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
</span><a href="Language.Futhark.TypeChecker.Terms.html#inferReturnUniqueness"><span class="hs-identifier hs-var">inferReturnUniqueness</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684561673"><span class="hs-identifier hs-var">params''</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561674"><span class="hs-identifier hs-var">body_t</span></a></span><span>
</span><span id="line-647"></span><span>          </span><span class="annot"><span class="annottext">(Maybe (TypeExp VName), StructRetType)
-&gt; TermTypeM (Maybe (TypeExp VName), StructRetType)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StructRetType
</span><a href="#local-6989586621684561663"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span>    </span><span class="annot"><span class="annottext">[PatBase Info VName]
-&gt; TypeBase (DimDecl VName) Aliasing -&gt; SrcLoc -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkGlobalAliases"><span class="hs-identifier hs-var">checkGlobalAliases</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684561681"><span class="hs-identifier hs-var">params'</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561674"><span class="hs-identifier hs-var">body_t</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561685"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-650"></span><span>    </span><span class="annot"><span class="annottext">Maybe Name -&gt; [PatBase Info VName] -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#verifyFunctionParams"><span class="hs-identifier hs-var">verifyFunctionParams</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684561681"><span class="hs-identifier hs-var">params'</span></a></span><span>
</span><span id="line-651"></span><span>
</span><span id="line-652"></span><span>    </span><span id="local-6989586621684561658"><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561658"><span class="hs-identifier hs-var">closure'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName] -&gt; Occurrences -&gt; TermTypeM Aliasing
</span><a href="Language.Futhark.TypeChecker.Terms.html#lexicalClosure"><span class="hs-identifier hs-var">lexicalClosure</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684561673"><span class="hs-identifier hs-var">params''</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684561676"><span class="hs-identifier hs-var">closure</span></a></span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span>    </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
-&gt; Exp
-&gt; Maybe (TypeExp VName)
-&gt; Info (Aliasing, StructRetType)
-&gt; SrcLoc
-&gt; Exp
forall (f :: * -&gt; *) vn.
[PatBase f vn]
-&gt; ExpBase f vn
-&gt; Maybe (TypeExp vn)
-&gt; f (Aliasing, StructRetType)
-&gt; SrcLoc
-&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#Lambda"><span class="hs-identifier hs-var">Lambda</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684561673"><span class="hs-identifier hs-var">params''</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561677"><span class="hs-identifier hs-var">body'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684561671"><span class="hs-identifier hs-var">rettype'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Aliasing, StructRetType) -&gt; Info (Aliasing, StructRetType)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561658"><span class="hs-identifier hs-var">closure'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StructRetType
</span><a href="#local-6989586621684561670"><span class="hs-identifier hs-var">rettype_st</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561685"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-655"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-656"></span><span>    </span><span class="hs-comment">-- Inferring the sizes of the return type of a lambda is a lot</span><span>
</span><span id="line-657"></span><span>    </span><span class="hs-comment">-- like let-generalisation.  We wish to remove any rigid sizes</span><span>
</span><span id="line-658"></span><span>    </span><span class="hs-comment">-- that were created when checking the body, except for those that</span><span>
</span><span id="line-659"></span><span>    </span><span class="hs-comment">-- are visible in types that existed before we entered the body,</span><span>
</span><span id="line-660"></span><span>    </span><span class="hs-comment">-- are parameters, or are used in parameters.</span><span>
</span><span id="line-661"></span><span>    </span><span id="local-6989586621684561662"><span class="annot"><span class="annottext">inferReturnSizes :: [PatBase Info VName]
-&gt; TypeBase (DimDecl VName) () -&gt; m StructRetType
</span><a href="#local-6989586621684561662"><span class="hs-identifier hs-var hs-var">inferReturnSizes</span></a></span></span><span> </span><span id="local-6989586621684561644"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684561644"><span class="hs-identifier hs-var">params'</span></a></span></span><span> </span><span id="local-6989586621684561643"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561643"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-662"></span><span>      </span><span id="local-6989586621684561642"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684561642"><span class="hs-identifier hs-var">cur_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Int
forall (m :: * -&gt; *). MonadUnify m =&gt; m Int
</span><a href="Language.Futhark.TypeChecker.Unify.html#curLevel"><span class="hs-identifier hs-var">curLevel</span></a></span><span>
</span><span id="line-663"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561640"><span class="annot"><span class="annottext">named :: (PName, b) -&gt; Maybe VName
</span><a href="#local-6989586621684561640"><span class="hs-identifier hs-var hs-var">named</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span id="local-6989586621684561638"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684561638"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Maybe VName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684561638"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-664"></span><span>          </span><span class="annot"><a href="#local-6989586621684561640"><span class="hs-identifier hs-var">named</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PName
</span><a href="Language.Futhark.Syntax.html#Unnamed"><span class="hs-identifier hs-var">Unnamed</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe VName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-665"></span><span>          </span><span id="local-6989586621684561636"><span class="annot"><span class="annottext">param_names :: [VName]
</span><a href="#local-6989586621684561636"><span class="hs-identifier hs-var hs-var">param_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; Maybe VName)
-&gt; [PatBase Info VName] -&gt; [VName]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PName, TypeBase (DimDecl VName) ()) -&gt; Maybe VName
forall {b}. (PName, b) -&gt; Maybe VName
</span><a href="#local-6989586621684561640"><span class="hs-identifier hs-var">named</span></a></span><span> </span><span class="annot"><span class="annottext">((PName, TypeBase (DimDecl VName) ()) -&gt; Maybe VName)
-&gt; (PatBase Info VName -&gt; (PName, TypeBase (DimDecl VName) ()))
-&gt; PatBase Info VName
-&gt; Maybe VName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; (PName, TypeBase (DimDecl VName) ())
</span><a href="Language.Futhark.Prop.html#patternParam"><span class="hs-identifier hs-var">patternParam</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684561644"><span class="hs-identifier hs-var">params'</span></a></span><span>
</span><span id="line-666"></span><span>          </span><span id="local-6989586621684561633"><span class="annot"><span class="annottext">pos_sizes :: Set VName
</span><a href="#local-6989586621684561633"><span class="hs-identifier hs-var hs-var">pos_sizes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-667"></span><span>            </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; Set VName
forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#typeDimNamesPos"><span class="hs-identifier hs-var">typeDimNamesPos</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) () -&gt; Set VName)
-&gt; (StructRetType -&gt; TypeBase (DimDecl VName) ())
-&gt; StructRetType
-&gt; Set VName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[TypeBase (DimDecl VName) ()]
-&gt; StructRetType -&gt; TypeBase (DimDecl VName) ()
forall as dim.
Monoid as =&gt;
[TypeBase dim as] -&gt; RetTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Prop.html#foldFunType"><span class="hs-identifier hs-var">foldFunType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; TypeBase (DimDecl VName) ())
-&gt; [PatBase Info VName] -&gt; [TypeBase (DimDecl VName) ()]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; TypeBase (DimDecl VName) ()
</span><a href="Language.Futhark.Prop.html#patternStructType"><span class="hs-identifier hs-var">patternStructType</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684561644"><span class="hs-identifier hs-var">params'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StructRetType -&gt; Set VName) -&gt; StructRetType -&gt; Set VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-668"></span><span>              </span><span class="annot"><span class="annottext">[VName] -&gt; TypeBase (DimDecl VName) () -&gt; StructRetType
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561643"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-669"></span><span>          </span><span id="local-6989586621684561625"><span class="annot"><span class="annottext">hide :: VName -&gt; (Int, b) -&gt; Bool
</span><a href="#local-6989586621684561625"><span class="hs-identifier hs-var hs-var">hide</span></a></span></span><span> </span><span id="local-6989586621684561624"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684561624"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684561623"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684561623"><span class="hs-identifier hs-var">lvl</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-670"></span><span>            </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684561623"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684561642"><span class="hs-identifier hs-var">cur_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684561624"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; [VName] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`notElem`</span></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561636"><span class="hs-identifier hs-var">param_names</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684561624"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.notMember`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561633"><span class="hs-identifier hs-var">pos_sizes</span></a></span><span>
</span><span id="line-671"></span><span>
</span><span id="line-672"></span><span>      </span><span id="local-6989586621684561620"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561620"><span class="hs-identifier hs-var">hidden_sizes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-673"></span><span>        </span><span class="annot"><span class="annottext">[VName] -&gt; Set VName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; Set VName)
-&gt; (Constraints -&gt; [VName]) -&gt; Constraints -&gt; Set VName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Constraints -&gt; [VName]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">M.keys</span></span><span> </span><span class="annot"><span class="annottext">(Constraints -&gt; [VName])
-&gt; (Constraints -&gt; Constraints) -&gt; Constraints -&gt; [VName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; (Int, Constraint) -&gt; Bool) -&gt; Constraints -&gt; Constraints
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.filterWithKey</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; (Int, Constraint) -&gt; Bool
forall {b}. VName -&gt; (Int, b) -&gt; Bool
</span><a href="#local-6989586621684561625"><span class="hs-identifier hs-var">hide</span></a></span><span> </span><span class="annot"><span class="annottext">(Constraints -&gt; Set VName) -&gt; m Constraints -&gt; m (Set VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m Constraints
forall (m :: * -&gt; *). MonadUnify m =&gt; m Constraints
</span><a href="Language.Futhark.TypeChecker.Unify.html#getConstraints"><span class="hs-identifier hs-var">getConstraints</span></a></span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561614"><span class="annot"><span class="annottext">onDim :: DimDecl VName -&gt; Set VName
</span><a href="#local-6989586621684561614"><span class="hs-identifier hs-var hs-var">onDim</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#NamedDim"><span class="hs-identifier hs-type">NamedDim</span></a></span><span> </span><span id="local-6989586621684561613"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561613"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; VName
forall vn. QualName vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#qualLeaf"><span class="hs-identifier hs-var hs-var">qualLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561613"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561620"><span class="hs-identifier hs-var">hidden_sizes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Set VName
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">S.singleton</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Set VName) -&gt; VName -&gt; Set VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; VName
forall vn. QualName vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#qualLeaf"><span class="hs-identifier hs-var hs-var">qualLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561613"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-677"></span><span>          </span><span class="annot"><a href="#local-6989586621684561614"><span class="hs-identifier hs-var">onDim</span></a></span><span> </span><span class="annot"><span class="annottext">DimDecl VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set VName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span>      </span><span class="annot"><span class="annottext">StructRetType -&gt; m StructRetType
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(StructRetType -&gt; m StructRetType)
-&gt; StructRetType -&gt; m StructRetType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; TypeBase (DimDecl VName) () -&gt; StructRetType
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set VName -&gt; [VName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set VName -&gt; [VName]) -&gt; Set VName -&gt; [VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DimDecl VName -&gt; Set VName) -&gt; [DimDecl VName] -&gt; Set VName
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">DimDecl VName -&gt; Set VName
</span><a href="#local-6989586621684561614"><span class="hs-identifier hs-var">onDim</span></a></span><span> </span><span class="annot"><span class="annottext">([DimDecl VName] -&gt; Set VName) -&gt; [DimDecl VName] -&gt; Set VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; [DimDecl VName]
forall as. TypeBase (DimDecl VName) as -&gt; [DimDecl VName]
</span><a href="Language.Futhark.Prop.html#nestedDims"><span class="hs-identifier hs-var">nestedDims</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561643"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561643"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-680"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#OpSection"><span class="hs-identifier hs-type">OpSection</span></a></span><span> </span><span id="local-6989586621684561608"><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684561608"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) Aliasing)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561607"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561607"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-681"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684561606"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561606"><span class="hs-identifier hs-var">op'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561605"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561605"><span class="hs-identifier hs-var">ftype</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; QualName Name
-&gt; TermTypeM (QualName VName, TypeBase (DimDecl VName) Aliasing)
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
SrcLoc
-&gt; QualName Name
-&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Monad.html#lookupVar"><span class="hs-identifier hs-var">lookupVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561607"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684561608"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-682"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName
-&gt; Info (TypeBase (DimDecl VName) Aliasing) -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn.
QualName vn
-&gt; f (TypeBase (DimDecl VName) Aliasing) -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#OpSection"><span class="hs-identifier hs-var">OpSection</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561606"><span class="hs-identifier hs-var">op'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561605"><span class="hs-identifier hs-var">ftype</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561607"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-683"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#OpSectionLeft"><span class="hs-identifier hs-type">OpSectionLeft</span></a></span><span> </span><span id="local-6989586621684561603"><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684561603"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) Aliasing)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561602"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561602"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">(NoInfo (PName, TypeBase (DimDecl VName) (), Maybe VName),
 NoInfo (PName, TypeBase (DimDecl VName) ()))
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(NoInfo (RetTypeBase (DimDecl VName) Aliasing), NoInfo [VName])
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561601"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561601"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-684"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684561600"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561600"><span class="hs-identifier hs-var">op'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561599"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561599"><span class="hs-identifier hs-var">ftype</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; QualName Name
-&gt; TermTypeM (QualName VName, TypeBase (DimDecl VName) Aliasing)
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
SrcLoc
-&gt; QualName Name
-&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Monad.html#lookupVar"><span class="hs-identifier hs-var">lookupVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561601"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684561603"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-685"></span><span>  </span><span id="local-6989586621684561598"><span class="annot"><span class="annottext">Arg
</span><a href="#local-6989586621684561598"><span class="hs-identifier hs-var">e_arg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Arg
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkArg"><span class="hs-identifier hs-var">checkArg</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561602"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-686"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684561597"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561597"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561596"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561596"><span class="hs-identifier hs-var">rt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561595"><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684561595"><span class="hs-identifier hs-var">argext</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561594"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561594"><span class="hs-identifier hs-var">retext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; ApplyOp
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Arg
-&gt; TermTypeM
     (TypeBase (DimDecl VName) Aliasing,
      TypeBase (DimDecl VName) Aliasing, Maybe VName, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkApply"><span class="hs-identifier hs-var">checkApply</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561601"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName VName -&gt; Maybe (QualName VName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561600"><span class="hs-identifier hs-var">op'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561599"><span class="hs-identifier hs-var">ftype</span></a></span><span> </span><span class="annot"><span class="annottext">Arg
</span><a href="#local-6989586621684561598"><span class="hs-identifier hs-var">e_arg</span></a></span><span>
</span><span id="line-687"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561599"><span class="hs-identifier hs-var">ftype</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561596"><span class="hs-identifier hs-var">rt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-688"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-type">Arrow</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561593"><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684561593"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RetTypeBase (DimDecl VName) Aliasing
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-type">Arrow</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561592"><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684561592"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span id="local-6989586621684561591"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561591"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span id="local-6989586621684561590"><span class="annot"><span class="annottext">RetTypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561590"><span class="hs-identifier hs-var">rettype</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-689"></span><span>      </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-690"></span><span>        </span><span class="annot"><span class="annottext">QualName VName
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
-&gt; Exp
-&gt; (Info (PName, TypeBase (DimDecl VName) (), Maybe VName),
    Info (PName, TypeBase (DimDecl VName) ()))
-&gt; (Info (RetTypeBase (DimDecl VName) Aliasing), Info [VName])
-&gt; SrcLoc
-&gt; Exp
forall (f :: * -&gt; *) vn.
QualName vn
-&gt; f (TypeBase (DimDecl VName) Aliasing)
-&gt; ExpBase f vn
-&gt; (f (PName, TypeBase (DimDecl VName) (), Maybe VName),
    f (PName, TypeBase (DimDecl VName) ()))
-&gt; (f (RetTypeBase (DimDecl VName) Aliasing), f [VName])
-&gt; SrcLoc
-&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#OpSectionLeft"><span class="hs-identifier hs-var">OpSectionLeft</span></a></span><span>
</span><span id="line-691"></span><span>          </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561600"><span class="hs-identifier hs-var">op'</span></a></span><span>
</span><span id="line-692"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561599"><span class="hs-identifier hs-var">ftype</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-693"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg -&gt; Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#argExp"><span class="hs-identifier hs-var">argExp</span></a></span><span> </span><span class="annot"><span class="annottext">Arg
</span><a href="#local-6989586621684561598"><span class="hs-identifier hs-var">e_arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-694"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PName, TypeBase (DimDecl VName) (), Maybe VName)
-&gt; Info (PName, TypeBase (DimDecl VName) (), Maybe VName)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684561593"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561597"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684561595"><span class="hs-identifier hs-var">argext</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(PName, TypeBase (DimDecl VName) ())
-&gt; Info (PName, TypeBase (DimDecl VName) ())
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684561592"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561591"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-695"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RetTypeBase (DimDecl VName) Aliasing
-&gt; Info (RetTypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">RetTypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561590"><span class="hs-identifier hs-var">rettype</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; Info [VName]
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561594"><span class="hs-identifier hs-var">retext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-696"></span><span>          </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561601"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-697"></span><span>    </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing,
 TypeBase (DimDecl VName) Aliasing)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-698"></span><span>      </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TermTypeM Exp
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561601"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM Exp) -&gt; Doc -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-699"></span><span>        </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Operator section with invalid operator of type&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561599"><span class="hs-identifier hs-var">ftype</span></a></span><span>
</span><span id="line-700"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#OpSectionRight"><span class="hs-identifier hs-type">OpSectionRight</span></a></span><span> </span><span id="local-6989586621684561588"><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684561588"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) Aliasing)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561587"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561587"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">(NoInfo (PName, TypeBase (DimDecl VName) ()),
 NoInfo (PName, TypeBase (DimDecl VName) (), Maybe VName))
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NoInfo (RetTypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684561586"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561586"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-701"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684561585"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561585"><span class="hs-identifier hs-var">op'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561584"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561584"><span class="hs-identifier hs-var">ftype</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; QualName Name
-&gt; TermTypeM (QualName VName, TypeBase (DimDecl VName) Aliasing)
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
SrcLoc
-&gt; QualName Name
-&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Monad.html#lookupVar"><span class="hs-identifier hs-var">lookupVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561586"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684561588"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-702"></span><span>  </span><span id="local-6989586621684561583"><span class="annot"><span class="annottext">Arg
</span><a href="#local-6989586621684561583"><span class="hs-identifier hs-var">e_arg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Arg
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkArg"><span class="hs-identifier hs-var">checkArg</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561587"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-703"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561584"><span class="hs-identifier hs-var">ftype</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-704"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-type">Arrow</span></a></span><span> </span><span id="local-6989586621684561582"><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561582"><span class="hs-identifier hs-var">as1</span></a></span></span><span> </span><span id="local-6989586621684561581"><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684561581"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621684561580"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561580"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-type">RetType</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-type">Arrow</span></a></span><span> </span><span id="local-6989586621684561579"><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561579"><span class="hs-identifier hs-var">as2</span></a></span></span><span> </span><span id="local-6989586621684561578"><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684561578"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span id="local-6989586621684561577"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561577"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-type">RetType</span></a></span><span> </span><span id="local-6989586621684561576"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561576"><span class="hs-identifier hs-var">dims2</span></a></span></span><span> </span><span id="local-6989586621684561575"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561575"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-705"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684561574"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561574"><span class="hs-identifier hs-var">t2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561573"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561573"><span class="hs-identifier hs-var">ret'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561572"><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684561572"><span class="hs-identifier hs-var">argext</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-706"></span><span>        </span><span class="annot"><span class="annottext">SrcLoc
-&gt; ApplyOp
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Arg
-&gt; TermTypeM
     (TypeBase (DimDecl VName) Aliasing,
      TypeBase (DimDecl VName) Aliasing, Maybe VName, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkApply"><span class="hs-identifier hs-var">checkApply</span></a></span><span>
</span><span id="line-707"></span><span>          </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561586"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-708"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName VName -&gt; Maybe (QualName VName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561585"><span class="hs-identifier hs-var">op'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-709"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) Aliasing
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Aliasing
-&gt; PName
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; RetTypeBase (DimDecl VName) Aliasing
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall dim as.
as
-&gt; PName
-&gt; TypeBase dim as
-&gt; RetTypeBase dim as
-&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-var">Arrow</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561579"><span class="hs-identifier hs-var">as2</span></a></span><span> </span><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684561578"><span class="hs-identifier hs-var">m2</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561577"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">(RetTypeBase (DimDecl VName) Aliasing
 -&gt; ScalarTypeBase (DimDecl VName) Aliasing)
-&gt; RetTypeBase (DimDecl VName) Aliasing
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName]
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; RetTypeBase (DimDecl VName) Aliasing
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; RetTypeBase (DimDecl VName) Aliasing)
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; RetTypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) Aliasing
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Aliasing
-&gt; PName
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; RetTypeBase (DimDecl VName) Aliasing
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall dim as.
as
-&gt; PName
-&gt; TypeBase dim as
-&gt; RetTypeBase dim as
-&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-var">Arrow</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561582"><span class="hs-identifier hs-var">as1</span></a></span><span> </span><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684561581"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561580"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">(RetTypeBase (DimDecl VName) Aliasing
 -&gt; ScalarTypeBase (DimDecl VName) Aliasing)
-&gt; RetTypeBase (DimDecl VName) Aliasing
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName]
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; RetTypeBase (DimDecl VName) Aliasing
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561575"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span>          </span><span class="annot"><span class="annottext">Arg
</span><a href="#local-6989586621684561583"><span class="hs-identifier hs-var">e_arg</span></a></span><span>
</span><span id="line-711"></span><span>      </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-712"></span><span>        </span><span class="annot"><span class="annottext">QualName VName
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
-&gt; Exp
-&gt; (Info (PName, TypeBase (DimDecl VName) ()),
    Info (PName, TypeBase (DimDecl VName) (), Maybe VName))
-&gt; Info (RetTypeBase (DimDecl VName) Aliasing)
-&gt; SrcLoc
-&gt; Exp
forall (f :: * -&gt; *) vn.
QualName vn
-&gt; f (TypeBase (DimDecl VName) Aliasing)
-&gt; ExpBase f vn
-&gt; (f (PName, TypeBase (DimDecl VName) ()),
    f (PName, TypeBase (DimDecl VName) (), Maybe VName))
-&gt; f (RetTypeBase (DimDecl VName) Aliasing)
-&gt; SrcLoc
-&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#OpSectionRight"><span class="hs-identifier hs-var">OpSectionRight</span></a></span><span>
</span><span id="line-713"></span><span>          </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561585"><span class="hs-identifier hs-var">op'</span></a></span><span>
</span><span id="line-714"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561584"><span class="hs-identifier hs-var">ftype</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg -&gt; Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#argExp"><span class="hs-identifier hs-var">argExp</span></a></span><span> </span><span class="annot"><span class="annottext">Arg
</span><a href="#local-6989586621684561583"><span class="hs-identifier hs-var">e_arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-716"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PName, TypeBase (DimDecl VName) ())
-&gt; Info (PName, TypeBase (DimDecl VName) ())
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684561581"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561580"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(PName, TypeBase (DimDecl VName) (), Maybe VName)
-&gt; Info (PName, TypeBase (DimDecl VName) (), Maybe VName)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684561578"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561574"><span class="hs-identifier hs-var">t2'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684561572"><span class="hs-identifier hs-var">argext</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-717"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RetTypeBase (DimDecl VName) Aliasing
-&gt; Info (RetTypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">(RetTypeBase (DimDecl VName) Aliasing
 -&gt; Info (RetTypeBase (DimDecl VName) Aliasing))
-&gt; RetTypeBase (DimDecl VName) Aliasing
-&gt; Info (RetTypeBase (DimDecl VName) Aliasing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName]
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; RetTypeBase (DimDecl VName) Aliasing
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561576"><span class="hs-identifier hs-var">dims2</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; RetTypeBase (DimDecl VName) Aliasing)
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; RetTypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; (Aliasing -&gt; Aliasing) -&gt; TypeBase (DimDecl VName) Aliasing
forall dim asf ast.
TypeBase dim asf -&gt; (asf -&gt; ast) -&gt; TypeBase dim ast
</span><a href="Language.Futhark.Prop.html#addAliases"><span class="hs-identifier hs-var">addAliases</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561575"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Aliasing -&gt; Aliasing -&gt; Aliasing
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Aliasing
forall as shape. Monoid as =&gt; TypeBase shape as -&gt; as
</span><a href="Language.Futhark.Prop.html#aliases"><span class="hs-identifier hs-var">aliases</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561573"><span class="hs-identifier hs-var">ret'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>          </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561586"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-719"></span><span>    </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-720"></span><span>      </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TermTypeM Exp
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561586"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM Exp) -&gt; Doc -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-721"></span><span>        </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Operator section with invalid operator of type&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561584"><span class="hs-identifier hs-var">ftype</span></a></span><span>
</span><span id="line-722"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ProjectSection"><span class="hs-identifier hs-type">ProjectSection</span></a></span><span> </span><span id="local-6989586621684561570"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561570"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684561569"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561569"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-723"></span><span>  </span><span id="local-6989586621684561568"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561568"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Name -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall (m :: * -&gt; *) als dim.
(MonadUnify m, Monoid als) =&gt;
SrcLoc -&gt; Name -&gt; m (TypeBase dim als)
</span><a href="Language.Futhark.TypeChecker.Unify.html#newTypeVar"><span class="hs-identifier hs-var">newTypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561569"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;a&quot;</span></span><span>
</span><span id="line-724"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561567"><span class="annot"><span class="annottext">usage :: Usage
</span><a href="#local-6989586621684561567"><span class="hs-identifier hs-var hs-var">usage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; String -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561569"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;projection at&quot;</span></span><span>
</span><span id="line-725"></span><span>  </span><span id="local-6989586621684561566"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561566"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; Name -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing))
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; [Name]
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name
 -&gt; TypeBase (DimDecl VName) Aliasing
 -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing))
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Name
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">((Name
  -&gt; TypeBase (DimDecl VName) Aliasing
  -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing))
 -&gt; TypeBase (DimDecl VName) Aliasing
 -&gt; Name
 -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing))
-&gt; (Name
    -&gt; TypeBase (DimDecl VName) Aliasing
    -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing))
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Name
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Usage
-&gt; Name
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage
-&gt; Name
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; m (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Unify.html#mustHaveField"><span class="hs-identifier hs-var">mustHaveField</span></a></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684561567"><span class="hs-identifier hs-var">usage</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561568"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561570"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-726"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Info (TypeBase (DimDecl VName) Aliasing) -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn.
[Name]
-&gt; f (TypeBase (DimDecl VName) Aliasing) -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#ProjectSection"><span class="hs-identifier hs-var">ProjectSection</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621684561570"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; Info (TypeBase (DimDecl VName) Aliasing))
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) Aliasing
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Aliasing
-&gt; PName
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; RetTypeBase (DimDecl VName) Aliasing
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall dim as.
as
-&gt; PName
-&gt; TypeBase dim as
-&gt; RetTypeBase dim as
-&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-var">Arrow</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">PName
</span><a href="Language.Futhark.Syntax.html#Unnamed"><span class="hs-identifier hs-var">Unnamed</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561568"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">(RetTypeBase (DimDecl VName) Aliasing
 -&gt; ScalarTypeBase (DimDecl VName) Aliasing)
-&gt; RetTypeBase (DimDecl VName) Aliasing
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName]
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; RetTypeBase (DimDecl VName) Aliasing
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561566"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561569"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-727"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#IndexSection"><span class="hs-identifier hs-type">IndexSection</span></a></span><span> </span><span id="local-6989586621684561564"><span class="annot"><span class="annottext">SliceBase NoInfo Name
</span><a href="#local-6989586621684561564"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684561563"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561563"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-728"></span><span>  </span><span id="local-6989586621684561562"><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684561562"><span class="hs-identifier hs-var">slice'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SliceBase NoInfo Name -&gt; TermTypeM Slice
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkSlice"><span class="hs-identifier hs-var">checkSlice</span></a></span><span> </span><span class="annot"><span class="annottext">SliceBase NoInfo Name
</span><a href="#local-6989586621684561564"><span class="hs-identifier hs-var">slice</span></a></span><span>
</span><span id="line-729"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684561561"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561561"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; Name
-&gt; Int
-&gt; TermTypeM
     (TypeBase (DimDecl VName) (), TypeBase (DimDecl VName) ())
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#newArrayType"><span class="hs-identifier hs-var">newArrayType</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561563"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;e&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Int
 -&gt; TermTypeM
      (TypeBase (DimDecl VName) (), TypeBase (DimDecl VName) ()))
-&gt; Int
-&gt; TermTypeM
     (TypeBase (DimDecl VName) (), TypeBase (DimDecl VName) ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Slice -&gt; Int
</span><a href="Language.Futhark.TypeChecker.Terms.html#sliceDims"><span class="hs-identifier hs-var">sliceDims</span></a></span><span> </span><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684561562"><span class="hs-identifier hs-var">slice'</span></a></span><span>
</span><span id="line-730"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684561560"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561560"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561559"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561559"><span class="hs-identifier hs-var">retext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (SrcLoc, Rigidity)
-&gt; Slice
-&gt; TypeBase (DimDecl VName) ()
-&gt; TermTypeM (TypeBase (DimDecl VName) (), [VName])
forall as.
Maybe (SrcLoc, Rigidity)
-&gt; Slice
-&gt; TypeBase (DimDecl VName) as
-&gt; TermTypeM (TypeBase (DimDecl VName) as, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#sliceShape"><span class="hs-identifier hs-var">sliceShape</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SrcLoc, Rigidity)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684561562"><span class="hs-identifier hs-var">slice'</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561561"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-731"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Slice -&gt; Info (TypeBase (DimDecl VName) Aliasing) -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn.
SliceBase f vn
-&gt; f (TypeBase (DimDecl VName) Aliasing) -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#IndexSection"><span class="hs-identifier hs-var">IndexSection</span></a></span><span> </span><span class="annot"><span class="annottext">Slice
</span><a href="#local-6989586621684561562"><span class="hs-identifier hs-var">slice'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; Info (TypeBase (DimDecl VName) Aliasing))
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. TypeBase dim as -&gt; TypeBase dim Aliasing
</span><a href="Language.Futhark.Prop.html#fromStruct"><span class="hs-identifier hs-var">fromStruct</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; TypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ())
-&gt; ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">()
-&gt; PName
-&gt; TypeBase (DimDecl VName) ()
-&gt; StructRetType
-&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as.
as
-&gt; PName
-&gt; TypeBase dim as
-&gt; RetTypeBase dim as
-&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-var">Arrow</span></a></span><span> </span><span class="annot"><span class="annottext">()
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">PName
</span><a href="Language.Futhark.Syntax.html#Unnamed"><span class="hs-identifier hs-var">Unnamed</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561561"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(StructRetType -&gt; ScalarTypeBase (DimDecl VName) ())
-&gt; StructRetType -&gt; ScalarTypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; TypeBase (DimDecl VName) () -&gt; StructRetType
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561559"><span class="hs-identifier hs-var">retext</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561560"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561563"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-732"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#DoLoop"><span class="hs-identifier hs-type">DoLoop</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561557"><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684561557"><span class="hs-identifier hs-var">mergepat</span></a></span></span><span> </span><span id="local-6989586621684561556"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561556"><span class="hs-identifier hs-var">mergeexp</span></a></span></span><span> </span><span id="local-6989586621684561555"><span class="annot"><span class="annottext">LoopFormBase NoInfo Name
</span><a href="#local-6989586621684561555"><span class="hs-identifier hs-var">form</span></a></span></span><span> </span><span id="local-6989586621684561554"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561554"><span class="hs-identifier hs-var">loopbody</span></a></span></span><span> </span><span id="local-6989586621684561553"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561553"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoInfo AppRes
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-733"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621684561552"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561552"><span class="hs-identifier hs-var">sparams</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561551"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561551"><span class="hs-identifier hs-var">mergepat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561550"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561550"><span class="hs-identifier hs-var">mergeexp'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561549"><span class="annot"><span class="annottext">LoopFormBase Info VName
</span><a href="#local-6989586621684561549"><span class="hs-identifier hs-var">form'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561548"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561548"><span class="hs-identifier hs-var">loopbody'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561547"><span class="annot"><span class="annottext">AppRes
</span><a href="#local-6989586621684561547"><span class="hs-identifier hs-var">appres</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-734"></span><span>    </span><span class="annot"><span class="annottext">(ExpBase NoInfo Name -&gt; TermTypeM Exp)
-&gt; UncheckedLoop -&gt; SrcLoc -&gt; TermTypeM (CheckedLoop, AppRes)
</span><a href="Language.Futhark.TypeChecker.Terms.DoLoop.html#checkDoLoop"><span class="hs-identifier hs-var">checkDoLoop</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684561557"><span class="hs-identifier hs-var">mergepat</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561556"><span class="hs-identifier hs-var">mergeexp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LoopFormBase NoInfo Name
</span><a href="#local-6989586621684561555"><span class="hs-identifier hs-var">form</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561554"><span class="hs-identifier hs-var">loopbody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561553"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-735"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-736"></span><span>    </span><span class="annot"><span class="annottext">AppExpBase Info VName -&gt; Info AppRes -&gt; Exp
forall (f :: * -&gt; *) vn.
AppExpBase f vn -&gt; f AppRes -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-var">AppExp</span></a></span><span>
</span><span id="line-737"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[VName]
-&gt; PatBase Info VName
-&gt; Exp
-&gt; LoopFormBase Info VName
-&gt; Exp
-&gt; SrcLoc
-&gt; AppExpBase Info VName
forall (f :: * -&gt; *) vn.
[VName]
-&gt; PatBase f vn
-&gt; ExpBase f vn
-&gt; LoopFormBase f vn
-&gt; ExpBase f vn
-&gt; SrcLoc
-&gt; AppExpBase f vn
</span><a href="Language.Futhark.Syntax.html#DoLoop"><span class="hs-identifier hs-var">DoLoop</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561552"><span class="hs-identifier hs-var">sparams</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561551"><span class="hs-identifier hs-var">mergepat'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561550"><span class="hs-identifier hs-var">mergeexp'</span></a></span><span> </span><span class="annot"><span class="annottext">LoopFormBase Info VName
</span><a href="#local-6989586621684561549"><span class="hs-identifier hs-var">form'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561548"><span class="hs-identifier hs-var">loopbody'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561553"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-738"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppRes -&gt; Info AppRes
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">AppRes
</span><a href="#local-6989586621684561547"><span class="hs-identifier hs-var">appres</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-739"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Constr"><span class="hs-identifier hs-type">Constr</span></a></span><span> </span><span id="local-6989586621684561544"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561544"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621684561543"><span class="annot"><span class="annottext">[ExpBase NoInfo Name]
</span><a href="#local-6989586621684561543"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684561542"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561542"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-740"></span><span>  </span><span id="local-6989586621684561541"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561541"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Name -&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall (m :: * -&gt; *) als dim.
(MonadUnify m, Monoid als) =&gt;
SrcLoc -&gt; Name -&gt; m (TypeBase dim als)
</span><a href="Language.Futhark.TypeChecker.Unify.html#newTypeVar"><span class="hs-identifier hs-var">newTypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561542"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;t&quot;</span></span><span>
</span><span id="line-741"></span><span>  </span><span id="local-6989586621684561540"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621684561540"><span class="hs-identifier hs-var">es'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ExpBase NoInfo Name -&gt; TermTypeM Exp)
-&gt; [ExpBase NoInfo Name] -&gt; TermTypeM [Exp]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpBase NoInfo Name]
</span><a href="#local-6989586621684561543"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-742"></span><span>  </span><span id="local-6989586621684561539"><span class="annot"><span class="annottext">[TypeBase (DimDecl VName) Aliasing]
</span><a href="#local-6989586621684561539"><span class="hs-identifier hs-var">ets</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing))
-&gt; [Exp] -&gt; TermTypeM [TypeBase (DimDecl VName) Aliasing]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621684561540"><span class="hs-identifier hs-var">es'</span></a></span><span>
</span><span id="line-743"></span><span>  </span><span class="annot"><span class="annottext">Usage
-&gt; Name
-&gt; TypeBase (DimDecl VName) ()
-&gt; [TypeBase (DimDecl VName) ()]
-&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage
-&gt; Name
-&gt; TypeBase (DimDecl VName) ()
-&gt; [TypeBase (DimDecl VName) ()]
-&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#mustHaveConstr"><span class="hs-identifier hs-var">mustHaveConstr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; String -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561542"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;use of constructor&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561544"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561541"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ())
-&gt; [TypeBase (DimDecl VName) Aliasing]
-&gt; [TypeBase (DimDecl VName) ()]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[TypeBase (DimDecl VName) Aliasing]
</span><a href="#local-6989586621684561539"><span class="hs-identifier hs-var">ets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-744"></span><span>  </span><span class="hs-comment">-- A sum value aliases *anything* that went into its construction.</span><span>
</span><span id="line-745"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561533"><span class="annot"><span class="annottext">als :: Aliasing
</span><a href="#local-6989586621684561533"><span class="hs-identifier hs-var hs-var">als</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing -&gt; Aliasing)
-&gt; [TypeBase (DimDecl VName) Aliasing] -&gt; Aliasing
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Aliasing
forall as shape. Monoid as =&gt; TypeBase shape as -&gt; as
</span><a href="Language.Futhark.Prop.html#aliases"><span class="hs-identifier hs-var">aliases</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeBase (DimDecl VName) Aliasing]
</span><a href="#local-6989586621684561539"><span class="hs-identifier hs-var">ets</span></a></span><span>
</span><span id="line-746"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [Exp]
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
-&gt; SrcLoc
-&gt; Exp
forall (f :: * -&gt; *) vn.
Name
-&gt; [ExpBase f vn]
-&gt; f (TypeBase (DimDecl VName) Aliasing)
-&gt; SrcLoc
-&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#Constr"><span class="hs-identifier hs-var">Constr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561544"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621684561540"><span class="hs-identifier hs-var">es'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; Info (TypeBase (DimDecl VName) Aliasing))
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. TypeBase dim as -&gt; TypeBase dim Aliasing
</span><a href="Language.Futhark.Prop.html#fromStruct"><span class="hs-identifier hs-var">fromStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561541"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; (Aliasing -&gt; Aliasing) -&gt; TypeBase (DimDecl VName) Aliasing
forall dim asf ast.
TypeBase dim asf -&gt; (asf -&gt; ast) -&gt; TypeBase dim ast
</span><a href="Language.Futhark.Prop.html#addAliases"><span class="hs-operator hs-var">`addAliases`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Aliasing -&gt; Aliasing -&gt; Aliasing
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561533"><span class="hs-identifier hs-var">als</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561542"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-747"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span id="local-6989586621684561531"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561531"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684561530"><span class="annot"><span class="annottext">NonEmpty (CaseBase NoInfo Name)
</span><a href="#local-6989586621684561530"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621684561529"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561529"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoInfo AppRes
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-748"></span><span>  </span><span class="annot"><span class="annottext">TermTypeM Exp
-&gt; (Exp -&gt; Occurrences -&gt; TermTypeM Exp) -&gt; TermTypeM Exp
forall a b.
TermTypeM a -&gt; (a -&gt; Occurrences -&gt; TermTypeM b) -&gt; TermTypeM b
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#sequentially"><span class="hs-identifier hs-var">sequentially</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561531"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Exp -&gt; Occurrences -&gt; TermTypeM Exp) -&gt; TermTypeM Exp)
-&gt; (Exp -&gt; Occurrences -&gt; TermTypeM Exp) -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684561528"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561528"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-749"></span><span>    </span><span id="local-6989586621684561527"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561527"><span class="hs-identifier hs-var">mt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561528"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-750"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684561526"><span class="annot"><span class="annottext">NonEmpty (CaseBase Info VName)
</span><a href="#local-6989586621684561526"><span class="hs-identifier hs-var">cs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561525"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561525"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561524"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561524"><span class="hs-identifier hs-var">retext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; NonEmpty (CaseBase NoInfo Name)
-&gt; TermTypeM
     (NonEmpty (CaseBase Info VName), TypeBase (DimDecl VName) Aliasing,
      [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkCases"><span class="hs-identifier hs-var">checkCases</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561527"><span class="hs-identifier hs-var">mt</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (CaseBase NoInfo Name)
</span><a href="#local-6989586621684561530"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-751"></span><span>    </span><span class="annot"><span class="annottext">Usage
-&gt; String -&gt; TypeBase (DimDecl VName) Aliasing -&gt; TermTypeM ()
forall (m :: * -&gt; *) dim as.
(MonadUnify m, Pretty (ShapeDecl dim), Monoid as) =&gt;
Usage -&gt; String -&gt; TypeBase dim as -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#zeroOrderType"><span class="hs-identifier hs-var">zeroOrderType</span></a></span><span>
</span><span id="line-752"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; String -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561529"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;being returned 'match'&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-753"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;type returned from pattern match&quot;</span></span><span>
</span><span id="line-754"></span><span>      </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561525"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-755"></span><span>    </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppExpBase Info VName -&gt; Info AppRes -&gt; Exp
forall (f :: * -&gt; *) vn.
AppExpBase f vn -&gt; f AppRes -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-var">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
-&gt; NonEmpty (CaseBase Info VName)
-&gt; SrcLoc
-&gt; AppExpBase Info VName
forall (f :: * -&gt; *) vn.
ExpBase f vn
-&gt; NonEmpty (CaseBase f vn) -&gt; SrcLoc -&gt; AppExpBase f vn
</span><a href="Language.Futhark.Syntax.html#Match"><span class="hs-identifier hs-var">Match</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561528"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (CaseBase Info VName)
</span><a href="#local-6989586621684561526"><span class="hs-identifier hs-var">cs'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561529"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppRes -&gt; Info AppRes
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">(AppRes -&gt; Info AppRes) -&gt; AppRes -&gt; Info AppRes
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; [VName] -&gt; AppRes
</span><a href="Language.Futhark.Syntax.html#AppRes"><span class="hs-identifier hs-var">AppRes</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561525"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561524"><span class="hs-identifier hs-var">retext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-756"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Attr"><span class="hs-identifier hs-type">Attr</span></a></span><span> </span><span id="local-6989586621684561521"><span class="annot"><span class="annottext">AttrInfo Name
</span><a href="#local-6989586621684561521"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621684561520"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561520"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684561519"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561519"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-757"></span><span>  </span><span class="annot"><span class="annottext">AttrInfo VName -&gt; Exp -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn.
AttrInfo vn -&gt; ExpBase f vn -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#Attr"><span class="hs-identifier hs-var">Attr</span></a></span><span> </span><span class="annot"><span class="annottext">(AttrInfo VName -&gt; Exp -&gt; SrcLoc -&gt; Exp)
-&gt; TermTypeM (AttrInfo VName) -&gt; TermTypeM (Exp -&gt; SrcLoc -&gt; Exp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">AttrInfo Name -&gt; TermTypeM (AttrInfo VName)
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
AttrInfo Name -&gt; m (AttrInfo VName)
</span><a href="Language.Futhark.TypeChecker.Monad.html#checkAttr"><span class="hs-identifier hs-var">checkAttr</span></a></span><span> </span><span class="annot"><span class="annottext">AttrInfo Name
</span><a href="#local-6989586621684561521"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM (Exp -&gt; SrcLoc -&gt; Exp)
-&gt; TermTypeM Exp -&gt; TermTypeM (SrcLoc -&gt; Exp)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561520"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM (SrcLoc -&gt; Exp) -&gt; TermTypeM SrcLoc -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; TermTypeM SrcLoc
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561519"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-758"></span><span>
</span><span id="line-759"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkCases"><span class="hs-identifier hs-type">checkCases</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-760"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-761"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#CaseBase"><span class="hs-identifier hs-type">CaseBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-762"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#CaseBase"><span class="hs-identifier hs-type">CaseBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-763"></span><span id="checkCases"><span class="annot"><span class="annottext">checkCases :: TypeBase (DimDecl VName) Aliasing
-&gt; NonEmpty (CaseBase NoInfo Name)
-&gt; TermTypeM
     (NonEmpty (CaseBase Info VName), TypeBase (DimDecl VName) Aliasing,
      [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkCases"><span class="hs-identifier hs-var hs-var">checkCases</span></a></span></span><span> </span><span id="local-6989586621684561517"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561517"><span class="hs-identifier hs-var">mt</span></a></span></span><span> </span><span id="local-6989586621684561516"><span class="annot"><span class="annottext">NonEmpty (CaseBase NoInfo Name)
</span><a href="#local-6989586621684561516"><span class="hs-identifier hs-var">rest_cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-764"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NonEmpty (CaseBase NoInfo Name)
-&gt; (CaseBase NoInfo Name, Maybe (NonEmpty (CaseBase NoInfo Name)))
forall a. NonEmpty a -&gt; (a, Maybe (NonEmpty a))
</span><span class="hs-identifier hs-var">NE.uncons</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (CaseBase NoInfo Name)
</span><a href="#local-6989586621684561516"><span class="hs-identifier hs-var">rest_cs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-765"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684561514"><span class="annot"><span class="annottext">CaseBase NoInfo Name
</span><a href="#local-6989586621684561514"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (CaseBase NoInfo Name))
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-766"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684561513"><span class="annot"><span class="annottext">CaseBase Info VName
</span><a href="#local-6989586621684561513"><span class="hs-identifier hs-var">c'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561512"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561512"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561511"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561511"><span class="hs-identifier hs-var">retext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; CaseBase NoInfo Name
-&gt; TermTypeM
     (CaseBase Info VName, TypeBase (DimDecl VName) Aliasing, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkCase"><span class="hs-identifier hs-var">checkCase</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561517"><span class="hs-identifier hs-var">mt</span></a></span><span> </span><span class="annot"><span class="annottext">CaseBase NoInfo Name
</span><a href="#local-6989586621684561514"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-767"></span><span>      </span><span class="annot"><span class="annottext">(NonEmpty (CaseBase Info VName), TypeBase (DimDecl VName) Aliasing,
 [VName])
-&gt; TermTypeM
     (NonEmpty (CaseBase Info VName), TypeBase (DimDecl VName) Aliasing,
      [VName])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CaseBase Info VName
</span><a href="#local-6989586621684561513"><span class="hs-identifier hs-var">c'</span></a></span><span> </span><span class="annot"><span class="annottext">CaseBase Info VName
-&gt; [CaseBase Info VName] -&gt; NonEmpty (CaseBase Info VName)
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561512"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561511"><span class="hs-identifier hs-var">retext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-768"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684561508"><span class="annot"><span class="annottext">CaseBase NoInfo Name
</span><a href="#local-6989586621684561508"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684561507"><span class="annot"><span class="annottext">NonEmpty (CaseBase NoInfo Name)
</span><a href="#local-6989586621684561507"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-769"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621684561506"><span class="annot"><span class="annottext">CaseBase Info VName
</span><a href="#local-6989586621684561506"><span class="hs-identifier hs-var">c'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561505"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561505"><span class="hs-identifier hs-var">c_t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684561504"><span class="annot"><span class="annottext">NonEmpty (CaseBase Info VName)
</span><a href="#local-6989586621684561504"><span class="hs-identifier hs-var">cs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561503"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561503"><span class="hs-identifier hs-var">cs_t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561502"><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684561502"><span class="hs-identifier hs-var">dflow</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-770"></span><span>        </span><span class="annot"><span class="annottext">TermTypeM
  ((CaseBase Info VName, TypeBase (DimDecl VName) Aliasing, [VName]),
   (NonEmpty (CaseBase Info VName), TypeBase (DimDecl VName) Aliasing,
    [VName]))
-&gt; TermTypeM
     (((CaseBase Info VName, TypeBase (DimDecl VName) Aliasing,
        [VName]),
       (NonEmpty (CaseBase Info VName), TypeBase (DimDecl VName) Aliasing,
        [VName])),
      Occurrences)
forall a. TermTypeM a -&gt; TermTypeM (a, Occurrences)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#tapOccurrences"><span class="hs-identifier hs-var">tapOccurrences</span></a></span><span> </span><span class="annot"><span class="annottext">(TermTypeM
   ((CaseBase Info VName, TypeBase (DimDecl VName) Aliasing, [VName]),
    (NonEmpty (CaseBase Info VName), TypeBase (DimDecl VName) Aliasing,
     [VName]))
 -&gt; TermTypeM
      (((CaseBase Info VName, TypeBase (DimDecl VName) Aliasing,
         [VName]),
        (NonEmpty (CaseBase Info VName), TypeBase (DimDecl VName) Aliasing,
         [VName])),
       Occurrences))
-&gt; TermTypeM
     ((CaseBase Info VName, TypeBase (DimDecl VName) Aliasing, [VName]),
      (NonEmpty (CaseBase Info VName), TypeBase (DimDecl VName) Aliasing,
       [VName]))
-&gt; TermTypeM
     (((CaseBase Info VName, TypeBase (DimDecl VName) Aliasing,
        [VName]),
       (NonEmpty (CaseBase Info VName), TypeBase (DimDecl VName) Aliasing,
        [VName])),
      Occurrences)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; CaseBase NoInfo Name
-&gt; TermTypeM
     (CaseBase Info VName, TypeBase (DimDecl VName) Aliasing, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkCase"><span class="hs-identifier hs-var">checkCase</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561517"><span class="hs-identifier hs-var">mt</span></a></span><span> </span><span class="annot"><span class="annottext">CaseBase NoInfo Name
</span><a href="#local-6989586621684561508"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM
  (CaseBase Info VName, TypeBase (DimDecl VName) Aliasing, [VName])
-&gt; TermTypeM
     (NonEmpty (CaseBase Info VName), TypeBase (DimDecl VName) Aliasing,
      [VName])
-&gt; TermTypeM
     ((CaseBase Info VName, TypeBase (DimDecl VName) Aliasing, [VName]),
      (NonEmpty (CaseBase Info VName), TypeBase (DimDecl VName) Aliasing,
       [VName]))
forall a b. TermTypeM a -&gt; TermTypeM b -&gt; TermTypeM (a, b)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#alternative"><span class="hs-operator hs-var">`alternative`</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; NonEmpty (CaseBase NoInfo Name)
-&gt; TermTypeM
     (NonEmpty (CaseBase Info VName), TypeBase (DimDecl VName) Aliasing,
      [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkCases"><span class="hs-identifier hs-var">checkCases</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561517"><span class="hs-identifier hs-var">mt</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (CaseBase NoInfo Name)
</span><a href="#local-6989586621684561507"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-771"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684561501"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561501"><span class="hs-identifier hs-var">brancht</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561500"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561500"><span class="hs-identifier hs-var">retext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#unifyBranchTypes"><span class="hs-identifier hs-var">unifyBranchTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CaseBase NoInfo Name -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">CaseBase NoInfo Name
</span><a href="#local-6989586621684561508"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561505"><span class="hs-identifier hs-var">c_t</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561503"><span class="hs-identifier hs-var">cs_t</span></a></span><span>
</span><span id="line-772"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561497"><span class="annot"><span class="annottext">t :: TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561497"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-773"></span><span>            </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; (Aliasing -&gt; Aliasing) -&gt; TypeBase (DimDecl VName) Aliasing
forall dim asf ast.
TypeBase dim asf -&gt; (asf -&gt; ast) -&gt; TypeBase dim ast
</span><a href="Language.Futhark.Prop.html#addAliases"><span class="hs-identifier hs-var">addAliases</span></a></span><span>
</span><span id="line-774"></span><span>              </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561501"><span class="hs-identifier hs-var">brancht</span></a></span><span>
</span><span id="line-775"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Aliasing -&gt; Aliasing -&gt; Aliasing
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`S.difference`</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Alias) -&gt; Set VName -&gt; Aliasing
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">S.map</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Alias
</span><a href="Language.Futhark.Syntax.html#AliasBound"><span class="hs-identifier hs-var">AliasBound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Occurrences -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#allConsumed"><span class="hs-identifier hs-var">allConsumed</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684561502"><span class="hs-identifier hs-var">dflow</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-776"></span><span>      </span><span class="annot"><span class="annottext">(NonEmpty (CaseBase Info VName), TypeBase (DimDecl VName) Aliasing,
 [VName])
-&gt; TermTypeM
     (NonEmpty (CaseBase Info VName), TypeBase (DimDecl VName) Aliasing,
      [VName])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CaseBase Info VName
-&gt; NonEmpty (CaseBase Info VName) -&gt; NonEmpty (CaseBase Info VName)
forall a. a -&gt; NonEmpty a -&gt; NonEmpty a
</span><span class="hs-identifier hs-var">NE.cons</span></span><span> </span><span class="annot"><span class="annottext">CaseBase Info VName
</span><a href="#local-6989586621684561506"><span class="hs-identifier hs-var">c'</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (CaseBase Info VName)
</span><a href="#local-6989586621684561504"><span class="hs-identifier hs-var">cs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561497"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561500"><span class="hs-identifier hs-var">retext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-777"></span><span>
</span><span id="line-778"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkCase"><span class="hs-identifier hs-type">checkCase</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-779"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-780"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#CaseBase"><span class="hs-identifier hs-type">CaseBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-781"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#CaseBase"><span class="hs-identifier hs-type">CaseBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-782"></span><span id="checkCase"><span class="annot"><span class="annottext">checkCase :: TypeBase (DimDecl VName) Aliasing
-&gt; CaseBase NoInfo Name
-&gt; TermTypeM
     (CaseBase Info VName, TypeBase (DimDecl VName) Aliasing, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkCase"><span class="hs-identifier hs-var hs-var">checkCase</span></a></span></span><span> </span><span id="local-6989586621684561494"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561494"><span class="hs-identifier hs-var">mt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#CasePat"><span class="hs-identifier hs-type">CasePat</span></a></span><span> </span><span id="local-6989586621684561492"><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684561492"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621684561491"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561491"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684561490"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561490"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-783"></span><span>  </span><span class="annot"><span class="annottext">[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; (PatBase Info VName
    -&gt; TermTypeM
         (CaseBase Info VName, TypeBase (DimDecl VName) Aliasing, [VName]))
-&gt; TermTypeM
     (CaseBase Info VName, TypeBase (DimDecl VName) Aliasing, [VName])
forall a.
[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; (PatBase Info VName -&gt; TermTypeM a)
-&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingPat"><span class="hs-identifier hs-var">bindingPat</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684561492"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Ascribed"><span class="hs-identifier hs-var">Ascribed</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561494"><span class="hs-identifier hs-var">mt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PatBase Info VName
  -&gt; TermTypeM
       (CaseBase Info VName, TypeBase (DimDecl VName) Aliasing, [VName]))
 -&gt; TermTypeM
      (CaseBase Info VName, TypeBase (DimDecl VName) Aliasing, [VName]))
-&gt; (PatBase Info VName
    -&gt; TermTypeM
         (CaseBase Info VName, TypeBase (DimDecl VName) Aliasing, [VName]))
-&gt; TermTypeM
     (CaseBase Info VName, TypeBase (DimDecl VName) Aliasing, [VName])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684561489"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561489"><span class="hs-identifier hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-784"></span><span>    </span><span id="local-6989586621684561488"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561488"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561491"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-785"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684561487"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561487"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561486"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561486"><span class="hs-identifier hs-var">retext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; Map VName (IdentBase Info VName)
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#unscopeType"><span class="hs-identifier hs-var">unscopeType</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561490"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Map VName (IdentBase Info VName)
forall (f :: * -&gt; *).
Functor f =&gt;
PatBase f VName -&gt; Map VName (IdentBase f VName)
</span><a href="Language.Futhark.Prop.html#patternMap"><span class="hs-identifier hs-var">patternMap</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561489"><span class="hs-identifier hs-var">p'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName]))
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561488"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-786"></span><span>    </span><span class="annot"><span class="annottext">(CaseBase Info VName, TypeBase (DimDecl VName) Aliasing, [VName])
-&gt; TermTypeM
     (CaseBase Info VName, TypeBase (DimDecl VName) Aliasing, [VName])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Exp -&gt; SrcLoc -&gt; CaseBase Info VName
forall (f :: * -&gt; *) vn.
PatBase f vn -&gt; ExpBase f vn -&gt; SrcLoc -&gt; CaseBase f vn
</span><a href="Language.Futhark.Syntax.html#CasePat"><span class="hs-identifier hs-var">CasePat</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561489"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561488"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561490"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561487"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561486"><span class="hs-identifier hs-var">retext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-787"></span><span>
</span><span id="line-788"></span><span class="hs-comment">-- | An unmatched pattern. Used in in the generation of</span><span>
</span><span id="line-789"></span><span class="hs-comment">-- unmatched pattern warnings by the type checker.</span><span>
</span><span id="line-790"></span><span class="hs-keyword">data</span><span> </span><span id="Unmatched"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#Unmatched"><span class="hs-identifier hs-var">Unmatched</span></a></span></span><span> </span><span id="local-6989586621684563713"><span class="annot"><a href="#local-6989586621684563713"><span class="hs-identifier hs-type">p</span></a></span></span><span>
</span><span id="line-791"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="UnmatchedNum"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#UnmatchedNum"><span class="hs-identifier hs-var">UnmatchedNum</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621684563713"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatLit"><span class="hs-identifier hs-type">PatLit</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-792"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="UnmatchedBool"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#UnmatchedBool"><span class="hs-identifier hs-var">UnmatchedBool</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621684563713"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-793"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="UnmatchedConstr"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#UnmatchedConstr"><span class="hs-identifier hs-var">UnmatchedConstr</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621684563713"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-794"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Unmatched"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#Unmatched"><span class="hs-identifier hs-var">Unmatched</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621684563713"><span class="hs-identifier hs-type">p</span></a></span><span>
</span><span id="line-795"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684561478"><span id="local-6989586621684561480"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; Unmatched a -&gt; Unmatched b)
-&gt; (forall a b. a -&gt; Unmatched b -&gt; Unmatched a)
-&gt; Functor Unmatched
forall a b. a -&gt; Unmatched b -&gt; Unmatched a
forall a b. (a -&gt; b) -&gt; Unmatched a -&gt; Unmatched b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: forall a b. a -&gt; Unmatched b -&gt; Unmatched a
$c&lt;$ :: forall a b. a -&gt; Unmatched b -&gt; Unmatched a
fmap :: forall a b. (a -&gt; b) -&gt; Unmatched a -&gt; Unmatched b
$cfmap :: forall a b. (a -&gt; b) -&gt; Unmatched a -&gt; Unmatched b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561459"><span id="local-6989586621684561461"><span id="local-6989586621684561474"><span class="annot"><span class="annottext">Int -&gt; Unmatched p -&gt; String -&gt; String
[Unmatched p] -&gt; String -&gt; String
Unmatched p -&gt; String
(Int -&gt; Unmatched p -&gt; String -&gt; String)
-&gt; (Unmatched p -&gt; String)
-&gt; ([Unmatched p] -&gt; String -&gt; String)
-&gt; Show (Unmatched p)
forall p. Show p =&gt; Int -&gt; Unmatched p -&gt; String -&gt; String
forall p. Show p =&gt; [Unmatched p] -&gt; String -&gt; String
forall p. Show p =&gt; Unmatched p -&gt; String
forall a.
(Int -&gt; a -&gt; String -&gt; String)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; String -&gt; String) -&gt; Show a
showList :: [Unmatched p] -&gt; String -&gt; String
$cshowList :: forall p. Show p =&gt; [Unmatched p] -&gt; String -&gt; String
show :: Unmatched p -&gt; String
$cshow :: forall p. Show p =&gt; Unmatched p -&gt; String
showsPrec :: Int -&gt; Unmatched p -&gt; String -&gt; String
$cshowsPrec :: forall p. Show p =&gt; Int -&gt; Unmatched p -&gt; String -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-796"></span><span>
</span><span id="line-797"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621684561452"><span id="local-6989586621684561454"><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#Unmatched"><span class="hs-identifier hs-type">Unmatched</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatBase"><span class="hs-identifier hs-type">PatBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-798"></span><span>  </span><span id="local-6989586621684561434"><span class="annot"><span class="annottext">ppr :: Unmatched (PatBase Info VName) -&gt; Doc
</span><a href="#local-6989586621684561434"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span id="local-6989586621684561433"><span class="annot"><span class="annottext">Unmatched (PatBase Info VName)
</span><a href="#local-6989586621684561433"><span class="hs-identifier hs-var">um</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Unmatched (PatBase Info VName)
</span><a href="#local-6989586621684561433"><span class="hs-identifier hs-var">um</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-799"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#UnmatchedNum"><span class="hs-identifier hs-type">UnmatchedNum</span></a></span><span> </span><span id="local-6989586621684561432"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561432"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621684561431"><span class="annot"><span class="annottext">[PatLit]
</span><a href="#local-6989586621684561431"><span class="hs-identifier hs-var">nums</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Doc
forall {v} {f :: * -&gt; *}.
(Eq v, IsName v, Annot f) =&gt;
PatBase f v -&gt; Doc
</span><a href="#local-6989586621684561430"><span class="hs-identifier hs-var">ppr'</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561432"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;where p is not one of&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">[PatLit] -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">[PatLit]
</span><a href="#local-6989586621684561431"><span class="hs-identifier hs-var">nums</span></a></span><span>
</span><span id="line-800"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#UnmatchedBool"><span class="hs-identifier hs-type">UnmatchedBool</span></a></span><span> </span><span id="local-6989586621684561429"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561429"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Doc
forall {v} {f :: * -&gt; *}.
(Eq v, IsName v, Annot f) =&gt;
PatBase f v -&gt; Doc
</span><a href="#local-6989586621684561430"><span class="hs-identifier hs-var">ppr'</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561429"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-801"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#UnmatchedConstr"><span class="hs-identifier hs-type">UnmatchedConstr</span></a></span><span> </span><span id="local-6989586621684561428"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561428"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Doc
forall {v} {f :: * -&gt; *}.
(Eq v, IsName v, Annot f) =&gt;
PatBase f v -&gt; Doc
</span><a href="#local-6989586621684561430"><span class="hs-identifier hs-var">ppr'</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561428"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-802"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#Unmatched"><span class="hs-identifier hs-type">Unmatched</span></a></span><span> </span><span id="local-6989586621684561427"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561427"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Doc
forall {v} {f :: * -&gt; *}.
(Eq v, IsName v, Annot f) =&gt;
PatBase f v -&gt; Doc
</span><a href="#local-6989586621684561430"><span class="hs-identifier hs-var">ppr'</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561427"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-803"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-804"></span><span>      </span><span id="local-6989586621684561430"><span class="annot"><span class="annottext">ppr' :: PatBase f v -&gt; Doc
</span><a href="#local-6989586621684561430"><span class="hs-identifier hs-var hs-var">ppr'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatAscription"><span class="hs-identifier hs-type">PatAscription</span></a></span><span> </span><span id="local-6989586621684561407"><span class="annot"><span class="annottext">PatBase f v
</span><a href="#local-6989586621684561407"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621684561406"><span class="annot"><span class="annottext">TypeDeclBase f v
</span><a href="#local-6989586621684561406"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatBase f v -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">PatBase f v
</span><a href="#local-6989586621684561407"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase f v -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase f v
</span><a href="#local-6989586621684561406"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-805"></span><span>      </span><span class="annot"><a href="#local-6989586621684561430"><span class="hs-identifier hs-var">ppr'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatParens"><span class="hs-identifier hs-type">PatParens</span></a></span><span> </span><span id="local-6989586621684561404"><span class="annot"><span class="annottext">PatBase f v
</span><a href="#local-6989586621684561404"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><span class="hs-identifier hs-var">parens</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatBase f v -&gt; Doc
</span><a href="#local-6989586621684561430"><span class="hs-identifier hs-var">ppr'</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase f v
</span><a href="#local-6989586621684561404"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-806"></span><span>      </span><span class="annot"><a href="#local-6989586621684561430"><span class="hs-identifier hs-var">ppr'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatAttr"><span class="hs-identifier hs-type">PatAttr</span></a></span><span> </span><span class="annot"><span class="annottext">AttrInfo v
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561401"><span class="annot"><span class="annottext">PatBase f v
</span><a href="#local-6989586621684561401"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><span class="hs-identifier hs-var">parens</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatBase f v -&gt; Doc
</span><a href="#local-6989586621684561430"><span class="hs-identifier hs-var">ppr'</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase f v
</span><a href="#local-6989586621684561401"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-807"></span><span>      </span><span class="annot"><a href="#local-6989586621684561430"><span class="hs-identifier hs-var">ppr'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span id="local-6989586621684561399"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621684561399"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">f (TypeBase (DimDecl VName) Aliasing)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">v -&gt; Doc
forall v. IsName v =&gt; v -&gt; Doc
</span><a href="Language.Futhark.Pretty.html#pprName"><span class="hs-identifier hs-var">pprName</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621684561399"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-808"></span><span>      </span><span class="annot"><a href="#local-6989586621684561430"><span class="hs-identifier hs-var">ppr'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TuplePat"><span class="hs-identifier hs-type">TuplePat</span></a></span><span> </span><span id="local-6989586621684561397"><span class="annot"><span class="annottext">[PatBase f v]
</span><a href="#local-6989586621684561397"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><span class="hs-identifier hs-var">parens</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
</span><span class="hs-identifier hs-var">commasep</span></span><span> </span><span class="annot"><span class="annottext">([Doc] -&gt; Doc) -&gt; [Doc] -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PatBase f v -&gt; Doc) -&gt; [PatBase f v] -&gt; [Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PatBase f v -&gt; Doc
</span><a href="#local-6989586621684561430"><span class="hs-identifier hs-var">ppr'</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase f v]
</span><a href="#local-6989586621684561397"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-809"></span><span>      </span><span class="annot"><a href="#local-6989586621684561430"><span class="hs-identifier hs-var">ppr'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RecordPat"><span class="hs-identifier hs-type">RecordPat</span></a></span><span> </span><span id="local-6989586621684561394"><span class="annot"><span class="annottext">[(Name, PatBase f v)]
</span><a href="#local-6989586621684561394"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><span class="hs-identifier hs-var">braces</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
</span><span class="hs-identifier hs-var">commasep</span></span><span> </span><span class="annot"><span class="annottext">([Doc] -&gt; Doc) -&gt; [Doc] -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Name, PatBase f v) -&gt; Doc) -&gt; [(Name, PatBase f v)] -&gt; [Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Name, PatBase f v) -&gt; Doc
</span><a href="#local-6989586621684561392"><span class="hs-identifier hs-var">ppField</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, PatBase f v)]
</span><a href="#local-6989586621684561394"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-810"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-811"></span><span>          </span><span id="local-6989586621684561392"><span class="annot"><span class="annottext">ppField :: (Name, PatBase f v) -&gt; Doc
</span><a href="#local-6989586621684561392"><span class="hs-identifier hs-var hs-var">ppField</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684561389"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561389"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561388"><span class="annot"><span class="annottext">PatBase f v
</span><a href="#local-6989586621684561388"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; String
</span><a href="Language.Futhark.Core.html#nameToString"><span class="hs-identifier hs-var">nameToString</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561389"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-identifier hs-var">equals</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">PatBase f v -&gt; Doc
</span><a href="#local-6989586621684561430"><span class="hs-identifier hs-var">ppr'</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase f v
</span><a href="#local-6989586621684561388"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-812"></span><span>      </span><span class="annot"><a href="#local-6989586621684561430"><span class="hs-identifier hs-var">ppr'</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Wildcard"><span class="hs-identifier hs-type">Wildcard</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;_&quot;</span></span><span>
</span><span id="line-813"></span><span>      </span><span class="annot"><a href="#local-6989586621684561430"><span class="hs-identifier hs-var">ppr'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatLit"><span class="hs-identifier hs-type">PatLit</span></a></span><span> </span><span id="local-6989586621684561383"><span class="annot"><span class="annottext">PatLit
</span><a href="#local-6989586621684561383"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">f (TypeBase (DimDecl VName) Aliasing)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatLit -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">PatLit
</span><a href="#local-6989586621684561383"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-814"></span><span>      </span><span class="annot"><a href="#local-6989586621684561430"><span class="hs-identifier hs-var">ppr'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatConstr"><span class="hs-identifier hs-type">PatConstr</span></a></span><span> </span><span id="local-6989586621684561381"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561381"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">f (TypeBase (DimDecl VName) Aliasing)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561380"><span class="annot"><span class="annottext">[PatBase f v]
</span><a href="#local-6989586621684561380"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;#&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561381"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
</span><span class="hs-identifier hs-var">sep</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PatBase f v -&gt; Doc) -&gt; [PatBase f v] -&gt; [Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PatBase f v -&gt; Doc
</span><a href="#local-6989586621684561430"><span class="hs-identifier hs-var">ppr'</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase f v]
</span><a href="#local-6989586621684561380"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-815"></span><span>
</span><span id="line-816"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkUnmatched"><span class="hs-identifier hs-type">checkUnmatched</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-817"></span><span id="checkUnmatched"><span class="annot"><span class="annottext">checkUnmatched :: Exp -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkUnmatched"><span class="hs-identifier hs-var hs-var">checkUnmatched</span></a></span></span><span> </span><span id="local-6989586621684561377"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561377"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermTypeM Exp -&gt; TermTypeM ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(TermTypeM Exp -&gt; TermTypeM ()) -&gt; TermTypeM Exp -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM ()
forall {f :: * -&gt; *}. MonadTypeChecker f =&gt; Exp -&gt; f ()
</span><a href="#local-6989586621684561375"><span class="hs-identifier hs-var">checkUnmatched'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561377"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM () -&gt; TermTypeM Exp -&gt; TermTypeM Exp
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ASTMapper TermTypeM -&gt; Exp -&gt; TermTypeM Exp
forall x (m :: * -&gt; *).
(ASTMappable x, Monad m) =&gt;
ASTMapper m -&gt; x -&gt; m x
</span><a href="Language.Futhark.Traversals.html#astMap"><span class="hs-identifier hs-var">astMap</span></a></span><span> </span><span class="annot"><span class="annottext">ASTMapper TermTypeM
</span><a href="#local-6989586621684561373"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561377"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-818"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-819"></span><span>    </span><span id="local-6989586621684561375"><span class="annot"><span class="annottext">checkUnmatched' :: Exp -&gt; f ()
</span><a href="#local-6989586621684561375"><span class="hs-identifier hs-var hs-var">checkUnmatched'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561360"><span class="annot"><span class="annottext">NonEmpty (CaseBase Info VName)
</span><a href="#local-6989586621684561360"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621684561359"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561359"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Info AppRes
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-820"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561356"><span class="annot"><span class="annottext">ps :: NonEmpty (PatBase Info VName)
</span><a href="#local-6989586621684561356"><span class="hs-identifier hs-var hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CaseBase Info VName -&gt; PatBase Info VName)
-&gt; NonEmpty (CaseBase Info VName) -&gt; NonEmpty (PatBase Info VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#CasePat"><span class="hs-identifier hs-type">CasePat</span></a></span><span> </span><span id="local-6989586621684561355"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561355"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561355"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (CaseBase Info VName)
</span><a href="#local-6989586621684561360"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-821"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName] -&gt; [Match]
</span><a href="Language.Futhark.TypeChecker.Match.html#unmatched"><span class="hs-identifier hs-var">unmatched</span></a></span><span> </span><span class="annot"><span class="annottext">([PatBase Info VName] -&gt; [Match])
-&gt; [PatBase Info VName] -&gt; [Match]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (PatBase Info VName) -&gt; [PatBase Info VName]
forall a. NonEmpty a -&gt; [a]
</span><span class="hs-identifier hs-var">NE.toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (PatBase Info VName)
</span><a href="#local-6989586621684561356"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-822"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; f ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-823"></span><span>            </span><span id="local-6989586621684561352"><span class="annot"><span class="annottext">[Match]
</span><a href="#local-6989586621684561352"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-824"></span><span>              </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; f ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561359"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; f ()) -&gt; (Doc -&gt; Doc) -&gt; Doc -&gt; f ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Language.Futhark.TypeChecker.Monad.html#withIndexLink"><span class="hs-identifier hs-var">withIndexLink</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;unmatched-cases&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; f ()) -&gt; Doc -&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-825"></span><span>                </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Unmatched cases in match expression:&quot;</span></span><span>
</span><span id="line-826"></span><span>                  </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
</span><span class="hs-identifier hs-var">indent</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
</span><span class="hs-identifier hs-var">stack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Match -&gt; Doc) -&gt; [Match] -&gt; [Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Match -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">[Match]
</span><a href="#local-6989586621684561352"><span class="hs-identifier hs-var">ps'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-827"></span><span>    </span><span class="annot"><a href="#local-6989586621684561375"><span class="hs-identifier hs-var">checkUnmatched'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; f ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-828"></span><span>    </span><span id="local-6989586621684561373"><span class="annot"><span class="annottext">tv :: ASTMapper TermTypeM
</span><a href="#local-6989586621684561373"><span class="hs-identifier hs-var hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ASTMapper TermTypeM
forall (m :: * -&gt; *). Monad m =&gt; ASTMapper m
</span><a href="Language.Futhark.Traversals.html#identityMapper"><span class="hs-identifier hs-var">identityMapper</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">mapOnExp :: Exp -&gt; TermTypeM Exp
</span><a href="Language.Futhark.Traversals.html#mapOnExp"><span class="hs-identifier hs-var">mapOnExp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684561344"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561344"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM ()
forall {f :: * -&gt; *}. MonadTypeChecker f =&gt; Exp -&gt; f ()
</span><a href="#local-6989586621684561375"><span class="hs-identifier hs-var">checkUnmatched'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561344"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM () -&gt; TermTypeM Exp -&gt; TermTypeM Exp
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561344"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-829"></span><span>
</span><span id="line-830"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkIdent"><span class="hs-identifier hs-type">checkIdent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#IdentBase"><span class="hs-identifier hs-type">IdentBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span>
</span><span id="line-831"></span><span id="checkIdent"><span class="annot"><span class="annottext">checkIdent :: IdentBase NoInfo Name -&gt; TermTypeM (IdentBase Info VName)
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkIdent"><span class="hs-identifier hs-var hs-var">checkIdent</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span id="local-6989586621684561343"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561343"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (TypeBase (DimDecl VName) Aliasing)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561342"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561342"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-832"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#QualName"><span class="hs-identifier hs-type">QualName</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561341"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684561341"><span class="hs-identifier hs-var">name'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561340"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561340"><span class="hs-identifier hs-var">vt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; QualName Name
-&gt; TermTypeM (QualName VName, TypeBase (DimDecl VName) Aliasing)
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
SrcLoc
-&gt; QualName Name
-&gt; m (QualName VName, TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Monad.html#lookupVar"><span class="hs-identifier hs-var">lookupVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561342"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; QualName Name
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684561343"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-833"></span><span>  </span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; TermTypeM (IdentBase Info VName)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(IdentBase Info VName -&gt; TermTypeM (IdentBase Info VName))
-&gt; IdentBase Info VName -&gt; TermTypeM (IdentBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
-&gt; SrcLoc
-&gt; IdentBase Info VName
forall (f :: * -&gt; *) vn.
vn
-&gt; f (TypeBase (DimDecl VName) Aliasing)
-&gt; SrcLoc
-&gt; IdentBase f vn
</span><a href="Language.Futhark.Syntax.html#Ident"><span class="hs-identifier hs-var">Ident</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684561341"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561340"><span class="hs-identifier hs-var">vt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561342"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-834"></span><span>
</span><span id="line-835"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkSlice"><span class="hs-identifier hs-type">checkSlice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedSlice"><span class="hs-identifier hs-type">UncheckedSlice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span>
</span><span id="line-836"></span><span id="checkSlice"><span class="annot"><span class="annottext">checkSlice :: SliceBase NoInfo Name -&gt; TermTypeM Slice
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkSlice"><span class="hs-identifier hs-var hs-var">checkSlice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DimIndexBase NoInfo Name -&gt; TermTypeM (DimIndexBase Info VName))
-&gt; SliceBase NoInfo Name -&gt; TermTypeM Slice
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">DimIndexBase NoInfo Name -&gt; TermTypeM (DimIndexBase Info VName)
</span><a href="#local-6989586621684561338"><span class="hs-identifier hs-var">checkDimIndex</span></a></span><span>
</span><span id="line-837"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-838"></span><span>    </span><span id="local-6989586621684561338"><span class="annot"><span class="annottext">checkDimIndex :: DimIndexBase NoInfo Name -&gt; TermTypeM (DimIndexBase Info VName)
</span><a href="#local-6989586621684561338"><span class="hs-identifier hs-var hs-var">checkDimIndex</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#DimFix"><span class="hs-identifier hs-type">DimFix</span></a></span><span> </span><span id="local-6989586621684561332"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561332"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-839"></span><span>      </span><span class="annot"><span class="annottext">Exp -&gt; DimIndexBase Info VName
forall (f :: * -&gt; *) vn. ExpBase f vn -&gt; DimIndexBase f vn
</span><a href="Language.Futhark.Syntax.html#DimFix"><span class="hs-identifier hs-var">DimFix</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; DimIndexBase Info VName)
-&gt; TermTypeM Exp -&gt; TermTypeM (DimIndexBase Info VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [PrimType] -&gt; Exp -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#require"><span class="hs-identifier hs-var">require</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;use as index&quot;</span></span><span> </span><span class="annot"><span class="annottext">[PrimType]
</span><a href="Language.Futhark.TypeChecker.Monad.html#anySignedType"><span class="hs-identifier hs-var">anySignedType</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM Exp) -&gt; TermTypeM Exp -&gt; TermTypeM Exp
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561332"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-840"></span><span>    </span><span class="annot"><a href="#local-6989586621684561338"><span class="hs-identifier hs-var">checkDimIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#DimSlice"><span class="hs-identifier hs-type">DimSlice</span></a></span><span> </span><span id="local-6989586621684561331"><span class="annot"><span class="annottext">Maybe (ExpBase NoInfo Name)
</span><a href="#local-6989586621684561331"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621684561330"><span class="annot"><span class="annottext">Maybe (ExpBase NoInfo Name)
</span><a href="#local-6989586621684561330"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span id="local-6989586621684561329"><span class="annot"><span class="annottext">Maybe (ExpBase NoInfo Name)
</span><a href="#local-6989586621684561329"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-841"></span><span>      </span><span class="annot"><span class="annottext">Maybe Exp -&gt; Maybe Exp -&gt; Maybe Exp -&gt; DimIndexBase Info VName
forall (f :: * -&gt; *) vn.
Maybe (ExpBase f vn)
-&gt; Maybe (ExpBase f vn)
-&gt; Maybe (ExpBase f vn)
-&gt; DimIndexBase f vn
</span><a href="Language.Futhark.Syntax.html#DimSlice"><span class="hs-identifier hs-var">DimSlice</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Exp -&gt; Maybe Exp -&gt; Maybe Exp -&gt; DimIndexBase Info VName)
-&gt; TermTypeM (Maybe Exp)
-&gt; TermTypeM (Maybe Exp -&gt; Maybe Exp -&gt; DimIndexBase Info VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (ExpBase NoInfo Name) -&gt; TermTypeM (Maybe Exp)
</span><a href="#local-6989586621684561328"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ExpBase NoInfo Name)
</span><a href="#local-6989586621684561331"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM (Maybe Exp -&gt; Maybe Exp -&gt; DimIndexBase Info VName)
-&gt; TermTypeM (Maybe Exp)
-&gt; TermTypeM (Maybe Exp -&gt; DimIndexBase Info VName)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (ExpBase NoInfo Name) -&gt; TermTypeM (Maybe Exp)
</span><a href="#local-6989586621684561328"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ExpBase NoInfo Name)
</span><a href="#local-6989586621684561330"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM (Maybe Exp -&gt; DimIndexBase Info VName)
-&gt; TermTypeM (Maybe Exp) -&gt; TermTypeM (DimIndexBase Info VName)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (ExpBase NoInfo Name) -&gt; TermTypeM (Maybe Exp)
</span><a href="#local-6989586621684561328"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ExpBase NoInfo Name)
</span><a href="#local-6989586621684561329"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span>    </span><span id="local-6989586621684561328"><span class="annot"><span class="annottext">check :: Maybe (ExpBase NoInfo Name) -&gt; TermTypeM (Maybe Exp)
</span><a href="#local-6989586621684561328"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-844"></span><span>      </span><span class="annot"><span class="annottext">TermTypeM (Maybe Exp)
-&gt; (ExpBase NoInfo Name -&gt; TermTypeM (Maybe Exp))
-&gt; Maybe (ExpBase NoInfo Name)
-&gt; TermTypeM (Maybe Exp)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Exp -&gt; TermTypeM (Maybe Exp)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Exp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ExpBase NoInfo Name -&gt; TermTypeM (Maybe Exp))
 -&gt; Maybe (ExpBase NoInfo Name) -&gt; TermTypeM (Maybe Exp))
-&gt; (ExpBase NoInfo Name -&gt; TermTypeM (Maybe Exp))
-&gt; Maybe (ExpBase NoInfo Name)
-&gt; TermTypeM (Maybe Exp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-845"></span><span>        </span><span class="annot"><span class="annottext">(Exp -&gt; Maybe Exp) -&gt; TermTypeM Exp -&gt; TermTypeM (Maybe Exp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Maybe Exp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(TermTypeM Exp -&gt; TermTypeM (Maybe Exp))
-&gt; (Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM (Maybe Exp)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; TypeBase (DimDecl VName) () -&gt; Exp -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#unifies"><span class="hs-identifier hs-var">unifies</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;use as index&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ())
-&gt; ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as. PrimType -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimType -&gt; ScalarTypeBase (DimDecl VName) ())
-&gt; PrimType -&gt; ScalarTypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Language.Futhark.Syntax.html#Signed"><span class="hs-identifier hs-var">Signed</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TermTypeM (Maybe Exp))
-&gt; (ExpBase NoInfo Name -&gt; TermTypeM Exp)
-&gt; ExpBase NoInfo Name
-&gt; TermTypeM (Maybe Exp)
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span>
</span><span id="line-846"></span><span>
</span><span id="line-847"></span><span class="hs-comment">-- The number of dimensions affected by this slice (so the minimum</span><span>
</span><span id="line-848"></span><span class="hs-comment">-- rank of the array we are slicing).</span><span>
</span><span id="line-849"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#sliceDims"><span class="hs-identifier hs-type">sliceDims</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-850"></span><span id="sliceDims"><span class="annot"><span class="annottext">sliceDims :: Slice -&gt; Int
</span><a href="Language.Futhark.TypeChecker.Terms.html#sliceDims"><span class="hs-identifier hs-var hs-var">sliceDims</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slice -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span>
</span><span id="line-851"></span><span>
</span><span id="line-852"></span><span class="hs-keyword">type</span><span> </span><span id="Arg"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Occurrences"><span class="hs-identifier hs-type">Occurrences</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span class="hs-special">)</span><span>
</span><span id="line-853"></span><span>
</span><span id="line-854"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#argExp"><span class="hs-identifier hs-type">argExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-855"></span><span id="argExp"><span class="annot"><span class="annottext">argExp :: Arg -&gt; Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#argExp"><span class="hs-identifier hs-var hs-var">argExp</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684561324"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561324"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561324"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-856"></span><span>
</span><span id="line-857"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#argType"><span class="hs-identifier hs-type">argType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span>
</span><span id="line-858"></span><span id="argType"><span class="annot"><span class="annottext">argType :: Arg -&gt; TypeBase (DimDecl VName) Aliasing
</span><a href="Language.Futhark.TypeChecker.Terms.html#argType"><span class="hs-identifier hs-var hs-var">argType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561322"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561322"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561322"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-859"></span><span>
</span><span id="line-860"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkArg"><span class="hs-identifier hs-type">checkArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedExp"><span class="hs-identifier hs-type">UncheckedExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span>
</span><span id="line-861"></span><span id="checkArg"><span class="annot"><span class="annottext">checkArg :: ExpBase NoInfo Name -&gt; TermTypeM Arg
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkArg"><span class="hs-identifier hs-var hs-var">checkArg</span></a></span></span><span> </span><span id="local-6989586621684561321"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561321"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-862"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684561320"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561320"><span class="hs-identifier hs-var">arg'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561319"><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684561319"><span class="hs-identifier hs-var">dflow</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TermTypeM Exp -&gt; TermTypeM (Exp, Occurrences)
forall a. TermTypeM a -&gt; TermTypeM (a, Occurrences)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#collectOccurrences"><span class="hs-identifier hs-var">collectOccurrences</span></a></span><span> </span><span class="annot"><span class="annottext">(TermTypeM Exp -&gt; TermTypeM (Exp, Occurrences))
-&gt; TermTypeM Exp -&gt; TermTypeM (Exp, Occurrences)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561321"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-863"></span><span>  </span><span id="local-6989586621684561317"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561317"><span class="hs-identifier hs-var">arg_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expType"><span class="hs-identifier hs-var">expType</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561320"><span class="hs-identifier hs-var">arg'</span></a></span><span>
</span><span id="line-864"></span><span>  </span><span class="annot"><span class="annottext">Arg -&gt; TermTypeM Arg
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561320"><span class="hs-identifier hs-var">arg'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561317"><span class="hs-identifier hs-var">arg_t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684561319"><span class="hs-identifier hs-var">dflow</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561320"><span class="hs-identifier hs-var">arg'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-865"></span><span>
</span><span id="line-866"></span><span id="local-6989586621684563693"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#instantiateDimsInReturnType"><span class="hs-identifier hs-type">instantiateDimsInReturnType</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-867"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-868"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#QualName"><span class="hs-identifier hs-type">QualName</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-869"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#RetTypeBase"><span class="hs-identifier hs-type">RetTypeBase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#DimDecl"><span class="hs-identifier hs-type">DimDecl</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621684563693"><span class="hs-identifier hs-type">als</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-870"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#DimDecl"><span class="hs-identifier hs-type">DimDecl</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621684563693"><span class="hs-identifier hs-type">als</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-871"></span><span id="instantiateDimsInReturnType"><span class="annot"><span class="annottext">instantiateDimsInReturnType :: forall als.
SrcLoc
-&gt; Maybe (QualName VName)
-&gt; RetTypeBase (DimDecl VName) als
-&gt; TermTypeM (TypeBase (DimDecl VName) als, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#instantiateDimsInReturnType"><span class="hs-identifier hs-var hs-var">instantiateDimsInReturnType</span></a></span></span><span> </span><span id="local-6989586621684561314"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561314"><span class="hs-identifier hs-var">tloc</span></a></span></span><span> </span><span id="local-6989586621684561313"><span class="annot"><span class="annottext">Maybe (QualName VName)
</span><a href="#local-6989586621684561313"><span class="hs-identifier hs-var">fname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-872"></span><span>  </span><span class="annot"><span class="annottext">SrcLoc
-&gt; Rigidity
-&gt; RetTypeBase (DimDecl VName) als
-&gt; TermTypeM (TypeBase (DimDecl VName) als, [VName])
forall (m :: * -&gt; *) als.
MonadUnify m =&gt;
SrcLoc
-&gt; Rigidity
-&gt; RetTypeBase (DimDecl VName) als
-&gt; m (TypeBase (DimDecl VName) als, [VName])
</span><a href="Language.Futhark.TypeChecker.Unify.html#instantiateEmptyArrayDims"><span class="hs-identifier hs-var">instantiateEmptyArrayDims</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561314"><span class="hs-identifier hs-var">tloc</span></a></span><span> </span><span class="annot"><span class="annottext">(Rigidity
 -&gt; RetTypeBase (DimDecl VName) als
 -&gt; TermTypeM (TypeBase (DimDecl VName) als, [VName]))
-&gt; Rigidity
-&gt; RetTypeBase (DimDecl VName) als
-&gt; TermTypeM (TypeBase (DimDecl VName) als, [VName])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RigidSource -&gt; Rigidity
</span><a href="Language.Futhark.TypeChecker.Unify.html#Rigid"><span class="hs-identifier hs-var">Rigid</span></a></span><span> </span><span class="annot"><span class="annottext">(RigidSource -&gt; Rigidity) -&gt; RigidSource -&gt; Rigidity
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe (QualName VName) -&gt; RigidSource
</span><a href="Language.Futhark.TypeChecker.Unify.html#RigidRet"><span class="hs-identifier hs-var">RigidRet</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (QualName VName)
</span><a href="#local-6989586621684561313"><span class="hs-identifier hs-var">fname</span></a></span><span>
</span><span id="line-873"></span><span>
</span><span id="line-874"></span><span class="hs-comment">-- Some information about the function/operator we are trying to</span><span>
</span><span id="line-875"></span><span class="hs-comment">-- apply, and how many arguments it has previously accepted.  Used for</span><span>
</span><span id="line-876"></span><span class="hs-comment">-- generating nicer type errors.</span><span>
</span><span id="line-877"></span><span class="hs-keyword">type</span><span> </span><span id="ApplyOp"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#ApplyOp"><span class="hs-identifier hs-var">ApplyOp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#QualName"><span class="hs-identifier hs-type">QualName</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-878"></span><span>
</span><span id="line-879"></span><span class="hs-comment">-- | Extract all those names that are bound inside the type.</span><span>
</span><span id="line-880"></span><span id="local-6989586621684561310"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#boundInsideType"><span class="hs-identifier hs-type">boundInsideType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#DimDecl"><span class="hs-identifier hs-type">DimDecl</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621684561310"><span class="hs-keyword hs-type">as</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span></span><span>
</span><span id="line-881"></span><span id="boundInsideType"><span class="annot"><span class="annottext">boundInsideType :: forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#boundInsideType"><span class="hs-identifier hs-var hs-var">boundInsideType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><span class="annottext">as
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561295"><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561295"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">ShapeDecl (DimDecl VName)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; Set VName
forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#boundInsideType"><span class="hs-identifier hs-var">boundInsideType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561295"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-882"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#boundInsideType"><span class="hs-identifier hs-var">boundInsideType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set VName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-883"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#boundInsideType"><span class="hs-identifier hs-var">boundInsideType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">as
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561294"><span class="annot"><span class="annottext">[TypeArg (DimDecl VName)]
</span><a href="#local-6989586621684561294"><span class="hs-identifier hs-var">targs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TypeArg (DimDecl VName) -&gt; Set VName)
-&gt; [TypeArg (DimDecl VName)] -&gt; Set VName
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">TypeArg (DimDecl VName) -&gt; Set VName
</span><a href="#local-6989586621684561293"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeArg (DimDecl VName)]
</span><a href="#local-6989586621684561294"><span class="hs-identifier hs-var">targs</span></a></span><span>
</span><span id="line-884"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-885"></span><span>    </span><span id="local-6989586621684561293"><span class="annot"><span class="annottext">f :: TypeArg (DimDecl VName) -&gt; Set VName
</span><a href="#local-6989586621684561293"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeArgType"><span class="hs-identifier hs-type">TypeArgType</span></a></span><span> </span><span id="local-6989586621684561289"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561289"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; Set VName
forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#boundInsideType"><span class="hs-identifier hs-var">boundInsideType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561289"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-886"></span><span>    </span><span class="annot"><a href="#local-6989586621684561293"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeArgDim"><span class="hs-identifier hs-type">TypeArgDim</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set VName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-887"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#boundInsideType"><span class="hs-identifier hs-var">boundInsideType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span id="local-6989586621684561287"><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) as)
</span><a href="#local-6989586621684561287"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) as -&gt; Set VName)
-&gt; Map Name (TypeBase (DimDecl VName) as) -&gt; Set VName
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as -&gt; Set VName
forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#boundInsideType"><span class="hs-identifier hs-var">boundInsideType</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) as)
</span><a href="#local-6989586621684561287"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-888"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#boundInsideType"><span class="hs-identifier hs-var">boundInsideType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Sum"><span class="hs-identifier hs-type">Sum</span></a></span><span> </span><span id="local-6989586621684561286"><span class="annot"><span class="annottext">Map Name [TypeBase (DimDecl VName) as]
</span><a href="#local-6989586621684561286"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([TypeBase (DimDecl VName) as] -&gt; Set VName)
-&gt; Map Name [TypeBase (DimDecl VName) as] -&gt; Set VName
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) as -&gt; Set VName)
-&gt; [TypeBase (DimDecl VName) as] -&gt; Set VName
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as -&gt; Set VName
forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#boundInsideType"><span class="hs-identifier hs-var">boundInsideType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Name [TypeBase (DimDecl VName) as]
</span><a href="#local-6989586621684561286"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-889"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#boundInsideType"><span class="hs-identifier hs-var">boundInsideType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-type">Arrow</span></a></span><span> </span><span class="annot"><span class="annottext">as
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561285"><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684561285"><span class="hs-identifier hs-var">pn</span></a></span></span><span> </span><span id="local-6989586621684561284"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561284"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-type">RetType</span></a></span><span> </span><span id="local-6989586621684561283"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561283"><span class="hs-identifier hs-var">dims</span></a></span></span><span> </span><span id="local-6989586621684561282"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561282"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-890"></span><span>  </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561281"><span class="hs-identifier hs-var">pn'</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as -&gt; Set VName
forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#boundInsideType"><span class="hs-identifier hs-var">boundInsideType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561284"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; Set VName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561283"><span class="hs-identifier hs-var">dims</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as -&gt; Set VName
forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#boundInsideType"><span class="hs-identifier hs-var">boundInsideType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561282"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-891"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-892"></span><span>    </span><span id="local-6989586621684561281"><span class="annot"><span class="annottext">pn' :: Set VName
</span><a href="#local-6989586621684561281"><span class="hs-identifier hs-var hs-var">pn'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684561285"><span class="hs-identifier hs-var">pn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-893"></span><span>      </span><span class="annot"><span class="annottext">PName
</span><a href="Language.Futhark.Syntax.html#Unnamed"><span class="hs-identifier hs-var">Unnamed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set VName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-894"></span><span>      </span><span class="annot"><a href="Language.Futhark.Syntax.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span id="local-6989586621684561278"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684561278"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Set VName
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">S.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684561278"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-895"></span><span>
</span><span id="line-896"></span><span class="hs-comment">-- Returns the sizes of the immediate type produced,</span><span>
</span><span id="line-897"></span><span class="hs-comment">-- the sizes of parameter types, and the sizes of return types.</span><span>
</span><span id="line-898"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#dimUses"><span class="hs-identifier hs-type">dimUses</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#StructType"><span class="hs-identifier hs-type">StructType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Names"><span class="hs-identifier hs-type">Names</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Names"><span class="hs-identifier hs-type">Names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-899"></span><span id="dimUses"><span class="annot"><span class="annottext">dimUses :: TypeBase (DimDecl VName) () -&gt; (Set VName, Set VName)
</span><a href="Language.Futhark.TypeChecker.Terms.html#dimUses"><span class="hs-identifier hs-var hs-var">dimUses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(State (Set VName, Set VName) (TypeBase () ())
 -&gt; (Set VName, Set VName) -&gt; (Set VName, Set VName))
-&gt; (Set VName, Set VName)
-&gt; State (Set VName, Set VName) (TypeBase () ())
-&gt; (Set VName, Set VName)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">State (Set VName, Set VName) (TypeBase () ())
-&gt; (Set VName, Set VName) -&gt; (Set VName, Set VName)
forall s a. State s a -&gt; s -&gt; s
</span><span class="hs-identifier hs-var">execState</span></span><span> </span><span class="annot"><span class="annottext">(Set VName, Set VName)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(State (Set VName, Set VName) (TypeBase () ())
 -&gt; (Set VName, Set VName))
-&gt; (TypeBase (DimDecl VName) ()
    -&gt; State (Set VName, Set VName) (TypeBase () ()))
-&gt; TypeBase (DimDecl VName) ()
-&gt; (Set VName, Set VName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Set VName
 -&gt; DimPos
 -&gt; DimDecl VName
 -&gt; StateT (Set VName, Set VName) Identity ())
-&gt; TypeBase (DimDecl VName) ()
-&gt; State (Set VName, Set VName) (TypeBase () ())
forall (f :: * -&gt; *) fdim tdim als.
Applicative f =&gt;
(Set VName -&gt; DimPos -&gt; fdim -&gt; f tdim)
-&gt; TypeBase fdim als -&gt; f (TypeBase tdim als)
</span><a href="Language.Futhark.Prop.html#traverseDims"><span class="hs-identifier hs-var">traverseDims</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName
-&gt; DimPos
-&gt; DimDecl VName
-&gt; StateT (Set VName, Set VName) Identity ()
forall {a} {f :: * -&gt; *}.
(Ord a, MonadState (Set a, Set a) f) =&gt;
Set a -&gt; DimPos -&gt; DimDecl a -&gt; f ()
</span><a href="#local-6989586621684561274"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-900"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-901"></span><span>    </span><span id="local-6989586621684561274"><span class="annot"><span class="annottext">f :: Set a -&gt; DimPos -&gt; DimDecl a -&gt; f ()
</span><a href="#local-6989586621684561274"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621684561257"><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621684561257"><span class="hs-identifier hs-var">bound</span></a></span></span><span> </span><span class="annot"><span class="annottext">DimPos
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#NamedDim"><span class="hs-identifier hs-type">NamedDim</span></a></span><span> </span><span id="local-6989586621684561256"><span class="annot"><span class="annottext">QualName a
</span><a href="#local-6989586621684561256"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QualName a -&gt; a
forall vn. QualName vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#qualLeaf"><span class="hs-identifier hs-var hs-var">qualLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">QualName a
</span><a href="#local-6989586621684561256"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Set a -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621684561257"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; f ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-902"></span><span>    </span><span class="annot"><a href="#local-6989586621684561274"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">DimPos
</span><a href="Language.Futhark.Prop.html#PosImmediate"><span class="hs-identifier hs-var">PosImmediate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#NamedDim"><span class="hs-identifier hs-type">NamedDim</span></a></span><span> </span><span id="local-6989586621684561254"><span class="annot"><span class="annottext">QualName a
</span><a href="#local-6989586621684561254"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Set a, Set a) -&gt; (Set a, Set a)) -&gt; f ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Set a
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">S.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName a -&gt; a
forall vn. QualName vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#qualLeaf"><span class="hs-identifier hs-var hs-var">qualLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">QualName a
</span><a href="#local-6989586621684561254"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Set a, Set a) -&gt; (Set a, Set a) -&gt; (Set a, Set a)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span>
</span><span id="line-903"></span><span>    </span><span class="annot"><a href="#local-6989586621684561274"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">DimPos
</span><a href="Language.Futhark.Prop.html#PosParam"><span class="hs-identifier hs-var">PosParam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#NamedDim"><span class="hs-identifier hs-type">NamedDim</span></a></span><span> </span><span id="local-6989586621684561252"><span class="annot"><span class="annottext">QualName a
</span><a href="#local-6989586621684561252"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Set a, Set a) -&gt; (Set a, Set a)) -&gt; f ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Set a
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">S.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName a -&gt; a
forall vn. QualName vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#qualLeaf"><span class="hs-identifier hs-var hs-var">qualLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">QualName a
</span><a href="#local-6989586621684561252"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Set a, Set a) -&gt; (Set a, Set a) -&gt; (Set a, Set a)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span>
</span><span id="line-904"></span><span>    </span><span class="annot"><a href="#local-6989586621684561274"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">DimPos
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">DimDecl a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; f ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-905"></span><span>
</span><span id="line-906"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkApply"><span class="hs-identifier hs-type">checkApply</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-907"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-908"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#ApplyOp"><span class="hs-identifier hs-type">ApplyOp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-909"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-910"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-911"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span id="checkApply"><span class="annot"><span class="annottext">checkApply :: SrcLoc
-&gt; ApplyOp
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Arg
-&gt; TermTypeM
     (TypeBase (DimDecl VName) Aliasing,
      TypeBase (DimDecl VName) Aliasing, Maybe VName, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkApply"><span class="hs-identifier hs-var hs-var">checkApply</span></a></span></span><span>
</span><span id="line-913"></span><span>  </span><span id="local-6989586621684561251"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561251"><span class="hs-identifier hs-var">loc</span></a></span></span><span>
</span><span id="line-914"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684561250"><span class="annot"><span class="annottext">Maybe (QualName VName)
</span><a href="#local-6989586621684561250"><span class="hs-identifier hs-var">fname</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-915"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-type">Arrow</span></a></span><span> </span><span id="local-6989586621684561249"><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561249"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span id="local-6989586621684561248"><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684561248"><span class="hs-identifier hs-var">pname</span></a></span></span><span> </span><span id="local-6989586621684561247"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561247"><span class="hs-identifier hs-var">tp1</span></a></span></span><span> </span><span id="local-6989586621684561246"><span class="annot"><span class="annottext">RetTypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561246"><span class="hs-identifier hs-var">tp2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-916"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684561245"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561245"><span class="hs-identifier hs-var">argexp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561244"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561244"><span class="hs-identifier hs-var">argtype</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561243"><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684561243"><span class="hs-identifier hs-var">dflow</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561242"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561242"><span class="hs-identifier hs-var">argloc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-917"></span><span>    </span><span class="annot"><span class="annottext">Checking
-&gt; TermTypeM
     (TypeBase (DimDecl VName) Aliasing,
      TypeBase (DimDecl VName) Aliasing, Maybe VName, [VName])
-&gt; TermTypeM
     (TypeBase (DimDecl VName) Aliasing,
      TypeBase (DimDecl VName) Aliasing, Maybe VName, [VName])
forall a. Checking -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#onFailure"><span class="hs-identifier hs-var">onFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (QualName VName)
-&gt; Exp
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; Checking
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#CheckingApply"><span class="hs-identifier hs-var">CheckingApply</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (QualName VName)
</span><a href="#local-6989586621684561250"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561245"><span class="hs-identifier hs-var">argexp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561247"><span class="hs-identifier hs-var">tp1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561244"><span class="hs-identifier hs-var">argtype</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM
   (TypeBase (DimDecl VName) Aliasing,
    TypeBase (DimDecl VName) Aliasing, Maybe VName, [VName])
 -&gt; TermTypeM
      (TypeBase (DimDecl VName) Aliasing,
       TypeBase (DimDecl VName) Aliasing, Maybe VName, [VName]))
-&gt; TermTypeM
     (TypeBase (DimDecl VName) Aliasing,
      TypeBase (DimDecl VName) Aliasing, Maybe VName, [VName])
-&gt; TermTypeM
     (TypeBase (DimDecl VName) Aliasing,
      TypeBase (DimDecl VName) Aliasing, Maybe VName, [VName])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-918"></span><span>      </span><span class="annot"><span class="annottext">Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#expect"><span class="hs-identifier hs-var">expect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; String -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561242"><span class="hs-identifier hs-var">argloc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;use as function argument&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561247"><span class="hs-identifier hs-var">tp1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561244"><span class="hs-identifier hs-var">argtype</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-919"></span><span>
</span><span id="line-920"></span><span>      </span><span class="hs-comment">-- Perform substitutions of instantiated variables in the types.</span><span>
</span><span id="line-921"></span><span>      </span><span id="local-6989586621684561239"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561239"><span class="hs-identifier hs-var">tp1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall a (m :: * -&gt; *). (Substitutable a, MonadUnify m) =&gt; a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Unify.html#normTypeFully"><span class="hs-identifier hs-var">normTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561247"><span class="hs-identifier hs-var">tp1</span></a></span><span>
</span><span id="line-922"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684561238"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561238"><span class="hs-identifier hs-var">tp2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561237"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561237"><span class="hs-identifier hs-var">ext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; Maybe (QualName VName)
-&gt; RetTypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
forall als.
SrcLoc
-&gt; Maybe (QualName VName)
-&gt; RetTypeBase (DimDecl VName) als
-&gt; TermTypeM (TypeBase (DimDecl VName) als, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#instantiateDimsInReturnType"><span class="hs-identifier hs-var">instantiateDimsInReturnType</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561251"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (QualName VName)
</span><a href="#local-6989586621684561250"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">(RetTypeBase (DimDecl VName) Aliasing
 -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName]))
-&gt; TermTypeM (RetTypeBase (DimDecl VName) Aliasing)
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">RetTypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (RetTypeBase (DimDecl VName) Aliasing)
forall a (m :: * -&gt; *). (Substitutable a, MonadUnify m) =&gt; a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Unify.html#normTypeFully"><span class="hs-identifier hs-var">normTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">RetTypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561246"><span class="hs-identifier hs-var">tp2</span></a></span><span>
</span><span id="line-923"></span><span>      </span><span id="local-6989586621684561236"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561236"><span class="hs-identifier hs-var">argtype'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall a (m :: * -&gt; *). (Substitutable a, MonadUnify m) =&gt; a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Unify.html#normTypeFully"><span class="hs-identifier hs-var">normTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561244"><span class="hs-identifier hs-var">argtype</span></a></span><span>
</span><span id="line-924"></span><span>
</span><span id="line-925"></span><span>      </span><span class="hs-comment">-- Check whether this would produce an impossible return type.</span><span>
</span><span id="line-926"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684561235"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561235"><span class="hs-identifier hs-var">tp2_produced_dims</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561234"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561234"><span class="hs-identifier hs-var">tp2_paramdims</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; (Set VName, Set VName)
</span><a href="Language.Futhark.TypeChecker.Terms.html#dimUses"><span class="hs-identifier hs-var">dimUses</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) () -&gt; (Set VName, Set VName))
-&gt; TypeBase (DimDecl VName) () -&gt; (Set VName, Set VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561238"><span class="hs-identifier hs-var">tp2'</span></a></span><span>
</span><span id="line-927"></span><span>          </span><span id="local-6989586621684561230"><span class="annot"><span class="annottext">problematic :: Set VName
</span><a href="#local-6989586621684561230"><span class="hs-identifier hs-var hs-var">problematic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; Set VName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561237"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Set VName
forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#boundInsideType"><span class="hs-identifier hs-var">boundInsideType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561236"><span class="hs-identifier hs-var">argtype'</span></a></span><span>
</span><span id="line-928"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TermTypeM () -&gt; TermTypeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(VName -&gt; Bool) -&gt; Set VName -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561230"><span class="hs-identifier hs-var">problematic</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561234"><span class="hs-identifier hs-var">tp2_paramdims</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`S.difference`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561235"><span class="hs-identifier hs-var">tp2_produced_dims</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM () -&gt; TermTypeM ()) -&gt; TermTypeM () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-929"></span><span>        </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TermTypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561251"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM ()) -&gt; (Doc -&gt; Doc) -&gt; Doc -&gt; TermTypeM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Language.Futhark.TypeChecker.Monad.html#withIndexLink"><span class="hs-identifier hs-var">withIndexLink</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;existential-param-ret&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM ()) -&gt; Doc -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-930"></span><span>          </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Existential size would appear in function parameter of return type:&quot;</span></span><span>
</span><span id="line-931"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
</span><span class="hs-identifier hs-var">indent</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RetTypeBase (DimDecl VName) Aliasing -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[VName]
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; RetTypeBase (DimDecl VName) Aliasing
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561237"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561238"><span class="hs-identifier hs-var">tp2'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-932"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc
</span><a href="Futhark.Util.Pretty.html#textwrap"><span class="hs-identifier hs-var">textwrap</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;This is usually because a higher-order function is used with functional arguments that return existential sizes or locally named sizes, which are then used as parameters of other function arguments.&quot;</span></span><span>
</span><span id="line-933"></span><span>
</span><span id="line-934"></span><span>      </span><span class="annot"><span class="annottext">Occurrences -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#occur"><span class="hs-identifier hs-var">occur</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Aliasing -&gt; SrcLoc -&gt; Occurrence
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#observation"><span class="hs-identifier hs-var">observation</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561249"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561251"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-935"></span><span>
</span><span id="line-936"></span><span>      </span><span class="annot"><span class="annottext">Occurrences -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#checkOccurrences"><span class="hs-identifier hs-var">checkOccurrences</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684561243"><span class="hs-identifier hs-var">dflow</span></a></span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Occurrences -&gt; Maybe Occurrence
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#anyConsumption"><span class="hs-identifier hs-var">anyConsumption</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684561243"><span class="hs-identifier hs-var">dflow</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-939"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684561225"><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621684561225"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-940"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561221"><span class="annot"><span class="annottext">msg :: String
</span><a href="#local-6989586621684561221"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;type of expression with consumption at &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; String
forall a. Located a =&gt; a -&gt; String
</span><a href="Language.Futhark.Core.html#locStr"><span class="hs-identifier hs-var">locStr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Occurrence -&gt; SrcLoc
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#location"><span class="hs-identifier hs-var hs-var">location</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621684561225"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-941"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Usage
-&gt; String -&gt; TypeBase (DimDecl VName) Aliasing -&gt; TermTypeM ()
forall (m :: * -&gt; *) dim as.
(MonadUnify m, Pretty (ShapeDecl dim), Monoid as) =&gt;
Usage -&gt; String -&gt; TypeBase dim as -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#zeroOrderType"><span class="hs-identifier hs-var">zeroOrderType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; String -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561242"><span class="hs-identifier hs-var">argloc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;potential consumption in expression&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684561221"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561247"><span class="hs-identifier hs-var">tp1</span></a></span><span>
</span><span id="line-942"></span><span>        </span><span class="annot"><span class="annottext">Maybe Occurrence
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TermTypeM ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-943"></span><span>
</span><span id="line-944"></span><span>      </span><span id="local-6989586621684561220"><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684561220"><span class="hs-identifier hs-var">occurs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684561243"><span class="hs-identifier hs-var">dflow</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrences -&gt; Occurrences -&gt; Occurrences
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#seqOccurrences"><span class="hs-operator hs-var">`seqOccurrences`</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Occurrences -&gt; Occurrences)
-&gt; TermTypeM Occurrences -&gt; TermTypeM Occurrences
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Diet
-&gt; TermTypeM Occurrences
</span><a href="Language.Futhark.TypeChecker.Terms.html#consumeArg"><span class="hs-identifier hs-var">consumeArg</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561242"><span class="hs-identifier hs-var">argloc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561236"><span class="hs-identifier hs-var">argtype'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Diet
forall shape as. TypeBase shape as -&gt; Diet
</span><a href="Language.Futhark.Prop.html#diet"><span class="hs-identifier hs-var">diet</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561239"><span class="hs-identifier hs-var">tp1'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-945"></span><span>
</span><span id="line-946"></span><span>      </span><span class="annot"><span class="annottext">SrcLoc -&gt; Aliasing -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#checkIfConsumable"><span class="hs-identifier hs-var">checkIfConsumable</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561251"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(Aliasing -&gt; TermTypeM ()) -&gt; Aliasing -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Alias) -&gt; Set VName -&gt; Aliasing
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">S.map</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Alias
</span><a href="Language.Futhark.Syntax.html#AliasBound"><span class="hs-identifier hs-var">AliasBound</span></a></span><span> </span><span class="annot"><span class="annottext">(Set VName -&gt; Aliasing) -&gt; Set VName -&gt; Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Occurrences -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#allConsumed"><span class="hs-identifier hs-var">allConsumed</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684561220"><span class="hs-identifier hs-var">occurs</span></a></span><span>
</span><span id="line-947"></span><span>      </span><span class="annot"><span class="annottext">Occurrences -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#occur"><span class="hs-identifier hs-var">occur</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684561220"><span class="hs-identifier hs-var">occurs</span></a></span><span>
</span><span id="line-948"></span><span>
</span><span id="line-949"></span><span>      </span><span class="hs-comment">-- Unification ignores uniqueness in higher-order arguments, so</span><span>
</span><span id="line-950"></span><span>      </span><span class="hs-comment">-- we check for that here.</span><span>
</span><span id="line-951"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TermTypeM () -&gt; TermTypeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase () ()
forall dim as. TypeBase dim as -&gt; TypeBase () ()
</span><a href="Language.Futhark.Prop.html#toStructural"><span class="hs-identifier hs-var">toStructural</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561236"><span class="hs-identifier hs-var">argtype'</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase () () -&gt; TypeBase () () -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.Types.html#subtypeOf"><span class="hs-operator hs-var">`subtypeOf`</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase () ()
forall dim as. TypeBase dim as -&gt; TypeBase () ()
</span><a href="Language.Futhark.Prop.html#toStructural"><span class="hs-identifier hs-var">toStructural</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561239"><span class="hs-identifier hs-var">tp1'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM () -&gt; TermTypeM ()) -&gt; TermTypeM () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-952"></span><span>        </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TermTypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561251"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Uniqueness does not match.&quot;</span></span><span>
</span><span id="line-953"></span><span>
</span><span id="line-954"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684561216"><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684561216"><span class="hs-identifier hs-var">argext</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561215"><span class="annot"><span class="annottext">VName -&gt; Maybe (Subst StructRetType)
</span><a href="#local-6989586621684561215"><span class="hs-identifier hs-var">parsubst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-955"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684561248"><span class="hs-identifier hs-var">pname</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-956"></span><span>          </span><span class="annot"><a href="Language.Futhark.Syntax.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span id="local-6989586621684561214"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684561214"><span class="hs-identifier hs-var">pname'</span></a></span></span><span>
</span><span id="line-957"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Signed"><span class="hs-identifier hs-type">Signed</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561239"><span class="hs-identifier hs-var">tp1'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-958"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621684561213"><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684561213"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561212"><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684561212"><span class="hs-identifier hs-var">argext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (QualName VName)
-&gt; Exp -&gt; TermTypeM (DimDecl VName, Maybe VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#dimFromArg"><span class="hs-identifier hs-var">dimFromArg</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (QualName VName)
</span><a href="#local-6989586621684561250"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561245"><span class="hs-identifier hs-var">argexp</span></a></span><span>
</span><span id="line-959"></span><span>              </span><span class="annot"><span class="annottext">(Maybe VName, VName -&gt; Maybe (Subst StructRetType))
-&gt; TermTypeM (Maybe VName, VName -&gt; Maybe (Subst StructRetType))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-960"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684561212"><span class="hs-identifier hs-var">argext</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-961"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
-&gt; Map VName (Subst StructRetType) -&gt; Maybe (Subst StructRetType)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-operator hs-var">`M.lookup`</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Subst StructRetType -&gt; Map VName (Subst StructRetType)
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684561214"><span class="hs-identifier hs-var">pname'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DimDecl VName -&gt; Subst StructRetType
forall t. DimDecl VName -&gt; Subst t
</span><a href="Language.Futhark.TypeChecker.Types.html#SizeSubst"><span class="hs-identifier hs-var">SizeSubst</span></a></span><span> </span><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684561213"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-962"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-963"></span><span>          </span><span class="annot"><span class="annottext">PName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe VName, VName -&gt; Maybe (Subst StructRetType))
-&gt; TermTypeM (Maybe VName, VName -&gt; Maybe (Subst StructRetType))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe VName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Subst StructRetType) -&gt; VName -&gt; Maybe (Subst StructRetType)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Subst StructRetType)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-964"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561208"><span class="annot"><span class="annottext">tp2'' :: TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561208"><span class="hs-identifier hs-var hs-var">tp2''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Maybe (Subst StructRetType))
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall a.
Substitutable a =&gt;
(VName -&gt; Maybe (Subst StructRetType)) -&gt; a -&gt; a
</span><a href="Language.Futhark.TypeChecker.Types.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Maybe (Subst StructRetType)
</span><a href="#local-6989586621684561215"><span class="hs-identifier hs-var">parsubst</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Diet
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
</span><a href="Language.Futhark.TypeChecker.Terms.html#returnType"><span class="hs-identifier hs-var">returnType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561238"><span class="hs-identifier hs-var">tp2'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Diet
forall shape as. TypeBase shape as -&gt; Diet
</span><a href="Language.Futhark.Prop.html#diet"><span class="hs-identifier hs-var">diet</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561239"><span class="hs-identifier hs-var">tp1'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561236"><span class="hs-identifier hs-var">argtype'</span></a></span><span>
</span><span id="line-965"></span><span>
</span><span id="line-966"></span><span>      </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing,
 TypeBase (DimDecl VName) Aliasing, Maybe VName, [VName])
-&gt; TermTypeM
     (TypeBase (DimDecl VName) Aliasing,
      TypeBase (DimDecl VName) Aliasing, Maybe VName, [VName])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561239"><span class="hs-identifier hs-var">tp1'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561208"><span class="hs-identifier hs-var">tp2''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684561216"><span class="hs-identifier hs-var">argext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561237"><span class="hs-identifier hs-var">ext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-967"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkApply"><span class="hs-identifier hs-var">checkApply</span></a></span><span> </span><span id="local-6989586621684561205"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561205"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621684561204"><span class="annot"><span class="annottext">ApplyOp
</span><a href="#local-6989586621684561204"><span class="hs-identifier hs-var">fname</span></a></span></span><span> </span><span id="local-6989586621684561203"><span class="annot"><span class="annottext">tfun :: TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561203"><span class="hs-identifier hs-var">tfun</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621684561202"><span class="annot"><span class="annottext">Arg
</span><a href="#local-6989586621684561202"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-968"></span><span>  </span><span id="local-6989586621684561201"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561201"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Name -&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall (m :: * -&gt; *) als dim.
(MonadUnify m, Monoid als) =&gt;
SrcLoc -&gt; Name -&gt; m (TypeBase dim als)
</span><a href="Language.Futhark.TypeChecker.Unify.html#newTypeVar"><span class="hs-identifier hs-var">newTypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561205"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;b&quot;</span></span><span>
</span><span id="line-969"></span><span>  </span><span class="hs-comment">-- Change the uniqueness of the argument type because we never want</span><span>
</span><span id="line-970"></span><span>  </span><span class="hs-comment">-- to infer that a function is consuming.</span><span>
</span><span id="line-971"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561200"><span class="annot"><span class="annottext">argt_nonunique :: TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561200"><span class="hs-identifier hs-var hs-var">argt_nonunique</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg -&gt; TypeBase (DimDecl VName) Aliasing
</span><a href="Language.Futhark.TypeChecker.Terms.html#argType"><span class="hs-identifier hs-var">argType</span></a></span><span> </span><span class="annot"><span class="annottext">Arg
</span><a href="#local-6989586621684561202"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
-&gt; Uniqueness -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; Uniqueness -&gt; TypeBase dim as
</span><a href="Language.Futhark.Prop.html#setUniqueness"><span class="hs-operator hs-var">`setUniqueness`</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Nonunique"><span class="hs-identifier hs-var">Nonunique</span></a></span><span>
</span><span id="line-972"></span><span>  </span><span class="annot"><span class="annottext">Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; String -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561205"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;use as function&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561203"><span class="hs-identifier hs-var">tfun</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) () -&gt; TermTypeM ())
-&gt; TypeBase (DimDecl VName) () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-973"></span><span>    </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ())
-&gt; ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">()
-&gt; PName
-&gt; TypeBase (DimDecl VName) ()
-&gt; StructRetType
-&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as.
as
-&gt; PName
-&gt; TypeBase dim as
-&gt; RetTypeBase dim as
-&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-var">Arrow</span></a></span><span> </span><span class="annot"><span class="annottext">()
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">PName
</span><a href="Language.Futhark.Syntax.html#Unnamed"><span class="hs-identifier hs-var">Unnamed</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561200"><span class="hs-identifier hs-var">argt_nonunique</span></a></span><span> </span><span class="annot"><span class="annottext">(StructRetType -&gt; ScalarTypeBase (DimDecl VName) ())
-&gt; StructRetType -&gt; ScalarTypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; TypeBase (DimDecl VName) () -&gt; StructRetType
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561201"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-974"></span><span>  </span><span id="local-6989586621684561197"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561197"><span class="hs-identifier hs-var">tfun'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall (m :: * -&gt; *).
MonadUnify m =&gt;
TypeBase (DimDecl VName) Aliasing
-&gt; m (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Unify.html#normPatType"><span class="hs-identifier hs-var">normPatType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561203"><span class="hs-identifier hs-var">tfun</span></a></span><span>
</span><span id="line-975"></span><span>  </span><span class="annot"><span class="annottext">SrcLoc
-&gt; ApplyOp
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Arg
-&gt; TermTypeM
     (TypeBase (DimDecl VName) Aliasing,
      TypeBase (DimDecl VName) Aliasing, Maybe VName, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkApply"><span class="hs-identifier hs-var">checkApply</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561205"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">ApplyOp
</span><a href="#local-6989586621684561204"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561197"><span class="hs-identifier hs-var">tfun'</span></a></span><span> </span><span class="annot"><span class="annottext">Arg
</span><a href="#local-6989586621684561202"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-976"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkApply"><span class="hs-identifier hs-var">checkApply</span></a></span><span> </span><span id="local-6989586621684561195"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561195"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684561194"><span class="annot"><span class="annottext">Maybe (QualName VName)
</span><a href="#local-6989586621684561194"><span class="hs-identifier hs-var">fname</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561193"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684561193"><span class="hs-identifier hs-var">prev_applied</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684561192"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561192"><span class="hs-identifier hs-var">ftype</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684561191"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561191"><span class="hs-identifier hs-var">argexp</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-977"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561187"><span class="annot"><span class="annottext">fname' :: Doc
</span><a href="#local-6989586621684561187"><span class="hs-identifier hs-var hs-var">fname'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; (QualName VName -&gt; Doc) -&gt; Maybe (QualName VName) -&gt; Doc
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;expression&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; (QualName VName -&gt; Doc) -&gt; QualName VName -&gt; Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (QualName VName)
</span><a href="#local-6989586621684561194"><span class="hs-identifier hs-var">fname</span></a></span><span>
</span><span id="line-978"></span><span>
</span><span id="line-979"></span><span>  </span><span class="annot"><span class="annottext">SrcLoc
-&gt; Notes
-&gt; Doc
-&gt; TermTypeM
     (TypeBase (DimDecl VName) Aliasing,
      TypeBase (DimDecl VName) Aliasing, Maybe VName, [VName])
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561195"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc
 -&gt; TermTypeM
      (TypeBase (DimDecl VName) Aliasing,
       TypeBase (DimDecl VName) Aliasing, Maybe VName, [VName]))
-&gt; Doc
-&gt; TermTypeM
     (TypeBase (DimDecl VName) Aliasing,
      TypeBase (DimDecl VName) Aliasing, Maybe VName, [VName])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-980"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684561193"><span class="hs-identifier hs-var">prev_applied</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-981"></span><span>      </span><span class="hs-keyword">then</span><span>
</span><span id="line-982"></span><span>        </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Cannot apply&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621684561187"><span class="hs-identifier hs-var">fname'</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;as function, as it has type:&quot;</span></span><span>
</span><span id="line-983"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
</span><span class="hs-identifier hs-var">indent</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561192"><span class="hs-identifier hs-var">ftype</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-984"></span><span>      </span><span class="hs-keyword">else</span><span>
</span><span id="line-985"></span><span>        </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Cannot apply&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621684561187"><span class="hs-identifier hs-var">fname'</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;to argument #&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684561193"><span class="hs-identifier hs-var">prev_applied</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-986"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><a href="Futhark.Util.Pretty.html#shorten"><span class="hs-identifier hs-var">shorten</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Doc) -&gt; String -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; String) -&gt; Doc -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><span class="hs-identifier hs-var">flatten</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561191"><span class="hs-identifier hs-var">argexp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;,&quot;</span></span><span>
</span><span id="line-987"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;as&quot;</span></span><span>
</span><span id="line-988"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621684561187"><span class="hs-identifier hs-var">fname'</span></a></span><span>
</span><span id="line-989"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;only takes&quot;</span></span><span>
</span><span id="line-990"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684561193"><span class="hs-identifier hs-var">prev_applied</span></a></span><span>
</span><span id="line-991"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621684561183"><span class="hs-identifier hs-var">arguments</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-992"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-993"></span><span>    </span><span id="local-6989586621684561183"><span class="annot"><span class="annottext">arguments :: Doc
</span><a href="#local-6989586621684561183"><span class="hs-identifier hs-var hs-var">arguments</span></a></span></span><span>
</span><span id="line-994"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684561193"><span class="hs-identifier hs-var">prev_applied</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;argument&quot;</span></span><span>
</span><span id="line-995"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;arguments&quot;</span></span><span>
</span><span id="line-996"></span><span>
</span><span id="line-997"></span><span class="hs-comment">-- | @returnType ret_type arg_diet arg_type@ gives result of applying</span><span>
</span><span id="line-998"></span><span class="hs-comment">-- an argument the given types to a function with the given return</span><span>
</span><span id="line-999"></span><span class="hs-comment">-- type, consuming the argument with the given diet.</span><span>
</span><span id="line-1000"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#returnType"><span class="hs-identifier hs-type">returnType</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1001"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1002"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#Diet"><span class="hs-identifier hs-type">Diet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1003"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1004"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span>
</span><span id="line-1005"></span><span id="returnType"><span class="annot"><span class="annottext">returnType :: TypeBase (DimDecl VName) Aliasing
-&gt; Diet
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
</span><a href="Language.Futhark.TypeChecker.Terms.html#returnType"><span class="hs-identifier hs-var hs-var">returnType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Unique"><span class="hs-identifier hs-var">Unique</span></a></span><span> </span><span id="local-6989586621684561178"><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561178"><span class="hs-identifier hs-var">et</span></a></span></span><span> </span><span id="local-6989586621684561177"><span class="annot"><span class="annottext">ShapeDecl (DimDecl VName)
</span><a href="#local-6989586621684561177"><span class="hs-identifier hs-var">shape</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Diet
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1006"></span><span>  </span><span class="annot"><span class="annottext">Aliasing
-&gt; Uniqueness
-&gt; ScalarTypeBase (DimDecl VName) ()
-&gt; ShapeDecl (DimDecl VName)
-&gt; TypeBase (DimDecl VName) Aliasing
forall dim as.
as
-&gt; Uniqueness
-&gt; ScalarTypeBase dim ()
-&gt; ShapeDecl dim
-&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Array"><span class="hs-identifier hs-var">Array</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Unique"><span class="hs-identifier hs-var">Unique</span></a></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561178"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeDecl (DimDecl VName)
</span><a href="#local-6989586621684561177"><span class="hs-identifier hs-var">shape</span></a></span><span>
</span><span id="line-1007"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#returnType"><span class="hs-identifier hs-var">returnType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span id="local-6989586621684561176"><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561176"><span class="hs-identifier hs-var">als</span></a></span></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Nonunique"><span class="hs-identifier hs-var">Nonunique</span></a></span><span> </span><span id="local-6989586621684561175"><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561175"><span class="hs-identifier hs-var">et</span></a></span></span><span> </span><span id="local-6989586621684561174"><span class="annot"><span class="annottext">ShapeDecl (DimDecl VName)
</span><a href="#local-6989586621684561174"><span class="hs-identifier hs-var">shape</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684561173"><span class="annot"><span class="annottext">Diet
</span><a href="#local-6989586621684561173"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621684561172"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561172"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1008"></span><span>  </span><span class="annot"><span class="annottext">Aliasing
-&gt; Uniqueness
-&gt; ScalarTypeBase (DimDecl VName) ()
-&gt; ShapeDecl (DimDecl VName)
-&gt; TypeBase (DimDecl VName) Aliasing
forall dim as.
as
-&gt; Uniqueness
-&gt; ScalarTypeBase dim ()
-&gt; ShapeDecl dim
-&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Array"><span class="hs-identifier hs-var">Array</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561176"><span class="hs-identifier hs-var">als</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing -&gt; Aliasing -&gt; Aliasing
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561171"><span class="hs-identifier hs-var">arg_als</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Unique"><span class="hs-identifier hs-var">Unique</span></a></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561175"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeDecl (DimDecl VName)
</span><a href="#local-6989586621684561174"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="hs-comment">-- Intentional!</span><span>
</span><span id="line-1009"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1010"></span><span>    </span><span id="local-6989586621684561171"><span class="annot"><span class="annottext">arg_als :: Aliasing
</span><a href="#local-6989586621684561171"><span class="hs-identifier hs-var hs-var">arg_als</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Aliasing
forall as shape. Monoid as =&gt; TypeBase shape as -&gt; as
</span><a href="Language.Futhark.Prop.html#aliases"><span class="hs-identifier hs-var">aliases</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing -&gt; Aliasing)
-&gt; TypeBase (DimDecl VName) Aliasing -&gt; Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Diet -&gt; TypeBase (DimDecl VName) Aliasing
forall as shape.
Monoid as =&gt;
TypeBase shape as -&gt; Diet -&gt; TypeBase shape as
</span><a href="Language.Futhark.TypeChecker.Terms.html#maskAliases"><span class="hs-identifier hs-var">maskAliases</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561172"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Diet
</span><a href="#local-6989586621684561173"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1011"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#returnType"><span class="hs-identifier hs-var">returnType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span id="local-6989586621684561166"><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) Aliasing)
</span><a href="#local-6989586621684561166"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621684561165"><span class="annot"><span class="annottext">Diet
</span><a href="#local-6989586621684561165"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621684561164"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561164"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1012"></span><span>  </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) Aliasing
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) Aliasing)
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall dim as. Map Name (TypeBase dim as) -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-var">Record</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Name (TypeBase (DimDecl VName) Aliasing)
 -&gt; ScalarTypeBase (DimDecl VName) Aliasing)
-&gt; Map Name (TypeBase (DimDecl VName) Aliasing)
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; Map Name (TypeBase (DimDecl VName) Aliasing)
-&gt; Map Name (TypeBase (DimDecl VName) Aliasing)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621684561163"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561163"><span class="hs-identifier hs-var">et</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Diet
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
</span><a href="Language.Futhark.TypeChecker.Terms.html#returnType"><span class="hs-identifier hs-var">returnType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561163"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="annot"><span class="annottext">Diet
</span><a href="#local-6989586621684561165"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561164"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) Aliasing)
</span><a href="#local-6989586621684561166"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-1013"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#returnType"><span class="hs-identifier hs-var">returnType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span id="local-6989586621684561162"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684561162"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Diet
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1014"></span><span>  </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) Aliasing
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall dim as. PrimType -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684561162"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1015"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#returnType"><span class="hs-identifier hs-var">returnType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Unique"><span class="hs-identifier hs-var">Unique</span></a></span><span> </span><span id="local-6989586621684561161"><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621684561161"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621684561160"><span class="annot"><span class="annottext">[TypeArg (DimDecl VName)]
</span><a href="#local-6989586621684561160"><span class="hs-identifier hs-var">targs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Diet
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1016"></span><span>  </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) Aliasing
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Aliasing
-&gt; Uniqueness
-&gt; TypeName
-&gt; [TypeArg (DimDecl VName)]
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall dim as.
as
-&gt; Uniqueness -&gt; TypeName -&gt; [TypeArg dim] -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Unique"><span class="hs-identifier hs-var">Unique</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621684561161"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeArg (DimDecl VName)]
</span><a href="#local-6989586621684561160"><span class="hs-identifier hs-var">targs</span></a></span><span>
</span><span id="line-1017"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#returnType"><span class="hs-identifier hs-var">returnType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span id="local-6989586621684561159"><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561159"><span class="hs-identifier hs-var">als</span></a></span></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Nonunique"><span class="hs-identifier hs-var">Nonunique</span></a></span><span> </span><span id="local-6989586621684561158"><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621684561158"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621684561157"><span class="annot"><span class="annottext">[TypeArg (DimDecl VName)]
</span><a href="#local-6989586621684561157"><span class="hs-identifier hs-var">targs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621684561156"><span class="annot"><span class="annottext">Diet
</span><a href="#local-6989586621684561156"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621684561155"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561155"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1018"></span><span>  </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) Aliasing
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Aliasing
-&gt; Uniqueness
-&gt; TypeName
-&gt; [TypeArg (DimDecl VName)]
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall dim as.
as
-&gt; Uniqueness -&gt; TypeName -&gt; [TypeArg dim] -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561159"><span class="hs-identifier hs-var">als</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing -&gt; Aliasing -&gt; Aliasing
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561154"><span class="hs-identifier hs-var">arg_als</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Unique"><span class="hs-identifier hs-var">Unique</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621684561158"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeArg (DimDecl VName)]
</span><a href="#local-6989586621684561157"><span class="hs-identifier hs-var">targs</span></a></span><span> </span><span class="hs-comment">-- Intentional!</span><span>
</span><span id="line-1019"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1020"></span><span>    </span><span id="local-6989586621684561154"><span class="annot"><span class="annottext">arg_als :: Aliasing
</span><a href="#local-6989586621684561154"><span class="hs-identifier hs-var hs-var">arg_als</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Aliasing
forall as shape. Monoid as =&gt; TypeBase shape as -&gt; as
</span><a href="Language.Futhark.Prop.html#aliases"><span class="hs-identifier hs-var">aliases</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing -&gt; Aliasing)
-&gt; TypeBase (DimDecl VName) Aliasing -&gt; Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Diet -&gt; TypeBase (DimDecl VName) Aliasing
forall as shape.
Monoid as =&gt;
TypeBase shape as -&gt; Diet -&gt; TypeBase shape as
</span><a href="Language.Futhark.TypeChecker.Terms.html#maskAliases"><span class="hs-identifier hs-var">maskAliases</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561155"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Diet
</span><a href="#local-6989586621684561156"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1021"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#returnType"><span class="hs-identifier hs-var">returnType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-type">Arrow</span></a></span><span> </span><span id="local-6989586621684561150"><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561150"><span class="hs-identifier hs-var">old_als</span></a></span></span><span> </span><span id="local-6989586621684561149"><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684561149"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621684561148"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561148"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-type">RetType</span></a></span><span> </span><span id="local-6989586621684561147"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561147"><span class="hs-identifier hs-var">dims</span></a></span></span><span> </span><span id="local-6989586621684561146"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561146"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621684561145"><span class="annot"><span class="annottext">Diet
</span><a href="#local-6989586621684561145"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621684561144"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561144"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1022"></span><span>  </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) Aliasing
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Aliasing
-&gt; PName
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; RetTypeBase (DimDecl VName) Aliasing
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall dim as.
as
-&gt; PName
-&gt; TypeBase dim as
-&gt; RetTypeBase dim as
-&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-var">Arrow</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561143"><span class="hs-identifier hs-var">als</span></a></span><span> </span><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684561149"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561148"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Aliasing -&gt; TypeBase (DimDecl VName) Aliasing
forall dim asf ast. TypeBase dim asf -&gt; ast -&gt; TypeBase dim ast
</span><a href="Language.Futhark.Prop.html#setAliases"><span class="hs-operator hs-var">`setAliases`</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(RetTypeBase (DimDecl VName) Aliasing
 -&gt; ScalarTypeBase (DimDecl VName) Aliasing)
-&gt; RetTypeBase (DimDecl VName) Aliasing
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName]
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; RetTypeBase (DimDecl VName) Aliasing
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684561147"><span class="hs-identifier hs-var">dims</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; RetTypeBase (DimDecl VName) Aliasing)
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; RetTypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561146"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Aliasing -&gt; TypeBase (DimDecl VName) Aliasing
forall dim asf ast. TypeBase dim asf -&gt; ast -&gt; TypeBase dim ast
</span><a href="Language.Futhark.Prop.html#setAliases"><span class="hs-operator hs-var">`setAliases`</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561143"><span class="hs-identifier hs-var">als</span></a></span><span>
</span><span id="line-1023"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1024"></span><span>    </span><span class="hs-comment">-- Make sure to propagate the aliases of an existing closure.</span><span>
</span><span id="line-1025"></span><span>    </span><span id="local-6989586621684561143"><span class="annot"><span class="annottext">als :: Aliasing
</span><a href="#local-6989586621684561143"><span class="hs-identifier hs-var hs-var">als</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684561150"><span class="hs-identifier hs-var">old_als</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing -&gt; Aliasing -&gt; Aliasing
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Aliasing
forall as shape. Monoid as =&gt; TypeBase shape as -&gt; as
</span><a href="Language.Futhark.Prop.html#aliases"><span class="hs-identifier hs-var">aliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Diet -&gt; TypeBase (DimDecl VName) Aliasing
forall as shape.
Monoid as =&gt;
TypeBase shape as -&gt; Diet -&gt; TypeBase shape as
</span><a href="Language.Futhark.TypeChecker.Terms.html#maskAliases"><span class="hs-identifier hs-var">maskAliases</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561144"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Diet
</span><a href="#local-6989586621684561145"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1026"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#returnType"><span class="hs-identifier hs-var">returnType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Sum"><span class="hs-identifier hs-type">Sum</span></a></span><span> </span><span id="local-6989586621684561138"><span class="annot"><span class="annottext">Map Name [TypeBase (DimDecl VName) Aliasing]
</span><a href="#local-6989586621684561138"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621684561137"><span class="annot"><span class="annottext">Diet
</span><a href="#local-6989586621684561137"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621684561136"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561136"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1027"></span><span>  </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) Aliasing
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Name [TypeBase (DimDecl VName) Aliasing]
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall dim as. Map Name [TypeBase dim as] -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Sum"><span class="hs-identifier hs-var">Sum</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Name [TypeBase (DimDecl VName) Aliasing]
 -&gt; ScalarTypeBase (DimDecl VName) Aliasing)
-&gt; Map Name [TypeBase (DimDecl VName) Aliasing]
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([TypeBase (DimDecl VName) Aliasing]
 -&gt; [TypeBase (DimDecl VName) Aliasing])
-&gt; Map Name [TypeBase (DimDecl VName) Aliasing]
-&gt; Map Name [TypeBase (DimDecl VName) Aliasing]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(([TypeBase (DimDecl VName) Aliasing]
  -&gt; [TypeBase (DimDecl VName) Aliasing])
 -&gt; Map Name [TypeBase (DimDecl VName) Aliasing]
 -&gt; Map Name [TypeBase (DimDecl VName) Aliasing])
-&gt; ((TypeBase (DimDecl VName) Aliasing
     -&gt; TypeBase (DimDecl VName) Aliasing)
    -&gt; [TypeBase (DimDecl VName) Aliasing]
    -&gt; [TypeBase (DimDecl VName) Aliasing])
-&gt; (TypeBase (DimDecl VName) Aliasing
    -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; Map Name [TypeBase (DimDecl VName) Aliasing]
-&gt; Map Name [TypeBase (DimDecl VName) Aliasing]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; [TypeBase (DimDecl VName) Aliasing]
-&gt; [TypeBase (DimDecl VName) Aliasing]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621684561135"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561135"><span class="hs-identifier hs-var">et</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Diet
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
</span><a href="Language.Futhark.TypeChecker.Terms.html#returnType"><span class="hs-identifier hs-var">returnType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561135"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="annot"><span class="annottext">Diet
</span><a href="#local-6989586621684561137"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561136"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Name [TypeBase (DimDecl VName) Aliasing]
</span><a href="#local-6989586621684561138"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-1028"></span><span>
</span><span id="line-1029"></span><span class="hs-comment">-- | @t `maskAliases` d@ removes aliases (sets them to 'mempty') from</span><span>
</span><span id="line-1030"></span><span class="hs-comment">-- the parts of @t@ that are denoted as consumed by the 'Diet' @d@.</span><span>
</span><span id="line-1031"></span><span id="local-6989586621684563672"><span id="local-6989586621684563673"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#maskAliases"><span class="hs-identifier hs-type">maskAliases</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1032"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621684563673"><span class="hs-keyword hs-type">as</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1033"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684563672"><span class="hs-identifier hs-type">shape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684563673"><span class="hs-keyword hs-type">as</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1034"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#Diet"><span class="hs-identifier hs-type">Diet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1035"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684563672"><span class="hs-identifier hs-type">shape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684563673"><span class="hs-keyword hs-type">as</span></a></span></span></span><span>
</span><span id="line-1036"></span><span id="maskAliases"><span class="annot"><span class="annottext">maskAliases :: forall as shape.
Monoid as =&gt;
TypeBase shape as -&gt; Diet -&gt; TypeBase shape as
</span><a href="Language.Futhark.TypeChecker.Terms.html#maskAliases"><span class="hs-identifier hs-var hs-var">maskAliases</span></a></span></span><span> </span><span id="local-6989586621684561126"><span class="annot"><span class="annottext">TypeBase shape as
</span><a href="#local-6989586621684561126"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">Diet
</span><a href="Language.Futhark.Syntax.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase shape as
</span><a href="#local-6989586621684561126"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase shape as -&gt; as -&gt; TypeBase shape as
forall dim asf ast. TypeBase dim asf -&gt; ast -&gt; TypeBase dim ast
</span><a href="Language.Futhark.Prop.html#setAliases"><span class="hs-operator hs-var">`setAliases`</span></a></span><span> </span><span class="annot"><span class="annottext">as
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1037"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#maskAliases"><span class="hs-identifier hs-var">maskAliases</span></a></span><span> </span><span id="local-6989586621684561124"><span class="annot"><span class="annottext">TypeBase shape as
</span><a href="#local-6989586621684561124"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">Diet
</span><a href="Language.Futhark.Syntax.html#Observe"><span class="hs-identifier hs-var">Observe</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase shape as
</span><a href="#local-6989586621684561124"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1038"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#maskAliases"><span class="hs-identifier hs-var">maskAliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span id="local-6989586621684561122"><span class="annot"><span class="annottext">Map Name (TypeBase shape as)
</span><a href="#local-6989586621684561122"><span class="hs-identifier hs-var">ets</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RecordDiet"><span class="hs-identifier hs-type">RecordDiet</span></a></span><span> </span><span id="local-6989586621684561120"><span class="annot"><span class="annottext">Map Name Diet
</span><a href="#local-6989586621684561120"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1039"></span><span>  </span><span class="annot"><span class="annottext">ScalarTypeBase shape as -&gt; TypeBase shape as
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase shape as -&gt; TypeBase shape as)
-&gt; ScalarTypeBase shape as -&gt; TypeBase shape as
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase shape as) -&gt; ScalarTypeBase shape as
forall dim as. Map Name (TypeBase dim as) -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-var">Record</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Name (TypeBase shape as) -&gt; ScalarTypeBase shape as)
-&gt; Map Name (TypeBase shape as) -&gt; ScalarTypeBase shape as
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TypeBase shape as -&gt; Diet -&gt; TypeBase shape as)
-&gt; Map Name (TypeBase shape as)
-&gt; Map Name Diet
-&gt; Map Name (TypeBase shape as)
forall k a b c.
Ord k =&gt;
(a -&gt; b -&gt; c) -&gt; Map k a -&gt; Map k b -&gt; Map k c
</span><span class="hs-identifier hs-var">M.intersectionWith</span></span><span> </span><span class="annot"><span class="annottext">TypeBase shape as -&gt; Diet -&gt; TypeBase shape as
forall as shape.
Monoid as =&gt;
TypeBase shape as -&gt; Diet -&gt; TypeBase shape as
</span><a href="Language.Futhark.TypeChecker.Terms.html#maskAliases"><span class="hs-identifier hs-var">maskAliases</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase shape as)
</span><a href="#local-6989586621684561122"><span class="hs-identifier hs-var">ets</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Diet
</span><a href="#local-6989586621684561120"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-1040"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#maskAliases"><span class="hs-identifier hs-var">maskAliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Sum"><span class="hs-identifier hs-type">Sum</span></a></span><span> </span><span id="local-6989586621684561118"><span class="annot"><span class="annottext">Map Name [TypeBase shape as]
</span><a href="#local-6989586621684561118"><span class="hs-identifier hs-var">ets</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#SumDiet"><span class="hs-identifier hs-type">SumDiet</span></a></span><span> </span><span id="local-6989586621684561116"><span class="annot"><span class="annottext">Map Name [Diet]
</span><a href="#local-6989586621684561116"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1041"></span><span>  </span><span class="annot"><span class="annottext">ScalarTypeBase shape as -&gt; TypeBase shape as
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase shape as -&gt; TypeBase shape as)
-&gt; ScalarTypeBase shape as -&gt; TypeBase shape as
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Name [TypeBase shape as] -&gt; ScalarTypeBase shape as
forall dim as. Map Name [TypeBase dim as] -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Sum"><span class="hs-identifier hs-var">Sum</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Name [TypeBase shape as] -&gt; ScalarTypeBase shape as)
-&gt; Map Name [TypeBase shape as] -&gt; ScalarTypeBase shape as
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([TypeBase shape as] -&gt; [Diet] -&gt; [TypeBase shape as])
-&gt; Map Name [TypeBase shape as]
-&gt; Map Name [Diet]
-&gt; Map Name [TypeBase shape as]
forall k a b c.
Ord k =&gt;
(a -&gt; b -&gt; c) -&gt; Map k a -&gt; Map k b -&gt; Map k c
</span><span class="hs-identifier hs-var">M.intersectionWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeBase shape as -&gt; Diet -&gt; TypeBase shape as)
-&gt; [TypeBase shape as] -&gt; [Diet] -&gt; [TypeBase shape as]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">TypeBase shape as -&gt; Diet -&gt; TypeBase shape as
forall as shape.
Monoid as =&gt;
TypeBase shape as -&gt; Diet -&gt; TypeBase shape as
</span><a href="Language.Futhark.TypeChecker.Terms.html#maskAliases"><span class="hs-identifier hs-var">maskAliases</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Name [TypeBase shape as]
</span><a href="#local-6989586621684561118"><span class="hs-identifier hs-var">ets</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name [Diet]
</span><a href="#local-6989586621684561116"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-1042"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#maskAliases"><span class="hs-identifier hs-var">maskAliases</span></a></span><span> </span><span id="local-6989586621684561114"><span class="annot"><span class="annottext">TypeBase shape as
</span><a href="#local-6989586621684561114"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#FuncDiet"><span class="hs-identifier hs-type">FuncDiet</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase shape as
</span><a href="#local-6989586621684561114"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1043"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#maskAliases"><span class="hs-identifier hs-var">maskAliases</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase shape as
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Diet
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TypeBase shape as
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Invalid arguments passed to maskAliases.&quot;</span></span><span>
</span><span id="line-1044"></span><span>
</span><span id="line-1045"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#consumeArg"><span class="hs-identifier hs-type">consumeArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Diet"><span class="hs-identifier hs-type">Diet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Occurrence"><span class="hs-identifier hs-type">Occurrence</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1046"></span><span id="consumeArg"><span class="annot"><span class="annottext">consumeArg :: SrcLoc
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Diet
-&gt; TermTypeM Occurrences
</span><a href="Language.Futhark.TypeChecker.Terms.html#consumeArg"><span class="hs-identifier hs-var hs-var">consumeArg</span></a></span></span><span> </span><span id="local-6989586621684561111"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561111"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span id="local-6989586621684561110"><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) Aliasing)
</span><a href="#local-6989586621684561110"><span class="hs-identifier hs-var">ets</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RecordDiet"><span class="hs-identifier hs-type">RecordDiet</span></a></span><span> </span><span id="local-6989586621684561109"><span class="annot"><span class="annottext">Map Name Diet
</span><a href="#local-6989586621684561109"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1047"></span><span>  </span><span class="annot"><span class="annottext">[Occurrences] -&gt; Occurrences
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([Occurrences] -&gt; Occurrences)
-&gt; (Map Name Occurrences -&gt; [Occurrences])
-&gt; Map Name Occurrences
-&gt; Occurrences
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map Name Occurrences -&gt; [Occurrences]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">(Map Name Occurrences -&gt; Occurrences)
-&gt; TermTypeM (Map Name Occurrences) -&gt; TermTypeM Occurrences
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">((TypeBase (DimDecl VName) Aliasing, Diet)
 -&gt; TermTypeM Occurrences)
-&gt; Map Name (TypeBase (DimDecl VName) Aliasing, Diet)
-&gt; TermTypeM (Map Name Occurrences)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; Diet -&gt; TermTypeM Occurrences)
-&gt; (TypeBase (DimDecl VName) Aliasing, Diet)
-&gt; TermTypeM Occurrences
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">((TypeBase (DimDecl VName) Aliasing
  -&gt; Diet -&gt; TermTypeM Occurrences)
 -&gt; (TypeBase (DimDecl VName) Aliasing, Diet)
 -&gt; TermTypeM Occurrences)
-&gt; (TypeBase (DimDecl VName) Aliasing
    -&gt; Diet -&gt; TermTypeM Occurrences)
-&gt; (TypeBase (DimDecl VName) Aliasing, Diet)
-&gt; TermTypeM Occurrences
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Diet
-&gt; TermTypeM Occurrences
</span><a href="Language.Futhark.TypeChecker.Terms.html#consumeArg"><span class="hs-identifier hs-var">consumeArg</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561111"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; Diet -&gt; (TypeBase (DimDecl VName) Aliasing, Diet))
-&gt; Map Name (TypeBase (DimDecl VName) Aliasing)
-&gt; Map Name Diet
-&gt; Map Name (TypeBase (DimDecl VName) Aliasing, Diet)
forall k a b c.
Ord k =&gt;
(a -&gt; b -&gt; c) -&gt; Map k a -&gt; Map k b -&gt; Map k c
</span><span class="hs-identifier hs-var">M.intersectionWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) Aliasing)
</span><a href="#local-6989586621684561110"><span class="hs-identifier hs-var">ets</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Diet
</span><a href="#local-6989586621684561109"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1048"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#consumeArg"><span class="hs-identifier hs-var">consumeArg</span></a></span><span> </span><span id="local-6989586621684561106"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561106"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Sum"><span class="hs-identifier hs-type">Sum</span></a></span><span> </span><span id="local-6989586621684561105"><span class="annot"><span class="annottext">Map Name [TypeBase (DimDecl VName) Aliasing]
</span><a href="#local-6989586621684561105"><span class="hs-identifier hs-var">ets</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#SumDiet"><span class="hs-identifier hs-type">SumDiet</span></a></span><span> </span><span id="local-6989586621684561104"><span class="annot"><span class="annottext">Map Name [Diet]
</span><a href="#local-6989586621684561104"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1049"></span><span>  </span><span class="annot"><span class="annottext">[Occurrences] -&gt; Occurrences
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([Occurrences] -&gt; Occurrences)
-&gt; TermTypeM [Occurrences] -&gt; TermTypeM Occurrences
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">((TypeBase (DimDecl VName) Aliasing, Diet)
 -&gt; TermTypeM Occurrences)
-&gt; [(TypeBase (DimDecl VName) Aliasing, Diet)]
-&gt; TermTypeM [Occurrences]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; Diet -&gt; TermTypeM Occurrences)
-&gt; (TypeBase (DimDecl VName) Aliasing, Diet)
-&gt; TermTypeM Occurrences
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">((TypeBase (DimDecl VName) Aliasing
  -&gt; Diet -&gt; TermTypeM Occurrences)
 -&gt; (TypeBase (DimDecl VName) Aliasing, Diet)
 -&gt; TermTypeM Occurrences)
-&gt; (TypeBase (DimDecl VName) Aliasing
    -&gt; Diet -&gt; TermTypeM Occurrences)
-&gt; (TypeBase (DimDecl VName) Aliasing, Diet)
-&gt; TermTypeM Occurrences
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Diet
-&gt; TermTypeM Occurrences
</span><a href="Language.Futhark.TypeChecker.Terms.html#consumeArg"><span class="hs-identifier hs-var">consumeArg</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561106"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[(TypeBase (DimDecl VName) Aliasing, Diet)]]
-&gt; [(TypeBase (DimDecl VName) Aliasing, Diet)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[(TypeBase (DimDecl VName) Aliasing, Diet)]]
 -&gt; [(TypeBase (DimDecl VName) Aliasing, Diet)])
-&gt; [[(TypeBase (DimDecl VName) Aliasing, Diet)]]
-&gt; [(TypeBase (DimDecl VName) Aliasing, Diet)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Name [(TypeBase (DimDecl VName) Aliasing, Diet)]
-&gt; [[(TypeBase (DimDecl VName) Aliasing, Diet)]]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">(Map Name [(TypeBase (DimDecl VName) Aliasing, Diet)]
 -&gt; [[(TypeBase (DimDecl VName) Aliasing, Diet)]])
-&gt; Map Name [(TypeBase (DimDecl VName) Aliasing, Diet)]
-&gt; [[(TypeBase (DimDecl VName) Aliasing, Diet)]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([TypeBase (DimDecl VName) Aliasing]
 -&gt; [Diet] -&gt; [(TypeBase (DimDecl VName) Aliasing, Diet)])
-&gt; Map Name [TypeBase (DimDecl VName) Aliasing]
-&gt; Map Name [Diet]
-&gt; Map Name [(TypeBase (DimDecl VName) Aliasing, Diet)]
forall k a b c.
Ord k =&gt;
(a -&gt; b -&gt; c) -&gt; Map k a -&gt; Map k b -&gt; Map k c
</span><span class="hs-identifier hs-var">M.intersectionWith</span></span><span> </span><span class="annot"><span class="annottext">[TypeBase (DimDecl VName) Aliasing]
-&gt; [Diet] -&gt; [(TypeBase (DimDecl VName) Aliasing, Diet)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">Map Name [TypeBase (DimDecl VName) Aliasing]
</span><a href="#local-6989586621684561105"><span class="hs-identifier hs-var">ets</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name [Diet]
</span><a href="#local-6989586621684561104"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1050"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#consumeArg"><span class="hs-identifier hs-var">consumeArg</span></a></span><span> </span><span id="local-6989586621684561103"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561103"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Nonunique"><span class="hs-identifier hs-var">Nonunique</span></a></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ShapeDecl (DimDecl VName)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Diet
</span><a href="Language.Futhark.Syntax.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1051"></span><span>  </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TermTypeM Occurrences
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561103"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM Occurrences)
-&gt; (Doc -&gt; Doc) -&gt; Doc -&gt; TermTypeM Occurrences
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Language.Futhark.TypeChecker.Monad.html#withIndexLink"><span class="hs-identifier hs-var">withIndexLink</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;consuming-parameter&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM Occurrences) -&gt; Doc -&gt; TermTypeM Occurrences
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1052"></span><span>    </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Consuming parameter passed non-unique argument.&quot;</span></span><span>
</span><span id="line-1053"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#consumeArg"><span class="hs-identifier hs-var">consumeArg</span></a></span><span> </span><span id="local-6989586621684561102"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561102"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Nonunique"><span class="hs-identifier hs-var">Nonunique</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TypeArg (DimDecl VName)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Diet
</span><a href="Language.Futhark.Syntax.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1054"></span><span>  </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TermTypeM Occurrences
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561102"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM Occurrences)
-&gt; (Doc -&gt; Doc) -&gt; Doc -&gt; TermTypeM Occurrences
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Language.Futhark.TypeChecker.Monad.html#withIndexLink"><span class="hs-identifier hs-var">withIndexLink</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;consuming-parameter&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM Occurrences) -&gt; Doc -&gt; TermTypeM Occurrences
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1055"></span><span>    </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Consuming parameter passed non-unique argument.&quot;</span></span><span>
</span><span id="line-1056"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#consumeArg"><span class="hs-identifier hs-var">consumeArg</span></a></span><span> </span><span id="local-6989586621684561101"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561101"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-type">Arrow</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561100"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561100"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="annot"><span class="annottext">RetTypeBase (DimDecl VName) Aliasing
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#FuncDiet"><span class="hs-identifier hs-type">FuncDiet</span></a></span><span> </span><span id="local-6989586621684561099"><span class="annot"><span class="annottext">Diet
</span><a href="#local-6989586621684561099"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="annot"><span class="annottext">Diet
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1057"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Diet -&gt; Bool
forall {dim} {as}. TypeBase dim as -&gt; Diet -&gt; Bool
</span><a href="#local-6989586621684561098"><span class="hs-identifier hs-var">contravariantArg</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561100"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Diet
</span><a href="#local-6989586621684561099"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1058"></span><span>    </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TermTypeM Occurrences
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561101"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM Occurrences)
-&gt; (Doc -&gt; Doc) -&gt; Doc -&gt; TermTypeM Occurrences
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Language.Futhark.TypeChecker.Monad.html#withIndexLink"><span class="hs-identifier hs-var">withIndexLink</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;consuming-argument&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM Occurrences) -&gt; Doc -&gt; TermTypeM Occurrences
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1059"></span><span>      </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Non-consuming higher-order parameter passed consuming argument.&quot;</span></span><span>
</span><span id="line-1060"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1061"></span><span>    </span><span id="local-6989586621684561098"><span class="annot"><span class="annottext">contravariantArg :: TypeBase dim as -&gt; Diet -&gt; Bool
</span><a href="#local-6989586621684561098"><span class="hs-identifier hs-var hs-var">contravariantArg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><span class="annottext">as
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Unique"><span class="hs-identifier hs-var">Unique</span></a></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase dim ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ShapeDecl dim
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Diet
</span><a href="Language.Futhark.Syntax.html#Observe"><span class="hs-identifier hs-var">Observe</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1062"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1063"></span><span>    </span><span class="annot"><a href="#local-6989586621684561098"><span class="hs-identifier hs-var">contravariantArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">as
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Unique"><span class="hs-identifier hs-var">Unique</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TypeArg dim]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Diet
</span><a href="Language.Futhark.Syntax.html#Observe"><span class="hs-identifier hs-var">Observe</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1064"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1065"></span><span>    </span><span class="annot"><a href="#local-6989586621684561098"><span class="hs-identifier hs-var">contravariantArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span id="local-6989586621684561095"><span class="annot"><span class="annottext">Map Name (TypeBase dim as)
</span><a href="#local-6989586621684561095"><span class="hs-identifier hs-var">ets</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RecordDiet"><span class="hs-identifier hs-type">RecordDiet</span></a></span><span> </span><span id="local-6989586621684561094"><span class="annot"><span class="annottext">Map Name Diet
</span><a href="#local-6989586621684561094"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1066"></span><span>      </span><span class="annot"><span class="annottext">Map Name Bool -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">and</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeBase dim as -&gt; Diet -&gt; Bool)
-&gt; Map Name (TypeBase dim as) -&gt; Map Name Diet -&gt; Map Name Bool
forall k a b c.
Ord k =&gt;
(a -&gt; b -&gt; c) -&gt; Map k a -&gt; Map k b -&gt; Map k c
</span><span class="hs-identifier hs-var">M.intersectionWith</span></span><span> </span><span class="annot"><span class="annottext">TypeBase dim as -&gt; Diet -&gt; Bool
</span><a href="#local-6989586621684561098"><span class="hs-identifier hs-var">contravariantArg</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase dim as)
</span><a href="#local-6989586621684561095"><span class="hs-identifier hs-var">ets</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Diet
</span><a href="#local-6989586621684561094"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1067"></span><span>    </span><span class="annot"><a href="#local-6989586621684561098"><span class="hs-identifier hs-var">contravariantArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-type">Arrow</span></a></span><span> </span><span class="annot"><span class="annottext">as
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561092"><span class="annot"><span class="annottext">TypeBase dim as
</span><a href="#local-6989586621684561092"><span class="hs-identifier hs-var">tp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-type">RetType</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561091"><span class="annot"><span class="annottext">TypeBase dim as
</span><a href="#local-6989586621684561091"><span class="hs-identifier hs-var">tr</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#FuncDiet"><span class="hs-identifier hs-type">FuncDiet</span></a></span><span> </span><span id="local-6989586621684561090"><span class="annot"><span class="annottext">Diet
</span><a href="#local-6989586621684561090"><span class="hs-identifier hs-var">dp</span></a></span></span><span> </span><span id="local-6989586621684561089"><span class="annot"><span class="annottext">Diet
</span><a href="#local-6989586621684561089"><span class="hs-identifier hs-var">dr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1068"></span><span>      </span><span class="annot"><span class="annottext">TypeBase dim as -&gt; Diet -&gt; Bool
</span><a href="#local-6989586621684561098"><span class="hs-identifier hs-var">contravariantArg</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase dim as
</span><a href="#local-6989586621684561092"><span class="hs-identifier hs-var">tp</span></a></span><span> </span><span class="annot"><span class="annottext">Diet
</span><a href="#local-6989586621684561090"><span class="hs-identifier hs-var">dp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase dim as -&gt; Diet -&gt; Bool
</span><a href="#local-6989586621684561098"><span class="hs-identifier hs-var">contravariantArg</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase dim as
</span><a href="#local-6989586621684561091"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">Diet
</span><a href="#local-6989586621684561089"><span class="hs-identifier hs-var">dr</span></a></span><span>
</span><span id="line-1069"></span><span>    </span><span class="annot"><a href="#local-6989586621684561098"><span class="hs-identifier hs-var">contravariantArg</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase dim as
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Diet
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1070"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1071"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#consumeArg"><span class="hs-identifier hs-var">consumeArg</span></a></span><span> </span><span id="local-6989586621684561088"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561088"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621684561087"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561087"><span class="hs-identifier hs-var">at</span></a></span></span><span> </span><span class="annot"><span class="annottext">Diet
</span><a href="Language.Futhark.Syntax.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Occurrences -&gt; TermTypeM Occurrences
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Aliasing -&gt; SrcLoc -&gt; Occurrence
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#consumption"><span class="hs-identifier hs-var">consumption</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Aliasing
forall as shape. Monoid as =&gt; TypeBase shape as -&gt; as
</span><a href="Language.Futhark.Prop.html#aliases"><span class="hs-identifier hs-var">aliases</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561087"><span class="hs-identifier hs-var">at</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561088"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1072"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#consumeArg"><span class="hs-identifier hs-var">consumeArg</span></a></span><span> </span><span id="local-6989586621684561085"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561085"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621684561084"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561084"><span class="hs-identifier hs-var">at</span></a></span></span><span> </span><span class="annot"><span class="annottext">Diet
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Occurrences -&gt; TermTypeM Occurrences
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Aliasing -&gt; SrcLoc -&gt; Occurrence
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#observation"><span class="hs-identifier hs-var">observation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Aliasing
forall as shape. Monoid as =&gt; TypeBase shape as -&gt; as
</span><a href="Language.Futhark.Prop.html#aliases"><span class="hs-identifier hs-var">aliases</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561084"><span class="hs-identifier hs-var">at</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561085"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1073"></span><span>
</span><span id="line-1074"></span><span class="hs-comment">-- | Type-check a single expression in isolation.  This expression may</span><span>
</span><span id="line-1075"></span><span class="hs-comment">-- turn out to be polymorphic, in which case the list of type</span><span>
</span><span id="line-1076"></span><span class="hs-comment">-- parameters will be non-empty.</span><span>
</span><span id="line-1077"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkOneExp"><span class="hs-identifier hs-type">checkOneExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedExp"><span class="hs-identifier hs-type">UncheckedExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#TypeParam"><span class="hs-identifier hs-type">TypeParam</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1078"></span><span id="checkOneExp"><span class="annot"><span class="annottext">checkOneExp :: ExpBase NoInfo Name -&gt; TypeM ([TypeParamBase VName], Exp)
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkOneExp"><span class="hs-identifier hs-var hs-var">checkOneExp</span></a></span></span><span> </span><span id="local-6989586621684561082"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561082"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((([TypeParamBase VName], Exp), Occurrences)
 -&gt; ([TypeParamBase VName], Exp))
-&gt; TypeM (([TypeParamBase VName], Exp), Occurrences)
-&gt; TypeM ([TypeParamBase VName], Exp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(([TypeParamBase VName], Exp), Occurrences)
-&gt; ([TypeParamBase VName], Exp)
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(TypeM (([TypeParamBase VName], Exp), Occurrences)
 -&gt; TypeM ([TypeParamBase VName], Exp))
-&gt; (TermTypeM ([TypeParamBase VName], Exp)
    -&gt; TypeM (([TypeParamBase VName], Exp), Occurrences))
-&gt; TermTypeM ([TypeParamBase VName], Exp)
-&gt; TypeM ([TypeParamBase VName], Exp)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TermTypeM ([TypeParamBase VName], Exp)
-&gt; TypeM (([TypeParamBase VName], Exp), Occurrences)
forall a. TermTypeM a -&gt; TypeM (a, Occurrences)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#runTermTypeM"><span class="hs-identifier hs-var">runTermTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">(TermTypeM ([TypeParamBase VName], Exp)
 -&gt; TypeM ([TypeParamBase VName], Exp))
-&gt; TermTypeM ([TypeParamBase VName], Exp)
-&gt; TypeM ([TypeParamBase VName], Exp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1079"></span><span>  </span><span id="local-6989586621684561080"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561080"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561082"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1080"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561079"><span class="annot"><span class="annottext">t :: TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561079"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ())
-&gt; TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TypeBase (DimDecl VName) Aliasing
</span><a href="Language.Futhark.Prop.html#typeOf"><span class="hs-identifier hs-var">typeOf</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561080"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-1081"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684561077"><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684561077"><span class="hs-identifier hs-var">tparams</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StructRetType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1082"></span><span>    </span><span class="annot"><span class="annottext">Name
-&gt; SrcLoc
-&gt; [TypeParamBase VName]
-&gt; [PatBase Info VName]
-&gt; TypeBase (DimDecl VName) ()
-&gt; TermTypeM
     ([TypeParamBase VName], [PatBase Info VName], StructRetType)
</span><a href="Language.Futhark.TypeChecker.Terms.html#letGeneralise"><span class="hs-identifier hs-var">letGeneralise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><a href="Language.Futhark.Core.html#nameFromString"><span class="hs-identifier hs-var">nameFromString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;exp&gt;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684561082"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561079"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1083"></span><span>  </span><span class="annot"><span class="annottext">Set VName -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#fixOverloadedTypes"><span class="hs-identifier hs-var">fixOverloadedTypes</span></a></span><span> </span><span class="annot"><span class="annottext">(Set VName -&gt; TermTypeM ()) -&gt; Set VName -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; Set VName
forall as dim. Monoid as =&gt; TypeBase dim as -&gt; Set VName
</span><a href="Language.Futhark.Prop.html#typeVars"><span class="hs-identifier hs-var">typeVars</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684561079"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1084"></span><span>  </span><span id="local-6989586621684561073"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561073"><span class="hs-identifier hs-var">e''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall e. ASTMappable e =&gt; e -&gt; TermTypeM e
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#updateTypes"><span class="hs-identifier hs-var">updateTypes</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561080"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-1085"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkUnmatched"><span class="hs-identifier hs-var">checkUnmatched</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561073"><span class="hs-identifier hs-var">e''</span></a></span><span>
</span><span id="line-1086"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#causalityCheck"><span class="hs-identifier hs-var">causalityCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561073"><span class="hs-identifier hs-var">e''</span></a></span><span>
</span><span id="line-1087"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#literalOverflowCheck"><span class="hs-identifier hs-var">literalOverflowCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561073"><span class="hs-identifier hs-var">e''</span></a></span><span>
</span><span id="line-1088"></span><span>  </span><span class="annot"><span class="annottext">([TypeParamBase VName], Exp)
-&gt; TermTypeM ([TypeParamBase VName], Exp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684561077"><span class="hs-identifier hs-var">tparams</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561073"><span class="hs-identifier hs-var">e''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1089"></span><span>
</span><span id="line-1090"></span><span class="hs-comment">-- Verify that all sum type constructors and empty array literals have</span><span>
</span><span id="line-1091"></span><span class="hs-comment">-- a size that is known (rigid or a type parameter).  This is to</span><span>
</span><span id="line-1092"></span><span class="hs-comment">-- ensure that we can actually determine their shape at run-time.</span><span>
</span><span id="line-1093"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#causalityCheck"><span class="hs-identifier hs-type">causalityCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1094"></span><span id="causalityCheck"><span class="annot"><span class="annottext">causalityCheck :: Exp -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#causalityCheck"><span class="hs-identifier hs-var hs-var">causalityCheck</span></a></span></span><span> </span><span id="local-6989586621684561070"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561070"><span class="hs-identifier hs-var">binding_body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1095"></span><span>  </span><span id="local-6989586621684561069"><span class="annot"><span class="annottext">Constraints
</span><a href="#local-6989586621684561069"><span class="hs-identifier hs-var">constraints</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TermTypeM Constraints
forall (m :: * -&gt; *). MonadUnify m =&gt; m Constraints
</span><a href="Language.Futhark.TypeChecker.Unify.html#getConstraints"><span class="hs-identifier hs-var">getConstraints</span></a></span><span>
</span><span id="line-1096"></span><span>
</span><span id="line-1097"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684561060"><span class="annot"><span class="annottext">checkCausality :: Doc
-&gt; Set VName
-&gt; TypeBase (DimDecl VName) as
-&gt; SrcLoc
-&gt; Maybe (t (Either TypeError) a)
</span><a href="#local-6989586621684561060"><span class="hs-identifier hs-var hs-var">checkCausality</span></a></span></span><span> </span><span id="local-6989586621684561059"><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621684561059"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span id="local-6989586621684561058"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561058"><span class="hs-identifier hs-var">known</span></a></span></span><span> </span><span id="local-6989586621684561057"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561057"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621684561056"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561056"><span class="hs-identifier hs-var">loc</span></a></span></span><span>
</span><span id="line-1098"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684561055"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684561055"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684561054"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561054"><span class="hs-identifier hs-var">dloc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[(VName, SrcLoc)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1099"></span><span>            </span><span class="annot"><span class="annottext">(VName -&gt; Maybe (VName, SrcLoc)) -&gt; [VName] -&gt; [(VName, SrcLoc)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constraints -&gt; Set VName -&gt; VName -&gt; Maybe (VName, SrcLoc)
forall {a} {a}.
Ord a =&gt;
Map a (a, Constraint) -&gt; Set a -&gt; a -&gt; Maybe (a, SrcLoc)
</span><a href="#local-6989586621684561053"><span class="hs-identifier hs-var">unknown</span></a></span><span> </span><span class="annot"><span class="annottext">Constraints
</span><a href="#local-6989586621684561069"><span class="hs-identifier hs-var">constraints</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561058"><span class="hs-identifier hs-var">known</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; [(VName, SrcLoc)]) -&gt; [VName] -&gt; [(VName, SrcLoc)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1100"></span><span>              </span><span class="annot"><span class="annottext">Set VName -&gt; [VName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set VName -&gt; [VName]) -&gt; Set VName -&gt; [VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; Set VName
forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="Language.Futhark.Prop.html#typeDimNames"><span class="hs-identifier hs-var">typeDimNames</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) () -&gt; Set VName)
-&gt; TypeBase (DimDecl VName) () -&gt; Set VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561057"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1101"></span><span>          </span><span class="annot"><span class="annottext">t (Either TypeError) a -&gt; Maybe (t (Either TypeError) a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(t (Either TypeError) a -&gt; Maybe (t (Either TypeError) a))
-&gt; t (Either TypeError) a -&gt; Maybe (t (Either TypeError) a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Either TypeError a -&gt; t (Either TypeError) a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Either TypeError a -&gt; t (Either TypeError) a)
-&gt; Either TypeError a -&gt; t (Either TypeError) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc
-&gt; SrcLoc
-&gt; VName
-&gt; SrcLoc
-&gt; TypeBase (DimDecl VName) as
-&gt; Either TypeError a
forall {v} {a} {b} {b}.
(IsName v, Pretty a, Located b) =&gt;
Doc -&gt; SrcLoc -&gt; v -&gt; b -&gt; a -&gt; Either TypeError b
</span><a href="#local-6989586621684561051"><span class="hs-identifier hs-var">causality</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621684561059"><span class="hs-identifier hs-var">what</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561056"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684561055"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561054"><span class="hs-identifier hs-var">dloc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) as
</span><a href="#local-6989586621684561057"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1102"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (t (Either TypeError) a)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1103"></span><span>
</span><span id="line-1104"></span><span>      </span><span id="local-6989586621684561042"><span class="annot"><span class="annottext">checkParamCausality :: Set VName -&gt; PatBase Info VName -&gt; Maybe (t (Either TypeError) a)
</span><a href="#local-6989586621684561042"><span class="hs-identifier hs-var hs-var">checkParamCausality</span></a></span></span><span> </span><span id="local-6989586621684561041"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561041"><span class="hs-identifier hs-var">known</span></a></span></span><span> </span><span id="local-6989586621684561040"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561040"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1105"></span><span>        </span><span class="annot"><span class="annottext">Doc
-&gt; Set VName
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; SrcLoc
-&gt; Maybe (t (Either TypeError) a)
forall {t :: (* -&gt; *) -&gt; * -&gt; *} {as} {a}.
MonadTrans t =&gt;
Doc
-&gt; Set VName
-&gt; TypeBase (DimDecl VName) as
-&gt; SrcLoc
-&gt; Maybe (t (Either TypeError) a)
</span><a href="#local-6989586621684561060"><span class="hs-identifier hs-var">checkCausality</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561040"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561041"><span class="hs-identifier hs-var">known</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatBase Info VName -&gt; TypeBase (DimDecl VName) Aliasing
</span><a href="Language.Futhark.Prop.html#patternType"><span class="hs-identifier hs-var">patternType</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561040"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatBase Info VName -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684561040"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1106"></span><span>
</span><span id="line-1107"></span><span>      </span><span class="annot"><a href="#local-6989586621684561038"><span class="hs-identifier hs-type">onExp</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1108"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1109"></span><span>        </span><span class="annot"><a href="Language.Futhark.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1110"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeError"><span class="hs-identifier hs-type">TypeError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Language.Futhark.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-1111"></span><span>
</span><span id="line-1112"></span><span>      </span><span id="local-6989586621684561038"><span class="annot"><span class="annottext">onExp :: Set VName -&gt; Exp -&gt; StateT (Set VName) (Either TypeError) Exp
</span><a href="#local-6989586621684561038"><span class="hs-identifier hs-var hs-var">onExp</span></a></span></span><span> </span><span id="local-6989586621684561037"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561037"><span class="hs-identifier hs-var">known</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684561036"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561036"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span id="local-6989586621684561035"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561035"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684561034"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561034"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1113"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684561033"><span class="annot"><span class="annottext">StateT (Set VName) (Either TypeError) Exp
</span><a href="#local-6989586621684561033"><span class="hs-identifier hs-var">bad</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Doc
-&gt; Set VName
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; SrcLoc
-&gt; Maybe (StateT (Set VName) (Either TypeError) Exp)
forall {t :: (* -&gt; *) -&gt; * -&gt; *} {as} {a}.
MonadTrans t =&gt;
Doc
-&gt; Set VName
-&gt; TypeBase (DimDecl VName) as
-&gt; SrcLoc
-&gt; Maybe (t (Either TypeError) a)
</span><a href="#local-6989586621684561060"><span class="hs-identifier hs-var">checkCausality</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName VName -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684561036"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561037"><span class="hs-identifier hs-var">known</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561035"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561034"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1114"></span><span>          </span><span class="annot"><span class="annottext">StateT (Set VName) (Either TypeError) Exp
</span><a href="#local-6989586621684561033"><span class="hs-identifier hs-var">bad</span></a></span><span>
</span><span id="line-1115"></span><span>      </span><span class="annot"><a href="#local-6989586621684561038"><span class="hs-identifier hs-var">onExp</span></a></span><span> </span><span id="local-6989586621684561032"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561032"><span class="hs-identifier hs-var">known</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ProjectSection"><span class="hs-identifier hs-type">ProjectSection</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span id="local-6989586621684561031"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561031"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684561030"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561030"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1116"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684561029"><span class="annot"><span class="annottext">StateT (Set VName) (Either TypeError) Exp
</span><a href="#local-6989586621684561029"><span class="hs-identifier hs-var">bad</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Doc
-&gt; Set VName
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; SrcLoc
-&gt; Maybe (StateT (Set VName) (Either TypeError) Exp)
forall {t :: (* -&gt; *) -&gt; * -&gt; *} {as} {a}.
MonadTrans t =&gt;
Doc
-&gt; Set VName
-&gt; TypeBase (DimDecl VName) as
-&gt; SrcLoc
-&gt; Maybe (t (Either TypeError) a)
</span><a href="#local-6989586621684561060"><span class="hs-identifier hs-var">checkCausality</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;projection section&quot;</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561032"><span class="hs-identifier hs-var">known</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561031"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561030"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1117"></span><span>          </span><span class="annot"><span class="annottext">StateT (Set VName) (Either TypeError) Exp
</span><a href="#local-6989586621684561029"><span class="hs-identifier hs-var">bad</span></a></span><span>
</span><span id="line-1118"></span><span>      </span><span class="annot"><a href="#local-6989586621684561038"><span class="hs-identifier hs-var">onExp</span></a></span><span> </span><span id="local-6989586621684561028"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561028"><span class="hs-identifier hs-var">known</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#IndexSection"><span class="hs-identifier hs-type">IndexSection</span></a></span><span> </span><span class="annot"><span class="annottext">Slice
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span id="local-6989586621684561027"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561027"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684561026"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561026"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1119"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684561025"><span class="annot"><span class="annottext">StateT (Set VName) (Either TypeError) Exp
</span><a href="#local-6989586621684561025"><span class="hs-identifier hs-var">bad</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Doc
-&gt; Set VName
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; SrcLoc
-&gt; Maybe (StateT (Set VName) (Either TypeError) Exp)
forall {t :: (* -&gt; *) -&gt; * -&gt; *} {as} {a}.
MonadTrans t =&gt;
Doc
-&gt; Set VName
-&gt; TypeBase (DimDecl VName) as
-&gt; SrcLoc
-&gt; Maybe (t (Either TypeError) a)
</span><a href="#local-6989586621684561060"><span class="hs-identifier hs-var">checkCausality</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;projection section&quot;</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561028"><span class="hs-identifier hs-var">known</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561027"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561026"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1120"></span><span>          </span><span class="annot"><span class="annottext">StateT (Set VName) (Either TypeError) Exp
</span><a href="#local-6989586621684561025"><span class="hs-identifier hs-var">bad</span></a></span><span>
</span><span id="line-1121"></span><span>      </span><span class="annot"><a href="#local-6989586621684561038"><span class="hs-identifier hs-var">onExp</span></a></span><span> </span><span id="local-6989586621684561024"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561024"><span class="hs-identifier hs-var">known</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#OpSectionRight"><span class="hs-identifier hs-type">OpSectionRight</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span id="local-6989586621684561023"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561023"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(Info (PName, TypeBase (DimDecl VName) ()),
 Info (PName, TypeBase (DimDecl VName) (), Maybe VName))
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Info (RetTypeBase (DimDecl VName) Aliasing)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561022"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561022"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1122"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684561021"><span class="annot"><span class="annottext">StateT (Set VName) (Either TypeError) Exp
</span><a href="#local-6989586621684561021"><span class="hs-identifier hs-var">bad</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Doc
-&gt; Set VName
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; SrcLoc
-&gt; Maybe (StateT (Set VName) (Either TypeError) Exp)
forall {t :: (* -&gt; *) -&gt; * -&gt; *} {as} {a}.
MonadTrans t =&gt;
Doc
-&gt; Set VName
-&gt; TypeBase (DimDecl VName) as
-&gt; SrcLoc
-&gt; Maybe (t (Either TypeError) a)
</span><a href="#local-6989586621684561060"><span class="hs-identifier hs-var">checkCausality</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;operator section&quot;</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561024"><span class="hs-identifier hs-var">known</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561023"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561022"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1123"></span><span>          </span><span class="annot"><span class="annottext">StateT (Set VName) (Either TypeError) Exp
</span><a href="#local-6989586621684561021"><span class="hs-identifier hs-var">bad</span></a></span><span>
</span><span id="line-1124"></span><span>      </span><span class="annot"><a href="#local-6989586621684561038"><span class="hs-identifier hs-var">onExp</span></a></span><span> </span><span id="local-6989586621684561020"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561020"><span class="hs-identifier hs-var">known</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#OpSectionLeft"><span class="hs-identifier hs-type">OpSectionLeft</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span id="local-6989586621684561019"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561019"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(Info (PName, TypeBase (DimDecl VName) (), Maybe VName),
 Info (PName, TypeBase (DimDecl VName) ()))
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(Info (RetTypeBase (DimDecl VName) Aliasing), Info [VName])
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561018"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561018"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1125"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684561017"><span class="annot"><span class="annottext">StateT (Set VName) (Either TypeError) Exp
</span><a href="#local-6989586621684561017"><span class="hs-identifier hs-var">bad</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Doc
-&gt; Set VName
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; SrcLoc
-&gt; Maybe (StateT (Set VName) (Either TypeError) Exp)
forall {t :: (* -&gt; *) -&gt; * -&gt; *} {as} {a}.
MonadTrans t =&gt;
Doc
-&gt; Set VName
-&gt; TypeBase (DimDecl VName) as
-&gt; SrcLoc
-&gt; Maybe (t (Either TypeError) a)
</span><a href="#local-6989586621684561060"><span class="hs-identifier hs-var">checkCausality</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;operator section&quot;</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561020"><span class="hs-identifier hs-var">known</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561019"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561018"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1126"></span><span>          </span><span class="annot"><span class="annottext">StateT (Set VName) (Either TypeError) Exp
</span><a href="#local-6989586621684561017"><span class="hs-identifier hs-var">bad</span></a></span><span>
</span><span id="line-1127"></span><span>      </span><span class="annot"><a href="#local-6989586621684561038"><span class="hs-identifier hs-var">onExp</span></a></span><span> </span><span id="local-6989586621684561016"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561016"><span class="hs-identifier hs-var">known</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ArrayLit"><span class="hs-identifier hs-type">ArrayLit</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span id="local-6989586621684561015"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561015"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684561014"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561014"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1128"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684561013"><span class="annot"><span class="annottext">StateT (Set VName) (Either TypeError) Exp
</span><a href="#local-6989586621684561013"><span class="hs-identifier hs-var">bad</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Doc
-&gt; Set VName
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; SrcLoc
-&gt; Maybe (StateT (Set VName) (Either TypeError) Exp)
forall {t :: (* -&gt; *) -&gt; * -&gt; *} {as} {a}.
MonadTrans t =&gt;
Doc
-&gt; Set VName
-&gt; TypeBase (DimDecl VName) as
-&gt; SrcLoc
-&gt; Maybe (t (Either TypeError) a)
</span><a href="#local-6989586621684561060"><span class="hs-identifier hs-var">checkCausality</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;empty array&quot;</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561016"><span class="hs-identifier hs-var">known</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684561015"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684561014"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1129"></span><span>          </span><span class="annot"><span class="annottext">StateT (Set VName) (Either TypeError) Exp
</span><a href="#local-6989586621684561013"><span class="hs-identifier hs-var">bad</span></a></span><span>
</span><span id="line-1130"></span><span>      </span><span class="annot"><a href="#local-6989586621684561038"><span class="hs-identifier hs-var">onExp</span></a></span><span> </span><span id="local-6989586621684561012"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561012"><span class="hs-identifier hs-var">known</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span id="local-6989586621684561011"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684561011"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Info (Aliasing, StructRetType)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1131"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621684561010"><span class="annot"><span class="annottext">StateT (Set VName) (Either TypeError) Exp
</span><a href="#local-6989586621684561010"><span class="hs-identifier hs-var">bad</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[StateT (Set VName) (Either TypeError) Exp]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName
 -&gt; Maybe (StateT (Set VName) (Either TypeError) Exp))
-&gt; [PatBase Info VName]
-&gt; [StateT (Set VName) (Either TypeError) Exp]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set VName
-&gt; PatBase Info VName
-&gt; Maybe (StateT (Set VName) (Either TypeError) Exp)
forall {t :: (* -&gt; *) -&gt; * -&gt; *} {a}.
MonadTrans t =&gt;
Set VName -&gt; PatBase Info VName -&gt; Maybe (t (Either TypeError) a)
</span><a href="#local-6989586621684561042"><span class="hs-identifier hs-var">checkParamCausality</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561012"><span class="hs-identifier hs-var">known</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684561011"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1132"></span><span>          </span><span class="annot"><span class="annottext">StateT (Set VName) (Either TypeError) Exp
</span><a href="#local-6989586621684561010"><span class="hs-identifier hs-var">bad</span></a></span><span>
</span><span id="line-1133"></span><span>      </span><span class="annot"><a href="#local-6989586621684561038"><span class="hs-identifier hs-var">onExp</span></a></span><span> </span><span id="local-6989586621684561009"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561009"><span class="hs-identifier hs-var">known</span></a></span></span><span> </span><span id="local-6989586621684561008"><span class="annot"><span class="annottext">e :: Exp
</span><a href="#local-6989586621684561008"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#LetPat"><span class="hs-identifier hs-type">LetPat</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684561007"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561007"><span class="hs-identifier hs-var">bindee_e</span></a></span></span><span> </span><span id="local-6989586621684561006"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561006"><span class="hs-identifier hs-var">body_e</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span id="local-6989586621684561005"><span class="annot"><span class="annottext">AppRes
</span><a href="#local-6989586621684561005"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1134"></span><span>        </span><span class="annot"><span class="annottext">Set VName
-&gt; Exp
-&gt; Exp
-&gt; [VName]
-&gt; StateT (Set VName) (Either TypeError) ()
</span><a href="#local-6989586621684561004"><span class="hs-identifier hs-var">sequencePoint</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561009"><span class="hs-identifier hs-var">known</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561007"><span class="hs-identifier hs-var">bindee_e</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561006"><span class="hs-identifier hs-var">body_e</span></a></span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; StateT (Set VName) (Either TypeError) ())
-&gt; [VName] -&gt; StateT (Set VName) (Either TypeError) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AppRes -&gt; [VName]
</span><a href="Language.Futhark.Syntax.html#appResExt"><span class="hs-identifier hs-var hs-var">appResExt</span></a></span><span> </span><span class="annot"><span class="annottext">AppRes
</span><a href="#local-6989586621684561005"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-1135"></span><span>        </span><span class="annot"><span class="annottext">Exp -&gt; StateT (Set VName) (Either TypeError) Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561008"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1136"></span><span>      </span><span class="annot"><a href="#local-6989586621684561038"><span class="hs-identifier hs-var">onExp</span></a></span><span> </span><span id="local-6989586621684561002"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561002"><span class="hs-identifier hs-var">known</span></a></span></span><span> </span><span id="local-6989586621684561001"><span class="annot"><span class="annottext">e :: Exp
</span><a href="#local-6989586621684561001"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621684561000"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561000"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621684560999"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560999"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Diet
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560998"><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684560998"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span id="local-6989586621684560997"><span class="annot"><span class="annottext">AppRes
</span><a href="#local-6989586621684560997"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1137"></span><span>        </span><span class="annot"><span class="annottext">Set VName
-&gt; Exp
-&gt; Exp
-&gt; [VName]
-&gt; StateT (Set VName) (Either TypeError) ()
</span><a href="#local-6989586621684561004"><span class="hs-identifier hs-var">sequencePoint</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684561002"><span class="hs-identifier hs-var">known</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560999"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561000"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; StateT (Set VName) (Either TypeError) ())
-&gt; [VName] -&gt; StateT (Set VName) (Either TypeError) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe VName -&gt; [VName]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684560998"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; [VName] -&gt; [VName]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">AppRes -&gt; [VName]
</span><a href="Language.Futhark.Syntax.html#appResExt"><span class="hs-identifier hs-var hs-var">appResExt</span></a></span><span> </span><span class="annot"><span class="annottext">AppRes
</span><a href="#local-6989586621684560997"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-1138"></span><span>        </span><span class="annot"><span class="annottext">Exp -&gt; StateT (Set VName) (Either TypeError) Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561001"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1139"></span><span>      </span><span class="annot"><a href="#local-6989586621684561038"><span class="hs-identifier hs-var">onExp</span></a></span><span>
</span><span id="line-1140"></span><span>        </span><span id="local-6989586621684560996"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560996"><span class="hs-identifier hs-var">known</span></a></span></span><span>
</span><span id="line-1141"></span><span>        </span><span id="local-6989586621684560995"><span class="annot"><span class="annottext">e :: Exp
</span><a href="#local-6989586621684560995"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#BinOp"><span class="hs-identifier hs-type">BinOp</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684560994"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684560994"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560993"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560993"><span class="hs-identifier hs-var">floc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684560992"><span class="annot"><span class="annottext">Info (TypeBase (DimDecl VName) Aliasing)
</span><a href="#local-6989586621684560992"><span class="hs-identifier hs-var">ft</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684560991"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560991"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560990"><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684560990"><span class="hs-identifier hs-var">xp</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684560989"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560989"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560988"><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684560988"><span class="hs-identifier hs-var">yp</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span id="local-6989586621684560987"><span class="annot"><span class="annottext">AppRes
</span><a href="#local-6989586621684560987"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1142"></span><span>          </span><span id="local-6989586621684560986"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560986"><span class="hs-identifier hs-var">args_known</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1143"></span><span>            </span><span class="annot"><span class="annottext">Either TypeError (Set VName)
-&gt; StateT (Set VName) (Either TypeError) (Set VName)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Either TypeError (Set VName)
 -&gt; StateT (Set VName) (Either TypeError) (Set VName))
-&gt; Either TypeError (Set VName)
-&gt; StateT (Set VName) (Either TypeError) (Set VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1144"></span><span>              </span><span class="annot"><span class="annottext">StateT (Set VName) (Either TypeError) ()
-&gt; Set VName -&gt; Either TypeError (Set VName)
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m s
</span><span class="hs-identifier hs-var">execStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set VName
-&gt; Exp
-&gt; Exp
-&gt; [VName]
-&gt; StateT (Set VName) (Either TypeError) ()
</span><a href="#local-6989586621684561004"><span class="hs-identifier hs-var">sequencePoint</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560996"><span class="hs-identifier hs-var">known</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560991"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560989"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; StateT (Set VName) (Either TypeError) ())
-&gt; [VName] -&gt; StateT (Set VName) (Either TypeError) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Maybe VName] -&gt; [VName]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684560990"><span class="hs-identifier hs-var">xp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684560988"><span class="hs-identifier hs-var">yp</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set VName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1145"></span><span>          </span><span class="annot"><span class="annottext">StateT (Set VName) (Either TypeError) Exp
-&gt; StateT (Set VName) (Either TypeError) ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(StateT (Set VName) (Either TypeError) Exp
 -&gt; StateT (Set VName) (Either TypeError) ())
-&gt; StateT (Set VName) (Either TypeError) Exp
-&gt; StateT (Set VName) (Either TypeError) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Exp -&gt; StateT (Set VName) (Either TypeError) Exp
</span><a href="#local-6989586621684561038"><span class="hs-identifier hs-var">onExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560986"><span class="hs-identifier hs-var">args_known</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560996"><span class="hs-identifier hs-var">known</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName VName
-&gt; Info (TypeBase (DimDecl VName) Aliasing) -&gt; SrcLoc -&gt; Exp
forall (f :: * -&gt; *) vn.
QualName vn
-&gt; f (TypeBase (DimDecl VName) Aliasing) -&gt; SrcLoc -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684560994"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Info (TypeBase (DimDecl VName) Aliasing)
</span><a href="#local-6989586621684560992"><span class="hs-identifier hs-var">ft</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560993"><span class="hs-identifier hs-var">floc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1146"></span><span>          </span><span class="annot"><span class="annottext">(Set VName -&gt; Set VName)
-&gt; StateT (Set VName) (Either TypeError) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560986"><span class="hs-identifier hs-var">args_known</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; Set VName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppRes -&gt; [VName]
</span><a href="Language.Futhark.Syntax.html#appResExt"><span class="hs-identifier hs-var hs-var">appResExt</span></a></span><span> </span><span class="annot"><span class="annottext">AppRes
</span><a href="#local-6989586621684560987"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1147"></span><span>          </span><span class="annot"><span class="annottext">Exp -&gt; StateT (Set VName) (Either TypeError) Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560995"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1148"></span><span>      </span><span class="annot"><a href="#local-6989586621684561038"><span class="hs-identifier hs-var">onExp</span></a></span><span> </span><span id="local-6989586621684560983"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560983"><span class="hs-identifier hs-var">known</span></a></span></span><span> </span><span id="local-6989586621684560982"><span class="annot"><span class="annottext">e :: Exp
</span><a href="#local-6989586621684560982"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span id="local-6989586621684560981"><span class="annot"><span class="annottext">AppExpBase Info VName
</span><a href="#local-6989586621684560981"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span id="local-6989586621684560980"><span class="annot"><span class="annottext">AppRes
</span><a href="#local-6989586621684560980"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1149"></span><span>        </span><span class="annot"><span class="annottext">Set VName
-&gt; AppExpBase Info VName
-&gt; StateT (Set VName) (Either TypeError) ()
forall {a}.
ASTMappable a =&gt;
Set VName -&gt; a -&gt; StateT (Set VName) (Either TypeError) ()
</span><a href="#local-6989586621684560979"><span class="hs-identifier hs-var">recurse</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560983"><span class="hs-identifier hs-var">known</span></a></span><span> </span><span class="annot"><span class="annottext">AppExpBase Info VName
</span><a href="#local-6989586621684560981"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-1150"></span><span>        </span><span class="annot"><span class="annottext">(Set VName -&gt; Set VName)
-&gt; StateT (Set VName) (Either TypeError) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; Set VName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AppRes -&gt; [VName]
</span><a href="Language.Futhark.Syntax.html#appResExt"><span class="hs-identifier hs-var hs-var">appResExt</span></a></span><span> </span><span class="annot"><span class="annottext">AppRes
</span><a href="#local-6989586621684560980"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1151"></span><span>        </span><span class="annot"><span class="annottext">Exp -&gt; StateT (Set VName) (Either TypeError) Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560982"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1152"></span><span>      </span><span class="annot"><a href="#local-6989586621684561038"><span class="hs-identifier hs-var">onExp</span></a></span><span> </span><span id="local-6989586621684560978"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560978"><span class="hs-identifier hs-var">known</span></a></span></span><span> </span><span id="local-6989586621684560977"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560977"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1153"></span><span>        </span><span class="annot"><span class="annottext">Set VName -&gt; Exp -&gt; StateT (Set VName) (Either TypeError) ()
forall {a}.
ASTMappable a =&gt;
Set VName -&gt; a -&gt; StateT (Set VName) (Either TypeError) ()
</span><a href="#local-6989586621684560979"><span class="hs-identifier hs-var">recurse</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560978"><span class="hs-identifier hs-var">known</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560977"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1154"></span><span>        </span><span class="annot"><span class="annottext">Exp -&gt; StateT (Set VName) (Either TypeError) Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560977"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1155"></span><span>
</span><span id="line-1156"></span><span>      </span><span id="local-6989586621684560979"><span class="annot"><span class="annottext">recurse :: Set VName -&gt; a -&gt; StateT (Set VName) (Either TypeError) ()
</span><a href="#local-6989586621684560979"><span class="hs-identifier hs-var hs-var">recurse</span></a></span></span><span> </span><span id="local-6989586621684560970"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560970"><span class="hs-identifier hs-var">known</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT (Set VName) (Either TypeError) a
-&gt; StateT (Set VName) (Either TypeError) ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(StateT (Set VName) (Either TypeError) a
 -&gt; StateT (Set VName) (Either TypeError) ())
-&gt; (a -&gt; StateT (Set VName) (Either TypeError) a)
-&gt; a
-&gt; StateT (Set VName) (Either TypeError) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ASTMapper (StateT (Set VName) (Either TypeError))
-&gt; a -&gt; StateT (Set VName) (Either TypeError) a
forall x (m :: * -&gt; *).
(ASTMappable x, Monad m) =&gt;
ASTMapper m -&gt; x -&gt; m x
</span><a href="Language.Futhark.Traversals.html#astMap"><span class="hs-identifier hs-var">astMap</span></a></span><span> </span><span class="annot"><span class="annottext">ASTMapper (StateT (Set VName) (Either TypeError))
</span><a href="#local-6989586621684560969"><span class="hs-identifier hs-var">mapper</span></a></span><span>
</span><span id="line-1157"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-1158"></span><span>          </span><span id="local-6989586621684560969"><span class="annot"><span class="annottext">mapper :: ASTMapper (StateT (Set VName) (Either TypeError))
</span><a href="#local-6989586621684560969"><span class="hs-identifier hs-var hs-var">mapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ASTMapper (StateT (Set VName) (Either TypeError))
forall (m :: * -&gt; *). Monad m =&gt; ASTMapper m
</span><a href="Language.Futhark.Traversals.html#identityMapper"><span class="hs-identifier hs-var">identityMapper</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">mapOnExp :: Exp -&gt; StateT (Set VName) (Either TypeError) Exp
</span><a href="Language.Futhark.Traversals.html#mapOnExp"><span class="hs-identifier hs-var">mapOnExp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Exp -&gt; StateT (Set VName) (Either TypeError) Exp
</span><a href="#local-6989586621684561038"><span class="hs-identifier hs-var">onExp</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560970"><span class="hs-identifier hs-var">known</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-1159"></span><span>
</span><span id="line-1160"></span><span>      </span><span id="local-6989586621684561004"><span class="annot"><span class="annottext">sequencePoint :: Set VName
-&gt; Exp
-&gt; Exp
-&gt; [VName]
-&gt; StateT (Set VName) (Either TypeError) ()
</span><a href="#local-6989586621684561004"><span class="hs-identifier hs-var hs-var">sequencePoint</span></a></span></span><span> </span><span id="local-6989586621684560951"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560951"><span class="hs-identifier hs-var">known</span></a></span></span><span> </span><span id="local-6989586621684560950"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560950"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621684560949"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560949"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621684560948"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684560948"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1161"></span><span>        </span><span id="local-6989586621684560947"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560947"><span class="hs-identifier hs-var">new_known</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Either TypeError (Set VName)
-&gt; StateT (Set VName) (Either TypeError) (Set VName)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Either TypeError (Set VName)
 -&gt; StateT (Set VName) (Either TypeError) (Set VName))
-&gt; Either TypeError (Set VName)
-&gt; StateT (Set VName) (Either TypeError) (Set VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StateT (Set VName) (Either TypeError) Exp
-&gt; Set VName -&gt; Either TypeError (Set VName)
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m s
</span><span class="hs-identifier hs-var">execStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set VName -&gt; Exp -&gt; StateT (Set VName) (Either TypeError) Exp
</span><a href="#local-6989586621684561038"><span class="hs-identifier hs-var">onExp</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560951"><span class="hs-identifier hs-var">known</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560950"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set VName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1162"></span><span>        </span><span class="annot"><span class="annottext">StateT (Set VName) (Either TypeError) Exp
-&gt; StateT (Set VName) (Either TypeError) ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(StateT (Set VName) (Either TypeError) Exp
 -&gt; StateT (Set VName) (Either TypeError) ())
-&gt; StateT (Set VName) (Either TypeError) Exp
-&gt; StateT (Set VName) (Either TypeError) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Exp -&gt; StateT (Set VName) (Either TypeError) Exp
</span><a href="#local-6989586621684561038"><span class="hs-identifier hs-var">onExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560947"><span class="hs-identifier hs-var">new_known</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560951"><span class="hs-identifier hs-var">known</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560949"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-1163"></span><span>        </span><span class="annot"><span class="annottext">(Set VName -&gt; Set VName)
-&gt; StateT (Set VName) (Either TypeError) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560947"><span class="hs-identifier hs-var">new_known</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; Set VName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684560948"><span class="hs-identifier hs-var">ext</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1164"></span><span>
</span><span id="line-1165"></span><span>  </span><span class="annot"><span class="annottext">(TypeError -&gt; TermTypeM ())
-&gt; (Exp -&gt; TermTypeM ()) -&gt; Either TypeError Exp -&gt; TermTypeM ()
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TermTypeM ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermTypeM () -&gt; Exp -&gt; TermTypeM ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(TermTypeM () -&gt; Exp -&gt; TermTypeM ())
-&gt; TermTypeM () -&gt; Exp -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; TermTypeM ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either TypeError Exp -&gt; TermTypeM ())
-&gt; Either TypeError Exp -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1166"></span><span>    </span><span class="annot"><span class="annottext">StateT (Set VName) (Either TypeError) Exp
-&gt; Set VName -&gt; Either TypeError Exp
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><span class="hs-identifier hs-var">evalStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set VName -&gt; Exp -&gt; StateT (Set VName) (Either TypeError) Exp
</span><a href="#local-6989586621684561038"><span class="hs-identifier hs-var">onExp</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684561070"><span class="hs-identifier hs-var">binding_body</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set VName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1167"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1168"></span><span>    </span><span id="local-6989586621684561053"><span class="annot"><span class="annottext">unknown :: Map a (a, Constraint) -&gt; Set a -&gt; a -&gt; Maybe (a, SrcLoc)
</span><a href="#local-6989586621684561053"><span class="hs-identifier hs-var hs-var">unknown</span></a></span></span><span> </span><span id="local-6989586621684560936"><span class="annot"><span class="annottext">Map a (a, Constraint)
</span><a href="#local-6989586621684560936"><span class="hs-identifier hs-var">constraints</span></a></span></span><span> </span><span id="local-6989586621684560935"><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621684560935"><span class="hs-identifier hs-var">known</span></a></span></span><span> </span><span id="local-6989586621684560934"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560934"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1169"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560934"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Set a -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.notMember`</span></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621684560935"><span class="hs-identifier hs-var">known</span></a></span><span>
</span><span id="line-1170"></span><span>      </span><span id="local-6989586621684560933"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560933"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map a (a, Constraint) -&gt; a -&gt; Maybe SrcLoc
forall {k} {a}. Ord k =&gt; Map k (a, Constraint) -&gt; k -&gt; Maybe SrcLoc
</span><a href="#local-6989586621684560932"><span class="hs-identifier hs-var">unknowable</span></a></span><span> </span><span class="annot"><span class="annottext">Map a (a, Constraint)
</span><a href="#local-6989586621684560936"><span class="hs-identifier hs-var">constraints</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560934"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1171"></span><span>      </span><span class="annot"><span class="annottext">(a, SrcLoc) -&gt; Maybe (a, SrcLoc)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560934"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560933"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1172"></span><span>
</span><span id="line-1173"></span><span>    </span><span id="local-6989586621684560932"><span class="annot"><span class="annottext">unknowable :: Map k (a, Constraint) -&gt; k -&gt; Maybe SrcLoc
</span><a href="#local-6989586621684560932"><span class="hs-identifier hs-var hs-var">unknowable</span></a></span></span><span> </span><span id="local-6989586621684560928"><span class="annot"><span class="annottext">Map k (a, Constraint)
</span><a href="#local-6989586621684560928"><span class="hs-identifier hs-var">constraints</span></a></span></span><span> </span><span id="local-6989586621684560927"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621684560927"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1174"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(a, Constraint) -&gt; Constraint
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((a, Constraint) -&gt; Constraint)
-&gt; Maybe (a, Constraint) -&gt; Maybe Constraint
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">k -&gt; Map k (a, Constraint) -&gt; Maybe (a, Constraint)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621684560927"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Map k (a, Constraint)
</span><a href="#local-6989586621684560928"><span class="hs-identifier hs-var">constraints</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1175"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#UnknowableSize"><span class="hs-identifier hs-type">UnknowableSize</span></a></span><span> </span><span id="local-6989586621684560925"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560925"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">RigidSource
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Maybe SrcLoc
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560925"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-1176"></span><span>        </span><span class="annot"><span class="annottext">Maybe Constraint
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe SrcLoc
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1177"></span><span>
</span><span id="line-1178"></span><span>    </span><span id="local-6989586621684561051"><span class="annot"><span class="annottext">causality :: Doc -&gt; SrcLoc -&gt; v -&gt; b -&gt; a -&gt; Either TypeError b
</span><a href="#local-6989586621684561051"><span class="hs-identifier hs-var hs-var">causality</span></a></span></span><span> </span><span id="local-6989586621684560903"><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621684560903"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span id="local-6989586621684560902"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560902"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621684560901"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621684560901"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621684560900"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621684560900"><span class="hs-identifier hs-var">dloc</span></a></span></span><span> </span><span id="local-6989586621684560899"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560899"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1179"></span><span>      </span><span class="annot"><span class="annottext">TypeError -&gt; Either TypeError b
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; Either TypeError b)
-&gt; (Doc -&gt; TypeError) -&gt; Doc -&gt; Either TypeError b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TypeError
</span><a href="Language.Futhark.TypeChecker.Monad.html#TypeError"><span class="hs-identifier hs-var">TypeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560902"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TypeError) -&gt; (Doc -&gt; Doc) -&gt; Doc -&gt; TypeError
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Language.Futhark.TypeChecker.Monad.html#withIndexLink"><span class="hs-identifier hs-var">withIndexLink</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;causality-check&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Either TypeError b) -&gt; Doc -&gt; Either TypeError b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1180"></span><span>        </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Causality check: size&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">v -&gt; Doc
forall v. IsName v =&gt; v -&gt; Doc
</span><a href="Language.Futhark.Pretty.html#pprName"><span class="hs-identifier hs-var">pprName</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621684560901"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1181"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;needed for type of&quot;</span></span><span>
</span><span id="line-1182"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621684560903"><span class="hs-identifier hs-var">what</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-identifier hs-var">colon</span></span><span>
</span><span id="line-1183"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
</span><span class="hs-identifier hs-var">indent</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560899"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1184"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;But&quot;</span></span><span>
</span><span id="line-1185"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">v -&gt; Doc
forall v. IsName v =&gt; v -&gt; Doc
</span><a href="Language.Futhark.Pretty.html#pprName"><span class="hs-identifier hs-var">pprName</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621684560901"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1186"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;is computed at&quot;</span></span><span>
</span><span id="line-1187"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; b -&gt; String
forall a b. (Located a, Located b) =&gt; a -&gt; b -&gt; String
</span><a href="Language.Futhark.Core.html#locStrRel"><span class="hs-identifier hs-var">locStrRel</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560902"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621684560900"><span class="hs-identifier hs-var">dloc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-1188"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-1189"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Hint:&quot;</span></span><span>
</span><span id="line-1190"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><span class="hs-identifier hs-var">align</span></span><span>
</span><span id="line-1191"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc
</span><a href="Futhark.Util.Pretty.html#textwrap"><span class="hs-identifier hs-var">textwrap</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Bind the expression producing&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">v -&gt; Doc
forall v. IsName v =&gt; v -&gt; Doc
</span><a href="Language.Futhark.Pretty.html#pprName"><span class="hs-identifier hs-var">pprName</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621684560901"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1192"></span><span>                </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;with 'let' beforehand.&quot;</span></span><span>
</span><span id="line-1193"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-1194"></span><span>
</span><span id="line-1195"></span><span class="hs-comment">-- | Traverse the expression, emitting warnings if any of the literals overflow</span><span>
</span><span id="line-1196"></span><span class="hs-comment">-- their inferred types</span><span>
</span><span id="line-1197"></span><span class="hs-comment">--</span><span>
</span><span id="line-1198"></span><span class="hs-comment">-- Note: currently unable to detect float underflow (such as 1e-400 -&gt; 0)</span><span>
</span><span id="line-1199"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#literalOverflowCheck"><span class="hs-identifier hs-type">literalOverflowCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1200"></span><span id="literalOverflowCheck"><span class="annot"><span class="annottext">literalOverflowCheck :: Exp -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#literalOverflowCheck"><span class="hs-identifier hs-var hs-var">literalOverflowCheck</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermTypeM Exp -&gt; TermTypeM ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(TermTypeM Exp -&gt; TermTypeM ())
-&gt; (Exp -&gt; TermTypeM Exp) -&gt; Exp -&gt; TermTypeM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall {f :: * -&gt; *}. MonadTypeChecker f =&gt; Exp -&gt; f Exp
</span><a href="#local-6989586621684560895"><span class="hs-identifier hs-var">check</span></a></span><span>
</span><span id="line-1201"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1202"></span><span>    </span><span id="local-6989586621684560895"><span class="annot"><span class="annottext">check :: Exp -&gt; f Exp
</span><a href="#local-6989586621684560895"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span id="local-6989586621684560852"><span class="annot"><span class="annottext">e :: Exp
</span><a href="#local-6989586621684560852"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#IntLit"><span class="hs-identifier hs-type">IntLit</span></a></span><span> </span><span id="local-6989586621684560851"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621684560851"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621684560850"><span class="annot"><span class="annottext">Info (TypeBase (DimDecl VName) Aliasing)
</span><a href="#local-6989586621684560850"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621684560849"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560849"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1203"></span><span>      </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560852"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; f () -&gt; f Exp
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Info (TypeBase (DimDecl VName) Aliasing)
</span><a href="#local-6989586621684560850"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1204"></span><span>        </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span id="local-6989586621684560847"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684560847"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Integer -&gt; PrimType -&gt; SrcLoc -&gt; f ()
forall {f :: * -&gt; *} {loc} {a} {a}.
(MonadTypeChecker f, Located loc, Pretty a, Pretty a) =&gt;
Bool -&gt; a -&gt; a -&gt; loc -&gt; f ()
</span><a href="#local-6989586621684560846"><span class="hs-identifier hs-var">warnBounds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; PrimType -&gt; Bool
forall {a}. Integral a =&gt; a -&gt; PrimType -&gt; Bool
</span><a href="#local-6989586621684560845"><span class="hs-identifier hs-var">inBoundsI</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621684560851"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684560847"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621684560851"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684560847"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560849"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-1205"></span><span>        </span><span class="annot"><span class="annottext">Info (TypeBase (DimDecl VName) Aliasing)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; f ()
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Inferred type of int literal is not a number&quot;</span></span><span>
</span><span id="line-1206"></span><span>    </span><span class="annot"><a href="#local-6989586621684560895"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span id="local-6989586621684560844"><span class="annot"><span class="annottext">e :: Exp
</span><a href="#local-6989586621684560844"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#FloatLit"><span class="hs-identifier hs-type">FloatLit</span></a></span><span> </span><span id="local-6989586621684560843"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621684560843"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621684560842"><span class="annot"><span class="annottext">Info (TypeBase (DimDecl VName) Aliasing)
</span><a href="#local-6989586621684560842"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621684560841"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560841"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1207"></span><span>      </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560844"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; f () -&gt; f Exp
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Info (TypeBase (DimDecl VName) Aliasing)
</span><a href="#local-6989586621684560842"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1208"></span><span>        </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span id="local-6989586621684560839"><span class="annot"><span class="annottext">FloatType
</span><a href="#local-6989586621684560839"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Double -&gt; FloatType -&gt; SrcLoc -&gt; f ()
forall {f :: * -&gt; *} {loc} {a} {a}.
(MonadTypeChecker f, Located loc, Pretty a, Pretty a) =&gt;
Bool -&gt; a -&gt; a -&gt; loc -&gt; f ()
</span><a href="#local-6989586621684560846"><span class="hs-identifier hs-var">warnBounds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; FloatType -&gt; Bool
forall {a}. RealFloat a =&gt; a -&gt; FloatType -&gt; Bool
</span><a href="#local-6989586621684560838"><span class="hs-identifier hs-var">inBoundsF</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621684560843"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="#local-6989586621684560839"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621684560843"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="#local-6989586621684560839"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560841"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-1209"></span><span>        </span><span class="annot"><span class="annottext">Info (TypeBase (DimDecl VName) Aliasing)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; f ()
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Inferred type of float literal is not a float&quot;</span></span><span>
</span><span id="line-1210"></span><span>    </span><span class="annot"><a href="#local-6989586621684560895"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span id="local-6989586621684560837"><span class="annot"><span class="annottext">e :: Exp
</span><a href="#local-6989586621684560837"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Negate"><span class="hs-identifier hs-type">Negate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#IntLit"><span class="hs-identifier hs-type">IntLit</span></a></span><span> </span><span id="local-6989586621684560836"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621684560836"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621684560835"><span class="annot"><span class="annottext">Info (TypeBase (DimDecl VName) Aliasing)
</span><a href="#local-6989586621684560835"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621684560834"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560834"><span class="hs-identifier hs-var">loc1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684560833"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560833"><span class="hs-identifier hs-var">loc2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1211"></span><span>      </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560837"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; f () -&gt; f Exp
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Info (TypeBase (DimDecl VName) Aliasing)
</span><a href="#local-6989586621684560835"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1212"></span><span>        </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span id="local-6989586621684560832"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684560832"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Integer -&gt; PrimType -&gt; SrcLoc -&gt; f ()
forall {f :: * -&gt; *} {loc} {a} {a}.
(MonadTypeChecker f, Located loc, Pretty a, Pretty a) =&gt;
Bool -&gt; a -&gt; a -&gt; loc -&gt; f ()
</span><a href="#local-6989586621684560846"><span class="hs-identifier hs-var">warnBounds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; PrimType -&gt; Bool
forall {a}. Integral a =&gt; a -&gt; PrimType -&gt; Bool
</span><a href="#local-6989586621684560845"><span class="hs-identifier hs-var">inBoundsI</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621684560836"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684560832"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621684560836"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684560832"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560834"><span class="hs-identifier hs-var">loc1</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; SrcLoc -&gt; SrcLoc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560833"><span class="hs-identifier hs-var">loc2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1213"></span><span>        </span><span class="annot"><span class="annottext">Info (TypeBase (DimDecl VName) Aliasing)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; f ()
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Inferred type of int literal is not a number&quot;</span></span><span>
</span><span id="line-1214"></span><span>    </span><span class="annot"><a href="#local-6989586621684560895"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span id="local-6989586621684560831"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560831"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ASTMapper f -&gt; Exp -&gt; f Exp
forall x (m :: * -&gt; *).
(ASTMappable x, Monad m) =&gt;
ASTMapper m -&gt; x -&gt; m x
</span><a href="Language.Futhark.Traversals.html#astMap"><span class="hs-identifier hs-var">astMap</span></a></span><span> </span><span class="annot"><span class="annottext">ASTMapper f
forall (m :: * -&gt; *). Monad m =&gt; ASTMapper m
</span><a href="Language.Futhark.Traversals.html#identityMapper"><span class="hs-identifier hs-var">identityMapper</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">mapOnExp :: Exp -&gt; f Exp
</span><a href="Language.Futhark.Traversals.html#mapOnExp"><span class="hs-identifier hs-var">mapOnExp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; f Exp
</span><a href="#local-6989586621684560895"><span class="hs-identifier hs-var">check</span></a></span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560831"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1215"></span><span>    </span><span id="local-6989586621684560827"><span class="annot"><span class="annottext">bitWidth :: IntType -&gt; Int
</span><a href="#local-6989586621684560827"><span class="hs-identifier hs-var hs-var">bitWidth</span></a></span></span><span> </span><span id="local-6989586621684560826"><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684560826"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">IntType -&gt; Int
forall a. Num a =&gt; IntType -&gt; a
</span><a href="Futhark.IR.Primitive.html#intByteSize"><span class="hs-identifier hs-var">intByteSize</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684560826"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1216"></span><span>    </span><span id="local-6989586621684560845"><span class="annot"><span class="annottext">inBoundsI :: a -&gt; PrimType -&gt; Bool
</span><a href="#local-6989586621684560845"><span class="hs-identifier hs-var hs-var">inBoundsI</span></a></span></span><span> </span><span id="local-6989586621684560781"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560781"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Signed"><span class="hs-identifier hs-type">Signed</span></a></span><span> </span><span id="local-6989586621684560780"><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684560780"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560781"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Int -&gt; a
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntType -&gt; Int
</span><a href="#local-6989586621684560827"><span class="hs-identifier hs-var">bitWidth</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684560780"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560781"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Int -&gt; a
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntType -&gt; Int
</span><a href="#local-6989586621684560827"><span class="hs-identifier hs-var">bitWidth</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684560780"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1217"></span><span>    </span><span class="annot"><a href="#local-6989586621684560845"><span class="hs-identifier hs-var">inBoundsI</span></a></span><span> </span><span id="local-6989586621684560777"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560777"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Unsigned"><span class="hs-identifier hs-type">Unsigned</span></a></span><span> </span><span id="local-6989586621684560775"><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684560775"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560777"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560777"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Int -&gt; a
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span> </span><span class="annot"><span class="annottext">IntType -&gt; Int
</span><a href="#local-6989586621684560827"><span class="hs-identifier hs-var">bitWidth</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684560775"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1218"></span><span>    </span><span class="annot"><a href="#local-6989586621684560845"><span class="hs-identifier hs-var">inBoundsI</span></a></span><span> </span><span id="local-6989586621684560774"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560774"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float16"><span class="hs-identifier hs-var">Float16</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Half -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isInfinite</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Half
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560774"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Half</span></span><span class="hs-special">)</span><span>
</span><span id="line-1219"></span><span>    </span><span class="annot"><a href="#local-6989586621684560845"><span class="hs-identifier hs-var">inBoundsI</span></a></span><span> </span><span id="local-6989586621684560771"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560771"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float32"><span class="hs-identifier hs-var">Float32</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isInfinite</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Float
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560771"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span class="hs-special">)</span><span>
</span><span id="line-1220"></span><span>    </span><span class="annot"><a href="#local-6989586621684560845"><span class="hs-identifier hs-var">inBoundsI</span></a></span><span> </span><span id="local-6989586621684560769"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560769"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float64"><span class="hs-identifier hs-var">Float64</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isInfinite</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560769"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span>
</span><span id="line-1221"></span><span>    </span><span class="annot"><a href="#local-6989586621684560845"><span class="hs-identifier hs-var">inBoundsI</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Language.Futhark.Syntax.html#Bool"><span class="hs-identifier hs-var">Bool</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Inferred type of int literal is not a number&quot;</span></span><span>
</span><span id="line-1222"></span><span>    </span><span id="local-6989586621684560838"><span class="annot"><span class="annottext">inBoundsF :: a -&gt; FloatType -&gt; Bool
</span><a href="#local-6989586621684560838"><span class="hs-identifier hs-var hs-var">inBoundsF</span></a></span></span><span> </span><span id="local-6989586621684560754"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560754"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float16"><span class="hs-identifier hs-var">Float16</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isInfinite</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Float
forall a b. (Real a, Fractional b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">realToFrac</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560754"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span class="hs-special">)</span><span>
</span><span id="line-1223"></span><span>    </span><span class="annot"><a href="#local-6989586621684560838"><span class="hs-identifier hs-var">inBoundsF</span></a></span><span> </span><span id="local-6989586621684560753"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560753"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float32"><span class="hs-identifier hs-var">Float32</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isInfinite</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Float
forall a b. (Real a, Fractional b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">realToFrac</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560753"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span class="hs-special">)</span><span>
</span><span id="line-1224"></span><span>    </span><span class="annot"><a href="#local-6989586621684560838"><span class="hs-identifier hs-var">inBoundsF</span></a></span><span> </span><span id="local-6989586621684560752"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560752"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float64"><span class="hs-identifier hs-var">Float64</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isInfinite</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560752"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1225"></span><span>    </span><span id="local-6989586621684560846"><span class="annot"><span class="annottext">warnBounds :: Bool -&gt; a -&gt; a -&gt; loc -&gt; f ()
</span><a href="#local-6989586621684560846"><span class="hs-identifier hs-var hs-var">warnBounds</span></a></span></span><span> </span><span id="local-6989586621684560731"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684560731"><span class="hs-identifier hs-var">inBounds</span></a></span></span><span> </span><span id="local-6989586621684560730"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560730"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621684560729"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560729"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621684560728"><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621684560728"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1226"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; f () -&gt; f ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684560731"><span class="hs-identifier hs-var">inBounds</span></a></span><span> </span><span class="annot"><span class="annottext">(f () -&gt; f ()) -&gt; f () -&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1227"></span><span>        </span><span class="annot"><span class="annottext">loc -&gt; Notes -&gt; Doc -&gt; f ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621684560728"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; f ()) -&gt; (Doc -&gt; Doc) -&gt; Doc -&gt; f ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Language.Futhark.TypeChecker.Monad.html#withIndexLink"><span class="hs-identifier hs-var">withIndexLink</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;literal-out-of-bounds&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; f ()) -&gt; Doc -&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1228"></span><span>          </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Literal &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560730"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1229"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot; out of bounds for inferred type &quot;</span></span><span>
</span><span id="line-1230"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560729"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1231"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-1232"></span><span>
</span><span id="line-1233"></span><span class="hs-comment">-- | Type-check a top-level (or module-level) function definition.</span><span>
</span><span id="line-1234"></span><span class="hs-comment">-- Despite the name, this is also used for checking constant</span><span>
</span><span id="line-1235"></span><span class="hs-comment">-- definitions, by treating them as 0-ary functions.</span><span>
</span><span id="line-1236"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkFunDef"><span class="hs-identifier hs-type">checkFunDef</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1237"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1238"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedTypeExp"><span class="hs-identifier hs-type">UncheckedTypeExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1239"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedTypeParam"><span class="hs-identifier hs-type">UncheckedTypeParam</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1240"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedPat"><span class="hs-identifier hs-type">UncheckedPat</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1241"></span><span>    </span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedExp"><span class="hs-identifier hs-type">UncheckedExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1242"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span>
</span><span id="line-1243"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1244"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span>
</span><span id="line-1245"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1246"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#TypeParam"><span class="hs-identifier hs-type">TypeParam</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1247"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1248"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeExp"><span class="hs-identifier hs-type">TypeExp</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1249"></span><span>      </span><span class="annot"><a href="Language.Futhark.Syntax.html#StructRetType"><span class="hs-identifier hs-type">StructRetType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1250"></span><span>      </span><span class="annot"><a href="Language.Futhark.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-1251"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-1252"></span><span id="checkFunDef"><span class="annot"><span class="annottext">checkFunDef :: (Name, Maybe UncheckedTypeExp, [TypeParamBase Name],
 [PatBase NoInfo Name], ExpBase NoInfo Name, SrcLoc)
-&gt; TypeM
     (VName, [TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkFunDef"><span class="hs-identifier hs-var hs-var">checkFunDef</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684560725"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684560725"><span class="hs-identifier hs-var">fname</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560724"><span class="annot"><span class="annottext">Maybe UncheckedTypeExp
</span><a href="#local-6989586621684560724"><span class="hs-identifier hs-var">maybe_retdecl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560723"><span class="annot"><span class="annottext">[TypeParamBase Name]
</span><a href="#local-6989586621684560723"><span class="hs-identifier hs-var">tparams</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560722"><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684560722"><span class="hs-identifier hs-var">params</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560721"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684560721"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560720"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560720"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1253"></span><span>  </span><span class="annot"><span class="annottext">(((VName, [TypeParamBase VName], [PatBase Info VName],
   Maybe (TypeExp VName), StructRetType, Exp),
  Occurrences)
 -&gt; (VName, [TypeParamBase VName], [PatBase Info VName],
     Maybe (TypeExp VName), StructRetType, Exp))
-&gt; TypeM
     ((VName, [TypeParamBase VName], [PatBase Info VName],
       Maybe (TypeExp VName), StructRetType, Exp),
      Occurrences)
-&gt; TypeM
     (VName, [TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((VName, [TypeParamBase VName], [PatBase Info VName],
  Maybe (TypeExp VName), StructRetType, Exp),
 Occurrences)
-&gt; (VName, [TypeParamBase VName], [PatBase Info VName],
    Maybe (TypeExp VName), StructRetType, Exp)
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(TypeM
   ((VName, [TypeParamBase VName], [PatBase Info VName],
     Maybe (TypeExp VName), StructRetType, Exp),
    Occurrences)
 -&gt; TypeM
      (VName, [TypeParamBase VName], [PatBase Info VName],
       Maybe (TypeExp VName), StructRetType, Exp))
-&gt; (TermTypeM
      (VName, [TypeParamBase VName], [PatBase Info VName],
       Maybe (TypeExp VName), StructRetType, Exp)
    -&gt; TypeM
         ((VName, [TypeParamBase VName], [PatBase Info VName],
           Maybe (TypeExp VName), StructRetType, Exp),
          Occurrences))
-&gt; TermTypeM
     (VName, [TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
-&gt; TypeM
     (VName, [TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TermTypeM
  (VName, [TypeParamBase VName], [PatBase Info VName],
   Maybe (TypeExp VName), StructRetType, Exp)
-&gt; TypeM
     ((VName, [TypeParamBase VName], [PatBase Info VName],
       Maybe (TypeExp VName), StructRetType, Exp),
      Occurrences)
forall a. TermTypeM a -&gt; TypeM (a, Occurrences)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#runTermTypeM"><span class="hs-identifier hs-var">runTermTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">(TermTypeM
   (VName, [TypeParamBase VName], [PatBase Info VName],
    Maybe (TypeExp VName), StructRetType, Exp)
 -&gt; TypeM
      (VName, [TypeParamBase VName], [PatBase Info VName],
       Maybe (TypeExp VName), StructRetType, Exp))
-&gt; TermTypeM
     (VName, [TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
-&gt; TypeM
     (VName, [TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1254"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684560719"><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684560719"><span class="hs-identifier hs-var">tparams'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560718"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560718"><span class="hs-identifier hs-var">params'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560717"><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684560717"><span class="hs-identifier hs-var">maybe_retdecl'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-type">RetType</span></a></span><span> </span><span id="local-6989586621684560716"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684560716"><span class="hs-identifier hs-var">dims</span></a></span></span><span> </span><span id="local-6989586621684560715"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560715"><span class="hs-identifier hs-var">rettype'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560714"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560714"><span class="hs-identifier hs-var">body'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1255"></span><span>      </span><span class="annot"><span class="annottext">(Name, Maybe UncheckedTypeExp, [TypeParamBase Name],
 [PatBase NoInfo Name], ExpBase NoInfo Name, SrcLoc)
-&gt; TermTypeM
     ([TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkBinding"><span class="hs-identifier hs-var">checkBinding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684560725"><span class="hs-identifier hs-var">fname</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe UncheckedTypeExp
</span><a href="#local-6989586621684560724"><span class="hs-identifier hs-var">maybe_retdecl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TypeParamBase Name]
</span><a href="#local-6989586621684560723"><span class="hs-identifier hs-var">tparams</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684560722"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684560721"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560720"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1256"></span><span>
</span><span id="line-1257"></span><span>    </span><span class="hs-comment">-- Since this is a top-level function, we also resolve overloaded</span><span>
</span><span id="line-1258"></span><span>    </span><span class="hs-comment">-- types, using either defaults or complaining about ambiguities.</span><span>
</span><span id="line-1259"></span><span>    </span><span class="annot"><span class="annottext">Set VName -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#fixOverloadedTypes"><span class="hs-identifier hs-var">fixOverloadedTypes</span></a></span><span> </span><span class="annot"><span class="annottext">(Set VName -&gt; TermTypeM ()) -&gt; Set VName -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1260"></span><span>      </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; Set VName
forall as dim. Monoid as =&gt; TypeBase dim as -&gt; Set VName
</span><a href="Language.Futhark.Prop.html#typeVars"><span class="hs-identifier hs-var">typeVars</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560715"><span class="hs-identifier hs-var">rettype'</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; Set VName)
-&gt; [PatBase Info VName] -&gt; Set VName
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Set VName
forall as dim. Monoid as =&gt; TypeBase dim as -&gt; Set VName
</span><a href="Language.Futhark.Prop.html#typeVars"><span class="hs-identifier hs-var">typeVars</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing -&gt; Set VName)
-&gt; (PatBase Info VName -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; PatBase Info VName
-&gt; Set VName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; TypeBase (DimDecl VName) Aliasing
</span><a href="Language.Futhark.Prop.html#patternType"><span class="hs-identifier hs-var">patternType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560718"><span class="hs-identifier hs-var">params'</span></a></span><span>
</span><span id="line-1261"></span><span>
</span><span id="line-1262"></span><span>    </span><span class="hs-comment">-- Then replace all inferred types in the body and parameters.</span><span>
</span><span id="line-1263"></span><span>    </span><span id="local-6989586621684560713"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560713"><span class="hs-identifier hs-var">body''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall e. ASTMappable e =&gt; e -&gt; TermTypeM e
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#updateTypes"><span class="hs-identifier hs-var">updateTypes</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560714"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-1264"></span><span>    </span><span id="local-6989586621684560712"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560712"><span class="hs-identifier hs-var">params''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName] -&gt; TermTypeM [PatBase Info VName]
forall e. ASTMappable e =&gt; e -&gt; TermTypeM e
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#updateTypes"><span class="hs-identifier hs-var">updateTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560718"><span class="hs-identifier hs-var">params'</span></a></span><span>
</span><span id="line-1265"></span><span>    </span><span id="local-6989586621684560711"><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684560711"><span class="hs-identifier hs-var">maybe_retdecl''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TypeExp VName -&gt; TermTypeM (TypeExp VName))
-&gt; Maybe (TypeExp VName) -&gt; TermTypeM (Maybe (TypeExp VName))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">TypeExp VName -&gt; TermTypeM (TypeExp VName)
forall e. ASTMappable e =&gt; e -&gt; TermTypeM e
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#updateTypes"><span class="hs-identifier hs-var">updateTypes</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684560717"><span class="hs-identifier hs-var">maybe_retdecl'</span></a></span><span>
</span><span id="line-1266"></span><span>    </span><span id="local-6989586621684560710"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560710"><span class="hs-identifier hs-var">rettype''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall a (m :: * -&gt; *). (Substitutable a, MonadUnify m) =&gt; a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Unify.html#normTypeFully"><span class="hs-identifier hs-var">normTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560715"><span class="hs-identifier hs-var">rettype'</span></a></span><span>
</span><span id="line-1267"></span><span>
</span><span id="line-1268"></span><span>    </span><span class="hs-comment">-- Check if pattern matches are exhaustive and yield</span><span>
</span><span id="line-1269"></span><span>    </span><span class="hs-comment">-- errors if not.</span><span>
</span><span id="line-1270"></span><span>    </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkUnmatched"><span class="hs-identifier hs-var">checkUnmatched</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560713"><span class="hs-identifier hs-var">body''</span></a></span><span>
</span><span id="line-1271"></span><span>
</span><span id="line-1272"></span><span>    </span><span class="hs-comment">-- Check if the function body can actually be evaluated.</span><span>
</span><span id="line-1273"></span><span>    </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#causalityCheck"><span class="hs-identifier hs-var">causalityCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560713"><span class="hs-identifier hs-var">body''</span></a></span><span>
</span><span id="line-1274"></span><span>
</span><span id="line-1275"></span><span>    </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#literalOverflowCheck"><span class="hs-identifier hs-var">literalOverflowCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560713"><span class="hs-identifier hs-var">body''</span></a></span><span>
</span><span id="line-1276"></span><span>
</span><span id="line-1277"></span><span>    </span><span class="annot"><span class="annottext">[(Namespace, Name)]
-&gt; TermTypeM
     (VName, [TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
-&gt; TermTypeM
     (VName, [TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
[(Namespace, Name)] -&gt; m a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#bindSpaced"><span class="hs-identifier hs-var">bindSpaced</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684560725"><span class="hs-identifier hs-var">fname</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TermTypeM
   (VName, [TypeParamBase VName], [PatBase Info VName],
    Maybe (TypeExp VName), StructRetType, Exp)
 -&gt; TermTypeM
      (VName, [TypeParamBase VName], [PatBase Info VName],
       Maybe (TypeExp VName), StructRetType, Exp))
-&gt; TermTypeM
     (VName, [TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
-&gt; TermTypeM
     (VName, [TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1278"></span><span>      </span><span id="local-6989586621684560709"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560709"><span class="hs-identifier hs-var">fname'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Namespace -&gt; Name -&gt; SrcLoc -&gt; TermTypeM VName
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
Namespace -&gt; Name -&gt; SrcLoc -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Monad.html#checkName"><span class="hs-identifier hs-var">checkName</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684560725"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560720"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-1279"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TermTypeM () -&gt; TermTypeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; String
</span><a href="Language.Futhark.Core.html#nameToString"><span class="hs-identifier hs-var">nameToString</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684560725"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#doNotShadow"><span class="hs-identifier hs-var">doNotShadow</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM () -&gt; TermTypeM ()) -&gt; TermTypeM () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1280"></span><span>        </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TermTypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560720"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM ()) -&gt; (Doc -&gt; Doc) -&gt; Doc -&gt; TermTypeM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Language.Futhark.TypeChecker.Monad.html#withIndexLink"><span class="hs-identifier hs-var">withIndexLink</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;may-not-be-redefined&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM ()) -&gt; Doc -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1281"></span><span>          </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;The&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Doc
forall v. IsName v =&gt; v -&gt; Doc
</span><a href="Language.Futhark.Pretty.html#pprName"><span class="hs-identifier hs-var">pprName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684560725"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;operator may not be redefined.&quot;</span></span><span>
</span><span id="line-1282"></span><span>
</span><span id="line-1283"></span><span>      </span><span class="annot"><span class="annottext">(VName, [TypeParamBase VName], [PatBase Info VName],
 Maybe (TypeExp VName), StructRetType, Exp)
-&gt; TermTypeM
     (VName, [TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560709"><span class="hs-identifier hs-var">fname'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684560719"><span class="hs-identifier hs-var">tparams'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560712"><span class="hs-identifier hs-var">params''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684560711"><span class="hs-identifier hs-var">maybe_retdecl''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; TypeBase (DimDecl VName) () -&gt; StructRetType
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684560716"><span class="hs-identifier hs-var">dims</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560710"><span class="hs-identifier hs-var">rettype''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560713"><span class="hs-identifier hs-var">body''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1284"></span><span>
</span><span id="line-1285"></span><span class="hs-comment">-- | This is &quot;fixing&quot; as in &quot;setting them&quot;, not &quot;correcting them&quot;.  We</span><span>
</span><span id="line-1286"></span><span class="hs-comment">-- only make very conservative fixing.</span><span>
</span><span id="line-1287"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#fixOverloadedTypes"><span class="hs-identifier hs-type">fixOverloadedTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Names"><span class="hs-identifier hs-type">Names</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1288"></span><span id="fixOverloadedTypes"><span class="annot"><span class="annottext">fixOverloadedTypes :: Set VName -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#fixOverloadedTypes"><span class="hs-identifier hs-var hs-var">fixOverloadedTypes</span></a></span></span><span> </span><span id="local-6989586621684560706"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560706"><span class="hs-identifier hs-var">tyvars_at_toplevel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1289"></span><span>  </span><span class="annot"><span class="annottext">TermTypeM Constraints
forall (m :: * -&gt; *). MonadUnify m =&gt; m Constraints
</span><a href="Language.Futhark.TypeChecker.Unify.html#getConstraints"><span class="hs-identifier hs-var">getConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM Constraints
-&gt; (Constraints -&gt; TermTypeM ()) -&gt; TermTypeM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">((VName, Constraint) -&gt; TermTypeM ())
-&gt; [(VName, Constraint)] -&gt; TermTypeM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">(VName, Constraint) -&gt; TermTypeM ()
forall {m :: * -&gt; *}.
(MonadUnify m, MonadTypeChecker m) =&gt;
(VName, Constraint) -&gt; m ()
</span><a href="#local-6989586621684560704"><span class="hs-identifier hs-var">fixOverloaded</span></a></span><span> </span><span class="annot"><span class="annottext">([(VName, Constraint)] -&gt; TermTypeM ())
-&gt; (Constraints -&gt; [(VName, Constraint)])
-&gt; Constraints
-&gt; TermTypeM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map VName Constraint -&gt; [(VName, Constraint)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map VName Constraint -&gt; [(VName, Constraint)])
-&gt; (Constraints -&gt; Map VName Constraint)
-&gt; Constraints
-&gt; [(VName, Constraint)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Int, Constraint) -&gt; Constraint)
-&gt; Constraints -&gt; Map VName Constraint
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="annot"><span class="annottext">(Int, Constraint) -&gt; Constraint
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span>
</span><span id="line-1290"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1291"></span><span>    </span><span id="local-6989586621684560704"><span class="annot"><span class="annottext">fixOverloaded :: (VName, Constraint) -&gt; m ()
</span><a href="#local-6989586621684560704"><span class="hs-identifier hs-var hs-var">fixOverloaded</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684560629"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560629"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#Overloaded"><span class="hs-identifier hs-type">Overloaded</span></a></span><span> </span><span id="local-6989586621684560628"><span class="annot"><span class="annottext">[PrimType]
</span><a href="#local-6989586621684560628"><span class="hs-identifier hs-var">ots</span></a></span></span><span> </span><span id="local-6989586621684560627"><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560627"><span class="hs-identifier hs-var">usage</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1292"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Language.Futhark.Syntax.html#Signed"><span class="hs-identifier hs-var">Signed</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int32"><span class="hs-identifier hs-var">Int32</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; [PrimType] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[PrimType]
</span><a href="#local-6989586621684560628"><span class="hs-identifier hs-var">ots</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1293"></span><span>        </span><span class="annot"><span class="annottext">Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; m ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560627"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">()
-&gt; Uniqueness
-&gt; TypeName
-&gt; [TypeArg (DimDecl VName)]
-&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as.
as
-&gt; Uniqueness -&gt; TypeName -&gt; [TypeArg dim] -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Nonunique"><span class="hs-identifier hs-var">Nonunique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; TypeName
</span><a href="Language.Futhark.Prop.html#typeName"><span class="hs-identifier hs-var">typeName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560629"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) () -&gt; m ())
-&gt; TypeBase (DimDecl VName) () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1294"></span><span>          </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ())
-&gt; ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as. PrimType -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimType -&gt; ScalarTypeBase (DimDecl VName) ())
-&gt; PrimType -&gt; ScalarTypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Language.Futhark.Syntax.html#Signed"><span class="hs-identifier hs-var">Signed</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int32"><span class="hs-identifier hs-var">Int32</span></a></span><span>
</span><span id="line-1295"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560629"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560706"><span class="hs-identifier hs-var">tyvars_at_toplevel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1296"></span><span>          </span><span class="annot"><span class="annottext">Usage -&gt; Doc -&gt; m ()
forall (m :: * -&gt; *) loc.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Doc -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Monad.html#warn"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560627"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Defaulting ambiguous type to i32.&quot;</span></span><span>
</span><span id="line-1297"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FloatType -&gt; PrimType
</span><a href="Language.Futhark.Syntax.html#FloatType"><span class="hs-identifier hs-var">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float64"><span class="hs-identifier hs-var">Float64</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; [PrimType] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[PrimType]
</span><a href="#local-6989586621684560628"><span class="hs-identifier hs-var">ots</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1298"></span><span>        </span><span class="annot"><span class="annottext">Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; m ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560627"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">()
-&gt; Uniqueness
-&gt; TypeName
-&gt; [TypeArg (DimDecl VName)]
-&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as.
as
-&gt; Uniqueness -&gt; TypeName -&gt; [TypeArg dim] -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Nonunique"><span class="hs-identifier hs-var">Nonunique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; TypeName
</span><a href="Language.Futhark.Prop.html#typeName"><span class="hs-identifier hs-var">typeName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560629"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) () -&gt; m ())
-&gt; TypeBase (DimDecl VName) () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1299"></span><span>          </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ())
-&gt; ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as. PrimType -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimType -&gt; ScalarTypeBase (DimDecl VName) ())
-&gt; PrimType -&gt; ScalarTypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FloatType -&gt; PrimType
</span><a href="Language.Futhark.Syntax.html#FloatType"><span class="hs-identifier hs-var">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float64"><span class="hs-identifier hs-var">Float64</span></a></span><span>
</span><span id="line-1300"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560629"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560706"><span class="hs-identifier hs-var">tyvars_at_toplevel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1301"></span><span>          </span><span class="annot"><span class="annottext">Usage -&gt; Doc -&gt; m ()
forall (m :: * -&gt; *) loc.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Doc -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Monad.html#warn"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560627"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Defaulting ambiguous type to f64.&quot;</span></span><span>
</span><span id="line-1302"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1303"></span><span>        </span><span class="annot"><span class="annottext">Usage -&gt; Notes -&gt; Doc -&gt; m ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560627"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; m ()) -&gt; (Doc -&gt; Doc) -&gt; Doc -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Language.Futhark.TypeChecker.Monad.html#withIndexLink"><span class="hs-identifier hs-var">withIndexLink</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;ambiguous-type&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; m ()) -&gt; Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1304"></span><span>          </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Type is ambiguous (could be one of&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
</span><span class="hs-identifier hs-var">commasep</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PrimType -&gt; Doc) -&gt; [PrimType] -&gt; [Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">[PrimType]
</span><a href="#local-6989586621684560628"><span class="hs-identifier hs-var">ots</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;).&quot;</span></span><span>
</span><span id="line-1305"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Add a type annotation to disambiguate the type.&quot;</span></span><span>
</span><span id="line-1306"></span><span>    </span><span class="annot"><a href="#local-6989586621684560704"><span class="hs-identifier hs-var">fixOverloaded</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684560624"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560624"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#NoConstraint"><span class="hs-identifier hs-type">NoConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684560622"><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560622"><span class="hs-identifier hs-var">usage</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1307"></span><span>      </span><span class="hs-comment">-- See #1552.</span><span>
</span><span id="line-1308"></span><span>      </span><span class="annot"><span class="annottext">Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; m ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560622"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">()
-&gt; Uniqueness
-&gt; TypeName
-&gt; [TypeArg (DimDecl VName)]
-&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as.
as
-&gt; Uniqueness -&gt; TypeName -&gt; [TypeArg dim] -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Nonunique"><span class="hs-identifier hs-var">Nonunique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; TypeName
</span><a href="Language.Futhark.Prop.html#typeName"><span class="hs-identifier hs-var">typeName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560624"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) () -&gt; m ())
-&gt; TypeBase (DimDecl VName) () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1309"></span><span>        </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ())
-&gt; ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TypeBase (DimDecl VName) ()] -&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as. [TypeBase dim as] -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Prop.html#tupleRecord"><span class="hs-identifier hs-var">tupleRecord</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1310"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560624"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560706"><span class="hs-identifier hs-var">tyvars_at_toplevel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1311"></span><span>        </span><span class="annot"><span class="annottext">Usage -&gt; Doc -&gt; m ()
forall (m :: * -&gt; *) loc.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Doc -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Monad.html#warn"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560622"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Defaulting ambiguous type to ().&quot;</span></span><span>
</span><span id="line-1312"></span><span>    </span><span class="annot"><a href="#local-6989586621684560704"><span class="hs-identifier hs-var">fixOverloaded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#Equality"><span class="hs-identifier hs-type">Equality</span></a></span><span> </span><span id="local-6989586621684560619"><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560619"><span class="hs-identifier hs-var">usage</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1313"></span><span>      </span><span class="annot"><span class="annottext">Usage -&gt; Notes -&gt; Doc -&gt; m ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560619"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; m ()) -&gt; (Doc -&gt; Doc) -&gt; Doc -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Language.Futhark.TypeChecker.Monad.html#withIndexLink"><span class="hs-identifier hs-var">withIndexLink</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;ambiguous-type&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; m ()) -&gt; Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1314"></span><span>        </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Type is ambiguous (must be equality type).&quot;</span></span><span>
</span><span id="line-1315"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Add a type annotation to disambiguate the type.&quot;</span></span><span>
</span><span id="line-1316"></span><span>    </span><span class="annot"><a href="#local-6989586621684560704"><span class="hs-identifier hs-var">fixOverloaded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#HasFields"><span class="hs-identifier hs-type">HasFields</span></a></span><span> </span><span id="local-6989586621684560618"><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) ())
</span><a href="#local-6989586621684560618"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621684560617"><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560617"><span class="hs-identifier hs-var">usage</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1317"></span><span>      </span><span class="annot"><span class="annottext">Usage -&gt; Notes -&gt; Doc -&gt; m ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560617"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; m ()) -&gt; (Doc -&gt; Doc) -&gt; Doc -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Language.Futhark.TypeChecker.Monad.html#withIndexLink"><span class="hs-identifier hs-var">withIndexLink</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;ambiguous-type&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; m ()) -&gt; Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1318"></span><span>        </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Type is ambiguous.  Must be record with fields:&quot;</span></span><span>
</span><span id="line-1319"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
</span><span class="hs-identifier hs-var">indent</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
</span><span class="hs-identifier hs-var">stack</span></span><span> </span><span class="annot"><span class="annottext">([Doc] -&gt; Doc) -&gt; [Doc] -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Name, TypeBase (DimDecl VName) ()) -&gt; Doc)
-&gt; [(Name, TypeBase (DimDecl VName) ())] -&gt; [Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Name, TypeBase (DimDecl VName) ()) -&gt; Doc
forall {a} {a}. (Pretty a, Pretty a) =&gt; (a, a) -&gt; Doc
</span><a href="#local-6989586621684560616"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">([(Name, TypeBase (DimDecl VName) ())] -&gt; [Doc])
-&gt; [(Name, TypeBase (DimDecl VName) ())] -&gt; [Doc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) ())
-&gt; [(Name, TypeBase (DimDecl VName) ())]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) ())
</span><a href="#local-6989586621684560618"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1320"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Add a type annotation to disambiguate the type.&quot;</span></span><span>
</span><span id="line-1321"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1322"></span><span>        </span><span id="local-6989586621684560616"><span class="annot"><span class="annottext">field :: (a, a) -&gt; Doc
</span><a href="#local-6989586621684560616"><span class="hs-identifier hs-var hs-var">field</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684560610"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560610"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560609"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560609"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560610"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-identifier hs-var">colon</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><span class="hs-identifier hs-var">align</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684560609"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1323"></span><span>    </span><span class="annot"><a href="#local-6989586621684560704"><span class="hs-identifier hs-var">fixOverloaded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#HasConstrs"><span class="hs-identifier hs-type">HasConstrs</span></a></span><span> </span><span id="local-6989586621684560607"><span class="annot"><span class="annottext">Map Name [TypeBase (DimDecl VName) ()]
</span><a href="#local-6989586621684560607"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621684560606"><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560606"><span class="hs-identifier hs-var">usage</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1324"></span><span>      </span><span class="annot"><span class="annottext">Usage -&gt; Notes -&gt; Doc -&gt; m ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560606"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; m ()) -&gt; (Doc -&gt; Doc) -&gt; Doc -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Language.Futhark.TypeChecker.Monad.html#withIndexLink"><span class="hs-identifier hs-var">withIndexLink</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;ambiguous-type&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; m ()) -&gt; Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1325"></span><span>        </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Type is ambiguous (must be a sum type with constructors:&quot;</span></span><span>
</span><span id="line-1326"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name [TypeBase (DimDecl VName) ()]
-&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as. Map Name [TypeBase dim as] -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Sum"><span class="hs-identifier hs-var">Sum</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name [TypeBase (DimDecl VName) ()]
</span><a href="#local-6989586621684560607"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;).&quot;</span></span><span>
</span><span id="line-1327"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Add a type annotation to disambiguate the type.&quot;</span></span><span>
</span><span id="line-1328"></span><span>    </span><span class="annot"><a href="#local-6989586621684560704"><span class="hs-identifier hs-var">fixOverloaded</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684560605"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560605"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (DimDecl VName)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span id="local-6989586621684560603"><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560603"><span class="hs-identifier hs-var">usage</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1329"></span><span>      </span><span class="annot"><span class="annottext">Usage -&gt; Notes -&gt; Doc -&gt; m ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560603"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; m ()) -&gt; Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Size&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Doc
forall v. IsName v =&gt; v -&gt; Doc
</span><a href="Language.Futhark.Pretty.html#pprName"><span class="hs-identifier hs-var">pprName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560605"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;is ambiguous.\n&quot;</span></span><span>
</span><span id="line-1330"></span><span>    </span><span class="annot"><a href="#local-6989586621684560704"><span class="hs-identifier hs-var">fixOverloaded</span></a></span><span> </span><span class="annot"><span class="annottext">(VName, Constraint)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1331"></span><span>
</span><span id="line-1332"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#hiddenParamNames"><span class="hs-identifier hs-type">hiddenParamNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Names"><span class="hs-identifier hs-type">Names</span></a></span><span>
</span><span id="line-1333"></span><span id="hiddenParamNames"><span class="annot"><span class="annottext">hiddenParamNames :: [PatBase Info VName] -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#hiddenParamNames"><span class="hs-identifier hs-var hs-var">hiddenParamNames</span></a></span></span><span> </span><span id="local-6989586621684560601"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560601"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560600"><span class="hs-identifier hs-var">hidden</span></a></span><span>
</span><span id="line-1334"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1335"></span><span>    </span><span id="local-6989586621684560595"><span class="annot"><span class="annottext">param_all_names :: Set VName
</span><a href="#local-6989586621684560595"><span class="hs-identifier hs-var hs-var">param_all_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Set VName] -&gt; Set VName
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Set VName] -&gt; Set VName) -&gt; [Set VName] -&gt; Set VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; Set VName)
-&gt; [PatBase Info VName] -&gt; [Set VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Set VName
forall (f :: * -&gt; *) vn.
(Functor f, Ord vn) =&gt;
PatBase f vn -&gt; Set vn
</span><a href="Language.Futhark.Prop.html#patNames"><span class="hs-identifier hs-var">patNames</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560601"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-1336"></span><span>    </span><span id="local-6989586621684560594"><span class="annot"><span class="annottext">named :: (PName, b) -&gt; Maybe VName
</span><a href="#local-6989586621684560594"><span class="hs-identifier hs-var hs-var">named</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span id="local-6989586621684560593"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560593"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Maybe VName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560593"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1337"></span><span>    </span><span class="annot"><a href="#local-6989586621684560594"><span class="hs-identifier hs-var">named</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PName
</span><a href="Language.Futhark.Syntax.html#Unnamed"><span class="hs-identifier hs-var">Unnamed</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe VName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1338"></span><span>    </span><span id="local-6989586621684560591"><span class="annot"><span class="annottext">param_names :: Set VName
</span><a href="#local-6989586621684560591"><span class="hs-identifier hs-var hs-var">param_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1339"></span><span>      </span><span class="annot"><span class="annottext">[VName] -&gt; Set VName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; Set VName) -&gt; [VName] -&gt; Set VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; Maybe VName)
-&gt; [PatBase Info VName] -&gt; [VName]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PName, TypeBase (DimDecl VName) ()) -&gt; Maybe VName
forall {b}. (PName, b) -&gt; Maybe VName
</span><a href="#local-6989586621684560594"><span class="hs-identifier hs-var">named</span></a></span><span> </span><span class="annot"><span class="annottext">((PName, TypeBase (DimDecl VName) ()) -&gt; Maybe VName)
-&gt; (PatBase Info VName -&gt; (PName, TypeBase (DimDecl VName) ()))
-&gt; PatBase Info VName
-&gt; Maybe VName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; (PName, TypeBase (DimDecl VName) ())
</span><a href="Language.Futhark.Prop.html#patternParam"><span class="hs-identifier hs-var">patternParam</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560601"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-1340"></span><span>    </span><span id="local-6989586621684560600"><span class="annot"><span class="annottext">hidden :: Set VName
</span><a href="#local-6989586621684560600"><span class="hs-identifier hs-var hs-var">hidden</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560595"><span class="hs-identifier hs-var">param_all_names</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`S.difference`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560591"><span class="hs-identifier hs-var">param_names</span></a></span><span>
</span><span id="line-1341"></span><span>
</span><span id="line-1342"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#inferredReturnType"><span class="hs-identifier hs-type">inferredReturnType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#StructType"><span class="hs-identifier hs-type">StructType</span></a></span><span>
</span><span id="line-1343"></span><span id="inferredReturnType"><span class="annot"><span class="annottext">inferredReturnType :: SrcLoc
-&gt; [PatBase Info VName]
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
</span><a href="Language.Futhark.TypeChecker.Terms.html#inferredReturnType"><span class="hs-identifier hs-var hs-var">inferredReturnType</span></a></span></span><span> </span><span id="local-6989586621684560588"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560588"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621684560587"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560587"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621684560586"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560586"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1344"></span><span>  </span><span class="hs-comment">-- The inferred type may refer to names that are bound by the</span><span>
</span><span id="line-1345"></span><span>  </span><span class="hs-comment">-- parameter patterns, but which will not be visible in the type.</span><span>
</span><span id="line-1346"></span><span>  </span><span class="hs-comment">-- These we must turn into fresh type variables, which will be</span><span>
</span><span id="line-1347"></span><span>  </span><span class="hs-comment">-- existential in the return type.</span><span>
</span><span id="line-1348"></span><span>  </span><span class="annot"><span class="annottext">((TypeBase (DimDecl VName) Aliasing, [VName])
 -&gt; TypeBase (DimDecl VName) ())
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ())
-&gt; ((TypeBase (DimDecl VName) Aliasing, [VName])
    -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; (TypeBase (DimDecl VName) Aliasing, [VName])
-&gt; TypeBase (DimDecl VName) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing, [VName])
-&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
 -&gt; TermTypeM (TypeBase (DimDecl VName) ()))
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1349"></span><span>    </span><span class="annot"><span class="annottext">SrcLoc
-&gt; Map VName (IdentBase Info VName)
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#unscopeType"><span class="hs-identifier hs-var">unscopeType</span></a></span><span>
</span><span id="line-1350"></span><span>      </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560588"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-1351"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(VName -&gt; IdentBase Info VName -&gt; Bool)
-&gt; Map VName (IdentBase Info VName)
-&gt; Map VName (IdentBase Info VName)
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; IdentBase Info VName -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; IdentBase Info VName -&gt; Bool)
-&gt; (VName -&gt; Bool) -&gt; VName -&gt; IdentBase Info VName -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560585"><span class="hs-identifier hs-var">hidden</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Map VName (IdentBase Info VName)
 -&gt; Map VName (IdentBase Info VName))
-&gt; Map VName (IdentBase Info VName)
-&gt; Map VName (IdentBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; Map VName (IdentBase Info VName))
-&gt; [PatBase Info VName] -&gt; Map VName (IdentBase Info VName)
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Map VName (IdentBase Info VName)
forall (f :: * -&gt; *).
Functor f =&gt;
PatBase f VName -&gt; Map VName (IdentBase f VName)
</span><a href="Language.Futhark.Prop.html#patternMap"><span class="hs-identifier hs-var">patternMap</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560587"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1352"></span><span>      </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName]))
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
</span><a href="Language.Futhark.TypeChecker.Terms.html#inferReturnUniqueness"><span class="hs-identifier hs-var">inferReturnUniqueness</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560587"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560586"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1353"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1354"></span><span>    </span><span id="local-6989586621684560585"><span class="annot"><span class="annottext">hidden :: Set VName
</span><a href="#local-6989586621684560585"><span class="hs-identifier hs-var hs-var">hidden</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName] -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#hiddenParamNames"><span class="hs-identifier hs-var">hiddenParamNames</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560587"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-1355"></span><span>
</span><span id="line-1356"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkReturnAlias"><span class="hs-identifier hs-type">checkReturnAlias</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1357"></span><span id="checkReturnAlias"><span class="annot"><span class="annottext">checkReturnAlias :: SrcLoc
-&gt; TypeBase () ()
-&gt; [PatBase Info VName]
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkReturnAlias"><span class="hs-identifier hs-var hs-var">checkReturnAlias</span></a></span></span><span> </span><span id="local-6989586621684560584"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560584"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621684560583"><span class="annot"><span class="annottext">TypeBase () ()
</span><a href="#local-6989586621684560583"><span class="hs-identifier hs-var">rettp</span></a></span></span><span> </span><span id="local-6989586621684560582"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560582"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1358"></span><span>  </span><span class="annot"><span class="annottext">(Set (Uniqueness, VName)
 -&gt; (Uniqueness, Set VName) -&gt; TermTypeM (Set (Uniqueness, VName)))
-&gt; Set (Uniqueness, VName)
-&gt; [(Uniqueness, Set VName)]
-&gt; TermTypeM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">foldM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PatBase Info VName]
-&gt; Set (Uniqueness, VName)
-&gt; (Uniqueness, Set VName)
-&gt; TermTypeM (Set (Uniqueness, VName))
forall {t :: * -&gt; *}.
Foldable t =&gt;
t (PatBase Info VName)
-&gt; Set (Uniqueness, VName)
-&gt; (Uniqueness, Set VName)
-&gt; TermTypeM (Set (Uniqueness, VName))
</span><a href="#local-6989586621684560581"><span class="hs-identifier hs-var">checkReturnAlias'</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560582"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (Uniqueness, VName)
forall a. Set a
</span><span class="hs-identifier hs-var">S.empty</span></span><span> </span><span class="annot"><span class="annottext">([(Uniqueness, Set VName)] -&gt; TermTypeM ())
-&gt; (TypeBase (DimDecl VName) Aliasing -&gt; [(Uniqueness, Set VName)])
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TypeBase () ()
-&gt; TypeBase (DimDecl VName) Aliasing -&gt; [(Uniqueness, Set VName)]
forall {shape} {as} {shape}.
TypeBase shape as
-&gt; TypeBase shape Aliasing -&gt; [(Uniqueness, Set VName)]
</span><a href="#local-6989586621684560580"><span class="hs-identifier hs-var">returnAliasing</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase () ()
</span><a href="#local-6989586621684560583"><span class="hs-identifier hs-var">rettp</span></a></span><span>
</span><span id="line-1359"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1360"></span><span>    </span><span id="local-6989586621684560581"><span class="annot"><span class="annottext">checkReturnAlias' :: t (PatBase Info VName)
-&gt; Set (Uniqueness, VName)
-&gt; (Uniqueness, Set VName)
-&gt; TermTypeM (Set (Uniqueness, VName))
</span><a href="#local-6989586621684560581"><span class="hs-identifier hs-var hs-var">checkReturnAlias'</span></a></span></span><span> </span><span id="local-6989586621684560559"><span class="annot"><span class="annottext">t (PatBase Info VName)
</span><a href="#local-6989586621684560559"><span class="hs-identifier hs-var">params'</span></a></span></span><span> </span><span id="local-6989586621684560558"><span class="annot"><span class="annottext">Set (Uniqueness, VName)
</span><a href="#local-6989586621684560558"><span class="hs-identifier hs-var">seen</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Unique"><span class="hs-identifier hs-var">Unique</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560557"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560557"><span class="hs-identifier hs-var">names</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1361"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Bool) -&gt; [VName] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">((Uniqueness, VName) -&gt; VName)
-&gt; Set (Uniqueness, VName) -&gt; Set VName
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">S.map</span></span><span> </span><span class="annot"><span class="annottext">(Uniqueness, VName) -&gt; VName
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">Set (Uniqueness, VName)
</span><a href="#local-6989586621684560558"><span class="hs-identifier hs-var">seen</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; Bool) -&gt; [VName] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; [VName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560557"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1362"></span><span>        </span><span class="annot"><span class="annottext">SrcLoc -&gt; TermTypeM (Set (Uniqueness, VName))
forall a. SrcLoc -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#uniqueReturnAliased"><span class="hs-identifier hs-var">uniqueReturnAliased</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560584"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-1363"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1364"></span><span>        </span><span class="annot"><span class="annottext">t (PatBase Info VName) -&gt; Set VName -&gt; TermTypeM ()
forall {t :: * -&gt; *}.
Foldable t =&gt;
t (PatBase Info VName) -&gt; Set VName -&gt; TermTypeM ()
</span><a href="#local-6989586621684560555"><span class="hs-identifier hs-var">notAliasingParam</span></a></span><span> </span><span class="annot"><span class="annottext">t (PatBase Info VName)
</span><a href="#local-6989586621684560559"><span class="hs-identifier hs-var">params'</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560557"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-1365"></span><span>        </span><span class="annot"><span class="annottext">Set (Uniqueness, VName) -&gt; TermTypeM (Set (Uniqueness, VName))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Set (Uniqueness, VName) -&gt; TermTypeM (Set (Uniqueness, VName)))
-&gt; Set (Uniqueness, VName) -&gt; TermTypeM (Set (Uniqueness, VName))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set (Uniqueness, VName)
</span><a href="#local-6989586621684560558"><span class="hs-identifier hs-var">seen</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Uniqueness, VName)
-&gt; Set (Uniqueness, VName) -&gt; Set (Uniqueness, VName)
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`S.union`</span></span><span> </span><span class="annot"><span class="annottext">Uniqueness -&gt; Set VName -&gt; Set (Uniqueness, VName)
forall {t} {a}. (Ord t, Ord a) =&gt; t -&gt; Set a -&gt; Set (t, a)
</span><a href="#local-6989586621684560553"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Unique"><span class="hs-identifier hs-var">Unique</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560557"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-1366"></span><span>    </span><span class="annot"><a href="#local-6989586621684560581"><span class="hs-identifier hs-var">checkReturnAlias'</span></a></span><span> </span><span class="annot"><span class="annottext">t (PatBase Info VName)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684560552"><span class="annot"><span class="annottext">Set (Uniqueness, VName)
</span><a href="#local-6989586621684560552"><span class="hs-identifier hs-var">seen</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Nonunique"><span class="hs-identifier hs-var">Nonunique</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560551"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560551"><span class="hs-identifier hs-var">names</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1367"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">((Uniqueness, VName) -&gt; Bool) -&gt; [(Uniqueness, VName)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Uniqueness, VName) -&gt; Set (Uniqueness, VName) -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set (Uniqueness, VName)
</span><a href="#local-6989586621684560552"><span class="hs-identifier hs-var">seen</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Uniqueness, VName)] -&gt; Bool) -&gt; [(Uniqueness, VName)] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set (Uniqueness, VName) -&gt; [(Uniqueness, VName)]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set (Uniqueness, VName) -&gt; [(Uniqueness, VName)])
-&gt; Set (Uniqueness, VName) -&gt; [(Uniqueness, VName)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Uniqueness -&gt; Set VName -&gt; Set (Uniqueness, VName)
forall {t} {a}. (Ord t, Ord a) =&gt; t -&gt; Set a -&gt; Set (t, a)
</span><a href="#local-6989586621684560553"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Unique"><span class="hs-identifier hs-var">Unique</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560551"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1368"></span><span>        </span><span class="annot"><span class="annottext">SrcLoc -&gt; TermTypeM (Set (Uniqueness, VName))
forall a. SrcLoc -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#uniqueReturnAliased"><span class="hs-identifier hs-var">uniqueReturnAliased</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560584"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-1369"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (Uniqueness, VName) -&gt; TermTypeM (Set (Uniqueness, VName))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Set (Uniqueness, VName) -&gt; TermTypeM (Set (Uniqueness, VName)))
-&gt; Set (Uniqueness, VName) -&gt; TermTypeM (Set (Uniqueness, VName))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set (Uniqueness, VName)
</span><a href="#local-6989586621684560552"><span class="hs-identifier hs-var">seen</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Uniqueness, VName)
-&gt; Set (Uniqueness, VName) -&gt; Set (Uniqueness, VName)
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`S.union`</span></span><span> </span><span class="annot"><span class="annottext">Uniqueness -&gt; Set VName -&gt; Set (Uniqueness, VName)
forall {t} {a}. (Ord t, Ord a) =&gt; t -&gt; Set a -&gt; Set (t, a)
</span><a href="#local-6989586621684560553"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Nonunique"><span class="hs-identifier hs-var">Nonunique</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560551"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-1370"></span><span>
</span><span id="line-1371"></span><span>    </span><span id="local-6989586621684560555"><span class="annot"><span class="annottext">notAliasingParam :: t (PatBase Info VName) -&gt; Set VName -&gt; TermTypeM ()
</span><a href="#local-6989586621684560555"><span class="hs-identifier hs-var hs-var">notAliasingParam</span></a></span></span><span> </span><span id="local-6989586621684560543"><span class="annot"><span class="annottext">t (PatBase Info VName)
</span><a href="#local-6989586621684560543"><span class="hs-identifier hs-var">params'</span></a></span></span><span> </span><span id="local-6989586621684560542"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560542"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1372"></span><span>      </span><span class="annot"><span class="annottext">t (PatBase Info VName)
-&gt; (PatBase Info VName -&gt; TermTypeM ()) -&gt; TermTypeM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">t (PatBase Info VName)
</span><a href="#local-6989586621684560543"><span class="hs-identifier hs-var">params'</span></a></span><span> </span><span class="annot"><span class="annottext">((PatBase Info VName -&gt; TermTypeM ()) -&gt; TermTypeM ())
-&gt; (PatBase Info VName -&gt; TermTypeM ()) -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684560540"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684560540"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1373"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684560538"><span class="annot"><span class="annottext">consumedNonunique :: IdentBase Info VName -&gt; Bool
</span><a href="#local-6989586621684560538"><span class="hs-identifier hs-var hs-var">consumedNonunique</span></a></span></span><span> </span><span id="local-6989586621684560537"><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684560537"><span class="hs-identifier hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1374"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Bool
forall shape as. TypeBase shape as -&gt; Bool
</span><a href="Language.Futhark.Prop.html#unique"><span class="hs-identifier hs-var">unique</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing -&gt; Bool)
-&gt; TypeBase (DimDecl VName) Aliasing -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Info (TypeBase (DimDecl VName) Aliasing)
-&gt; TypeBase (DimDecl VName) Aliasing
forall a. Info a -&gt; a
</span><a href="Language.Futhark.Syntax.html#unInfo"><span class="hs-identifier hs-var hs-var">unInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Info (TypeBase (DimDecl VName) Aliasing)
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; Info (TypeBase (DimDecl VName) Aliasing)
-&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall (f :: * -&gt; *) vn.
IdentBase f vn -&gt; f (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.Syntax.html#identType"><span class="hs-identifier hs-var hs-var">identType</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684560537"><span class="hs-identifier hs-var">p'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; VName
forall (f :: * -&gt; *) vn. IdentBase f vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#identName"><span class="hs-identifier hs-var hs-var">identName</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684560537"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560542"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1375"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(IdentBase Info VName -&gt; Bool)
-&gt; [IdentBase Info VName] -&gt; Maybe (IdentBase Info VName)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; Bool
</span><a href="#local-6989586621684560538"><span class="hs-identifier hs-var">consumedNonunique</span></a></span><span> </span><span class="annot"><span class="annottext">([IdentBase Info VName] -&gt; Maybe (IdentBase Info VName))
-&gt; [IdentBase Info VName] -&gt; Maybe (IdentBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set (IdentBase Info VName) -&gt; [IdentBase Info VName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set (IdentBase Info VName) -&gt; [IdentBase Info VName])
-&gt; Set (IdentBase Info VName) -&gt; [IdentBase Info VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Set (IdentBase Info VName)
forall (f :: * -&gt; *) vn.
(Functor f, Ord vn) =&gt;
PatBase f vn -&gt; Set (IdentBase f vn)
</span><a href="Language.Futhark.Prop.html#patIdents"><span class="hs-identifier hs-var">patIdents</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684560540"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1376"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684560535"><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684560535"><span class="hs-identifier hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1377"></span><span>                </span><span class="annot"><span class="annottext">Name -&gt; SrcLoc -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#returnAliased"><span class="hs-identifier hs-var">returnAliased</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Name
</span><a href="Language.Futhark.Core.html#baseName"><span class="hs-identifier hs-var">baseName</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Name) -&gt; VName -&gt; Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; VName
forall (f :: * -&gt; *) vn. IdentBase f vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#identName"><span class="hs-identifier hs-var hs-var">identName</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684560535"><span class="hs-identifier hs-var">p'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560584"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-1378"></span><span>              </span><span class="annot"><span class="annottext">Maybe (IdentBase Info VName)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1379"></span><span>                </span><span class="annot"><span class="annottext">() -&gt; TermTypeM ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1380"></span><span>
</span><span id="line-1381"></span><span>    </span><span id="local-6989586621684560553"><span class="annot"><span class="annottext">tag :: t -&gt; Set a -&gt; Set (t, a)
</span><a href="#local-6989586621684560553"><span class="hs-identifier hs-var hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621684560527"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621684560527"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; (t, a)) -&gt; Set a -&gt; Set (t, a)
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">S.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621684560527"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-1382"></span><span>
</span><span id="line-1383"></span><span>    </span><span id="local-6989586621684560580"><span class="annot"><span class="annottext">returnAliasing :: TypeBase shape as
-&gt; TypeBase shape Aliasing -&gt; [(Uniqueness, Set VName)]
</span><a href="#local-6989586621684560580"><span class="hs-identifier hs-var hs-var">returnAliasing</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span id="local-6989586621684560521"><span class="annot"><span class="annottext">Map Name (TypeBase shape as)
</span><a href="#local-6989586621684560521"><span class="hs-identifier hs-var">ets1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span id="local-6989586621684560520"><span class="annot"><span class="annottext">Map Name (TypeBase shape Aliasing)
</span><a href="#local-6989586621684560520"><span class="hs-identifier hs-var">ets2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1384"></span><span>      </span><span class="annot"><span class="annottext">[[(Uniqueness, Set VName)]] -&gt; [(Uniqueness, Set VName)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[(Uniqueness, Set VName)]] -&gt; [(Uniqueness, Set VName)])
-&gt; [[(Uniqueness, Set VName)]] -&gt; [(Uniqueness, Set VName)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Name [(Uniqueness, Set VName)] -&gt; [[(Uniqueness, Set VName)]]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">(Map Name [(Uniqueness, Set VName)] -&gt; [[(Uniqueness, Set VName)]])
-&gt; Map Name [(Uniqueness, Set VName)]
-&gt; [[(Uniqueness, Set VName)]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TypeBase shape as
 -&gt; TypeBase shape Aliasing -&gt; [(Uniqueness, Set VName)])
-&gt; Map Name (TypeBase shape as)
-&gt; Map Name (TypeBase shape Aliasing)
-&gt; Map Name [(Uniqueness, Set VName)]
forall k a b c.
Ord k =&gt;
(a -&gt; b -&gt; c) -&gt; Map k a -&gt; Map k b -&gt; Map k c
</span><span class="hs-identifier hs-var">M.intersectionWith</span></span><span> </span><span class="annot"><span class="annottext">TypeBase shape as
-&gt; TypeBase shape Aliasing -&gt; [(Uniqueness, Set VName)]
</span><a href="#local-6989586621684560580"><span class="hs-identifier hs-var">returnAliasing</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase shape as)
</span><a href="#local-6989586621684560521"><span class="hs-identifier hs-var">ets1</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase shape Aliasing)
</span><a href="#local-6989586621684560520"><span class="hs-identifier hs-var">ets2</span></a></span><span>
</span><span id="line-1385"></span><span>    </span><span class="annot"><a href="#local-6989586621684560580"><span class="hs-identifier hs-var">returnAliasing</span></a></span><span> </span><span id="local-6989586621684560519"><span class="annot"><span class="annottext">TypeBase shape as
</span><a href="#local-6989586621684560519"><span class="hs-identifier hs-var">expected</span></a></span></span><span> </span><span id="local-6989586621684560518"><span class="annot"><span class="annottext">TypeBase shape Aliasing
</span><a href="#local-6989586621684560518"><span class="hs-identifier hs-var">got</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1386"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase shape as -&gt; Uniqueness
forall shape as. TypeBase shape as -&gt; Uniqueness
</span><a href="Language.Futhark.Prop.html#uniqueness"><span class="hs-identifier hs-var">uniqueness</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase shape as
</span><a href="#local-6989586621684560519"><span class="hs-identifier hs-var">expected</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; VName) -&gt; Aliasing -&gt; Set VName
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">S.map</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; VName
</span><a href="Language.Futhark.Syntax.html#aliasVar"><span class="hs-identifier hs-var hs-var">aliasVar</span></a></span><span> </span><span class="annot"><span class="annottext">(Aliasing -&gt; Set VName) -&gt; Aliasing -&gt; Set VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase shape Aliasing -&gt; Aliasing
forall as shape. Monoid as =&gt; TypeBase shape as -&gt; as
</span><a href="Language.Futhark.Prop.html#aliases"><span class="hs-identifier hs-var">aliases</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase shape Aliasing
</span><a href="#local-6989586621684560518"><span class="hs-identifier hs-var">got</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1387"></span><span>
</span><span id="line-1388"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkBinding"><span class="hs-identifier hs-type">checkBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1389"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1390"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedTypeExp"><span class="hs-identifier hs-type">UncheckedTypeExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1391"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedTypeParam"><span class="hs-identifier hs-type">UncheckedTypeParam</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1392"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedPat"><span class="hs-identifier hs-type">UncheckedPat</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1393"></span><span>    </span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedExp"><span class="hs-identifier hs-type">UncheckedExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1394"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span>
</span><span id="line-1395"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1396"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span>
</span><span id="line-1397"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#TypeParam"><span class="hs-identifier hs-type">TypeParam</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1398"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1399"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeExp"><span class="hs-identifier hs-type">TypeExp</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1400"></span><span>      </span><span class="annot"><a href="Language.Futhark.Syntax.html#StructRetType"><span class="hs-identifier hs-type">StructRetType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1401"></span><span>      </span><span class="annot"><a href="Language.Futhark.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-1402"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-1403"></span><span id="checkBinding"><span class="annot"><span class="annottext">checkBinding :: (Name, Maybe UncheckedTypeExp, [TypeParamBase Name],
 [PatBase NoInfo Name], ExpBase NoInfo Name, SrcLoc)
-&gt; TermTypeM
     ([TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkBinding"><span class="hs-identifier hs-var hs-var">checkBinding</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684560516"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684560516"><span class="hs-identifier hs-var">fname</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560515"><span class="annot"><span class="annottext">Maybe UncheckedTypeExp
</span><a href="#local-6989586621684560515"><span class="hs-identifier hs-var">maybe_retdecl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560514"><span class="annot"><span class="annottext">[TypeParamBase Name]
</span><a href="#local-6989586621684560514"><span class="hs-identifier hs-var">tparams</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560513"><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684560513"><span class="hs-identifier hs-var">params</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560512"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684560512"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560511"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560511"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1404"></span><span>  </span><span class="annot"><span class="annottext">TermTypeM
  ([TypeParamBase VName], [PatBase Info VName],
   Maybe (TypeExp VName), StructRetType, Exp)
-&gt; TermTypeM
     ([TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
forall a. TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#noUnique"><span class="hs-identifier hs-var">noUnique</span></a></span><span> </span><span class="annot"><span class="annottext">(TermTypeM
   ([TypeParamBase VName], [PatBase Info VName],
    Maybe (TypeExp VName), StructRetType, Exp)
 -&gt; TermTypeM
      ([TypeParamBase VName], [PatBase Info VName],
       Maybe (TypeExp VName), StructRetType, Exp))
-&gt; (([TypeParamBase VName]
     -&gt; [PatBase Info VName]
     -&gt; TermTypeM
          ([TypeParamBase VName], [PatBase Info VName],
           Maybe (TypeExp VName), StructRetType, Exp))
    -&gt; TermTypeM
         ([TypeParamBase VName], [PatBase Info VName],
          Maybe (TypeExp VName), StructRetType, Exp))
-&gt; ([TypeParamBase VName]
    -&gt; [PatBase Info VName]
    -&gt; TermTypeM
         ([TypeParamBase VName], [PatBase Info VName],
          Maybe (TypeExp VName), StructRetType, Exp))
-&gt; TermTypeM
     ([TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TermTypeM
  ([TypeParamBase VName], [PatBase Info VName],
   Maybe (TypeExp VName), StructRetType, Exp)
-&gt; TermTypeM
     ([TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
forall a. TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#incLevel"><span class="hs-identifier hs-var">incLevel</span></a></span><span> </span><span class="annot"><span class="annottext">(TermTypeM
   ([TypeParamBase VName], [PatBase Info VName],
    Maybe (TypeExp VName), StructRetType, Exp)
 -&gt; TermTypeM
      ([TypeParamBase VName], [PatBase Info VName],
       Maybe (TypeExp VName), StructRetType, Exp))
-&gt; (([TypeParamBase VName]
     -&gt; [PatBase Info VName]
     -&gt; TermTypeM
          ([TypeParamBase VName], [PatBase Info VName],
           Maybe (TypeExp VName), StructRetType, Exp))
    -&gt; TermTypeM
         ([TypeParamBase VName], [PatBase Info VName],
          Maybe (TypeExp VName), StructRetType, Exp))
-&gt; ([TypeParamBase VName]
    -&gt; [PatBase Info VName]
    -&gt; TermTypeM
         ([TypeParamBase VName], [PatBase Info VName],
          Maybe (TypeExp VName), StructRetType, Exp))
-&gt; TermTypeM
     ([TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase Name]
-&gt; [PatBase NoInfo Name]
-&gt; ([TypeParamBase VName]
    -&gt; [PatBase Info VName]
    -&gt; TermTypeM
         ([TypeParamBase VName], [PatBase Info VName],
          Maybe (TypeExp VName), StructRetType, Exp))
-&gt; TermTypeM
     ([TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
forall a.
[TypeParamBase Name]
-&gt; [PatBase NoInfo Name]
-&gt; ([TypeParamBase VName] -&gt; [PatBase Info VName] -&gt; TermTypeM a)
-&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingParams"><span class="hs-identifier hs-var">bindingParams</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase Name]
</span><a href="#local-6989586621684560514"><span class="hs-identifier hs-var">tparams</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684560513"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">(([TypeParamBase VName]
  -&gt; [PatBase Info VName]
  -&gt; TermTypeM
       ([TypeParamBase VName], [PatBase Info VName],
        Maybe (TypeExp VName), StructRetType, Exp))
 -&gt; TermTypeM
      ([TypeParamBase VName], [PatBase Info VName],
       Maybe (TypeExp VName), StructRetType, Exp))
-&gt; ([TypeParamBase VName]
    -&gt; [PatBase Info VName]
    -&gt; TermTypeM
         ([TypeParamBase VName], [PatBase Info VName],
          Maybe (TypeExp VName), StructRetType, Exp))
-&gt; TermTypeM
     ([TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684560510"><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684560510"><span class="hs-identifier hs-var">tparams'</span></a></span></span><span> </span><span id="local-6989586621684560509"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560509"><span class="hs-identifier hs-var">params'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1405"></span><span>    </span><span id="local-6989586621684560508"><span class="annot"><span class="annottext">Maybe (TypeExp VName, TypeBase (DimDecl VName) (), [VName])
</span><a href="#local-6989586621684560508"><span class="hs-identifier hs-var">maybe_retdecl'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(UncheckedTypeExp
 -&gt; TermTypeM (TypeExp VName, TypeBase (DimDecl VName) (), [VName]))
-&gt; Maybe UncheckedTypeExp
-&gt; TermTypeM
     (Maybe (TypeExp VName, TypeBase (DimDecl VName) (), [VName]))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">UncheckedTypeExp
-&gt; TermTypeM (TypeExp VName, TypeBase (DimDecl VName) (), [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#checkTypeExpNonrigid"><span class="hs-identifier hs-var">checkTypeExpNonrigid</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UncheckedTypeExp
</span><a href="#local-6989586621684560515"><span class="hs-identifier hs-var">maybe_retdecl</span></a></span><span>
</span><span id="line-1406"></span><span>
</span><span id="line-1407"></span><span>    </span><span id="local-6989586621684560507"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560507"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1408"></span><span>      </span><span class="annot"><span class="annottext">[PatBase Info VName]
-&gt; ExpBase NoInfo Name
-&gt; Maybe (TypeBase (DimDecl VName) ())
-&gt; SrcLoc
-&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkFunBody"><span class="hs-identifier hs-var">checkFunBody</span></a></span><span>
</span><span id="line-1409"></span><span>        </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560509"><span class="hs-identifier hs-var">params'</span></a></span><span>
</span><span id="line-1410"></span><span>        </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684560512"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1411"></span><span>        </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeExp VName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560506"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560506"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560506"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((TypeExp VName, TypeBase (DimDecl VName) (), [VName])
 -&gt; TypeBase (DimDecl VName) ())
-&gt; Maybe (TypeExp VName, TypeBase (DimDecl VName) (), [VName])
-&gt; Maybe (TypeBase (DimDecl VName) ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName, TypeBase (DimDecl VName) (), [VName])
</span><a href="#local-6989586621684560508"><span class="hs-identifier hs-var">maybe_retdecl'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1412"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc
-&gt; (UncheckedTypeExp -&gt; SrcLoc) -&gt; Maybe UncheckedTypeExp -&gt; SrcLoc
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560511"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">UncheckedTypeExp -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">Maybe UncheckedTypeExp
</span><a href="#local-6989586621684560515"><span class="hs-identifier hs-var">maybe_retdecl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1413"></span><span>
</span><span id="line-1414"></span><span>    </span><span id="local-6989586621684560505"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560505"><span class="hs-identifier hs-var">params''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; TermTypeM (PatBase Info VName))
-&gt; [PatBase Info VName] -&gt; TermTypeM [PatBase Info VName]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall e. ASTMappable e =&gt; e -&gt; TermTypeM e
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#updateTypes"><span class="hs-identifier hs-var">updateTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560509"><span class="hs-identifier hs-var">params'</span></a></span><span>
</span><span id="line-1415"></span><span>    </span><span id="local-6989586621684560504"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560504"><span class="hs-identifier hs-var">body_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560507"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-1416"></span><span>
</span><span id="line-1417"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684560503"><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684560503"><span class="hs-identifier hs-var">maybe_retdecl''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560502"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560502"><span class="hs-identifier hs-var">rettype</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName, TypeBase (DimDecl VName) (), [VName])
</span><a href="#local-6989586621684560508"><span class="hs-identifier hs-var">maybe_retdecl'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1418"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684560501"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684560501"><span class="hs-identifier hs-var">retdecl'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560500"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560500"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1419"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684560499"><span class="annot"><span class="annottext">rettype_structural :: TypeBase () ()
</span><a href="#local-6989586621684560499"><span class="hs-identifier hs-var hs-var">rettype_structural</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; TypeBase () ()
forall dim as. TypeBase dim as -&gt; TypeBase () ()
</span><a href="Language.Futhark.Prop.html#toStructural"><span class="hs-identifier hs-var">toStructural</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560500"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-1420"></span><span>        </span><span class="annot"><span class="annottext">SrcLoc
-&gt; TypeBase () ()
-&gt; [PatBase Info VName]
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkReturnAlias"><span class="hs-identifier hs-var">checkReturnAlias</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560511"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase () ()
</span><a href="#local-6989586621684560499"><span class="hs-identifier hs-var">rettype_structural</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560505"><span class="hs-identifier hs-var">params''</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560504"><span class="hs-identifier hs-var">body_t</span></a></span><span>
</span><span id="line-1421"></span><span>
</span><span id="line-1422"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; TermTypeM () -&gt; TermTypeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PatBase NoInfo Name] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684560513"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM () -&gt; TermTypeM ()) -&gt; TermTypeM () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; TypeBase () () -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#nothingMustBeUnique"><span class="hs-identifier hs-var">nothingMustBeUnique</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560511"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase () ()
</span><a href="#local-6989586621684560499"><span class="hs-identifier hs-var">rettype_structural</span></a></span><span>
</span><span id="line-1423"></span><span>
</span><span id="line-1424"></span><span>        </span><span id="local-6989586621684560497"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560497"><span class="hs-identifier hs-var">ret'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall a (m :: * -&gt; *). (Substitutable a, MonadUnify m) =&gt; a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Unify.html#normTypeFully"><span class="hs-identifier hs-var">normTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560500"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-1425"></span><span>
</span><span id="line-1426"></span><span>        </span><span class="annot"><span class="annottext">(Maybe (TypeExp VName), TypeBase (DimDecl VName) ())
-&gt; TermTypeM (Maybe (TypeExp VName), TypeBase (DimDecl VName) ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeExp VName -&gt; Maybe (TypeExp VName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684560501"><span class="hs-identifier hs-var">retdecl'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560497"><span class="hs-identifier hs-var">ret'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1427"></span><span>      </span><span class="annot"><span class="annottext">Maybe (TypeExp VName, TypeBase (DimDecl VName) (), [VName])
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1428"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[PatBase NoInfo Name] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684560513"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1429"></span><span>          </span><span class="annot"><span class="annottext">(Maybe (TypeExp VName), TypeBase (DimDecl VName) ())
-&gt; TermTypeM (Maybe (TypeExp VName), TypeBase (DimDecl VName) ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ())
-&gt; TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560504"><span class="hs-identifier hs-var">body_t</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Uniqueness -&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. TypeBase dim as -&gt; Uniqueness -&gt; TypeBase dim as
</span><a href="Language.Futhark.Prop.html#setUniqueness"><span class="hs-operator hs-var">`setUniqueness`</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Nonunique"><span class="hs-identifier hs-var">Nonunique</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1430"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1431"></span><span>          </span><span id="local-6989586621684560496"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560496"><span class="hs-identifier hs-var">body_t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; [PatBase Info VName]
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
</span><a href="Language.Futhark.TypeChecker.Terms.html#inferredReturnType"><span class="hs-identifier hs-var">inferredReturnType</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560511"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560505"><span class="hs-identifier hs-var">params''</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560504"><span class="hs-identifier hs-var">body_t</span></a></span><span>
</span><span id="line-1432"></span><span>          </span><span class="annot"><span class="annottext">(Maybe (TypeExp VName), TypeBase (DimDecl VName) ())
-&gt; TermTypeM (Maybe (TypeExp VName), TypeBase (DimDecl VName) ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560496"><span class="hs-identifier hs-var">body_t'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1433"></span><span>
</span><span id="line-1434"></span><span>    </span><span class="annot"><span class="annottext">Maybe Name -&gt; [PatBase Info VName] -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#verifyFunctionParams"><span class="hs-identifier hs-var">verifyFunctionParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684560516"><span class="hs-identifier hs-var">fname</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560505"><span class="hs-identifier hs-var">params''</span></a></span><span>
</span><span id="line-1435"></span><span>
</span><span id="line-1436"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684560495"><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684560495"><span class="hs-identifier hs-var">tparams''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560494"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560494"><span class="hs-identifier hs-var">params'''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560493"><span class="annot"><span class="annottext">StructRetType
</span><a href="#local-6989586621684560493"><span class="hs-identifier hs-var">rettype''</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1437"></span><span>      </span><span class="annot"><span class="annottext">Name
-&gt; SrcLoc
-&gt; [TypeParamBase VName]
-&gt; [PatBase Info VName]
-&gt; TypeBase (DimDecl VName) ()
-&gt; TermTypeM
     ([TypeParamBase VName], [PatBase Info VName], StructRetType)
</span><a href="Language.Futhark.TypeChecker.Terms.html#letGeneralise"><span class="hs-identifier hs-var">letGeneralise</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684560516"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560511"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684560510"><span class="hs-identifier hs-var">tparams'</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560505"><span class="hs-identifier hs-var">params''</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560502"><span class="hs-identifier hs-var">rettype</span></a></span><span>
</span><span id="line-1438"></span><span>
</span><span id="line-1439"></span><span>    </span><span class="annot"><span class="annottext">[PatBase Info VName]
-&gt; TypeBase (DimDecl VName) Aliasing -&gt; SrcLoc -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkGlobalAliases"><span class="hs-identifier hs-var">checkGlobalAliases</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560505"><span class="hs-identifier hs-var">params''</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560504"><span class="hs-identifier hs-var">body_t</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560511"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-1440"></span><span>
</span><span id="line-1441"></span><span>    </span><span class="annot"><span class="annottext">([TypeParamBase VName], [PatBase Info VName],
 Maybe (TypeExp VName), StructRetType, Exp)
-&gt; TermTypeM
     ([TypeParamBase VName], [PatBase Info VName],
      Maybe (TypeExp VName), StructRetType, Exp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684560495"><span class="hs-identifier hs-var">tparams''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560494"><span class="hs-identifier hs-var">params'''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684560503"><span class="hs-identifier hs-var">maybe_retdecl''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StructRetType
</span><a href="#local-6989586621684560493"><span class="hs-identifier hs-var">rettype''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560507"><span class="hs-identifier hs-var">body'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1442"></span><span>
</span><span id="line-1443"></span><span class="hs-comment">-- | Extract all the shape names that occur in positive position</span><span>
</span><span id="line-1444"></span><span class="hs-comment">-- (roughly, left side of an arrow) in a given type.</span><span>
</span><span id="line-1445"></span><span id="local-6989586621684563745"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#typeDimNamesPos"><span class="hs-identifier hs-type">typeDimNamesPos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#DimDecl"><span class="hs-identifier hs-type">DimDecl</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621684563745"><span class="hs-identifier hs-type">als</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span></span><span>
</span><span id="line-1446"></span><span id="typeDimNamesPos"><span class="annot"><span class="annottext">typeDimNamesPos :: forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#typeDimNamesPos"><span class="hs-identifier hs-var hs-var">typeDimNamesPos</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-type">Arrow</span></a></span><span> </span><span class="annot"><span class="annottext">als
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684560490"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) als
</span><a href="#local-6989586621684560490"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-type">RetType</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684560489"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) als
</span><a href="#local-6989586621684560489"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) als -&gt; Set VName
forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="#local-6989586621684560488"><span class="hs-identifier hs-var">onParam</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) als
</span><a href="#local-6989586621684560490"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) als -&gt; Set VName
forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#typeDimNamesPos"><span class="hs-identifier hs-var">typeDimNamesPos</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) als
</span><a href="#local-6989586621684560489"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-1447"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1448"></span><span>    </span><span id="local-6989586621684560487"><span class="annot"><a href="#local-6989586621684560488"><span class="hs-identifier hs-type">onParam</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#DimDecl"><span class="hs-identifier hs-type">DimDecl</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621684560487"><span class="hs-identifier hs-type">als</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span></span><span>
</span><span id="line-1449"></span><span>    </span><span id="local-6989586621684560488"><span class="annot"><span class="annottext">onParam :: forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="#local-6989586621684560488"><span class="hs-identifier hs-var hs-var">onParam</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-type">Arrow</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set VName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1450"></span><span>    </span><span class="annot"><a href="#local-6989586621684560488"><span class="hs-identifier hs-var">onParam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span id="local-6989586621684560483"><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) als)
</span><a href="#local-6989586621684560483"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Set VName] -&gt; Set VName
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Set VName] -&gt; Set VName) -&gt; [Set VName] -&gt; Set VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) als -&gt; Set VName)
-&gt; [TypeBase (DimDecl VName) als] -&gt; [Set VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) als -&gt; Set VName
forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="#local-6989586621684560488"><span class="hs-identifier hs-var">onParam</span></a></span><span> </span><span class="annot"><span class="annottext">([TypeBase (DimDecl VName) als] -&gt; [Set VName])
-&gt; [TypeBase (DimDecl VName) als] -&gt; [Set VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) als)
-&gt; [TypeBase (DimDecl VName) als]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) als)
</span><a href="#local-6989586621684560483"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-1451"></span><span>    </span><span class="annot"><a href="#local-6989586621684560488"><span class="hs-identifier hs-var">onParam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">als
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684560482"><span class="annot"><span class="annottext">[TypeArg (DimDecl VName)]
</span><a href="#local-6989586621684560482"><span class="hs-identifier hs-var">targs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Set VName] -&gt; Set VName
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Set VName] -&gt; Set VName) -&gt; [Set VName] -&gt; Set VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TypeArg (DimDecl VName) -&gt; Set VName)
-&gt; [TypeArg (DimDecl VName)] -&gt; [Set VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TypeArg (DimDecl VName) -&gt; Set VName
</span><a href="#local-6989586621684560481"><span class="hs-identifier hs-var">onTypeArg</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeArg (DimDecl VName)]
</span><a href="#local-6989586621684560482"><span class="hs-identifier hs-var">targs</span></a></span><span>
</span><span id="line-1452"></span><span>    </span><span class="annot"><a href="#local-6989586621684560488"><span class="hs-identifier hs-var">onParam</span></a></span><span> </span><span id="local-6989586621684560480"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) als
</span><a href="#local-6989586621684560480"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) als -&gt; Set VName
forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="Language.Futhark.Prop.html#typeDimNames"><span class="hs-identifier hs-var">typeDimNames</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) als
</span><a href="#local-6989586621684560480"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1453"></span><span>    </span><span id="local-6989586621684560481"><span class="annot"><span class="annottext">onTypeArg :: TypeArg (DimDecl VName) -&gt; Set VName
</span><a href="#local-6989586621684560481"><span class="hs-identifier hs-var hs-var">onTypeArg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeArgDim"><span class="hs-identifier hs-type">TypeArgDim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#NamedDim"><span class="hs-identifier hs-type">NamedDim</span></a></span><span> </span><span id="local-6989586621684560477"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684560477"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Set VName
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">S.singleton</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Set VName) -&gt; VName -&gt; Set VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; VName
forall vn. QualName vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#qualLeaf"><span class="hs-identifier hs-var hs-var">qualLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684560477"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1454"></span><span>    </span><span class="annot"><a href="#local-6989586621684560481"><span class="hs-identifier hs-var">onTypeArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeArgDim"><span class="hs-identifier hs-type">TypeArgDim</span></a></span><span> </span><span class="annot"><span class="annottext">DimDecl VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set VName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1455"></span><span>    </span><span class="annot"><a href="#local-6989586621684560481"><span class="hs-identifier hs-var">onTypeArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeArgType"><span class="hs-identifier hs-type">TypeArgType</span></a></span><span> </span><span id="local-6989586621684560476"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560476"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; Set VName
forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="#local-6989586621684560488"><span class="hs-identifier hs-var">onParam</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560476"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1456"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#typeDimNamesPos"><span class="hs-identifier hs-var">typeDimNamesPos</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) als
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set VName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1457"></span><span>
</span><span id="line-1458"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkGlobalAliases"><span class="hs-identifier hs-type">checkGlobalAliases</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1459"></span><span id="checkGlobalAliases"><span class="annot"><span class="annottext">checkGlobalAliases :: [PatBase Info VName]
-&gt; TypeBase (DimDecl VName) Aliasing -&gt; SrcLoc -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkGlobalAliases"><span class="hs-identifier hs-var hs-var">checkGlobalAliases</span></a></span></span><span> </span><span id="local-6989586621684560475"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560475"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621684560474"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560474"><span class="hs-identifier hs-var">body_t</span></a></span></span><span> </span><span id="local-6989586621684560473"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560473"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1460"></span><span>  </span><span id="local-6989586621684560472"><span class="annot"><span class="annottext">Map VName ValBinding
</span><a href="#local-6989586621684560472"><span class="hs-identifier hs-var">vtable</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TermEnv -&gt; Map VName ValBinding)
-&gt; TermTypeM (Map VName ValBinding)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">((TermEnv -&gt; Map VName ValBinding)
 -&gt; TermTypeM (Map VName ValBinding))
-&gt; (TermEnv -&gt; Map VName ValBinding)
-&gt; TermTypeM (Map VName ValBinding)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TermScope -&gt; Map VName ValBinding
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#scopeVtable"><span class="hs-identifier hs-var hs-var">scopeVtable</span></a></span><span> </span><span class="annot"><span class="annottext">(TermScope -&gt; Map VName ValBinding)
-&gt; (TermEnv -&gt; TermScope) -&gt; TermEnv -&gt; Map VName ValBinding
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TermEnv -&gt; TermScope
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#termScope"><span class="hs-identifier hs-var hs-var">termScope</span></a></span><span>
</span><span id="line-1461"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684560470"><span class="annot"><span class="annottext">isLocal :: VName -&gt; Bool
</span><a href="#local-6989586621684560470"><span class="hs-identifier hs-var hs-var">isLocal</span></a></span></span><span> </span><span id="local-6989586621684560469"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560469"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560469"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Map VName ValBinding -&gt; Maybe ValBinding
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-operator hs-var">`M.lookup`</span></span><span> </span><span class="annot"><span class="annottext">Map VName ValBinding
</span><a href="#local-6989586621684560472"><span class="hs-identifier hs-var">vtable</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1462"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#BoundV"><span class="hs-identifier hs-type">BoundV</span></a></span><span> </span><span class="annot"><span class="annottext">Locality
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Local"><span class="hs-identifier hs-var">Local</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1463"></span><span>        </span><span class="annot"><span class="annottext">Maybe ValBinding
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1464"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684560463"><span class="annot"><span class="annottext">als :: [VName]
</span><a href="#local-6989586621684560463"><span class="hs-identifier hs-var hs-var">als</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1465"></span><span>        </span><span class="annot"><span class="annottext">(VName -&gt; Bool) -&gt; [VName] -&gt; [VName]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (VName -&gt; Bool) -&gt; VName -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Bool
</span><a href="#local-6989586621684560470"><span class="hs-identifier hs-var">isLocal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; [VName])
-&gt; (Set VName -&gt; [VName]) -&gt; Set VName -&gt; [VName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; [VName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set VName -&gt; [VName]) -&gt; Set VName -&gt; [VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1466"></span><span>          </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#boundArrayAliases"><span class="hs-identifier hs-var">boundArrayAliases</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560474"><span class="hs-identifier hs-var">body_t</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`S.difference`</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; Set VName)
-&gt; [PatBase Info VName] -&gt; Set VName
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Set VName
forall (f :: * -&gt; *) vn.
(Functor f, Ord vn) =&gt;
PatBase f vn -&gt; Set vn
</span><a href="Language.Futhark.Prop.html#patNames"><span class="hs-identifier hs-var">patNames</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560475"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-1467"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684560463"><span class="hs-identifier hs-var">als</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1468"></span><span>    </span><span id="local-6989586621684560461"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560461"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1469"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560475"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1470"></span><span>        </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TermTypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560473"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM ()) -&gt; (Doc -&gt; Doc) -&gt; Doc -&gt; TermTypeM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Language.Futhark.TypeChecker.Monad.html#withIndexLink"><span class="hs-identifier hs-var">withIndexLink</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;alias-free-variable&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM ()) -&gt; Doc -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1471"></span><span>          </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Function result aliases the free variable &quot;</span></span><span>
</span><span id="line-1472"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Doc
forall v. IsName v =&gt; v -&gt; Doc
</span><a href="Language.Futhark.Pretty.html#pprName"><span class="hs-identifier hs-var">pprName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560461"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1473"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-1474"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Use&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;copy&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;to break the aliasing.&quot;</span></span><span>
</span><span id="line-1475"></span><span>    </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1476"></span><span>      </span><span class="annot"><span class="annottext">() -&gt; TermTypeM ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1477"></span><span>
</span><span id="line-1478"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#inferReturnUniqueness"><span class="hs-identifier hs-type">inferReturnUniqueness</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span>
</span><span id="line-1479"></span><span id="inferReturnUniqueness"><span class="annot"><span class="annottext">inferReturnUniqueness :: [PatBase Info VName]
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
</span><a href="Language.Futhark.TypeChecker.Terms.html#inferReturnUniqueness"><span class="hs-identifier hs-var hs-var">inferReturnUniqueness</span></a></span></span><span> </span><span id="local-6989586621684560460"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560460"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621684560459"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560459"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1480"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684560458"><span class="annot"><span class="annottext">forbidden :: Set VName
</span><a href="#local-6989586621684560458"><span class="hs-identifier hs-var hs-var">forbidden</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#aliasesMultipleTimes"><span class="hs-identifier hs-var">aliasesMultipleTimes</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560459"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1481"></span><span>      </span><span id="local-6989586621684560456"><span class="annot"><span class="annottext">uniques :: Set VName
</span><a href="#local-6989586621684560456"><span class="hs-identifier hs-var hs-var">uniques</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName] -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#uniqueParamNames"><span class="hs-identifier hs-var">uniqueParamNames</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560460"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-1482"></span><span>      </span><span id="local-6989586621684560448"><span class="annot"><span class="annottext">delve :: TypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560448"><span class="hs-identifier hs-var hs-var">delve</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span id="local-6989586621684560447"><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) Aliasing)
</span><a href="#local-6989586621684560447"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1483"></span><span>        </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) Aliasing
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) Aliasing)
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall dim as. Map Name (TypeBase dim as) -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-var">Record</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Name (TypeBase (DimDecl VName) Aliasing)
 -&gt; ScalarTypeBase (DimDecl VName) Aliasing)
-&gt; Map Name (TypeBase (DimDecl VName) Aliasing)
-&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; Map Name (TypeBase (DimDecl VName) Aliasing)
-&gt; Map Name (TypeBase (DimDecl VName) Aliasing)
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560448"><span class="hs-identifier hs-var">delve</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) Aliasing)
</span><a href="#local-6989586621684560447"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-1484"></span><span>      </span><span class="annot"><a href="#local-6989586621684560448"><span class="hs-identifier hs-var">delve</span></a></span><span> </span><span id="local-6989586621684560446"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560446"><span class="hs-identifier hs-var">t'</span></a></span></span><span>
</span><span id="line-1485"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Bool) -&gt; Set VName -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560456"><span class="hs-identifier hs-var">uniques</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#boundArrayAliases"><span class="hs-identifier hs-var">boundArrayAliases</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560446"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1486"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; Bool) -&gt; Aliasing -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560458"><span class="hs-identifier hs-var">forbidden</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Bool) -&gt; (Alias -&gt; VName) -&gt; Alias -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; VName
</span><a href="Language.Futhark.Syntax.html#aliasVar"><span class="hs-identifier hs-var hs-var">aliasVar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Aliasing
forall as shape. Monoid as =&gt; TypeBase shape as -&gt; as
</span><a href="Language.Futhark.Prop.html#aliases"><span class="hs-identifier hs-var">aliases</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560446"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1487"></span><span>          </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560446"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-1488"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1489"></span><span>          </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560446"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; Uniqueness -&gt; TypeBase (DimDecl VName) Aliasing
forall dim as. TypeBase dim as -&gt; Uniqueness -&gt; TypeBase dim as
</span><a href="Language.Futhark.Prop.html#setUniqueness"><span class="hs-operator hs-var">`setUniqueness`</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Nonunique"><span class="hs-identifier hs-var">Nonunique</span></a></span><span>
</span><span id="line-1490"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560448"><span class="hs-identifier hs-var">delve</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560459"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1491"></span><span>
</span><span id="line-1492"></span><span class="hs-comment">-- An alias inhibits uniqueness if it is used in disjoint values.</span><span>
</span><span id="line-1493"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#aliasesMultipleTimes"><span class="hs-identifier hs-type">aliasesMultipleTimes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Names"><span class="hs-identifier hs-type">Names</span></a></span><span>
</span><span id="line-1494"></span><span id="aliasesMultipleTimes"><span class="annot"><span class="annottext">aliasesMultipleTimes :: TypeBase (DimDecl VName) Aliasing -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#aliasesMultipleTimes"><span class="hs-identifier hs-var hs-var">aliasesMultipleTimes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; Set VName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; Set VName)
-&gt; (TypeBase (DimDecl VName) Aliasing -&gt; [VName])
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; Set VName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((VName, Int) -&gt; VName) -&gt; [(VName, Int)] -&gt; [VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(VName, Int) -&gt; VName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">([(VName, Int)] -&gt; [VName])
-&gt; (TypeBase (DimDecl VName) Aliasing -&gt; [(VName, Int)])
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; [VName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((VName, Int) -&gt; Bool) -&gt; [(VName, Int)] -&gt; [(VName, Int)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Bool) -&gt; ((VName, Int) -&gt; Int) -&gt; (VName, Int) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(VName, Int) -&gt; Int
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(VName, Int)] -&gt; [(VName, Int)])
-&gt; (TypeBase (DimDecl VName) Aliasing -&gt; [(VName, Int)])
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; [(VName, Int)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map VName Int -&gt; [(VName, Int)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map VName Int -&gt; [(VName, Int)])
-&gt; (TypeBase (DimDecl VName) Aliasing -&gt; Map VName Int)
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; [(VName, Int)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Map VName Int
forall {shape}. TypeBase shape Aliasing -&gt; Map VName Int
</span><a href="#local-6989586621684560443"><span class="hs-identifier hs-var">delve</span></a></span><span>
</span><span id="line-1495"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1496"></span><span>    </span><span id="local-6989586621684560443"><span class="annot"><span class="annottext">delve :: TypeBase shape Aliasing -&gt; Map VName Int
</span><a href="#local-6989586621684560443"><span class="hs-identifier hs-var hs-var">delve</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span id="local-6989586621684560435"><span class="annot"><span class="annottext">Map Name (TypeBase shape Aliasing)
</span><a href="#local-6989586621684560435"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1497"></span><span>      </span><span class="annot"><span class="annottext">(Map VName Int -&gt; Map VName Int -&gt; Map VName Int)
-&gt; Map VName Int -&gt; [Map VName Int] -&gt; Map VName Int
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int)
-&gt; Map VName Int -&gt; Map VName Int -&gt; Map VName Int
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.unionWith</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map VName Int
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">([Map VName Int] -&gt; Map VName Int)
-&gt; [Map VName Int] -&gt; Map VName Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TypeBase shape Aliasing -&gt; Map VName Int)
-&gt; [TypeBase shape Aliasing] -&gt; [Map VName Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TypeBase shape Aliasing -&gt; Map VName Int
</span><a href="#local-6989586621684560443"><span class="hs-identifier hs-var">delve</span></a></span><span> </span><span class="annot"><span class="annottext">([TypeBase shape Aliasing] -&gt; [Map VName Int])
-&gt; [TypeBase shape Aliasing] -&gt; [Map VName Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase shape Aliasing) -&gt; [TypeBase shape Aliasing]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase shape Aliasing)
</span><a href="#local-6989586621684560435"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-1498"></span><span>    </span><span class="annot"><a href="#local-6989586621684560443"><span class="hs-identifier hs-var">delve</span></a></span><span> </span><span id="local-6989586621684560433"><span class="annot"><span class="annottext">TypeBase shape Aliasing
</span><a href="#local-6989586621684560433"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1499"></span><span>      </span><span class="annot"><span class="annottext">[(VName, Int)] -&gt; Map VName Int
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(VName, Int)] -&gt; Map VName Int)
-&gt; [(VName, Int)] -&gt; Map VName Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; [Int] -&gt; [(VName, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Alias -&gt; VName) -&gt; [Alias] -&gt; [VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; VName
</span><a href="Language.Futhark.Syntax.html#aliasVar"><span class="hs-identifier hs-var hs-var">aliasVar</span></a></span><span> </span><span class="annot"><span class="annottext">([Alias] -&gt; [VName]) -&gt; [Alias] -&gt; [VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Aliasing -&gt; [Alias]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase shape Aliasing -&gt; Aliasing
forall as shape. Monoid as =&gt; TypeBase shape as -&gt; as
</span><a href="Language.Futhark.Prop.html#aliases"><span class="hs-identifier hs-var">aliases</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase shape Aliasing
</span><a href="#local-6989586621684560433"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [(VName, Int)]) -&gt; [Int] -&gt; [(VName, Int)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-1500"></span><span>
</span><span id="line-1501"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#uniqueParamNames"><span class="hs-identifier hs-type">uniqueParamNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Names"><span class="hs-identifier hs-type">Names</span></a></span><span>
</span><span id="line-1502"></span><span id="uniqueParamNames"><span class="annot"><span class="annottext">uniqueParamNames :: [PatBase Info VName] -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#uniqueParamNames"><span class="hs-identifier hs-var hs-var">uniqueParamNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1503"></span><span>  </span><span class="annot"><span class="annottext">(IdentBase Info VName -&gt; VName)
-&gt; Set (IdentBase Info VName) -&gt; Set VName
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">S.map</span></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; VName
forall (f :: * -&gt; *) vn. IdentBase f vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#identName"><span class="hs-identifier hs-var hs-var">identName</span></a></span><span>
</span><span id="line-1504"></span><span>    </span><span class="annot"><span class="annottext">(Set (IdentBase Info VName) -&gt; Set VName)
-&gt; ([PatBase Info VName] -&gt; Set (IdentBase Info VName))
-&gt; [PatBase Info VName]
-&gt; Set VName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(IdentBase Info VName -&gt; Bool)
-&gt; Set (IdentBase Info VName) -&gt; Set (IdentBase Info VName)
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Bool
forall shape as. TypeBase shape as -&gt; Bool
</span><a href="Language.Futhark.Prop.html#unique"><span class="hs-identifier hs-var">unique</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing -&gt; Bool)
-&gt; (IdentBase Info VName -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; IdentBase Info VName
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Info (TypeBase (DimDecl VName) Aliasing)
-&gt; TypeBase (DimDecl VName) Aliasing
forall a. Info a -&gt; a
</span><a href="Language.Futhark.Syntax.html#unInfo"><span class="hs-identifier hs-var hs-var">unInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Info (TypeBase (DimDecl VName) Aliasing)
 -&gt; TypeBase (DimDecl VName) Aliasing)
-&gt; (IdentBase Info VName
    -&gt; Info (TypeBase (DimDecl VName) Aliasing))
-&gt; IdentBase Info VName
-&gt; TypeBase (DimDecl VName) Aliasing
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; Info (TypeBase (DimDecl VName) Aliasing)
forall (f :: * -&gt; *) vn.
IdentBase f vn -&gt; f (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.Syntax.html#identType"><span class="hs-identifier hs-var hs-var">identType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1505"></span><span>    </span><span class="annot"><span class="annottext">(Set (IdentBase Info VName) -&gt; Set (IdentBase Info VName))
-&gt; ([PatBase Info VName] -&gt; Set (IdentBase Info VName))
-&gt; [PatBase Info VName]
-&gt; Set (IdentBase Info VName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; Set (IdentBase Info VName))
-&gt; [PatBase Info VName] -&gt; Set (IdentBase Info VName)
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Set (IdentBase Info VName)
forall (f :: * -&gt; *) vn.
(Functor f, Ord vn) =&gt;
PatBase f vn -&gt; Set (IdentBase f vn)
</span><a href="Language.Futhark.Prop.html#patIdents"><span class="hs-identifier hs-var">patIdents</span></a></span><span>
</span><span id="line-1506"></span><span>
</span><span id="line-1507"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#boundArrayAliases"><span class="hs-identifier hs-type">boundArrayAliases</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span>
</span><span id="line-1508"></span><span id="boundArrayAliases"><span class="annot"><span class="annottext">boundArrayAliases :: TypeBase (DimDecl VName) Aliasing -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#boundArrayAliases"><span class="hs-identifier hs-var hs-var">boundArrayAliases</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span id="local-6989586621684560430"><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684560430"><span class="hs-identifier hs-var">als</span></a></span></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ShapeDecl (DimDecl VName)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Aliasing -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#boundAliases"><span class="hs-identifier hs-var">boundAliases</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684560430"><span class="hs-identifier hs-var">als</span></a></span><span>
</span><span id="line-1509"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#boundArrayAliases"><span class="hs-identifier hs-var">boundArrayAliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set VName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1510"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#boundArrayAliases"><span class="hs-identifier hs-var">boundArrayAliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span id="local-6989586621684560428"><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) Aliasing)
</span><a href="#local-6989586621684560428"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing -&gt; Set VName)
-&gt; Map Name (TypeBase (DimDecl VName) Aliasing) -&gt; Set VName
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#boundArrayAliases"><span class="hs-identifier hs-var">boundArrayAliases</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) Aliasing)
</span><a href="#local-6989586621684560428"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-1511"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#boundArrayAliases"><span class="hs-identifier hs-var">boundArrayAliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span id="local-6989586621684560427"><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684560427"><span class="hs-identifier hs-var">als</span></a></span></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TypeArg (DimDecl VName)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Aliasing -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#boundAliases"><span class="hs-identifier hs-var">boundAliases</span></a></span><span> </span><span class="annot"><span class="annottext">Aliasing
</span><a href="#local-6989586621684560427"><span class="hs-identifier hs-var">als</span></a></span><span>
</span><span id="line-1512"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#boundArrayAliases"><span class="hs-identifier hs-var">boundArrayAliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-type">Arrow</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set VName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1513"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#boundArrayAliases"><span class="hs-identifier hs-var">boundArrayAliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Sum"><span class="hs-identifier hs-type">Sum</span></a></span><span> </span><span id="local-6989586621684560426"><span class="annot"><span class="annottext">Map Name [TypeBase (DimDecl VName) Aliasing]
</span><a href="#local-6989586621684560426"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1514"></span><span>  </span><span class="annot"><span class="annottext">[Set VName] -&gt; Set VName
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Set VName] -&gt; Set VName) -&gt; [Set VName] -&gt; Set VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([TypeBase (DimDecl VName) Aliasing] -&gt; [Set VName])
-&gt; [[TypeBase (DimDecl VName) Aliasing]] -&gt; [Set VName]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) Aliasing -&gt; Set VName)
-&gt; [TypeBase (DimDecl VName) Aliasing] -&gt; [Set VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#boundArrayAliases"><span class="hs-identifier hs-var">boundArrayAliases</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([[TypeBase (DimDecl VName) Aliasing]] -&gt; [Set VName])
-&gt; [[TypeBase (DimDecl VName) Aliasing]] -&gt; [Set VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Name [TypeBase (DimDecl VName) Aliasing]
-&gt; [[TypeBase (DimDecl VName) Aliasing]]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">Map Name [TypeBase (DimDecl VName) Aliasing]
</span><a href="#local-6989586621684560426"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-1515"></span><span>
</span><span id="line-1516"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#nothingMustBeUnique"><span class="hs-identifier hs-type">nothingMustBeUnique</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1517"></span><span id="nothingMustBeUnique"><span class="annot"><span class="annottext">nothingMustBeUnique :: SrcLoc -&gt; TypeBase () () -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#nothingMustBeUnique"><span class="hs-identifier hs-var hs-var">nothingMustBeUnique</span></a></span></span><span> </span><span id="local-6989586621684560424"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560424"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase () () -&gt; TermTypeM ()
forall {dim} {as}. TypeBase dim as -&gt; TermTypeM ()
</span><a href="#local-6989586621684560423"><span class="hs-identifier hs-var">check</span></a></span><span>
</span><span id="line-1518"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1519"></span><span>    </span><span id="local-6989586621684560423"><span class="annot"><span class="annottext">check :: TypeBase dim as -&gt; TermTypeM ()
</span><a href="#local-6989586621684560423"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><span class="annottext">as
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Unique"><span class="hs-identifier hs-var">Unique</span></a></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase dim ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ShapeDecl dim
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermTypeM ()
forall {a}. TermTypeM a
</span><a href="#local-6989586621684560415"><span class="hs-identifier hs-var">bad</span></a></span><span>
</span><span id="line-1520"></span><span>    </span><span class="annot"><a href="#local-6989586621684560423"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">as
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Unique"><span class="hs-identifier hs-var">Unique</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TypeArg dim]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermTypeM ()
forall {a}. TermTypeM a
</span><a href="#local-6989586621684560415"><span class="hs-identifier hs-var">bad</span></a></span><span>
</span><span id="line-1521"></span><span>    </span><span class="annot"><a href="#local-6989586621684560423"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span id="local-6989586621684560414"><span class="annot"><span class="annottext">Map Name (TypeBase dim as)
</span><a href="#local-6989586621684560414"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TypeBase dim as -&gt; TermTypeM ())
-&gt; Map Name (TypeBase dim as) -&gt; TermTypeM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">TypeBase dim as -&gt; TermTypeM ()
</span><a href="#local-6989586621684560423"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase dim as)
</span><a href="#local-6989586621684560414"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-1522"></span><span>    </span><span class="annot"><a href="#local-6989586621684560423"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Sum"><span class="hs-identifier hs-type">Sum</span></a></span><span> </span><span id="local-6989586621684560413"><span class="annot"><span class="annottext">Map Name [TypeBase dim as]
</span><a href="#local-6989586621684560413"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([TypeBase dim as] -&gt; TermTypeM ())
-&gt; Map Name [TypeBase dim as] -&gt; TermTypeM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeBase dim as -&gt; TermTypeM ())
-&gt; [TypeBase dim as] -&gt; TermTypeM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">TypeBase dim as -&gt; TermTypeM ()
</span><a href="#local-6989586621684560423"><span class="hs-identifier hs-var">check</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Name [TypeBase dim as]
</span><a href="#local-6989586621684560413"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-1523"></span><span>    </span><span class="annot"><a href="#local-6989586621684560423"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase dim as
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TermTypeM ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1524"></span><span>    </span><span id="local-6989586621684560415"><span class="annot"><span class="annottext">bad :: TermTypeM a
</span><a href="#local-6989586621684560415"><span class="hs-identifier hs-var hs-var">bad</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TermTypeM a
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560424"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;A top-level constant cannot have a unique type.&quot;</span></span><span>
</span><span id="line-1525"></span><span>
</span><span id="line-1526"></span><span class="hs-comment">-- | Verify certain restrictions on function parameters, and bail out</span><span>
</span><span id="line-1527"></span><span class="hs-comment">-- on dubious constructions.</span><span>
</span><span id="line-1528"></span><span class="hs-comment">--</span><span>
</span><span id="line-1529"></span><span class="hs-comment">-- These restrictions apply to all functions (anonymous or otherwise).</span><span>
</span><span id="line-1530"></span><span class="hs-comment">-- Top-level functions have further restrictions that are checked</span><span>
</span><span id="line-1531"></span><span class="hs-comment">-- during let-generalisation.</span><span>
</span><span id="line-1532"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#verifyFunctionParams"><span class="hs-identifier hs-type">verifyFunctionParams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1533"></span><span id="verifyFunctionParams"><span class="annot"><span class="annottext">verifyFunctionParams :: Maybe Name -&gt; [PatBase Info VName] -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.html#verifyFunctionParams"><span class="hs-identifier hs-var hs-var">verifyFunctionParams</span></a></span></span><span> </span><span id="local-6989586621684560408"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621684560408"><span class="hs-identifier hs-var">fname</span></a></span></span><span> </span><span id="local-6989586621684560407"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560407"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1534"></span><span>  </span><span class="annot"><span class="annottext">Checking -&gt; TermTypeM () -&gt; TermTypeM ()
forall a. Checking -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#onFailure"><span class="hs-identifier hs-var">onFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Name -&gt; Checking
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#CheckingParams"><span class="hs-identifier hs-var">CheckingParams</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621684560408"><span class="hs-identifier hs-var">fname</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM () -&gt; TermTypeM ()) -&gt; TermTypeM () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1535"></span><span>    </span><span class="annot"><span class="annottext">Set VName -&gt; [PatBase Info VName] -&gt; TermTypeM ()
forall {m :: * -&gt; *}.
MonadTypeChecker m =&gt;
Set VName -&gt; [PatBase Info VName] -&gt; m ()
</span><a href="#local-6989586621684560405"><span class="hs-identifier hs-var">verifyParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; Set VName)
-&gt; [PatBase Info VName] -&gt; Set VName
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Set VName
forall (f :: * -&gt; *) vn.
(Functor f, Ord vn) =&gt;
PatBase f vn -&gt; Set vn
</span><a href="Language.Futhark.Prop.html#patNames"><span class="hs-identifier hs-var">patNames</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560407"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([PatBase Info VName] -&gt; TermTypeM ())
-&gt; TermTypeM [PatBase Info VName] -&gt; TermTypeM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; TermTypeM (PatBase Info VName))
-&gt; [PatBase Info VName] -&gt; TermTypeM [PatBase Info VName]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall e. ASTMappable e =&gt; e -&gt; TermTypeM e
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#updateTypes"><span class="hs-identifier hs-var">updateTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560407"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-1536"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1537"></span><span>    </span><span id="local-6989586621684560405"><span class="annot"><span class="annottext">verifyParams :: Set VName -&gt; [PatBase Info VName] -&gt; m ()
</span><a href="#local-6989586621684560405"><span class="hs-identifier hs-var hs-var">verifyParams</span></a></span></span><span> </span><span id="local-6989586621684560382"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560382"><span class="hs-identifier hs-var">forbidden</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684560381"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684560381"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684560380"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560380"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1538"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621684560379"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560379"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; [VName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set VName -&gt; [VName]) -&gt; Set VName -&gt; [VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Set VName
</span><a href="Language.Futhark.Prop.html#patternDimNames"><span class="hs-identifier hs-var">patternDimNames</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684560381"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`S.intersection`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560382"><span class="hs-identifier hs-var">forbidden</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1539"></span><span>        </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Notes -&gt; Doc -&gt; m ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684560381"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; m ()) -&gt; (Doc -&gt; Doc) -&gt; Doc -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Language.Futhark.TypeChecker.Monad.html#withIndexLink"><span class="hs-identifier hs-var">withIndexLink</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;inaccessible-size&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; m ()) -&gt; Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1540"></span><span>          </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Parameter&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684560381"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1541"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;refers to size&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Doc
forall v. IsName v =&gt; v -&gt; Doc
</span><a href="Language.Futhark.Pretty.html#pprName"><span class="hs-identifier hs-var">pprName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560379"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1542"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-identifier hs-var">comma</span></span><span>
</span><span id="line-1543"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc
</span><a href="Futhark.Util.Pretty.html#textwrap"><span class="hs-identifier hs-var">textwrap</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;which will not be accessible to the caller&quot;</span></span><span>
</span><span id="line-1544"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-identifier hs-var">comma</span></span><span>
</span><span id="line-1545"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc
</span><a href="Futhark.Util.Pretty.html#textwrap"><span class="hs-identifier hs-var">textwrap</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;possibly because it is nested in a tuple or record.&quot;</span></span><span>
</span><span id="line-1546"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc
</span><a href="Futhark.Util.Pretty.html#textwrap"><span class="hs-identifier hs-var">textwrap</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Consider ascribing an explicit type that does not reference &quot;</span></span><span>
</span><span id="line-1547"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Doc
forall v. IsName v =&gt; v -&gt; Doc
</span><a href="Language.Futhark.Pretty.html#pprName"><span class="hs-identifier hs-var">pprName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560379"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1548"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-1549"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; [PatBase Info VName] -&gt; m ()
</span><a href="#local-6989586621684560405"><span class="hs-identifier hs-var">verifyParams</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560376"><span class="hs-identifier hs-var">forbidden'</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560380"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-1550"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1551"></span><span>        </span><span id="local-6989586621684560376"><span class="annot"><span class="annottext">forbidden' :: Set VName
</span><a href="#local-6989586621684560376"><span class="hs-identifier hs-var hs-var">forbidden'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1552"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; (PName, TypeBase (DimDecl VName) ())
</span><a href="Language.Futhark.Prop.html#patternParam"><span class="hs-identifier hs-var">patternParam</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684560381"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1553"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span id="local-6989586621684560374"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560374"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560382"><span class="hs-identifier hs-var">forbidden</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`S.difference`</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Set VName
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">S.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560374"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1554"></span><span>            </span><span class="annot"><span class="annottext">(PName, TypeBase (DimDecl VName) ())
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560382"><span class="hs-identifier hs-var">forbidden</span></a></span><span>
</span><span id="line-1555"></span><span>    </span><span class="annot"><a href="#local-6989586621684560405"><span class="hs-identifier hs-var">verifyParams</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1556"></span><span>
</span><span id="line-1557"></span><span class="hs-comment">-- | Move existentials down to the level where they are actually used</span><span>
</span><span id="line-1558"></span><span class="hs-comment">-- (i.e. have their &quot;witnesses&quot;).  E.g. changes</span><span>
</span><span id="line-1559"></span><span class="hs-comment">--</span><span>
</span><span id="line-1560"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-1561"></span><span class="hs-comment">-- ?[n].bool -&gt; [n]bool</span><span>
</span><span id="line-1562"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-1563"></span><span class="hs-comment">--</span><span>
</span><span id="line-1564"></span><span class="hs-comment">-- to</span><span>
</span><span id="line-1565"></span><span class="hs-comment">--</span><span>
</span><span id="line-1566"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-1567"></span><span class="hs-comment">-- bool -&gt; ?[n].[n]bool</span><span>
</span><span id="line-1568"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-1569"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#injectExt"><span class="hs-identifier hs-type">injectExt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#StructType"><span class="hs-identifier hs-type">StructType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#StructRetType"><span class="hs-identifier hs-type">StructRetType</span></a></span><span>
</span><span id="line-1570"></span><span id="injectExt"><span class="annot"><span class="annottext">injectExt :: [VName] -&gt; TypeBase (DimDecl VName) () -&gt; StructRetType
</span><a href="Language.Futhark.TypeChecker.Terms.html#injectExt"><span class="hs-identifier hs-var hs-var">injectExt</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621684560372"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560372"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; TypeBase (DimDecl VName) () -&gt; StructRetType
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560372"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-1571"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#injectExt"><span class="hs-identifier hs-var">injectExt</span></a></span><span> </span><span id="local-6989586621684560371"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684560371"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span id="local-6989586621684560370"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560370"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; TypeBase (DimDecl VName) () -&gt; StructRetType
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684560369"><span class="hs-identifier hs-var">ext_here</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) () -&gt; StructRetType)
-&gt; TypeBase (DimDecl VName) () -&gt; StructRetType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560368"><span class="hs-identifier hs-var">deeper</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560370"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-1572"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1573"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684560367"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560367"><span class="hs-identifier hs-var">immediate</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set VName
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; (Set VName, Set VName)
</span><a href="Language.Futhark.TypeChecker.Terms.html#dimUses"><span class="hs-identifier hs-var">dimUses</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560370"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-1574"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684560369"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684560369"><span class="hs-identifier hs-var">ext_here</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560365"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684560365"><span class="hs-identifier hs-var">ext_there</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Bool) -&gt; [VName] -&gt; ([VName], [VName])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">partition</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560367"><span class="hs-identifier hs-var">immediate</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684560371"><span class="hs-identifier hs-var">ext</span></a></span><span>
</span><span id="line-1575"></span><span>    </span><span id="local-6989586621684560368"><span class="annot"><span class="annottext">deeper :: TypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560368"><span class="hs-identifier hs-var hs-var">deeper</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span id="local-6989586621684560362"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684560362"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ())
-&gt; ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as. PrimType -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684560362"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1576"></span><span>    </span><span class="annot"><a href="#local-6989586621684560368"><span class="hs-identifier hs-var">deeper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span id="local-6989586621684560361"><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) ())
</span><a href="#local-6989586621684560361"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ())
-&gt; ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) ())
-&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as. Map Name (TypeBase dim as) -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-var">Record</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Name (TypeBase (DimDecl VName) ())
 -&gt; ScalarTypeBase (DimDecl VName) ())
-&gt; Map Name (TypeBase (DimDecl VName) ())
-&gt; ScalarTypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ())
-&gt; Map Name (TypeBase (DimDecl VName) ())
-&gt; Map Name (TypeBase (DimDecl VName) ())
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560368"><span class="hs-identifier hs-var">deeper</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (TypeBase (DimDecl VName) ())
</span><a href="#local-6989586621684560361"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-1577"></span><span>    </span><span class="annot"><a href="#local-6989586621684560368"><span class="hs-identifier hs-var">deeper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Sum"><span class="hs-identifier hs-type">Sum</span></a></span><span> </span><span id="local-6989586621684560360"><span class="annot"><span class="annottext">Map Name [TypeBase (DimDecl VName) ()]
</span><a href="#local-6989586621684560360"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ())
-&gt; ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Name [TypeBase (DimDecl VName) ()]
-&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as. Map Name [TypeBase dim as] -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Sum"><span class="hs-identifier hs-var">Sum</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Name [TypeBase (DimDecl VName) ()]
 -&gt; ScalarTypeBase (DimDecl VName) ())
-&gt; Map Name [TypeBase (DimDecl VName) ()]
-&gt; ScalarTypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([TypeBase (DimDecl VName) ()] -&gt; [TypeBase (DimDecl VName) ()])
-&gt; Map Name [TypeBase (DimDecl VName) ()]
-&gt; Map Name [TypeBase (DimDecl VName) ()]
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ())
-&gt; [TypeBase (DimDecl VName) ()] -&gt; [TypeBase (DimDecl VName) ()]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560368"><span class="hs-identifier hs-var">deeper</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Name [TypeBase (DimDecl VName) ()]
</span><a href="#local-6989586621684560360"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-1578"></span><span>    </span><span class="annot"><a href="#local-6989586621684560368"><span class="hs-identifier hs-var">deeper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-type">Arrow</span></a></span><span> </span><span id="local-6989586621684560359"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621684560359"><span class="hs-identifier hs-var">als</span></a></span></span><span> </span><span id="local-6989586621684560358"><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684560358"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621684560357"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560357"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-type">RetType</span></a></span><span> </span><span id="local-6989586621684560356"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684560356"><span class="hs-identifier hs-var">t2_ext</span></a></span></span><span> </span><span id="local-6989586621684560355"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560355"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1579"></span><span>      </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ())
-&gt; ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">()
-&gt; PName
-&gt; TypeBase (DimDecl VName) ()
-&gt; StructRetType
-&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as.
as
-&gt; PName
-&gt; TypeBase dim as
-&gt; RetTypeBase dim as
-&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-var">Arrow</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621684560359"><span class="hs-identifier hs-var">als</span></a></span><span> </span><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684560358"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560357"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">(StructRetType -&gt; ScalarTypeBase (DimDecl VName) ())
-&gt; StructRetType -&gt; ScalarTypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; TypeBase (DimDecl VName) () -&gt; StructRetType
</span><a href="Language.Futhark.TypeChecker.Terms.html#injectExt"><span class="hs-identifier hs-var">injectExt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684560365"><span class="hs-identifier hs-var">ext_there</span></a></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; [VName] -&gt; [VName]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684560356"><span class="hs-identifier hs-var">t2_ext</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560355"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-1580"></span><span>    </span><span class="annot"><a href="#local-6989586621684560368"><span class="hs-identifier hs-var">deeper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span id="local-6989586621684560354"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621684560354"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span id="local-6989586621684560353"><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684560353"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621684560352"><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621684560352"><span class="hs-identifier hs-var">tn</span></a></span></span><span> </span><span id="local-6989586621684560351"><span class="annot"><span class="annottext">[TypeArg (DimDecl VName)]
</span><a href="#local-6989586621684560351"><span class="hs-identifier hs-var">targs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1581"></span><span>      </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ())
-&gt; ScalarTypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">()
-&gt; Uniqueness
-&gt; TypeName
-&gt; [TypeArg (DimDecl VName)]
-&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as.
as
-&gt; Uniqueness -&gt; TypeName -&gt; [TypeArg dim] -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621684560354"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684560353"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621684560352"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">([TypeArg (DimDecl VName)] -&gt; ScalarTypeBase (DimDecl VName) ())
-&gt; [TypeArg (DimDecl VName)] -&gt; ScalarTypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TypeArg (DimDecl VName) -&gt; TypeArg (DimDecl VName))
-&gt; [TypeArg (DimDecl VName)] -&gt; [TypeArg (DimDecl VName)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TypeArg (DimDecl VName) -&gt; TypeArg (DimDecl VName)
</span><a href="#local-6989586621684560350"><span class="hs-identifier hs-var">deeperArg</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeArg (DimDecl VName)]
</span><a href="#local-6989586621684560351"><span class="hs-identifier hs-var">targs</span></a></span><span>
</span><span id="line-1582"></span><span>    </span><span class="annot"><a href="#local-6989586621684560368"><span class="hs-identifier hs-var">deeper</span></a></span><span> </span><span id="local-6989586621684560349"><span class="annot"><span class="annottext">t :: TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560349"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Language.Futhark.Syntax.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560349"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1583"></span><span>
</span><span id="line-1584"></span><span>    </span><span id="local-6989586621684560350"><span class="annot"><span class="annottext">deeperArg :: TypeArg (DimDecl VName) -&gt; TypeArg (DimDecl VName)
</span><a href="#local-6989586621684560350"><span class="hs-identifier hs-var hs-var">deeperArg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeArgType"><span class="hs-identifier hs-type">TypeArgType</span></a></span><span> </span><span id="local-6989586621684560348"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560348"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621684560347"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560347"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; SrcLoc -&gt; TypeArg (DimDecl VName)
forall dim. TypeBase dim () -&gt; SrcLoc -&gt; TypeArg dim
</span><a href="Language.Futhark.Syntax.html#TypeArgType"><span class="hs-identifier hs-var">TypeArgType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560368"><span class="hs-identifier hs-var">deeper</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560348"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560347"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-1585"></span><span>    </span><span class="annot"><a href="#local-6989586621684560350"><span class="hs-identifier hs-var">deeperArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeArgDim"><span class="hs-identifier hs-type">TypeArgDim</span></a></span><span> </span><span id="local-6989586621684560346"><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684560346"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621684560345"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560345"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DimDecl VName -&gt; SrcLoc -&gt; TypeArg (DimDecl VName)
forall dim. dim -&gt; SrcLoc -&gt; TypeArg dim
</span><a href="Language.Futhark.Syntax.html#TypeArgDim"><span class="hs-identifier hs-var">TypeArgDim</span></a></span><span> </span><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684560346"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560345"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-1586"></span><span>
</span><span id="line-1587"></span><span class="hs-comment">-- | Find all type variables in the given type that are covered by the</span><span>
</span><span id="line-1588"></span><span class="hs-comment">-- constraints, and produce type parameters that close over them.</span><span>
</span><span id="line-1589"></span><span class="hs-comment">--</span><span>
</span><span id="line-1590"></span><span class="hs-comment">-- The passed-in list of type parameters is always prepended to the</span><span>
</span><span id="line-1591"></span><span class="hs-comment">-- produced list of type parameters.</span><span>
</span><span id="line-1592"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#closeOverTypes"><span class="hs-identifier hs-type">closeOverTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1593"></span><span>  </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1594"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1595"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#TypeParam"><span class="hs-identifier hs-type">TypeParam</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1596"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Syntax.html#StructType"><span class="hs-identifier hs-type">StructType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1597"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#StructType"><span class="hs-identifier hs-type">StructType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1598"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#Constraints"><span class="hs-identifier hs-type">Constraints</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1599"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#TypeParam"><span class="hs-identifier hs-type">TypeParam</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#StructRetType"><span class="hs-identifier hs-type">StructRetType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1600"></span><span id="closeOverTypes"><span class="annot"><span class="annottext">closeOverTypes :: Name
-&gt; SrcLoc
-&gt; [TypeParamBase VName]
-&gt; [TypeBase (DimDecl VName) ()]
-&gt; TypeBase (DimDecl VName) ()
-&gt; Constraints
-&gt; TermTypeM ([TypeParamBase VName], StructRetType)
</span><a href="Language.Futhark.TypeChecker.Terms.html#closeOverTypes"><span class="hs-identifier hs-var hs-var">closeOverTypes</span></a></span></span><span> </span><span id="local-6989586621684560343"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684560343"><span class="hs-identifier hs-var">defname</span></a></span></span><span> </span><span id="local-6989586621684560342"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560342"><span class="hs-identifier hs-var">defloc</span></a></span></span><span> </span><span id="local-6989586621684560341"><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684560341"><span class="hs-identifier hs-var">tparams</span></a></span></span><span> </span><span id="local-6989586621684560340"><span class="annot"><span class="annottext">[TypeBase (DimDecl VName) ()]
</span><a href="#local-6989586621684560340"><span class="hs-identifier hs-var">paramts</span></a></span></span><span> </span><span id="local-6989586621684560339"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560339"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span id="local-6989586621684560338"><span class="annot"><span class="annottext">Constraints
</span><a href="#local-6989586621684560338"><span class="hs-identifier hs-var">substs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1601"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684560337"><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684560337"><span class="hs-identifier hs-var">more_tparams</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560336"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684560336"><span class="hs-identifier hs-var">retext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1602"></span><span>    </span><span class="annot"><span class="annottext">[Either (TypeParamBase VName) VName]
-&gt; ([TypeParamBase VName], [VName])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span> </span><span class="annot"><span class="annottext">([Either (TypeParamBase VName) VName]
 -&gt; ([TypeParamBase VName], [VName]))
-&gt; ([Maybe (Either (TypeParamBase VName) VName)]
    -&gt; [Either (TypeParamBase VName) VName])
-&gt; [Maybe (Either (TypeParamBase VName) VName)]
-&gt; ([TypeParamBase VName], [VName])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Maybe (Either (TypeParamBase VName) VName)]
-&gt; [Either (TypeParamBase VName) VName]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span>
</span><span id="line-1603"></span><span>      </span><span class="annot"><span class="annottext">([Maybe (Either (TypeParamBase VName) VName)]
 -&gt; ([TypeParamBase VName], [VName]))
-&gt; TermTypeM [Maybe (Either (TypeParamBase VName) VName)]
-&gt; TermTypeM ([TypeParamBase VName], [VName])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">((VName, Constraint)
 -&gt; TermTypeM (Maybe (Either (TypeParamBase VName) VName)))
-&gt; [(VName, Constraint)]
-&gt; TermTypeM [Maybe (Either (TypeParamBase VName) VName)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">(VName, Constraint)
-&gt; TermTypeM (Maybe (Either (TypeParamBase VName) VName))
forall {f :: * -&gt; *}.
(MonadUnify f, MonadTypeChecker f) =&gt;
(VName, Constraint)
-&gt; f (Maybe (Either (TypeParamBase VName) VName))
</span><a href="#local-6989586621684560334"><span class="hs-identifier hs-var">closeOver</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map VName Constraint -&gt; [(VName, Constraint)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map VName Constraint -&gt; [(VName, Constraint)])
-&gt; Map VName Constraint -&gt; [(VName, Constraint)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Int, Constraint) -&gt; Constraint)
-&gt; Constraints -&gt; Map VName Constraint
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="annot"><span class="annottext">(Int, Constraint) -&gt; Constraint
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">Constraints
</span><a href="#local-6989586621684560333"><span class="hs-identifier hs-var">to_close_over</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1604"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684560329"><span class="annot"><span class="annottext">mkExt :: DimDecl VName -&gt; Maybe VName
</span><a href="#local-6989586621684560329"><span class="hs-identifier hs-var hs-var">mkExt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#NamedDim"><span class="hs-identifier hs-type">NamedDim</span></a></span><span> </span><span id="local-6989586621684560328"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684560328"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1605"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Constraints -&gt; Maybe (Int, Constraint)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName VName -&gt; VName
forall vn. QualName vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#qualLeaf"><span class="hs-identifier hs-var hs-var">qualLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684560328"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Constraints
</span><a href="#local-6989586621684560338"><span class="hs-identifier hs-var">substs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1606"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#UnknowableSize"><span class="hs-identifier hs-type">UnknowableSize</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Maybe VName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Maybe VName) -&gt; VName -&gt; Maybe VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; VName
forall vn. QualName vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#qualLeaf"><span class="hs-identifier hs-var hs-var">qualLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684560328"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1607"></span><span>          </span><span class="annot"><span class="annottext">Maybe (Int, Constraint)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe VName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1608"></span><span>      </span><span class="annot"><a href="#local-6989586621684560329"><span class="hs-identifier hs-var">mkExt</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#ConstDim"><span class="hs-identifier hs-type">ConstDim</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe VName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1609"></span><span>      </span><span class="annot"><a href="#local-6989586621684560329"><span class="hs-identifier hs-var">mkExt</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#AnyDim"><span class="hs-identifier hs-type">AnyDim</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe VName
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;closeOverTypes: AnyDim&quot;</span></span><span>
</span><span id="line-1610"></span><span>  </span><span class="annot"><span class="annottext">([TypeParamBase VName], StructRetType)
-&gt; TermTypeM ([TypeParamBase VName], StructRetType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-1611"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684560341"><span class="hs-identifier hs-var">tparams</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
-&gt; [TypeParamBase VName] -&gt; [TypeParamBase VName]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684560337"><span class="hs-identifier hs-var">more_tparams</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1612"></span><span>      </span><span class="annot"><span class="annottext">[VName] -&gt; TypeBase (DimDecl VName) () -&gt; StructRetType
</span><a href="Language.Futhark.TypeChecker.Terms.html#injectExt"><span class="hs-identifier hs-var">injectExt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684560336"><span class="hs-identifier hs-var">retext</span></a></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; [VName] -&gt; [VName]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(DimDecl VName -&gt; Maybe VName) -&gt; [DimDecl VName] -&gt; [VName]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">DimDecl VName -&gt; Maybe VName
</span><a href="#local-6989586621684560329"><span class="hs-identifier hs-var">mkExt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; [DimDecl VName]
forall as. TypeBase (DimDecl VName) as -&gt; [DimDecl VName]
</span><a href="Language.Futhark.Prop.html#nestedDims"><span class="hs-identifier hs-var">nestedDims</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560339"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560339"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-1613"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-1614"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1615"></span><span>    </span><span id="local-6989586621684560325"><span class="annot"><span class="annottext">t :: TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560325"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TypeBase (DimDecl VName) ()]
-&gt; StructRetType -&gt; TypeBase (DimDecl VName) ()
forall as dim.
Monoid as =&gt;
[TypeBase dim as] -&gt; RetTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Prop.html#foldFunType"><span class="hs-identifier hs-var">foldFunType</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeBase (DimDecl VName) ()]
</span><a href="#local-6989586621684560340"><span class="hs-identifier hs-var">paramts</span></a></span><span> </span><span class="annot"><span class="annottext">(StructRetType -&gt; TypeBase (DimDecl VName) ())
-&gt; StructRetType -&gt; TypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; TypeBase (DimDecl VName) () -&gt; StructRetType
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560339"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-1616"></span><span>    </span><span id="local-6989586621684560333"><span class="annot"><span class="annottext">to_close_over :: Constraints
</span><a href="#local-6989586621684560333"><span class="hs-identifier hs-var hs-var">to_close_over</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; (Int, Constraint) -&gt; Bool) -&gt; Constraints -&gt; Constraints
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621684560323"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560323"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="annot"><span class="annottext">(Int, Constraint)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560323"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560322"><span class="hs-identifier hs-var">visible</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Constraints
</span><a href="#local-6989586621684560338"><span class="hs-identifier hs-var">substs</span></a></span><span>
</span><span id="line-1617"></span><span>    </span><span id="local-6989586621684560322"><span class="annot"><span class="annottext">visible :: Set VName
</span><a href="#local-6989586621684560322"><span class="hs-identifier hs-var hs-var">visible</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; Set VName
forall as dim. Monoid as =&gt; TypeBase dim as -&gt; Set VName
</span><a href="Language.Futhark.Prop.html#typeVars"><span class="hs-identifier hs-var">typeVars</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560325"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; Set VName
forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="Language.Futhark.Prop.html#typeDimNames"><span class="hs-identifier hs-var">typeDimNames</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560325"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1618"></span><span>
</span><span id="line-1619"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684560318"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560318"><span class="hs-identifier hs-var">produced_sizes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684560317"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560317"><span class="hs-identifier hs-var">param_sizes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; (Set VName, Set VName)
</span><a href="Language.Futhark.TypeChecker.Terms.html#dimUses"><span class="hs-identifier hs-var">dimUses</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560325"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1620"></span><span>
</span><span id="line-1621"></span><span>    </span><span class="hs-comment">-- Avoid duplicate type parameters.</span><span>
</span><span id="line-1622"></span><span>    </span><span id="local-6989586621684560334"><span class="annot"><span class="annottext">closeOver :: (VName, Constraint)
-&gt; f (Maybe (Either (TypeParamBase VName) VName))
</span><a href="#local-6989586621684560334"><span class="hs-identifier hs-var hs-var">closeOver</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684560285"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560285"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constraint
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1623"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560285"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; [VName] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">(TypeParamBase VName -&gt; VName) -&gt; [TypeParamBase VName] -&gt; [VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TypeParamBase VName -&gt; VName
forall vn. TypeParamBase vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#typeParamName"><span class="hs-identifier hs-var">typeParamName</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684560341"><span class="hs-identifier hs-var">tparams</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1624"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Either (TypeParamBase VName) VName)
-&gt; f (Maybe (Either (TypeParamBase VName) VName))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Either (TypeParamBase VName) VName)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1625"></span><span>    </span><span class="annot"><a href="#local-6989586621684560334"><span class="hs-identifier hs-var">closeOver</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684560283"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560283"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#NoConstraint"><span class="hs-identifier hs-type">NoConstraint</span></a></span><span> </span><span id="local-6989586621684560282"><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684560282"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621684560281"><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560281"><span class="hs-identifier hs-var">usage</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1626"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Either (TypeParamBase VName) VName)
-&gt; f (Maybe (Either (TypeParamBase VName) VName))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Either (TypeParamBase VName) VName)
 -&gt; f (Maybe (Either (TypeParamBase VName) VName)))
-&gt; Maybe (Either (TypeParamBase VName) VName)
-&gt; f (Maybe (Either (TypeParamBase VName) VName))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Either (TypeParamBase VName) VName
-&gt; Maybe (Either (TypeParamBase VName) VName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Either (TypeParamBase VName) VName
 -&gt; Maybe (Either (TypeParamBase VName) VName))
-&gt; Either (TypeParamBase VName) VName
-&gt; Maybe (Either (TypeParamBase VName) VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeParamBase VName -&gt; Either (TypeParamBase VName) VName
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(TypeParamBase VName -&gt; Either (TypeParamBase VName) VName)
-&gt; TypeParamBase VName -&gt; Either (TypeParamBase VName) VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Liftedness -&gt; VName -&gt; SrcLoc -&gt; TypeParamBase VName
forall vn. Liftedness -&gt; vn -&gt; SrcLoc -&gt; TypeParamBase vn
</span><a href="Language.Futhark.Syntax.html#TypeParamType"><span class="hs-identifier hs-var">TypeParamType</span></a></span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684560282"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560283"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">(SrcLoc -&gt; TypeParamBase VName) -&gt; SrcLoc -&gt; TypeParamBase VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Usage -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560281"><span class="hs-identifier hs-var">usage</span></a></span><span>
</span><span id="line-1627"></span><span>    </span><span class="annot"><a href="#local-6989586621684560334"><span class="hs-identifier hs-var">closeOver</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684560279"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560279"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#ParamType"><span class="hs-identifier hs-type">ParamType</span></a></span><span> </span><span id="local-6989586621684560277"><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684560277"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621684560276"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560276"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1628"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Either (TypeParamBase VName) VName)
-&gt; f (Maybe (Either (TypeParamBase VName) VName))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Either (TypeParamBase VName) VName)
 -&gt; f (Maybe (Either (TypeParamBase VName) VName)))
-&gt; Maybe (Either (TypeParamBase VName) VName)
-&gt; f (Maybe (Either (TypeParamBase VName) VName))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Either (TypeParamBase VName) VName
-&gt; Maybe (Either (TypeParamBase VName) VName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Either (TypeParamBase VName) VName
 -&gt; Maybe (Either (TypeParamBase VName) VName))
-&gt; Either (TypeParamBase VName) VName
-&gt; Maybe (Either (TypeParamBase VName) VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeParamBase VName -&gt; Either (TypeParamBase VName) VName
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(TypeParamBase VName -&gt; Either (TypeParamBase VName) VName)
-&gt; TypeParamBase VName -&gt; Either (TypeParamBase VName) VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Liftedness -&gt; VName -&gt; SrcLoc -&gt; TypeParamBase VName
forall vn. Liftedness -&gt; vn -&gt; SrcLoc -&gt; TypeParamBase vn
</span><a href="Language.Futhark.Syntax.html#TypeParamType"><span class="hs-identifier hs-var">TypeParamType</span></a></span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684560277"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560279"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560276"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-1629"></span><span>    </span><span class="annot"><a href="#local-6989586621684560334"><span class="hs-identifier hs-var">closeOver</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684560275"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560275"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (DimDecl VName)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span id="local-6989586621684560274"><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560274"><span class="hs-identifier hs-var">usage</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1630"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Either (TypeParamBase VName) VName)
-&gt; f (Maybe (Either (TypeParamBase VName) VName))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Either (TypeParamBase VName) VName)
 -&gt; f (Maybe (Either (TypeParamBase VName) VName)))
-&gt; Maybe (Either (TypeParamBase VName) VName)
-&gt; f (Maybe (Either (TypeParamBase VName) VName))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Either (TypeParamBase VName) VName
-&gt; Maybe (Either (TypeParamBase VName) VName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Either (TypeParamBase VName) VName
 -&gt; Maybe (Either (TypeParamBase VName) VName))
-&gt; Either (TypeParamBase VName) VName
-&gt; Maybe (Either (TypeParamBase VName) VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeParamBase VName -&gt; Either (TypeParamBase VName) VName
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(TypeParamBase VName -&gt; Either (TypeParamBase VName) VName)
-&gt; TypeParamBase VName -&gt; Either (TypeParamBase VName) VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; SrcLoc -&gt; TypeParamBase VName
forall vn. vn -&gt; SrcLoc -&gt; TypeParamBase vn
</span><a href="Language.Futhark.Syntax.html#TypeParamDim"><span class="hs-identifier hs-var">TypeParamDim</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560275"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">(SrcLoc -&gt; TypeParamBase VName) -&gt; SrcLoc -&gt; TypeParamBase VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Usage -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560274"><span class="hs-identifier hs-var">usage</span></a></span><span>
</span><span id="line-1631"></span><span>    </span><span class="annot"><a href="#local-6989586621684560334"><span class="hs-identifier hs-var">closeOver</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684560272"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560272"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#UnknowableSize"><span class="hs-identifier hs-type">UnknowableSize</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RigidSource
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1632"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560272"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560317"><span class="hs-identifier hs-var">param_sizes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1633"></span><span>        </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560272"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.notMember`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560318"><span class="hs-identifier hs-var">produced_sizes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1634"></span><span>        </span><span id="local-6989586621684560271"><span class="annot"><span class="annottext">Notes
</span><a href="#local-6989586621684560271"><span class="hs-identifier hs-var">notes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; DimDecl VName -&gt; f Notes
forall a (m :: * -&gt; *).
(Located a, MonadUnify m) =&gt;
a -&gt; DimDecl VName -&gt; m Notes
</span><a href="Language.Futhark.TypeChecker.Unify.html#dimNotes"><span class="hs-identifier hs-var">dimNotes</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560342"><span class="hs-identifier hs-var">defloc</span></a></span><span> </span><span class="annot"><span class="annottext">(DimDecl VName -&gt; f Notes) -&gt; DimDecl VName -&gt; f Notes
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; DimDecl VName
forall vn. QualName vn -&gt; DimDecl vn
</span><a href="Language.Futhark.Syntax.html#NamedDim"><span class="hs-identifier hs-var">NamedDim</span></a></span><span> </span><span class="annot"><span class="annottext">(QualName VName -&gt; DimDecl VName)
-&gt; QualName VName -&gt; DimDecl VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560272"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-1635"></span><span>        </span><span class="annot"><span class="annottext">SrcLoc
-&gt; Notes -&gt; Doc -&gt; f (Maybe (Either (TypeParamBase VName) VName))
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560342"><span class="hs-identifier hs-var">defloc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
</span><a href="#local-6989586621684560271"><span class="hs-identifier hs-var">notes</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; f (Maybe (Either (TypeParamBase VName) VName)))
-&gt; (Doc -&gt; Doc)
-&gt; Doc
-&gt; f (Maybe (Either (TypeParamBase VName) VName))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Language.Futhark.TypeChecker.Monad.html#withIndexLink"><span class="hs-identifier hs-var">withIndexLink</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;unknowable-param-def&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; f (Maybe (Either (TypeParamBase VName) VName)))
-&gt; Doc -&gt; f (Maybe (Either (TypeParamBase VName) VName))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1636"></span><span>          </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Unknowable size&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Doc
forall v. IsName v =&gt; v -&gt; Doc
</span><a href="Language.Futhark.Pretty.html#pprName"><span class="hs-identifier hs-var">pprName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560272"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1637"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;in parameter of&quot;</span></span><span>
</span><span id="line-1638"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Doc
forall v. IsName v =&gt; v -&gt; Doc
</span><a href="Language.Futhark.Pretty.html#pprName"><span class="hs-identifier hs-var">pprName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684560343"><span class="hs-identifier hs-var">defname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1639"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;, which is inferred as:&quot;</span></span><span>
</span><span id="line-1640"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
</span><span class="hs-identifier hs-var">indent</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560325"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1641"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560272"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560318"><span class="hs-identifier hs-var">produced_sizes</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1642"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Either (TypeParamBase VName) VName)
-&gt; f (Maybe (Either (TypeParamBase VName) VName))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Either (TypeParamBase VName) VName)
 -&gt; f (Maybe (Either (TypeParamBase VName) VName)))
-&gt; Maybe (Either (TypeParamBase VName) VName)
-&gt; f (Maybe (Either (TypeParamBase VName) VName))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Either (TypeParamBase VName) VName
-&gt; Maybe (Either (TypeParamBase VName) VName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Either (TypeParamBase VName) VName
 -&gt; Maybe (Either (TypeParamBase VName) VName))
-&gt; Either (TypeParamBase VName) VName
-&gt; Maybe (Either (TypeParamBase VName) VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Either (TypeParamBase VName) VName
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560272"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-1643"></span><span>    </span><span class="annot"><a href="#local-6989586621684560334"><span class="hs-identifier hs-var">closeOver</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constraint
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1644"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Either (TypeParamBase VName) VName)
-&gt; f (Maybe (Either (TypeParamBase VName) VName))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Either (TypeParamBase VName) VName)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1645"></span><span>
</span><span id="line-1646"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#letGeneralise"><span class="hs-identifier hs-type">letGeneralise</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1647"></span><span>  </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1648"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1649"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#TypeParam"><span class="hs-identifier hs-type">TypeParam</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1650"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1651"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#StructType"><span class="hs-identifier hs-type">StructType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1652"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#TypeParam"><span class="hs-identifier hs-type">TypeParam</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#StructRetType"><span class="hs-identifier hs-type">StructRetType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1653"></span><span id="letGeneralise"><span class="annot"><span class="annottext">letGeneralise :: Name
-&gt; SrcLoc
-&gt; [TypeParamBase VName]
-&gt; [PatBase Info VName]
-&gt; TypeBase (DimDecl VName) ()
-&gt; TermTypeM
     ([TypeParamBase VName], [PatBase Info VName], StructRetType)
</span><a href="Language.Futhark.TypeChecker.Terms.html#letGeneralise"><span class="hs-identifier hs-var hs-var">letGeneralise</span></a></span></span><span> </span><span id="local-6989586621684560269"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684560269"><span class="hs-identifier hs-var">defname</span></a></span></span><span> </span><span id="local-6989586621684560268"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560268"><span class="hs-identifier hs-var">defloc</span></a></span></span><span> </span><span id="local-6989586621684560267"><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684560267"><span class="hs-identifier hs-var">tparams</span></a></span></span><span> </span><span id="local-6989586621684560266"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560266"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621684560265"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560265"><span class="hs-identifier hs-var">rettype</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1654"></span><span>  </span><span class="annot"><span class="annottext">Checking
-&gt; TermTypeM
     ([TypeParamBase VName], [PatBase Info VName], StructRetType)
-&gt; TermTypeM
     ([TypeParamBase VName], [PatBase Info VName], StructRetType)
forall a. Checking -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#onFailure"><span class="hs-identifier hs-var">onFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Checking
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#CheckingLetGeneralise"><span class="hs-identifier hs-var">CheckingLetGeneralise</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684560269"><span class="hs-identifier hs-var">defname</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM
   ([TypeParamBase VName], [PatBase Info VName], StructRetType)
 -&gt; TermTypeM
      ([TypeParamBase VName], [PatBase Info VName], StructRetType))
-&gt; TermTypeM
     ([TypeParamBase VName], [PatBase Info VName], StructRetType)
-&gt; TermTypeM
     ([TypeParamBase VName], [PatBase Info VName], StructRetType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1655"></span><span>    </span><span id="local-6989586621684560263"><span class="annot"><span class="annottext">Constraints
</span><a href="#local-6989586621684560263"><span class="hs-identifier hs-var">now_substs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TermTypeM Constraints
forall (m :: * -&gt; *). MonadUnify m =&gt; m Constraints
</span><a href="Language.Futhark.TypeChecker.Unify.html#getConstraints"><span class="hs-identifier hs-var">getConstraints</span></a></span><span>
</span><span id="line-1656"></span><span>
</span><span id="line-1657"></span><span>    </span><span class="hs-comment">-- Candidates for let-generalisation are those type variables that</span><span>
</span><span id="line-1658"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1659"></span><span>    </span><span class="hs-comment">-- (1) were not known before we checked this function, and</span><span>
</span><span id="line-1660"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1661"></span><span>    </span><span class="hs-comment">-- (2) are not used in the (new) definition of any type variables</span><span>
</span><span id="line-1662"></span><span>    </span><span class="hs-comment">-- known before we checked this function.</span><span>
</span><span id="line-1663"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1664"></span><span>    </span><span class="hs-comment">-- (3) are not referenced from an overloaded type (for example,</span><span>
</span><span id="line-1665"></span><span>    </span><span class="hs-comment">-- are the element types of an incompletely resolved record type).</span><span>
</span><span id="line-1666"></span><span>    </span><span class="hs-comment">-- This is a bit more restrictive than I'd like, and SML for</span><span>
</span><span id="line-1667"></span><span>    </span><span class="hs-comment">-- example does not have this restriction.</span><span>
</span><span id="line-1668"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1669"></span><span>    </span><span class="hs-comment">-- Criteria (1) and (2) is implemented by looking at the binding</span><span>
</span><span id="line-1670"></span><span>    </span><span class="hs-comment">-- level of the type variables.</span><span>
</span><span id="line-1671"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684560262"><span class="annot"><span class="annottext">keep_type_vars :: Set VName
</span><a href="#local-6989586621684560262"><span class="hs-identifier hs-var hs-var">keep_type_vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constraints -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#overloadedTypeVars"><span class="hs-identifier hs-var">overloadedTypeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Constraints
</span><a href="#local-6989586621684560263"><span class="hs-identifier hs-var">now_substs</span></a></span><span>
</span><span id="line-1672"></span><span>
</span><span id="line-1673"></span><span>    </span><span id="local-6989586621684560261"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684560261"><span class="hs-identifier hs-var">cur_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TermTypeM Int
forall (m :: * -&gt; *). MonadUnify m =&gt; m Int
</span><a href="Language.Futhark.TypeChecker.Unify.html#curLevel"><span class="hs-identifier hs-var">curLevel</span></a></span><span>
</span><span id="line-1674"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684560258"><span class="annot"><span class="annottext">candidate :: VName -&gt; (Int, b) -&gt; Bool
</span><a href="#local-6989586621684560258"><span class="hs-identifier hs-var hs-var">candidate</span></a></span></span><span> </span><span id="local-6989586621684560257"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560257"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684560256"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684560256"><span class="hs-identifier hs-var">lvl</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560257"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.notMember`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560262"><span class="hs-identifier hs-var">keep_type_vars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684560256"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684560261"><span class="hs-identifier hs-var">cur_lvl</span></a></span><span>
</span><span id="line-1675"></span><span>        </span><span id="local-6989586621684560255"><span class="annot"><span class="annottext">new_substs :: Constraints
</span><a href="#local-6989586621684560255"><span class="hs-identifier hs-var hs-var">new_substs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; (Int, Constraint) -&gt; Bool) -&gt; Constraints -&gt; Constraints
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.filterWithKey</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; (Int, Constraint) -&gt; Bool
forall {b}. VName -&gt; (Int, b) -&gt; Bool
</span><a href="#local-6989586621684560258"><span class="hs-identifier hs-var">candidate</span></a></span><span> </span><span class="annot"><span class="annottext">Constraints
</span><a href="#local-6989586621684560263"><span class="hs-identifier hs-var">now_substs</span></a></span><span>
</span><span id="line-1676"></span><span>
</span><span id="line-1677"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684560254"><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684560254"><span class="hs-identifier hs-var">tparams'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-type">RetType</span></a></span><span> </span><span id="local-6989586621684560253"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684560253"><span class="hs-identifier hs-var">ret_dims</span></a></span></span><span> </span><span id="local-6989586621684560252"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560252"><span class="hs-identifier hs-var">rettype'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1678"></span><span>      </span><span class="annot"><span class="annottext">Name
-&gt; SrcLoc
-&gt; [TypeParamBase VName]
-&gt; [TypeBase (DimDecl VName) ()]
-&gt; TypeBase (DimDecl VName) ()
-&gt; Constraints
-&gt; TermTypeM ([TypeParamBase VName], StructRetType)
</span><a href="Language.Futhark.TypeChecker.Terms.html#closeOverTypes"><span class="hs-identifier hs-var">closeOverTypes</span></a></span><span>
</span><span id="line-1679"></span><span>        </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684560269"><span class="hs-identifier hs-var">defname</span></a></span><span>
</span><span id="line-1680"></span><span>        </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560268"><span class="hs-identifier hs-var">defloc</span></a></span><span>
</span><span id="line-1681"></span><span>        </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684560267"><span class="hs-identifier hs-var">tparams</span></a></span><span>
</span><span id="line-1682"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; TypeBase (DimDecl VName) ())
-&gt; [PatBase Info VName] -&gt; [TypeBase (DimDecl VName) ()]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; TypeBase (DimDecl VName) ()
</span><a href="Language.Futhark.Prop.html#patternStructType"><span class="hs-identifier hs-var">patternStructType</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560266"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1683"></span><span>        </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560265"><span class="hs-identifier hs-var">rettype</span></a></span><span>
</span><span id="line-1684"></span><span>        </span><span class="annot"><span class="annottext">Constraints
</span><a href="#local-6989586621684560255"><span class="hs-identifier hs-var">new_substs</span></a></span><span>
</span><span id="line-1685"></span><span>
</span><span id="line-1686"></span><span>    </span><span id="local-6989586621684560251"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560251"><span class="hs-identifier hs-var">rettype''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall e. ASTMappable e =&gt; e -&gt; TermTypeM e
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#updateTypes"><span class="hs-identifier hs-var">updateTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560252"><span class="hs-identifier hs-var">rettype'</span></a></span><span>
</span><span id="line-1687"></span><span>
</span><span id="line-1688"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684560247"><span class="annot"><span class="annottext">used_sizes :: Set VName
</span><a href="#local-6989586621684560247"><span class="hs-identifier hs-var hs-var">used_sizes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1689"></span><span>          </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) () -&gt; Set VName)
-&gt; [TypeBase (DimDecl VName) ()] -&gt; Set VName
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; Set VName
forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="Language.Futhark.Prop.html#typeDimNames"><span class="hs-identifier hs-var">typeDimNames</span></a></span><span> </span><span class="annot"><span class="annottext">([TypeBase (DimDecl VName) ()] -&gt; Set VName)
-&gt; [TypeBase (DimDecl VName) ()] -&gt; Set VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560251"><span class="hs-identifier hs-var">rettype''</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
-&gt; [TypeBase (DimDecl VName) ()] -&gt; [TypeBase (DimDecl VName) ()]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; TypeBase (DimDecl VName) ())
-&gt; [PatBase Info VName] -&gt; [TypeBase (DimDecl VName) ()]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; TypeBase (DimDecl VName) ()
</span><a href="Language.Futhark.Prop.html#patternStructType"><span class="hs-identifier hs-var">patternStructType</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560266"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-1690"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(TypeParamBase VName -&gt; Bool)
-&gt; [TypeParamBase VName] -&gt; [TypeParamBase VName]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.notMember`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560247"><span class="hs-identifier hs-var">used_sizes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Bool)
-&gt; (TypeParamBase VName -&gt; VName) -&gt; TypeParamBase VName -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TypeParamBase VName -&gt; VName
forall vn. TypeParamBase vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#typeParamName"><span class="hs-identifier hs-var">typeParamName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TypeParamBase VName] -&gt; [TypeParamBase VName])
-&gt; [TypeParamBase VName] -&gt; [TypeParamBase VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1691"></span><span>      </span><span class="annot"><span class="annottext">(TypeParamBase VName -&gt; Bool)
-&gt; [TypeParamBase VName] -&gt; [TypeParamBase VName]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">TypeParamBase VName -&gt; Bool
forall vn. TypeParamBase vn -&gt; Bool
</span><a href="Language.Futhark.Prop.html#isSizeParam"><span class="hs-identifier hs-var">isSizeParam</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684560254"><span class="hs-identifier hs-var">tparams'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1692"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TermTypeM ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1693"></span><span>      </span><span id="local-6989586621684560245"><span class="annot"><span class="annottext">TypeParamBase VName
</span><a href="#local-6989586621684560245"><span class="hs-identifier hs-var">tp</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SizeBinder VName -&gt; TermTypeM ()
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
SizeBinder VName -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#unusedSize"><span class="hs-identifier hs-var">unusedSize</span></a></span><span> </span><span class="annot"><span class="annottext">(SizeBinder VName -&gt; TermTypeM ())
-&gt; SizeBinder VName -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; SrcLoc -&gt; SizeBinder VName
forall vn. vn -&gt; SrcLoc -&gt; SizeBinder vn
</span><a href="Language.Futhark.Syntax.html#SizeBinder"><span class="hs-identifier hs-var">SizeBinder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeParamBase VName -&gt; VName
forall vn. TypeParamBase vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#typeParamName"><span class="hs-identifier hs-var">typeParamName</span></a></span><span> </span><span class="annot"><span class="annottext">TypeParamBase VName
</span><a href="#local-6989586621684560245"><span class="hs-identifier hs-var">tp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeParamBase VName -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">TypeParamBase VName
</span><a href="#local-6989586621684560245"><span class="hs-identifier hs-var">tp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1694"></span><span>
</span><span id="line-1695"></span><span>    </span><span class="hs-comment">-- We keep those type variables that were not closed over by</span><span>
</span><span id="line-1696"></span><span>    </span><span class="hs-comment">-- let-generalisation.</span><span>
</span><span id="line-1697"></span><span>    </span><span class="annot"><span class="annottext">(Constraints -&gt; Constraints) -&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
(Constraints -&gt; Constraints) -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#modifyConstraints"><span class="hs-identifier hs-var">modifyConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">((Constraints -&gt; Constraints) -&gt; TermTypeM ())
-&gt; (Constraints -&gt; Constraints) -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; (Int, Constraint) -&gt; Bool) -&gt; Constraints -&gt; Constraints
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.filterWithKey</span></span><span> </span><span class="annot"><span class="annottext">((VName -&gt; (Int, Constraint) -&gt; Bool)
 -&gt; Constraints -&gt; Constraints)
-&gt; (VName -&gt; (Int, Constraint) -&gt; Bool)
-&gt; Constraints
-&gt; Constraints
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684560241"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560241"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="annot"><span class="annottext">(Int, Constraint)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684560241"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; [VName] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`notElem`</span></span><span> </span><span class="annot"><span class="annottext">(TypeParamBase VName -&gt; VName) -&gt; [TypeParamBase VName] -&gt; [VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TypeParamBase VName -&gt; VName
forall vn. TypeParamBase vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#typeParamName"><span class="hs-identifier hs-var">typeParamName</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684560254"><span class="hs-identifier hs-var">tparams'</span></a></span><span>
</span><span id="line-1698"></span><span>
</span><span id="line-1699"></span><span>    </span><span class="annot"><span class="annottext">([TypeParamBase VName], [PatBase Info VName], StructRetType)
-&gt; TermTypeM
     ([TypeParamBase VName], [PatBase Info VName], StructRetType)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684560254"><span class="hs-identifier hs-var">tparams'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560266"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; TypeBase (DimDecl VName) () -&gt; StructRetType
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684560253"><span class="hs-identifier hs-var">ret_dims</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560251"><span class="hs-identifier hs-var">rettype''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1700"></span><span>
</span><span id="line-1701"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#checkFunBody"><span class="hs-identifier hs-type">checkFunBody</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1702"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1703"></span><span>  </span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedExp"><span class="hs-identifier hs-type">UncheckedExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1704"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#StructType"><span class="hs-identifier hs-type">StructType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1705"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1706"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-1707"></span><span id="checkFunBody"><span class="annot"><span class="annottext">checkFunBody :: [PatBase Info VName]
-&gt; ExpBase NoInfo Name
-&gt; Maybe (TypeBase (DimDecl VName) ())
-&gt; SrcLoc
-&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkFunBody"><span class="hs-identifier hs-var hs-var">checkFunBody</span></a></span></span><span> </span><span id="local-6989586621684560240"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560240"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621684560239"><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684560239"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621684560238"><span class="annot"><span class="annottext">Maybe (TypeBase (DimDecl VName) ())
</span><a href="#local-6989586621684560238"><span class="hs-identifier hs-var">maybe_rettype</span></a></span></span><span> </span><span id="local-6989586621684560237"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560237"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1708"></span><span>  </span><span id="local-6989586621684560236"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560236"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TermTypeM Exp -&gt; TermTypeM Exp
forall a. TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#noSizeEscape"><span class="hs-identifier hs-var">noSizeEscape</span></a></span><span> </span><span class="annot"><span class="annottext">(TermTypeM Exp -&gt; TermTypeM Exp) -&gt; TermTypeM Exp -&gt; TermTypeM Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; TermTypeM Exp
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkExp"><span class="hs-identifier hs-var">checkExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684560239"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1709"></span><span>
</span><span id="line-1710"></span><span>  </span><span class="hs-comment">-- Unify body return type with return annotation, if one exists.</span><span>
</span><span id="line-1711"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (TypeBase (DimDecl VName) ())
</span><a href="#local-6989586621684560238"><span class="hs-identifier hs-var">maybe_rettype</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1712"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684560234"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560234"><span class="hs-identifier hs-var">rettype</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1713"></span><span>      </span><span id="local-6989586621684560233"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560233"><span class="hs-identifier hs-var">body_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#expTypeFully"><span class="hs-identifier hs-var">expTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560236"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-1714"></span><span>      </span><span class="hs-comment">-- We need to turn any sizes provided by &quot;hidden&quot; parameter</span><span>
</span><span id="line-1715"></span><span>      </span><span class="hs-comment">-- names into existential sizes instead.</span><span>
</span><span id="line-1716"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684560232"><span class="annot"><span class="annottext">hidden :: Set VName
</span><a href="#local-6989586621684560232"><span class="hs-identifier hs-var hs-var">hidden</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName] -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.html#hiddenParamNames"><span class="hs-identifier hs-var">hiddenParamNames</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560240"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-1717"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684560231"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560231"><span class="hs-identifier hs-var">body_t'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1718"></span><span>        </span><span class="annot"><span class="annottext">SrcLoc
-&gt; Map VName (IdentBase Info VName)
-&gt; TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.html#unscopeType"><span class="hs-identifier hs-var">unscopeType</span></a></span><span>
</span><span id="line-1719"></span><span>          </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560237"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-1720"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; IdentBase Info VName -&gt; Bool)
-&gt; Map VName (IdentBase Info VName)
-&gt; Map VName (IdentBase Info VName)
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; IdentBase Info VName -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; IdentBase Info VName -&gt; Bool)
-&gt; (VName -&gt; Bool) -&gt; VName -&gt; IdentBase Info VName -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684560232"><span class="hs-identifier hs-var">hidden</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Map VName (IdentBase Info VName)
 -&gt; Map VName (IdentBase Info VName))
-&gt; Map VName (IdentBase Info VName)
-&gt; Map VName (IdentBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1721"></span><span>              </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; Map VName (IdentBase Info VName))
-&gt; [PatBase Info VName] -&gt; Map VName (IdentBase Info VName)
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Map VName (IdentBase Info VName)
forall (f :: * -&gt; *).
Functor f =&gt;
PatBase f VName -&gt; Map VName (IdentBase f VName)
</span><a href="Language.Futhark.Prop.html#patternMap"><span class="hs-identifier hs-var">patternMap</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684560240"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-1722"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-1723"></span><span>          </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560233"><span class="hs-identifier hs-var">body_t</span></a></span><span>
</span><span id="line-1724"></span><span>
</span><span id="line-1725"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684560229"><span class="annot"><span class="annottext">usage :: Usage
</span><a href="#local-6989586621684560229"><span class="hs-identifier hs-var hs-var">usage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; String -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684560239"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;return type annotation&quot;</span></span><span>
</span><span id="line-1726"></span><span>      </span><span class="annot"><span class="annottext">Checking -&gt; TermTypeM () -&gt; TermTypeM ()
forall a. Checking -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#onFailure"><span class="hs-identifier hs-var">onFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) () -&gt; Checking
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#CheckingReturn"><span class="hs-identifier hs-var">CheckingReturn</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560234"><span class="hs-identifier hs-var">rettype</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560231"><span class="hs-identifier hs-var">body_t'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM () -&gt; TermTypeM ()) -&gt; TermTypeM () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1727"></span><span>        </span><span class="annot"><span class="annottext">Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage
-&gt; TypeBase (DimDecl VName) ()
-&gt; TypeBase (DimDecl VName) ()
-&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#expect"><span class="hs-identifier hs-var">expect</span></a></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684560229"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560234"><span class="hs-identifier hs-var">rettype</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (DimDecl VName) () -&gt; TermTypeM ())
-&gt; TypeBase (DimDecl VName) () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase (DimDecl VName) ()
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560231"><span class="hs-identifier hs-var">body_t'</span></a></span><span>
</span><span id="line-1728"></span><span>
</span><span id="line-1729"></span><span>      </span><span class="hs-comment">-- We also have to make sure that uniqueness matches.  This is done</span><span>
</span><span id="line-1730"></span><span>      </span><span class="hs-comment">-- explicitly, because uniqueness is ignored by unification.</span><span>
</span><span id="line-1731"></span><span>      </span><span id="local-6989586621684560227"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560227"><span class="hs-identifier hs-var">rettype'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
-&gt; TermTypeM (TypeBase (DimDecl VName) ())
forall a (m :: * -&gt; *). (Substitutable a, MonadUnify m) =&gt; a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Unify.html#normTypeFully"><span class="hs-identifier hs-var">normTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560234"><span class="hs-identifier hs-var">rettype</span></a></span><span>
</span><span id="line-1732"></span><span>      </span><span id="local-6989586621684560226"><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560226"><span class="hs-identifier hs-var">body_t''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
-&gt; TermTypeM (TypeBase (DimDecl VName) Aliasing)
forall a (m :: * -&gt; *). (Substitutable a, MonadUnify m) =&gt; a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Unify.html#normTypeFully"><span class="hs-identifier hs-var">normTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560231"><span class="hs-identifier hs-var">body_t'</span></a></span><span> </span><span class="hs-comment">-- Substs may have changed.</span><span>
</span><span id="line-1733"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; TermTypeM () -&gt; TermTypeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; TypeBase () ()
forall dim as. TypeBase dim as -&gt; TypeBase () ()
</span><a href="Language.Futhark.Prop.html#toStructural"><span class="hs-identifier hs-var">toStructural</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560226"><span class="hs-identifier hs-var">body_t''</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase () () -&gt; TypeBase () () -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.Types.html#subtypeOf"><span class="hs-operator hs-var">`subtypeOf`</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; TypeBase () ()
forall dim as. TypeBase dim as -&gt; TypeBase () ()
</span><a href="Language.Futhark.Prop.html#toStructural"><span class="hs-identifier hs-var">toStructural</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560227"><span class="hs-identifier hs-var">rettype'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM () -&gt; TermTypeM ()) -&gt; TermTypeM () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1734"></span><span>        </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TermTypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpBase NoInfo Name -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">ExpBase NoInfo Name
</span><a href="#local-6989586621684560239"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM ()) -&gt; Doc -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1735"></span><span>          </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Body type&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
</span><span class="hs-identifier hs-var">indent</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) Aliasing
</span><a href="#local-6989586621684560226"><span class="hs-identifier hs-var">body_t''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1736"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;is not a subtype of annotated type&quot;</span></span><span>
</span><span id="line-1737"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
</span><span class="hs-identifier hs-var">indent</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) () -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (DimDecl VName) ()
</span><a href="#local-6989586621684560227"><span class="hs-identifier hs-var">rettype'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1738"></span><span>    </span><span class="annot"><span class="annottext">Maybe (TypeBase (DimDecl VName) ())
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TermTypeM ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1739"></span><span>
</span><span id="line-1740"></span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; TermTypeM Exp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684560236"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-1741"></span><span>
</span><span id="line-1742"></span><span id="local-6989586621684563865"><span id="local-6989586621684563866"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html#arrayOfM"><span class="hs-identifier hs-type">arrayOfM</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1743"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ShapeDecl"><span class="hs-identifier hs-type">ShapeDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684563866"><span class="hs-identifier hs-type">dim</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621684563865"><span class="hs-keyword hs-type">as</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1744"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1745"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684563866"><span class="hs-identifier hs-type">dim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684563865"><span class="hs-keyword hs-type">as</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1746"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#ShapeDecl"><span class="hs-identifier hs-type">ShapeDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684563866"><span class="hs-identifier hs-type">dim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1747"></span><span>  </span><span class="annot"><a href="Language.Futhark.Core.html#Uniqueness"><span class="hs-identifier hs-type">Uniqueness</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1748"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684563866"><span class="hs-identifier hs-type">dim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684563865"><span class="hs-keyword hs-type">as</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1749"></span><span id="arrayOfM"><span class="annot"><span class="annottext">arrayOfM :: forall dim as.
(Pretty (ShapeDecl dim), Monoid as) =&gt;
SrcLoc
-&gt; TypeBase dim as
-&gt; ShapeDecl dim
-&gt; Uniqueness
-&gt; TermTypeM (TypeBase dim as)
</span><a href="Language.Futhark.TypeChecker.Terms.html#arrayOfM"><span class="hs-identifier hs-var hs-var">arrayOfM</span></a></span></span><span> </span><span id="local-6989586621684560217"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560217"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621684560216"><span class="annot"><span class="annottext">TypeBase dim as
</span><a href="#local-6989586621684560216"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621684560215"><span class="annot"><span class="annottext">ShapeDecl dim
</span><a href="#local-6989586621684560215"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span id="local-6989586621684560214"><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684560214"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1750"></span><span>  </span><span class="annot"><span class="annottext">Usage -&gt; String -&gt; TypeBase dim as -&gt; TermTypeM ()
forall (m :: * -&gt; *) dim as.
(MonadUnify m, Pretty (ShapeDecl dim), Monoid as) =&gt;
Usage -&gt; String -&gt; TypeBase dim as -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#arrayElemType"><span class="hs-identifier hs-var">arrayElemType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; String -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684560217"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;use as array element&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;type used in array&quot;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase dim as
</span><a href="#local-6989586621684560216"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1751"></span><span>  </span><span class="annot"><span class="annottext">TypeBase dim as -&gt; TermTypeM (TypeBase dim as)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TypeBase dim as -&gt; TermTypeM (TypeBase dim as))
-&gt; TypeBase dim as -&gt; TermTypeM (TypeBase dim as)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase dim as -&gt; ShapeDecl dim -&gt; Uniqueness -&gt; TypeBase dim as
forall as dim.
Monoid as =&gt;
TypeBase dim as -&gt; ShapeDecl dim -&gt; Uniqueness -&gt; TypeBase dim as
</span><a href="Language.Futhark.Prop.html#arrayOf"><span class="hs-identifier hs-var">arrayOf</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase dim as
</span><a href="#local-6989586621684560216"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeDecl dim
</span><a href="#local-6989586621684560215"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684560214"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-1752"></span></pre></body></html>