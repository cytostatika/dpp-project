<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">-- | @futhark autotune@</span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Futhark.CLI.Autotune</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CLI.Autotune.html#main"><span class="hs-identifier">main</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SBS</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">on</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">elemIndex</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">intersect</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isPrefixOf</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">minimumBy</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sort</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sortOn</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Tree</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Bench.html"><span class="hs-identifier">Futhark.Bench</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Futhark.Server</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Test.html"><span class="hs-identifier">Futhark.Test</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Util.html"><span class="hs-identifier">Futhark.Util</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Util.html#maxinum"><span class="hs-identifier">maxinum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Util.Options.html"><span class="hs-identifier">Futhark.Util.Options</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Environment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getExecutablePath</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Exit</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Process</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Read</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">readMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Regex.TDFA</span></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">data</span><span> </span><span id="AutotuneOptions"><span class="annot"><a href="Futhark.CLI.Autotune.html#AutotuneOptions"><span class="hs-identifier hs-var">AutotuneOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AutotuneOptions"><span class="annot"><a href="Futhark.CLI.Autotune.html#AutotuneOptions"><span class="hs-identifier hs-var">AutotuneOptions</span></a></span></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="optBackend"><span class="annot"><span class="annottext">AutotuneOptions -&gt; String
</span><a href="Futhark.CLI.Autotune.html#optBackend"><span class="hs-identifier hs-var hs-var">optBackend</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span id="optFuthark"><span class="annot"><span class="annottext">AutotuneOptions -&gt; Maybe String
</span><a href="Futhark.CLI.Autotune.html#optFuthark"><span class="hs-identifier hs-var hs-var">optFuthark</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span id="optRuns"><span class="annot"><span class="annottext">AutotuneOptions -&gt; Int
</span><a href="Futhark.CLI.Autotune.html#optRuns"><span class="hs-identifier hs-var hs-var">optRuns</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>    </span><span id="optTuning"><span class="annot"><span class="annottext">AutotuneOptions -&gt; Maybe String
</span><a href="Futhark.CLI.Autotune.html#optTuning"><span class="hs-identifier hs-var hs-var">optTuning</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>    </span><span id="optExtraOptions"><span class="annot"><span class="annottext">AutotuneOptions -&gt; [String]
</span><a href="Futhark.CLI.Autotune.html#optExtraOptions"><span class="hs-identifier hs-var hs-var">optExtraOptions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span id="optVerbose"><span class="annot"><span class="annottext">AutotuneOptions -&gt; Int
</span><a href="Futhark.CLI.Autotune.html#optVerbose"><span class="hs-identifier hs-var hs-var">optVerbose</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span id="optTimeout"><span class="annot"><span class="annottext">AutotuneOptions -&gt; Int
</span><a href="Futhark.CLI.Autotune.html#optTimeout"><span class="hs-identifier hs-var hs-var">optTimeout</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span id="optDefaultThreshold"><span class="annot"><span class="annottext">AutotuneOptions -&gt; Int
</span><a href="Futhark.CLI.Autotune.html#optDefaultThreshold"><span class="hs-identifier hs-var hs-var">optDefaultThreshold</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span id="optTestSpec"><span class="annot"><span class="annottext">AutotuneOptions -&gt; Maybe String
</span><a href="Futhark.CLI.Autotune.html#optTestSpec"><span class="hs-identifier hs-var hs-var">optTestSpec</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="annot"><a href="Futhark.CLI.Autotune.html#initialAutotuneOptions"><span class="hs-identifier hs-type">initialAutotuneOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#AutotuneOptions"><span class="hs-identifier hs-type">AutotuneOptions</span></a></span><span>
</span><span id="line-41"></span><span id="initialAutotuneOptions"><span class="annot"><span class="annottext">initialAutotuneOptions :: AutotuneOptions
</span><a href="Futhark.CLI.Autotune.html#initialAutotuneOptions"><span class="hs-identifier hs-var hs-var">initialAutotuneOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><span class="annottext">String
-&gt; Maybe String
-&gt; Int
-&gt; Maybe String
-&gt; [String]
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; Maybe String
-&gt; AutotuneOptions
</span><a href="Futhark.CLI.Autotune.html#AutotuneOptions"><span class="hs-identifier hs-var">AutotuneOptions</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;opencl&quot;</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tuning&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Futhark.CLI.Autotune.html#thresholdMax"><span class="hs-identifier hs-var">thresholdMax</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="annot"><a href="Futhark.CLI.Autotune.html#compileOptions"><span class="hs-identifier hs-type">compileOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#AutotuneOptions"><span class="hs-identifier hs-type">AutotuneOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Futhark.Bench.html#CompileOptions"><span class="hs-identifier hs-type">CompileOptions</span></a></span><span>
</span><span id="line-45"></span><span id="compileOptions"><span class="annot"><span class="annottext">compileOptions :: AutotuneOptions -&gt; IO CompileOptions
</span><a href="Futhark.CLI.Autotune.html#compileOptions"><span class="hs-identifier hs-var hs-var">compileOptions</span></a></span></span><span> </span><span id="local-6989586621684578405"><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578405"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-46"></span><span>  </span><span id="local-6989586621684578404"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578404"><span class="hs-identifier hs-var">futhark</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String -&gt; (String -&gt; IO String) -&gt; Maybe String -&gt; IO String
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">getExecutablePath</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; IO String) -&gt; Maybe String -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions -&gt; Maybe String
</span><a href="Futhark.CLI.Autotune.html#optFuthark"><span class="hs-identifier hs-var hs-var">optFuthark</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578405"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><span class="annottext">CompileOptions -&gt; IO CompileOptions
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(CompileOptions -&gt; IO CompileOptions)
-&gt; CompileOptions -&gt; IO CompileOptions
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><span class="annottext">CompileOptions :: String -&gt; String -&gt; [String] -&gt; CompileOptions
</span><a href="Futhark.Bench.html#CompileOptions"><span class="hs-identifier hs-type">CompileOptions</span></a></span><span>
</span><span id="line-49"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">compFuthark :: String
</span><a href="Futhark.Bench.html#compFuthark"><span class="hs-identifier hs-var">compFuthark</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578404"><span class="hs-identifier hs-var">futhark</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>        </span><span class="annot"><span class="annottext">compBackend :: String
</span><a href="Futhark.Bench.html#compBackend"><span class="hs-identifier hs-var">compBackend</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AutotuneOptions -&gt; String
</span><a href="Futhark.CLI.Autotune.html#optBackend"><span class="hs-identifier hs-var hs-var">optBackend</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578405"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>        </span><span class="annot"><span class="annottext">compOptions :: [String]
</span><a href="Futhark.Bench.html#compOptions"><span class="hs-identifier hs-var">compOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-52"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="annot"><a href="Futhark.CLI.Autotune.html#runOptions"><span class="hs-identifier hs-type">runOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#AutotuneOptions"><span class="hs-identifier hs-type">AutotuneOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Bench.html#RunOptions"><span class="hs-identifier hs-type">RunOptions</span></a></span><span>
</span><span id="line-55"></span><span id="runOptions"><span class="annot"><span class="annottext">runOptions :: Int -&gt; AutotuneOptions -&gt; RunOptions
</span><a href="Futhark.CLI.Autotune.html#runOptions"><span class="hs-identifier hs-var hs-var">runOptions</span></a></span></span><span> </span><span id="local-6989586621684578397"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578397"><span class="hs-identifier hs-var">timeout_s</span></a></span></span><span> </span><span id="local-6989586621684578396"><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578396"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><span class="annottext">RunOptions :: Int -&gt; Int -&gt; Int -&gt; Maybe (Int -&gt; IO ()) -&gt; RunOptions
</span><a href="Futhark.Bench.html#RunOptions"><span class="hs-identifier hs-type">RunOptions</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">runRuns :: Int
</span><a href="Futhark.Bench.html#runRuns"><span class="hs-identifier hs-var">runRuns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AutotuneOptions -&gt; Int
</span><a href="Futhark.CLI.Autotune.html#optRuns"><span class="hs-identifier hs-var hs-var">optRuns</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578396"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>      </span><span class="annot"><span class="annottext">runTimeout :: Int
</span><a href="Futhark.Bench.html#runTimeout"><span class="hs-identifier hs-var">runTimeout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578397"><span class="hs-identifier hs-var">timeout_s</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>      </span><span class="annot"><span class="annottext">runVerbose :: Int
</span><a href="Futhark.Bench.html#runVerbose"><span class="hs-identifier hs-var">runVerbose</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AutotuneOptions -&gt; Int
</span><a href="Futhark.CLI.Autotune.html#optVerbose"><span class="hs-identifier hs-var hs-var">optVerbose</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578396"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>      </span><span class="annot"><span class="annottext">runResultAction :: Maybe (Int -&gt; IO ())
</span><a href="Futhark.Bench.html#runResultAction"><span class="hs-identifier hs-var">runResultAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Int -&gt; IO ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">type</span><span> </span><span id="Path"><span class="annot"><a href="Futhark.CLI.Autotune.html#Path"><span class="hs-identifier hs-var">Path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="annot"><a href="Futhark.CLI.Autotune.html#regexGroups"><span class="hs-identifier hs-type">regexGroups</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Regex</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>
</span><span id="line-66"></span><span id="regexGroups"><span class="annot"><span class="annottext">regexGroups :: Regex -&gt; String -&gt; Maybe [String]
</span><a href="Futhark.CLI.Autotune.html#regexGroups"><span class="hs-identifier hs-var hs-var">regexGroups</span></a></span></span><span> </span><span id="local-6989586621684578388"><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621684578388"><span class="hs-identifier hs-var">regex</span></a></span></span><span> </span><span id="local-6989586621684578387"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578387"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578386"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684578386"><span class="hs-identifier hs-var">groups</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><span class="annottext">Regex -&gt; String -&gt; Maybe (String, String, String, [String])
forall regex source target (m :: * -&gt; *).
(RegexContext regex source target, MonadFail m) =&gt;
regex -&gt; source -&gt; m target
</span><span class="hs-identifier hs-var">matchM</span></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621684578388"><span class="hs-identifier hs-var">regex</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578387"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><span class="annottext">[String] -&gt; Maybe [String]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684578386"><span class="hs-identifier hs-var">groups</span></a></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="annot"><a href="Futhark.CLI.Autotune.html#comparisons"><span class="hs-identifier hs-type">comparisons</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-72"></span><span id="comparisons"><span class="annot"><span class="annottext">comparisons :: String -&gt; [(String, Int)]
</span><a href="Futhark.CLI.Autotune.html#comparisons"><span class="hs-identifier hs-var hs-var">comparisons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Maybe (String, Int)) -&gt; [String] -&gt; [(String, Int)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe (String, Int)
forall {b}. Read b =&gt; String -&gt; Maybe (String, b)
</span><a href="#local-6989586621684578382"><span class="hs-identifier hs-var">isComparison</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [(String, Int)])
-&gt; (String -&gt; [String]) -&gt; String -&gt; [(String, Int)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><span class="hs-identifier hs-var">lines</span></span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-74"></span><span>    </span><span id="local-6989586621684578377"><span class="annot"><span class="annottext">regex :: Regex
</span><a href="#local-6989586621684578377"><span class="hs-identifier hs-var hs-var">regex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Regex
forall regex compOpt execOpt source.
RegexMaker regex compOpt execOpt source =&gt;
source -&gt; regex
</span><span class="hs-identifier hs-var">makeRegex</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compared ([^ ]+) &lt;= (-?[0-9]+)&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>    </span><span id="local-6989586621684578382"><span class="annot"><span class="annottext">isComparison :: String -&gt; Maybe (String, b)
</span><a href="#local-6989586621684578382"><span class="hs-identifier hs-var hs-var">isComparison</span></a></span></span><span> </span><span id="local-6989586621684578369"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578369"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-76"></span><span>      </span><span class="hs-special">[</span><span id="local-6989586621684578368"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578368"><span class="hs-identifier hs-var">thresh</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578367"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578367"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Regex -&gt; String -&gt; Maybe [String]
</span><a href="Futhark.CLI.Autotune.html#regexGroups"><span class="hs-identifier hs-var">regexGroups</span></a></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621684578377"><span class="hs-identifier hs-var">regex</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578369"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-77"></span><span>      </span><span id="local-6989586621684578366"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621684578366"><span class="hs-identifier hs-var">val'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe b
forall a. Read a =&gt; String -&gt; Maybe a
</span><span class="hs-identifier hs-var">readMaybe</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578367"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-78"></span><span>      </span><span class="annot"><span class="annottext">(String, b) -&gt; Maybe (String, b)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578368"><span class="hs-identifier hs-var">thresh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621684578366"><span class="hs-identifier hs-var">val'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">type</span><span> </span><span id="RunDataset"><span class="annot"><a href="Futhark.CLI.Autotune.html#RunDataset"><span class="hs-identifier hs-var">RunDataset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-keyword">type</span><span> </span><span id="DatasetName"><span class="annot"><a href="Futhark.CLI.Autotune.html#DatasetName"><span class="hs-identifier hs-var">DatasetName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="annot"><a href="Futhark.CLI.Autotune.html#serverOptions"><span class="hs-identifier hs-type">serverOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#AutotuneOptions"><span class="hs-identifier hs-type">AutotuneOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>
</span><span id="line-85"></span><span id="serverOptions"><span class="annot"><span class="annottext">serverOptions :: AutotuneOptions -&gt; [String]
</span><a href="Futhark.CLI.Autotune.html#serverOptions"><span class="hs-identifier hs-var hs-var">serverOptions</span></a></span></span><span> </span><span id="local-6989586621684578363"><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578363"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;--default-threshold&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutotuneOptions -&gt; Int
</span><a href="Futhark.CLI.Autotune.html#optDefaultThreshold"><span class="hs-identifier hs-var hs-var">optDefaultThreshold</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578363"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-L&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-89"></span><span>  </span><span class="annot"><span class="annottext">AutotuneOptions -&gt; [String]
</span><a href="Futhark.CLI.Autotune.html#optExtraOptions"><span class="hs-identifier hs-var hs-var">optExtraOptions</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578363"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="annot"><a href="Futhark.CLI.Autotune.html#setTuningParam"><span class="hs-identifier hs-type">setTuningParam</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span id="setTuningParam"><span class="annot"><span class="annottext">setTuningParam :: Server -&gt; String -&gt; Int -&gt; IO ()
</span><a href="Futhark.CLI.Autotune.html#setTuningParam"><span class="hs-identifier hs-var hs-var">setTuningParam</span></a></span></span><span> </span><span id="local-6989586621684578360"><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621684578360"><span class="hs-identifier hs-var">server</span></a></span></span><span> </span><span id="local-6989586621684578359"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578359"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621684578358"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578358"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><span class="annottext">(CmdFailure -&gt; IO ())
-&gt; ([Text] -&gt; IO ()) -&gt; Either CmdFailure [Text] -&gt; IO ()
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; IO ()
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; (CmdFailure -&gt; String) -&gt; CmdFailure -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; (CmdFailure -&gt; Text) -&gt; CmdFailure -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.unlines</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; (CmdFailure -&gt; [Text]) -&gt; CmdFailure -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CmdFailure -&gt; [Text]
</span><span class="hs-identifier hs-var hs-var">failureMsg</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; [Text] -&gt; IO ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; [Text] -&gt; IO ()) -&gt; IO () -&gt; [Text] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><span class="annottext">(Either CmdFailure [Text] -&gt; IO ())
-&gt; IO (Either CmdFailure [Text]) -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Server -&gt; Text -&gt; Text -&gt; IO (Either CmdFailure [Text])
</span><span class="hs-identifier hs-var">cmdSetTuningParam</span></span><span> </span><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621684578360"><span class="hs-identifier hs-var">server</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578359"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578358"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="annot"><a href="Futhark.CLI.Autotune.html#setTuningParams"><span class="hs-identifier hs-type">setTuningParams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span id="setTuningParams"><span class="annot"><span class="annottext">setTuningParams :: Server -&gt; [(String, Int)] -&gt; IO ()
</span><a href="Futhark.CLI.Autotune.html#setTuningParams"><span class="hs-identifier hs-var hs-var">setTuningParams</span></a></span></span><span> </span><span id="local-6989586621684578347"><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621684578347"><span class="hs-identifier hs-var">server</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((String, Int) -&gt; IO ()) -&gt; [(String, Int)] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String -&gt; Int -&gt; IO ()) -&gt; (String, Int) -&gt; IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">((String -&gt; Int -&gt; IO ()) -&gt; (String, Int) -&gt; IO ())
-&gt; (String -&gt; Int -&gt; IO ()) -&gt; (String, Int) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Server -&gt; String -&gt; Int -&gt; IO ()
</span><a href="Futhark.CLI.Autotune.html#setTuningParam"><span class="hs-identifier hs-var">setTuningParam</span></a></span><span> </span><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621684578347"><span class="hs-identifier hs-var">server</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="annot"><a href="Futhark.CLI.Autotune.html#restoreTuningParams"><span class="hs-identifier hs-type">restoreTuningParams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#AutotuneOptions"><span class="hs-identifier hs-type">AutotuneOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span id="restoreTuningParams"><span class="annot"><span class="annottext">restoreTuningParams :: AutotuneOptions -&gt; Server -&gt; [(String, Int)] -&gt; IO ()
</span><a href="Futhark.CLI.Autotune.html#restoreTuningParams"><span class="hs-identifier hs-var hs-var">restoreTuningParams</span></a></span></span><span> </span><span id="local-6989586621684578343"><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578343"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621684578342"><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621684578342"><span class="hs-identifier hs-var">server</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((String, Int) -&gt; IO ()) -&gt; [(String, Int)] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">(String, Int) -&gt; IO ()
forall {b}. (String, b) -&gt; IO ()
</span><a href="#local-6989586621684578341"><span class="hs-identifier hs-var">opt</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-102"></span><span>    </span><span id="local-6989586621684578341"><span class="annot"><span class="annottext">opt :: (String, b) -&gt; IO ()
</span><a href="#local-6989586621684578341"><span class="hs-identifier hs-var hs-var">opt</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684578340"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578340"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Server -&gt; String -&gt; Int -&gt; IO ()
</span><a href="Futhark.CLI.Autotune.html#setTuningParam"><span class="hs-identifier hs-var">setTuningParam</span></a></span><span> </span><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621684578342"><span class="hs-identifier hs-var">server</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578340"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutotuneOptions -&gt; Int
</span><a href="Futhark.CLI.Autotune.html#optDefaultThreshold"><span class="hs-identifier hs-var hs-var">optDefaultThreshold</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578343"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="annot"><a href="Futhark.CLI.Autotune.html#prepare"><span class="hs-identifier hs-type">prepare</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#AutotuneOptions"><span class="hs-identifier hs-type">AutotuneOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Test.html#FutharkExe"><span class="hs-identifier hs-type">FutharkExe</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CLI.Autotune.html#DatasetName"><span class="hs-identifier hs-type">DatasetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#RunDataset"><span class="hs-identifier hs-type">RunDataset</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-105"></span><span id="prepare"><span class="annot"><span class="annottext">prepare :: AutotuneOptions
-&gt; FutharkExe -&gt; String -&gt; IO [(String, RunDataset, Text)]
</span><a href="Futhark.CLI.Autotune.html#prepare"><span class="hs-identifier hs-var hs-var">prepare</span></a></span></span><span> </span><span id="local-6989586621684578338"><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578338"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621684578337"><span class="annot"><span class="annottext">FutharkExe
</span><a href="#local-6989586621684578337"><span class="hs-identifier hs-var">futhark</span></a></span></span><span> </span><span id="local-6989586621684578336"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578336"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-106"></span><span>  </span><span id="local-6989586621684578335"><span class="annot"><span class="annottext">ProgramTest
</span><a href="#local-6989586621684578335"><span class="hs-identifier hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><span class="annottext">IO ProgramTest
-&gt; (String -&gt; IO ProgramTest) -&gt; Maybe String -&gt; IO ProgramTest
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; IO ProgramTest
</span><a href="Futhark.Test.Spec.html#testSpecFromProgramOrDie"><span class="hs-identifier hs-var">testSpecFromProgramOrDie</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578336"><span class="hs-identifier hs-var">prog</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ProgramTest
</span><a href="Futhark.Test.Spec.html#testSpecFromFileOrDie"><span class="hs-identifier hs-var">testSpecFromFileOrDie</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; IO ProgramTest) -&gt; Maybe String -&gt; IO ProgramTest
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-108"></span><span>      </span><span class="annot"><span class="annottext">AutotuneOptions -&gt; Maybe String
</span><a href="Futhark.CLI.Autotune.html#optTestSpec"><span class="hs-identifier hs-var hs-var">optTestSpec</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578338"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span id="local-6989586621684578332"><span class="annot"><span class="annottext">CompileOptions
</span><a href="#local-6989586621684578332"><span class="hs-identifier hs-var">copts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AutotuneOptions -&gt; IO CompileOptions
</span><a href="Futhark.CLI.Autotune.html#compileOptions"><span class="hs-identifier hs-var">compileOptions</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578338"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span>  </span><span id="local-6989586621684578331"><span class="annot"><span class="annottext">[InputOutputs]
</span><a href="#local-6989586621684578331"><span class="hs-identifier hs-var">truns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ProgramTest -&gt; TestAction
</span><a href="Futhark.Test.Spec.html#testAction"><span class="hs-identifier hs-var hs-var">testAction</span></a></span><span> </span><span class="annot"><span class="annottext">ProgramTest
</span><a href="#local-6989586621684578335"><span class="hs-identifier hs-var">spec</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><a href="Futhark.Test.Spec.html#RunCases"><span class="hs-identifier hs-type">RunCases</span></a></span><span> </span><span id="local-6989586621684578328"><span class="annot"><span class="annottext">[InputOutputs]
</span><a href="#local-6989586621684578328"><span class="hs-identifier hs-var">ios</span></a></span></span><span> </span><span class="annot"><span class="annottext">[StructureTest]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[WarningTest]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[InputOutputs] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[InputOutputs]
</span><a href="#local-6989586621684578328"><span class="hs-identifier hs-var">ios</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-114"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutotuneOptions -&gt; Int
</span><a href="Futhark.CLI.Autotune.html#optVerbose"><span class="hs-identifier hs-var hs-var">optVerbose</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578338"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-115"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-116"></span><span>            </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Entry points:&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(InputOutputs -&gt; String) -&gt; [InputOutputs] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String)
-&gt; (InputOutputs -&gt; Text) -&gt; InputOutputs -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">InputOutputs -&gt; Text
</span><a href="Futhark.Test.Spec.html#iosEntryPoint"><span class="hs-identifier hs-var hs-var">iosEntryPoint</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[InputOutputs]
</span><a href="#local-6989586621684578328"><span class="hs-identifier hs-var">ios</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span>        </span><span id="local-6989586621684578320"><span class="annot"><span class="annottext">Either (String, Maybe ByteString) ()
</span><a href="#local-6989586621684578320"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Int
-&gt; CompileOptions
-&gt; String
-&gt; [InputOutputs]
-&gt; IO (Either (String, Maybe ByteString) ())
forall (m :: * -&gt; *).
MonadIO m =&gt;
Maybe Int
-&gt; CompileOptions
-&gt; String
-&gt; [InputOutputs]
-&gt; m (Either (String, Maybe ByteString) ())
</span><a href="Futhark.Bench.html#prepareBenchmarkProgram"><span class="hs-identifier hs-var">prepareBenchmarkProgram</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">CompileOptions
</span><a href="#local-6989586621684578332"><span class="hs-identifier hs-var">copts</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578336"><span class="hs-identifier hs-var">prog</span></a></span><span> </span><span class="annot"><span class="annottext">[InputOutputs]
</span><a href="#local-6989586621684578328"><span class="hs-identifier hs-var">ios</span></a></span><span>
</span><span id="line-119"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (String, Maybe ByteString) ()
</span><a href="#local-6989586621684578320"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-120"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684578318"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578318"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578317"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621684578317"><span class="hs-identifier hs-var">errstr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-121"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578318"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-122"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; (ByteString -&gt; IO ()) -&gt; Maybe ByteString -&gt; IO ()
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ()
</span><span class="hs-identifier hs-var">SBS.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621684578317"><span class="hs-identifier hs-var">errstr</span></a></span><span>
</span><span id="line-123"></span><span>            </span><span class="annot"><span class="annottext">IO [InputOutputs]
forall a. IO a
</span><span class="hs-identifier hs-var">exitFailure</span></span><span>
</span><span id="line-124"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-125"></span><span>            </span><span class="annot"><span class="annottext">[InputOutputs] -&gt; IO [InputOutputs]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[InputOutputs]
</span><a href="#local-6989586621684578328"><span class="hs-identifier hs-var">ios</span></a></span><span>
</span><span id="line-126"></span><span>      </span><span class="annot"><span class="annottext">TestAction
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-127"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO [InputOutputs]
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unsupported test spec.&quot;</span></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684578308"><span class="annot"><span class="annottext">runnableDataset :: Text -&gt; TestRun -&gt; Maybe (String, RunDataset)
</span><a href="#local-6989586621684578308"><span class="hs-identifier hs-var hs-var">runnableDataset</span></a></span></span><span> </span><span id="local-6989586621684578307"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684578307"><span class="hs-identifier hs-var">entry_point</span></a></span></span><span> </span><span id="local-6989586621684578306"><span class="annot"><span class="annottext">TestRun
</span><a href="#local-6989586621684578306"><span class="hs-identifier hs-var">trun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-130"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TestRun -&gt; ExpectedResult Success
</span><a href="Futhark.Test.Spec.html#runExpectedResult"><span class="hs-identifier hs-var hs-var">runExpectedResult</span></a></span><span> </span><span class="annot"><span class="annottext">TestRun
</span><a href="#local-6989586621684578306"><span class="hs-identifier hs-var">trun</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-131"></span><span>          </span><span class="annot"><a href="Futhark.Test.Spec.html#Succeeds"><span class="hs-identifier hs-type">Succeeds</span></a></span><span> </span><span id="local-6989586621684578303"><span class="annot"><span class="annottext">Maybe Success
</span><a href="#local-6989586621684578303"><span class="hs-identifier hs-var">expected</span></a></span></span><span>
</span><span id="line-132"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TestRun -&gt; [String]
</span><a href="Futhark.Test.Spec.html#runTags"><span class="hs-identifier hs-var hs-var">runTags</span></a></span><span> </span><span class="annot"><span class="annottext">TestRun
</span><a href="#local-6989586621684578306"><span class="hs-identifier hs-var">trun</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">`intersect`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;notune&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;disable&quot;</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-133"></span><span>              </span><span class="annot"><span class="annottext">(String, RunDataset) -&gt; Maybe (String, RunDataset)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-134"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TestRun -&gt; String
</span><a href="Futhark.Test.Spec.html#runDescription"><span class="hs-identifier hs-var hs-var">runDescription</span></a></span><span> </span><span class="annot"><span class="annottext">TestRun
</span><a href="#local-6989586621684578306"><span class="hs-identifier hs-var">trun</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-135"></span><span>                  </span><span class="hs-glyph">\</span><span id="local-6989586621684578300"><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621684578300"><span class="hs-identifier hs-var">server</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Server
-&gt; Text
-&gt; TestRun
-&gt; Maybe Success
-&gt; Int
-&gt; [(String, Int)]
-&gt; IO (Either String ([(String, Int)], Int))
</span><a href="#local-6989586621684578299"><span class="hs-identifier hs-var">run</span></a></span><span> </span><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621684578300"><span class="hs-identifier hs-var">server</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684578307"><span class="hs-identifier hs-var">entry_point</span></a></span><span> </span><span class="annot"><span class="annottext">TestRun
</span><a href="#local-6989586621684578306"><span class="hs-identifier hs-var">trun</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Success
</span><a href="#local-6989586621684578303"><span class="hs-identifier hs-var">expected</span></a></span><span>
</span><span id="line-136"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>          </span><span class="annot"><span class="annottext">ExpectedResult Success
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (String, RunDataset)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span>  </span><span class="annot"><span class="annottext">([[(String, RunDataset, Text)]] -&gt; [(String, RunDataset, Text)])
-&gt; IO [[(String, RunDataset, Text)]]
-&gt; IO [(String, RunDataset, Text)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[[(String, RunDataset, Text)]] -&gt; [(String, RunDataset, Text)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">(IO [[(String, RunDataset, Text)]]
 -&gt; IO [(String, RunDataset, Text)])
-&gt; ((InputOutputs -&gt; IO [(String, RunDataset, Text)])
    -&gt; IO [[(String, RunDataset, Text)]])
-&gt; (InputOutputs -&gt; IO [(String, RunDataset, Text)])
-&gt; IO [(String, RunDataset, Text)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[InputOutputs]
-&gt; (InputOutputs -&gt; IO [(String, RunDataset, Text)])
-&gt; IO [[(String, RunDataset, Text)]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[InputOutputs]
</span><a href="#local-6989586621684578331"><span class="hs-identifier hs-var">truns</span></a></span><span> </span><span class="annot"><span class="annottext">((InputOutputs -&gt; IO [(String, RunDataset, Text)])
 -&gt; IO [(String, RunDataset, Text)])
-&gt; (InputOutputs -&gt; IO [(String, RunDataset, Text)])
-&gt; IO [(String, RunDataset, Text)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684578296"><span class="annot"><span class="annottext">InputOutputs
</span><a href="#local-6989586621684578296"><span class="hs-identifier hs-var">ios</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684578295"><span class="annot"><span class="annottext">cases :: [(String, RunDataset)]
</span><a href="#local-6989586621684578295"><span class="hs-identifier hs-var hs-var">cases</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-141"></span><span>          </span><span class="annot"><span class="annottext">(TestRun -&gt; Maybe (String, RunDataset))
-&gt; [TestRun] -&gt; [(String, RunDataset)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; TestRun -&gt; Maybe (String, RunDataset)
</span><a href="#local-6989586621684578308"><span class="hs-identifier hs-var">runnableDataset</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; TestRun -&gt; Maybe (String, RunDataset))
-&gt; Text -&gt; TestRun -&gt; Maybe (String, RunDataset)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InputOutputs -&gt; Text
</span><a href="Futhark.Test.Spec.html#iosEntryPoint"><span class="hs-identifier hs-var hs-var">iosEntryPoint</span></a></span><span> </span><span class="annot"><span class="annottext">InputOutputs
</span><a href="#local-6989586621684578296"><span class="hs-identifier hs-var">ios</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InputOutputs -&gt; [TestRun]
</span><a href="Futhark.Test.Spec.html#iosTestRuns"><span class="hs-identifier hs-var hs-var">iosTestRuns</span></a></span><span> </span><span class="annot"><span class="annottext">InputOutputs
</span><a href="#local-6989586621684578296"><span class="hs-identifier hs-var">ios</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>    </span><span class="annot"><span class="annottext">[(String, RunDataset)]
-&gt; ((String, RunDataset) -&gt; IO (String, RunDataset, Text))
-&gt; IO [(String, RunDataset, Text)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[(String, RunDataset)]
</span><a href="#local-6989586621684578295"><span class="hs-identifier hs-var">cases</span></a></span><span> </span><span class="annot"><span class="annottext">(((String, RunDataset) -&gt; IO (String, RunDataset, Text))
 -&gt; IO [(String, RunDataset, Text)])
-&gt; ((String, RunDataset) -&gt; IO (String, RunDataset, Text))
-&gt; IO [(String, RunDataset, Text)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621684578293"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578293"><span class="hs-identifier hs-var">dataset</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578292"><span class="annot"><span class="annottext">RunDataset
</span><a href="#local-6989586621684578292"><span class="hs-identifier hs-var">do_run</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-143"></span><span>      </span><span class="annot"><span class="annottext">(String, RunDataset, Text) -&gt; IO (String, RunDataset, Text)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578293"><span class="hs-identifier hs-var">dataset</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RunDataset
</span><a href="#local-6989586621684578292"><span class="hs-identifier hs-var">do_run</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InputOutputs -&gt; Text
</span><a href="Futhark.Test.Spec.html#iosEntryPoint"><span class="hs-identifier hs-var hs-var">iosEntryPoint</span></a></span><span> </span><span class="annot"><span class="annottext">InputOutputs
</span><a href="#local-6989586621684578296"><span class="hs-identifier hs-var">ios</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-145"></span><span>    </span><span id="local-6989586621684578299"><span class="annot"><span class="annottext">run :: Server
-&gt; Text
-&gt; TestRun
-&gt; Maybe Success
-&gt; Int
-&gt; [(String, Int)]
-&gt; IO (Either String ([(String, Int)], Int))
</span><a href="#local-6989586621684578299"><span class="hs-identifier hs-var hs-var">run</span></a></span></span><span> </span><span id="local-6989586621684578275"><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621684578275"><span class="hs-identifier hs-var">server</span></a></span></span><span> </span><span id="local-6989586621684578274"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684578274"><span class="hs-identifier hs-var">entry_point</span></a></span></span><span> </span><span id="local-6989586621684578273"><span class="annot"><span class="annottext">TestRun
</span><a href="#local-6989586621684578273"><span class="hs-identifier hs-var">trun</span></a></span></span><span> </span><span id="local-6989586621684578272"><span class="annot"><span class="annottext">Maybe Success
</span><a href="#local-6989586621684578272"><span class="hs-identifier hs-var">expected</span></a></span></span><span> </span><span id="local-6989586621684578271"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578271"><span class="hs-identifier hs-var">timeout</span></a></span></span><span> </span><span id="local-6989586621684578270"><span class="annot"><span class="annottext">[(String, Int)]
</span><a href="#local-6989586621684578270"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-146"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621684578269"><span class="hs-identifier hs-type">bestRuntime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Futhark.Bench.html#RunResult"><span class="hs-identifier hs-type">RunResult</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>          </span><span id="local-6989586621684578269"><span class="annot"><span class="annottext">bestRuntime :: ([RunResult], Text) -&gt; ([(String, Int)], Int)
</span><a href="#local-6989586621684578269"><span class="hs-identifier hs-var hs-var">bestRuntime</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684578268"><span class="annot"><span class="annottext">[RunResult]
</span><a href="#local-6989586621684578268"><span class="hs-identifier hs-var">runres</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578267"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684578267"><span class="hs-identifier hs-var">errout</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-148"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String -&gt; [(String, Int)]
</span><a href="Futhark.CLI.Autotune.html#comparisons"><span class="hs-identifier hs-var">comparisons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684578267"><span class="hs-identifier hs-var">errout</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-149"></span><span>              </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">minimum</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Int) -&gt; [Int] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(RunResult -&gt; Int) -&gt; [RunResult] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">RunResult -&gt; Int
</span><a href="Futhark.Bench.html#runMicroseconds"><span class="hs-identifier hs-var hs-var">runMicroseconds</span></a></span><span> </span><span class="annot"><span class="annottext">[RunResult]
</span><a href="#local-6989586621684578268"><span class="hs-identifier hs-var">runres</span></a></span><span>
</span><span id="line-150"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span>          </span><span id="local-6989586621684578264"><span class="annot"><span class="annottext">ropts :: RunOptions
</span><a href="#local-6989586621684578264"><span class="hs-identifier hs-var hs-var">ropts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; AutotuneOptions -&gt; RunOptions
</span><a href="Futhark.CLI.Autotune.html#runOptions"><span class="hs-identifier hs-var">runOptions</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578271"><span class="hs-identifier hs-var">timeout</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578338"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutotuneOptions -&gt; Int
</span><a href="Futhark.CLI.Autotune.html#optVerbose"><span class="hs-identifier hs-var hs-var">optVerbose</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578338"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-155"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Trying path: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(String, Int)] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[(String, Int)]
</span><a href="#local-6989586621684578270"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span>      </span><span class="hs-comment">-- Setting the tuning parameters is a stateful action, so we</span><span>
</span><span id="line-158"></span><span>      </span><span class="hs-comment">-- must be careful to restore the defaults below.  This is</span><span>
</span><span id="line-159"></span><span>      </span><span class="hs-comment">-- because we rely on parameters not in 'path' to have their</span><span>
</span><span id="line-160"></span><span>      </span><span class="hs-comment">-- default value.</span><span>
</span><span id="line-161"></span><span>      </span><span class="annot"><span class="annottext">Server -&gt; [(String, Int)] -&gt; IO ()
</span><a href="Futhark.CLI.Autotune.html#setTuningParams"><span class="hs-identifier hs-var">setTuningParams</span></a></span><span> </span><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621684578275"><span class="hs-identifier hs-var">server</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, Int)]
</span><a href="#local-6989586621684578270"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span>      </span><span class="annot"><span class="annottext">(Text -&gt; Either String ([(String, Int)], Int))
-&gt; (([RunResult], Text) -&gt; Either String ([(String, Int)], Int))
-&gt; Either Text ([RunResult], Text)
-&gt; Either String ([(String, Int)], Int)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Either String ([(String, Int)], Int)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either String ([(String, Int)], Int))
-&gt; (Text -&gt; String) -&gt; Text -&gt; Either String ([(String, Int)], Int)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([(String, Int)], Int) -&gt; Either String ([(String, Int)], Int)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(([(String, Int)], Int) -&gt; Either String ([(String, Int)], Int))
-&gt; (([RunResult], Text) -&gt; ([(String, Int)], Int))
-&gt; ([RunResult], Text)
-&gt; Either String ([(String, Int)], Int)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([RunResult], Text) -&gt; ([(String, Int)], Int)
</span><a href="#local-6989586621684578269"><span class="hs-identifier hs-var">bestRuntime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>        </span><span class="annot"><span class="annottext">(Either Text ([RunResult], Text)
 -&gt; Either String ([(String, Int)], Int))
-&gt; IO (Either Text ([RunResult], Text))
-&gt; IO (Either String ([(String, Int)], Int))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Server
-&gt; RunOptions
-&gt; FutharkExe
-&gt; String
-&gt; Text
-&gt; Values
-&gt; Maybe Success
-&gt; String
-&gt; IO (Either Text ([RunResult], Text))
</span><a href="Futhark.Bench.html#benchmarkDataset"><span class="hs-identifier hs-var">benchmarkDataset</span></a></span><span>
</span><span id="line-165"></span><span>          </span><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621684578275"><span class="hs-identifier hs-var">server</span></a></span><span>
</span><span id="line-166"></span><span>          </span><span class="annot"><span class="annottext">RunOptions
</span><a href="#local-6989586621684578264"><span class="hs-identifier hs-var">ropts</span></a></span><span>
</span><span id="line-167"></span><span>          </span><span class="annot"><span class="annottext">FutharkExe
</span><a href="#local-6989586621684578337"><span class="hs-identifier hs-var">futhark</span></a></span><span>
</span><span id="line-168"></span><span>          </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578336"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-169"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684578274"><span class="hs-identifier hs-var">entry_point</span></a></span><span>
</span><span id="line-170"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TestRun -&gt; Values
</span><a href="Futhark.Test.Spec.html#runInput"><span class="hs-identifier hs-var hs-var">runInput</span></a></span><span> </span><span class="annot"><span class="annottext">TestRun
</span><a href="#local-6989586621684578273"><span class="hs-identifier hs-var">trun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>          </span><span class="annot"><span class="annottext">Maybe Success
</span><a href="#local-6989586621684578272"><span class="hs-identifier hs-var">expected</span></a></span><span>
</span><span id="line-172"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text -&gt; TestRun -&gt; String
</span><a href="Futhark.Test.html#testRunReferenceOutput"><span class="hs-identifier hs-var">testRunReferenceOutput</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578336"><span class="hs-identifier hs-var">prog</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684578274"><span class="hs-identifier hs-var">entry_point</span></a></span><span> </span><span class="annot"><span class="annottext">TestRun
</span><a href="#local-6989586621684578273"><span class="hs-identifier hs-var">trun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>        </span><span class="annot"><span class="annottext">IO (Either String ([(String, Int)], Int))
-&gt; IO () -&gt; IO (Either String ([(String, Int)], Int))
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions -&gt; Server -&gt; [(String, Int)] -&gt; IO ()
</span><a href="Futhark.CLI.Autotune.html#restoreTuningParams"><span class="hs-identifier hs-var">restoreTuningParams</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578338"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621684578275"><span class="hs-identifier hs-var">server</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, Int)]
</span><a href="#local-6989586621684578270"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-comment">--- Benchmarking a program</span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-keyword">data</span><span> </span><span id="DatasetResult"><span class="annot"><a href="Futhark.CLI.Autotune.html#DatasetResult"><span class="hs-identifier hs-var">DatasetResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DatasetResult"><span class="annot"><a href="Futhark.CLI.Autotune.html#DatasetResult"><span class="hs-identifier hs-var">DatasetResult</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-178"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684578247"><span id="local-6989586621684578249"><span id="local-6989586621684578256"><span class="annot"><span class="annottext">Int -&gt; DatasetResult -&gt; String -&gt; String
[DatasetResult] -&gt; String -&gt; String
DatasetResult -&gt; String
(Int -&gt; DatasetResult -&gt; String -&gt; String)
-&gt; (DatasetResult -&gt; String)
-&gt; ([DatasetResult] -&gt; String -&gt; String)
-&gt; Show DatasetResult
forall a.
(Int -&gt; a -&gt; String -&gt; String)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; String -&gt; String) -&gt; Show a
showList :: [DatasetResult] -&gt; String -&gt; String
$cshowList :: [DatasetResult] -&gt; String -&gt; String
show :: DatasetResult -&gt; String
$cshow :: DatasetResult -&gt; String
showsPrec :: Int -&gt; DatasetResult -&gt; String -&gt; String
$cshowsPrec :: Int -&gt; DatasetResult -&gt; String -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="hs-comment">--- Finding initial comparisons.</span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="hs-comment">--- Extracting threshold hierarchy.</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="hs-keyword">type</span><span> </span><span id="ThresholdForest"><span class="annot"><a href="Futhark.CLI.Autotune.html#ThresholdForest"><span class="hs-identifier hs-var">ThresholdForest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Forest</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="annot"><a href="Futhark.CLI.Autotune.html#thresholdMin"><span class="hs-identifier hs-type">thresholdMin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#thresholdMax"><span class="hs-identifier hs-type">thresholdMax</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-187"></span><span id="thresholdMin"><span class="annot"><span class="annottext">thresholdMin :: Int
</span><a href="Futhark.CLI.Autotune.html#thresholdMin"><span class="hs-identifier hs-var hs-var">thresholdMin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-188"></span><span id="thresholdMax"><span class="annot"><span class="annottext">thresholdMax :: Int
</span><a href="Futhark.CLI.Autotune.html#thresholdMax"><span class="hs-identifier hs-var hs-var">thresholdMax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2000000000</span></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="hs-comment">-- | Depth-first list of thresholds to tune in order, and a</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- corresponding assignment of ancestor thresholds to ensure that they</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- are used.</span><span>
</span><span id="line-193"></span><span class="annot"><a href="Futhark.CLI.Autotune.html#tuningPaths"><span class="hs-identifier hs-type">tuningPaths</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#ThresholdForest"><span class="hs-identifier hs-type">ThresholdForest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-194"></span><span id="tuningPaths"><span class="annot"><span class="annottext">tuningPaths :: ThresholdForest -&gt; [(String, [(String, Int)])]
</span><a href="Futhark.CLI.Autotune.html#tuningPaths"><span class="hs-identifier hs-var hs-var">tuningPaths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Tree (String, Bool) -&gt; [(String, [(String, Int)])])
-&gt; ThresholdForest -&gt; [(String, [(String, Int)])]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(String, Int)]
-&gt; Tree (String, Bool) -&gt; [(String, [(String, Int)])]
forall {a}. [(a, Int)] -&gt; Tree (a, Bool) -&gt; [(a, [(a, Int)])]
</span><a href="#local-6989586621684578241"><span class="hs-identifier hs-var">treePaths</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621684578241"><span class="annot"><span class="annottext">treePaths :: [(a, Int)] -&gt; Tree (a, Bool) -&gt; [(a, [(a, Int)])]
</span><a href="#local-6989586621684578241"><span class="hs-identifier hs-var hs-var">treePaths</span></a></span></span><span> </span><span id="local-6989586621684578239"><span class="annot"><span class="annottext">[(a, Int)]
</span><a href="#local-6989586621684578239"><span class="hs-identifier hs-var">ancestors</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Node</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684578237"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684578237"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684578236"><span class="annot"><span class="annottext">[Tree (a, Bool)]
</span><a href="#local-6989586621684578236"><span class="hs-identifier hs-var">children</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-197"></span><span>      </span><span class="annot"><span class="annottext">(Tree (a, Bool) -&gt; [(a, [(a, Int)])])
-&gt; [Tree (a, Bool)] -&gt; [(a, [(a, Int)])]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(a, Int)] -&gt; a -&gt; Tree (a, Bool) -&gt; [(a, [(a, Int)])]
</span><a href="#local-6989586621684578235"><span class="hs-identifier hs-var">onChild</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Int)]
</span><a href="#local-6989586621684578239"><span class="hs-identifier hs-var">ancestors</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684578237"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Tree (a, Bool)]
</span><a href="#local-6989586621684578236"><span class="hs-identifier hs-var">children</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, [(a, Int)])] -&gt; [(a, [(a, Int)])] -&gt; [(a, [(a, Int)])]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684578237"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(a, Int)]
</span><a href="#local-6989586621684578239"><span class="hs-identifier hs-var">ancestors</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>    </span><span id="local-6989586621684578235"><span class="annot"><span class="annottext">onChild :: [(a, Int)] -&gt; a -&gt; Tree (a, Bool) -&gt; [(a, [(a, Int)])]
</span><a href="#local-6989586621684578235"><span class="hs-identifier hs-var hs-var">onChild</span></a></span></span><span> </span><span id="local-6989586621684578234"><span class="annot"><span class="annottext">[(a, Int)]
</span><a href="#local-6989586621684578234"><span class="hs-identifier hs-var">ancestors</span></a></span></span><span> </span><span id="local-6989586621684578233"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684578233"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621684578232"><span class="annot"><span class="annottext">child :: Tree (a, Bool)
</span><a href="#local-6989586621684578232"><span class="hs-identifier hs-var">child</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Node</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578231"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684578231"><span class="hs-identifier hs-var">cmp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Tree (a, Bool)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-200"></span><span>      </span><span class="annot"><span class="annottext">[(a, Int)] -&gt; Tree (a, Bool) -&gt; [(a, [(a, Int)])]
</span><a href="#local-6989586621684578241"><span class="hs-identifier hs-var">treePaths</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(a, Int)]
</span><a href="#local-6989586621684578234"><span class="hs-identifier hs-var">ancestors</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Int)] -&gt; [(a, Int)] -&gt; [(a, Int)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684578233"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int
</span><a href="#local-6989586621684578230"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684578231"><span class="hs-identifier hs-var">cmp</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tree (a, Bool)
</span><a href="#local-6989586621684578232"><span class="hs-identifier hs-var">child</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span>    </span><span id="local-6989586621684578230"><span class="annot"><span class="annottext">t :: Bool -&gt; Int
</span><a href="#local-6989586621684578230"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Futhark.CLI.Autotune.html#thresholdMax"><span class="hs-identifier hs-var">thresholdMax</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><a href="#local-6989586621684578230"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Futhark.CLI.Autotune.html#thresholdMin"><span class="hs-identifier hs-var">thresholdMin</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="annot"><a href="Futhark.CLI.Autotune.html#thresholdForest"><span class="hs-identifier hs-type">thresholdForest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#ThresholdForest"><span class="hs-identifier hs-type">ThresholdForest</span></a></span><span>
</span><span id="line-206"></span><span id="thresholdForest"><span class="annot"><span class="annottext">thresholdForest :: String -&gt; IO ThresholdForest
</span><a href="Futhark.CLI.Autotune.html#thresholdForest"><span class="hs-identifier hs-var hs-var">thresholdForest</span></a></span></span><span> </span><span id="local-6989586621684578228"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578228"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-207"></span><span>  </span><span id="local-6989586621684578227"><span class="annot"><span class="annottext">[(String, [(String, Bool)])]
</span><a href="#local-6989586621684578227"><span class="hs-identifier hs-var">thresholds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; [(String, [(String, Bool)])]
</span><a href="#local-6989586621684578226"><span class="hs-identifier hs-var">getThresholds</span></a></span><span>
</span><span id="line-209"></span><span>      </span><span class="annot"><span class="annottext">(String -&gt; [(String, [(String, Bool)])])
-&gt; IO String -&gt; IO [(String, [(String, Bool)])]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String -&gt; IO String
</span><span class="hs-identifier hs-var">readProcess</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><span class="hs-identifier hs-var">dropExtension</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578228"><span class="hs-identifier hs-var">prog</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;--print-params&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684578222"><span class="annot"><span class="annottext">root :: (a, b) -&gt; ((a, Bool), [a])
</span><a href="#local-6989586621684578222"><span class="hs-identifier hs-var hs-var">root</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684578221"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684578221"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684578221"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>  </span><span class="annot"><span class="annottext">ThresholdForest -&gt; IO ThresholdForest
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ThresholdForest -&gt; IO ThresholdForest)
-&gt; ThresholdForest -&gt; IO ThresholdForest
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><span class="annottext">(((String, Bool), [String])
 -&gt; ((String, Bool), [((String, Bool), [String])]))
-&gt; [((String, Bool), [String])] -&gt; ThresholdForest
forall b a. (b -&gt; (a, [b])) -&gt; [b] -&gt; [Tree a]
</span><span class="hs-identifier hs-var">unfoldForest</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(String, [(String, Bool)])]
-&gt; ((String, Bool), [String])
-&gt; ((String, Bool), [((String, Bool), [String])])
forall {a} {a} {b} {b}.
Ord a =&gt;
[(a, [(a, b)])] -&gt; ((a, b), [a]) -&gt; ((a, b), [((a, b), [a])])
</span><a href="#local-6989586621684578219"><span class="hs-identifier hs-var">unfold</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(String, Bool)])]
</span><a href="#local-6989586621684578227"><span class="hs-identifier hs-var">thresholds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([((String, Bool), [String])] -&gt; ThresholdForest)
-&gt; [((String, Bool), [String])] -&gt; ThresholdForest
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-213"></span><span>      </span><span class="annot"><span class="annottext">((String, [(String, Bool)]) -&gt; ((String, Bool), [String]))
-&gt; [(String, [(String, Bool)])] -&gt; [((String, Bool), [String])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(String, [(String, Bool)]) -&gt; ((String, Bool), [String])
forall {a} {b} {a}. (a, b) -&gt; ((a, Bool), [a])
</span><a href="#local-6989586621684578222"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">([(String, [(String, Bool)])] -&gt; [((String, Bool), [String])])
-&gt; [(String, [(String, Bool)])] -&gt; [((String, Bool), [String])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((String, [(String, Bool)]) -&gt; Bool)
-&gt; [(String, [(String, Bool)])] -&gt; [(String, [(String, Bool)])]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(String, Bool)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">([(String, Bool)] -&gt; Bool)
-&gt; ((String, [(String, Bool)]) -&gt; [(String, Bool)])
-&gt; (String, [(String, Bool)])
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(String, [(String, Bool)]) -&gt; [(String, Bool)]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(String, Bool)])]
</span><a href="#local-6989586621684578227"><span class="hs-identifier hs-var">thresholds</span></a></span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-215"></span><span>    </span><span id="local-6989586621684578226"><span class="annot"><span class="annottext">getThresholds :: String -&gt; [(String, [(String, Bool)])]
</span><a href="#local-6989586621684578226"><span class="hs-identifier hs-var hs-var">getThresholds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Maybe (String, [(String, Bool)]))
-&gt; [String] -&gt; [(String, [(String, Bool)])]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe (String, [(String, Bool)])
</span><a href="#local-6989586621684578218"><span class="hs-identifier hs-var">findThreshold</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [(String, [(String, Bool)])])
-&gt; (String -&gt; [String]) -&gt; String -&gt; [(String, [(String, Bool)])]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><span class="hs-identifier hs-var">lines</span></span><span>
</span><span id="line-216"></span><span>    </span><span id="local-6989586621684578216"><span class="annot"><span class="annottext">regex :: Regex
</span><a href="#local-6989586621684578216"><span class="hs-identifier hs-var hs-var">regex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Regex
forall regex compOpt execOpt source.
RegexMaker regex compOpt execOpt source =&gt;
source -&gt; regex
</span><span class="hs-identifier hs-var">makeRegex</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(.*) \\(threshold\\(([^ ]+,)(.*)\\)\\)&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span>    </span><span class="annot"><a href="#local-6989586621684578218"><span class="hs-identifier hs-type">findThreshold</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>    </span><span id="local-6989586621684578218"><span class="annot"><span class="annottext">findThreshold :: String -&gt; Maybe (String, [(String, Bool)])
</span><a href="#local-6989586621684578218"><span class="hs-identifier hs-var hs-var">findThreshold</span></a></span></span><span> </span><span id="local-6989586621684578215"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578215"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-220"></span><span>      </span><span class="hs-special">[</span><span id="local-6989586621684578214"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578214"><span class="hs-identifier hs-var">grp1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578213"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578213"><span class="hs-identifier hs-var">grp2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Regex -&gt; String -&gt; Maybe [String]
</span><a href="Futhark.CLI.Autotune.html#regexGroups"><span class="hs-identifier hs-var">regexGroups</span></a></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621684578216"><span class="hs-identifier hs-var">regex</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578215"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-221"></span><span>      </span><span class="annot"><span class="annottext">(String, [(String, Bool)]) -&gt; Maybe (String, [(String, Bool)])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-222"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578214"><span class="hs-identifier hs-var">grp1</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-223"></span><span>          </span><span class="annot"><span class="annottext">((String, Bool) -&gt; Bool) -&gt; [(String, Bool)] -&gt; [(String, Bool)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ((String, Bool) -&gt; Bool) -&gt; (String, Bool) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Bool)
-&gt; ((String, Bool) -&gt; String) -&gt; (String, Bool) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(String, Bool)] -&gt; [(String, Bool)])
-&gt; [(String, Bool)] -&gt; [(String, Bool)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-224"></span><span>            </span><span class="annot"><span class="annottext">(String -&gt; (String, Bool)) -&gt; [String] -&gt; [(String, Bool)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span>
</span><span id="line-225"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684578212"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578212"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-226"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;!&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><span class="hs-operator hs-var">`isPrefixOf`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578212"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-227"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String -&gt; String
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578212"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578212"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>              </span><span class="annot"><span class="annottext">([String] -&gt; [(String, Bool)]) -&gt; [String] -&gt; [(String, Bool)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><span class="hs-identifier hs-var">words</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578213"><span class="hs-identifier hs-var">grp2</span></a></span><span>
</span><span id="line-231"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span>    </span><span id="local-6989586621684578219"><span class="annot"><span class="annottext">unfold :: [(a, [(a, b)])] -&gt; ((a, b), [a]) -&gt; ((a, b), [((a, b), [a])])
</span><a href="#local-6989586621684578219"><span class="hs-identifier hs-var hs-var">unfold</span></a></span></span><span> </span><span id="local-6989586621684578206"><span class="annot"><span class="annottext">[(a, [(a, b)])]
</span><a href="#local-6989586621684578206"><span class="hs-identifier hs-var">thresholds</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621684578205"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684578205"><span class="hs-identifier hs-var">parent</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578204"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621684578204"><span class="hs-identifier hs-var">parent_cmp</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578203"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621684578203"><span class="hs-identifier hs-var">ancestors</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-234"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684578202"><span class="annot"><span class="annottext">ancestors' :: [a]
</span><a href="#local-6989586621684578202"><span class="hs-identifier hs-var hs-var">ancestors'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684578205"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621684578203"><span class="hs-identifier hs-var">ancestors</span></a></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span>          </span><span id="local-6989586621684578192"><span class="annot"><span class="annottext">isChild :: (a, [(a, b)]) -&gt; Maybe ((a, b), [a])
</span><a href="#local-6989586621684578192"><span class="hs-identifier hs-var hs-var">isChild</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684578191"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684578191"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578190"><span class="annot"><span class="annottext">[(a, b)]
</span><a href="#local-6989586621684578190"><span class="hs-identifier hs-var">v_ancestors</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-237"></span><span>            </span><span id="local-6989586621684578189"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621684578189"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; [(a, b)] -&gt; Maybe b
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684578205"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, b)]
</span><a href="#local-6989586621684578190"><span class="hs-identifier hs-var">v_ancestors</span></a></span><span>
</span><span id="line-238"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-239"></span><span>              </span><span class="annot"><span class="annottext">[a] -&gt; [a]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sort</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((a, b) -&gt; a) -&gt; [(a, b)] -&gt; [a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(a, b) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(a, b)]
</span><a href="#local-6989586621684578190"><span class="hs-identifier hs-var">v_ancestors</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>                </span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sort</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684578205"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621684578203"><span class="hs-identifier hs-var">ancestors</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>            </span><span class="annot"><span class="annottext">((a, b), [a]) -&gt; Maybe ((a, b), [a])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684578191"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621684578189"><span class="hs-identifier hs-var">cmp</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621684578202"><span class="hs-identifier hs-var">ancestors'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684578205"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621684578204"><span class="hs-identifier hs-var">parent_cmp</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">((a, [(a, b)]) -&gt; Maybe ((a, b), [a]))
-&gt; [(a, [(a, b)])] -&gt; [((a, b), [a])]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">(a, [(a, b)]) -&gt; Maybe ((a, b), [a])
forall {a} {b}. (a, [(a, b)]) -&gt; Maybe ((a, b), [a])
</span><a href="#local-6989586621684578192"><span class="hs-identifier hs-var">isChild</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, [(a, b)])]
</span><a href="#local-6989586621684578206"><span class="hs-identifier hs-var">thresholds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="hs-comment">-- | The performance difference in percentage that triggers a non-monotonicity</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- warning. This is to account for slight variantions in run-time.</span><span>
</span><span id="line-246"></span><span class="annot"><a href="Futhark.CLI.Autotune.html#epsilon"><span class="hs-identifier hs-type">epsilon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-247"></span><span id="epsilon"><span class="annot"><span class="annottext">epsilon :: Double
</span><a href="Futhark.CLI.Autotune.html#epsilon"><span class="hs-identifier hs-var hs-var">epsilon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1.02</span></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span class="hs-comment">--- Doing the atual tuning</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="annot"><a href="Futhark.CLI.Autotune.html#tuneThreshold"><span class="hs-identifier hs-type">tuneThreshold</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-252"></span><span>  </span><span class="annot"><a href="Futhark.CLI.Autotune.html#AutotuneOptions"><span class="hs-identifier hs-type">AutotuneOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-253"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CLI.Autotune.html#DatasetName"><span class="hs-identifier hs-type">DatasetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#RunDataset"><span class="hs-identifier hs-type">RunDataset</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CLI.Autotune.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#DatasetName"><span class="hs-identifier hs-type">DatasetName</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-257"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CLI.Autotune.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#DatasetName"><span class="hs-identifier hs-type">DatasetName</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span id="tuneThreshold"><span class="annot"><span class="annottext">tuneThreshold :: AutotuneOptions
-&gt; Server
-&gt; [(String, RunDataset, Text)]
-&gt; ([(String, Int)], Map String Int)
-&gt; (String, [(String, Int)])
-&gt; IO ([(String, Int)], Map String Int)
</span><a href="Futhark.CLI.Autotune.html#tuneThreshold"><span class="hs-identifier hs-var hs-var">tuneThreshold</span></a></span></span><span> </span><span id="local-6989586621684578185"><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578185"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621684578184"><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621684578184"><span class="hs-identifier hs-var">server</span></a></span></span><span> </span><span id="local-6989586621684578183"><span class="annot"><span class="annottext">[(String, RunDataset, Text)]
</span><a href="#local-6989586621684578183"><span class="hs-identifier hs-var">datasets</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684578182"><span class="annot"><span class="annottext">[(String, Int)]
</span><a href="#local-6989586621684578182"><span class="hs-identifier hs-var">already_tuned</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578181"><span class="annot"><span class="annottext">Map String Int
</span><a href="#local-6989586621684578181"><span class="hs-identifier hs-var">best_runtimes0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684578180"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578180"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578179"><span class="annot"><span class="annottext">[(String, Int)]
</span><a href="#local-6989586621684578179"><span class="hs-identifier hs-var">_v_path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684578178"><span class="annot"><span class="annottext">Maybe (Int, Int)
</span><a href="#local-6989586621684578178"><span class="hs-identifier hs-var">tune_result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578177"><span class="annot"><span class="annottext">Map String Int
</span><a href="#local-6989586621684578177"><span class="hs-identifier hs-var">best_runtimes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-260"></span><span>    </span><span class="annot"><span class="annottext">((Maybe (Int, Int), Map String Int)
 -&gt; (String, RunDataset, Text)
 -&gt; IO (Maybe (Int, Int), Map String Int))
-&gt; (Maybe (Int, Int), Map String Int)
-&gt; [(String, RunDataset, Text)]
-&gt; IO (Maybe (Int, Int), Map String Int)
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Int, Int), Map String Int)
-&gt; (String, RunDataset, Text)
-&gt; IO (Maybe (Int, Int), Map String Int)
</span><a href="#local-6989586621684578175"><span class="hs-identifier hs-var">tuneDataset</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Int, Int)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map String Int
</span><a href="#local-6989586621684578181"><span class="hs-identifier hs-var">best_runtimes0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, RunDataset, Text)]
</span><a href="#local-6989586621684578183"><span class="hs-identifier hs-var">datasets</span></a></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Int, Int)
</span><a href="#local-6989586621684578178"><span class="hs-identifier hs-var">tune_result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Int, Int)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-263"></span><span>      </span><span class="annot"><span class="annottext">([(String, Int)], Map String Int)
-&gt; IO ([(String, Int)], Map String Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578180"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Futhark.CLI.Autotune.html#thresholdMin"><span class="hs-identifier hs-var">thresholdMin</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String, Int) -&gt; [(String, Int)] -&gt; [(String, Int)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(String, Int)]
</span><a href="#local-6989586621684578182"><span class="hs-identifier hs-var">already_tuned</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map String Int
</span><a href="#local-6989586621684578177"><span class="hs-identifier hs-var">best_runtimes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578174"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578174"><span class="hs-identifier hs-var">threshold</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-265"></span><span>      </span><span class="annot"><span class="annottext">([(String, Int)], Map String Int)
-&gt; IO ([(String, Int)], Map String Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578180"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578174"><span class="hs-identifier hs-var">threshold</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String, Int) -&gt; [(String, Int)] -&gt; [(String, Int)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(String, Int)]
</span><a href="#local-6989586621684578182"><span class="hs-identifier hs-var">already_tuned</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map String Int
</span><a href="#local-6989586621684578177"><span class="hs-identifier hs-var">best_runtimes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><a href="#local-6989586621684578175"><span class="hs-identifier hs-type">tuneDataset</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#DatasetName"><span class="hs-identifier hs-type">DatasetName</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CLI.Autotune.html#DatasetName"><span class="hs-identifier hs-type">DatasetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#RunDataset"><span class="hs-identifier hs-type">RunDataset</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#DatasetName"><span class="hs-identifier hs-type">DatasetName</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>    </span><span id="local-6989586621684578175"><span class="annot"><span class="annottext">tuneDataset :: (Maybe (Int, Int), Map String Int)
-&gt; (String, RunDataset, Text)
-&gt; IO (Maybe (Int, Int), Map String Int)
</span><a href="#local-6989586621684578175"><span class="hs-identifier hs-var hs-var">tuneDataset</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684578173"><span class="annot"><span class="annottext">Maybe (Int, Int)
</span><a href="#local-6989586621684578173"><span class="hs-identifier hs-var">thresholds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578172"><span class="annot"><span class="annottext">Map String Int
</span><a href="#local-6989586621684578172"><span class="hs-identifier hs-var">best_runtimes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684578171"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578171"><span class="hs-identifier hs-var">dataset_name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578170"><span class="annot"><span class="annottext">RunDataset
</span><a href="#local-6989586621684578170"><span class="hs-identifier hs-var">run</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578169"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684578169"><span class="hs-identifier hs-var">entry_point</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-269"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><span class="hs-identifier hs-var">isPrefixOf</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684578169"><span class="hs-identifier hs-var">entry_point</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578180"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-270"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-271"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutotuneOptions -&gt; Int
</span><a href="Futhark.CLI.Autotune.html#optVerbose"><span class="hs-identifier hs-var hs-var">optVerbose</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578185"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-272"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578180"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is irrelevant for&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684578169"><span class="hs-identifier hs-var">entry_point</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-273"></span><span>          </span><span class="annot"><span class="annottext">(Maybe (Int, Int), Map String Int)
-&gt; IO (Maybe (Int, Int), Map String Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Int, Int)
</span><a href="#local-6989586621684578173"><span class="hs-identifier hs-var">thresholds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map String Int
</span><a href="#local-6989586621684578172"><span class="hs-identifier hs-var">best_runtimes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-275"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-276"></span><span>            </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span>
</span><span id="line-277"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Tuning&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-278"></span><span>                </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578180"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-279"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;on entry point&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-280"></span><span>                </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684578169"><span class="hs-identifier hs-var">entry_point</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-281"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;and dataset&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-282"></span><span>                </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578171"><span class="hs-identifier hs-var">dataset_name</span></a></span><span>
</span><span id="line-283"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span>          </span><span id="local-6989586621684578168"><span class="annot"><span class="annottext">Either String ([(String, Int)], Int)
</span><a href="#local-6989586621684578168"><span class="hs-identifier hs-var">sample_run</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-286"></span><span>            </span><span class="annot"><span class="annottext">RunDataset
</span><a href="#local-6989586621684578170"><span class="hs-identifier hs-var">run</span></a></span><span>
</span><span id="line-287"></span><span>              </span><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621684578184"><span class="hs-identifier hs-var">server</span></a></span><span>
</span><span id="line-288"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutotuneOptions -&gt; Int
</span><a href="Futhark.CLI.Autotune.html#optTimeout"><span class="hs-identifier hs-var hs-var">optTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578185"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>              </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578180"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ((Int, Int) -&gt; Int) -&gt; Maybe (Int, Int) -&gt; Int
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Futhark.CLI.Autotune.html#thresholdMax"><span class="hs-identifier hs-var">thresholdMax</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Int
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Int, Int)
</span><a href="#local-6989586621684578173"><span class="hs-identifier hs-var">thresholds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String, Int) -&gt; [(String, Int)] -&gt; [(String, Int)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(String, Int)]
</span><a href="#local-6989586621684578182"><span class="hs-identifier hs-var">already_tuned</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either String ([(String, Int)], Int)
</span><a href="#local-6989586621684578168"><span class="hs-identifier hs-var">sample_run</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-292"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621684578167"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578167"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-293"></span><span>              </span><span class="hs-comment">-- If the sampling run fails, we treat it as zero information.</span><span>
</span><span id="line-294"></span><span>              </span><span class="hs-comment">-- One of our ancestor thresholds will have be set such that</span><span>
</span><span id="line-295"></span><span>              </span><span class="hs-comment">-- this path is never taken.</span><span>
</span><span id="line-296"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutotuneOptions -&gt; Int
</span><a href="Futhark.CLI.Autotune.html#optVerbose"><span class="hs-identifier hs-var hs-var">optVerbose</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578185"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-297"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-298"></span><span>                  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Sampling run failed:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578167"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-299"></span><span>              </span><span class="annot"><span class="annottext">(Maybe (Int, Int), Map String Int)
-&gt; IO (Maybe (Int, Int), Map String Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Int, Int)
</span><a href="#local-6989586621684578173"><span class="hs-identifier hs-var">thresholds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map String Int
</span><a href="#local-6989586621684578172"><span class="hs-identifier hs-var">best_runtimes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684578166"><span class="annot"><span class="annottext">[(String, Int)]
</span><a href="#local-6989586621684578166"><span class="hs-identifier hs-var">cmps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578165"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578165"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-301"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684578164"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578164"><span class="hs-identifier hs-var">tMin</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578163"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578163"><span class="hs-identifier hs-var">tMax</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Maybe (Int, Int) -&gt; (Int, Int)
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="Futhark.CLI.Autotune.html#thresholdMin"><span class="hs-identifier hs-var">thresholdMin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Futhark.CLI.Autotune.html#thresholdMax"><span class="hs-identifier hs-var">thresholdMax</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Int, Int)
</span><a href="#local-6989586621684578173"><span class="hs-identifier hs-var">thresholds</span></a></span><span>
</span><span id="line-302"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684578156"><span class="annot"><span class="annottext">ePars :: [Int]
</span><a href="#local-6989586621684578156"><span class="hs-identifier hs-var hs-var">ePars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-303"></span><span>                    </span><span class="annot"><span class="annottext">Set Int -&gt; [Int]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toAscList</span></span><span> </span><span class="annot"><span class="annottext">(Set Int -&gt; [Int]) -&gt; Set Int -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-304"></span><span>                      </span><span class="annot"><span class="annottext">((String, Int) -&gt; Int) -&gt; Set (String, Int) -&gt; Set Int
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">S.map</span></span><span> </span><span class="annot"><span class="annottext">(String, Int) -&gt; Int
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(Set (String, Int) -&gt; Set Int) -&gt; Set (String, Int) -&gt; Set Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-305"></span><span>                        </span><span class="annot"><span class="annottext">((String, Int) -&gt; Bool) -&gt; Set (String, Int) -&gt; Set (String, Int)
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, Int) -&gt; (String, Int) -&gt; Bool
</span><a href="#local-6989586621684578152"><span class="hs-identifier hs-var">candidateEPar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578164"><span class="hs-identifier hs-var">tMin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578163"><span class="hs-identifier hs-var">tMax</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Set (String, Int) -&gt; Set (String, Int))
-&gt; Set (String, Int) -&gt; Set (String, Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-306"></span><span>                          </span><span class="annot"><span class="annottext">[(String, Int)] -&gt; Set (String, Int)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(String, Int)]
</span><a href="#local-6989586621684578166"><span class="hs-identifier hs-var">cmps</span></a></span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span>                  </span><span class="annot"><a href="#local-6989586621684578150"><span class="hs-identifier hs-type">runner</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>                  </span><span id="local-6989586621684578150"><span class="annot"><span class="annottext">runner :: Int -&gt; Int -&gt; IO (Maybe Int)
</span><a href="#local-6989586621684578150"><span class="hs-identifier hs-var hs-var">runner</span></a></span></span><span> </span><span id="local-6989586621684578149"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578149"><span class="hs-identifier hs-var">timeout'</span></a></span></span><span> </span><span id="local-6989586621684578148"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578148"><span class="hs-identifier hs-var">threshold</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-310"></span><span>                    </span><span id="local-6989586621684578147"><span class="annot"><span class="annottext">Either String ([(String, Int)], Int)
</span><a href="#local-6989586621684578147"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RunDataset
</span><a href="#local-6989586621684578170"><span class="hs-identifier hs-var">run</span></a></span><span> </span><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621684578184"><span class="hs-identifier hs-var">server</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578149"><span class="hs-identifier hs-var">timeout'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578180"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578148"><span class="hs-identifier hs-var">threshold</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String, Int) -&gt; [(String, Int)] -&gt; [(String, Int)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(String, Int)]
</span><a href="#local-6989586621684578182"><span class="hs-identifier hs-var">already_tuned</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either String ([(String, Int)], Int)
</span><a href="#local-6989586621684578147"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-312"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(String, Int)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578146"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578146"><span class="hs-identifier hs-var">runTime</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-313"></span><span>                        </span><span class="annot"><span class="annottext">Maybe Int -&gt; IO (Maybe Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; IO (Maybe Int)) -&gt; Maybe Int -&gt; IO (Maybe Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578146"><span class="hs-identifier hs-var">runTime</span></a></span><span>
</span><span id="line-314"></span><span>                      </span><span class="annot"><span class="annottext">Either String ([(String, Int)], Int)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-315"></span><span>                        </span><span class="annot"><span class="annottext">Maybe Int -&gt; IO (Maybe Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutotuneOptions -&gt; Int
</span><a href="Futhark.CLI.Autotune.html#optVerbose"><span class="hs-identifier hs-var hs-var">optVerbose</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578185"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-318"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Got ePars: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; String) -&gt; [Int] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684578156"><span class="hs-identifier hs-var">ePars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621684578145"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578145"><span class="hs-identifier hs-var">best_t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578144"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578144"><span class="hs-identifier hs-var">newMax</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; IO (Maybe Int))
-&gt; (Int, Int) -&gt; [Int] -&gt; IO (Int, Int)
</span><a href="#local-6989586621684578143"><span class="hs-identifier hs-var">binarySearch</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IO (Maybe Int)
</span><a href="#local-6989586621684578150"><span class="hs-identifier hs-var">runner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578165"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578163"><span class="hs-identifier hs-var">tMax</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684578156"><span class="hs-identifier hs-var">ePars</span></a></span><span>
</span><span id="line-321"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684578132"><span class="annot"><span class="annottext">newMinIdx :: Maybe Int
</span><a href="#local-6989586621684578132"><span class="hs-identifier hs-var hs-var">newMinIdx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-322"></span><span>                    </span><span id="local-6989586621684578131"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578131"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">pred</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Maybe Int -&gt; Maybe Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; Maybe Int
forall a. Eq a =&gt; a -&gt; [a] -&gt; Maybe Int
</span><span class="hs-identifier hs-var">elemIndex</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578144"><span class="hs-identifier hs-var">newMax</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684578156"><span class="hs-identifier hs-var">ePars</span></a></span><span>
</span><span id="line-323"></span><span>                    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578131"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe Int
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Invalid lower index&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578131"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-324"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684578124"><span class="annot"><span class="annottext">newMin :: Int
</span><a href="#local-6989586621684578124"><span class="hs-identifier hs-var hs-var">newMin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a (f :: * -&gt; *). (Num a, Ord a, Foldable f) =&gt; f a -&gt; a
</span><a href="Futhark.Util.html#maxinum"><span class="hs-identifier hs-var">maxinum</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Int) -&gt; [Int] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Int] -&gt; [Int]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578164"><span class="hs-identifier hs-var">tMin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Maybe Int -&gt; Maybe Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684578156"><span class="hs-identifier hs-var">ePars</span></a></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int -&gt; Int
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621684578132"><span class="hs-identifier hs-var">newMinIdx</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-325"></span><span>              </span><span id="local-6989586621684578121"><span class="annot"><span class="annottext">Map String Int
</span><a href="#local-6989586621684578121"><span class="hs-identifier hs-var">best_runtimes'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-326"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578171"><span class="hs-identifier hs-var">dataset_name</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Map String Int -&gt; Maybe Int
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-operator hs-var">`M.lookup`</span></span><span> </span><span class="annot"><span class="annottext">Map String Int
</span><a href="#local-6989586621684578172"><span class="hs-identifier hs-var">best_runtimes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-327"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684578119"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578119"><span class="hs-identifier hs-var">rt</span></a></span></span><span>
</span><span id="line-328"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578119"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="Futhark.CLI.Autotune.html#epsilon"><span class="hs-identifier hs-var">epsilon</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578145"><span class="hs-identifier hs-var">best_t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-329"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-330"></span><span>                        </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span>
</span><span id="line-331"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WARNING! Possible non-monotonicity detected. Previous best run-time for dataset&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-332"></span><span>                            </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578171"><span class="hs-identifier hs-var">dataset_name</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-333"></span><span>                            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; was&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-334"></span><span>                            </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578119"><span class="hs-identifier hs-var">rt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-335"></span><span>                            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;but after tuning threshold&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-336"></span><span>                            </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578180"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-337"></span><span>                            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;it is&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-338"></span><span>                            </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578145"><span class="hs-identifier hs-var">best_t</span></a></span><span>
</span><span id="line-339"></span><span>                          </span><span class="hs-special">]</span><span>
</span><span id="line-340"></span><span>                      </span><span class="annot"><span class="annottext">Map String Int -&gt; IO (Map String Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Map String Int
</span><a href="#local-6989586621684578172"><span class="hs-identifier hs-var">best_runtimes</span></a></span><span>
</span><span id="line-341"></span><span>                  </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-342"></span><span>                    </span><span class="annot"><span class="annottext">Map String Int -&gt; IO (Map String Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Map String Int -&gt; IO (Map String Int))
-&gt; Map String Int -&gt; IO (Map String Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int)
-&gt; String -&gt; Int -&gt; Map String Int -&gt; Map String Int
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insertWith</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578171"><span class="hs-identifier hs-var">dataset_name</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578145"><span class="hs-identifier hs-var">best_t</span></a></span><span> </span><span class="annot"><span class="annottext">Map String Int
</span><a href="#local-6989586621684578172"><span class="hs-identifier hs-var">best_runtimes</span></a></span><span>
</span><span id="line-343"></span><span>              </span><span class="annot"><span class="annottext">(Maybe (Int, Int), Map String Int)
-&gt; IO (Maybe (Int, Int), Map String Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, Int) -&gt; Maybe (Int, Int)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578124"><span class="hs-identifier hs-var">newMin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578144"><span class="hs-identifier hs-var">newMax</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map String Int
</span><a href="#local-6989586621684578121"><span class="hs-identifier hs-var">best_runtimes'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span>    </span><span class="annot"><a href="#local-6989586621684578115"><span class="hs-identifier hs-type">bestPair</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>    </span><span id="local-6989586621684578115"><span class="annot"><span class="annottext">bestPair :: [(Int, Int)] -&gt; (Int, Int)
</span><a href="#local-6989586621684578115"><span class="hs-identifier hs-var hs-var">bestPair</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Int) -&gt; (Int, Int) -&gt; Ordering)
-&gt; [(Int, Int)] -&gt; (Int, Int)
forall (t :: * -&gt; *) a.
Foldable t =&gt;
(a -&gt; a -&gt; Ordering) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">minimumBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Ordering)
-&gt; ((Int, Int) -&gt; Int) -&gt; (Int, Int) -&gt; (Int, Int) -&gt; Ordering
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Int
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span>    </span><span class="annot"><a href="#local-6989586621684578113"><span class="hs-identifier hs-type">timeout</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-comment">-- We wish to let datasets run for the untuned time + 20% + 1 second.</span><span>
</span><span id="line-350"></span><span>    </span><span id="local-6989586621684578113"><span class="annot"><span class="annottext">timeout :: Int -&gt; Int
</span><a href="#local-6989586621684578113"><span class="hs-identifier hs-var hs-var">timeout</span></a></span></span><span> </span><span id="local-6989586621684578112"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578112"><span class="hs-identifier hs-var">elapsed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">ceiling</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578112"><span class="hs-identifier hs-var">elapsed</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1.2</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span>    </span><span class="annot"><a href="#local-6989586621684578152"><span class="hs-identifier hs-type">candidateEPar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-353"></span><span>    </span><span id="local-6989586621684578152"><span class="annot"><span class="annottext">candidateEPar :: (Int, Int) -&gt; (String, Int) -&gt; Bool
</span><a href="#local-6989586621684578152"><span class="hs-identifier hs-var hs-var">candidateEPar</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684578109"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578109"><span class="hs-identifier hs-var">tMin</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578108"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578108"><span class="hs-identifier hs-var">tMax</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684578107"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578107"><span class="hs-identifier hs-var">threshold</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578106"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578106"><span class="hs-identifier hs-var">ePar</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-354"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578106"><span class="hs-identifier hs-var">ePar</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578109"><span class="hs-identifier hs-var">tMin</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578106"><span class="hs-identifier hs-var">ePar</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578108"><span class="hs-identifier hs-var">tMax</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578107"><span class="hs-identifier hs-var">threshold</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578180"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span>    </span><span class="annot"><a href="#local-6989586621684578143"><span class="hs-identifier hs-type">binarySearch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>    </span><span id="local-6989586621684578143"><span class="annot"><span class="annottext">binarySearch :: (Int -&gt; Int -&gt; IO (Maybe Int))
-&gt; (Int, Int) -&gt; [Int] -&gt; IO (Int, Int)
</span><a href="#local-6989586621684578143"><span class="hs-identifier hs-var hs-var">binarySearch</span></a></span></span><span> </span><span id="local-6989586621684578104"><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IO (Maybe Int)
</span><a href="#local-6989586621684578104"><span class="hs-identifier hs-var">runner</span></a></span></span><span> </span><span id="local-6989586621684578103"><span class="annot"><span class="annottext">best :: (Int, Int)
</span><a href="#local-6989586621684578103"><span class="hs-identifier hs-var">best</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621684578102"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578102"><span class="hs-identifier hs-var">best_t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578101"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578101"><span class="hs-identifier hs-var">best_e_par</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684578100"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684578100"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-358"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; ([Int], [Int])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684578100"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684578100"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-359"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621684578096"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684578096"><span class="hs-identifier hs-var">lower</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578095"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578095"><span class="hs-identifier hs-var">middle</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684578094"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578094"><span class="hs-identifier hs-var">middle'</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684578093"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684578093"><span class="hs-identifier hs-var">upper</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-360"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutotuneOptions -&gt; Int
</span><a href="Futhark.CLI.Autotune.html#optVerbose"><span class="hs-identifier hs-var hs-var">optVerbose</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578185"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-361"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-362"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span>
</span><span id="line-363"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Trying e_par&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-364"></span><span>                  </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578095"><span class="hs-identifier hs-var">middle</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-365"></span><span>                  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;and&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-366"></span><span>                  </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578094"><span class="hs-identifier hs-var">middle'</span></a></span><span>
</span><span id="line-367"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-368"></span><span>          </span><span id="local-6989586621684578092"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621684578092"><span class="hs-identifier hs-var">candidate</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IO (Maybe Int)
</span><a href="#local-6989586621684578104"><span class="hs-identifier hs-var">runner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621684578113"><span class="hs-identifier hs-var">timeout</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578102"><span class="hs-identifier hs-var">best_t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578095"><span class="hs-identifier hs-var">middle</span></a></span><span>
</span><span id="line-369"></span><span>          </span><span id="local-6989586621684578091"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621684578091"><span class="hs-identifier hs-var">candidate'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IO (Maybe Int)
</span><a href="#local-6989586621684578104"><span class="hs-identifier hs-var">runner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621684578113"><span class="hs-identifier hs-var">timeout</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578102"><span class="hs-identifier hs-var">best_t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578094"><span class="hs-identifier hs-var">middle'</span></a></span><span>
</span><span id="line-370"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621684578092"><span class="hs-identifier hs-var">candidate</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621684578091"><span class="hs-identifier hs-var">candidate'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-371"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684578090"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578090"><span class="hs-identifier hs-var">new_t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684578089"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578089"><span class="hs-identifier hs-var">new_t'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-372"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578090"><span class="hs-identifier hs-var">new_t</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578089"><span class="hs-identifier hs-var">new_t'</span></a></span><span>
</span><span id="line-373"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-comment">-- recurse into lower half</span><span>
</span><span id="line-374"></span><span>                  </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; IO (Maybe Int))
-&gt; (Int, Int) -&gt; [Int] -&gt; IO (Int, Int)
</span><a href="#local-6989586621684578143"><span class="hs-identifier hs-var">binarySearch</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IO (Maybe Int)
</span><a href="#local-6989586621684578104"><span class="hs-identifier hs-var">runner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Int, Int)] -&gt; (Int, Int)
</span><a href="#local-6989586621684578115"><span class="hs-identifier hs-var">bestPair</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578090"><span class="hs-identifier hs-var">new_t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578095"><span class="hs-identifier hs-var">middle</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621684578103"><span class="hs-identifier hs-var">best</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684578096"><span class="hs-identifier hs-var">lower</span></a></span><span>
</span><span id="line-375"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-comment">-- recurse into upper half</span><span>
</span><span id="line-376"></span><span>                  </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; IO (Maybe Int))
-&gt; (Int, Int) -&gt; [Int] -&gt; IO (Int, Int)
</span><a href="#local-6989586621684578143"><span class="hs-identifier hs-var">binarySearch</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IO (Maybe Int)
</span><a href="#local-6989586621684578104"><span class="hs-identifier hs-var">runner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Int, Int)] -&gt; (Int, Int)
</span><a href="#local-6989586621684578115"><span class="hs-identifier hs-var">bestPair</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578089"><span class="hs-identifier hs-var">new_t'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578094"><span class="hs-identifier hs-var">middle'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621684578103"><span class="hs-identifier hs-var">best</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684578093"><span class="hs-identifier hs-var">upper</span></a></span><span>
</span><span id="line-377"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684578088"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578088"><span class="hs-identifier hs-var">new_t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-378"></span><span>              </span><span class="hs-comment">-- recurse into lower half</span><span>
</span><span id="line-379"></span><span>              </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; IO (Maybe Int))
-&gt; (Int, Int) -&gt; [Int] -&gt; IO (Int, Int)
</span><a href="#local-6989586621684578143"><span class="hs-identifier hs-var">binarySearch</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IO (Maybe Int)
</span><a href="#local-6989586621684578104"><span class="hs-identifier hs-var">runner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Int, Int)] -&gt; (Int, Int)
</span><a href="#local-6989586621684578115"><span class="hs-identifier hs-var">bestPair</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578088"><span class="hs-identifier hs-var">new_t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578095"><span class="hs-identifier hs-var">middle</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621684578103"><span class="hs-identifier hs-var">best</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684578096"><span class="hs-identifier hs-var">lower</span></a></span><span>
</span><span id="line-380"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684578087"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578087"><span class="hs-identifier hs-var">new_t'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-381"></span><span>              </span><span class="hs-comment">-- recurse into upper half</span><span>
</span><span id="line-382"></span><span>              </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; IO (Maybe Int))
-&gt; (Int, Int) -&gt; [Int] -&gt; IO (Int, Int)
</span><a href="#local-6989586621684578143"><span class="hs-identifier hs-var">binarySearch</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IO (Maybe Int)
</span><a href="#local-6989586621684578104"><span class="hs-identifier hs-var">runner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Int, Int)] -&gt; (Int, Int)
</span><a href="#local-6989586621684578115"><span class="hs-identifier hs-var">bestPair</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578087"><span class="hs-identifier hs-var">new_t'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578094"><span class="hs-identifier hs-var">middle'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621684578103"><span class="hs-identifier hs-var">best</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684578093"><span class="hs-identifier hs-var">upper</span></a></span><span>
</span><span id="line-383"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-384"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutotuneOptions -&gt; Int
</span><a href="Futhark.CLI.Autotune.html#optVerbose"><span class="hs-identifier hs-var hs-var">optVerbose</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578185"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-385"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-386"></span><span>                  </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span>
</span><span id="line-387"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Timing failed for candidates&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-388"></span><span>                      </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578095"><span class="hs-identifier hs-var">middle</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-389"></span><span>                      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;and&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-390"></span><span>                      </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578094"><span class="hs-identifier hs-var">middle'</span></a></span><span>
</span><span id="line-391"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-392"></span><span>              </span><span class="annot"><span class="annottext">(Int, Int) -&gt; IO (Int, Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578102"><span class="hs-identifier hs-var">best_t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578101"><span class="hs-identifier hs-var">best_e_par</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-394"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutotuneOptions -&gt; Int
</span><a href="Futhark.CLI.Autotune.html#optVerbose"><span class="hs-identifier hs-var hs-var">optVerbose</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578185"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-395"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Trying e_pars&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684578100"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-396"></span><span>          </span><span id="local-6989586621684578086"><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621684578086"><span class="hs-identifier hs-var">candidates</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-397"></span><span>            </span><span class="annot"><span class="annottext">[Maybe (Int, Int)] -&gt; [(Int, Int)]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe (Int, Int)] -&gt; [(Int, Int)])
-&gt; ([Maybe Int] -&gt; [Maybe (Int, Int)])
-&gt; [Maybe Int]
-&gt; [(Int, Int)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Maybe Int -&gt; Maybe (Int, Int))
-&gt; [Int] -&gt; [Maybe Int] -&gt; [Maybe (Int, Int)]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; (Int, Int)) -&gt; Maybe Int -&gt; Maybe (Int, Int)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; (Int, Int)) -&gt; Maybe Int -&gt; Maybe (Int, Int))
-&gt; (Int -&gt; Int -&gt; (Int, Int))
-&gt; Int
-&gt; Maybe Int
-&gt; Maybe (Int, Int)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; (Int, Int)) -&gt; Int -&gt; Int -&gt; (Int, Int)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684578100"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-398"></span><span>              </span><span class="annot"><span class="annottext">([Maybe Int] -&gt; [(Int, Int)]) -&gt; IO [Maybe Int] -&gt; IO [(Int, Int)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; IO (Maybe Int)) -&gt; [Int] -&gt; IO [Maybe Int]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IO (Maybe Int)
</span><a href="#local-6989586621684578104"><span class="hs-identifier hs-var">runner</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; IO (Maybe Int)) -&gt; Int -&gt; Int -&gt; IO (Maybe Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621684578113"><span class="hs-identifier hs-var">timeout</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578102"><span class="hs-identifier hs-var">best_t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684578100"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-399"></span><span>          </span><span class="annot"><span class="annottext">(Int, Int) -&gt; IO (Int, Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((Int, Int) -&gt; IO (Int, Int)) -&gt; (Int, Int) -&gt; IO (Int, Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Int, Int)] -&gt; (Int, Int)
</span><a href="#local-6989586621684578115"><span class="hs-identifier hs-var">bestPair</span></a></span><span> </span><span class="annot"><span class="annottext">([(Int, Int)] -&gt; (Int, Int)) -&gt; [(Int, Int)] -&gt; (Int, Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621684578103"><span class="hs-identifier hs-var">best</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; [(Int, Int)] -&gt; [(Int, Int)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621684578086"><span class="hs-identifier hs-var">candidates</span></a></span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span class="hs-comment">--- CLI</span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span class="annot"><a href="Futhark.CLI.Autotune.html#tune"><span class="hs-identifier hs-type">tune</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#AutotuneOptions"><span class="hs-identifier hs-type">AutotuneOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span>
</span><span id="line-404"></span><span id="tune"><span class="annot"><span class="annottext">tune :: AutotuneOptions -&gt; String -&gt; IO [(String, Int)]
</span><a href="Futhark.CLI.Autotune.html#tune"><span class="hs-identifier hs-var hs-var">tune</span></a></span></span><span> </span><span id="local-6989586621684578081"><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578081"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621684578080"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578080"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-405"></span><span>  </span><span id="local-6989586621684578079"><span class="annot"><span class="annottext">FutharkExe
</span><a href="#local-6989586621684578079"><span class="hs-identifier hs-var">futhark</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(String -&gt; FutharkExe) -&gt; IO String -&gt; IO FutharkExe
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; FutharkExe
</span><a href="Futhark.Test.html#FutharkExe"><span class="hs-identifier hs-var">FutharkExe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO String -&gt; IO FutharkExe) -&gt; IO String -&gt; IO FutharkExe
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO String -&gt; (String -&gt; IO String) -&gt; Maybe String -&gt; IO String
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">getExecutablePath</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; IO String) -&gt; Maybe String -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions -&gt; Maybe String
</span><a href="Futhark.CLI.Autotune.html#optFuthark"><span class="hs-identifier hs-var hs-var">optFuthark</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578081"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compiling &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578080"><span class="hs-identifier hs-var">prog</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;...&quot;</span></span><span>
</span><span id="line-408"></span><span>  </span><span id="local-6989586621684578077"><span class="annot"><span class="annottext">[(String, RunDataset, Text)]
</span><a href="#local-6989586621684578077"><span class="hs-identifier hs-var">datasets</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
-&gt; FutharkExe -&gt; String -&gt; IO [(String, RunDataset, Text)]
</span><a href="Futhark.CLI.Autotune.html#prepare"><span class="hs-identifier hs-var">prepare</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578081"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">FutharkExe
</span><a href="#local-6989586621684578079"><span class="hs-identifier hs-var">futhark</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578080"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span>  </span><span id="local-6989586621684578076"><span class="annot"><span class="annottext">ThresholdForest
</span><a href="#local-6989586621684578076"><span class="hs-identifier hs-var">forest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ThresholdForest
</span><a href="Futhark.CLI.Autotune.html#thresholdForest"><span class="hs-identifier hs-var">thresholdForest</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578080"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-411"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutotuneOptions -&gt; Int
</span><a href="Futhark.CLI.Autotune.html#optVerbose"><span class="hs-identifier hs-var hs-var">optVerbose</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578081"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-412"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Threshold forest:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; String -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Tree String] -&gt; String
</span><span class="hs-identifier hs-var">drawForest</span></span><span> </span><span class="annot"><span class="annottext">([Tree String] -&gt; String) -&gt; [Tree String] -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Tree (String, Bool) -&gt; Tree String)
-&gt; ThresholdForest -&gt; [Tree String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((String, Bool) -&gt; String) -&gt; Tree (String, Bool) -&gt; Tree String
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ThresholdForest
</span><a href="#local-6989586621684578076"><span class="hs-identifier hs-var">forest</span></a></span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684578074"><span class="annot"><span class="annottext">progbin :: String
</span><a href="#local-6989586621684578074"><span class="hs-identifier hs-var hs-var">progbin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><span class="hs-identifier hs-var">dropExtension</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578080"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-415"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Running with options: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutotuneOptions -&gt; [String]
</span><a href="Futhark.CLI.Autotune.html#serverOptions"><span class="hs-identifier hs-var">serverOptions</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578081"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span>  </span><span class="annot"><span class="annottext">ServerCfg -&gt; (Server -&gt; IO [(String, Int)]) -&gt; IO [(String, Int)]
forall a. ServerCfg -&gt; (Server -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">withServer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; ServerCfg
</span><a href="Futhark.Test.html#futharkServerCfg"><span class="hs-identifier hs-var">futharkServerCfg</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578074"><span class="hs-identifier hs-var">progbin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutotuneOptions -&gt; [String]
</span><a href="Futhark.CLI.Autotune.html#serverOptions"><span class="hs-identifier hs-var">serverOptions</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578081"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Server -&gt; IO [(String, Int)]) -&gt; IO [(String, Int)])
-&gt; (Server -&gt; IO [(String, Int)]) -&gt; IO [(String, Int)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684578071"><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621684578071"><span class="hs-identifier hs-var">server</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-418"></span><span>    </span><span class="annot"><span class="annottext">(([(String, Int)], Map String Int) -&gt; [(String, Int)])
-&gt; IO ([(String, Int)], Map String Int) -&gt; IO [(String, Int)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">([(String, Int)], Map String Int) -&gt; [(String, Int)]
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(IO ([(String, Int)], Map String Int) -&gt; IO [(String, Int)])
-&gt; ([(String, [(String, Int)])]
    -&gt; IO ([(String, Int)], Map String Int))
-&gt; [(String, [(String, Int)])]
-&gt; IO [(String, Int)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(([(String, Int)], Map String Int)
 -&gt; (String, [(String, Int)])
 -&gt; IO ([(String, Int)], Map String Int))
-&gt; ([(String, Int)], Map String Int)
-&gt; [(String, [(String, Int)])]
-&gt; IO ([(String, Int)], Map String Int)
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutotuneOptions
-&gt; Server
-&gt; [(String, RunDataset, Text)]
-&gt; ([(String, Int)], Map String Int)
-&gt; (String, [(String, Int)])
-&gt; IO ([(String, Int)], Map String Int)
</span><a href="Futhark.CLI.Autotune.html#tuneThreshold"><span class="hs-identifier hs-var">tuneThreshold</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578081"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Server
</span><a href="#local-6989586621684578071"><span class="hs-identifier hs-var">server</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, RunDataset, Text)]
</span><a href="#local-6989586621684578077"><span class="hs-identifier hs-var">datasets</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map String Int
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(String, [(String, Int)])] -&gt; IO [(String, Int)])
-&gt; [(String, [(String, Int)])] -&gt; IO [(String, Int)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-419"></span><span>      </span><span class="annot"><span class="annottext">ThresholdForest -&gt; [(String, [(String, Int)])]
</span><a href="Futhark.CLI.Autotune.html#tuningPaths"><span class="hs-identifier hs-var">tuningPaths</span></a></span><span> </span><span class="annot"><span class="annottext">ThresholdForest
</span><a href="#local-6989586621684578076"><span class="hs-identifier hs-var">forest</span></a></span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span class="annot"><a href="Futhark.CLI.Autotune.html#runAutotuner"><span class="hs-identifier hs-type">runAutotuner</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#AutotuneOptions"><span class="hs-identifier hs-type">AutotuneOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span id="runAutotuner"><span class="annot"><span class="annottext">runAutotuner :: AutotuneOptions -&gt; String -&gt; IO ()
</span><a href="Futhark.CLI.Autotune.html#runAutotuner"><span class="hs-identifier hs-var hs-var">runAutotuner</span></a></span></span><span> </span><span id="local-6989586621684578069"><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578069"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621684578068"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578068"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-423"></span><span>  </span><span id="local-6989586621684578067"><span class="annot"><span class="annottext">[(String, Int)]
</span><a href="#local-6989586621684578067"><span class="hs-identifier hs-var">best</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AutotuneOptions -&gt; String -&gt; IO [(String, Int)]
</span><a href="Futhark.CLI.Autotune.html#tune"><span class="hs-identifier hs-var">tune</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578069"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578068"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684578058"><span class="annot"><span class="annottext">tuning :: String
</span><a href="#local-6989586621684578058"><span class="hs-identifier hs-var hs-var">tuning</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unlines</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; String) -&gt; [String] -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-426"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621684578056"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578056"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684578055"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578055"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((String, Int) -&gt; String) -&gt; [(String, Int)] -&gt; [(String, Int)]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortOn</span></span><span> </span><span class="annot"><span class="annottext">(String, Int) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(String, Int)]
</span><a href="#local-6989586621684578067"><span class="hs-identifier hs-var">best</span></a></span><span>
</span><span id="line-427"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; [String]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; [String]) -&gt; String -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578056"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578055"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AutotuneOptions -&gt; Maybe String
</span><a href="Futhark.CLI.Autotune.html#optTuning"><span class="hs-identifier hs-var hs-var">optTuning</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578069"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-430"></span><span>    </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684578054"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578054"><span class="hs-identifier hs-var">suffix</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-432"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">writeFile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578068"><span class="hs-identifier hs-var">prog</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">&lt;.&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578054"><span class="hs-identifier hs-var">suffix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578058"><span class="hs-identifier hs-var">tuning</span></a></span><span>
</span><span id="line-433"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wrote &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578068"><span class="hs-identifier hs-var">prog</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">&lt;.&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578054"><span class="hs-identifier hs-var">suffix</span></a></span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Result of autotuning:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578058"><span class="hs-identifier hs-var">tuning</span></a></span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span class="annot"><a href="Futhark.CLI.Autotune.html#commandLineOptions"><span class="hs-identifier hs-type">commandLineOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.Util.Options.html#FunOptDescr"><span class="hs-identifier hs-type">FunOptDescr</span></a></span><span> </span><span class="annot"><a href="Futhark.CLI.Autotune.html#AutotuneOptions"><span class="hs-identifier hs-type">AutotuneOptions</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-438"></span><span id="commandLineOptions"><span class="annot"><span class="annottext">commandLineOptions :: [FunOptDescr AutotuneOptions]
</span><a href="Futhark.CLI.Autotune.html#commandLineOptions"><span class="hs-identifier hs-var hs-var">commandLineOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; ArgDescr (Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; String
-&gt; FunOptDescr AutotuneOptions
forall a. String -&gt; [String] -&gt; ArgDescr a -&gt; String -&gt; OptDescr a
</span><span class="hs-identifier hs-var">Option</span></span><span>
</span><span id="line-440"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;r&quot;</span></span><span>
</span><span id="line-441"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runs&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-442"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; String
-&gt; ArgDescr (Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
forall a. (String -&gt; a) -&gt; String -&gt; ArgDescr a
</span><span class="hs-identifier hs-var">ReqArg</span></span><span>
</span><span id="line-443"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684578048"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578048"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-444"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ReadS Int
forall a. Read a =&gt; ReadS a
</span><span class="hs-identifier hs-var">reads</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578048"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-445"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">(</span><span id="local-6989586621684578046"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578046"><span class="hs-identifier hs-var">n'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578046"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-446"></span><span>                  </span><span class="annot"><span class="annottext">(AutotuneOptions -&gt; AutotuneOptions)
-&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">((AutotuneOptions -&gt; AutotuneOptions)
 -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; (AutotuneOptions -&gt; AutotuneOptions)
-&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684578045"><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578045"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-447"></span><span>                    </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578045"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-448"></span><span>                      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">optRuns :: Int
</span><a href="Futhark.CLI.Autotune.html#optRuns"><span class="hs-identifier hs-var">optRuns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578046"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-449"></span><span>                      </span><span class="hs-special">}</span><span>
</span><span id="line-450"></span><span>                </span><span class="annot"><span class="annottext">[(Int, String)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-451"></span><span>                  </span><span class="annot"><span class="annottext">IO () -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; IO () -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;'&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578048"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;' is not a non-negative integer.&quot;</span></span><span>
</span><span id="line-452"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;RUNS&quot;</span></span><span>
</span><span id="line-454"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Run each test case this many times.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-456"></span><span>    </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; ArgDescr (Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; String
-&gt; FunOptDescr AutotuneOptions
forall a. String -&gt; [String] -&gt; ArgDescr a -&gt; String -&gt; OptDescr a
</span><span class="hs-identifier hs-var">Option</span></span><span>
</span><span id="line-457"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-458"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;backend&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-459"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; String
-&gt; ArgDescr (Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
forall a. (String -&gt; a) -&gt; String -&gt; ArgDescr a
</span><span class="hs-identifier hs-var">ReqArg</span></span><span>
</span><span id="line-460"></span><span>          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621684578044"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578044"><span class="hs-identifier hs-var">backend</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(AutotuneOptions -&gt; AutotuneOptions)
-&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">((AutotuneOptions -&gt; AutotuneOptions)
 -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; (AutotuneOptions -&gt; AutotuneOptions)
-&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684578043"><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578043"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578043"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">optBackend :: String
</span><a href="Futhark.CLI.Autotune.html#optBackend"><span class="hs-identifier hs-var">optBackend</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578044"><span class="hs-identifier hs-var">backend</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;BACKEND&quot;</span></span><span>
</span><span id="line-462"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The compiler used (defaults to 'opencl').&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-464"></span><span>    </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; ArgDescr (Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; String
-&gt; FunOptDescr AutotuneOptions
forall a. String -&gt; [String] -&gt; ArgDescr a -&gt; String -&gt; OptDescr a
</span><span class="hs-identifier hs-var">Option</span></span><span>
</span><span id="line-465"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-466"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;futhark&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-467"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; String
-&gt; ArgDescr (Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
forall a. (String -&gt; a) -&gt; String -&gt; ArgDescr a
</span><span class="hs-identifier hs-var">ReqArg</span></span><span>
</span><span id="line-468"></span><span>          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621684578042"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578042"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(AutotuneOptions -&gt; AutotuneOptions)
-&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">((AutotuneOptions -&gt; AutotuneOptions)
 -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; (AutotuneOptions -&gt; AutotuneOptions)
-&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684578041"><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578041"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578041"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">optFuthark :: Maybe String
</span><a href="Futhark.CLI.Autotune.html#optFuthark"><span class="hs-identifier hs-var">optFuthark</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578042"><span class="hs-identifier hs-var">prog</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;PROGRAM&quot;</span></span><span>
</span><span id="line-470"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The binary used for operations (defaults to 'futhark').&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-472"></span><span>    </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; ArgDescr (Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; String
-&gt; FunOptDescr AutotuneOptions
forall a. String -&gt; [String] -&gt; ArgDescr a -&gt; String -&gt; OptDescr a
</span><span class="hs-identifier hs-var">Option</span></span><span>
</span><span id="line-473"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-474"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pass-option&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-475"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; String
-&gt; ArgDescr (Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
forall a. (String -&gt; a) -&gt; String -&gt; ArgDescr a
</span><span class="hs-identifier hs-var">ReqArg</span></span><span>
</span><span id="line-476"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684578040"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578040"><span class="hs-identifier hs-var">opt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-477"></span><span>              </span><span class="annot"><span class="annottext">(AutotuneOptions -&gt; AutotuneOptions)
-&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">((AutotuneOptions -&gt; AutotuneOptions)
 -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; (AutotuneOptions -&gt; AutotuneOptions)
-&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684578039"><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578039"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-478"></span><span>                </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578039"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">optExtraOptions :: [String]
</span><a href="Futhark.CLI.Autotune.html#optExtraOptions"><span class="hs-identifier hs-var">optExtraOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578040"><span class="hs-identifier hs-var">opt</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions -&gt; [String]
</span><a href="Futhark.CLI.Autotune.html#optExtraOptions"><span class="hs-identifier hs-var hs-var">optExtraOptions</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578039"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-479"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;OPT&quot;</span></span><span>
</span><span id="line-481"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-482"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Pass this option to programs being run.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-483"></span><span>    </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; ArgDescr (Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; String
-&gt; FunOptDescr AutotuneOptions
forall a. String -&gt; [String] -&gt; ArgDescr a -&gt; String -&gt; OptDescr a
</span><span class="hs-identifier hs-var">Option</span></span><span>
</span><span id="line-484"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-485"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tuning&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-486"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; String
-&gt; ArgDescr (Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
forall a. (String -&gt; a) -&gt; String -&gt; ArgDescr a
</span><span class="hs-identifier hs-var">ReqArg</span></span><span>
</span><span id="line-487"></span><span>          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621684578038"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578038"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(AutotuneOptions -&gt; AutotuneOptions)
-&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">((AutotuneOptions -&gt; AutotuneOptions)
 -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; (AutotuneOptions -&gt; AutotuneOptions)
-&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684578037"><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578037"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578037"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">optTuning :: Maybe String
</span><a href="Futhark.CLI.Autotune.html#optTuning"><span class="hs-identifier hs-var">optTuning</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578038"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-488"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EXTENSION&quot;</span></span><span>
</span><span id="line-489"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Write tuning files with this extension (default: .tuning).&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-491"></span><span>    </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; ArgDescr (Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; String
-&gt; FunOptDescr AutotuneOptions
forall a. String -&gt; [String] -&gt; ArgDescr a -&gt; String -&gt; OptDescr a
</span><span class="hs-identifier hs-var">Option</span></span><span>
</span><span id="line-492"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-493"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;timeout&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-494"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; String
-&gt; ArgDescr (Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
forall a. (String -&gt; a) -&gt; String -&gt; ArgDescr a
</span><span class="hs-identifier hs-var">ReqArg</span></span><span>
</span><span id="line-495"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684578036"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578036"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-496"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ReadS Int
forall a. Read a =&gt; ReadS a
</span><span class="hs-identifier hs-var">reads</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578036"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-497"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">(</span><span id="local-6989586621684578035"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578035"><span class="hs-identifier hs-var">n'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-498"></span><span>                  </span><span class="annot"><span class="annottext">(AutotuneOptions -&gt; AutotuneOptions)
-&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">((AutotuneOptions -&gt; AutotuneOptions)
 -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; (AutotuneOptions -&gt; AutotuneOptions)
-&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684578034"><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578034"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578034"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">optTimeout :: Int
</span><a href="Futhark.CLI.Autotune.html#optTimeout"><span class="hs-identifier hs-var">optTimeout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684578035"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-499"></span><span>                </span><span class="annot"><span class="annottext">[(Int, String)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-500"></span><span>                  </span><span class="annot"><span class="annottext">IO () -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; IO () -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;'&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578036"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;' is not a non-negative integer.&quot;</span></span><span>
</span><span id="line-501"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-502"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SECONDS&quot;</span></span><span>
</span><span id="line-503"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Initial tuning timeout for each dataset. Later tuning runs are based off of the runtime of the first run.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-505"></span><span>    </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; ArgDescr (Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; String
-&gt; FunOptDescr AutotuneOptions
forall a. String -&gt; [String] -&gt; ArgDescr a -&gt; String -&gt; OptDescr a
</span><span class="hs-identifier hs-var">Option</span></span><span>
</span><span id="line-506"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;v&quot;</span></span><span>
</span><span id="line-507"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;verbose&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-508"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
-&gt; ArgDescr (Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
forall a. a -&gt; ArgDescr a
</span><span class="hs-identifier hs-var">NoArg</span></span><span> </span><span class="annot"><span class="annottext">(Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
 -&gt; ArgDescr (Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)))
-&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
-&gt; ArgDescr (Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(AutotuneOptions -&gt; AutotuneOptions)
-&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">((AutotuneOptions -&gt; AutotuneOptions)
 -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; (AutotuneOptions -&gt; AutotuneOptions)
-&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684578032"><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578032"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578032"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">optVerbose :: Int
</span><a href="Futhark.CLI.Autotune.html#optVerbose"><span class="hs-identifier hs-var">optVerbose</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AutotuneOptions -&gt; Int
</span><a href="Futhark.CLI.Autotune.html#optVerbose"><span class="hs-identifier hs-var hs-var">optVerbose</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578032"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Enable logging.  Pass multiple times for more.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-510"></span><span>    </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; ArgDescr (Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; String
-&gt; FunOptDescr AutotuneOptions
forall a. String -&gt; [String] -&gt; ArgDescr a -&gt; String -&gt; OptDescr a
</span><span class="hs-identifier hs-var">Option</span></span><span>
</span><span id="line-511"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-512"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spec-file&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-513"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; String
-&gt; ArgDescr (Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
forall a. (String -&gt; a) -&gt; String -&gt; ArgDescr a
</span><span class="hs-identifier hs-var">ReqArg</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621684578031"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578031"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(AutotuneOptions -&gt; AutotuneOptions)
-&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">((AutotuneOptions -&gt; AutotuneOptions)
 -&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions))
-&gt; (AutotuneOptions -&gt; AutotuneOptions)
-&gt; Either (IO ()) (AutotuneOptions -&gt; AutotuneOptions)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684578030"><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578030"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578030"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">optTestSpec :: Maybe String
</span><a href="Futhark.CLI.Autotune.html#optTestSpec"><span class="hs-identifier hs-var">optTestSpec</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578031"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;FILE&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Use test specification from this file.&quot;</span></span><span>
</span><span id="line-515"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-516"></span><span>
</span><span id="line-517"></span><span class="hs-comment">-- | Run @futhark autotune@</span><span>
</span><span id="line-518"></span><span class="annot"><a href="Futhark.CLI.Autotune.html#main"><span class="hs-identifier hs-type">main</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span id="main"><span class="annot"><span class="annottext">main :: String -&gt; [String] -&gt; IO ()
</span><a href="Futhark.CLI.Autotune.html#main"><span class="hs-identifier hs-var hs-var">main</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
-&gt; [FunOptDescr AutotuneOptions]
-&gt; String
-&gt; ([String] -&gt; AutotuneOptions -&gt; Maybe (IO ()))
-&gt; String
-&gt; [String]
-&gt; IO ()
forall cfg.
cfg
-&gt; [FunOptDescr cfg]
-&gt; String
-&gt; ([String] -&gt; cfg -&gt; Maybe (IO ()))
-&gt; String
-&gt; [String]
-&gt; IO ()
</span><a href="Futhark.Util.Options.html#mainWithOptions"><span class="hs-identifier hs-var">mainWithOptions</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="Futhark.CLI.Autotune.html#initialAutotuneOptions"><span class="hs-identifier hs-var">initialAutotuneOptions</span></a></span><span> </span><span class="annot"><span class="annottext">[FunOptDescr AutotuneOptions]
</span><a href="Futhark.CLI.Autotune.html#commandLineOptions"><span class="hs-identifier hs-var">commandLineOptions</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;options... program&quot;</span></span><span> </span><span class="annot"><span class="annottext">(([String] -&gt; AutotuneOptions -&gt; Maybe (IO ()))
 -&gt; String -&gt; [String] -&gt; IO ())
-&gt; ([String] -&gt; AutotuneOptions -&gt; Maybe (IO ()))
-&gt; String
-&gt; [String]
-&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684578028"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684578028"><span class="hs-identifier hs-var">progs</span></a></span></span><span> </span><span id="local-6989586621684578027"><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578027"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-520"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684578028"><span class="hs-identifier hs-var">progs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-521"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621684578026"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578026"><span class="hs-identifier hs-var">prog</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Maybe (IO ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Maybe (IO ())) -&gt; IO () -&gt; Maybe (IO ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions -&gt; String -&gt; IO ()
</span><a href="Futhark.CLI.Autotune.html#runAutotuner"><span class="hs-identifier hs-var">runAutotuner</span></a></span><span> </span><span class="annot"><span class="annottext">AutotuneOptions
</span><a href="#local-6989586621684578027"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684578026"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-522"></span><span>    </span><span class="annot"><span class="annottext">[String]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (IO ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-523"></span></pre></body></html>