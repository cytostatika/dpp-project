<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">-- | Facilities for answering queries about a program, such as &quot;what</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- appears at this source location&quot;, or &quot;where is this name bound&quot;.</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- The intent is that this is used as a building block for IDE-like</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- functionality.</span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.Futhark.Query</span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#BoundTo"><span class="hs-identifier">BoundTo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Language.Futhark.Query.html#boundLoc"><span class="hs-identifier">boundLoc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Language.Futhark.Query.html#AtPos"><span class="hs-identifier">AtPos</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Language.Futhark.Query.html#atPos"><span class="hs-identifier">atPos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><span class="hs-identifier">Pos</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">where</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">find</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Util.Loc.html"><span class="hs-identifier">Futhark.Util.Loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Loc</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Pos</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.html"><span class="hs-identifier">Language.Futhark</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html"><span class="hs-identifier">Language.Futhark.Semantic</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.Traversals.html"><span class="hs-identifier">Language.Futhark.Traversals</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath.Posix</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Posix</span></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-comment">-- | What a name is bound to.</span><span>
</span><span id="line-27"></span><span class="hs-keyword">data</span><span> </span><span id="BoundTo"><span class="annot"><a href="Language.Futhark.Query.html#BoundTo"><span class="hs-identifier hs-var">BoundTo</span></a></span></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="BoundTerm"><span class="annot"><a href="Language.Futhark.Query.html#BoundTerm"><span class="hs-identifier hs-var">BoundTerm</span></a></span></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#StructType"><span class="hs-identifier hs-type">StructType</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Loc</span></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="BoundModule"><span class="annot"><a href="Language.Futhark.Query.html#BoundModule"><span class="hs-identifier hs-var">BoundModule</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Loc</span></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="BoundModuleType"><span class="annot"><a href="Language.Futhark.Query.html#BoundModuleType"><span class="hs-identifier hs-var">BoundModuleType</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Loc</span></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="BoundType"><span class="annot"><a href="Language.Futhark.Query.html#BoundType"><span class="hs-identifier hs-var">BoundType</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Loc</span></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684520779"><span id="local-6989586621684520790"><span class="annot"><span class="annottext">BoundTo -&gt; BoundTo -&gt; Bool
(BoundTo -&gt; BoundTo -&gt; Bool)
-&gt; (BoundTo -&gt; BoundTo -&gt; Bool) -&gt; Eq BoundTo
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: BoundTo -&gt; BoundTo -&gt; Bool
$c/= :: BoundTo -&gt; BoundTo -&gt; Bool
== :: BoundTo -&gt; BoundTo -&gt; Bool
$c== :: BoundTo -&gt; BoundTo -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684520756"><span id="local-6989586621684520758"><span id="local-6989586621684520774"><span class="annot"><span class="annottext">Int -&gt; BoundTo -&gt; ShowS
[BoundTo] -&gt; ShowS
BoundTo -&gt; String
(Int -&gt; BoundTo -&gt; ShowS)
-&gt; (BoundTo -&gt; String) -&gt; ([BoundTo] -&gt; ShowS) -&gt; Show BoundTo
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [BoundTo] -&gt; ShowS
$cshowList :: [BoundTo] -&gt; ShowS
show :: BoundTo -&gt; String
$cshow :: BoundTo -&gt; String
showsPrec :: Int -&gt; BoundTo -&gt; ShowS
$cshowsPrec :: Int -&gt; BoundTo -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">data</span><span> </span><span id="Def"><span class="annot"><a href="Language.Futhark.Query.html#Def"><span class="hs-identifier hs-var">Def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DefBound"><span class="annot"><a href="Language.Futhark.Query.html#DefBound"><span class="hs-identifier hs-var">DefBound</span></a></span></span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#BoundTo"><span class="hs-identifier hs-type">BoundTo</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="DefIndirect"><span class="annot"><a href="Language.Futhark.Query.html#DefIndirect"><span class="hs-identifier hs-var">DefIndirect</span></a></span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684520742"><span id="local-6989586621684520747"><span class="annot"><span class="annottext">Def -&gt; Def -&gt; Bool
(Def -&gt; Def -&gt; Bool) -&gt; (Def -&gt; Def -&gt; Bool) -&gt; Eq Def
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Def -&gt; Def -&gt; Bool
$c/= :: Def -&gt; Def -&gt; Bool
== :: Def -&gt; Def -&gt; Bool
$c== :: Def -&gt; Def -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684520732"><span id="local-6989586621684520734"><span id="local-6989586621684520740"><span class="annot"><span class="annottext">Int -&gt; Def -&gt; ShowS
[Def] -&gt; ShowS
Def -&gt; String
(Int -&gt; Def -&gt; ShowS)
-&gt; (Def -&gt; String) -&gt; ([Def] -&gt; ShowS) -&gt; Show Def
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Def] -&gt; ShowS
$cshowList :: [Def] -&gt; ShowS
show :: Def -&gt; String
$cshow :: Def -&gt; String
showsPrec :: Int -&gt; Def -&gt; ShowS
$cshowsPrec :: Int -&gt; Def -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">type</span><span> </span><span id="Defs"><span class="annot"><a href="Language.Futhark.Query.html#Defs"><span class="hs-identifier hs-var">Defs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-comment">-- | Where was a bound variable actually bound?  That is, what is the</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- location of its definition?</span><span>
</span><span id="line-41"></span><span class="annot"><a href="Language.Futhark.Query.html#boundLoc"><span class="hs-identifier hs-type">boundLoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#BoundTo"><span class="hs-identifier hs-type">BoundTo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Loc</span></span><span>
</span><span id="line-42"></span><span id="boundLoc"><span class="annot"><span class="annottext">boundLoc :: BoundTo -&gt; Loc
</span><a href="Language.Futhark.Query.html#boundLoc"><span class="hs-identifier hs-var hs-var">boundLoc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Query.html#BoundTerm"><span class="hs-identifier hs-type">BoundTerm</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520731"><span class="annot"><span class="annottext">Loc
</span><a href="#local-6989586621684520731"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Loc
</span><a href="#local-6989586621684520731"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-43"></span><span class="annot"><a href="Language.Futhark.Query.html#boundLoc"><span class="hs-identifier hs-var">boundLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Query.html#BoundModule"><span class="hs-identifier hs-type">BoundModule</span></a></span><span> </span><span id="local-6989586621684520730"><span class="annot"><span class="annottext">Loc
</span><a href="#local-6989586621684520730"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Loc
</span><a href="#local-6989586621684520730"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-44"></span><span class="annot"><a href="Language.Futhark.Query.html#boundLoc"><span class="hs-identifier hs-var">boundLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Query.html#BoundModuleType"><span class="hs-identifier hs-type">BoundModuleType</span></a></span><span> </span><span id="local-6989586621684520729"><span class="annot"><span class="annottext">Loc
</span><a href="#local-6989586621684520729"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Loc
</span><a href="#local-6989586621684520729"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-45"></span><span class="annot"><a href="Language.Futhark.Query.html#boundLoc"><span class="hs-identifier hs-var">boundLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Query.html#BoundType"><span class="hs-identifier hs-type">BoundType</span></a></span><span> </span><span id="local-6989586621684520728"><span class="annot"><span class="annottext">Loc
</span><a href="#local-6989586621684520728"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Loc
</span><a href="#local-6989586621684520728"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="annot"><a href="Language.Futhark.Query.html#sizeDefs"><span class="hs-identifier hs-type">sizeDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#SizeBinder"><span class="hs-identifier hs-type">SizeBinder</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#Defs"><span class="hs-identifier hs-type">Defs</span></a></span><span>
</span><span id="line-48"></span><span id="sizeDefs"><span class="annot"><span class="annottext">sizeDefs :: SizeBinder VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#sizeDefs"><span class="hs-identifier hs-var hs-var">sizeDefs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#SizeBinder"><span class="hs-identifier hs-type">SizeBinder</span></a></span><span> </span><span id="local-6989586621684520725"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520725"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621684520724"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520724"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><span class="annottext">VName -&gt; Def -&gt; Defs
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520725"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(Def -&gt; Defs) -&gt; Def -&gt; Defs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BoundTo -&gt; Def
</span><a href="Language.Futhark.Query.html#DefBound"><span class="hs-identifier hs-var">DefBound</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundTo -&gt; Def) -&gt; BoundTo -&gt; Def
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StructType -&gt; Loc -&gt; BoundTo
</span><a href="Language.Futhark.Query.html#BoundTerm"><span class="hs-identifier hs-var">BoundTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; StructType
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType -&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as. PrimType -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Language.Futhark.Syntax.html#Signed"><span class="hs-identifier hs-var">Signed</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520724"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="annot"><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-type">patternDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#Defs"><span class="hs-identifier hs-type">Defs</span></a></span><span>
</span><span id="line-52"></span><span id="patternDefs"><span class="annot"><span class="annottext">patternDefs :: PatBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var hs-var">patternDefs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span id="local-6989586621684520714"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520714"><span class="hs-identifier hs-var">vn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span id="local-6989586621684520712"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684520712"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520711"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520711"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><span class="annottext">VName -&gt; Def -&gt; Defs
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520714"><span class="hs-identifier hs-var">vn</span></a></span><span> </span><span class="annot"><span class="annottext">(Def -&gt; Defs) -&gt; Def -&gt; Defs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BoundTo -&gt; Def
</span><a href="Language.Futhark.Query.html#DefBound"><span class="hs-identifier hs-var">DefBound</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundTo -&gt; Def) -&gt; BoundTo -&gt; Def
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StructType -&gt; Loc -&gt; BoundTo
</span><a href="Language.Futhark.Query.html#BoundTerm"><span class="hs-identifier hs-var">BoundTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; StructType
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684520712"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520711"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="annot"><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var">patternDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TuplePat"><span class="hs-identifier hs-type">TuplePat</span></a></span><span> </span><span id="local-6989586621684520708"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684520708"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><span class="annottext">[Defs] -&gt; Defs
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Defs] -&gt; Defs) -&gt; [Defs] -&gt; Defs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; Defs) -&gt; [PatBase Info VName] -&gt; [Defs]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var">patternDefs</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684520708"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-56"></span><span class="annot"><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var">patternDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RecordPat"><span class="hs-identifier hs-type">RecordPat</span></a></span><span> </span><span id="local-6989586621684520706"><span class="annot"><span class="annottext">[(Name, PatBase Info VName)]
</span><a href="#local-6989586621684520706"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><span class="annottext">[Defs] -&gt; Defs
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Defs] -&gt; Defs) -&gt; [Defs] -&gt; Defs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Name, PatBase Info VName) -&gt; Defs)
-&gt; [(Name, PatBase Info VName)] -&gt; [Defs]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var">patternDefs</span></a></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; Defs)
-&gt; ((Name, PatBase Info VName) -&gt; PatBase Info VName)
-&gt; (Name, PatBase Info VName)
-&gt; Defs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name, PatBase Info VName) -&gt; PatBase Info VName
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, PatBase Info VName)]
</span><a href="#local-6989586621684520706"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-58"></span><span class="annot"><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var">patternDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatParens"><span class="hs-identifier hs-type">PatParens</span></a></span><span> </span><span id="local-6989586621684520703"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520703"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var">patternDefs</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520703"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-59"></span><span class="annot"><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var">patternDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatAttr"><span class="hs-identifier hs-type">PatAttr</span></a></span><span> </span><span class="annot"><span class="annottext">AttrInfo VName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520701"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520701"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var">patternDefs</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520701"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-60"></span><span class="annot"><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var">patternDefs</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Wildcard"><span class="hs-identifier hs-type">Wildcard</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defs
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-61"></span><span class="annot"><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var">patternDefs</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatLit"><span class="hs-identifier hs-type">PatLit</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defs
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-62"></span><span class="annot"><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var">patternDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatAscription"><span class="hs-identifier hs-type">PatAscription</span></a></span><span> </span><span id="local-6989586621684520697"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520697"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-63"></span><span>  </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var">patternDefs</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520697"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-64"></span><span class="annot"><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var">patternDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatConstr"><span class="hs-identifier hs-type">PatConstr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Info PatType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520695"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684520695"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><span class="annottext">[Defs] -&gt; Defs
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Defs] -&gt; Defs) -&gt; [Defs] -&gt; Defs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; Defs) -&gt; [PatBase Info VName] -&gt; [Defs]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var">patternDefs</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684520695"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="annot"><a href="Language.Futhark.Query.html#typeParamDefs"><span class="hs-identifier hs-type">typeParamDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeParamBase"><span class="hs-identifier hs-type">TypeParamBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#Defs"><span class="hs-identifier hs-type">Defs</span></a></span><span>
</span><span id="line-68"></span><span id="typeParamDefs"><span class="annot"><span class="annottext">typeParamDefs :: TypeParamBase VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#typeParamDefs"><span class="hs-identifier hs-var hs-var">typeParamDefs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeParamDim"><span class="hs-identifier hs-type">TypeParamDim</span></a></span><span> </span><span id="local-6989586621684520692"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520692"><span class="hs-identifier hs-var">vn</span></a></span></span><span> </span><span id="local-6989586621684520691"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520691"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><span class="annottext">VName -&gt; Def -&gt; Defs
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520692"><span class="hs-identifier hs-var">vn</span></a></span><span> </span><span class="annot"><span class="annottext">(Def -&gt; Defs) -&gt; Def -&gt; Defs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BoundTo -&gt; Def
</span><a href="Language.Futhark.Query.html#DefBound"><span class="hs-identifier hs-var">DefBound</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundTo -&gt; Def) -&gt; BoundTo -&gt; Def
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StructType -&gt; Loc -&gt; BoundTo
</span><a href="Language.Futhark.Query.html#BoundTerm"><span class="hs-identifier hs-var">BoundTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; StructType
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) () -&gt; StructType)
-&gt; ScalarTypeBase (DimDecl VName) () -&gt; StructType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as. PrimType -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimType -&gt; ScalarTypeBase (DimDecl VName) ())
-&gt; PrimType -&gt; ScalarTypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Language.Futhark.Syntax.html#Signed"><span class="hs-identifier hs-var">Signed</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int32"><span class="hs-identifier hs-var">Int32</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520691"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="annot"><a href="Language.Futhark.Query.html#typeParamDefs"><span class="hs-identifier hs-var">typeParamDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeParamType"><span class="hs-identifier hs-type">TypeParamType</span></a></span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520688"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520688"><span class="hs-identifier hs-var">vn</span></a></span></span><span> </span><span id="local-6989586621684520687"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520687"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-71"></span><span>  </span><span class="annot"><span class="annottext">VName -&gt; Def -&gt; Defs
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520688"><span class="hs-identifier hs-var">vn</span></a></span><span> </span><span class="annot"><span class="annottext">(Def -&gt; Defs) -&gt; Def -&gt; Defs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BoundTo -&gt; Def
</span><a href="Language.Futhark.Query.html#DefBound"><span class="hs-identifier hs-var">DefBound</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundTo -&gt; Def) -&gt; BoundTo -&gt; Def
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Loc -&gt; BoundTo
</span><a href="Language.Futhark.Query.html#BoundType"><span class="hs-identifier hs-var">BoundType</span></a></span><span> </span><span class="annot"><span class="annottext">(Loc -&gt; BoundTo) -&gt; Loc -&gt; BoundTo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520687"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="annot"><a href="Language.Futhark.Query.html#expDefs"><span class="hs-identifier hs-type">expDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#Defs"><span class="hs-identifier hs-type">Defs</span></a></span><span>
</span><span id="line-74"></span><span id="expDefs"><span class="annot"><span class="annottext">expDefs :: Exp -&gt; Defs
</span><a href="Language.Futhark.Query.html#expDefs"><span class="hs-identifier hs-var hs-var">expDefs</span></a></span></span><span> </span><span id="local-6989586621684520685"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684520685"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><span class="annottext">State Defs Exp -&gt; Defs -&gt; Defs
forall s a. State s a -&gt; s -&gt; s
</span><span class="hs-identifier hs-var">execState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ASTMapper (StateT Defs Identity) -&gt; Exp -&gt; State Defs Exp
forall x (m :: * -&gt; *).
(ASTMappable x, Monad m) =&gt;
ASTMapper m -&gt; x -&gt; m x
</span><a href="Language.Futhark.Traversals.html#astMap"><span class="hs-identifier hs-var">astMap</span></a></span><span> </span><span class="annot"><span class="annottext">ASTMapper (StateT Defs Identity)
</span><a href="#local-6989586621684520682"><span class="hs-identifier hs-var">mapper</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684520685"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621684520681"><span class="hs-identifier hs-var">extra</span></a></span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-77"></span><span>    </span><span id="local-6989586621684520682"><span class="annot"><span class="annottext">mapper :: ASTMapper (StateT Defs Identity)
</span><a href="#local-6989586621684520682"><span class="hs-identifier hs-var hs-var">mapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-78"></span><span>      </span><span class="annot"><span class="annottext">ASTMapper (StateT Defs Identity)
forall (m :: * -&gt; *). Monad m =&gt; ASTMapper m
</span><a href="Language.Futhark.Traversals.html#identityMapper"><span class="hs-identifier hs-var">identityMapper</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">mapOnExp :: Exp -&gt; State Defs Exp
</span><a href="Language.Futhark.Traversals.html#mapOnExp"><span class="hs-identifier hs-var">mapOnExp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; State Defs Exp
forall {m :: * -&gt; *}. MonadState Defs m =&gt; Exp -&gt; m Exp
</span><a href="#local-6989586621684520675"><span class="hs-identifier hs-var">onExp</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-79"></span><span>    </span><span id="local-6989586621684520675"><span class="annot"><span class="annottext">onExp :: Exp -&gt; m Exp
</span><a href="#local-6989586621684520675"><span class="hs-identifier hs-var hs-var">onExp</span></a></span></span><span> </span><span id="local-6989586621684520666"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684520666"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-80"></span><span>      </span><span class="annot"><span class="annottext">(Defs -&gt; Defs) -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Defs -&gt; Defs -&gt; Defs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Defs
</span><a href="Language.Futhark.Query.html#expDefs"><span class="hs-identifier hs-var">expDefs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684520666"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>      </span><span class="annot"><span class="annottext">Exp -&gt; m Exp
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684520666"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span>    </span><span id="local-6989586621684520663"><span class="annot"><span class="annottext">identDefs :: IdentBase Info k -&gt; Map k Def
</span><a href="#local-6989586621684520663"><span class="hs-identifier hs-var hs-var">identDefs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span id="local-6989586621684520661"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621684520661"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span id="local-6989586621684520660"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684520660"><span class="hs-identifier hs-var">vt</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520659"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520659"><span class="hs-identifier hs-var">vloc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-84"></span><span>      </span><span class="annot"><span class="annottext">k -&gt; Def -&gt; Map k Def
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621684520661"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(Def -&gt; Map k Def) -&gt; Def -&gt; Map k Def
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BoundTo -&gt; Def
</span><a href="Language.Futhark.Query.html#DefBound"><span class="hs-identifier hs-var">DefBound</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundTo -&gt; Def) -&gt; BoundTo -&gt; Def
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StructType -&gt; Loc -&gt; BoundTo
</span><a href="Language.Futhark.Query.html#BoundTerm"><span class="hs-identifier hs-var">BoundTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; StructType
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684520660"><span class="hs-identifier hs-var">vt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Loc -&gt; BoundTo) -&gt; Loc -&gt; BoundTo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520659"><span class="hs-identifier hs-var">vloc</span></a></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span>    </span><span id="local-6989586621684520681"><span class="annot"><span class="annottext">extra :: Defs
</span><a href="#local-6989586621684520681"><span class="hs-identifier hs-var hs-var">extra</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-87"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684520685"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-88"></span><span>        </span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#LetPat"><span class="hs-identifier hs-type">LetPat</span></a></span><span> </span><span id="local-6989586621684520643"><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684520643"><span class="hs-identifier hs-var">sizes</span></a></span></span><span> </span><span id="local-6989586621684520642"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520642"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Info AppRes
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-89"></span><span>          </span><span class="annot"><span class="annottext">(SizeBinder VName -&gt; Defs) -&gt; [SizeBinder VName] -&gt; Defs
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">SizeBinder VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#sizeDefs"><span class="hs-identifier hs-var">sizeDefs</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684520643"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="annot"><span class="annottext">Defs -&gt; Defs -&gt; Defs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var">patternDefs</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520642"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-90"></span><span>        </span><span class="annot"><a href="Language.Futhark.Syntax.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span id="local-6989586621684520639"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684520639"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Info (Aliasing, StructRetType)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-91"></span><span>          </span><span class="annot"><span class="annottext">[Defs] -&gt; Defs
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; Defs) -&gt; [PatBase Info VName] -&gt; [Defs]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var">patternDefs</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684520639"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>        </span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#LetFun"><span class="hs-identifier hs-type">LetFun</span></a></span><span> </span><span id="local-6989586621684520637"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520637"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684520636"><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684520636"><span class="hs-identifier hs-var">tparams</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684520635"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684520635"><span class="hs-identifier hs-var">params</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span id="local-6989586621684520634"><span class="annot"><span class="annottext">StructRetType
</span><a href="#local-6989586621684520634"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520633"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520633"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Info AppRes
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-93"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684520630"><span class="annot"><span class="annottext">name_t :: StructType
</span><a href="#local-6989586621684520630"><span class="hs-identifier hs-var hs-var">name_t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[StructType] -&gt; StructRetType -&gt; StructType
forall as dim.
Monoid as =&gt;
[TypeBase dim as] -&gt; RetTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Prop.html#foldFunType"><span class="hs-identifier hs-var">foldFunType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; StructType)
-&gt; [PatBase Info VName] -&gt; [StructType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; StructType
</span><a href="Language.Futhark.Prop.html#patternStructType"><span class="hs-identifier hs-var">patternStructType</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684520635"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StructRetType
</span><a href="#local-6989586621684520634"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-94"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Def -&gt; Defs
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520637"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BoundTo -&gt; Def
</span><a href="Language.Futhark.Query.html#DefBound"><span class="hs-identifier hs-var">DefBound</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundTo -&gt; Def) -&gt; BoundTo -&gt; Def
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StructType -&gt; Loc -&gt; BoundTo
</span><a href="Language.Futhark.Query.html#BoundTerm"><span class="hs-identifier hs-var">BoundTerm</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684520630"><span class="hs-identifier hs-var">name_t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520633"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>                </span><span class="annot"><span class="annottext">Defs -&gt; Defs -&gt; Defs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Defs] -&gt; Defs
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeParamBase VName -&gt; Defs) -&gt; [TypeParamBase VName] -&gt; [Defs]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TypeParamBase VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#typeParamDefs"><span class="hs-identifier hs-var">typeParamDefs</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684520636"><span class="hs-identifier hs-var">tparams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>                </span><span class="annot"><span class="annottext">Defs -&gt; Defs -&gt; Defs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Defs] -&gt; Defs
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; Defs) -&gt; [PatBase Info VName] -&gt; [Defs]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var">patternDefs</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684520635"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>        </span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#LetWith"><span class="hs-identifier hs-type">LetWith</span></a></span><span> </span><span id="local-6989586621684520626"><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684520626"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SliceBase Info VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Info AppRes
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-98"></span><span>          </span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; Defs
forall {k}. IdentBase Info k -&gt; Map k Def
</span><a href="#local-6989586621684520663"><span class="hs-identifier hs-var">identDefs</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684520626"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-99"></span><span>        </span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#DoLoop"><span class="hs-identifier hs-type">DoLoop</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520624"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520624"><span class="hs-identifier hs-var">merge</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520623"><span class="annot"><span class="annottext">LoopFormBase Info VName
</span><a href="#local-6989586621684520623"><span class="hs-identifier hs-var">form</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Info AppRes
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-100"></span><span>          </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var">patternDefs</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520624"><span class="hs-identifier hs-var">merge</span></a></span><span>
</span><span id="line-101"></span><span>            </span><span class="annot"><span class="annottext">Defs -&gt; Defs -&gt; Defs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LoopFormBase Info VName
</span><a href="#local-6989586621684520623"><span class="hs-identifier hs-var">form</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-102"></span><span>              </span><span class="annot"><a href="Language.Futhark.Syntax.html#For"><span class="hs-identifier hs-type">For</span></a></span><span> </span><span id="local-6989586621684520621"><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684520621"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; Defs
forall {k}. IdentBase Info k -&gt; Map k Def
</span><a href="#local-6989586621684520663"><span class="hs-identifier hs-var">identDefs</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684520621"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-103"></span><span>              </span><span class="annot"><a href="Language.Futhark.Syntax.html#ForIn"><span class="hs-identifier hs-type">ForIn</span></a></span><span> </span><span id="local-6989586621684520619"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520619"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var">patternDefs</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520619"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-104"></span><span>              </span><span class="annot"><a href="Language.Futhark.Syntax.html#While"><span class="hs-identifier hs-type">While</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Defs
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-105"></span><span>        </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-106"></span><span>          </span><span class="annot"><span class="annottext">Defs
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="annot"><a href="Language.Futhark.Query.html#valBindDefs"><span class="hs-identifier hs-type">valBindDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#ValBind"><span class="hs-identifier hs-type">ValBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#Defs"><span class="hs-identifier hs-type">Defs</span></a></span><span>
</span><span id="line-109"></span><span id="valBindDefs"><span class="annot"><span class="annottext">valBindDefs :: ValBind -&gt; Defs
</span><a href="Language.Futhark.Query.html#valBindDefs"><span class="hs-identifier hs-var hs-var">valBindDefs</span></a></span></span><span> </span><span id="local-6989586621684520616"><span class="annot"><span class="annottext">ValBind
</span><a href="#local-6989586621684520616"><span class="hs-identifier hs-var">vbind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-110"></span><span>  </span><span class="annot"><span class="annottext">VName -&gt; Def -&gt; Defs -&gt; Defs
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValBind -&gt; VName
forall (f :: * -&gt; *) vn. ValBindBase f vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#valBindName"><span class="hs-identifier hs-var hs-var">valBindName</span></a></span><span> </span><span class="annot"><span class="annottext">ValBind
</span><a href="#local-6989586621684520616"><span class="hs-identifier hs-var">vbind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BoundTo -&gt; Def
</span><a href="Language.Futhark.Query.html#DefBound"><span class="hs-identifier hs-var">DefBound</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundTo -&gt; Def) -&gt; BoundTo -&gt; Def
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StructType -&gt; Loc -&gt; BoundTo
</span><a href="Language.Futhark.Query.html#BoundTerm"><span class="hs-identifier hs-var">BoundTerm</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684520613"><span class="hs-identifier hs-var">vbind_t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValBind -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">ValBind
</span><a href="#local-6989586621684520616"><span class="hs-identifier hs-var">vbind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Defs -&gt; Defs) -&gt; Defs -&gt; Defs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><span class="annottext">[Defs] -&gt; Defs
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeParamBase VName -&gt; Defs) -&gt; [TypeParamBase VName] -&gt; [Defs]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TypeParamBase VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#typeParamDefs"><span class="hs-identifier hs-var">typeParamDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValBind -&gt; [TypeParamBase VName]
forall (f :: * -&gt; *) vn. ValBindBase f vn -&gt; [TypeParamBase vn]
</span><a href="Language.Futhark.Syntax.html#valBindTypeParams"><span class="hs-identifier hs-var hs-var">valBindTypeParams</span></a></span><span> </span><span class="annot"><span class="annottext">ValBind
</span><a href="#local-6989586621684520616"><span class="hs-identifier hs-var">vbind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>      </span><span class="annot"><span class="annottext">Defs -&gt; Defs -&gt; Defs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Defs] -&gt; Defs
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; Defs) -&gt; [PatBase Info VName] -&gt; [Defs]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#patternDefs"><span class="hs-identifier hs-var">patternDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValBind -&gt; [PatBase Info VName]
forall (f :: * -&gt; *) vn. ValBindBase f vn -&gt; [PatBase f vn]
</span><a href="Language.Futhark.Syntax.html#valBindParams"><span class="hs-identifier hs-var hs-var">valBindParams</span></a></span><span> </span><span class="annot"><span class="annottext">ValBind
</span><a href="#local-6989586621684520616"><span class="hs-identifier hs-var">vbind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><span class="annottext">Defs -&gt; Defs -&gt; Defs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Defs
</span><a href="Language.Futhark.Query.html#expDefs"><span class="hs-identifier hs-var">expDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValBind -&gt; Exp
forall (f :: * -&gt; *) vn. ValBindBase f vn -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#valBindBody"><span class="hs-identifier hs-var hs-var">valBindBody</span></a></span><span> </span><span class="annot"><span class="annottext">ValBind
</span><a href="#local-6989586621684520616"><span class="hs-identifier hs-var">vbind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-115"></span><span>    </span><span id="local-6989586621684520613"><span class="annot"><span class="annottext">vbind_t :: StructType
</span><a href="#local-6989586621684520613"><span class="hs-identifier hs-var hs-var">vbind_t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-116"></span><span>      </span><span class="annot"><span class="annottext">[StructType] -&gt; StructRetType -&gt; StructType
forall as dim.
Monoid as =&gt;
[TypeBase dim as] -&gt; RetTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Prop.html#foldFunType"><span class="hs-identifier hs-var">foldFunType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; StructType)
-&gt; [PatBase Info VName] -&gt; [StructType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; StructType
</span><a href="Language.Futhark.Prop.html#patternStructType"><span class="hs-identifier hs-var">patternStructType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValBind -&gt; [PatBase Info VName]
forall (f :: * -&gt; *) vn. ValBindBase f vn -&gt; [PatBase f vn]
</span><a href="Language.Futhark.Syntax.html#valBindParams"><span class="hs-identifier hs-var hs-var">valBindParams</span></a></span><span> </span><span class="annot"><span class="annottext">ValBind
</span><a href="#local-6989586621684520616"><span class="hs-identifier hs-var">vbind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StructRetType -&gt; StructType) -&gt; StructRetType -&gt; StructType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-117"></span><span>        </span><span class="annot"><span class="annottext">Info StructRetType -&gt; StructRetType
forall a. Info a -&gt; a
</span><a href="Language.Futhark.Syntax.html#unInfo"><span class="hs-identifier hs-var hs-var">unInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Info StructRetType -&gt; StructRetType)
-&gt; Info StructRetType -&gt; StructRetType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ValBind -&gt; Info StructRetType
forall (f :: * -&gt; *) vn. ValBindBase f vn -&gt; f StructRetType
</span><a href="Language.Futhark.Syntax.html#valBindRetType"><span class="hs-identifier hs-var hs-var">valBindRetType</span></a></span><span> </span><span class="annot"><span class="annottext">ValBind
</span><a href="#local-6989586621684520616"><span class="hs-identifier hs-var">vbind</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="annot"><a href="Language.Futhark.Query.html#typeBindDefs"><span class="hs-identifier hs-type">typeBindDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#Defs"><span class="hs-identifier hs-type">Defs</span></a></span><span>
</span><span id="line-120"></span><span id="typeBindDefs"><span class="annot"><span class="annottext">typeBindDefs :: TypeBind -&gt; Defs
</span><a href="Language.Futhark.Query.html#typeBindDefs"><span class="hs-identifier hs-var hs-var">typeBindDefs</span></a></span></span><span> </span><span id="local-6989586621684520605"><span class="annot"><span class="annottext">TypeBind
</span><a href="#local-6989586621684520605"><span class="hs-identifier hs-var">tbind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-121"></span><span>  </span><span class="annot"><span class="annottext">VName -&gt; Def -&gt; Defs
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeBind -&gt; VName
forall (f :: * -&gt; *) vn. TypeBindBase f vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#typeAlias"><span class="hs-identifier hs-var hs-var">typeAlias</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBind
</span><a href="#local-6989586621684520605"><span class="hs-identifier hs-var">tbind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Def -&gt; Defs) -&gt; Def -&gt; Defs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BoundTo -&gt; Def
</span><a href="Language.Futhark.Query.html#DefBound"><span class="hs-identifier hs-var">DefBound</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundTo -&gt; Def) -&gt; BoundTo -&gt; Def
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Loc -&gt; BoundTo
</span><a href="Language.Futhark.Query.html#BoundType"><span class="hs-identifier hs-var">BoundType</span></a></span><span> </span><span class="annot"><span class="annottext">(Loc -&gt; BoundTo) -&gt; Loc -&gt; BoundTo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBind -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">TypeBind
</span><a href="#local-6989586621684520605"><span class="hs-identifier hs-var">tbind</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="annot"><a href="Language.Futhark.Query.html#modParamDefs"><span class="hs-identifier hs-type">modParamDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#ModParam"><span class="hs-identifier hs-type">ModParam</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#Defs"><span class="hs-identifier hs-type">Defs</span></a></span><span>
</span><span id="line-124"></span><span id="modParamDefs"><span class="annot"><span class="annottext">modParamDefs :: ModParam -&gt; Defs
</span><a href="Language.Futhark.Query.html#modParamDefs"><span class="hs-identifier hs-var hs-var">modParamDefs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModParam"><span class="hs-identifier hs-type">ModParam</span></a></span><span> </span><span id="local-6989586621684520601"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520601"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621684520600"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520600"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span class="annot"><span class="annottext">Info [VName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520599"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520599"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><span class="annottext">VName -&gt; Def -&gt; Defs
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520601"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BoundTo -&gt; Def
</span><a href="Language.Futhark.Query.html#DefBound"><span class="hs-identifier hs-var">DefBound</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundTo -&gt; Def) -&gt; BoundTo -&gt; Def
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Loc -&gt; BoundTo
</span><a href="Language.Futhark.Query.html#BoundModule"><span class="hs-identifier hs-var">BoundModule</span></a></span><span> </span><span class="annot"><span class="annottext">(Loc -&gt; BoundTo) -&gt; Loc -&gt; BoundTo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520599"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><span class="annottext">Defs -&gt; Defs -&gt; Defs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#sigExpDefs"><span class="hs-identifier hs-var">sigExpDefs</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520600"><span class="hs-identifier hs-var">se</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="annot"><a href="Language.Futhark.Query.html#modExpDefs"><span class="hs-identifier hs-type">modExpDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#ModExp"><span class="hs-identifier hs-type">ModExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#Defs"><span class="hs-identifier hs-type">Defs</span></a></span><span>
</span><span id="line-129"></span><span id="modExpDefs"><span class="annot"><span class="annottext">modExpDefs :: ModExp -&gt; Defs
</span><a href="Language.Futhark.Query.html#modExpDefs"><span class="hs-identifier hs-var hs-var">modExpDefs</span></a></span></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#ModVar"><span class="hs-identifier hs-type">ModVar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><span class="annottext">Defs
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-131"></span><span class="annot"><a href="Language.Futhark.Query.html#modExpDefs"><span class="hs-identifier hs-var">modExpDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModParens"><span class="hs-identifier hs-type">ModParens</span></a></span><span> </span><span id="local-6989586621684520594"><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520594"><span class="hs-identifier hs-var">me</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><span class="annottext">ModExp -&gt; Defs
</span><a href="Language.Futhark.Query.html#modExpDefs"><span class="hs-identifier hs-var">modExpDefs</span></a></span><span> </span><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520594"><span class="hs-identifier hs-var">me</span></a></span><span>
</span><span id="line-133"></span><span class="annot"><a href="Language.Futhark.Query.html#modExpDefs"><span class="hs-identifier hs-var">modExpDefs</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#ModImport"><span class="hs-identifier hs-type">ModImport</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-134"></span><span>  </span><span class="annot"><span class="annottext">Defs
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-135"></span><span class="annot"><a href="Language.Futhark.Query.html#modExpDefs"><span class="hs-identifier hs-var">modExpDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModDecs"><span class="hs-identifier hs-type">ModDecs</span></a></span><span> </span><span id="local-6989586621684520591"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621684520591"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-136"></span><span>  </span><span class="annot"><span class="annottext">[Defs] -&gt; Defs
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Defs] -&gt; Defs) -&gt; [Defs] -&gt; Defs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Dec -&gt; Defs) -&gt; [Dec] -&gt; [Defs]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dec -&gt; Defs
</span><a href="Language.Futhark.Query.html#decDefs"><span class="hs-identifier hs-var">decDefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621684520591"><span class="hs-identifier hs-var">decs</span></a></span><span>
</span><span id="line-137"></span><span class="annot"><a href="Language.Futhark.Query.html#modExpDefs"><span class="hs-identifier hs-var">modExpDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModApply"><span class="hs-identifier hs-type">ModApply</span></a></span><span> </span><span id="local-6989586621684520588"><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520588"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621684520587"><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520587"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="annot"><span class="annottext">Info (Map VName VName)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span id="local-6989586621684520586"><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684520586"><span class="hs-identifier hs-var">substs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-138"></span><span>  </span><span class="annot"><span class="annottext">ModExp -&gt; Defs
</span><a href="Language.Futhark.Query.html#modExpDefs"><span class="hs-identifier hs-var">modExpDefs</span></a></span><span> </span><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520588"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">Defs -&gt; Defs -&gt; Defs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ModExp -&gt; Defs
</span><a href="Language.Futhark.Query.html#modExpDefs"><span class="hs-identifier hs-var">modExpDefs</span></a></span><span> </span><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520587"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">Defs -&gt; Defs -&gt; Defs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Def) -&gt; Map VName VName -&gt; Defs
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Def
</span><a href="Language.Futhark.Query.html#DefIndirect"><span class="hs-identifier hs-var">DefIndirect</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684520586"><span class="hs-identifier hs-var">substs</span></a></span><span>
</span><span id="line-139"></span><span class="annot"><a href="Language.Futhark.Query.html#modExpDefs"><span class="hs-identifier hs-var">modExpDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModAscript"><span class="hs-identifier hs-type">ModAscript</span></a></span><span> </span><span id="local-6989586621684520583"><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520583"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span id="local-6989586621684520582"><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684520582"><span class="hs-identifier hs-var">substs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-140"></span><span>  </span><span class="annot"><span class="annottext">ModExp -&gt; Defs
</span><a href="Language.Futhark.Query.html#modExpDefs"><span class="hs-identifier hs-var">modExpDefs</span></a></span><span> </span><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520583"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Defs -&gt; Defs -&gt; Defs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Def) -&gt; Map VName VName -&gt; Defs
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Def
</span><a href="Language.Futhark.Query.html#DefIndirect"><span class="hs-identifier hs-var">DefIndirect</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684520582"><span class="hs-identifier hs-var">substs</span></a></span><span>
</span><span id="line-141"></span><span class="annot"><a href="Language.Futhark.Query.html#modExpDefs"><span class="hs-identifier hs-var">modExpDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModLambda"><span class="hs-identifier hs-type">ModLambda</span></a></span><span> </span><span id="local-6989586621684520580"><span class="annot"><span class="annottext">ModParam
</span><a href="#local-6989586621684520580"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (SigExpBase Info VName, Info (Map VName VName))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520579"><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520579"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-142"></span><span>  </span><span class="annot"><span class="annottext">ModParam -&gt; Defs
</span><a href="Language.Futhark.Query.html#modParamDefs"><span class="hs-identifier hs-var">modParamDefs</span></a></span><span> </span><span class="annot"><span class="annottext">ModParam
</span><a href="#local-6989586621684520580"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Defs -&gt; Defs -&gt; Defs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ModExp -&gt; Defs
</span><a href="Language.Futhark.Query.html#modExpDefs"><span class="hs-identifier hs-var">modExpDefs</span></a></span><span> </span><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520579"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="annot"><a href="Language.Futhark.Query.html#modBindDefs"><span class="hs-identifier hs-type">modBindDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#ModBind"><span class="hs-identifier hs-type">ModBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#Defs"><span class="hs-identifier hs-type">Defs</span></a></span><span>
</span><span id="line-145"></span><span id="modBindDefs"><span class="annot"><span class="annottext">modBindDefs :: ModBind -&gt; Defs
</span><a href="Language.Futhark.Query.html#modBindDefs"><span class="hs-identifier hs-var hs-var">modBindDefs</span></a></span></span><span> </span><span id="local-6989586621684520577"><span class="annot"><span class="annottext">ModBind
</span><a href="#local-6989586621684520577"><span class="hs-identifier hs-var">mbind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><span class="annottext">VName -&gt; Def -&gt; Defs
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModBind -&gt; VName
forall (f :: * -&gt; *) vn. ModBindBase f vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#modName"><span class="hs-identifier hs-var hs-var">modName</span></a></span><span> </span><span class="annot"><span class="annottext">ModBind
</span><a href="#local-6989586621684520577"><span class="hs-identifier hs-var">mbind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BoundTo -&gt; Def
</span><a href="Language.Futhark.Query.html#DefBound"><span class="hs-identifier hs-var">DefBound</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundTo -&gt; Def) -&gt; BoundTo -&gt; Def
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Loc -&gt; BoundTo
</span><a href="Language.Futhark.Query.html#BoundModule"><span class="hs-identifier hs-var">BoundModule</span></a></span><span> </span><span class="annot"><span class="annottext">(Loc -&gt; BoundTo) -&gt; Loc -&gt; BoundTo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModBind -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">ModBind
</span><a href="#local-6989586621684520577"><span class="hs-identifier hs-var">mbind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>    </span><span class="annot"><span class="annottext">Defs -&gt; Defs -&gt; Defs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Defs] -&gt; Defs
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModParam -&gt; Defs) -&gt; [ModParam] -&gt; [Defs]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ModParam -&gt; Defs
</span><a href="Language.Futhark.Query.html#modParamDefs"><span class="hs-identifier hs-var">modParamDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModBind -&gt; [ModParam]
forall (f :: * -&gt; *) vn. ModBindBase f vn -&gt; [ModParamBase f vn]
</span><a href="Language.Futhark.Syntax.html#modParams"><span class="hs-identifier hs-var hs-var">modParams</span></a></span><span> </span><span class="annot"><span class="annottext">ModBind
</span><a href="#local-6989586621684520577"><span class="hs-identifier hs-var">mbind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>    </span><span class="annot"><span class="annottext">Defs -&gt; Defs -&gt; Defs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ModExp -&gt; Defs
</span><a href="Language.Futhark.Query.html#modExpDefs"><span class="hs-identifier hs-var">modExpDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModBind -&gt; ModExp
forall (f :: * -&gt; *) vn. ModBindBase f vn -&gt; ModExpBase f vn
</span><a href="Language.Futhark.Syntax.html#modExp"><span class="hs-identifier hs-var hs-var">modExp</span></a></span><span> </span><span class="annot"><span class="annottext">ModBind
</span><a href="#local-6989586621684520577"><span class="hs-identifier hs-var">mbind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><span class="annottext">Defs -&gt; Defs -&gt; Defs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ModBind -&gt; Maybe (SigExpBase Info VName, Info (Map VName VName))
forall (f :: * -&gt; *) vn.
ModBindBase f vn -&gt; Maybe (SigExpBase f vn, f (Map VName VName))
</span><a href="Language.Futhark.Syntax.html#modSignature"><span class="hs-identifier hs-var hs-var">modSignature</span></a></span><span> </span><span class="annot"><span class="annottext">ModBind
</span><a href="#local-6989586621684520577"><span class="hs-identifier hs-var">mbind</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-150"></span><span>      </span><span class="annot"><span class="annottext">Maybe (SigExpBase Info VName, Info (Map VName VName))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Defs
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-151"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span id="local-6989586621684520572"><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684520572"><span class="hs-identifier hs-var">substs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-152"></span><span>        </span><span class="annot"><span class="annottext">(VName -&gt; Def) -&gt; Map VName VName -&gt; Defs
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Def
</span><a href="Language.Futhark.Query.html#DefIndirect"><span class="hs-identifier hs-var">DefIndirect</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684520572"><span class="hs-identifier hs-var">substs</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="annot"><a href="Language.Futhark.Query.html#specDefs"><span class="hs-identifier hs-type">specDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#Spec"><span class="hs-identifier hs-type">Spec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#Defs"><span class="hs-identifier hs-type">Defs</span></a></span><span>
</span><span id="line-155"></span><span id="specDefs"><span class="annot"><span class="annottext">specDefs :: Spec -&gt; Defs
</span><a href="Language.Futhark.Query.html#specDefs"><span class="hs-identifier hs-var hs-var">specDefs</span></a></span></span><span> </span><span id="local-6989586621684520570"><span class="annot"><span class="annottext">Spec
</span><a href="#local-6989586621684520570"><span class="hs-identifier hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Spec
</span><a href="#local-6989586621684520570"><span class="hs-identifier hs-var">spec</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#ValSpec"><span class="hs-identifier hs-type">ValSpec</span></a></span><span> </span><span id="local-6989586621684520568"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520568"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621684520567"><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684520567"><span class="hs-identifier hs-var">tparams</span></a></span></span><span> </span><span id="local-6989586621684520566"><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684520566"><span class="hs-identifier hs-var">tdecl</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520565"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520565"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-158"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684520563"><span class="annot"><span class="annottext">vdef :: Def
</span><a href="#local-6989586621684520563"><span class="hs-identifier hs-var hs-var">vdef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BoundTo -&gt; Def
</span><a href="Language.Futhark.Query.html#DefBound"><span class="hs-identifier hs-var">DefBound</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundTo -&gt; Def) -&gt; BoundTo -&gt; Def
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StructType -&gt; Loc -&gt; BoundTo
</span><a href="Language.Futhark.Query.html#BoundTerm"><span class="hs-identifier hs-var">BoundTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Info StructType -&gt; StructType
forall a. Info a -&gt; a
</span><a href="Language.Futhark.Syntax.html#unInfo"><span class="hs-identifier hs-var hs-var">unInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Info StructType -&gt; StructType) -&gt; Info StructType -&gt; StructType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName -&gt; Info StructType
forall (f :: * -&gt; *) vn. TypeDeclBase f vn -&gt; f StructType
</span><a href="Language.Futhark.Syntax.html#expandedType"><span class="hs-identifier hs-var hs-var">expandedType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684520566"><span class="hs-identifier hs-var">tdecl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520565"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Def -&gt; Defs -&gt; Defs
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520568"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Def
</span><a href="#local-6989586621684520563"><span class="hs-identifier hs-var">vdef</span></a></span><span> </span><span class="annot"><span class="annottext">(Defs -&gt; Defs) -&gt; Defs -&gt; Defs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Defs] -&gt; Defs
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeParamBase VName -&gt; Defs) -&gt; [TypeParamBase VName] -&gt; [Defs]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TypeParamBase VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#typeParamDefs"><span class="hs-identifier hs-var">typeParamDefs</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684520567"><span class="hs-identifier hs-var">tparams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeAbbrSpec"><span class="hs-identifier hs-type">TypeAbbrSpec</span></a></span><span> </span><span id="local-6989586621684520560"><span class="annot"><span class="annottext">TypeBind
</span><a href="#local-6989586621684520560"><span class="hs-identifier hs-var">tbind</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeBind -&gt; Defs
</span><a href="Language.Futhark.Query.html#typeBindDefs"><span class="hs-identifier hs-var">typeBindDefs</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBind
</span><a href="#local-6989586621684520560"><span class="hs-identifier hs-var">tbind</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeSpec"><span class="hs-identifier hs-type">TypeSpec</span></a></span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520558"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520558"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520557"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520557"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-162"></span><span>      </span><span class="annot"><span class="annottext">VName -&gt; Def -&gt; Defs
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520558"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(Def -&gt; Defs) -&gt; Def -&gt; Defs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BoundTo -&gt; Def
</span><a href="Language.Futhark.Query.html#DefBound"><span class="hs-identifier hs-var">DefBound</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundTo -&gt; Def) -&gt; BoundTo -&gt; Def
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Loc -&gt; BoundTo
</span><a href="Language.Futhark.Query.html#BoundType"><span class="hs-identifier hs-var">BoundType</span></a></span><span> </span><span class="annot"><span class="annottext">(Loc -&gt; BoundTo) -&gt; Loc -&gt; BoundTo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520557"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#ModSpec"><span class="hs-identifier hs-type">ModSpec</span></a></span><span> </span><span id="local-6989586621684520555"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520555"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621684520554"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520554"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520553"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520553"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-164"></span><span>      </span><span class="annot"><span class="annottext">VName -&gt; Def -&gt; Defs
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520555"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BoundTo -&gt; Def
</span><a href="Language.Futhark.Query.html#DefBound"><span class="hs-identifier hs-var">DefBound</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundTo -&gt; Def) -&gt; BoundTo -&gt; Def
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Loc -&gt; BoundTo
</span><a href="Language.Futhark.Query.html#BoundModuleType"><span class="hs-identifier hs-var">BoundModuleType</span></a></span><span> </span><span class="annot"><span class="annottext">(Loc -&gt; BoundTo) -&gt; Loc -&gt; BoundTo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520553"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>        </span><span class="annot"><span class="annottext">Defs -&gt; Defs -&gt; Defs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#sigExpDefs"><span class="hs-identifier hs-var">sigExpDefs</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520554"><span class="hs-identifier hs-var">se</span></a></span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#IncludeSpec"><span class="hs-identifier hs-type">IncludeSpec</span></a></span><span> </span><span id="local-6989586621684520551"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520551"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#sigExpDefs"><span class="hs-identifier hs-var">sigExpDefs</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520551"><span class="hs-identifier hs-var">se</span></a></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="annot"><a href="Language.Futhark.Query.html#sigExpDefs"><span class="hs-identifier hs-type">sigExpDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#SigExp"><span class="hs-identifier hs-type">SigExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#Defs"><span class="hs-identifier hs-type">Defs</span></a></span><span>
</span><span id="line-169"></span><span id="sigExpDefs"><span class="annot"><span class="annottext">sigExpDefs :: SigExpBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#sigExpDefs"><span class="hs-identifier hs-var hs-var">sigExpDefs</span></a></span></span><span> </span><span id="local-6989586621684520549"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520549"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520549"><span class="hs-identifier hs-var">se</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#SigVar"><span class="hs-identifier hs-type">SigVar</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span id="local-6989586621684520547"><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684520547"><span class="hs-identifier hs-var">substs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Def) -&gt; Map VName VName -&gt; Defs
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Def
</span><a href="Language.Futhark.Query.html#DefIndirect"><span class="hs-identifier hs-var">DefIndirect</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684520547"><span class="hs-identifier hs-var">substs</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#SigParens"><span class="hs-identifier hs-type">SigParens</span></a></span><span> </span><span id="local-6989586621684520545"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520545"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#sigExpDefs"><span class="hs-identifier hs-var">sigExpDefs</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520545"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-173"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#SigSpecs"><span class="hs-identifier hs-type">SigSpecs</span></a></span><span> </span><span id="local-6989586621684520543"><span class="annot"><span class="annottext">[Spec]
</span><a href="#local-6989586621684520543"><span class="hs-identifier hs-var">specs</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Defs] -&gt; Defs
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Defs] -&gt; Defs) -&gt; [Defs] -&gt; Defs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Spec -&gt; Defs) -&gt; [Spec] -&gt; [Defs]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Spec -&gt; Defs
</span><a href="Language.Futhark.Query.html#specDefs"><span class="hs-identifier hs-var">specDefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Spec]
</span><a href="#local-6989586621684520543"><span class="hs-identifier hs-var">specs</span></a></span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#SigWith"><span class="hs-identifier hs-type">SigWith</span></a></span><span> </span><span id="local-6989586621684520541"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520541"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">TypeRefBase Info VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#sigExpDefs"><span class="hs-identifier hs-var">sigExpDefs</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520541"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#SigArrow"><span class="hs-identifier hs-type">SigArrow</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe VName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520539"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520539"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621684520538"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520538"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#sigExpDefs"><span class="hs-identifier hs-var">sigExpDefs</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520539"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">Defs -&gt; Defs -&gt; Defs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#sigExpDefs"><span class="hs-identifier hs-var">sigExpDefs</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520538"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="annot"><a href="Language.Futhark.Query.html#sigBindDefs"><span class="hs-identifier hs-type">sigBindDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#SigBind"><span class="hs-identifier hs-type">SigBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#Defs"><span class="hs-identifier hs-type">Defs</span></a></span><span>
</span><span id="line-178"></span><span id="sigBindDefs"><span class="annot"><span class="annottext">sigBindDefs :: SigBind -&gt; Defs
</span><a href="Language.Futhark.Query.html#sigBindDefs"><span class="hs-identifier hs-var hs-var">sigBindDefs</span></a></span></span><span> </span><span id="local-6989586621684520536"><span class="annot"><span class="annottext">SigBind
</span><a href="#local-6989586621684520536"><span class="hs-identifier hs-var">sbind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-179"></span><span>  </span><span class="annot"><span class="annottext">VName -&gt; Def -&gt; Defs
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SigBind -&gt; VName
forall (f :: * -&gt; *) vn. SigBindBase f vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#sigName"><span class="hs-identifier hs-var hs-var">sigName</span></a></span><span> </span><span class="annot"><span class="annottext">SigBind
</span><a href="#local-6989586621684520536"><span class="hs-identifier hs-var">sbind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BoundTo -&gt; Def
</span><a href="Language.Futhark.Query.html#DefBound"><span class="hs-identifier hs-var">DefBound</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundTo -&gt; Def) -&gt; BoundTo -&gt; Def
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Loc -&gt; BoundTo
</span><a href="Language.Futhark.Query.html#BoundModuleType"><span class="hs-identifier hs-var">BoundModuleType</span></a></span><span> </span><span class="annot"><span class="annottext">(Loc -&gt; BoundTo) -&gt; Loc -&gt; BoundTo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SigBind -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">SigBind
</span><a href="#local-6989586621684520536"><span class="hs-identifier hs-var">sbind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><span class="annottext">Defs -&gt; Defs -&gt; Defs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName -&gt; Defs
</span><a href="Language.Futhark.Query.html#sigExpDefs"><span class="hs-identifier hs-var">sigExpDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SigBind -&gt; SigExpBase Info VName
forall (f :: * -&gt; *) vn. SigBindBase f vn -&gt; SigExpBase f vn
</span><a href="Language.Futhark.Syntax.html#sigExp"><span class="hs-identifier hs-var hs-var">sigExp</span></a></span><span> </span><span class="annot"><span class="annottext">SigBind
</span><a href="#local-6989586621684520536"><span class="hs-identifier hs-var">sbind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="annot"><a href="Language.Futhark.Query.html#decDefs"><span class="hs-identifier hs-type">decDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#Dec"><span class="hs-identifier hs-type">Dec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#Defs"><span class="hs-identifier hs-type">Defs</span></a></span><span>
</span><span id="line-183"></span><span id="decDefs"><span class="annot"><span class="annottext">decDefs :: Dec -&gt; Defs
</span><a href="Language.Futhark.Query.html#decDefs"><span class="hs-identifier hs-var hs-var">decDefs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ValDec"><span class="hs-identifier hs-type">ValDec</span></a></span><span> </span><span id="local-6989586621684520532"><span class="annot"><span class="annottext">ValBind
</span><a href="#local-6989586621684520532"><span class="hs-identifier hs-var">vbind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ValBind -&gt; Defs
</span><a href="Language.Futhark.Query.html#valBindDefs"><span class="hs-identifier hs-var">valBindDefs</span></a></span><span> </span><span class="annot"><span class="annottext">ValBind
</span><a href="#local-6989586621684520532"><span class="hs-identifier hs-var">vbind</span></a></span><span>
</span><span id="line-184"></span><span class="annot"><a href="Language.Futhark.Query.html#decDefs"><span class="hs-identifier hs-var">decDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeDec"><span class="hs-identifier hs-type">TypeDec</span></a></span><span> </span><span id="local-6989586621684520530"><span class="annot"><span class="annottext">TypeBind
</span><a href="#local-6989586621684520530"><span class="hs-identifier hs-var">vbind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBind -&gt; Defs
</span><a href="Language.Futhark.Query.html#typeBindDefs"><span class="hs-identifier hs-var">typeBindDefs</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBind
</span><a href="#local-6989586621684520530"><span class="hs-identifier hs-var">vbind</span></a></span><span>
</span><span id="line-185"></span><span class="annot"><a href="Language.Futhark.Query.html#decDefs"><span class="hs-identifier hs-var">decDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModDec"><span class="hs-identifier hs-type">ModDec</span></a></span><span> </span><span id="local-6989586621684520528"><span class="annot"><span class="annottext">ModBind
</span><a href="#local-6989586621684520528"><span class="hs-identifier hs-var">mbind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModBind -&gt; Defs
</span><a href="Language.Futhark.Query.html#modBindDefs"><span class="hs-identifier hs-var">modBindDefs</span></a></span><span> </span><span class="annot"><span class="annottext">ModBind
</span><a href="#local-6989586621684520528"><span class="hs-identifier hs-var">mbind</span></a></span><span>
</span><span id="line-186"></span><span class="annot"><a href="Language.Futhark.Query.html#decDefs"><span class="hs-identifier hs-var">decDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#SigDec"><span class="hs-identifier hs-type">SigDec</span></a></span><span> </span><span id="local-6989586621684520526"><span class="annot"><span class="annottext">SigBind
</span><a href="#local-6989586621684520526"><span class="hs-identifier hs-var">mbind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SigBind -&gt; Defs
</span><a href="Language.Futhark.Query.html#sigBindDefs"><span class="hs-identifier hs-var">sigBindDefs</span></a></span><span> </span><span class="annot"><span class="annottext">SigBind
</span><a href="#local-6989586621684520526"><span class="hs-identifier hs-var">mbind</span></a></span><span>
</span><span id="line-187"></span><span class="annot"><a href="Language.Futhark.Query.html#decDefs"><span class="hs-identifier hs-var">decDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#OpenDec"><span class="hs-identifier hs-type">OpenDec</span></a></span><span> </span><span id="local-6989586621684520524"><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520524"><span class="hs-identifier hs-var">me</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModExp -&gt; Defs
</span><a href="Language.Futhark.Query.html#modExpDefs"><span class="hs-identifier hs-var">modExpDefs</span></a></span><span> </span><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520524"><span class="hs-identifier hs-var">me</span></a></span><span>
</span><span id="line-188"></span><span class="annot"><a href="Language.Futhark.Query.html#decDefs"><span class="hs-identifier hs-var">decDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#LocalDec"><span class="hs-identifier hs-type">LocalDec</span></a></span><span> </span><span id="local-6989586621684520522"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621684520522"><span class="hs-identifier hs-var">dec</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dec -&gt; Defs
</span><a href="Language.Futhark.Query.html#decDefs"><span class="hs-identifier hs-var">decDefs</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621684520522"><span class="hs-identifier hs-var">dec</span></a></span><span>
</span><span id="line-189"></span><span class="annot"><a href="Language.Futhark.Query.html#decDefs"><span class="hs-identifier hs-var">decDefs</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#ImportDec"><span class="hs-identifier hs-type">ImportDec</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defs
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-comment">-- | All bindings of everything in the program.</span><span>
</span><span id="line-192"></span><span class="annot"><a href="Language.Futhark.Query.html#progDefs"><span class="hs-identifier hs-type">progDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#Defs"><span class="hs-identifier hs-type">Defs</span></a></span><span>
</span><span id="line-193"></span><span id="progDefs"><span class="annot"><span class="annottext">progDefs :: Prog -&gt; Defs
</span><a href="Language.Futhark.Query.html#progDefs"><span class="hs-identifier hs-var hs-var">progDefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Defs] -&gt; Defs
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Defs] -&gt; Defs) -&gt; (Prog -&gt; [Defs]) -&gt; Prog -&gt; Defs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Dec -&gt; Defs) -&gt; [Dec] -&gt; [Defs]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dec -&gt; Defs
</span><a href="Language.Futhark.Query.html#decDefs"><span class="hs-identifier hs-var">decDefs</span></a></span><span> </span><span class="annot"><span class="annottext">([Dec] -&gt; [Defs]) -&gt; (Prog -&gt; [Dec]) -&gt; Prog -&gt; [Defs]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Prog -&gt; [Dec]
forall (f :: * -&gt; *) vn. ProgBase f vn -&gt; [DecBase f vn]
</span><a href="Language.Futhark.Syntax.html#progDecs"><span class="hs-identifier hs-var hs-var">progDecs</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="annot"><a href="Language.Futhark.Query.html#allBindings"><span class="hs-identifier hs-type">allBindings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#Imports"><span class="hs-identifier hs-type">Imports</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#BoundTo"><span class="hs-identifier hs-type">BoundTo</span></a></span><span>
</span><span id="line-196"></span><span id="allBindings"><span class="annot"><span class="annottext">allBindings :: Imports -&gt; Map VName BoundTo
</span><a href="Language.Futhark.Query.html#allBindings"><span class="hs-identifier hs-var hs-var">allBindings</span></a></span></span><span> </span><span id="local-6989586621684520517"><span class="annot"><span class="annottext">Imports
</span><a href="#local-6989586621684520517"><span class="hs-identifier hs-var">imports</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Def -&gt; Maybe BoundTo) -&gt; Defs -&gt; Map VName BoundTo
forall a b k. (a -&gt; Maybe b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">Def -&gt; Maybe BoundTo
</span><a href="#local-6989586621684520515"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621684520514"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-198"></span><span>    </span><span id="local-6989586621684520514"><span class="annot"><span class="annottext">defs :: Defs
</span><a href="#local-6989586621684520514"><span class="hs-identifier hs-var hs-var">defs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Defs] -&gt; Defs
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Defs] -&gt; Defs) -&gt; [Defs] -&gt; Defs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((String, FileModule) -&gt; Defs) -&gt; Imports -&gt; [Defs]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Prog -&gt; Defs
</span><a href="Language.Futhark.Query.html#progDefs"><span class="hs-identifier hs-var">progDefs</span></a></span><span> </span><span class="annot"><span class="annottext">(Prog -&gt; Defs)
-&gt; ((String, FileModule) -&gt; Prog) -&gt; (String, FileModule) -&gt; Defs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FileModule -&gt; Prog
</span><a href="Language.Futhark.Semantic.html#fileProg"><span class="hs-identifier hs-var hs-var">fileProg</span></a></span><span> </span><span class="annot"><span class="annottext">(FileModule -&gt; Prog)
-&gt; ((String, FileModule) -&gt; FileModule)
-&gt; (String, FileModule)
-&gt; Prog
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(String, FileModule) -&gt; FileModule
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Imports
</span><a href="#local-6989586621684520517"><span class="hs-identifier hs-var">imports</span></a></span><span>
</span><span id="line-199"></span><span>    </span><span id="local-6989586621684520515"><span class="annot"><span class="annottext">forward :: Def -&gt; Maybe BoundTo
</span><a href="#local-6989586621684520515"><span class="hs-identifier hs-var hs-var">forward</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Query.html#DefBound"><span class="hs-identifier hs-type">DefBound</span></a></span><span> </span><span id="local-6989586621684520508"><span class="annot"><span class="annottext">BoundTo
</span><a href="#local-6989586621684520508"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BoundTo -&gt; Maybe BoundTo
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">BoundTo
</span><a href="#local-6989586621684520508"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-200"></span><span>    </span><span class="annot"><a href="#local-6989586621684520515"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Query.html#DefIndirect"><span class="hs-identifier hs-type">DefIndirect</span></a></span><span> </span><span id="local-6989586621684520507"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520507"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Def -&gt; Maybe BoundTo
</span><a href="#local-6989586621684520515"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">(Def -&gt; Maybe BoundTo) -&gt; Maybe Def -&gt; Maybe BoundTo
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Defs -&gt; Maybe Def
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520507"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Defs
</span><a href="#local-6989586621684520514"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="hs-keyword">data</span><span> </span><span id="RawAtPos"><span class="annot"><a href="Language.Futhark.Query.html#RawAtPos"><span class="hs-identifier hs-var">RawAtPos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RawAtName"><span class="annot"><a href="Language.Futhark.Query.html#RawAtName"><span class="hs-identifier hs-var">RawAtName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#QualName"><span class="hs-identifier hs-type">QualName</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Loc</span></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span id="local-6989586621684521004"><span class="annot"><a href="Language.Futhark.Query.html#contains"><span class="hs-identifier hs-type">contains</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Located</span></span><span> </span><span class="annot"><a href="#local-6989586621684521004"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621684521004"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pos</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-205"></span><span id="contains"><span class="annot"><span class="annottext">contains :: forall a. Located a =&gt; a -&gt; Pos -&gt; Bool
</span><a href="Language.Futhark.Query.html#contains"><span class="hs-identifier hs-var hs-var">contains</span></a></span></span><span> </span><span id="local-6989586621684520497"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684520497"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621684520496"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520496"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">a -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684520497"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Loc</span></span><span> </span><span id="local-6989586621684520494"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520494"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621684520493"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520493"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520496"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Pos -&gt; Pos -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520494"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520496"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Pos -&gt; Pos -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520493"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><span class="annottext">Loc
</span><span class="hs-identifier hs-var">NoLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInTypeExp"><span class="hs-identifier hs-type">atPosInTypeExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeExp"><span class="hs-identifier hs-type">TypeExp</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pos</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#RawAtPos"><span class="hs-identifier hs-type">RawAtPos</span></a></span><span>
</span><span id="line-211"></span><span id="atPosInTypeExp"><span class="annot"><span class="annottext">atPosInTypeExp :: TypeExp VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInTypeExp"><span class="hs-identifier hs-var hs-var">atPosInTypeExp</span></a></span></span><span> </span><span id="local-6989586621684520488"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684520488"><span class="hs-identifier hs-var">te</span></a></span></span><span> </span><span id="local-6989586621684520487"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520487"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684520488"><span class="hs-identifier hs-var">te</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-213"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#TEVar"><span class="hs-identifier hs-type">TEVar</span></a></span><span> </span><span id="local-6989586621684520485"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684520485"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span id="local-6989586621684520484"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520484"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-214"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520484"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Pos -&gt; Bool
forall a. Located a =&gt; a -&gt; Pos -&gt; Bool
</span><a href="Language.Futhark.Query.html#contains"><span class="hs-operator hs-var">`contains`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520487"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-215"></span><span>      </span><span class="annot"><span class="annottext">RawAtPos -&gt; Maybe RawAtPos
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(RawAtPos -&gt; Maybe RawAtPos) -&gt; RawAtPos -&gt; Maybe RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; Loc -&gt; RawAtPos
</span><a href="Language.Futhark.Query.html#RawAtName"><span class="hs-identifier hs-var">RawAtName</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684520485"><span class="hs-identifier hs-var">qn</span></a></span><span> </span><span class="annot"><span class="annottext">(Loc -&gt; RawAtPos) -&gt; Loc -&gt; RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520484"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-216"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#TETuple"><span class="hs-identifier hs-type">TETuple</span></a></span><span> </span><span id="local-6989586621684520482"><span class="annot"><span class="annottext">[TypeExp VName]
</span><a href="#local-6989586621684520482"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-217"></span><span>      </span><span class="annot"><span class="annottext">[Maybe RawAtPos] -&gt; Maybe RawAtPos
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, MonadPlus m) =&gt;
t (m a) -&gt; m a
</span><span class="hs-identifier hs-var">msum</span></span><span> </span><span class="annot"><span class="annottext">([Maybe RawAtPos] -&gt; Maybe RawAtPos)
-&gt; [Maybe RawAtPos] -&gt; Maybe RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TypeExp VName -&gt; Maybe RawAtPos)
-&gt; [TypeExp VName] -&gt; [Maybe RawAtPos]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeExp VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInTypeExp"><span class="hs-operator hs-var">`atPosInTypeExp`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520487"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TypeExp VName]
</span><a href="#local-6989586621684520482"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-218"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#TERecord"><span class="hs-identifier hs-type">TERecord</span></a></span><span> </span><span id="local-6989586621684520479"><span class="annot"><span class="annottext">[(Name, TypeExp VName)]
</span><a href="#local-6989586621684520479"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-219"></span><span>      </span><span class="annot"><span class="annottext">[Maybe RawAtPos] -&gt; Maybe RawAtPos
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, MonadPlus m) =&gt;
t (m a) -&gt; m a
</span><span class="hs-identifier hs-var">msum</span></span><span> </span><span class="annot"><span class="annottext">([Maybe RawAtPos] -&gt; Maybe RawAtPos)
-&gt; [Maybe RawAtPos] -&gt; Maybe RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Name, TypeExp VName) -&gt; Maybe RawAtPos)
-&gt; [(Name, TypeExp VName)] -&gt; [Maybe RawAtPos]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeExp VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInTypeExp"><span class="hs-operator hs-var">`atPosInTypeExp`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520487"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TypeExp VName -&gt; Maybe RawAtPos)
-&gt; ((Name, TypeExp VName) -&gt; TypeExp VName)
-&gt; (Name, TypeExp VName)
-&gt; Maybe RawAtPos
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name, TypeExp VName) -&gt; TypeExp VName
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, TypeExp VName)]
</span><a href="#local-6989586621684520479"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-220"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#TEArray"><span class="hs-identifier hs-type">TEArray</span></a></span><span> </span><span id="local-6989586621684520477"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684520477"><span class="hs-identifier hs-var">te'</span></a></span></span><span> </span><span id="local-6989586621684520476"><span class="annot"><span class="annottext">DimExp VName
</span><a href="#local-6989586621684520476"><span class="hs-identifier hs-var">dim</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-221"></span><span>      </span><span class="annot"><span class="annottext">TypeExp VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInTypeExp"><span class="hs-identifier hs-var">atPosInTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684520477"><span class="hs-identifier hs-var">te'</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520487"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RawAtPos -&gt; Maybe RawAtPos -&gt; Maybe RawAtPos
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a -&gt; m a -&gt; m a
</span><span class="hs-operator hs-var">`mplus`</span></span><span> </span><span class="annot"><span class="annottext">DimExp VName -&gt; Maybe RawAtPos
</span><a href="#local-6989586621684520474"><span class="hs-identifier hs-var">inDim</span></a></span><span> </span><span class="annot"><span class="annottext">DimExp VName
</span><a href="#local-6989586621684520476"><span class="hs-identifier hs-var">dim</span></a></span><span>
</span><span id="line-222"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#TEUnique"><span class="hs-identifier hs-type">TEUnique</span></a></span><span> </span><span id="local-6989586621684520472"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684520472"><span class="hs-identifier hs-var">te'</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-223"></span><span>      </span><span class="annot"><span class="annottext">TypeExp VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInTypeExp"><span class="hs-identifier hs-var">atPosInTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684520472"><span class="hs-identifier hs-var">te'</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520487"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-224"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#TEApply"><span class="hs-identifier hs-type">TEApply</span></a></span><span> </span><span id="local-6989586621684520470"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684520470"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621684520469"><span class="annot"><span class="annottext">TypeArgExp VName
</span><a href="#local-6989586621684520469"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-225"></span><span>      </span><span class="annot"><span class="annottext">TypeExp VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInTypeExp"><span class="hs-identifier hs-var">atPosInTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684520470"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520487"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RawAtPos -&gt; Maybe RawAtPos -&gt; Maybe RawAtPos
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a -&gt; m a -&gt; m a
</span><span class="hs-operator hs-var">`mplus`</span></span><span> </span><span class="annot"><span class="annottext">TypeArgExp VName -&gt; Maybe RawAtPos
</span><a href="#local-6989586621684520468"><span class="hs-identifier hs-var">inArg</span></a></span><span> </span><span class="annot"><span class="annottext">TypeArgExp VName
</span><a href="#local-6989586621684520469"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-226"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#TEArrow"><span class="hs-identifier hs-type">TEArrow</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe VName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520466"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684520466"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621684520465"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684520465"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-227"></span><span>      </span><span class="annot"><span class="annottext">TypeExp VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInTypeExp"><span class="hs-identifier hs-var">atPosInTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684520466"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520487"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RawAtPos -&gt; Maybe RawAtPos -&gt; Maybe RawAtPos
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a -&gt; m a -&gt; m a
</span><span class="hs-operator hs-var">`mplus`</span></span><span> </span><span class="annot"><span class="annottext">TypeExp VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInTypeExp"><span class="hs-identifier hs-var">atPosInTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684520465"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520487"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-228"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#TESum"><span class="hs-identifier hs-type">TESum</span></a></span><span> </span><span id="local-6989586621684520463"><span class="annot"><span class="annottext">[(Name, [TypeExp VName])]
</span><a href="#local-6989586621684520463"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-229"></span><span>      </span><span class="annot"><span class="annottext">[Maybe RawAtPos] -&gt; Maybe RawAtPos
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, MonadPlus m) =&gt;
t (m a) -&gt; m a
</span><span class="hs-identifier hs-var">msum</span></span><span> </span><span class="annot"><span class="annottext">([Maybe RawAtPos] -&gt; Maybe RawAtPos)
-&gt; [Maybe RawAtPos] -&gt; Maybe RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TypeExp VName -&gt; Maybe RawAtPos)
-&gt; [TypeExp VName] -&gt; [Maybe RawAtPos]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeExp VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInTypeExp"><span class="hs-operator hs-var">`atPosInTypeExp`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520487"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TypeExp VName] -&gt; [Maybe RawAtPos])
-&gt; [TypeExp VName] -&gt; [Maybe RawAtPos]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Name, [TypeExp VName]) -&gt; [TypeExp VName])
-&gt; [(Name, [TypeExp VName])] -&gt; [TypeExp VName]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(Name, [TypeExp VName]) -&gt; [TypeExp VName]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Name, [TypeExp VName])]
</span><a href="#local-6989586621684520463"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#TEDim"><span class="hs-identifier hs-type">TEDim</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520460"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684520460"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-231"></span><span>      </span><span class="annot"><span class="annottext">TypeExp VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInTypeExp"><span class="hs-identifier hs-var">atPosInTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684520460"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520487"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-233"></span><span>    </span><span id="local-6989586621684520468"><span class="annot"><span class="annottext">inArg :: TypeArgExp VName -&gt; Maybe RawAtPos
</span><a href="#local-6989586621684520468"><span class="hs-identifier hs-var hs-var">inArg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeArgExpDim"><span class="hs-identifier hs-type">TypeArgExpDim</span></a></span><span> </span><span id="local-6989586621684520458"><span class="annot"><span class="annottext">DimExp VName
</span><a href="#local-6989586621684520458"><span class="hs-identifier hs-var">dim</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DimExp VName -&gt; Maybe RawAtPos
</span><a href="#local-6989586621684520474"><span class="hs-identifier hs-var">inDim</span></a></span><span> </span><span class="annot"><span class="annottext">DimExp VName
</span><a href="#local-6989586621684520458"><span class="hs-identifier hs-var">dim</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><a href="#local-6989586621684520468"><span class="hs-identifier hs-var">inArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeArgExpType"><span class="hs-identifier hs-type">TypeArgExpType</span></a></span><span> </span><span id="local-6989586621684520456"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684520456"><span class="hs-identifier hs-var">e2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeExp VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInTypeExp"><span class="hs-identifier hs-var">atPosInTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684520456"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520487"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-235"></span><span>    </span><span id="local-6989586621684520474"><span class="annot"><span class="annottext">inDim :: DimExp VName -&gt; Maybe RawAtPos
</span><a href="#local-6989586621684520474"><span class="hs-identifier hs-var hs-var">inDim</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#DimExpNamed"><span class="hs-identifier hs-type">DimExpNamed</span></a></span><span> </span><span id="local-6989586621684520450"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684520450"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span id="local-6989586621684520449"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520449"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-236"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520449"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Pos -&gt; Bool
forall a. Located a =&gt; a -&gt; Pos -&gt; Bool
</span><a href="Language.Futhark.Query.html#contains"><span class="hs-operator hs-var">`contains`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520487"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-237"></span><span>      </span><span class="annot"><span class="annottext">RawAtPos -&gt; Maybe RawAtPos
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(RawAtPos -&gt; Maybe RawAtPos) -&gt; RawAtPos -&gt; Maybe RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; Loc -&gt; RawAtPos
</span><a href="Language.Futhark.Query.html#RawAtName"><span class="hs-identifier hs-var">RawAtName</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684520450"><span class="hs-identifier hs-var">qn</span></a></span><span> </span><span class="annot"><span class="annottext">(Loc -&gt; RawAtPos) -&gt; Loc -&gt; RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520449"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><a href="#local-6989586621684520474"><span class="hs-identifier hs-var">inDim</span></a></span><span> </span><span class="annot"><span class="annottext">DimExp VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe RawAtPos
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInPat"><span class="hs-identifier hs-type">atPosInPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pos</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#RawAtPos"><span class="hs-identifier hs-type">RawAtPos</span></a></span><span>
</span><span id="line-241"></span><span id="atPosInPat"><span class="annot"><span class="annottext">atPosInPat :: PatBase Info VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInPat"><span class="hs-identifier hs-var hs-var">atPosInPat</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span id="local-6989586621684520447"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520447"><span class="hs-identifier hs-var">vn</span></a></span></span><span> </span><span class="annot"><span class="annottext">Info PatType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520446"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520446"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520445"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520445"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-242"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520446"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Pos -&gt; Bool
forall a. Located a =&gt; a -&gt; Pos -&gt; Bool
</span><a href="Language.Futhark.Query.html#contains"><span class="hs-operator hs-var">`contains`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520445"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-243"></span><span>  </span><span class="annot"><span class="annottext">RawAtPos -&gt; Maybe RawAtPos
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(RawAtPos -&gt; Maybe RawAtPos) -&gt; RawAtPos -&gt; Maybe RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; Loc -&gt; RawAtPos
</span><a href="Language.Futhark.Query.html#RawAtName"><span class="hs-identifier hs-var">RawAtName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684520447"><span class="hs-identifier hs-var">vn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Loc -&gt; RawAtPos) -&gt; Loc -&gt; RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520446"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-244"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInPat"><span class="hs-identifier hs-var">atPosInPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TuplePat"><span class="hs-identifier hs-type">TuplePat</span></a></span><span> </span><span id="local-6989586621684520443"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684520443"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520442"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520442"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-245"></span><span>  </span><span class="annot"><span class="annottext">[Maybe RawAtPos] -&gt; Maybe RawAtPos
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, MonadPlus m) =&gt;
t (m a) -&gt; m a
</span><span class="hs-identifier hs-var">msum</span></span><span> </span><span class="annot"><span class="annottext">([Maybe RawAtPos] -&gt; Maybe RawAtPos)
-&gt; [Maybe RawAtPos] -&gt; Maybe RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; Maybe RawAtPos)
-&gt; [PatBase Info VName] -&gt; [Maybe RawAtPos]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInPat"><span class="hs-operator hs-var">`atPosInPat`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520442"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684520443"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-246"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInPat"><span class="hs-identifier hs-var">atPosInPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RecordPat"><span class="hs-identifier hs-type">RecordPat</span></a></span><span> </span><span id="local-6989586621684520441"><span class="annot"><span class="annottext">[(Name, PatBase Info VName)]
</span><a href="#local-6989586621684520441"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520440"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520440"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-247"></span><span>  </span><span class="annot"><span class="annottext">[Maybe RawAtPos] -&gt; Maybe RawAtPos
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, MonadPlus m) =&gt;
t (m a) -&gt; m a
</span><span class="hs-identifier hs-var">msum</span></span><span> </span><span class="annot"><span class="annottext">([Maybe RawAtPos] -&gt; Maybe RawAtPos)
-&gt; [Maybe RawAtPos] -&gt; Maybe RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Name, PatBase Info VName) -&gt; Maybe RawAtPos)
-&gt; [(Name, PatBase Info VName)] -&gt; [Maybe RawAtPos]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInPat"><span class="hs-operator hs-var">`atPosInPat`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520440"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; Maybe RawAtPos)
-&gt; ((Name, PatBase Info VName) -&gt; PatBase Info VName)
-&gt; (Name, PatBase Info VName)
-&gt; Maybe RawAtPos
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name, PatBase Info VName) -&gt; PatBase Info VName
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, PatBase Info VName)]
</span><a href="#local-6989586621684520441"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-248"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInPat"><span class="hs-identifier hs-var">atPosInPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatParens"><span class="hs-identifier hs-type">PatParens</span></a></span><span> </span><span id="local-6989586621684520439"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520439"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520438"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520438"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-249"></span><span>  </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInPat"><span class="hs-identifier hs-var">atPosInPat</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520439"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520438"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-250"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInPat"><span class="hs-identifier hs-var">atPosInPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatAttr"><span class="hs-identifier hs-type">PatAttr</span></a></span><span> </span><span class="annot"><span class="annottext">AttrInfo VName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520437"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520437"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520436"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520436"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-251"></span><span>  </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInPat"><span class="hs-identifier hs-var">atPosInPat</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520437"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520436"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-252"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInPat"><span class="hs-identifier hs-var">atPosInPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatAscription"><span class="hs-identifier hs-type">PatAscription</span></a></span><span> </span><span id="local-6989586621684520435"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520435"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684520434"><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684520434"><span class="hs-identifier hs-var">tdecl</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520433"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520433"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-253"></span><span>  </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInPat"><span class="hs-identifier hs-var">atPosInPat</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520435"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520433"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RawAtPos -&gt; Maybe RawAtPos -&gt; Maybe RawAtPos
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a -&gt; m a -&gt; m a
</span><span class="hs-operator hs-var">`mplus`</span></span><span> </span><span class="annot"><span class="annottext">TypeExp VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInTypeExp"><span class="hs-identifier hs-var">atPosInTypeExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeDeclBase Info VName -&gt; TypeExp VName
forall (f :: * -&gt; *) vn. TypeDeclBase f vn -&gt; TypeExp vn
</span><a href="Language.Futhark.Syntax.html#declaredType"><span class="hs-identifier hs-var hs-var">declaredType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684520434"><span class="hs-identifier hs-var">tdecl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520433"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-254"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInPat"><span class="hs-identifier hs-var">atPosInPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatConstr"><span class="hs-identifier hs-type">PatConstr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Info PatType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520431"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684520431"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520430"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520430"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-255"></span><span>  </span><span class="annot"><span class="annottext">[Maybe RawAtPos] -&gt; Maybe RawAtPos
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, MonadPlus m) =&gt;
t (m a) -&gt; m a
</span><span class="hs-identifier hs-var">msum</span></span><span> </span><span class="annot"><span class="annottext">([Maybe RawAtPos] -&gt; Maybe RawAtPos)
-&gt; [Maybe RawAtPos] -&gt; Maybe RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; Maybe RawAtPos)
-&gt; [PatBase Info VName] -&gt; [Maybe RawAtPos]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInPat"><span class="hs-operator hs-var">`atPosInPat`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520430"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684520431"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-256"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInPat"><span class="hs-identifier hs-var">atPosInPat</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatLit"><span class="hs-identifier hs-type">PatLit</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">Pos
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe RawAtPos
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-257"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInPat"><span class="hs-identifier hs-var">atPosInPat</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Wildcard"><span class="hs-identifier hs-type">Wildcard</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">Pos
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe RawAtPos
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInExp"><span class="hs-identifier hs-type">atPosInExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pos</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#RawAtPos"><span class="hs-identifier hs-type">RawAtPos</span></a></span><span>
</span><span id="line-260"></span><span id="atPosInExp"><span class="annot"><span class="annottext">atPosInExp :: Exp -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInExp"><span class="hs-identifier hs-var hs-var">atPosInExp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684520427"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684520427"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span class="annot"><span class="annottext">Info PatType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520426"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520426"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520425"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520425"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-261"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520426"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Pos -&gt; Bool
forall a. Located a =&gt; a -&gt; Pos -&gt; Bool
</span><a href="Language.Futhark.Query.html#contains"><span class="hs-operator hs-var">`contains`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520425"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-262"></span><span>  </span><span class="annot"><span class="annottext">RawAtPos -&gt; Maybe RawAtPos
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(RawAtPos -&gt; Maybe RawAtPos) -&gt; RawAtPos -&gt; Maybe RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; Loc -&gt; RawAtPos
</span><a href="Language.Futhark.Query.html#RawAtName"><span class="hs-identifier hs-var">RawAtName</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684520427"><span class="hs-identifier hs-var">qn</span></a></span><span> </span><span class="annot"><span class="annottext">(Loc -&gt; RawAtPos) -&gt; Loc -&gt; RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520426"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-263"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInExp"><span class="hs-identifier hs-var">atPosInExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#QualParens"><span class="hs-identifier hs-type">QualParens</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684520423"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684520423"><span class="hs-identifier hs-var">qn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684520422"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520422"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520421"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520421"><span class="hs-identifier hs-var">pos</span></a></span></span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520422"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Pos -&gt; Bool
forall a. Located a =&gt; a -&gt; Pos -&gt; Bool
</span><a href="Language.Futhark.Query.html#contains"><span class="hs-operator hs-var">`contains`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520421"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RawAtPos -&gt; Maybe RawAtPos
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(RawAtPos -&gt; Maybe RawAtPos) -&gt; RawAtPos -&gt; Maybe RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; Loc -&gt; RawAtPos
</span><a href="Language.Futhark.Query.html#RawAtName"><span class="hs-identifier hs-var">RawAtName</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684520423"><span class="hs-identifier hs-var">qn</span></a></span><span> </span><span class="annot"><span class="annottext">(Loc -&gt; RawAtPos) -&gt; Loc -&gt; RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520422"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-265"></span><span class="hs-comment">-- All the value cases are TODO - we need another RawAtPos constructor.</span><span>
</span><span id="line-266"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInExp"><span class="hs-identifier hs-var">atPosInExp</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">Pos
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe RawAtPos
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-267"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInExp"><span class="hs-identifier hs-var">atPosInExp</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#IntLit"><span class="hs-identifier hs-type">IntLit</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">Pos
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe RawAtPos
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-268"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInExp"><span class="hs-identifier hs-var">atPosInExp</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#FloatLit"><span class="hs-identifier hs-type">FloatLit</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">Pos
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe RawAtPos
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-269"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInExp"><span class="hs-identifier hs-var">atPosInExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#LetPat"><span class="hs-identifier hs-type">LetPat</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520417"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520417"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Info AppRes
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520416"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520416"><span class="hs-identifier hs-var">pos</span></a></span></span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520417"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Pos -&gt; Bool
forall a. Located a =&gt; a -&gt; Pos -&gt; Bool
</span><a href="Language.Futhark.Query.html#contains"><span class="hs-operator hs-var">`contains`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520416"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInPat"><span class="hs-identifier hs-var">atPosInPat</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520417"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520416"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-271"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInExp"><span class="hs-identifier hs-var">atPosInExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#LetWith"><span class="hs-identifier hs-type">LetWith</span></a></span><span> </span><span id="local-6989586621684520415"><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684520415"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621684520414"><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684520414"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="annottext">SliceBase Info VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Info AppRes
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520413"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520413"><span class="hs-identifier hs-var">pos</span></a></span></span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684520415"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; Pos -&gt; Bool
forall a. Located a =&gt; a -&gt; Pos -&gt; Bool
</span><a href="Language.Futhark.Query.html#contains"><span class="hs-operator hs-var">`contains`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520413"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RawAtPos -&gt; Maybe RawAtPos
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(RawAtPos -&gt; Maybe RawAtPos) -&gt; RawAtPos -&gt; Maybe RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; Loc -&gt; RawAtPos
</span><a href="Language.Futhark.Query.html#RawAtName"><span class="hs-identifier hs-var">RawAtName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; QualName VName) -&gt; VName -&gt; QualName VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; VName
forall (f :: * -&gt; *) vn. IdentBase f vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#identName"><span class="hs-identifier hs-var hs-var">identName</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684520415"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684520415"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684520414"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; Pos -&gt; Bool
forall a. Located a =&gt; a -&gt; Pos -&gt; Bool
</span><a href="Language.Futhark.Query.html#contains"><span class="hs-operator hs-var">`contains`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520413"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RawAtPos -&gt; Maybe RawAtPos
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(RawAtPos -&gt; Maybe RawAtPos) -&gt; RawAtPos -&gt; Maybe RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; Loc -&gt; RawAtPos
</span><a href="Language.Futhark.Query.html#RawAtName"><span class="hs-identifier hs-var">RawAtName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; QualName VName) -&gt; VName -&gt; QualName VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; VName
forall (f :: * -&gt; *) vn. IdentBase f vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#identName"><span class="hs-identifier hs-var hs-var">identName</span></a></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684520414"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdentBase Info VName -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">IdentBase Info VName
</span><a href="#local-6989586621684520414"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInExp"><span class="hs-identifier hs-var">atPosInExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#DoLoop"><span class="hs-identifier hs-type">DoLoop</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520411"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520411"><span class="hs-identifier hs-var">merge</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LoopFormBase Info VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Info AppRes
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520410"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520410"><span class="hs-identifier hs-var">pos</span></a></span></span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520411"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Pos -&gt; Bool
forall a. Located a =&gt; a -&gt; Pos -&gt; Bool
</span><a href="Language.Futhark.Query.html#contains"><span class="hs-operator hs-var">`contains`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520410"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInPat"><span class="hs-identifier hs-var">atPosInPat</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684520411"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520410"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-276"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInExp"><span class="hs-identifier hs-var">atPosInExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Ascript"><span class="hs-identifier hs-type">Ascript</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520408"><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684520408"><span class="hs-identifier hs-var">tdecl</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520407"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520407"><span class="hs-identifier hs-var">pos</span></a></span></span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684520408"><span class="hs-identifier hs-var">tdecl</span></a></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName -&gt; Pos -&gt; Bool
forall a. Located a =&gt; a -&gt; Pos -&gt; Bool
</span><a href="Language.Futhark.Query.html#contains"><span class="hs-operator hs-var">`contains`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520407"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeExp VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInTypeExp"><span class="hs-identifier hs-var">atPosInTypeExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeDeclBase Info VName -&gt; TypeExp VName
forall (f :: * -&gt; *) vn. TypeDeclBase f vn -&gt; TypeExp vn
</span><a href="Language.Futhark.Syntax.html#declaredType"><span class="hs-identifier hs-var hs-var">declaredType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684520408"><span class="hs-identifier hs-var">tdecl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520407"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-278"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInExp"><span class="hs-identifier hs-var">atPosInExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AppExp"><span class="hs-identifier hs-type">AppExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Coerce"><span class="hs-identifier hs-type">Coerce</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520405"><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684520405"><span class="hs-identifier hs-var">tdecl</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Info AppRes
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520404"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520404"><span class="hs-identifier hs-var">pos</span></a></span></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684520405"><span class="hs-identifier hs-var">tdecl</span></a></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName -&gt; Pos -&gt; Bool
forall a. Located a =&gt; a -&gt; Pos -&gt; Bool
</span><a href="Language.Futhark.Query.html#contains"><span class="hs-operator hs-var">`contains`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520404"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeExp VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInTypeExp"><span class="hs-identifier hs-var">atPosInTypeExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeDeclBase Info VName -&gt; TypeExp VName
forall (f :: * -&gt; *) vn. TypeDeclBase f vn -&gt; TypeExp vn
</span><a href="Language.Futhark.Syntax.html#declaredType"><span class="hs-identifier hs-var hs-var">declaredType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684520405"><span class="hs-identifier hs-var">tdecl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520404"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-280"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInExp"><span class="hs-identifier hs-var">atPosInExp</span></a></span><span> </span><span id="local-6989586621684520403"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684520403"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684520402"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520402"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-281"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684520403"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Pos -&gt; Bool
forall a. Located a =&gt; a -&gt; Pos -&gt; Bool
</span><a href="Language.Futhark.Query.html#contains"><span class="hs-operator hs-var">`contains`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520402"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-282"></span><span>  </span><span class="hs-comment">-- Use the Either monad for short-circuiting for efficiency reasons.</span><span>
</span><span id="line-283"></span><span>  </span><span class="hs-comment">-- The first hit is going to be the only one.</span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ASTMapper (Either RawAtPos) -&gt; Exp -&gt; Either RawAtPos Exp
forall x (m :: * -&gt; *).
(ASTMappable x, Monad m) =&gt;
ASTMapper m -&gt; x -&gt; m x
</span><a href="Language.Futhark.Traversals.html#astMap"><span class="hs-identifier hs-var">astMap</span></a></span><span> </span><span class="annot"><span class="annottext">ASTMapper (Either RawAtPos)
</span><a href="#local-6989586621684520401"><span class="hs-identifier hs-var">mapper</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684520403"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-285"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621684520400"><span class="annot"><span class="annottext">RawAtPos
</span><a href="#local-6989586621684520400"><span class="hs-identifier hs-var">atpos</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RawAtPos -&gt; Maybe RawAtPos
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">RawAtPos
</span><a href="#local-6989586621684520400"><span class="hs-identifier hs-var">atpos</span></a></span><span>
</span><span id="line-286"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe RawAtPos
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-288"></span><span>    </span><span id="local-6989586621684520401"><span class="annot"><span class="annottext">mapper :: ASTMapper (Either RawAtPos)
</span><a href="#local-6989586621684520401"><span class="hs-identifier hs-var hs-var">mapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-289"></span><span>      </span><span class="annot"><span class="annottext">ASTMapper (Either RawAtPos)
forall (m :: * -&gt; *). Monad m =&gt; ASTMapper m
</span><a href="Language.Futhark.Traversals.html#identityMapper"><span class="hs-identifier hs-var">identityMapper</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">mapOnExp :: Exp -&gt; Either RawAtPos Exp
</span><a href="Language.Futhark.Traversals.html#mapOnExp"><span class="hs-identifier hs-var">mapOnExp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Either RawAtPos Exp
</span><a href="#local-6989586621684520398"><span class="hs-identifier hs-var">onExp</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-290"></span><span>    </span><span id="local-6989586621684520398"><span class="annot"><span class="annottext">onExp :: Exp -&gt; Either RawAtPos Exp
</span><a href="#local-6989586621684520398"><span class="hs-identifier hs-var hs-var">onExp</span></a></span></span><span> </span><span id="local-6989586621684520397"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684520397"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-291"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInExp"><span class="hs-identifier hs-var">atPosInExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684520397"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520402"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-292"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684520396"><span class="annot"><span class="annottext">RawAtPos
</span><a href="#local-6989586621684520396"><span class="hs-identifier hs-var">atpos</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RawAtPos -&gt; Either RawAtPos Exp
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">RawAtPos
</span><a href="#local-6989586621684520396"><span class="hs-identifier hs-var">atpos</span></a></span><span>
</span><span id="line-293"></span><span>        </span><span class="annot"><span class="annottext">Maybe RawAtPos
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Either RawAtPos Exp
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684520397"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInModExp"><span class="hs-identifier hs-type">atPosInModExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#ModExp"><span class="hs-identifier hs-type">ModExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pos</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#RawAtPos"><span class="hs-identifier hs-type">RawAtPos</span></a></span><span>
</span><span id="line-296"></span><span id="atPosInModExp"><span class="annot"><span class="annottext">atPosInModExp :: ModExp -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInModExp"><span class="hs-identifier hs-var hs-var">atPosInModExp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModVar"><span class="hs-identifier hs-type">ModVar</span></a></span><span> </span><span id="local-6989586621684520394"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684520394"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span id="local-6989586621684520393"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520393"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520392"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520392"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-297"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520393"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Pos -&gt; Bool
forall a. Located a =&gt; a -&gt; Pos -&gt; Bool
</span><a href="Language.Futhark.Query.html#contains"><span class="hs-operator hs-var">`contains`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520392"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-298"></span><span>  </span><span class="annot"><span class="annottext">RawAtPos -&gt; Maybe RawAtPos
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(RawAtPos -&gt; Maybe RawAtPos) -&gt; RawAtPos -&gt; Maybe RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; Loc -&gt; RawAtPos
</span><a href="Language.Futhark.Query.html#RawAtName"><span class="hs-identifier hs-var">RawAtName</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684520394"><span class="hs-identifier hs-var">qn</span></a></span><span> </span><span class="annot"><span class="annottext">(Loc -&gt; RawAtPos) -&gt; Loc -&gt; RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520393"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-299"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInModExp"><span class="hs-identifier hs-var">atPosInModExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModParens"><span class="hs-identifier hs-type">ModParens</span></a></span><span> </span><span id="local-6989586621684520391"><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520391"><span class="hs-identifier hs-var">me</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520390"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520390"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-300"></span><span>  </span><span class="annot"><span class="annottext">ModExp -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInModExp"><span class="hs-identifier hs-var">atPosInModExp</span></a></span><span> </span><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520391"><span class="hs-identifier hs-var">me</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520390"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-301"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInModExp"><span class="hs-identifier hs-var">atPosInModExp</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#ModImport"><span class="hs-identifier hs-type">ModImport</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">Pos
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-302"></span><span>  </span><span class="annot"><span class="annottext">Maybe RawAtPos
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-303"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInModExp"><span class="hs-identifier hs-var">atPosInModExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModDecs"><span class="hs-identifier hs-type">ModDecs</span></a></span><span> </span><span id="local-6989586621684520389"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621684520389"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520388"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520388"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-304"></span><span>  </span><span class="annot"><span class="annottext">[Maybe RawAtPos] -&gt; Maybe RawAtPos
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, MonadPlus m) =&gt;
t (m a) -&gt; m a
</span><span class="hs-identifier hs-var">msum</span></span><span> </span><span class="annot"><span class="annottext">([Maybe RawAtPos] -&gt; Maybe RawAtPos)
-&gt; [Maybe RawAtPos] -&gt; Maybe RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Dec -&gt; Maybe RawAtPos) -&gt; [Dec] -&gt; [Maybe RawAtPos]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInDec"><span class="hs-operator hs-var">`atPosInDec`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520388"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621684520389"><span class="hs-identifier hs-var">decs</span></a></span><span>
</span><span id="line-305"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInModExp"><span class="hs-identifier hs-var">atPosInModExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModApply"><span class="hs-identifier hs-type">ModApply</span></a></span><span> </span><span id="local-6989586621684520386"><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520386"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621684520385"><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520385"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="annot"><span class="annottext">Info (Map VName VName)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Info (Map VName VName)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520384"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520384"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-306"></span><span>  </span><span class="annot"><span class="annottext">ModExp -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInModExp"><span class="hs-identifier hs-var">atPosInModExp</span></a></span><span> </span><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520386"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520384"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RawAtPos -&gt; Maybe RawAtPos -&gt; Maybe RawAtPos
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a -&gt; m a -&gt; m a
</span><span class="hs-operator hs-var">`mplus`</span></span><span> </span><span class="annot"><span class="annottext">ModExp -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInModExp"><span class="hs-identifier hs-var">atPosInModExp</span></a></span><span> </span><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520385"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520384"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-307"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInModExp"><span class="hs-identifier hs-var">atPosInModExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModAscript"><span class="hs-identifier hs-type">ModAscript</span></a></span><span> </span><span id="local-6989586621684520383"><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520383"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Info (Map VName VName)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520382"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520382"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-308"></span><span>  </span><span class="annot"><span class="annottext">ModExp -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInModExp"><span class="hs-identifier hs-var">atPosInModExp</span></a></span><span> </span><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520383"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520382"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-309"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInModExp"><span class="hs-identifier hs-var">atPosInModExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModLambda"><span class="hs-identifier hs-type">ModLambda</span></a></span><span> </span><span class="annot"><span class="annottext">ModParam
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (SigExpBase Info VName, Info (Map VName VName))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520381"><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520381"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520380"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520380"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-310"></span><span>  </span><span class="annot"><span class="annottext">ModExp -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInModExp"><span class="hs-identifier hs-var">atPosInModExp</span></a></span><span> </span><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520381"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520380"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInSpec"><span class="hs-identifier hs-type">atPosInSpec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#Spec"><span class="hs-identifier hs-type">Spec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pos</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#RawAtPos"><span class="hs-identifier hs-type">RawAtPos</span></a></span><span>
</span><span id="line-313"></span><span id="atPosInSpec"><span class="annot"><span class="annottext">atPosInSpec :: Spec -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInSpec"><span class="hs-identifier hs-var hs-var">atPosInSpec</span></a></span></span><span> </span><span id="local-6989586621684520378"><span class="annot"><span class="annottext">Spec
</span><a href="#local-6989586621684520378"><span class="hs-identifier hs-var">spec</span></a></span></span><span> </span><span id="local-6989586621684520377"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520377"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Spec
</span><a href="#local-6989586621684520378"><span class="hs-identifier hs-var">spec</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-315"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#ValSpec"><span class="hs-identifier hs-type">ValSpec</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520376"><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684520376"><span class="hs-identifier hs-var">tdecl</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeExp VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInTypeExp"><span class="hs-identifier hs-var">atPosInTypeExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeDeclBase Info VName -&gt; TypeExp VName
forall (f :: * -&gt; *) vn. TypeDeclBase f vn -&gt; TypeExp vn
</span><a href="Language.Futhark.Syntax.html#declaredType"><span class="hs-identifier hs-var hs-var">declaredType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684520376"><span class="hs-identifier hs-var">tdecl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520377"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-316"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeAbbrSpec"><span class="hs-identifier hs-type">TypeAbbrSpec</span></a></span><span> </span><span id="local-6989586621684520375"><span class="annot"><span class="annottext">TypeBind
</span><a href="#local-6989586621684520375"><span class="hs-identifier hs-var">tbind</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeBind -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInTypeBind"><span class="hs-identifier hs-var">atPosInTypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBind
</span><a href="#local-6989586621684520375"><span class="hs-identifier hs-var">tbind</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520377"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-317"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeSpec"><span class="hs-identifier hs-type">TypeSpec</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe RawAtPos
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-318"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#ModSpec"><span class="hs-identifier hs-type">ModSpec</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520373"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520373"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInSigExp"><span class="hs-identifier hs-var">atPosInSigExp</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520373"><span class="hs-identifier hs-var">se</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520377"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-319"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#IncludeSpec"><span class="hs-identifier hs-type">IncludeSpec</span></a></span><span> </span><span id="local-6989586621684520371"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520371"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInSigExp"><span class="hs-identifier hs-var">atPosInSigExp</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520371"><span class="hs-identifier hs-var">se</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520377"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInSigExp"><span class="hs-identifier hs-type">atPosInSigExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#SigExp"><span class="hs-identifier hs-type">SigExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pos</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#RawAtPos"><span class="hs-identifier hs-type">RawAtPos</span></a></span><span>
</span><span id="line-322"></span><span id="atPosInSigExp"><span class="annot"><span class="annottext">atPosInSigExp :: SigExpBase Info VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInSigExp"><span class="hs-identifier hs-var hs-var">atPosInSigExp</span></a></span></span><span> </span><span id="local-6989586621684520370"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520370"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span id="local-6989586621684520369"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520369"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-323"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520370"><span class="hs-identifier hs-var">se</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-324"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#SigVar"><span class="hs-identifier hs-type">SigVar</span></a></span><span> </span><span id="local-6989586621684520368"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684520368"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span class="annot"><span class="annottext">Info (Map VName VName)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520367"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520367"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-325"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520367"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Pos -&gt; Bool
forall a. Located a =&gt; a -&gt; Pos -&gt; Bool
</span><a href="Language.Futhark.Query.html#contains"><span class="hs-operator hs-var">`contains`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520369"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-326"></span><span>      </span><span class="annot"><span class="annottext">RawAtPos -&gt; Maybe RawAtPos
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(RawAtPos -&gt; Maybe RawAtPos) -&gt; RawAtPos -&gt; Maybe RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; Loc -&gt; RawAtPos
</span><a href="Language.Futhark.Query.html#RawAtName"><span class="hs-identifier hs-var">RawAtName</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684520368"><span class="hs-identifier hs-var">qn</span></a></span><span> </span><span class="annot"><span class="annottext">(Loc -&gt; RawAtPos) -&gt; Loc -&gt; RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684520367"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-327"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#SigParens"><span class="hs-identifier hs-type">SigParens</span></a></span><span> </span><span id="local-6989586621684520366"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520366"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInSigExp"><span class="hs-identifier hs-var">atPosInSigExp</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520366"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520369"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-328"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#SigSpecs"><span class="hs-identifier hs-type">SigSpecs</span></a></span><span> </span><span id="local-6989586621684520365"><span class="annot"><span class="annottext">[Spec]
</span><a href="#local-6989586621684520365"><span class="hs-identifier hs-var">specs</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Maybe RawAtPos] -&gt; Maybe RawAtPos
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, MonadPlus m) =&gt;
t (m a) -&gt; m a
</span><span class="hs-identifier hs-var">msum</span></span><span> </span><span class="annot"><span class="annottext">([Maybe RawAtPos] -&gt; Maybe RawAtPos)
-&gt; [Maybe RawAtPos] -&gt; Maybe RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Spec -&gt; Maybe RawAtPos) -&gt; [Spec] -&gt; [Maybe RawAtPos]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Spec -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInSpec"><span class="hs-operator hs-var">`atPosInSpec`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520369"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Spec]
</span><a href="#local-6989586621684520365"><span class="hs-identifier hs-var">specs</span></a></span><span>
</span><span id="line-329"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#SigWith"><span class="hs-identifier hs-type">SigWith</span></a></span><span> </span><span id="local-6989586621684520364"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520364"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">TypeRefBase Info VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInSigExp"><span class="hs-identifier hs-var">atPosInSigExp</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520364"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520369"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-330"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#SigArrow"><span class="hs-identifier hs-type">SigArrow</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe VName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520363"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520363"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621684520362"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520362"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInSigExp"><span class="hs-identifier hs-var">atPosInSigExp</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520363"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520369"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RawAtPos -&gt; Maybe RawAtPos -&gt; Maybe RawAtPos
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a -&gt; m a -&gt; m a
</span><span class="hs-operator hs-var">`mplus`</span></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInSigExp"><span class="hs-identifier hs-var">atPosInSigExp</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520362"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520369"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInValBind"><span class="hs-identifier hs-type">atPosInValBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#ValBind"><span class="hs-identifier hs-type">ValBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pos</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#RawAtPos"><span class="hs-identifier hs-type">RawAtPos</span></a></span><span>
</span><span id="line-333"></span><span id="atPosInValBind"><span class="annot"><span class="annottext">atPosInValBind :: ValBind -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInValBind"><span class="hs-identifier hs-var hs-var">atPosInValBind</span></a></span></span><span> </span><span id="local-6989586621684520360"><span class="annot"><span class="annottext">ValBind
</span><a href="#local-6989586621684520360"><span class="hs-identifier hs-var">vbind</span></a></span></span><span> </span><span id="local-6989586621684520359"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520359"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-334"></span><span>  </span><span class="annot"><span class="annottext">[Maybe RawAtPos] -&gt; Maybe RawAtPos
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, MonadPlus m) =&gt;
t (m a) -&gt; m a
</span><span class="hs-identifier hs-var">msum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; Maybe RawAtPos)
-&gt; [PatBase Info VName] -&gt; [Maybe RawAtPos]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInPat"><span class="hs-operator hs-var">`atPosInPat`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520359"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValBind -&gt; [PatBase Info VName]
forall (f :: * -&gt; *) vn. ValBindBase f vn -&gt; [PatBase f vn]
</span><a href="Language.Futhark.Syntax.html#valBindParams"><span class="hs-identifier hs-var hs-var">valBindParams</span></a></span><span> </span><span class="annot"><span class="annottext">ValBind
</span><a href="#local-6989586621684520360"><span class="hs-identifier hs-var">vbind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>    </span><span class="annot"><span class="annottext">Maybe RawAtPos -&gt; Maybe RawAtPos -&gt; Maybe RawAtPos
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a -&gt; m a -&gt; m a
</span><span class="hs-operator hs-var">`mplus`</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInExp"><span class="hs-identifier hs-var">atPosInExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValBind -&gt; Exp
forall (f :: * -&gt; *) vn. ValBindBase f vn -&gt; ExpBase f vn
</span><a href="Language.Futhark.Syntax.html#valBindBody"><span class="hs-identifier hs-var hs-var">valBindBody</span></a></span><span> </span><span class="annot"><span class="annottext">ValBind
</span><a href="#local-6989586621684520360"><span class="hs-identifier hs-var">vbind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520359"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-336"></span><span>    </span><span class="annot"><span class="annottext">Maybe RawAtPos -&gt; Maybe RawAtPos -&gt; Maybe RawAtPos
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a -&gt; m a -&gt; m a
</span><span class="hs-operator hs-var">`mplus`</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Maybe RawAtPos) -&gt; Maybe RawAtPos
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeExp VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInTypeExp"><span class="hs-identifier hs-var">atPosInTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeExp VName -&gt; Pos -&gt; Maybe RawAtPos)
-&gt; Maybe (TypeExp VName) -&gt; Maybe (Pos -&gt; Maybe RawAtPos)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ValBind -&gt; Maybe (TypeExp VName)
forall (f :: * -&gt; *) vn. ValBindBase f vn -&gt; Maybe (TypeExp vn)
</span><a href="Language.Futhark.Syntax.html#valBindRetDecl"><span class="hs-identifier hs-var hs-var">valBindRetDecl</span></a></span><span> </span><span class="annot"><span class="annottext">ValBind
</span><a href="#local-6989586621684520360"><span class="hs-identifier hs-var">vbind</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Pos -&gt; Maybe RawAtPos)
-&gt; Maybe Pos -&gt; Maybe (Maybe RawAtPos)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pos -&gt; Maybe Pos
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520359"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInTypeBind"><span class="hs-identifier hs-type">atPosInTypeBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pos</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#RawAtPos"><span class="hs-identifier hs-type">RawAtPos</span></a></span><span>
</span><span id="line-339"></span><span id="atPosInTypeBind"><span class="annot"><span class="annottext">atPosInTypeBind :: TypeBind -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInTypeBind"><span class="hs-identifier hs-var hs-var">atPosInTypeBind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeExp VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInTypeExp"><span class="hs-identifier hs-var">atPosInTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeExp VName -&gt; Pos -&gt; Maybe RawAtPos)
-&gt; (TypeBind -&gt; TypeExp VName) -&gt; TypeBind -&gt; Pos -&gt; Maybe RawAtPos
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TypeBind -&gt; TypeExp VName
forall (f :: * -&gt; *) vn. TypeBindBase f vn -&gt; TypeExp vn
</span><a href="Language.Futhark.Syntax.html#typeExp"><span class="hs-identifier hs-var hs-var">typeExp</span></a></span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInModBind"><span class="hs-identifier hs-type">atPosInModBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#ModBind"><span class="hs-identifier hs-type">ModBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pos</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#RawAtPos"><span class="hs-identifier hs-type">RawAtPos</span></a></span><span>
</span><span id="line-342"></span><span id="atPosInModBind"><span class="annot"><span class="annottext">atPosInModBind :: ModBind -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInModBind"><span class="hs-identifier hs-var hs-var">atPosInModBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModBind"><span class="hs-identifier hs-type">ModBind</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520353"><span class="annot"><span class="annottext">[ModParam]
</span><a href="#local-6989586621684520353"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621684520352"><span class="annot"><span class="annottext">Maybe (SigExpBase Info VName, Info (Map VName VName))
</span><a href="#local-6989586621684520352"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span id="local-6989586621684520351"><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520351"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684520350"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520350"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-343"></span><span>  </span><span class="annot"><span class="annottext">[Maybe RawAtPos] -&gt; Maybe RawAtPos
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, MonadPlus m) =&gt;
t (m a) -&gt; m a
</span><span class="hs-identifier hs-var">msum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModParam -&gt; Maybe RawAtPos) -&gt; [ModParam] -&gt; [Maybe RawAtPos]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ModParam -&gt; Maybe RawAtPos
</span><a href="#local-6989586621684520349"><span class="hs-identifier hs-var">inParam</span></a></span><span> </span><span class="annot"><span class="annottext">[ModParam]
</span><a href="#local-6989586621684520353"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>    </span><span class="annot"><span class="annottext">Maybe RawAtPos -&gt; Maybe RawAtPos -&gt; Maybe RawAtPos
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a -&gt; m a -&gt; m a
</span><span class="hs-operator hs-var">`mplus`</span></span><span> </span><span class="annot"><span class="annottext">ModExp -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInModExp"><span class="hs-identifier hs-var">atPosInModExp</span></a></span><span> </span><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520351"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520350"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-345"></span><span>    </span><span class="annot"><span class="annottext">Maybe RawAtPos -&gt; Maybe RawAtPos -&gt; Maybe RawAtPos
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a -&gt; m a -&gt; m a
</span><span class="hs-operator hs-var">`mplus`</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (SigExpBase Info VName, Info (Map VName VName))
</span><a href="#local-6989586621684520352"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-346"></span><span>      </span><span class="annot"><span class="annottext">Maybe (SigExpBase Info VName, Info (Map VName VName))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe RawAtPos
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-347"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684520348"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520348"><span class="hs-identifier hs-var">se</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Info (Map VName VName)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInSigExp"><span class="hs-identifier hs-var">atPosInSigExp</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520348"><span class="hs-identifier hs-var">se</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520350"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-349"></span><span>    </span><span id="local-6989586621684520349"><span class="annot"><span class="annottext">inParam :: ModParam -&gt; Maybe RawAtPos
</span><a href="#local-6989586621684520349"><span class="hs-identifier hs-var hs-var">inParam</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModParam"><span class="hs-identifier hs-type">ModParam</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684520347"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520347"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span class="annot"><span class="annottext">Info [VName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInSigExp"><span class="hs-identifier hs-var">atPosInSigExp</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684520347"><span class="hs-identifier hs-var">se</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520350"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInSigBind"><span class="hs-identifier hs-type">atPosInSigBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#SigBind"><span class="hs-identifier hs-type">SigBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pos</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#RawAtPos"><span class="hs-identifier hs-type">RawAtPos</span></a></span><span>
</span><span id="line-352"></span><span id="atPosInSigBind"><span class="annot"><span class="annottext">atPosInSigBind :: SigBind -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInSigBind"><span class="hs-identifier hs-var hs-var">atPosInSigBind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInSigExp"><span class="hs-identifier hs-var">atPosInSigExp</span></a></span><span> </span><span class="annot"><span class="annottext">(SigExpBase Info VName -&gt; Pos -&gt; Maybe RawAtPos)
-&gt; (SigBind -&gt; SigExpBase Info VName)
-&gt; SigBind
-&gt; Pos
-&gt; Maybe RawAtPos
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SigBind -&gt; SigExpBase Info VName
forall (f :: * -&gt; *) vn. SigBindBase f vn -&gt; SigExpBase f vn
</span><a href="Language.Futhark.Syntax.html#sigExp"><span class="hs-identifier hs-var hs-var">sigExp</span></a></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInDec"><span class="hs-identifier hs-type">atPosInDec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#Dec"><span class="hs-identifier hs-type">Dec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pos</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#RawAtPos"><span class="hs-identifier hs-type">RawAtPos</span></a></span><span>
</span><span id="line-355"></span><span id="atPosInDec"><span class="annot"><span class="annottext">atPosInDec :: Dec -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInDec"><span class="hs-identifier hs-var hs-var">atPosInDec</span></a></span></span><span> </span><span id="local-6989586621684520345"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621684520345"><span class="hs-identifier hs-var">dec</span></a></span></span><span> </span><span id="local-6989586621684520344"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520344"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-356"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621684520345"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">Dec -&gt; Pos -&gt; Bool
forall a. Located a =&gt; a -&gt; Pos -&gt; Bool
</span><a href="Language.Futhark.Query.html#contains"><span class="hs-operator hs-var">`contains`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520344"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-357"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621684520345"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-358"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#ValDec"><span class="hs-identifier hs-type">ValDec</span></a></span><span> </span><span id="local-6989586621684520343"><span class="annot"><span class="annottext">ValBind
</span><a href="#local-6989586621684520343"><span class="hs-identifier hs-var">vbind</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ValBind -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInValBind"><span class="hs-identifier hs-var">atPosInValBind</span></a></span><span> </span><span class="annot"><span class="annottext">ValBind
</span><a href="#local-6989586621684520343"><span class="hs-identifier hs-var">vbind</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520344"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-359"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeDec"><span class="hs-identifier hs-type">TypeDec</span></a></span><span> </span><span id="local-6989586621684520342"><span class="annot"><span class="annottext">TypeBind
</span><a href="#local-6989586621684520342"><span class="hs-identifier hs-var">tbind</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeBind -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInTypeBind"><span class="hs-identifier hs-var">atPosInTypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBind
</span><a href="#local-6989586621684520342"><span class="hs-identifier hs-var">tbind</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520344"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-360"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#ModDec"><span class="hs-identifier hs-type">ModDec</span></a></span><span> </span><span id="local-6989586621684520341"><span class="annot"><span class="annottext">ModBind
</span><a href="#local-6989586621684520341"><span class="hs-identifier hs-var">mbind</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModBind -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInModBind"><span class="hs-identifier hs-var">atPosInModBind</span></a></span><span> </span><span class="annot"><span class="annottext">ModBind
</span><a href="#local-6989586621684520341"><span class="hs-identifier hs-var">mbind</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520344"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-361"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#SigDec"><span class="hs-identifier hs-type">SigDec</span></a></span><span> </span><span id="local-6989586621684520340"><span class="annot"><span class="annottext">SigBind
</span><a href="#local-6989586621684520340"><span class="hs-identifier hs-var">sbind</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SigBind -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInSigBind"><span class="hs-identifier hs-var">atPosInSigBind</span></a></span><span> </span><span class="annot"><span class="annottext">SigBind
</span><a href="#local-6989586621684520340"><span class="hs-identifier hs-var">sbind</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520344"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-362"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#OpenDec"><span class="hs-identifier hs-type">OpenDec</span></a></span><span> </span><span id="local-6989586621684520339"><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520339"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModExp -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInModExp"><span class="hs-identifier hs-var">atPosInModExp</span></a></span><span> </span><span class="annot"><span class="annottext">ModExp
</span><a href="#local-6989586621684520339"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520344"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-363"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#LocalDec"><span class="hs-identifier hs-type">LocalDec</span></a></span><span> </span><span id="local-6989586621684520338"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621684520338"><span class="hs-identifier hs-var">dec'</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Dec -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInDec"><span class="hs-identifier hs-var">atPosInDec</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621684520338"><span class="hs-identifier hs-var">dec'</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520344"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-364"></span><span>    </span><span class="annot"><a href="Language.Futhark.Syntax.html#ImportDec"><span class="hs-identifier hs-type">ImportDec</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe RawAtPos
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span class="annot"><a href="Language.Futhark.Query.html#atPosInProg"><span class="hs-identifier hs-type">atPosInProg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pos</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#RawAtPos"><span class="hs-identifier hs-type">RawAtPos</span></a></span><span>
</span><span id="line-367"></span><span id="atPosInProg"><span class="annot"><span class="annottext">atPosInProg :: Prog -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInProg"><span class="hs-identifier hs-var hs-var">atPosInProg</span></a></span></span><span> </span><span id="local-6989586621684520336"><span class="annot"><span class="annottext">Prog
</span><a href="#local-6989586621684520336"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span id="local-6989586621684520335"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520335"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-368"></span><span>  </span><span class="annot"><span class="annottext">[Maybe RawAtPos] -&gt; Maybe RawAtPos
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, MonadPlus m) =&gt;
t (m a) -&gt; m a
</span><span class="hs-identifier hs-var">msum</span></span><span> </span><span class="annot"><span class="annottext">([Maybe RawAtPos] -&gt; Maybe RawAtPos)
-&gt; [Maybe RawAtPos] -&gt; Maybe RawAtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Dec -&gt; Maybe RawAtPos) -&gt; [Dec] -&gt; [Maybe RawAtPos]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInDec"><span class="hs-operator hs-var">`atPosInDec`</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520335"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Prog -&gt; [Dec]
forall (f :: * -&gt; *) vn. ProgBase f vn -&gt; [DecBase f vn]
</span><a href="Language.Futhark.Syntax.html#progDecs"><span class="hs-identifier hs-var hs-var">progDecs</span></a></span><span> </span><span class="annot"><span class="annottext">Prog
</span><a href="#local-6989586621684520336"><span class="hs-identifier hs-var">prog</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span class="annot"><a href="Language.Futhark.Query.html#containingModule"><span class="hs-identifier hs-type">containingModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#Imports"><span class="hs-identifier hs-type">Imports</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pos</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#FileModule"><span class="hs-identifier hs-type">FileModule</span></a></span><span>
</span><span id="line-371"></span><span id="containingModule"><span class="annot"><span class="annottext">containingModule :: Imports -&gt; Pos -&gt; Maybe FileModule
</span><a href="Language.Futhark.Query.html#containingModule"><span class="hs-identifier hs-var hs-var">containingModule</span></a></span></span><span> </span><span id="local-6989586621684520333"><span class="annot"><span class="annottext">Imports
</span><a href="#local-6989586621684520333"><span class="hs-identifier hs-var">imports</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pos</span></span><span> </span><span id="local-6989586621684520331"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684520331"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-372"></span><span>  </span><span class="annot"><span class="annottext">(String, FileModule) -&gt; FileModule
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((String, FileModule) -&gt; FileModule)
-&gt; Maybe (String, FileModule) -&gt; Maybe FileModule
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">((String, FileModule) -&gt; Bool)
-&gt; Imports -&gt; Maybe (String, FileModule)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684520330"><span class="hs-identifier hs-var">file'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Bool)
-&gt; ((String, FileModule) -&gt; String) -&gt; (String, FileModule) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(String, FileModule) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Imports
</span><a href="#local-6989586621684520333"><span class="hs-identifier hs-var">imports</span></a></span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-374"></span><span>    </span><span id="local-6989586621684520330"><span class="annot"><span class="annottext">file' :: String
</span><a href="#local-6989586621684520330"><span class="hs-identifier hs-var hs-var">file'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-375"></span><span>      </span><span class="annot"><span class="annottext">ImportName -&gt; String
</span><a href="Language.Futhark.Semantic.html#includeToString"><span class="hs-identifier hs-var">includeToString</span></a></span><span> </span><span class="annot"><span class="annottext">(ImportName -&gt; String) -&gt; ImportName -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-376"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ImportName
</span><a href="Language.Futhark.Semantic.html#mkInitialImport"><span class="hs-identifier hs-var">mkInitialImport</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ImportName) -&gt; String -&gt; ImportName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-377"></span><span>          </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((String, String) -&gt; String) -&gt; (String, String) -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; (String, String)
</span><span class="hs-identifier hs-var">Posix.splitExtension</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684520331"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span class="hs-comment">-- | Information about what is at the given source location.</span><span>
</span><span id="line-380"></span><span class="hs-keyword">data</span><span> </span><span id="AtPos"><span class="annot"><a href="Language.Futhark.Query.html#AtPos"><span class="hs-identifier hs-var">AtPos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AtName"><span class="annot"><a href="Language.Futhark.Query.html#AtName"><span class="hs-identifier hs-var">AtName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#QualName"><span class="hs-identifier hs-type">QualName</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#BoundTo"><span class="hs-identifier hs-type">BoundTo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Loc</span></span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684520316"><span id="local-6989586621684520324"><span class="annot"><span class="annottext">AtPos -&gt; AtPos -&gt; Bool
(AtPos -&gt; AtPos -&gt; Bool) -&gt; (AtPos -&gt; AtPos -&gt; Bool) -&gt; Eq AtPos
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: AtPos -&gt; AtPos -&gt; Bool
$c/= :: AtPos -&gt; AtPos -&gt; Bool
== :: AtPos -&gt; AtPos -&gt; Bool
$c== :: AtPos -&gt; AtPos -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684520302"><span id="local-6989586621684520304"><span id="local-6989586621684520314"><span class="annot"><span class="annottext">Int -&gt; AtPos -&gt; ShowS
[AtPos] -&gt; ShowS
AtPos -&gt; String
(Int -&gt; AtPos -&gt; ShowS)
-&gt; (AtPos -&gt; String) -&gt; ([AtPos] -&gt; ShowS) -&gt; Show AtPos
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [AtPos] -&gt; ShowS
$cshowList :: [AtPos] -&gt; ShowS
show :: AtPos -&gt; String
$cshow :: AtPos -&gt; String
showsPrec :: Int -&gt; AtPos -&gt; ShowS
$cshowsPrec :: Int -&gt; AtPos -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span class="hs-comment">-- | Information about what's at the given source position.  Returns</span><span>
</span><span id="line-384"></span><span class="hs-comment">-- 'Nothing' if there is nothing there, including if the source</span><span>
</span><span id="line-385"></span><span class="hs-comment">-- position is invalid.</span><span>
</span><span id="line-386"></span><span class="annot"><a href="Language.Futhark.Query.html#atPos"><span class="hs-identifier hs-type">atPos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#Imports"><span class="hs-identifier hs-type">Imports</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pos</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.Query.html#AtPos"><span class="hs-identifier hs-type">AtPos</span></a></span><span>
</span><span id="line-387"></span><span id="atPos"><span class="annot"><span class="annottext">atPos :: Imports -&gt; Pos -&gt; Maybe AtPos
</span><a href="Language.Futhark.Query.html#atPos"><span class="hs-identifier hs-var hs-var">atPos</span></a></span></span><span> </span><span id="local-6989586621684520301"><span class="annot"><span class="annottext">Imports
</span><a href="#local-6989586621684520301"><span class="hs-identifier hs-var">imports</span></a></span></span><span> </span><span id="local-6989586621684520300"><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520300"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-388"></span><span>  </span><span id="local-6989586621684520299"><span class="annot"><span class="annottext">Prog
</span><a href="#local-6989586621684520299"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FileModule -&gt; Prog
</span><a href="Language.Futhark.Semantic.html#fileProg"><span class="hs-identifier hs-var hs-var">fileProg</span></a></span><span> </span><span class="annot"><span class="annottext">(FileModule -&gt; Prog) -&gt; Maybe FileModule -&gt; Maybe Prog
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Imports -&gt; Pos -&gt; Maybe FileModule
</span><a href="Language.Futhark.Query.html#containingModule"><span class="hs-identifier hs-var">containingModule</span></a></span><span> </span><span class="annot"><span class="annottext">Imports
</span><a href="#local-6989586621684520301"><span class="hs-identifier hs-var">imports</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520300"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-389"></span><span>  </span><span class="annot"><a href="Language.Futhark.Query.html#RawAtName"><span class="hs-identifier hs-type">RawAtName</span></a></span><span> </span><span id="local-6989586621684520298"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684520298"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span id="local-6989586621684520297"><span class="annot"><span class="annottext">Loc
</span><a href="#local-6989586621684520297"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Prog -&gt; Pos -&gt; Maybe RawAtPos
</span><a href="Language.Futhark.Query.html#atPosInProg"><span class="hs-identifier hs-var">atPosInProg</span></a></span><span> </span><span class="annot"><span class="annottext">Prog
</span><a href="#local-6989586621684520299"><span class="hs-identifier hs-var">prog</span></a></span><span> </span><span class="annot"><span class="annottext">Pos
</span><a href="#local-6989586621684520300"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-390"></span><span>  </span><span class="annot"><span class="annottext">AtPos -&gt; Maybe AtPos
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(AtPos -&gt; Maybe AtPos) -&gt; AtPos -&gt; Maybe AtPos
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; Maybe BoundTo -&gt; Loc -&gt; AtPos
</span><a href="Language.Futhark.Query.html#AtName"><span class="hs-identifier hs-var">AtName</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684520298"><span class="hs-identifier hs-var">qn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName VName -&gt; VName
forall vn. QualName vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#qualLeaf"><span class="hs-identifier hs-var hs-var">qualLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684520298"><span class="hs-identifier hs-var">qn</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Map VName BoundTo -&gt; Maybe BoundTo
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-operator hs-var">`M.lookup`</span></span><span> </span><span class="annot"><span class="annottext">Imports -&gt; Map VName BoundTo
</span><a href="Language.Futhark.Query.html#allBindings"><span class="hs-identifier hs-var">allBindings</span></a></span><span> </span><span class="annot"><span class="annottext">Imports
</span><a href="#local-6989586621684520301"><span class="hs-identifier hs-var">imports</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Loc
</span><a href="#local-6989586621684520297"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-391"></span></pre></body></html>