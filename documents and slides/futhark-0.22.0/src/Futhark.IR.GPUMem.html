<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Futhark.IR.GPUMem</span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier">GPUMem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Simplification</span></span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Futhark.IR.GPUMem.html#simplifyProg"><span class="hs-identifier">simplifyProg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Futhark.IR.GPUMem.html#simplifyStms"><span class="hs-identifier">simplifyStms</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Futhark.IR.GPUMem.html#simpleGPUMem"><span class="hs-identifier">simpleGPUMem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Module re-exports</span></span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html"><span class="hs-identifier">Futhark.IR.Mem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Futhark.IR.GPU.Op.html"><span class="hs-identifier">Futhark.IR.GPU.Op</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">where</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Analysis.PrimExp.Convert.html"><span class="hs-identifier">Futhark.Analysis.PrimExp.Convert</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html"><span class="hs-identifier">Futhark.Analysis.UsageTable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UT</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.GPU.Op.html"><span class="hs-identifier">Futhark.IR.GPU.Op</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.GPU.Simplify.html"><span class="hs-identifier">Futhark.IR.GPU.Simplify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Simplify.html#simplifyKernelOp"><span class="hs-identifier">simplifyKernelOp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html"><span class="hs-identifier">Futhark.IR.Mem</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.Simplify.html"><span class="hs-identifier">Futhark.IR.Mem.Simplify</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.IR.TypeCheck.html"><span class="hs-identifier">Futhark.IR.TypeCheck</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TC</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.MonadFreshNames.html"><span class="hs-identifier">Futhark.MonadFreshNames</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.Optimise.Simplify.Engine.html"><span class="hs-identifier">Futhark.Optimise.Simplify.Engine</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Engine</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Pass.html"><span class="hs-identifier">Futhark.Pass</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Pass.ExplicitAllocations.html"><span class="hs-identifier">Futhark.Pass.ExplicitAllocations</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Builder.html#BuilderOps"><span class="hs-identifier">BuilderOps</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Pass.ExplicitAllocations.html#mkLetNamesB%27"><span class="hs-identifier">mkLetNamesB'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Pass.ExplicitAllocations.html#mkLetNamesB%27%27"><span class="hs-identifier">mkLetNamesB''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">data</span><span> </span><span id="GPUMem"><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-var">GPUMem</span></a></span></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Rep.html#RepTypes"><span class="hs-identifier hs-type">RepTypes</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="LetDec"><span class="annot"><a href="Futhark.IR.Rep.html#LetDec"><span class="hs-identifier hs-var">LetDec</span></a></span></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#LetDecMem"><span class="hs-identifier hs-type">LetDecMem</span></a></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="FParamInfo"><span class="annot"><a href="Futhark.IR.Rep.html#FParamInfo"><span class="hs-identifier hs-var">FParamInfo</span></a></span></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#FParamMem"><span class="hs-identifier hs-type">FParamMem</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="LParamInfo"><span class="annot"><a href="Futhark.IR.Rep.html#LParamInfo"><span class="hs-identifier hs-var">LParamInfo</span></a></span></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#LParamMem"><span class="hs-identifier hs-type">LParamMem</span></a></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="RetType"><span class="annot"><a href="Futhark.IR.Rep.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#RetTypeMem"><span class="hs-identifier hs-type">RetTypeMem</span></a></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="BranchType"><span class="annot"><a href="Futhark.IR.Rep.html#BranchType"><span class="hs-identifier hs-var">BranchType</span></a></span></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#BranchTypeMem"><span class="hs-identifier hs-type">BranchTypeMem</span></a></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Op"><span class="annot"><a href="Futhark.IR.Rep.html#Op"><span class="hs-identifier hs-var">Op</span></a></span></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier hs-type">MemOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Op.html#HostOp"><span class="hs-identifier hs-type">HostOp</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.html#ASTRep"><span class="hs-identifier hs-type">ASTRep</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-44"></span><span>  </span><span id="local-6989586621684439045"><span class="annot"><span class="annottext">expTypesFromPat :: forall (m :: * -&gt; *).
(HasScope GPUMem m, Monad m) =&gt;
Pat GPUMem -&gt; m [BranchType GPUMem]
</span><a href="Futhark.IR.Prop.html#expTypesFromPat"><span class="hs-identifier hs-var hs-var hs-var hs-var">expTypesFromPat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BranchTypeMem] -&gt; m [BranchTypeMem]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([BranchTypeMem] -&gt; m [BranchTypeMem])
-&gt; (PatT LetDecMem -&gt; [BranchTypeMem])
-&gt; PatT LetDecMem
-&gt; m [BranchTypeMem]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((VName, BranchTypeMem) -&gt; BranchTypeMem)
-&gt; [(VName, BranchTypeMem)] -&gt; [BranchTypeMem]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(VName, BranchTypeMem) -&gt; BranchTypeMem
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(VName, BranchTypeMem)] -&gt; [BranchTypeMem])
-&gt; (PatT LetDecMem -&gt; [(VName, BranchTypeMem)])
-&gt; PatT LetDecMem
-&gt; [BranchTypeMem]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PatT LetDecMem -&gt; [(VName, BranchTypeMem)]
</span><a href="Futhark.IR.Mem.html#bodyReturnsFromPat"><span class="hs-identifier hs-var">bodyReturnsFromPat</span></a></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#OpReturns"><span class="hs-identifier hs-type">OpReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Op.html#HostOp"><span class="hs-identifier hs-type">HostOp</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-47"></span><span>  </span><span id="local-6989586621684438978"><span class="annot"><span class="annottext">opReturns :: forall rep inner (m :: * -&gt; *).
(Mem rep inner, Monad m, HasScope rep m) =&gt;
HostOp GPUMem () -&gt; m [ExpReturns]
</span><a href="Futhark.IR.Mem.html#opReturns"><span class="hs-identifier hs-var hs-var hs-var hs-var">opReturns</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Op.html#SegOp"><span class="hs-identifier hs-type">SegOp</span></a></span><span> </span><span id="local-6989586621684438975"><span class="annot"><span class="annottext">SegOp SegLevel GPUMem
</span><a href="#local-6989586621684438975"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SegOp SegLevel GPUMem -&gt; m [ExpReturns]
forall rep inner (m :: * -&gt; *) lvl somerep.
(Mem rep inner, Monad m, HasScope rep m) =&gt;
SegOp lvl somerep -&gt; m [ExpReturns]
</span><a href="Futhark.IR.SegOp.html#segOpReturns"><span class="hs-identifier hs-var">segOpReturns</span></a></span><span> </span><span class="annot"><span class="annottext">SegOp SegLevel GPUMem
</span><a href="#local-6989586621684438975"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><a href="Futhark.IR.Mem.html#opReturns"><span class="hs-identifier hs-var">opReturns</span></a></span><span> </span><span id="local-6989586621684438973"><span class="annot"><span class="annottext">HostOp GPUMem ()
</span><a href="#local-6989586621684438973"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ExtType] -&gt; [ExpReturns]
</span><a href="Futhark.IR.Mem.html#extReturns"><span class="hs-identifier hs-var">extReturns</span></a></span><span> </span><span class="annot"><span class="annottext">([ExtType] -&gt; [ExpReturns]) -&gt; m [ExtType] -&gt; m [ExpReturns]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HostOp GPUMem () -&gt; m [ExtType]
forall op t (m :: * -&gt; *).
(TypedOp op, HasScope t m) =&gt;
op -&gt; m [ExtType]
</span><a href="Futhark.IR.Prop.TypeOf.html#opType"><span class="hs-identifier hs-var">opType</span></a></span><span> </span><span class="annot"><span class="annottext">HostOp GPUMem ()
</span><a href="#local-6989586621684438973"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#OpReturns"><span class="hs-identifier hs-type">OpReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Op.html#HostOp"><span class="hs-identifier hs-type">HostOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Optimise.Simplify.Rep.html#Wise"><span class="hs-identifier hs-type">Engine.Wise</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-51"></span><span>  </span><span id="local-6989586621684438918"><span class="annot"><span class="annottext">opReturns :: forall rep inner (m :: * -&gt; *).
(Mem rep inner, Monad m, HasScope rep m) =&gt;
HostOp (Wise GPUMem) () -&gt; m [ExpReturns]
</span><a href="#local-6989586621684438918"><span class="hs-identifier hs-var hs-var hs-var hs-var">opReturns</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Op.html#SegOp"><span class="hs-identifier hs-type">SegOp</span></a></span><span> </span><span id="local-6989586621684438917"><span class="annot"><span class="annottext">SegOp SegLevel (Wise GPUMem)
</span><a href="#local-6989586621684438917"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SegOp SegLevel (Wise GPUMem) -&gt; m [ExpReturns]
forall rep inner (m :: * -&gt; *) lvl somerep.
(Mem rep inner, Monad m, HasScope rep m) =&gt;
SegOp lvl somerep -&gt; m [ExpReturns]
</span><a href="Futhark.IR.SegOp.html#segOpReturns"><span class="hs-identifier hs-var">segOpReturns</span></a></span><span> </span><span class="annot"><span class="annottext">SegOp SegLevel (Wise GPUMem)
</span><a href="#local-6989586621684438917"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><a href="Futhark.IR.Mem.html#opReturns"><span class="hs-identifier hs-var">opReturns</span></a></span><span> </span><span id="local-6989586621684438916"><span class="annot"><span class="annottext">HostOp (Wise GPUMem) ()
</span><a href="#local-6989586621684438916"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ExtType] -&gt; [ExpReturns]
</span><a href="Futhark.IR.Mem.html#extReturns"><span class="hs-identifier hs-var">extReturns</span></a></span><span> </span><span class="annot"><span class="annottext">([ExtType] -&gt; [ExpReturns]) -&gt; m [ExtType] -&gt; m [ExpReturns]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HostOp (Wise GPUMem) () -&gt; m [ExtType]
forall op t (m :: * -&gt; *).
(TypedOp op, HasScope t m) =&gt;
op -&gt; m [ExtType]
</span><a href="Futhark.IR.Prop.TypeOf.html#opType"><span class="hs-identifier hs-var">opType</span></a></span><span> </span><span class="annot"><span class="annottext">HostOp (Wise GPUMem) ()
</span><a href="#local-6989586621684438916"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621684438894"><span class="annot"><a href="Futhark.IR.Pretty.html#PrettyRep"><span class="hs-identifier hs-type">PrettyRep</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.TypeCheck.html#CheckableOp"><span class="hs-identifier hs-type">TC.CheckableOp</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-57"></span><span>  </span><span id="local-6989586621684438835"><span class="annot"><span class="annottext">checkOp :: OpWithAliases (Op GPUMem) -&gt; TypeM GPUMem ()
</span><a href="Futhark.IR.TypeCheck.html#checkOp"><span class="hs-identifier hs-var hs-var hs-var hs-var">checkOp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SegLevel
-&gt; MemOp (HostOp (Aliases GPUMem) ()) -&gt; TypeM GPUMem ()
forall {rep} {op}.
(Checkable rep,
 OpWithAliases (Op rep) ~ MemOp (HostOp (Aliases rep) op)) =&gt;
Maybe SegLevel -&gt; MemOp (HostOp (Aliases rep) op) -&gt; TypeM rep ()
</span><a href="#local-6989586621684438833"><span class="hs-identifier hs-var">typeCheckMemoryOp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SegLevel
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-59"></span><span>      </span><span id="local-6989586621684438833"><span class="annot"><span class="annottext">typeCheckMemoryOp :: Maybe SegLevel -&gt; MemOp (HostOp (Aliases rep) op) -&gt; TypeM rep ()
</span><a href="#local-6989586621684438833"><span class="hs-identifier hs-var hs-var">typeCheckMemoryOp</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe SegLevel
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span id="local-6989586621684438821"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684438821"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-60"></span><span>        </span><span class="annot"><span class="annottext">[TypeBase (ShapeBase SubExp) NoUniqueness]
-&gt; SubExp -&gt; TypeM rep ()
forall rep.
Checkable rep =&gt;
[TypeBase (ShapeBase SubExp) NoUniqueness]
-&gt; SubExp -&gt; TypeM rep ()
</span><a href="Futhark.IR.TypeCheck.html#require"><span class="hs-identifier hs-var">TC.require</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PrimType -&gt; TypeBase (ShapeBase SubExp) NoUniqueness
forall shape u. PrimType -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Prop.Types.html#int64"><span class="hs-identifier hs-var">int64</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684438821"><span class="hs-identifier hs-var">size</span></a></span><span>
</span><span id="line-61"></span><span>      </span><span class="annot"><a href="#local-6989586621684438833"><span class="hs-identifier hs-var">typeCheckMemoryOp</span></a></span><span> </span><span id="local-6989586621684438817"><span class="annot"><span class="annottext">Maybe SegLevel
</span><a href="#local-6989586621684438817"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621684438815"><span class="annot"><span class="annottext">HostOp (Aliases rep) op
</span><a href="#local-6989586621684438815"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-62"></span><span>        </span><span class="annot"><span class="annottext">(SegLevel -&gt; OpWithAliases (Op rep) -&gt; TypeM rep ())
-&gt; Maybe SegLevel
-&gt; (op -&gt; TypeM rep ())
-&gt; HostOp (Aliases rep) op
-&gt; TypeM rep ()
forall rep op.
Checkable rep =&gt;
(SegLevel -&gt; OpWithAliases (Op rep) -&gt; TypeM rep ())
-&gt; Maybe SegLevel
-&gt; (op -&gt; TypeM rep ())
-&gt; HostOp (Aliases rep) op
-&gt; TypeM rep ()
</span><a href="Futhark.IR.GPU.Op.html#typeCheckHostOp"><span class="hs-identifier hs-var">typeCheckHostOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe SegLevel -&gt; MemOp (HostOp (Aliases rep) op) -&gt; TypeM rep ()
</span><a href="#local-6989586621684438833"><span class="hs-identifier hs-var">typeCheckMemoryOp</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe SegLevel -&gt; MemOp (HostOp (Aliases rep) op) -&gt; TypeM rep ())
-&gt; (SegLevel -&gt; Maybe SegLevel)
-&gt; SegLevel
-&gt; MemOp (HostOp (Aliases rep) op)
-&gt; TypeM rep ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SegLevel -&gt; Maybe SegLevel
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe SegLevel
</span><a href="#local-6989586621684438817"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeM rep () -&gt; op -&gt; TypeM rep ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(TypeM rep () -&gt; op -&gt; TypeM rep ())
-&gt; TypeM rep () -&gt; op -&gt; TypeM rep ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; TypeM rep ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HostOp (Aliases rep) op
</span><a href="#local-6989586621684438815"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621684438802"><span id="local-6989586621684438804"><span class="annot"><a href="Futhark.IR.TypeCheck.html#Checkable"><span class="hs-identifier hs-type">TC.Checkable</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-65"></span><span>  </span><span id="local-6989586621684438784"><span class="annot"><span class="annottext">checkFParamDec :: VName -&gt; FParamInfo GPUMem -&gt; TypeM GPUMem ()
</span><a href="Futhark.IR.TypeCheck.html#checkFParamDec"><span class="hs-identifier hs-var hs-var hs-var hs-var">checkFParamDec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; FParamInfo GPUMem -&gt; TypeM GPUMem ()
forall rep u.
Checkable rep =&gt;
VName -&gt; MemInfo SubExp u MemBind -&gt; TypeM rep ()
</span><a href="Futhark.IR.Mem.html#checkMemInfo"><span class="hs-identifier hs-var">checkMemInfo</span></a></span><span>
</span><span id="line-66"></span><span>  </span><span id="local-6989586621684438780"><span class="annot"><span class="annottext">checkLParamDec :: VName -&gt; LParamInfo GPUMem -&gt; TypeM GPUMem ()
</span><a href="Futhark.IR.TypeCheck.html#checkLParamDec"><span class="hs-identifier hs-var hs-var hs-var hs-var">checkLParamDec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; LParamInfo GPUMem -&gt; TypeM GPUMem ()
forall rep u.
Checkable rep =&gt;
VName -&gt; MemInfo SubExp u MemBind -&gt; TypeM rep ()
</span><a href="Futhark.IR.Mem.html#checkMemInfo"><span class="hs-identifier hs-var">checkMemInfo</span></a></span><span>
</span><span id="line-67"></span><span>  </span><span id="local-6989586621684438777"><span class="annot"><span class="annottext">checkLetBoundDec :: VName -&gt; LetDec GPUMem -&gt; TypeM GPUMem ()
</span><a href="Futhark.IR.TypeCheck.html#checkLetBoundDec"><span class="hs-identifier hs-var hs-var hs-var hs-var">checkLetBoundDec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; LetDec GPUMem -&gt; TypeM GPUMem ()
forall rep u.
Checkable rep =&gt;
VName -&gt; MemInfo SubExp u MemBind -&gt; TypeM rep ()
</span><a href="Futhark.IR.Mem.html#checkMemInfo"><span class="hs-identifier hs-var">checkMemInfo</span></a></span><span>
</span><span id="line-68"></span><span>  </span><span id="local-6989586621684438767"><span class="annot"><span class="annottext">checkRetType :: [RetType GPUMem] -&gt; TypeM GPUMem ()
</span><a href="Futhark.IR.TypeCheck.html#checkRetType"><span class="hs-identifier hs-var hs-var hs-var hs-var">checkRetType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RetTypeMem -&gt; TypeM GPUMem ()) -&gt; [RetTypeMem] -&gt; TypeM GPUMem ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">((RetTypeMem -&gt; TypeM GPUMem ())
 -&gt; [RetTypeMem] -&gt; TypeM GPUMem ())
-&gt; (RetTypeMem -&gt; TypeM GPUMem ())
-&gt; [RetTypeMem]
-&gt; TypeM GPUMem ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeBase (ShapeBase (Ext SubExp)) Uniqueness -&gt; TypeM GPUMem ()
forall rep u.
Checkable rep =&gt;
TypeBase (ShapeBase (Ext SubExp)) u -&gt; TypeM rep ()
</span><a href="Futhark.IR.TypeCheck.html#checkExtType"><span class="hs-identifier hs-var">TC.checkExtType</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase (ShapeBase (Ext SubExp)) Uniqueness -&gt; TypeM GPUMem ())
-&gt; (RetTypeMem -&gt; TypeBase (ShapeBase (Ext SubExp)) Uniqueness)
-&gt; RetTypeMem
-&gt; TypeM GPUMem ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RetTypeMem -&gt; TypeBase (ShapeBase (Ext SubExp)) Uniqueness
forall t.
DeclExtTyped t =&gt;
t -&gt; TypeBase (ShapeBase (Ext SubExp)) Uniqueness
</span><a href="Futhark.IR.Prop.Types.html#declExtTypeOf"><span class="hs-identifier hs-var">declExtTypeOf</span></a></span><span>
</span><span id="line-69"></span><span>  </span><span id="local-6989586621684438759"><span class="annot"><span class="annottext">primFParam :: VName -&gt; PrimType -&gt; TypeM GPUMem (FParam (Aliases GPUMem))
</span><a href="Futhark.IR.TypeCheck.html#primFParam"><span class="hs-identifier hs-var hs-var hs-var hs-var">primFParam</span></a></span></span><span> </span><span id="local-6989586621684438757"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684438757"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621684438756"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684438756"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Param FParamMem -&gt; TypeM GPUMem (Param FParamMem)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Param FParamMem -&gt; TypeM GPUMem (Param FParamMem))
-&gt; Param FParamMem -&gt; TypeM GPUMem (Param FParamMem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Attrs -&gt; VName -&gt; FParamMem -&gt; Param FParamMem
forall dec. Attrs -&gt; VName -&gt; dec -&gt; Param dec
</span><a href="Futhark.IR.Syntax.Core.html#Param"><span class="hs-identifier hs-var">Param</span></a></span><span> </span><span class="annot"><span class="annottext">Attrs
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684438757"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType -&gt; FParamMem
forall d u ret. PrimType -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684438756"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>  </span><span id="local-6989586621684438742"><span class="annot"><span class="annottext">matchPat :: Pat (Aliases GPUMem) -&gt; Exp (Aliases GPUMem) -&gt; TypeM GPUMem ()
</span><a href="Futhark.IR.TypeCheck.html#matchPat"><span class="hs-identifier hs-var hs-var hs-var hs-var">matchPat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pat (Aliases GPUMem) -&gt; Exp (Aliases GPUMem) -&gt; TypeM GPUMem ()
forall rep inner.
(Mem rep inner, LetDec rep ~ LetDecMem, Checkable rep) =&gt;
Pat (Aliases rep) -&gt; Exp (Aliases rep) -&gt; TypeM rep ()
</span><a href="Futhark.IR.Mem.html#matchPatToExp"><span class="hs-identifier hs-var">matchPatToExp</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span id="local-6989586621684438730"><span class="annot"><span class="annottext">matchReturnType :: [RetType GPUMem] -&gt; Result -&gt; TypeM GPUMem ()
</span><a href="Futhark.IR.TypeCheck.html#matchReturnType"><span class="hs-identifier hs-var hs-var hs-var hs-var">matchReturnType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[RetType GPUMem] -&gt; Result -&gt; TypeM GPUMem ()
forall rep inner.
(Mem rep inner, Checkable rep) =&gt;
[RetTypeMem] -&gt; Result -&gt; TypeM rep ()
</span><a href="Futhark.IR.Mem.html#matchFunctionReturnType"><span class="hs-identifier hs-var">matchFunctionReturnType</span></a></span><span>
</span><span id="line-72"></span><span>  </span><span id="local-6989586621684438718"><span class="annot"><span class="annottext">matchBranchType :: [BranchType GPUMem] -&gt; Body (Aliases GPUMem) -&gt; TypeM GPUMem ()
</span><a href="Futhark.IR.TypeCheck.html#matchBranchType"><span class="hs-identifier hs-var hs-var hs-var hs-var">matchBranchType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BranchType GPUMem] -&gt; Body (Aliases GPUMem) -&gt; TypeM GPUMem ()
forall rep inner.
(Mem rep inner, Checkable rep) =&gt;
[BranchTypeMem] -&gt; Body (Aliases rep) -&gt; TypeM rep ()
</span><a href="Futhark.IR.Mem.html#matchBranchReturnType"><span class="hs-identifier hs-var">matchBranchReturnType</span></a></span><span>
</span><span id="line-73"></span><span>  </span><span id="local-6989586621684438706"><span class="annot"><span class="annottext">matchLoopResult :: [FParam (Aliases GPUMem)] -&gt; Result -&gt; TypeM GPUMem ()
</span><a href="Futhark.IR.TypeCheck.html#matchLoopResult"><span class="hs-identifier hs-var hs-var hs-var hs-var">matchLoopResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FParam (Aliases GPUMem)] -&gt; Result -&gt; TypeM GPUMem ()
forall rep inner.
(Mem rep inner, Checkable rep) =&gt;
[FParam (Aliases rep)] -&gt; Result -&gt; TypeM rep ()
</span><a href="Futhark.IR.Mem.html#matchLoopResultMem"><span class="hs-identifier hs-var">matchLoopResultMem</span></a></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.Builder.html#BuilderOps"><span class="hs-identifier hs-type">BuilderOps</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-76"></span><span>  </span><span id="local-6989586621684438689"><span class="annot"><span class="annottext">mkExpDecB :: forall (m :: * -&gt; *).
(MonadBuilder m, Rep m ~ GPUMem) =&gt;
Pat GPUMem -&gt; Exp GPUMem -&gt; m (ExpDec GPUMem)
</span><a href="Futhark.Builder.html#mkExpDecB"><span class="hs-identifier hs-var hs-var hs-var hs-var">mkExpDecB</span></a></span></span><span> </span><span class="annot"><span class="annottext">Pat GPUMem
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Exp GPUMem
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>  </span><span id="local-6989586621684438682"><span class="annot"><span class="annottext">mkBodyB :: forall (m :: * -&gt; *).
(MonadBuilder m, Rep m ~ GPUMem) =&gt;
Stms GPUMem -&gt; Result -&gt; m (Body GPUMem)
</span><a href="Futhark.Builder.html#mkBodyB"><span class="hs-identifier hs-var hs-var hs-var hs-var">mkBodyB</span></a></span></span><span> </span><span id="local-6989586621684438680"><span class="annot"><span class="annottext">Stms GPUMem
</span><a href="#local-6989586621684438680"><span class="hs-identifier hs-var">stms</span></a></span></span><span> </span><span id="local-6989586621684438679"><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684438679"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Body GPUMem -&gt; m (Body GPUMem)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Body GPUMem -&gt; m (Body GPUMem)) -&gt; Body GPUMem -&gt; m (Body GPUMem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BodyDec GPUMem -&gt; Stms GPUMem -&gt; Result -&gt; Body GPUMem
forall rep. BodyDec rep -&gt; Stms rep -&gt; Result -&gt; BodyT rep
</span><a href="Futhark.IR.Syntax.html#Body"><span class="hs-identifier hs-var">Body</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Stms GPUMem
</span><a href="#local-6989586621684438680"><span class="hs-identifier hs-var">stms</span></a></span><span> </span><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684438679"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-78"></span><span>  </span><span id="local-6989586621684438659"><span class="annot"><span class="annottext">mkLetNamesB :: forall (m :: * -&gt; *).
(MonadBuilder m, Rep m ~ GPUMem) =&gt;
[VName] -&gt; Exp GPUMem -&gt; m (Stm GPUMem)
</span><a href="Futhark.Builder.html#mkLetNamesB"><span class="hs-identifier hs-var hs-var hs-var hs-var">mkLetNamesB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExpDec (Rep m) -&gt; [VName] -&gt; Exp (Rep m) -&gt; m (Stm (Rep m))
forall (m :: * -&gt; *) inner.
(LetDec (Rep m) ~ LetDecMem, Mem (Rep m) inner, MonadBuilder m,
 ExpDec (Rep m) ~ ()) =&gt;
ExpDec (Rep m) -&gt; [VName] -&gt; Exp (Rep m) -&gt; m (Stm (Rep m))
</span><a href="Futhark.Pass.ExplicitAllocations.html#mkLetNamesB%27"><span class="hs-identifier hs-var">mkLetNamesB'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.Builder.html#BuilderOps"><span class="hs-identifier hs-type">BuilderOps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Optimise.Simplify.Rep.html#Wise"><span class="hs-identifier hs-type">Engine.Wise</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-81"></span><span>  </span><span id="local-6989586621684438645"><span class="annot"><span class="annottext">mkExpDecB :: forall (m :: * -&gt; *).
(MonadBuilder m, Rep m ~ Wise GPUMem) =&gt;
Pat (Wise GPUMem) -&gt; Exp (Wise GPUMem) -&gt; m (ExpDec (Wise GPUMem))
</span><a href="#local-6989586621684438645"><span class="hs-identifier hs-var hs-var hs-var hs-var">mkExpDecB</span></a></span></span><span> </span><span id="local-6989586621684438644"><span class="annot"><span class="annottext">Pat (Wise GPUMem)
</span><a href="#local-6989586621684438644"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684438643"><span class="annot"><span class="annottext">Exp (Wise GPUMem)
</span><a href="#local-6989586621684438643"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ExpWisdom, ()) -&gt; m (ExpWisdom, ())
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((ExpWisdom, ()) -&gt; m (ExpWisdom, ()))
-&gt; (ExpWisdom, ()) -&gt; m (ExpWisdom, ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat (Wise GPUMem)
-&gt; ExpDec GPUMem -&gt; Exp (Wise GPUMem) -&gt; ExpDec (Wise GPUMem)
forall rep.
(ASTRep rep, CanBeWise (Op rep)) =&gt;
Pat (Wise rep) -&gt; ExpDec rep -&gt; Exp (Wise rep) -&gt; ExpDec (Wise rep)
</span><a href="Futhark.Optimise.Simplify.Rep.html#mkWiseExpDec"><span class="hs-identifier hs-var">Engine.mkWiseExpDec</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (Wise GPUMem)
</span><a href="#local-6989586621684438644"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp (Wise GPUMem)
</span><a href="#local-6989586621684438643"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-82"></span><span>  </span><span id="local-6989586621684438634"><span class="annot"><span class="annottext">mkBodyB :: forall (m :: * -&gt; *).
(MonadBuilder m, Rep m ~ Wise GPUMem) =&gt;
Stms (Wise GPUMem) -&gt; Result -&gt; m (Body (Wise GPUMem))
</span><a href="#local-6989586621684438634"><span class="hs-identifier hs-var hs-var hs-var hs-var">mkBodyB</span></a></span></span><span> </span><span id="local-6989586621684438633"><span class="annot"><span class="annottext">Stms (Wise GPUMem)
</span><a href="#local-6989586621684438633"><span class="hs-identifier hs-var">stms</span></a></span></span><span> </span><span id="local-6989586621684438632"><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684438632"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Body (Wise GPUMem) -&gt; m (Body (Wise GPUMem))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Body (Wise GPUMem) -&gt; m (Body (Wise GPUMem)))
-&gt; Body (Wise GPUMem) -&gt; m (Body (Wise GPUMem))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BodyDec GPUMem
-&gt; Stms (Wise GPUMem) -&gt; Result -&gt; Body (Wise GPUMem)
forall rep.
(ASTRep rep, CanBeWise (Op rep)) =&gt;
BodyDec rep -&gt; Stms (Wise rep) -&gt; Result -&gt; Body (Wise rep)
</span><a href="Futhark.Optimise.Simplify.Rep.html#mkWiseBody"><span class="hs-identifier hs-var">Engine.mkWiseBody</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Stms (Wise GPUMem)
</span><a href="#local-6989586621684438633"><span class="hs-identifier hs-var">stms</span></a></span><span> </span><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684438632"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span id="local-6989586621684438600"><span class="annot"><span class="annottext">mkLetNamesB :: forall (m :: * -&gt; *).
(MonadBuilder m, Rep m ~ Wise GPUMem) =&gt;
[VName] -&gt; Exp (Wise GPUMem) -&gt; m (Stm (Wise GPUMem))
</span><a href="#local-6989586621684438600"><span class="hs-identifier hs-var hs-var hs-var hs-var">mkLetNamesB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; Exp (Wise GPUMem) -&gt; m (Stm (Wise GPUMem))
forall rep inner (m :: * -&gt; *).
(BuilderOps rep, Mem rep inner, LetDec rep ~ LetDecMem,
 OpReturns (OpWithWisdom inner), ExpDec rep ~ (), Rep m ~ Wise rep,
 HasScope (Wise rep) m, MonadBuilder m, CanBeWise inner) =&gt;
[VName] -&gt; Exp (Wise rep) -&gt; m (Stm (Wise rep))
</span><a href="Futhark.Pass.ExplicitAllocations.html#mkLetNamesB%27%27"><span class="hs-identifier hs-var">mkLetNamesB''</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Traversals.html#TraverseOpStms"><span class="hs-identifier hs-type">TraverseOpStms</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Optimise.Simplify.Rep.html#Wise"><span class="hs-identifier hs-type">Engine.Wise</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-86"></span><span>  </span><span id="local-6989586621684438592"><span class="annot"><span class="annottext">traverseOpStms :: forall (m :: * -&gt; *).
Monad m =&gt;
OpStmsTraverser m (Op (Wise GPUMem)) (Wise GPUMem)
</span><a href="Futhark.IR.Traversals.html#traverseOpStms"><span class="hs-identifier hs-var hs-var hs-var hs-var">traverseOpStms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpStmsTraverser m (HostOp (Wise GPUMem) ()) (Wise GPUMem)
-&gt; OpStmsTraverser
     m (MemOp (HostOp (Wise GPUMem) ())) (Wise GPUMem)
forall (m :: * -&gt; *) inner rep.
Monad m =&gt;
OpStmsTraverser m inner rep -&gt; OpStmsTraverser m (MemOp inner) rep
</span><a href="Futhark.IR.Mem.html#traverseMemOpStms"><span class="hs-identifier hs-var">traverseMemOpStms</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OpStmsTraverser m () (Wise GPUMem)
-&gt; OpStmsTraverser m (HostOp (Wise GPUMem) ()) (Wise GPUMem)
forall (m :: * -&gt; *) op rep.
Monad m =&gt;
OpStmsTraverser m op rep -&gt; OpStmsTraverser m (HostOp rep op) rep
</span><a href="Futhark.IR.GPU.Op.html#traverseHostOpStms"><span class="hs-identifier hs-var">traverseHostOpStms</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() -&gt; m ()) -&gt; OpStmsTraverser m () (Wise GPUMem)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="annot"><a href="Futhark.IR.GPUMem.html#simplifyProg"><span class="hs-identifier hs-type">simplifyProg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Pass.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span id="simplifyProg"><span class="annot"><span class="annottext">simplifyProg :: Prog GPUMem -&gt; PassM (Prog GPUMem)
</span><a href="Futhark.IR.GPUMem.html#simplifyProg"><span class="hs-identifier hs-var hs-var">simplifyProg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimpleOps GPUMem -&gt; Prog GPUMem -&gt; PassM (Prog GPUMem)
forall rep inner.
SimplifyMemory rep inner =&gt;
SimpleOps rep -&gt; Prog rep -&gt; PassM (Prog rep)
</span><a href="Futhark.IR.Mem.Simplify.html#simplifyProgGeneric"><span class="hs-identifier hs-var">simplifyProgGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleOps GPUMem
</span><a href="Futhark.IR.GPUMem.html#simpleGPUMem"><span class="hs-identifier hs-var">simpleGPUMem</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span id="local-6989586621684439447"><span class="annot"><a href="Futhark.IR.GPUMem.html#simplifyStms"><span class="hs-identifier hs-type">simplifyStms</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#HasScope"><span class="hs-identifier hs-type">HasScope</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684439447"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.MonadFreshNames.html#MonadFreshNames"><span class="hs-identifier hs-type">MonadFreshNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684439447"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Stms"><span class="hs-identifier hs-type">Stms</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621684439447"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Stms"><span class="hs-identifier hs-type">Stms</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-93"></span><span id="simplifyStms"><span class="annot"><span class="annottext">simplifyStms :: forall (m :: * -&gt; *).
(HasScope GPUMem m, MonadFreshNames m) =&gt;
Stms GPUMem -&gt; m (Stms GPUMem)
</span><a href="Futhark.IR.GPUMem.html#simplifyStms"><span class="hs-identifier hs-var hs-var">simplifyStms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimpleOps GPUMem -&gt; Stms GPUMem -&gt; m (Stms GPUMem)
forall rep (m :: * -&gt; *) inner.
(HasScope rep m, MonadFreshNames m, SimplifyMemory rep inner) =&gt;
SimpleOps rep -&gt; Stms rep -&gt; m (Stms rep)
</span><a href="Futhark.IR.Mem.Simplify.html#simplifyStmsGeneric"><span class="hs-identifier hs-var">simplifyStmsGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleOps GPUMem
</span><a href="Futhark.IR.GPUMem.html#simpleGPUMem"><span class="hs-identifier hs-var">simpleGPUMem</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="annot"><a href="Futhark.IR.GPUMem.html#simpleGPUMem"><span class="hs-identifier hs-type">simpleGPUMem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Optimise.Simplify.Engine.html#SimpleOps"><span class="hs-identifier hs-type">Engine.SimpleOps</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span>
</span><span id="line-96"></span><span id="simpleGPUMem"><span class="annot"><span class="annottext">simpleGPUMem :: SimpleOps GPUMem
</span><a href="Futhark.IR.GPUMem.html#simpleGPUMem"><span class="hs-identifier hs-var hs-var">simpleGPUMem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><span class="annottext">(OpWithWisdom (HostOp GPUMem ()) -&gt; UsageTable)
-&gt; SimplifyOp GPUMem (OpWithWisdom (HostOp GPUMem ()))
-&gt; SimpleOps GPUMem
forall rep inner.
SimplifyMemory rep inner =&gt;
(OpWithWisdom inner -&gt; UsageTable)
-&gt; SimplifyOp rep (OpWithWisdom inner) -&gt; SimpleOps rep
</span><a href="Futhark.IR.Mem.Simplify.html#simpleGeneric"><span class="hs-identifier hs-var">simpleGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">OpWithWisdom (HostOp GPUMem ()) -&gt; UsageTable
HostOp (Wise GPUMem) () -&gt; UsageTable
</span><a href="#local-6989586621684438569"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="annot"><span class="annottext">(SimplifyOp GPUMem (OpWithWisdom (HostOp GPUMem ()))
 -&gt; SimpleOps GPUMem)
-&gt; SimplifyOp GPUMem (OpWithWisdom (HostOp GPUMem ()))
-&gt; SimpleOps GPUMem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SimplifyOp GPUMem ()
-&gt; HostOp (Wise GPUMem) ()
-&gt; SimpleM GPUMem (HostOp (Wise GPUMem) (), Stms (Wise GPUMem))
forall rep op.
(SimplifiableRep rep, BodyDec rep ~ ()) =&gt;
SimplifyOp rep op
-&gt; HostOp (Wise rep) op
-&gt; SimpleM rep (HostOp (Wise rep) op, Stms (Wise rep))
</span><a href="Futhark.IR.GPU.Simplify.html#simplifyKernelOp"><span class="hs-identifier hs-var">simplifyKernelOp</span></a></span><span> </span><span class="annot"><span class="annottext">(SimplifyOp GPUMem ()
 -&gt; HostOp (Wise GPUMem) ()
 -&gt; SimpleM GPUMem (HostOp (Wise GPUMem) (), Stms (Wise GPUMem)))
-&gt; SimplifyOp GPUMem ()
-&gt; HostOp (Wise GPUMem) ()
-&gt; SimpleM GPUMem (HostOp (Wise GPUMem) (), Stms (Wise GPUMem))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SimpleM GPUMem ((), Stms (Wise GPUMem)) -&gt; SimplifyOp GPUMem ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(SimpleM GPUMem ((), Stms (Wise GPUMem)) -&gt; SimplifyOp GPUMem ())
-&gt; SimpleM GPUMem ((), Stms (Wise GPUMem)) -&gt; SimplifyOp GPUMem ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((), Stms (Wise GPUMem)) -&gt; SimpleM GPUMem ((), Stms (Wise GPUMem))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Stms (Wise GPUMem)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-comment">-- Slightly hackily, we look at the inside of SegGroup operations</span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-comment">-- to figure out the sizes of local memory allocations, and add</span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-comment">-- usages for those sizes.  This is necessary so the simplifier</span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-comment">-- will hoist those sizes out as far as possible (most</span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-comment">-- importantly, past the versioning If).</span><span>
</span><span id="line-104"></span><span>    </span><span id="local-6989586621684438569"><span class="annot"><span class="annottext">usage :: HostOp (Wise GPUMem) () -&gt; UsageTable
</span><a href="#local-6989586621684438569"><span class="hs-identifier hs-var hs-var">usage</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Op.html#SegOp"><span class="hs-identifier hs-type">SegOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.SegOp.html#SegMap"><span class="hs-identifier hs-type">SegMap</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPU.Op.html#SegGroup"><span class="hs-identifier hs-type">SegGroup</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">SegSpace
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TypeBase (ShapeBase SubExp) NoUniqueness]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684438566"><span class="annot"><span class="annottext">KernelBody (Wise GPUMem)
</span><a href="#local-6989586621684438566"><span class="hs-identifier hs-var">kbody</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KernelBody (Wise GPUMem) -&gt; UsageTable
</span><a href="#local-6989586621684438565"><span class="hs-identifier hs-var">localAllocs</span></a></span><span> </span><span class="annot"><span class="annottext">KernelBody (Wise GPUMem)
</span><a href="#local-6989586621684438566"><span class="hs-identifier hs-var">kbody</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><a href="#local-6989586621684438569"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="annot"><span class="annottext">HostOp (Wise GPUMem) ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UsageTable
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-106"></span><span>    </span><span id="local-6989586621684438565"><span class="annot"><span class="annottext">localAllocs :: KernelBody (Wise GPUMem) -&gt; UsageTable
</span><a href="#local-6989586621684438565"><span class="hs-identifier hs-var hs-var">localAllocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Stm (Wise GPUMem) -&gt; UsageTable)
-&gt; Stms (Wise GPUMem) -&gt; UsageTable
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">Stm (Wise GPUMem) -&gt; UsageTable
</span><a href="#local-6989586621684438563"><span class="hs-identifier hs-var">stmLocalAlloc</span></a></span><span> </span><span class="annot"><span class="annottext">(Stms (Wise GPUMem) -&gt; UsageTable)
-&gt; (KernelBody (Wise GPUMem) -&gt; Stms (Wise GPUMem))
-&gt; KernelBody (Wise GPUMem)
-&gt; UsageTable
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">KernelBody (Wise GPUMem) -&gt; Stms (Wise GPUMem)
forall rep. KernelBody rep -&gt; Stms rep
</span><a href="Futhark.IR.SegOp.html#kernelBodyStms"><span class="hs-identifier hs-var hs-var">kernelBodyStms</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span id="local-6989586621684438563"><span class="annot"><span class="annottext">stmLocalAlloc :: Stm (Wise GPUMem) -&gt; UsageTable
</span><a href="#local-6989586621684438563"><span class="hs-identifier hs-var hs-var">stmLocalAlloc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp (Wise GPUMem) -&gt; UsageTable
forall {rep} {inner}.
(Op rep ~ MemOp inner) =&gt;
ExpT rep -&gt; UsageTable
</span><a href="#local-6989586621684438559"><span class="hs-identifier hs-var">expLocalAlloc</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp (Wise GPUMem) -&gt; UsageTable)
-&gt; (Stm (Wise GPUMem) -&gt; Exp (Wise GPUMem))
-&gt; Stm (Wise GPUMem)
-&gt; UsageTable
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Stm (Wise GPUMem) -&gt; Exp (Wise GPUMem)
forall rep. Stm rep -&gt; Exp rep
</span><a href="Futhark.IR.Syntax.html#stmExp"><span class="hs-identifier hs-var hs-var">stmExp</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span id="local-6989586621684438559"><span class="annot"><span class="annottext">expLocalAlloc :: ExpT rep -&gt; UsageTable
</span><a href="#local-6989586621684438559"><span class="hs-identifier hs-var hs-var">expLocalAlloc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684438550"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684438550"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Space"><span class="hs-identifier hs-type">Space</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;local&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-109"></span><span>      </span><span class="annot"><span class="annottext">VName -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#sizeUsage"><span class="hs-identifier hs-var">UT.sizeUsage</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684438550"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><a href="#local-6989586621684438559"><span class="hs-identifier hs-var">expLocalAlloc</span></a></span><span> </span><span class="annot"><span class="annottext">ExpT rep
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-111"></span><span>      </span><span class="annot"><span class="annottext">UsageTable
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-112"></span></pre></body></html>