<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">-- | Provides last-use analysis for Futhark programs.</span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Futhark.Analysis.LastUse</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseMap"><span class="hs-identifier">LastUseMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseGPUMem"><span class="hs-identifier">analyseGPUMem</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseSeqMem"><span class="hs-identifier">analyseSeqMem</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">first</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&amp;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Tuple</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Analysis.Alias.html"><span class="hs-identifier">Futhark.Analysis.Alias</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.Alias.html#aliasAnalysis"><span class="hs-identifier">aliasAnalysis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.Aliases.html"><span class="hs-identifier">Futhark.IR.Aliases</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html"><span class="hs-identifier">Futhark.IR.GPUMem</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.SeqMem.html"><span class="hs-identifier">Futhark.IR.SeqMem</span></a></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-comment">-- | `LastUseMap` tells which names were last used in a given statement.</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- Statements are uniquely identified by the `VName` of the first value</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- parameter in the statement pattern. `Names` is the set of names last used.</span><span>
</span><span id="line-25"></span><span class="hs-keyword">type</span><span> </span><span id="LastUseMap"><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseMap"><span class="hs-identifier hs-var">LastUseMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#Names"><span class="hs-identifier hs-type">Names</span></a></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-comment">-- | `LastUse` is a mapping from a `VName` to the statement identifying it's</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- last use. `LastUseMap` is the inverse of `LastUse`.</span><span>
</span><span id="line-29"></span><span class="hs-keyword">type</span><span> </span><span id="LastUse"><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUse"><span class="hs-identifier hs-var">LastUse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-comment">-- | `Used` is the set of `VName` that were used somewhere in a statement, body</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- or otherwise.</span><span>
</span><span id="line-33"></span><span class="hs-keyword">type</span><span> </span><span id="Used"><span class="annot"><a href="Futhark.Analysis.LastUse.html#Used"><span class="hs-identifier hs-var">Used</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#Names"><span class="hs-identifier hs-type">Names</span></a></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">type</span><span> </span><span id="LastUseOp"><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseOp"><span class="hs-identifier hs-var">LastUseOp</span></a></span></span><span> </span><span id="local-6989586621684449203"><span class="annot"><a href="#local-6989586621684449203"><span class="hs-identifier hs-type">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUse"><span class="hs-identifier hs-type">LastUse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#Used"><span class="hs-identifier hs-type">Used</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Rep.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Aliases.html#Aliases"><span class="hs-identifier hs-type">Aliases</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449203"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseM"><span class="hs-identifier hs-type">LastUseM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449203"><span class="hs-identifier hs-type">rep</span></a></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-keyword">newtype</span><span> </span><span id="Env"><span class="annot"><a href="Futhark.Analysis.LastUse.html#Env"><span class="hs-identifier hs-var">Env</span></a></span></span><span> </span><span id="local-6989586621684449505"><span class="annot"><a href="#local-6989586621684449505"><span class="hs-identifier hs-type">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Env"><span class="annot"><a href="Futhark.Analysis.LastUse.html#Env"><span class="hs-identifier hs-var">Env</span></a></span></span><span> </span><span class="hs-special">{</span><span id="envLastUseOp"><span class="annot"><span class="annottext">forall rep. Env rep -&gt; LastUseOp rep
</span><a href="Futhark.Analysis.LastUse.html#envLastUseOp"><span class="hs-identifier hs-var hs-var">envLastUseOp</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseOp"><span class="hs-identifier hs-type">LastUseOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449505"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">type</span><span> </span><span id="LastUseM"><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseM"><span class="hs-identifier hs-var">LastUseM</span></a></span></span><span> </span><span id="local-6989586621684449200"><span class="annot"><a href="#local-6989586621684449200"><span class="hs-identifier hs-type">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.LastUse.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449200"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUse"><span class="hs-identifier hs-type">LastUse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#Used"><span class="hs-identifier hs-type">Used</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseGPUMem"><span class="hs-identifier hs-type">analyseGPUMem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseMap"><span class="hs-identifier hs-type">LastUseMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#Used"><span class="hs-identifier hs-type">Used</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span id="analyseGPUMem"><span class="annot"><span class="annottext">analyseGPUMem :: Prog GPUMem -&gt; (Map VName Names, Names)
</span><a href="Futhark.Analysis.LastUse.html#analyseGPUMem"><span class="hs-identifier hs-var hs-var">analyseGPUMem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LastUseOp GPUMem -&gt; Prog GPUMem -&gt; (Map VName Names, Names)
forall rep inner.
(CanBeAliased (Op rep), Mem rep inner) =&gt;
LastUseOp rep -&gt; Prog rep -&gt; (Map VName Names, Names)
</span><a href="Futhark.Analysis.LastUse.html#analyseProg"><span class="hs-identifier hs-var">analyseProg</span></a></span><span> </span><span class="annot"><span class="annottext">LastUseOp GPUMem
</span><a href="Futhark.Analysis.LastUse.html#analyseGPUOp"><span class="hs-identifier hs-var">analyseGPUOp</span></a></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseSeqMem"><span class="hs-identifier hs-type">analyseSeqMem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SeqMem.html#SeqMem"><span class="hs-identifier hs-type">SeqMem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseMap"><span class="hs-identifier hs-type">LastUseMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#Used"><span class="hs-identifier hs-type">Used</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span id="analyseSeqMem"><span class="annot"><span class="annottext">analyseSeqMem :: Prog SeqMem -&gt; (Map VName Names, Names)
</span><a href="Futhark.Analysis.LastUse.html#analyseSeqMem"><span class="hs-identifier hs-var hs-var">analyseSeqMem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LastUseOp SeqMem -&gt; Prog SeqMem -&gt; (Map VName Names, Names)
forall rep inner.
(CanBeAliased (Op rep), Mem rep inner) =&gt;
LastUseOp rep -&gt; Prog rep -&gt; (Map VName Names, Names)
</span><a href="Futhark.Analysis.LastUse.html#analyseProg"><span class="hs-identifier hs-var">analyseProg</span></a></span><span> </span><span class="annot"><span class="annottext">LastUseOp SeqMem
</span><a href="Futhark.Analysis.LastUse.html#analyseSeqOp"><span class="hs-identifier hs-var">analyseSeqOp</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseGPUOp"><span class="hs-identifier hs-type">analyseGPUOp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseOp"><span class="hs-identifier hs-type">LastUseOp</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span>
</span><span id="line-49"></span><span id="analyseGPUOp"><span class="annot"><span class="annottext">analyseGPUOp :: LastUseOp GPUMem
</span><a href="Futhark.Analysis.LastUse.html#analyseGPUOp"><span class="hs-identifier hs-var hs-var">analyseGPUOp</span></a></span></span><span> </span><span id="local-6989586621684449196"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684449196"><span class="hs-identifier hs-var">pat_name</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684449195"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449195"><span class="hs-identifier hs-var">lumap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684449194"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449194"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span id="local-6989586621684449192"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684449192"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span id="local-6989586621684449191"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684449191"><span class="hs-identifier hs-var">sp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684449190"><span class="annot"><span class="annottext">nms :: Names
</span><a href="#local-6989586621684449190"><span class="hs-identifier hs-var hs-var">nms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubExp -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684449192"><span class="hs-identifier hs-var">se</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Space -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684449191"><span class="hs-identifier hs-var">sp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#namesSubtract"><span class="hs-operator hs-var">`namesSubtract`</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449194"><span class="hs-identifier hs-var">used</span></a></span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; LastUseM GPUMem
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Names -&gt; LastUse -&gt; LastUse
</span><a href="Futhark.Analysis.LastUse.html#insertNames"><span class="hs-identifier hs-var">insertNames</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684449196"><span class="hs-identifier hs-var">pat_name</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449190"><span class="hs-identifier hs-var">nms</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449195"><span class="hs-identifier hs-var">lumap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449194"><span class="hs-identifier hs-var">used</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449190"><span class="hs-identifier hs-var">nms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseGPUOp"><span class="hs-identifier hs-var">analyseGPUOp</span></a></span><span> </span><span id="local-6989586621684449186"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684449186"><span class="hs-identifier hs-var">pat_name</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684449185"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449185"><span class="hs-identifier hs-var">lumap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684449184"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449184"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Op.html#SizeOp"><span class="hs-identifier hs-type">SizeOp</span></a></span><span> </span><span id="local-6989586621684449181"><span class="annot"><span class="annottext">SizeOp
</span><a href="#local-6989586621684449181"><span class="hs-identifier hs-var">sop</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684449180"><span class="annot"><span class="annottext">nms :: Names
</span><a href="#local-6989586621684449180"><span class="hs-identifier hs-var hs-var">nms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SizeOp -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">SizeOp
</span><a href="#local-6989586621684449181"><span class="hs-identifier hs-var">sop</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#namesSubtract"><span class="hs-operator hs-var">`namesSubtract`</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449184"><span class="hs-identifier hs-var">used</span></a></span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; LastUseM GPUMem
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Names -&gt; LastUse -&gt; LastUse
</span><a href="Futhark.Analysis.LastUse.html#insertNames"><span class="hs-identifier hs-var">insertNames</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684449186"><span class="hs-identifier hs-var">pat_name</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449180"><span class="hs-identifier hs-var">nms</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449185"><span class="hs-identifier hs-var">lumap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449184"><span class="hs-identifier hs-var">used</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449180"><span class="hs-identifier hs-var">nms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseGPUOp"><span class="hs-identifier hs-var">analyseGPUOp</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684449179"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449179"><span class="hs-identifier hs-var">lumap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684449178"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449178"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Op.html#OtherOp"><span class="hs-identifier hs-type">OtherOp</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; LastUseM GPUMem
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449179"><span class="hs-identifier hs-var">lumap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449178"><span class="hs-identifier hs-var">used</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseGPUOp"><span class="hs-identifier hs-var">analyseGPUOp</span></a></span><span> </span><span id="local-6989586621684449176"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684449176"><span class="hs-identifier hs-var">pat_name</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684449175"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449175"><span class="hs-identifier hs-var">lumap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684449174"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449174"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Op.html#SegOp"><span class="hs-identifier hs-type">SegOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.SegOp.html#SegMap"><span class="hs-identifier hs-type">SegMap</span></a></span><span> </span><span id="local-6989586621684449171"><span class="annot"><span class="annottext">SegLevel
</span><a href="#local-6989586621684449171"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="annot"><span class="annottext">SegSpace
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684449170"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684449170"><span class="hs-identifier hs-var">tps</span></a></span></span><span> </span><span id="local-6989586621684449169"><span class="annot"><span class="annottext">KernelBody (Aliases GPUMem)
</span><a href="#local-6989586621684449169"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-58"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684449168"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449168"><span class="hs-identifier hs-var">lumap'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684449167"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449167"><span class="hs-identifier hs-var">used'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; KernelBody (Aliases GPUMem) -&gt; LastUseM GPUMem
forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
(LastUse, Names) -&gt; KernelBody (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseKernelBody"><span class="hs-identifier hs-var">analyseKernelBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449175"><span class="hs-identifier hs-var">lumap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449174"><span class="hs-identifier hs-var">used</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">KernelBody (Aliases GPUMem)
</span><a href="#local-6989586621684449169"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684449165"><span class="annot"><span class="annottext">nms :: Names
</span><a href="#local-6989586621684449165"><span class="hs-identifier hs-var hs-var">nms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SegLevel -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">SegLevel
</span><a href="#local-6989586621684449171"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684449170"><span class="hs-identifier hs-var">tps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#namesSubtract"><span class="hs-operator hs-var">`namesSubtract`</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449167"><span class="hs-identifier hs-var">used'</span></a></span><span>
</span><span id="line-60"></span><span>  </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; LastUseM GPUMem
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Names -&gt; LastUse -&gt; LastUse
</span><a href="Futhark.Analysis.LastUse.html#insertNames"><span class="hs-identifier hs-var">insertNames</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684449176"><span class="hs-identifier hs-var">pat_name</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449165"><span class="hs-identifier hs-var">nms</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449168"><span class="hs-identifier hs-var">lumap'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449167"><span class="hs-identifier hs-var">used'</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449165"><span class="hs-identifier hs-var">nms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseGPUOp"><span class="hs-identifier hs-var">analyseGPUOp</span></a></span><span> </span><span id="local-6989586621684449164"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684449164"><span class="hs-identifier hs-var">pat_name</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684449163"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449163"><span class="hs-identifier hs-var">lumap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684449162"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449162"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Op.html#SegOp"><span class="hs-identifier hs-type">SegOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.SegOp.html#SegRed"><span class="hs-identifier hs-type">SegRed</span></a></span><span> </span><span id="local-6989586621684449160"><span class="annot"><span class="annottext">SegLevel
</span><a href="#local-6989586621684449160"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="annot"><span class="annottext">SegSpace
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684449159"><span class="annot"><span class="annottext">[SegBinOp (Aliases GPUMem)]
</span><a href="#local-6989586621684449159"><span class="hs-identifier hs-var">binops</span></a></span></span><span> </span><span id="local-6989586621684449158"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684449158"><span class="hs-identifier hs-var">tps</span></a></span></span><span> </span><span id="local-6989586621684449157"><span class="annot"><span class="annottext">KernelBody (Aliases GPUMem)
</span><a href="#local-6989586621684449157"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-62"></span><span>  </span><span class="annot"><span class="annottext">VName
-&gt; LastUse
-&gt; Names
-&gt; SegLevel
-&gt; [SegBinOp (Aliases GPUMem)]
-&gt; [Type]
-&gt; KernelBody (Aliases GPUMem)
-&gt; LastUseM GPUMem
forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
VName
-&gt; LastUse
-&gt; Names
-&gt; SegLevel
-&gt; [SegBinOp (Aliases rep)]
-&gt; [Type]
-&gt; KernelBody (Aliases rep)
-&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#segOpHelper"><span class="hs-identifier hs-var">segOpHelper</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684449164"><span class="hs-identifier hs-var">pat_name</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449163"><span class="hs-identifier hs-var">lumap</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449162"><span class="hs-identifier hs-var">used</span></a></span><span> </span><span class="annot"><span class="annottext">SegLevel
</span><a href="#local-6989586621684449160"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">[SegBinOp (Aliases GPUMem)]
</span><a href="#local-6989586621684449159"><span class="hs-identifier hs-var">binops</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684449158"><span class="hs-identifier hs-var">tps</span></a></span><span> </span><span class="annot"><span class="annottext">KernelBody (Aliases GPUMem)
</span><a href="#local-6989586621684449157"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-63"></span><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseGPUOp"><span class="hs-identifier hs-var">analyseGPUOp</span></a></span><span> </span><span id="local-6989586621684449155"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684449155"><span class="hs-identifier hs-var">pat_name</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684449154"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449154"><span class="hs-identifier hs-var">lumap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684449153"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449153"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Op.html#SegOp"><span class="hs-identifier hs-type">SegOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.SegOp.html#SegScan"><span class="hs-identifier hs-type">SegScan</span></a></span><span> </span><span id="local-6989586621684449151"><span class="annot"><span class="annottext">SegLevel
</span><a href="#local-6989586621684449151"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="annot"><span class="annottext">SegSpace
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684449150"><span class="annot"><span class="annottext">[SegBinOp (Aliases GPUMem)]
</span><a href="#local-6989586621684449150"><span class="hs-identifier hs-var">binops</span></a></span></span><span> </span><span id="local-6989586621684449149"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684449149"><span class="hs-identifier hs-var">tps</span></a></span></span><span> </span><span id="local-6989586621684449148"><span class="annot"><span class="annottext">KernelBody (Aliases GPUMem)
</span><a href="#local-6989586621684449148"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><span class="annottext">VName
-&gt; LastUse
-&gt; Names
-&gt; SegLevel
-&gt; [SegBinOp (Aliases GPUMem)]
-&gt; [Type]
-&gt; KernelBody (Aliases GPUMem)
-&gt; LastUseM GPUMem
forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
VName
-&gt; LastUse
-&gt; Names
-&gt; SegLevel
-&gt; [SegBinOp (Aliases rep)]
-&gt; [Type]
-&gt; KernelBody (Aliases rep)
-&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#segOpHelper"><span class="hs-identifier hs-var">segOpHelper</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684449155"><span class="hs-identifier hs-var">pat_name</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449154"><span class="hs-identifier hs-var">lumap</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449153"><span class="hs-identifier hs-var">used</span></a></span><span> </span><span class="annot"><span class="annottext">SegLevel
</span><a href="#local-6989586621684449151"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">[SegBinOp (Aliases GPUMem)]
</span><a href="#local-6989586621684449150"><span class="hs-identifier hs-var">binops</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684449149"><span class="hs-identifier hs-var">tps</span></a></span><span> </span><span class="annot"><span class="annottext">KernelBody (Aliases GPUMem)
</span><a href="#local-6989586621684449148"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-65"></span><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseGPUOp"><span class="hs-identifier hs-var">analyseGPUOp</span></a></span><span> </span><span id="local-6989586621684449147"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684449147"><span class="hs-identifier hs-var">pat_name</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684449146"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449146"><span class="hs-identifier hs-var">lumap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684449145"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449145"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Op.html#SegOp"><span class="hs-identifier hs-type">SegOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.SegOp.html#SegHist"><span class="hs-identifier hs-type">SegHist</span></a></span><span> </span><span id="local-6989586621684449143"><span class="annot"><span class="annottext">SegLevel
</span><a href="#local-6989586621684449143"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="annot"><span class="annottext">SegSpace
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684449142"><span class="annot"><span class="annottext">[HistOp (Aliases GPUMem)]
</span><a href="#local-6989586621684449142"><span class="hs-identifier hs-var">binops</span></a></span></span><span> </span><span id="local-6989586621684449141"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684449141"><span class="hs-identifier hs-var">tps</span></a></span></span><span> </span><span id="local-6989586621684449140"><span class="annot"><span class="annottext">KernelBody (Aliases GPUMem)
</span><a href="#local-6989586621684449140"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684449139"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449139"><span class="hs-identifier hs-var">lumap'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684449138"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449138"><span class="hs-identifier hs-var">used'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((LastUse, Names) -&gt; HistOp (Aliases GPUMem) -&gt; LastUseM GPUMem)
-&gt; (LastUse, Names) -&gt; [HistOp (Aliases GPUMem)] -&gt; LastUseM GPUMem
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; HistOp (Aliases GPUMem) -&gt; LastUseM GPUMem
forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
(LastUse, Names) -&gt; HistOp (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseHistOp"><span class="hs-identifier hs-var">analyseHistOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449146"><span class="hs-identifier hs-var">lumap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449145"><span class="hs-identifier hs-var">used</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([HistOp (Aliases GPUMem)] -&gt; LastUseM GPUMem)
-&gt; [HistOp (Aliases GPUMem)] -&gt; LastUseM GPUMem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[HistOp (Aliases GPUMem)] -&gt; [HistOp (Aliases GPUMem)]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[HistOp (Aliases GPUMem)]
</span><a href="#local-6989586621684449142"><span class="hs-identifier hs-var">binops</span></a></span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684449134"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449134"><span class="hs-identifier hs-var">lumap''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684449133"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449133"><span class="hs-identifier hs-var">used''</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; KernelBody (Aliases GPUMem) -&gt; LastUseM GPUMem
forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
(LastUse, Names) -&gt; KernelBody (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseKernelBody"><span class="hs-identifier hs-var">analyseKernelBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449139"><span class="hs-identifier hs-var">lumap'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449138"><span class="hs-identifier hs-var">used'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">KernelBody (Aliases GPUMem)
</span><a href="#local-6989586621684449140"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684449132"><span class="annot"><span class="annottext">nms :: Names
</span><a href="#local-6989586621684449132"><span class="hs-identifier hs-var hs-var">nms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SegLevel -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">SegLevel
</span><a href="#local-6989586621684449143"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684449141"><span class="hs-identifier hs-var">tps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#namesSubtract"><span class="hs-operator hs-var">`namesSubtract`</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449133"><span class="hs-identifier hs-var">used''</span></a></span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; LastUseM GPUMem
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Names -&gt; LastUse -&gt; LastUse
</span><a href="Futhark.Analysis.LastUse.html#insertNames"><span class="hs-identifier hs-var">insertNames</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684449147"><span class="hs-identifier hs-var">pat_name</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449132"><span class="hs-identifier hs-var">nms</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449134"><span class="hs-identifier hs-var">lumap''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449133"><span class="hs-identifier hs-var">used''</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449132"><span class="hs-identifier hs-var">nms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span id="local-6989586621684449488"><span class="annot"><a href="Futhark.Analysis.LastUse.html#segOpHelper"><span class="hs-identifier hs-type">segOpHelper</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Names.html#FreeIn"><span class="hs-identifier hs-type">FreeIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#OpWithAliases"><span class="hs-identifier hs-type">OpWithAliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Rep.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449488"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.html#ASTRep"><span class="hs-identifier hs-type">ASTRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449488"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUse"><span class="hs-identifier hs-type">LastUse</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#Used"><span class="hs-identifier hs-type">Used</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><a href="Futhark.IR.GPU.Op.html#SegLevel"><span class="hs-identifier hs-type">SegLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.SegOp.html#SegBinOp"><span class="hs-identifier hs-type">SegBinOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Aliases.html#Aliases"><span class="hs-identifier hs-type">Aliases</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449488"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><a href="Futhark.IR.SegOp.html#KernelBody"><span class="hs-identifier hs-type">KernelBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Aliases.html#Aliases"><span class="hs-identifier hs-type">Aliases</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449488"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseM"><span class="hs-identifier hs-type">LastUseM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449488"><span class="hs-identifier hs-type">rep</span></a></span></span><span>
</span><span id="line-81"></span><span id="segOpHelper"><span class="annot"><span class="annottext">segOpHelper :: forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
VName
-&gt; LastUse
-&gt; Names
-&gt; SegLevel
-&gt; [SegBinOp (Aliases rep)]
-&gt; [Type]
-&gt; KernelBody (Aliases rep)
-&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#segOpHelper"><span class="hs-identifier hs-var hs-var">segOpHelper</span></a></span></span><span> </span><span id="local-6989586621684449114"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684449114"><span class="hs-identifier hs-var">pat_name</span></a></span></span><span> </span><span id="local-6989586621684449113"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449113"><span class="hs-identifier hs-var">lumap</span></a></span></span><span> </span><span id="local-6989586621684449112"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449112"><span class="hs-identifier hs-var">used</span></a></span></span><span> </span><span id="local-6989586621684449111"><span class="annot"><span class="annottext">SegLevel
</span><a href="#local-6989586621684449111"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span id="local-6989586621684449110"><span class="annot"><span class="annottext">[SegBinOp (Aliases rep)]
</span><a href="#local-6989586621684449110"><span class="hs-identifier hs-var">binops</span></a></span></span><span> </span><span id="local-6989586621684449109"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684449109"><span class="hs-identifier hs-var">tps</span></a></span></span><span> </span><span id="local-6989586621684449108"><span class="annot"><span class="annottext">KernelBody (Aliases rep)
</span><a href="#local-6989586621684449108"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684449107"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449107"><span class="hs-identifier hs-var">lumap'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684449106"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449106"><span class="hs-identifier hs-var">used'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((LastUse, Names) -&gt; SegBinOp (Aliases rep) -&gt; LastUseM rep)
-&gt; (LastUse, Names) -&gt; [SegBinOp (Aliases rep)] -&gt; LastUseM rep
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; SegBinOp (Aliases rep) -&gt; LastUseM rep
forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
(LastUse, Names) -&gt; SegBinOp (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseSegBinOp"><span class="hs-identifier hs-var">analyseSegBinOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449113"><span class="hs-identifier hs-var">lumap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449112"><span class="hs-identifier hs-var">used</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([SegBinOp (Aliases rep)] -&gt; LastUseM rep)
-&gt; [SegBinOp (Aliases rep)] -&gt; LastUseM rep
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SegBinOp (Aliases rep)] -&gt; [SegBinOp (Aliases rep)]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[SegBinOp (Aliases rep)]
</span><a href="#local-6989586621684449110"><span class="hs-identifier hs-var">binops</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684449104"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449104"><span class="hs-identifier hs-var">lumap''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684449103"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449103"><span class="hs-identifier hs-var">used''</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; KernelBody (Aliases rep) -&gt; LastUseM rep
forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
(LastUse, Names) -&gt; KernelBody (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseKernelBody"><span class="hs-identifier hs-var">analyseKernelBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449107"><span class="hs-identifier hs-var">lumap'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449106"><span class="hs-identifier hs-var">used'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">KernelBody (Aliases rep)
</span><a href="#local-6989586621684449108"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684449102"><span class="annot"><span class="annottext">nms :: Names
</span><a href="#local-6989586621684449102"><span class="hs-identifier hs-var hs-var">nms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SegLevel -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">SegLevel
</span><a href="#local-6989586621684449111"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684449109"><span class="hs-identifier hs-var">tps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#namesSubtract"><span class="hs-operator hs-var">`namesSubtract`</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449103"><span class="hs-identifier hs-var">used''</span></a></span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; LastUseM rep
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Names -&gt; LastUse -&gt; LastUse
</span><a href="Futhark.Analysis.LastUse.html#insertNames"><span class="hs-identifier hs-var">insertNames</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684449114"><span class="hs-identifier hs-var">pat_name</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449102"><span class="hs-identifier hs-var">nms</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449104"><span class="hs-identifier hs-var">lumap''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449103"><span class="hs-identifier hs-var">used''</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449102"><span class="hs-identifier hs-var">nms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseSeqOp"><span class="hs-identifier hs-type">analyseSeqOp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseOp"><span class="hs-identifier hs-type">LastUseOp</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SeqMem.html#SeqMem"><span class="hs-identifier hs-type">SeqMem</span></a></span><span>
</span><span id="line-88"></span><span id="analyseSeqOp"><span class="annot"><span class="annottext">analyseSeqOp :: LastUseOp SeqMem
</span><a href="Futhark.Analysis.LastUse.html#analyseSeqOp"><span class="hs-identifier hs-var hs-var">analyseSeqOp</span></a></span></span><span> </span><span id="local-6989586621684449101"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684449101"><span class="hs-identifier hs-var">pat_name</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684449100"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449100"><span class="hs-identifier hs-var">lumap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684449099"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449099"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span id="local-6989586621684449098"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684449098"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span id="local-6989586621684449097"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684449097"><span class="hs-identifier hs-var">sp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684449096"><span class="annot"><span class="annottext">nms :: Names
</span><a href="#local-6989586621684449096"><span class="hs-identifier hs-var hs-var">nms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubExp -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684449098"><span class="hs-identifier hs-var">se</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Space -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684449097"><span class="hs-identifier hs-var">sp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#namesSubtract"><span class="hs-operator hs-var">`namesSubtract`</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449099"><span class="hs-identifier hs-var">used</span></a></span><span>
</span><span id="line-90"></span><span>  </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; LastUseM SeqMem
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Names -&gt; LastUse -&gt; LastUse
</span><a href="Futhark.Analysis.LastUse.html#insertNames"><span class="hs-identifier hs-var">insertNames</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684449101"><span class="hs-identifier hs-var">pat_name</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449096"><span class="hs-identifier hs-var">nms</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449100"><span class="hs-identifier hs-var">lumap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449099"><span class="hs-identifier hs-var">used</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449096"><span class="hs-identifier hs-var">nms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseSeqOp"><span class="hs-identifier hs-var">analyseSeqOp</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684449095"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449095"><span class="hs-identifier hs-var">lumap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684449094"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449094"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; LastUseM SeqMem
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449095"><span class="hs-identifier hs-var">lumap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449094"><span class="hs-identifier hs-var">used</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-comment">-- | Analyses a program to return a last-use map, mapping each simple statement</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- in the program to the values that were last used within that statement, and</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- the set of all `VName` that were used inside.</span><span>
</span><span id="line-97"></span><span id="local-6989586621684449500"><span id="local-6989586621684449501"><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseProg"><span class="hs-identifier hs-type">analyseProg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#CanBeAliased"><span class="hs-identifier hs-type">CanBeAliased</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Rep.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449501"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449501"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449500"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseOp"><span class="hs-identifier hs-type">LastUseOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449501"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449501"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseMap"><span class="hs-identifier hs-type">LastUseMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#Used"><span class="hs-identifier hs-type">Used</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-98"></span><span id="analyseProg"><span class="annot"><span class="annottext">analyseProg :: forall rep inner.
(CanBeAliased (Op rep), Mem rep inner) =&gt;
LastUseOp rep -&gt; Prog rep -&gt; (Map VName Names, Names)
</span><a href="Futhark.Analysis.LastUse.html#analyseProg"><span class="hs-identifier hs-var hs-var">analyseProg</span></a></span></span><span> </span><span id="local-6989586621684449046"><span class="annot"><span class="annottext">LastUseOp rep
</span><a href="#local-6989586621684449046"><span class="hs-identifier hs-var">onOp</span></a></span></span><span> </span><span id="local-6989586621684449045"><span class="annot"><span class="annottext">Prog rep
</span><a href="#local-6989586621684449045"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><span class="annottext">Reader (Env rep) (Map VName Names, Names)
-&gt; Env rep -&gt; (Map VName Names, Names)
forall r a. Reader r a -&gt; r -&gt; a
</span><span class="hs-identifier hs-var">runReader</span></span><span> </span><span class="annot"><span class="annottext">Reader (Env rep) (Map VName Names, Names)
</span><a href="#local-6989586621684449043"><span class="hs-identifier hs-var">helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUseOp rep -&gt; Env rep
forall rep. LastUseOp rep -&gt; Env rep
</span><a href="Futhark.Analysis.LastUse.html#Env"><span class="hs-identifier hs-var">Env</span></a></span><span> </span><span class="annot"><span class="annottext">LastUseOp rep
</span><a href="#local-6989586621684449046"><span class="hs-identifier hs-var">onOp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-101"></span><span>    </span><span id="local-6989586621684449043"><span class="annot"><span class="annottext">helper :: Reader (Env rep) (Map VName Names, Names)
</span><a href="#local-6989586621684449043"><span class="hs-identifier hs-var hs-var">helper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-102"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684449042"><span class="annot"><span class="annottext">consts :: Names
</span><a href="#local-6989586621684449042"><span class="hs-identifier hs-var hs-var">consts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-103"></span><span>            </span><span class="annot"><span class="annottext">Prog rep -&gt; Stms rep
forall rep. Prog rep -&gt; Stms rep
</span><a href="Futhark.IR.Syntax.html#progConsts"><span class="hs-identifier hs-var hs-var">progConsts</span></a></span><span> </span><span class="annot"><span class="annottext">Prog rep
</span><a href="#local-6989586621684449045"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-104"></span><span>              </span><span class="annot"><span class="annottext">Stms rep -&gt; (Stms rep -&gt; [VName]) -&gt; [VName]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Stm rep -&gt; [VName]) -&gt; Stms rep -&gt; [VName]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[VName] -&gt; [VName]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; [VName]) -&gt; (Stm rep -&gt; [VName]) -&gt; Stm rep -&gt; [VName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PatElemT (LetDec rep) -&gt; VName)
-&gt; [PatElemT (LetDec rep)] -&gt; [VName]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">PatElemT (LetDec rep) -&gt; VName
forall dec. PatElemT dec -&gt; VName
</span><a href="Futhark.IR.Syntax.Core.html#patElemName"><span class="hs-identifier hs-var hs-var">patElemName</span></a></span><span> </span><span class="annot"><span class="annottext">([PatElemT (LetDec rep)] -&gt; [VName])
-&gt; (Stm rep -&gt; [PatElemT (LetDec rep)]) -&gt; Stm rep -&gt; [VName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PatT (LetDec rep) -&gt; [PatElemT (LetDec rep)]
forall dec. PatT dec -&gt; [PatElemT dec]
</span><a href="Futhark.IR.Syntax.html#patElems"><span class="hs-identifier hs-var hs-var">patElems</span></a></span><span> </span><span class="annot"><span class="annottext">(PatT (LetDec rep) -&gt; [PatElemT (LetDec rep)])
-&gt; (Stm rep -&gt; PatT (LetDec rep))
-&gt; Stm rep
-&gt; [PatElemT (LetDec rep)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Stm rep -&gt; PatT (LetDec rep)
forall rep. Stm rep -&gt; Pat rep
</span><a href="Futhark.IR.Syntax.html#stmPat"><span class="hs-identifier hs-var hs-var">stmPat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>              </span><span class="annot"><span class="annottext">[VName] -&gt; ([VName] -&gt; Names) -&gt; Names
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#namesFromList"><span class="hs-identifier hs-var">namesFromList</span></a></span><span>
</span><span id="line-106"></span><span>          </span><span id="local-6989586621684449033"><span class="annot"><span class="annottext">funs :: [FunDef (Aliases rep)]
</span><a href="#local-6989586621684449033"><span class="hs-identifier hs-var hs-var">funs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Prog (Aliases rep) -&gt; [FunDef (Aliases rep)]
forall rep. Prog rep -&gt; [FunDef rep]
</span><a href="Futhark.IR.Syntax.html#progFuns"><span class="hs-identifier hs-var hs-var">progFuns</span></a></span><span> </span><span class="annot"><span class="annottext">(Prog (Aliases rep) -&gt; [FunDef (Aliases rep)])
-&gt; Prog (Aliases rep) -&gt; [FunDef (Aliases rep)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Prog rep -&gt; Prog (Aliases rep)
forall rep.
(ASTRep rep, CanBeAliased (Op rep)) =&gt;
Prog rep -&gt; Prog (Aliases rep)
</span><a href="Futhark.Analysis.Alias.html#aliasAnalysis"><span class="hs-identifier hs-var">aliasAnalysis</span></a></span><span> </span><span class="annot"><span class="annottext">Prog rep
</span><a href="#local-6989586621684449045"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-107"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684449031"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449031"><span class="hs-identifier hs-var">lus</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684449030"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449030"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(LastUse, Names)] -&gt; (LastUse, Names)
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([(LastUse, Names)] -&gt; (LastUse, Names))
-&gt; ReaderT (Env rep) Identity [(LastUse, Names)]
-&gt; ReaderT (Env rep) Identity (LastUse, Names)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(FunDef (Aliases rep)
 -&gt; ReaderT (Env rep) Identity (LastUse, Names))
-&gt; [FunDef (Aliases rep)]
-&gt; ReaderT (Env rep) Identity [(LastUse, Names)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse
-&gt; Names
-&gt; FunDef (Aliases rep)
-&gt; ReaderT (Env rep) Identity (LastUse, Names)
forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
LastUse -&gt; Names -&gt; FunDef (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseFun"><span class="hs-identifier hs-var">analyseFun</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449042"><span class="hs-identifier hs-var">consts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FunDef (Aliases rep)]
</span><a href="#local-6989586621684449033"><span class="hs-identifier hs-var">funs</span></a></span><span>
</span><span id="line-108"></span><span>      </span><span class="annot"><span class="annottext">(Map VName Names, Names)
-&gt; Reader (Env rep) (Map VName Names, Names)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse -&gt; Map VName Names
</span><a href="Futhark.Analysis.LastUse.html#flipMap"><span class="hs-identifier hs-var">flipMap</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449031"><span class="hs-identifier hs-var">lus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449030"><span class="hs-identifier hs-var">used</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span id="local-6989586621684449411"><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseFun"><span class="hs-identifier hs-type">analyseFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Names.html#FreeIn"><span class="hs-identifier hs-type">FreeIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#OpWithAliases"><span class="hs-identifier hs-type">OpWithAliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Rep.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449411"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.html#ASTRep"><span class="hs-identifier hs-type">ASTRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449411"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUse"><span class="hs-identifier hs-type">LastUse</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#Used"><span class="hs-identifier hs-type">Used</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Aliases.html#Aliases"><span class="hs-identifier hs-type">Aliases</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449411"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseM"><span class="hs-identifier hs-type">LastUseM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449411"><span class="hs-identifier hs-type">rep</span></a></span></span><span>
</span><span id="line-111"></span><span id="analyseFun"><span class="annot"><span class="annottext">analyseFun :: forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
LastUse -&gt; Names -&gt; FunDef (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseFun"><span class="hs-identifier hs-var hs-var">analyseFun</span></a></span></span><span> </span><span id="local-6989586621684449009"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449009"><span class="hs-identifier hs-var">lumap</span></a></span></span><span> </span><span id="local-6989586621684449008"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449008"><span class="hs-identifier hs-var">used</span></a></span></span><span> </span><span id="local-6989586621684449007"><span class="annot"><span class="annottext">FunDef (Aliases rep)
</span><a href="#local-6989586621684449007"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684449006"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449006"><span class="hs-identifier hs-var">lumap'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684449005"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449005"><span class="hs-identifier hs-var">used'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LastUse -&gt; Names -&gt; Body (Aliases rep) -&gt; LastUseM rep
forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
LastUse -&gt; Names -&gt; Body (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseBody"><span class="hs-identifier hs-var">analyseBody</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449009"><span class="hs-identifier hs-var">lumap</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449008"><span class="hs-identifier hs-var">used</span></a></span><span> </span><span class="annot"><span class="annottext">(Body (Aliases rep) -&gt; LastUseM rep)
-&gt; Body (Aliases rep) -&gt; LastUseM rep
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FunDef (Aliases rep) -&gt; Body (Aliases rep)
forall rep. FunDef rep -&gt; BodyT rep
</span><a href="Futhark.IR.Syntax.html#funDefBody"><span class="hs-identifier hs-var hs-var">funDefBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef (Aliases rep)
</span><a href="#local-6989586621684449007"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-113"></span><span>  </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; LastUseM rep
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684449006"><span class="hs-identifier hs-var">lumap'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684449005"><span class="hs-identifier hs-var">used'</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Param (FParamInfo rep)] -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef (Aliases rep) -&gt; [FParam (Aliases rep)]
forall rep. FunDef rep -&gt; [FParam rep]
</span><a href="Futhark.IR.Syntax.html#funDefParams"><span class="hs-identifier hs-var hs-var">funDefParams</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef (Aliases rep)
</span><a href="#local-6989586621684449007"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span id="local-6989586621684449400"><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseStms"><span class="hs-identifier hs-type">analyseStms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Names.html#FreeIn"><span class="hs-identifier hs-type">FreeIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#OpWithAliases"><span class="hs-identifier hs-type">OpWithAliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Rep.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449400"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.html#ASTRep"><span class="hs-identifier hs-type">ASTRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449400"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUse"><span class="hs-identifier hs-type">LastUse</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#Used"><span class="hs-identifier hs-type">Used</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Stms"><span class="hs-identifier hs-type">Stms</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Aliases.html#Aliases"><span class="hs-identifier hs-type">Aliases</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449400"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseM"><span class="hs-identifier hs-type">LastUseM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449400"><span class="hs-identifier hs-type">rep</span></a></span></span><span>
</span><span id="line-116"></span><span id="analyseStms"><span class="annot"><span class="annottext">analyseStms :: forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
LastUse -&gt; Names -&gt; Stms (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseStms"><span class="hs-identifier hs-var hs-var">analyseStms</span></a></span></span><span> </span><span id="local-6989586621684448992"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448992"><span class="hs-identifier hs-var">lumap</span></a></span></span><span> </span><span id="local-6989586621684448991"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448991"><span class="hs-identifier hs-var">used</span></a></span></span><span> </span><span id="local-6989586621684448990"><span class="annot"><span class="annottext">Stms (Aliases rep)
</span><a href="#local-6989586621684448990"><span class="hs-identifier hs-var">stms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((LastUse, Names)
 -&gt; Stm (Aliases rep)
 -&gt; ReaderT (Env rep) Identity (LastUse, Names))
-&gt; (LastUse, Names)
-&gt; [Stm (Aliases rep)]
-&gt; ReaderT (Env rep) Identity (LastUse, Names)
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="annot"><span class="annottext">(LastUse, Names)
-&gt; Stm (Aliases rep) -&gt; ReaderT (Env rep) Identity (LastUse, Names)
forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
(LastUse, Names) -&gt; Stm (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseStm"><span class="hs-identifier hs-var">analyseStm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448992"><span class="hs-identifier hs-var">lumap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448991"><span class="hs-identifier hs-var">used</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Stm (Aliases rep)]
 -&gt; ReaderT (Env rep) Identity (LastUse, Names))
-&gt; [Stm (Aliases rep)]
-&gt; ReaderT (Env rep) Identity (LastUse, Names)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Stm (Aliases rep)] -&gt; [Stm (Aliases rep)]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([Stm (Aliases rep)] -&gt; [Stm (Aliases rep)])
-&gt; [Stm (Aliases rep)] -&gt; [Stm (Aliases rep)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Stms (Aliases rep) -&gt; [Stm (Aliases rep)]
forall rep. Stms rep -&gt; [Stm rep]
</span><a href="Futhark.IR.Syntax.html#stmsToList"><span class="hs-identifier hs-var">stmsToList</span></a></span><span> </span><span class="annot"><span class="annottext">Stms (Aliases rep)
</span><a href="#local-6989586621684448990"><span class="hs-identifier hs-var">stms</span></a></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span id="local-6989586621684449398"><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseStm"><span class="hs-identifier hs-type">analyseStm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Names.html#FreeIn"><span class="hs-identifier hs-type">FreeIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#OpWithAliases"><span class="hs-identifier hs-type">OpWithAliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Rep.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449398"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.html#ASTRep"><span class="hs-identifier hs-type">ASTRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449398"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUse"><span class="hs-identifier hs-type">LastUse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#Used"><span class="hs-identifier hs-type">Used</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Stm"><span class="hs-identifier hs-type">Stm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Aliases.html#Aliases"><span class="hs-identifier hs-type">Aliases</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449398"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseM"><span class="hs-identifier hs-type">LastUseM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449398"><span class="hs-identifier hs-type">rep</span></a></span></span><span>
</span><span id="line-119"></span><span id="analyseStm"><span class="annot"><span class="annottext">analyseStm :: forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
(LastUse, Names) -&gt; Stm (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseStm"><span class="hs-identifier hs-var hs-var">analyseStm</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684448893"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448893"><span class="hs-identifier hs-var">lumap0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684448892"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448892"><span class="hs-identifier hs-var">used0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621684448890"><span class="annot"><span class="annottext">Pat (Aliases rep)
</span><a href="#local-6989586621684448890"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="annot"><span class="annottext">StmAux (ExpDec (Aliases rep))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684448889"><span class="annot"><span class="annottext">Exp (Aliases rep)
</span><a href="#local-6989586621684448889"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684448888"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448888"><span class="hs-identifier hs-var">lumap'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684448887"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448887"><span class="hs-identifier hs-var">used'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatT (ConsumedInExp, LetDec rep)
-&gt; [PatElemT (ConsumedInExp, LetDec rep)]
forall dec. PatT dec -&gt; [PatElemT dec]
</span><a href="Futhark.IR.Syntax.html#patElems"><span class="hs-identifier hs-var hs-var">patElems</span></a></span><span> </span><span class="annot"><span class="annottext">PatT (ConsumedInExp, LetDec rep)
Pat (Aliases rep)
</span><a href="#local-6989586621684448890"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">[PatElemT (ConsumedInExp, LetDec rep)]
-&gt; ([PatElemT (ConsumedInExp, LetDec rep)] -&gt; (LastUse, Names))
-&gt; (LastUse, Names)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">((LastUse, Names)
 -&gt; PatElemT (ConsumedInExp, LetDec rep) -&gt; (LastUse, Names))
-&gt; (LastUse, Names)
-&gt; [PatElemT (ConsumedInExp, LetDec rep)]
-&gt; (LastUse, Names)
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">(LastUse, Names)
-&gt; PatElemT (ConsumedInExp, LetDec rep) -&gt; (LastUse, Names)
forall {b}.
(LastUse, Names) -&gt; PatElemT (ConsumedInExp, b) -&gt; (LastUse, Names)
</span><a href="#local-6989586621684448885"><span class="hs-identifier hs-var">helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448893"><span class="hs-identifier hs-var">lumap0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448892"><span class="hs-identifier hs-var">used0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>  </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; Exp (Aliases rep) -&gt; LastUseM rep
</span><a href="#local-6989586621684448884"><span class="hs-identifier hs-var">analyseExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448888"><span class="hs-identifier hs-var">lumap'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448887"><span class="hs-identifier hs-var">used'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp (Aliases rep)
</span><a href="#local-6989586621684448889"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-123"></span><span>    </span><span id="local-6989586621684448885"><span class="annot"><span class="annottext">helper :: (LastUse, Names) -&gt; PatElemT (ConsumedInExp, b) -&gt; (LastUse, Names)
</span><a href="#local-6989586621684448885"><span class="hs-identifier hs-var hs-var">helper</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684448881"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448881"><span class="hs-identifier hs-var">lumap_acc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684448880"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448880"><span class="hs-identifier hs-var">used_acc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#PatElem"><span class="hs-identifier hs-type">PatElem</span></a></span><span> </span><span id="local-6989586621684448878"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684448878"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684448877"><span class="annot"><span class="annottext">ConsumedInExp
</span><a href="#local-6989586621684448877"><span class="hs-identifier hs-var">aliases</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-124"></span><span>      </span><span class="hs-comment">-- Any aliases of `name` should have the same last-use as `name`</span><span>
</span><span id="line-125"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VName -&gt; LastUse -&gt; Maybe VName
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684448878"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448881"><span class="hs-identifier hs-var">lumap_acc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-126"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684448875"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684448875"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-127"></span><span>            </span><span class="annot"><span class="annottext">VName -&gt; Names -&gt; LastUse -&gt; LastUse
</span><a href="Futhark.Analysis.LastUse.html#insertNames"><span class="hs-identifier hs-var">insertNames</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684448875"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConsumedInExp -&gt; Names
</span><a href="Futhark.IR.Aliases.html#unAliases"><span class="hs-identifier hs-var hs-var">unAliases</span></a></span><span> </span><span class="annot"><span class="annottext">ConsumedInExp
</span><a href="#local-6989586621684448877"><span class="hs-identifier hs-var">aliases</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448881"><span class="hs-identifier hs-var">lumap_acc</span></a></span><span>
</span><span id="line-128"></span><span>          </span><span class="annot"><span class="annottext">Maybe VName
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448881"><span class="hs-identifier hs-var">lumap_acc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-129"></span><span>        </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448880"><span class="hs-identifier hs-var">used_acc</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ConsumedInExp -&gt; Names
</span><a href="Futhark.IR.Aliases.html#unAliases"><span class="hs-identifier hs-var hs-var">unAliases</span></a></span><span> </span><span class="annot"><span class="annottext">ConsumedInExp
</span><a href="#local-6989586621684448877"><span class="hs-identifier hs-var">aliases</span></a></span><span>
</span><span id="line-130"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span>    </span><span id="local-6989586621684448873"><span class="annot"><span class="annottext">pat_name :: VName
</span><a href="#local-6989586621684448873"><span class="hs-identifier hs-var hs-var">pat_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatElemT (ConsumedInExp, LetDec rep) -&gt; VName
forall dec. PatElemT dec -&gt; VName
</span><a href="Futhark.IR.Syntax.Core.html#patElemName"><span class="hs-identifier hs-var hs-var">patElemName</span></a></span><span> </span><span class="annot"><span class="annottext">(PatElemT (ConsumedInExp, LetDec rep) -&gt; VName)
-&gt; PatElemT (ConsumedInExp, LetDec rep) -&gt; VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PatElemT (ConsumedInExp, LetDec rep)]
-&gt; PatElemT (ConsumedInExp, LetDec rep)
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">([PatElemT (ConsumedInExp, LetDec rep)]
 -&gt; PatElemT (ConsumedInExp, LetDec rep))
-&gt; [PatElemT (ConsumedInExp, LetDec rep)]
-&gt; PatElemT (ConsumedInExp, LetDec rep)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatT (ConsumedInExp, LetDec rep)
-&gt; [PatElemT (ConsumedInExp, LetDec rep)]
forall dec. PatT dec -&gt; [PatElemT dec]
</span><a href="Futhark.IR.Syntax.html#patElems"><span class="hs-identifier hs-var hs-var">patElems</span></a></span><span> </span><span class="annot"><span class="annottext">PatT (ConsumedInExp, LetDec rep)
Pat (Aliases rep)
</span><a href="#local-6989586621684448890"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621684448884"><span class="annot"><span class="annottext">analyseExp :: (LastUse, Names) -&gt; Exp (Aliases rep) -&gt; LastUseM rep
</span><a href="#local-6989586621684448884"><span class="hs-identifier hs-var hs-var">analyseExp</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684448871"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448871"><span class="hs-identifier hs-var">lumap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684448870"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448870"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-type">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">BasicOp
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-135"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684448868"><span class="annot"><span class="annottext">nms :: Names
</span><a href="#local-6989586621684448868"><span class="hs-identifier hs-var hs-var">nms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp (Aliases rep) -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">Exp (Aliases rep)
</span><a href="#local-6989586621684448889"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#namesSubtract"><span class="hs-operator hs-var">`namesSubtract`</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448870"><span class="hs-identifier hs-var">used</span></a></span><span>
</span><span id="line-136"></span><span>      </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; LastUseM rep
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Names -&gt; LastUse -&gt; LastUse
</span><a href="Futhark.Analysis.LastUse.html#insertNames"><span class="hs-identifier hs-var">insertNames</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684448873"><span class="hs-identifier hs-var">pat_name</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448868"><span class="hs-identifier hs-var">nms</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448871"><span class="hs-identifier hs-var">lumap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448870"><span class="hs-identifier hs-var">used</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448868"><span class="hs-identifier hs-var">nms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>    </span><span class="annot"><a href="#local-6989586621684448884"><span class="hs-identifier hs-var">analyseExp</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684448867"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448867"><span class="hs-identifier hs-var">lumap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684448866"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448866"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684448864"><span class="annot"><span class="annottext">[(SubExp, Diet)]
</span><a href="#local-6989586621684448864"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="annot"><span class="annottext">[RetType (Aliases rep)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(Safety, SrcLoc, [SrcLoc])
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-138"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684448863"><span class="annot"><span class="annottext">nms :: Names
</span><a href="#local-6989586621684448863"><span class="hs-identifier hs-var hs-var">nms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SubExp] -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">([SubExp] -&gt; Names) -&gt; [SubExp] -&gt; Names
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((SubExp, Diet) -&gt; SubExp) -&gt; [(SubExp, Diet)] -&gt; [SubExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(SubExp, Diet) -&gt; SubExp
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(SubExp, Diet)]
</span><a href="#local-6989586621684448864"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-139"></span><span>      </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; LastUseM rep
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Names -&gt; LastUse -&gt; LastUse
</span><a href="Futhark.Analysis.LastUse.html#insertNames"><span class="hs-identifier hs-var">insertNames</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684448873"><span class="hs-identifier hs-var">pat_name</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448863"><span class="hs-identifier hs-var">nms</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448867"><span class="hs-identifier hs-var">lumap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448866"><span class="hs-identifier hs-var">used</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448863"><span class="hs-identifier hs-var">nms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><a href="#local-6989586621684448884"><span class="hs-identifier hs-var">analyseExp</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684448862"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448862"><span class="hs-identifier hs-var">lumap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684448861"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448861"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#If"><span class="hs-identifier hs-type">If</span></a></span><span> </span><span id="local-6989586621684448859"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684448859"><span class="hs-identifier hs-var">cse</span></a></span></span><span> </span><span id="local-6989586621684448858"><span class="annot"><span class="annottext">BodyT (Aliases rep)
</span><a href="#local-6989586621684448858"><span class="hs-identifier hs-var">then_body</span></a></span></span><span> </span><span id="local-6989586621684448857"><span class="annot"><span class="annottext">BodyT (Aliases rep)
</span><a href="#local-6989586621684448857"><span class="hs-identifier hs-var">else_body</span></a></span></span><span> </span><span id="local-6989586621684448856"><span class="annot"><span class="annottext">IfDec (BranchType (Aliases rep))
</span><a href="#local-6989586621684448856"><span class="hs-identifier hs-var">dec</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-141"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684448855"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448855"><span class="hs-identifier hs-var">lumap_then</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684448854"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448854"><span class="hs-identifier hs-var">used_then</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LastUse -&gt; Names -&gt; BodyT (Aliases rep) -&gt; LastUseM rep
forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
LastUse -&gt; Names -&gt; Body (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseBody"><span class="hs-identifier hs-var">analyseBody</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448862"><span class="hs-identifier hs-var">lumap</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448861"><span class="hs-identifier hs-var">used</span></a></span><span> </span><span class="annot"><span class="annottext">BodyT (Aliases rep)
</span><a href="#local-6989586621684448858"><span class="hs-identifier hs-var">then_body</span></a></span><span>
</span><span id="line-142"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684448853"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448853"><span class="hs-identifier hs-var">lumap_else</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684448852"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448852"><span class="hs-identifier hs-var">used_else</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LastUse -&gt; Names -&gt; BodyT (Aliases rep) -&gt; LastUseM rep
forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
LastUse -&gt; Names -&gt; Body (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseBody"><span class="hs-identifier hs-var">analyseBody</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448862"><span class="hs-identifier hs-var">lumap</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448861"><span class="hs-identifier hs-var">used</span></a></span><span> </span><span class="annot"><span class="annottext">BodyT (Aliases rep)
</span><a href="#local-6989586621684448857"><span class="hs-identifier hs-var">else_body</span></a></span><span>
</span><span id="line-143"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684448851"><span class="annot"><span class="annottext">used' :: Names
</span><a href="#local-6989586621684448851"><span class="hs-identifier hs-var hs-var">used'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448854"><span class="hs-identifier hs-var">used_then</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448852"><span class="hs-identifier hs-var">used_else</span></a></span><span>
</span><span id="line-144"></span><span>          </span><span id="local-6989586621684448850"><span class="annot"><span class="annottext">nms :: Names
</span><a href="#local-6989586621684448850"><span class="hs-identifier hs-var hs-var">nms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubExp -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684448859"><span class="hs-identifier hs-var">cse</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">IfDec (BranchType rep) -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">IfDec (BranchType rep)
IfDec (BranchType (Aliases rep))
</span><a href="#local-6989586621684448856"><span class="hs-identifier hs-var">dec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#namesSubtract"><span class="hs-operator hs-var">`namesSubtract`</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448851"><span class="hs-identifier hs-var">used'</span></a></span><span>
</span><span id="line-145"></span><span>      </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; LastUseM rep
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Names -&gt; LastUse -&gt; LastUse
</span><a href="Futhark.Analysis.LastUse.html#insertNames"><span class="hs-identifier hs-var">insertNames</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684448873"><span class="hs-identifier hs-var">pat_name</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448850"><span class="hs-identifier hs-var">nms</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448855"><span class="hs-identifier hs-var">lumap_then</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse -&gt; LastUse -&gt; LastUse
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448853"><span class="hs-identifier hs-var">lumap_else</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448851"><span class="hs-identifier hs-var">used'</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448850"><span class="hs-identifier hs-var">nms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><a href="#local-6989586621684448884"><span class="hs-identifier hs-var">analyseExp</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684448849"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448849"><span class="hs-identifier hs-var">lumap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684448848"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448848"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#DoLoop"><span class="hs-identifier hs-type">DoLoop</span></a></span><span> </span><span id="local-6989586621684448846"><span class="annot"><span class="annottext">[(FParam (Aliases rep), SubExp)]
</span><a href="#local-6989586621684448846"><span class="hs-identifier hs-var">merge</span></a></span></span><span> </span><span id="local-6989586621684448845"><span class="annot"><span class="annottext">LoopForm (Aliases rep)
</span><a href="#local-6989586621684448845"><span class="hs-identifier hs-var">form</span></a></span></span><span> </span><span id="local-6989586621684448844"><span class="annot"><span class="annottext">BodyT (Aliases rep)
</span><a href="#local-6989586621684448844"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-147"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684448843"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448843"><span class="hs-identifier hs-var">lumap'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684448842"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448842"><span class="hs-identifier hs-var">used'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LastUse -&gt; Names -&gt; BodyT (Aliases rep) -&gt; LastUseM rep
forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
LastUse -&gt; Names -&gt; Body (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseBody"><span class="hs-identifier hs-var">analyseBody</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448849"><span class="hs-identifier hs-var">lumap</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448848"><span class="hs-identifier hs-var">used</span></a></span><span> </span><span class="annot"><span class="annottext">BodyT (Aliases rep)
</span><a href="#local-6989586621684448844"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-148"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684448841"><span class="annot"><span class="annottext">nms :: Names
</span><a href="#local-6989586621684448841"><span class="hs-identifier hs-var hs-var">nms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Param (FParamInfo rep), SubExp)] -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">[(Param (FParamInfo rep), SubExp)]
[(FParam (Aliases rep), SubExp)]
</span><a href="#local-6989586621684448846"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">LoopForm (Aliases rep) -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">LoopForm (Aliases rep)
</span><a href="#local-6989586621684448845"><span class="hs-identifier hs-var">form</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#namesSubtract"><span class="hs-operator hs-var">`namesSubtract`</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448842"><span class="hs-identifier hs-var">used'</span></a></span><span>
</span><span id="line-149"></span><span>      </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; LastUseM rep
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Names -&gt; LastUse -&gt; LastUse
</span><a href="Futhark.Analysis.LastUse.html#insertNames"><span class="hs-identifier hs-var">insertNames</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684448873"><span class="hs-identifier hs-var">pat_name</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448841"><span class="hs-identifier hs-var">nms</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448843"><span class="hs-identifier hs-var">lumap'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448842"><span class="hs-identifier hs-var">used'</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448841"><span class="hs-identifier hs-var">nms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><a href="#local-6989586621684448884"><span class="hs-identifier hs-var">analyseExp</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684448840"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448840"><span class="hs-identifier hs-var">lumap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684448839"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448839"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span id="local-6989586621684448837"><span class="annot"><span class="annottext">Op (Aliases rep)
</span><a href="#local-6989586621684448837"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-151"></span><span>      </span><span id="local-6989586621684448836"><span class="annot"><span class="annottext">VName -&gt; (LastUse, Names) -&gt; OpWithAliases (Op rep) -&gt; LastUseM rep
</span><a href="#local-6989586621684448836"><span class="hs-identifier hs-var">onOp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Env rep
 -&gt; VName
 -&gt; (LastUse, Names)
 -&gt; OpWithAliases (Op rep)
 -&gt; LastUseM rep)
-&gt; ReaderT
     (Env rep)
     Identity
     (VName
      -&gt; (LastUse, Names) -&gt; OpWithAliases (Op rep) -&gt; LastUseM rep)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">Env rep
-&gt; VName
-&gt; (LastUse, Names)
-&gt; OpWithAliases (Op rep)
-&gt; LastUseM rep
forall rep. Env rep -&gt; LastUseOp rep
</span><a href="Futhark.Analysis.LastUse.html#envLastUseOp"><span class="hs-identifier hs-var hs-var">envLastUseOp</span></a></span><span>
</span><span id="line-152"></span><span>      </span><span class="annot"><span class="annottext">VName -&gt; (LastUse, Names) -&gt; OpWithAliases (Op rep) -&gt; LastUseM rep
</span><a href="#local-6989586621684448836"><span class="hs-identifier hs-var">onOp</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684448873"><span class="hs-identifier hs-var">pat_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448840"><span class="hs-identifier hs-var">lumap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448839"><span class="hs-identifier hs-var">used</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Op (Aliases rep)
OpWithAliases (Op rep)
</span><a href="#local-6989586621684448837"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><a href="#local-6989586621684448884"><span class="hs-identifier hs-var">analyseExp</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684448834"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448834"><span class="hs-identifier hs-var">lumap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684448833"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448833"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#WithAcc"><span class="hs-identifier hs-type">WithAcc</span></a></span><span> </span><span class="annot"><span class="annottext">[WithAccInput (Aliases rep)]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684448831"><span class="annot"><span class="annottext">Lambda (Aliases rep)
</span><a href="#local-6989586621684448831"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-154"></span><span>      </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; Lambda (Aliases rep) -&gt; LastUseM rep
forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
(LastUse, Names) -&gt; Lambda (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseLambda"><span class="hs-identifier hs-var">analyseLambda</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448834"><span class="hs-identifier hs-var">lumap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448833"><span class="hs-identifier hs-var">used</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Lambda (Aliases rep)
</span><a href="#local-6989586621684448831"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span id="local-6989586621684449404"><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseBody"><span class="hs-identifier hs-type">analyseBody</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Names.html#FreeIn"><span class="hs-identifier hs-type">FreeIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#OpWithAliases"><span class="hs-identifier hs-type">OpWithAliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Rep.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449404"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.html#ASTRep"><span class="hs-identifier hs-type">ASTRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449404"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUse"><span class="hs-identifier hs-type">LastUse</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#Used"><span class="hs-identifier hs-type">Used</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Body"><span class="hs-identifier hs-type">Body</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Aliases.html#Aliases"><span class="hs-identifier hs-type">Aliases</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449404"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseM"><span class="hs-identifier hs-type">LastUseM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449404"><span class="hs-identifier hs-type">rep</span></a></span></span><span>
</span><span id="line-157"></span><span id="analyseBody"><span class="annot"><span class="annottext">analyseBody :: forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
LastUse -&gt; Names -&gt; Body (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseBody"><span class="hs-identifier hs-var hs-var">analyseBody</span></a></span></span><span> </span><span id="local-6989586621684448819"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448819"><span class="hs-identifier hs-var">lumap</span></a></span></span><span> </span><span id="local-6989586621684448818"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448818"><span class="hs-identifier hs-var">used</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Body"><span class="hs-identifier hs-type">Body</span></a></span><span> </span><span class="annot"><span class="annottext">BodyDec (Aliases rep)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684448816"><span class="annot"><span class="annottext">Stms (Aliases rep)
</span><a href="#local-6989586621684448816"><span class="hs-identifier hs-var">stms</span></a></span></span><span> </span><span id="local-6989586621684448815"><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684448815"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684448814"><span class="annot"><span class="annottext">used' :: Names
</span><a href="#local-6989586621684448814"><span class="hs-identifier hs-var hs-var">used'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448818"><span class="hs-identifier hs-var">used</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Result -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684448815"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-159"></span><span>  </span><span class="annot"><span class="annottext">LastUse -&gt; Names -&gt; Stms (Aliases rep) -&gt; LastUseM rep
forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
LastUse -&gt; Names -&gt; Stms (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseStms"><span class="hs-identifier hs-var">analyseStms</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448819"><span class="hs-identifier hs-var">lumap</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448814"><span class="hs-identifier hs-var">used'</span></a></span><span> </span><span class="annot"><span class="annottext">Stms (Aliases rep)
</span><a href="#local-6989586621684448816"><span class="hs-identifier hs-var">stms</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span id="local-6989586621684449490"><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseKernelBody"><span class="hs-identifier hs-type">analyseKernelBody</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Names.html#FreeIn"><span class="hs-identifier hs-type">FreeIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#OpWithAliases"><span class="hs-identifier hs-type">OpWithAliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Rep.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449490"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.html#ASTRep"><span class="hs-identifier hs-type">ASTRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449490"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUse"><span class="hs-identifier hs-type">LastUse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#Used"><span class="hs-identifier hs-type">Used</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><a href="Futhark.IR.SegOp.html#KernelBody"><span class="hs-identifier hs-type">KernelBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Aliases.html#Aliases"><span class="hs-identifier hs-type">Aliases</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449490"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseM"><span class="hs-identifier hs-type">LastUseM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449490"><span class="hs-identifier hs-type">rep</span></a></span></span><span>
</span><span id="line-166"></span><span id="analyseKernelBody"><span class="annot"><span class="annottext">analyseKernelBody :: forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
(LastUse, Names) -&gt; KernelBody (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseKernelBody"><span class="hs-identifier hs-var hs-var">analyseKernelBody</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684448803"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448803"><span class="hs-identifier hs-var">lumap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684448802"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448802"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.SegOp.html#KernelBody"><span class="hs-identifier hs-type">KernelBody</span></a></span><span> </span><span class="annot"><span class="annottext">BodyDec (Aliases rep)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684448800"><span class="annot"><span class="annottext">Stms (Aliases rep)
</span><a href="#local-6989586621684448800"><span class="hs-identifier hs-var">stms</span></a></span></span><span> </span><span id="local-6989586621684448799"><span class="annot"><span class="annottext">[KernelResult]
</span><a href="#local-6989586621684448799"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684448798"><span class="annot"><span class="annottext">used' :: Names
</span><a href="#local-6989586621684448798"><span class="hs-identifier hs-var hs-var">used'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448802"><span class="hs-identifier hs-var">used</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[KernelResult] -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">[KernelResult]
</span><a href="#local-6989586621684448799"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-168"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">LastUse -&gt; Names -&gt; Stms (Aliases rep) -&gt; LastUseM rep
forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
LastUse -&gt; Names -&gt; Stms (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseStms"><span class="hs-identifier hs-var">analyseStms</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448803"><span class="hs-identifier hs-var">lumap</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448798"><span class="hs-identifier hs-var">used'</span></a></span><span> </span><span class="annot"><span class="annottext">Stms (Aliases rep)
</span><a href="#local-6989586621684448800"><span class="hs-identifier hs-var">stms</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span id="local-6989586621684449476"><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseSegBinOp"><span class="hs-identifier hs-type">analyseSegBinOp</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Names.html#FreeIn"><span class="hs-identifier hs-type">FreeIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#OpWithAliases"><span class="hs-identifier hs-type">OpWithAliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Rep.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449476"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.html#ASTRep"><span class="hs-identifier hs-type">ASTRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449476"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUse"><span class="hs-identifier hs-type">LastUse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#Used"><span class="hs-identifier hs-type">Used</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-173"></span><span>  </span><span class="annot"><a href="Futhark.IR.SegOp.html#SegBinOp"><span class="hs-identifier hs-type">SegBinOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Aliases.html#Aliases"><span class="hs-identifier hs-type">Aliases</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449476"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-174"></span><span>  </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseM"><span class="hs-identifier hs-type">LastUseM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449476"><span class="hs-identifier hs-type">rep</span></a></span></span><span>
</span><span id="line-175"></span><span id="analyseSegBinOp"><span class="annot"><span class="annottext">analyseSegBinOp :: forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
(LastUse, Names) -&gt; SegBinOp (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseSegBinOp"><span class="hs-identifier hs-var hs-var">analyseSegBinOp</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684448785"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448785"><span class="hs-identifier hs-var">lumap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684448784"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448784"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.SegOp.html#SegBinOp"><span class="hs-identifier hs-type">SegBinOp</span></a></span><span> </span><span class="annot"><span class="annottext">Commutativity
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684448782"><span class="annot"><span class="annottext">Lambda (Aliases rep)
</span><a href="#local-6989586621684448782"><span class="hs-identifier hs-var">lambda</span></a></span></span><span> </span><span id="local-6989586621684448781"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684448781"><span class="hs-identifier hs-var">neutral</span></a></span></span><span> </span><span id="local-6989586621684448780"><span class="annot"><span class="annottext">ShapeBase SubExp
</span><a href="#local-6989586621684448780"><span class="hs-identifier hs-var">shp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684448779"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448779"><span class="hs-identifier hs-var">lumap'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684448778"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448778"><span class="hs-identifier hs-var">used'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; Lambda (Aliases rep) -&gt; LastUseM rep
forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
(LastUse, Names) -&gt; Lambda (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseLambda"><span class="hs-identifier hs-var">analyseLambda</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448785"><span class="hs-identifier hs-var">lumap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448784"><span class="hs-identifier hs-var">used</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Lambda (Aliases rep)
</span><a href="#local-6989586621684448782"><span class="hs-identifier hs-var">lambda</span></a></span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684448777"><span class="annot"><span class="annottext">nms :: Names
</span><a href="#local-6989586621684448777"><span class="hs-identifier hs-var hs-var">nms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SubExp] -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684448781"><span class="hs-identifier hs-var">neutral</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ShapeBase SubExp -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase SubExp
</span><a href="#local-6989586621684448780"><span class="hs-identifier hs-var">shp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#namesSubtract"><span class="hs-operator hs-var">`namesSubtract`</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448778"><span class="hs-identifier hs-var">used'</span></a></span><span>
</span><span id="line-178"></span><span>  </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; LastUseM rep
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448779"><span class="hs-identifier hs-var">lumap'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448778"><span class="hs-identifier hs-var">used'</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448777"><span class="hs-identifier hs-var">nms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span id="local-6989586621684449482"><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseHistOp"><span class="hs-identifier hs-type">analyseHistOp</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Names.html#FreeIn"><span class="hs-identifier hs-type">FreeIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#OpWithAliases"><span class="hs-identifier hs-type">OpWithAliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Rep.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449482"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.html#ASTRep"><span class="hs-identifier hs-type">ASTRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449482"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-182"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUse"><span class="hs-identifier hs-type">LastUse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#Used"><span class="hs-identifier hs-type">Used</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-183"></span><span>  </span><span class="annot"><a href="Futhark.IR.SegOp.html#HistOp"><span class="hs-identifier hs-type">HistOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Aliases.html#Aliases"><span class="hs-identifier hs-type">Aliases</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449482"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseM"><span class="hs-identifier hs-type">LastUseM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449482"><span class="hs-identifier hs-type">rep</span></a></span></span><span>
</span><span id="line-185"></span><span id="analyseHistOp"><span class="annot"><span class="annottext">analyseHistOp :: forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
(LastUse, Names) -&gt; HistOp (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseHistOp"><span class="hs-identifier hs-var hs-var">analyseHistOp</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684448756"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448756"><span class="hs-identifier hs-var">lumap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684448755"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448755"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.SegOp.html#HistOp"><span class="hs-identifier hs-type">HistOp</span></a></span><span> </span><span id="local-6989586621684448753"><span class="annot"><span class="annottext">ShapeBase SubExp
</span><a href="#local-6989586621684448753"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621684448752"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684448752"><span class="hs-identifier hs-var">race</span></a></span></span><span> </span><span id="local-6989586621684448751"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684448751"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span id="local-6989586621684448750"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684448750"><span class="hs-identifier hs-var">neutral</span></a></span></span><span> </span><span id="local-6989586621684448749"><span class="annot"><span class="annottext">ShapeBase SubExp
</span><a href="#local-6989586621684448749"><span class="hs-identifier hs-var">shp</span></a></span></span><span> </span><span id="local-6989586621684448748"><span class="annot"><span class="annottext">Lambda (Aliases rep)
</span><a href="#local-6989586621684448748"><span class="hs-identifier hs-var">lambda</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684448747"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448747"><span class="hs-identifier hs-var">lumap'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684448746"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448746"><span class="hs-identifier hs-var">used'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; Lambda (Aliases rep) -&gt; LastUseM rep
forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
(LastUse, Names) -&gt; Lambda (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseLambda"><span class="hs-identifier hs-var">analyseLambda</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448756"><span class="hs-identifier hs-var">lumap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448755"><span class="hs-identifier hs-var">used</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Lambda (Aliases rep)
</span><a href="#local-6989586621684448748"><span class="hs-identifier hs-var">lambda</span></a></span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684448745"><span class="annot"><span class="annottext">nms :: Names
</span><a href="#local-6989586621684448745"><span class="hs-identifier hs-var hs-var">nms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-188"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ShapeBase SubExp -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase SubExp
</span><a href="#local-6989586621684448753"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684448752"><span class="hs-identifier hs-var">race</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684448751"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[SubExp] -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684448750"><span class="hs-identifier hs-var">neutral</span></a></span><span>
</span><span id="line-189"></span><span>            </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ShapeBase SubExp -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase SubExp
</span><a href="#local-6989586621684448749"><span class="hs-identifier hs-var">shp</span></a></span><span>
</span><span id="line-190"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>          </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#namesSubtract"><span class="hs-operator hs-var">`namesSubtract`</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448746"><span class="hs-identifier hs-var">used'</span></a></span><span>
</span><span id="line-192"></span><span>  </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; LastUseM rep
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448747"><span class="hs-identifier hs-var">lumap'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448746"><span class="hs-identifier hs-var">used'</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448745"><span class="hs-identifier hs-var">nms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span id="local-6989586621684449349"><span class="annot"><a href="Futhark.Analysis.LastUse.html#analyseLambda"><span class="hs-identifier hs-type">analyseLambda</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Names.html#FreeIn"><span class="hs-identifier hs-type">FreeIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#OpWithAliases"><span class="hs-identifier hs-type">OpWithAliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Rep.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449349"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.html#ASTRep"><span class="hs-identifier hs-type">ASTRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449349"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUse"><span class="hs-identifier hs-type">LastUse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#Used"><span class="hs-identifier hs-type">Used</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Aliases.html#Aliases"><span class="hs-identifier hs-type">Aliases</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449349"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUseM"><span class="hs-identifier hs-type">LastUseM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684449349"><span class="hs-identifier hs-type">rep</span></a></span></span><span>
</span><span id="line-195"></span><span id="analyseLambda"><span class="annot"><span class="annottext">analyseLambda :: forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
(LastUse, Names) -&gt; Lambda (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseLambda"><span class="hs-identifier hs-var hs-var">analyseLambda</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684448728"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448728"><span class="hs-identifier hs-var">lumap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684448727"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448727"><span class="hs-identifier hs-var">used</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span id="local-6989586621684448725"><span class="annot"><span class="annottext">[LParam (Aliases rep)]
</span><a href="#local-6989586621684448725"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621684448724"><span class="annot"><span class="annottext">BodyT (Aliases rep)
</span><a href="#local-6989586621684448724"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621684448723"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684448723"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684448722"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448722"><span class="hs-identifier hs-var">lumap'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684448721"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448721"><span class="hs-identifier hs-var">used'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LastUse -&gt; Names -&gt; BodyT (Aliases rep) -&gt; LastUseM rep
forall rep.
(FreeIn (OpWithAliases (Op rep)), ASTRep rep) =&gt;
LastUse -&gt; Names -&gt; Body (Aliases rep) -&gt; LastUseM rep
</span><a href="Futhark.Analysis.LastUse.html#analyseBody"><span class="hs-identifier hs-var">analyseBody</span></a></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448728"><span class="hs-identifier hs-var">lumap</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448727"><span class="hs-identifier hs-var">used</span></a></span><span> </span><span class="annot"><span class="annottext">BodyT (Aliases rep)
</span><a href="#local-6989586621684448724"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684448720"><span class="annot"><span class="annottext">used'' :: Names
</span><a href="#local-6989586621684448720"><span class="hs-identifier hs-var hs-var">used''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448721"><span class="hs-identifier hs-var">used'</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Param (LParamInfo rep)] -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">[Param (LParamInfo rep)]
[LParam (Aliases rep)]
</span><a href="#local-6989586621684448725"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684448723"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-198"></span><span>  </span><span class="annot"><span class="annottext">(LastUse, Names) -&gt; LastUseM rep
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448722"><span class="hs-identifier hs-var">lumap'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448720"><span class="hs-identifier hs-var">used''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="annot"><a href="Futhark.Analysis.LastUse.html#flipMap"><span class="hs-identifier hs-type">flipMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#Names"><span class="hs-identifier hs-type">Names</span></a></span><span>
</span><span id="line-201"></span><span id="flipMap"><span class="annot"><span class="annottext">flipMap :: LastUse -&gt; Map VName Names
</span><a href="Futhark.Analysis.LastUse.html#flipMap"><span class="hs-identifier hs-var hs-var">flipMap</span></a></span></span><span> </span><span id="local-6989586621684448719"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448719"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-202"></span><span>  </span><span class="annot"><span class="annottext">LastUse -&gt; [(VName, VName)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448719"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><span class="annottext">[(VName, VName)]
-&gt; ([(VName, VName)] -&gt; [(VName, Names)]) -&gt; [(VName, Names)]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">((VName, VName) -&gt; (VName, Names))
-&gt; [(VName, VName)] -&gt; [(VName, Names)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Names, VName) -&gt; (VName, Names)
forall a b. (a, b) -&gt; (b, a)
</span><span class="hs-identifier hs-var">swap</span></span><span> </span><span class="annot"><span class="annottext">((Names, VName) -&gt; (VName, Names))
-&gt; ((VName, VName) -&gt; (Names, VName))
-&gt; (VName, VName)
-&gt; (VName, Names)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Names) -&gt; (VName, VName) -&gt; (Names, VName)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#oneName"><span class="hs-identifier hs-var">oneName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><span class="annottext">[(VName, Names)]
-&gt; ([(VName, Names)] -&gt; Map VName Names) -&gt; Map VName Names
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">((VName, Names) -&gt; Map VName Names -&gt; Map VName Names)
-&gt; Map VName Names -&gt; [(VName, Names)] -&gt; Map VName Names
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(VName -&gt; Names -&gt; Map VName Names -&gt; Map VName Names)
-&gt; (VName, Names) -&gt; Map VName Names -&gt; Map VName Names
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">((VName -&gt; Names -&gt; Map VName Names -&gt; Map VName Names)
 -&gt; (VName, Names) -&gt; Map VName Names -&gt; Map VName Names)
-&gt; (VName -&gt; Names -&gt; Map VName Names -&gt; Map VName Names)
-&gt; (VName, Names)
-&gt; Map VName Names
-&gt; Map VName Names
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; Names -&gt; Names)
-&gt; VName -&gt; Names -&gt; Map VName Names -&gt; Map VName Names
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insertWith</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map VName Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="annot"><a href="Futhark.Analysis.LastUse.html#insertNames"><span class="hs-identifier hs-type">insertNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#Names"><span class="hs-identifier hs-type">Names</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUse"><span class="hs-identifier hs-type">LastUse</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html#LastUse"><span class="hs-identifier hs-type">LastUse</span></a></span><span>
</span><span id="line-207"></span><span id="insertNames"><span class="annot"><span class="annottext">insertNames :: VName -&gt; Names -&gt; LastUse -&gt; LastUse
</span><a href="Futhark.Analysis.LastUse.html#insertNames"><span class="hs-identifier hs-var hs-var">insertNames</span></a></span></span><span> </span><span id="local-6989586621684448712"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684448712"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621684448711"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448711"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span id="local-6989586621684448710"><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448710"><span class="hs-identifier hs-var">lumap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-208"></span><span>  </span><span class="annot"><span class="annottext">(VName -&gt; LastUse -&gt; LastUse) -&gt; LastUse -&gt; [VName] -&gt; LastUse
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(VName -&gt; VName -&gt; LastUse -&gt; LastUse)
-&gt; VName -&gt; VName -&gt; LastUse -&gt; LastUse
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(VName -&gt; VName -&gt; VName) -&gt; VName -&gt; VName -&gt; LastUse -&gt; LastUse
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insertWith</span></span><span> </span><span class="annot"><span class="annottext">((VName -&gt; VName -&gt; VName) -&gt; VName -&gt; VName -&gt; LastUse -&gt; LastUse)
-&gt; (VName -&gt; VName -&gt; VName)
-&gt; VName
-&gt; VName
-&gt; LastUse
-&gt; LastUse
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684448708"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684448708"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684448708"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684448712"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LastUse
</span><a href="#local-6989586621684448710"><span class="hs-identifier hs-var">lumap</span></a></span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; LastUse) -&gt; [VName] -&gt; LastUse
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; [VName]
</span><a href="Futhark.IR.Prop.Names.html#namesToList"><span class="hs-identifier hs-var">namesToList</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684448711"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-209"></span></pre></body></html>