<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span id="local-6989586621684388601"><span id="local-6989586621684388602"></span></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-comment">-- | Building blocks for defining representations where every array</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- is given information about which memory block is it based in, and</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- how array elements map to memory block offsets.</span><span>
</span><span id="line-12"></span><span class="hs-comment">--</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- There are two primary concepts you will need to understand:</span><span>
</span><span id="line-14"></span><span class="hs-comment">--</span><span>
</span><span id="line-15"></span><span class="hs-comment">--  1. Memory blocks, which are Futhark values of type v'Mem'</span><span>
</span><span id="line-16"></span><span class="hs-comment">--     (parametrized with their size).  These correspond to arbitrary</span><span>
</span><span id="line-17"></span><span class="hs-comment">--     blocks of memory, and are created using the 'Alloc' operation.</span><span>
</span><span id="line-18"></span><span class="hs-comment">--</span><span>
</span><span id="line-19"></span><span class="hs-comment">--  2. Index functions, which describe a mapping from the index space</span><span>
</span><span id="line-20"></span><span class="hs-comment">--     of an array (eg. a two-dimensional space for an array of type</span><span>
</span><span id="line-21"></span><span class="hs-comment">--     @[[int]]@) to a one-dimensional offset into a memory block.</span><span>
</span><span id="line-22"></span><span class="hs-comment">--     Thus, index functions describe how arbitrary-dimensional arrays</span><span>
</span><span id="line-23"></span><span class="hs-comment">--     are mapped to the single-dimensional world of memory.</span><span>
</span><span id="line-24"></span><span class="hs-comment">--</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- At a conceptual level, imagine that we have a two-dimensional array</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- @a@ of 32-bit integers, consisting of @n@ rows of @m@ elements</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- each.  This array could be represented in classic row-major format</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- with an index function like the following:</span><span>
</span><span id="line-29"></span><span class="hs-comment">--</span><span>
</span><span id="line-30"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-31"></span><span class="hs-comment">--   f(i,j) = i * m + j</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-33"></span><span class="hs-comment">--</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- When we want to know the location of element @a[2,3]@, we simply</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- call the index function as @f(2,3)@ and obtain @2*m+3@.  We could</span><span>
</span><span id="line-36"></span><span class="hs-comment">-- also have chosen another index function, one that represents the</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- array in column-major (or &quot;transposed&quot;) format:</span><span>
</span><span id="line-38"></span><span class="hs-comment">--</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-40"></span><span class="hs-comment">--   f(i,j) = j * n + i</span><span>
</span><span id="line-41"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-42"></span><span class="hs-comment">--</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- Index functions are not Futhark-level functions, but a special</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- construct that the final code generator will eventually use to</span><span>
</span><span id="line-45"></span><span class="hs-comment">-- generate concrete access code.  By modifying the index functions we</span><span>
</span><span id="line-46"></span><span class="hs-comment">-- can change how an array is represented in memory, which can permit</span><span>
</span><span id="line-47"></span><span class="hs-comment">-- memory access pattern optimisations.</span><span>
</span><span id="line-48"></span><span class="hs-comment">--</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- Every time we bind an array, whether in a @let@-binding, @loop@</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- merge parameter, or @lambda@ parameter, we have an annotation</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- specifying a memory block and an index function.  In some cases,</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- such as @let@-bindings for many expressions, we are free to specify</span><span>
</span><span id="line-53"></span><span class="hs-comment">-- an arbitrary index function and memory block - for example, we get</span><span>
</span><span id="line-54"></span><span class="hs-comment">-- to decide where 'Copy' stores its result - but in other cases the</span><span>
</span><span id="line-55"></span><span class="hs-comment">-- type rules of the expression chooses for us.  For example, 'Index'</span><span>
</span><span id="line-56"></span><span class="hs-comment">-- always produces an array in the same memory block as its input, and</span><span>
</span><span id="line-57"></span><span class="hs-comment">-- with the same index function, except with some indices fixed.</span><span>
</span><span id="line-58"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Futhark.IR.Mem</span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#LetDecMem"><span class="hs-identifier">LetDecMem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#FParamMem"><span class="hs-identifier">FParamMem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#LParamMem"><span class="hs-identifier">LParamMem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#RetTypeMem"><span class="hs-identifier">RetTypeMem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#BranchTypeMem"><span class="hs-identifier">BranchTypeMem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier">MemOp</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#traverseMemOpStms"><span class="hs-identifier">traverseMemOpStms</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier">MemInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBound"><span class="hs-identifier">MemBound</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier">MemBind</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#MemReturn"><span class="hs-identifier">MemReturn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#IxFun"><span class="hs-identifier">IxFun</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#ExtIxFun"><span class="hs-identifier">ExtIxFun</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#isStaticIxFun"><span class="hs-identifier">isStaticIxFun</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#ExpReturns"><span class="hs-identifier">ExpReturns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#BodyReturns"><span class="hs-identifier">BodyReturns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#FunReturns"><span class="hs-identifier">FunReturns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#noUniquenessReturns"><span class="hs-identifier">noUniquenessReturns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#bodyReturnsToExpReturns"><span class="hs-identifier">bodyReturnsToExpReturns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#Mem"><span class="hs-identifier">Mem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#HasLetDecMem"><span class="hs-identifier">HasLetDecMem</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#OpReturns"><span class="hs-identifier">OpReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#varReturns"><span class="hs-identifier">varReturns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#expReturns"><span class="hs-identifier">expReturns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#extReturns"><span class="hs-identifier">extReturns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#lookupMemInfo"><span class="hs-identifier">lookupMemInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#subExpMemInfo"><span class="hs-identifier">subExpMemInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#lookupArraySummary"><span class="hs-identifier">lookupArraySummary</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#existentialiseIxFun"><span class="hs-identifier">existentialiseIxFun</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Type checking parts</span></span><span>
</span><span id="line-90"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#matchBranchReturnType"><span class="hs-identifier">matchBranchReturnType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#matchPatToExp"><span class="hs-identifier">matchPatToExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#matchFunctionReturnType"><span class="hs-identifier">matchFunctionReturnType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#matchLoopResultMem"><span class="hs-identifier">matchLoopResultMem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#bodyReturnsFromPat"><span class="hs-identifier">bodyReturnsFromPat</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#checkMemInfo"><span class="hs-identifier">checkMemInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Module re-exports</span></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.html"><span class="hs-identifier">Futhark.IR.Prop</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Futhark.IR.Traversals.html"><span class="hs-identifier">Futhark.IR.Traversals</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Futhark.IR.Pretty.html"><span class="hs-identifier">Futhark.IR.Pretty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html"><span class="hs-identifier">Futhark.IR.Syntax</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Futhark.Analysis.PrimExp.Convert.html"><span class="hs-identifier">Futhark.Analysis.PrimExp.Convert</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span class="hs-keyword">where</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Category</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">traverse_</span></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&amp;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">elemIndex</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">find</span></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Analysis.Metrics.html"><span class="hs-identifier">Futhark.Analysis.Metrics</span></a></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Analysis.PrimExp.Convert.html"><span class="hs-identifier">Futhark.Analysis.PrimExp.Convert</span></a></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Analysis.PrimExp.Simplify.html"><span class="hs-identifier">Futhark.Analysis.PrimExp.Simplify</span></a></span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.Analysis.SymbolTable.html"><span class="hs-identifier">Futhark.Analysis.SymbolTable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ST</span></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.Aliases.html"><span class="hs-identifier">Futhark.IR.Aliases</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Futhark.IR.Aliases.html#Aliases"><span class="hs-identifier">Aliases</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-121"></span><span>    </span><span class="annot"><a href="Futhark.IR.Aliases.html#removeExpAliases"><span class="hs-identifier">removeExpAliases</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><a href="Futhark.IR.Aliases.html#removePatAliases"><span class="hs-identifier">removePatAliases</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-123"></span><span>    </span><span class="annot"><a href="Futhark.IR.Aliases.html#removeScopeAliases"><span class="hs-identifier">removeScopeAliases</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.IxFun.html"><span class="hs-identifier">Futhark.IR.Mem.IxFun</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IxFun</span></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.Pretty.html"><span class="hs-identifier">Futhark.IR.Pretty</span></a></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.html"><span class="hs-identifier">Futhark.IR.Prop</span></a></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html"><span class="hs-identifier">Futhark.IR.Prop.Aliases</span></a></span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html"><span class="hs-identifier">Futhark.IR.Syntax</span></a></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.Traversals.html"><span class="hs-identifier">Futhark.IR.Traversals</span></a></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.IR.TypeCheck.html"><span class="hs-identifier">Futhark.IR.TypeCheck</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TC</span></span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.Optimise.Simplify.Engine.html"><span class="hs-identifier">Futhark.Optimise.Simplify.Engine</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Engine</span></span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Optimise.Simplify.Rep.html"><span class="hs-identifier">Futhark.Optimise.Simplify.Rep</span></a></span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Transform.Rename.html"><span class="hs-identifier">Futhark.Transform.Rename</span></a></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Transform.Substitute.html"><span class="hs-identifier">Futhark.Transform.Substitute</span></a></span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Util.html"><span class="hs-identifier">Futhark.Util</span></a></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Util.Pretty.html"><span class="hs-identifier">Futhark.Util.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">indent</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ppr</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;+&gt;)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;/&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.Util.Pretty.html"><span class="hs-identifier">Futhark.Util.Pretty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PP</span></span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">id</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.)</span></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-keyword">type</span><span> </span><span id="LetDecMem"><span class="annot"><a href="Futhark.IR.Mem.html#LetDecMem"><span class="hs-identifier hs-var">LetDecMem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-type">NoUniqueness</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier hs-type">MemBind</span></a></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-keyword">type</span><span> </span><span id="FParamMem"><span class="annot"><a href="Futhark.IR.Mem.html#FParamMem"><span class="hs-identifier hs-var">FParamMem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Uniqueness"><span class="hs-identifier hs-type">Uniqueness</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier hs-type">MemBind</span></a></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="hs-keyword">type</span><span> </span><span id="LParamMem"><span class="annot"><a href="Futhark.IR.Mem.html#LParamMem"><span class="hs-identifier hs-var">LParamMem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-type">NoUniqueness</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier hs-type">MemBind</span></a></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-keyword">type</span><span> </span><span id="RetTypeMem"><span class="annot"><a href="Futhark.IR.Mem.html#RetTypeMem"><span class="hs-identifier hs-var">RetTypeMem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#FunReturns"><span class="hs-identifier hs-type">FunReturns</span></a></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="hs-keyword">type</span><span> </span><span id="BranchTypeMem"><span class="annot"><a href="Futhark.IR.Mem.html#BranchTypeMem"><span class="hs-identifier hs-var">BranchTypeMem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#BodyReturns"><span class="hs-identifier hs-type">BodyReturns</span></a></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-comment">-- | The class of pattern element decorators that contain memory</span><span>
</span><span id="line-152"></span><span class="hs-comment">-- information.</span><span>
</span><span id="line-153"></span><span class="hs-keyword">class</span><span> </span><span id="HasLetDecMem"><span class="annot"><a href="Futhark.IR.Mem.html#HasLetDecMem"><span class="hs-identifier hs-var">HasLetDecMem</span></a></span></span><span> </span><span id="local-6989586621684389315"><span class="annot"><a href="#local-6989586621684389315"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-154"></span><span>  </span><span id="letDecMem"><span class="annot"><a href="Futhark.IR.Mem.html#letDecMem"><span class="hs-identifier hs-type">letDecMem</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621684389315"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#LetDecMem"><span class="hs-identifier hs-type">LetDecMem</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#HasLetDecMem"><span class="hs-identifier hs-type">HasLetDecMem</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#LetDecMem"><span class="hs-identifier hs-type">LetDecMem</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-157"></span><span>  </span><span id="local-6989586621684388485"><span class="annot"><span class="annottext">letDecMem :: LetDecMem -&gt; LetDecMem
</span><a href="#local-6989586621684388485"><span class="hs-identifier hs-var hs-var hs-var hs-var">letDecMem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LetDecMem -&gt; LetDecMem
forall {k} (cat :: k -&gt; k -&gt; *) (a :: k). Category cat =&gt; cat a a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span id="local-6989586621684389308"><span id="local-6989586621684389309"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#HasLetDecMem"><span class="hs-identifier hs-type">HasLetDecMem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389309"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#HasLetDecMem"><span class="hs-identifier hs-type">HasLetDecMem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621684389308"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621684389309"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-160"></span><span>  </span><span id="local-6989586621684388478"><span class="annot"><span class="annottext">letDecMem :: (a, b) -&gt; LetDecMem
</span><a href="#local-6989586621684388478"><span class="hs-identifier hs-var hs-var hs-var hs-var">letDecMem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b -&gt; LetDecMem
forall t. HasLetDecMem t =&gt; t -&gt; LetDecMem
</span><a href="Futhark.IR.Mem.html#letDecMem"><span class="hs-identifier hs-var">letDecMem</span></a></span><span> </span><span class="annot"><span class="annottext">(b -&gt; LetDecMem) -&gt; ((a, b) -&gt; b) -&gt; (a, b) -&gt; LetDecMem
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a, b) -&gt; b
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span></span></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="hs-keyword">type</span><span> </span><span id="Mem"><span class="annot"><a href="Futhark.IR.Mem.html#Mem"><span class="hs-identifier hs-var">Mem</span></a></span></span><span> </span><span id="local-6989586621684388476"><span class="annot"><a href="#local-6989586621684388476"><span class="hs-identifier hs-type">rep</span></a></span></span><span> </span><span id="local-6989586621684388475"><span class="annot"><a href="#local-6989586621684388475"><span class="hs-identifier hs-type">inner</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Futhark.IR.Rep.html#FParamInfo"><span class="hs-identifier hs-type">FParamInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388476"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#FParamMem"><span class="hs-identifier hs-type">FParamMem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><a href="Futhark.IR.Rep.html#LParamInfo"><span class="hs-identifier hs-type">LParamInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388476"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#LParamMem"><span class="hs-identifier hs-type">LParamMem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#HasLetDecMem"><span class="hs-identifier hs-type">HasLetDecMem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Rep.html#LetDec"><span class="hs-identifier hs-type">LetDec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388476"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><a href="Futhark.IR.Rep.html#RetType"><span class="hs-identifier hs-type">RetType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388476"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#RetTypeMem"><span class="hs-identifier hs-type">RetTypeMem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><a href="Futhark.IR.Rep.html#BranchType"><span class="hs-identifier hs-type">BranchType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388476"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#BranchTypeMem"><span class="hs-identifier hs-type">BranchTypeMem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><a href="Futhark.IR.Prop.html#ASTRep"><span class="hs-identifier hs-type">ASTRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388476"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-169"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#OpReturns"><span class="hs-identifier hs-type">OpReturns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388475"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-170"></span><span>    </span><span class="annot"><a href="Futhark.IR.Rep.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388476"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier hs-type">MemOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388475"><span class="hs-identifier hs-type">inner</span></a></span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.RetType.html#IsRetType"><span class="hs-identifier hs-type">IsRetType</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#FunReturns"><span class="hs-identifier hs-type">FunReturns</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-174"></span><span>  </span><span id="local-6989586621684388439"><span class="annot"><span class="annottext">primRetType :: PrimType -&gt; FunReturns
</span><a href="Futhark.IR.RetType.html#primRetType"><span class="hs-identifier hs-var hs-var hs-var hs-var">primRetType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; FunReturns
forall d u ret. PrimType -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span><span>
</span><span id="line-175"></span><span>  </span><span id="local-6989586621684388434"><span class="annot"><span class="annottext">applyRetType :: forall dec.
Typed dec =&gt;
[FunReturns]
-&gt; [Param dec] -&gt; [(SubExp, Type)] -&gt; Maybe [FunReturns]
</span><a href="Futhark.IR.RetType.html#applyRetType"><span class="hs-identifier hs-var hs-var hs-var hs-var">applyRetType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FunReturns]
-&gt; [Param dec] -&gt; [(SubExp, Type)] -&gt; Maybe [FunReturns]
forall dec.
Typed dec =&gt;
[FunReturns]
-&gt; [Param dec] -&gt; [(SubExp, Type)] -&gt; Maybe [FunReturns]
</span><a href="Futhark.IR.Mem.html#applyFunReturns"><span class="hs-identifier hs-var">applyFunReturns</span></a></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.RetType.html#IsBodyType"><span class="hs-identifier hs-type">IsBodyType</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#BodyReturns"><span class="hs-identifier hs-type">BodyReturns</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-178"></span><span>  </span><span id="local-6989586621684388403"><span class="annot"><span class="annottext">primBodyType :: PrimType -&gt; BodyReturns
</span><a href="Futhark.IR.RetType.html#primBodyType"><span class="hs-identifier hs-var hs-var hs-var hs-var">primBodyType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; BodyReturns
forall d u ret. PrimType -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="hs-keyword">data</span><span> </span><span id="MemOp"><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier hs-var">MemOp</span></a></span></span><span> </span><span id="local-6989586621684389339"><span class="annot"><a href="#local-6989586621684389339"><span class="hs-identifier hs-type">inner</span></a></span></span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | Allocate a memory block.</span><span>
</span><span id="line-182"></span><span>    </span><span id="Alloc"><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-var">Alloc</span></a></span></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Space"><span class="hs-identifier hs-type">Space</span></a></span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Inner"><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621684389339"><span class="hs-identifier hs-type">inner</span></a></span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684388392"><span id="local-6989586621684388398"><span class="annot"><span class="annottext">MemOp inner -&gt; MemOp inner -&gt; Bool
(MemOp inner -&gt; MemOp inner -&gt; Bool)
-&gt; (MemOp inner -&gt; MemOp inner -&gt; Bool) -&gt; Eq (MemOp inner)
forall inner. Eq inner =&gt; MemOp inner -&gt; MemOp inner -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: MemOp inner -&gt; MemOp inner -&gt; Bool
$c/= :: forall inner. Eq inner =&gt; MemOp inner -&gt; MemOp inner -&gt; Bool
== :: MemOp inner -&gt; MemOp inner -&gt; Bool
$c== :: forall inner. Eq inner =&gt; MemOp inner -&gt; MemOp inner -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684388365"><span id="local-6989586621684388367"><span id="local-6989586621684388370"><span id="local-6989586621684388373"><span id="local-6989586621684388376"><span id="local-6989586621684388381"><span id="local-6989586621684388387"><span class="annot"><span class="annottext">Eq (MemOp inner)
Eq (MemOp inner)
-&gt; (MemOp inner -&gt; MemOp inner -&gt; Ordering)
-&gt; (MemOp inner -&gt; MemOp inner -&gt; Bool)
-&gt; (MemOp inner -&gt; MemOp inner -&gt; Bool)
-&gt; (MemOp inner -&gt; MemOp inner -&gt; Bool)
-&gt; (MemOp inner -&gt; MemOp inner -&gt; Bool)
-&gt; (MemOp inner -&gt; MemOp inner -&gt; MemOp inner)
-&gt; (MemOp inner -&gt; MemOp inner -&gt; MemOp inner)
-&gt; Ord (MemOp inner)
MemOp inner -&gt; MemOp inner -&gt; Bool
MemOp inner -&gt; MemOp inner -&gt; Ordering
MemOp inner -&gt; MemOp inner -&gt; MemOp inner
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall {inner}. Ord inner =&gt; Eq (MemOp inner)
forall inner. Ord inner =&gt; MemOp inner -&gt; MemOp inner -&gt; Bool
forall inner. Ord inner =&gt; MemOp inner -&gt; MemOp inner -&gt; Ordering
forall inner.
Ord inner =&gt;
MemOp inner -&gt; MemOp inner -&gt; MemOp inner
min :: MemOp inner -&gt; MemOp inner -&gt; MemOp inner
$cmin :: forall inner.
Ord inner =&gt;
MemOp inner -&gt; MemOp inner -&gt; MemOp inner
max :: MemOp inner -&gt; MemOp inner -&gt; MemOp inner
$cmax :: forall inner.
Ord inner =&gt;
MemOp inner -&gt; MemOp inner -&gt; MemOp inner
&gt;= :: MemOp inner -&gt; MemOp inner -&gt; Bool
$c&gt;= :: forall inner. Ord inner =&gt; MemOp inner -&gt; MemOp inner -&gt; Bool
&gt; :: MemOp inner -&gt; MemOp inner -&gt; Bool
$c&gt; :: forall inner. Ord inner =&gt; MemOp inner -&gt; MemOp inner -&gt; Bool
&lt;= :: MemOp inner -&gt; MemOp inner -&gt; Bool
$c&lt;= :: forall inner. Ord inner =&gt; MemOp inner -&gt; MemOp inner -&gt; Bool
&lt; :: MemOp inner -&gt; MemOp inner -&gt; Bool
$c&lt; :: forall inner. Ord inner =&gt; MemOp inner -&gt; MemOp inner -&gt; Bool
compare :: MemOp inner -&gt; MemOp inner -&gt; Ordering
$ccompare :: forall inner. Ord inner =&gt; MemOp inner -&gt; MemOp inner -&gt; Ordering
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684388352"><span id="local-6989586621684388354"><span id="local-6989586621684388362"><span class="annot"><span class="annottext">Int -&gt; MemOp inner -&gt; ShowS
[MemOp inner] -&gt; ShowS
MemOp inner -&gt; String
(Int -&gt; MemOp inner -&gt; ShowS)
-&gt; (MemOp inner -&gt; String)
-&gt; ([MemOp inner] -&gt; ShowS)
-&gt; Show (MemOp inner)
forall inner. Show inner =&gt; Int -&gt; MemOp inner -&gt; ShowS
forall inner. Show inner =&gt; [MemOp inner] -&gt; ShowS
forall inner. Show inner =&gt; MemOp inner -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [MemOp inner] -&gt; ShowS
$cshowList :: forall inner. Show inner =&gt; [MemOp inner] -&gt; ShowS
show :: MemOp inner -&gt; String
$cshow :: forall inner. Show inner =&gt; MemOp inner -&gt; String
showsPrec :: Int -&gt; MemOp inner -&gt; ShowS
$cshowsPrec :: forall inner. Show inner =&gt; Int -&gt; MemOp inner -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-comment">-- | A helper for defining 'TraverseOpStms'.</span><span>
</span><span id="line-187"></span><span id="local-6989586621684389275"><span id="local-6989586621684389276"><span id="local-6989586621684389277"><span class="annot"><a href="Futhark.IR.Mem.html#traverseMemOpStms"><span class="hs-identifier hs-type">traverseMemOpStms</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621684389277"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-189"></span><span>  </span><span class="annot"><a href="Futhark.IR.Traversals.html#OpStmsTraverser"><span class="hs-identifier hs-type">OpStmsTraverser</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389277"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389276"><span class="hs-identifier hs-type">inner</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389275"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-190"></span><span>  </span><span class="annot"><a href="Futhark.IR.Traversals.html#OpStmsTraverser"><span class="hs-identifier hs-type">OpStmsTraverser</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389277"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier hs-type">MemOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389276"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621684389275"><span class="hs-identifier hs-type">rep</span></a></span></span></span></span><span>
</span><span id="line-191"></span><span id="traverseMemOpStms"><span class="annot"><span class="annottext">traverseMemOpStms :: forall (m :: * -&gt; *) inner rep.
Monad m =&gt;
OpStmsTraverser m inner rep -&gt; OpStmsTraverser m (MemOp inner) rep
</span><a href="Futhark.IR.Mem.html#traverseMemOpStms"><span class="hs-identifier hs-var hs-var">traverseMemOpStms</span></a></span></span><span> </span><span class="annot"><span class="annottext">OpStmsTraverser m inner rep
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Scope rep -&gt; Stms rep -&gt; m (Stms rep)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684388343"><span class="annot"><span class="annottext">op :: MemOp inner
</span><a href="#local-6989586621684388343"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MemOp inner -&gt; m (MemOp inner)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">MemOp inner
</span><a href="#local-6989586621684388343"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-192"></span><span class="annot"><a href="Futhark.IR.Mem.html#traverseMemOpStms"><span class="hs-identifier hs-var">traverseMemOpStms</span></a></span><span> </span><span id="local-6989586621684388342"><span class="annot"><span class="annottext">OpStmsTraverser m inner rep
</span><a href="#local-6989586621684388342"><span class="hs-identifier hs-var">onInner</span></a></span></span><span> </span><span id="local-6989586621684388341"><span class="annot"><span class="annottext">Scope rep -&gt; Stms rep -&gt; m (Stms rep)
</span><a href="#local-6989586621684388341"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621684388340"><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388340"><span class="hs-identifier hs-var">inner</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">inner -&gt; MemOp inner
forall inner. inner -&gt; MemOp inner
</span><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">(inner -&gt; MemOp inner) -&gt; m inner -&gt; m (MemOp inner)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">OpStmsTraverser m inner rep
</span><a href="#local-6989586621684388342"><span class="hs-identifier hs-var">onInner</span></a></span><span> </span><span class="annot"><span class="annottext">Scope rep -&gt; Stms rep -&gt; m (Stms rep)
</span><a href="#local-6989586621684388341"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388340"><span class="hs-identifier hs-var">inner</span></a></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span id="local-6989586621684389258"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#FreeIn"><span class="hs-identifier hs-type">FreeIn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389258"><span class="hs-identifier hs-type">inner</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#FreeIn"><span class="hs-identifier hs-type">FreeIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier hs-type">MemOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389258"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-195"></span><span>  </span><span id="local-6989586621684388331"><span class="annot"><span class="annottext">freeIn' :: MemOp inner -&gt; FV
</span><a href="Futhark.IR.Prop.Names.html#freeIn%27"><span class="hs-identifier hs-var hs-var hs-var hs-var">freeIn'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span id="local-6989586621684388329"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684388329"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; FV
forall a. FreeIn a =&gt; a -&gt; FV
</span><a href="Futhark.IR.Prop.Names.html#freeIn%27"><span class="hs-identifier hs-var">freeIn'</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684388329"><span class="hs-identifier hs-var">size</span></a></span><span>
</span><span id="line-196"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#freeIn%27"><span class="hs-identifier hs-var">freeIn'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621684388328"><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388328"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">inner -&gt; FV
forall a. FreeIn a =&gt; a -&gt; FV
</span><a href="Futhark.IR.Prop.Names.html#freeIn%27"><span class="hs-identifier hs-var">freeIn'</span></a></span><span> </span><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388328"><span class="hs-identifier hs-var">k</span></a></span></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span id="local-6989586621684389250"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.TypeOf.html#TypedOp"><span class="hs-identifier hs-type">TypedOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389250"><span class="hs-identifier hs-type">inner</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.TypeOf.html#TypedOp"><span class="hs-identifier hs-type">TypedOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier hs-type">MemOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389250"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-199"></span><span>  </span><span id="local-6989586621684388317"><span class="annot"><span class="annottext">opType :: forall t (m :: * -&gt; *). HasScope t m =&gt; MemOp inner -&gt; m [ExtType]
</span><a href="Futhark.IR.Prop.TypeOf.html#opType"><span class="hs-identifier hs-var hs-var hs-var hs-var">opType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684388315"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684388315"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ExtType] -&gt; m [ExtType]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Space -&gt; ExtType
forall shape u. Space -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Mem"><span class="hs-identifier hs-var">Mem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684388315"><span class="hs-identifier hs-var">space</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-200"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.TypeOf.html#opType"><span class="hs-identifier hs-var">opType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621684388313"><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388313"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">inner -&gt; m [ExtType]
forall op t (m :: * -&gt; *).
(TypedOp op, HasScope t m) =&gt;
op -&gt; m [ExtType]
</span><a href="Futhark.IR.Prop.TypeOf.html#opType"><span class="hs-identifier hs-var">opType</span></a></span><span> </span><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388313"><span class="hs-identifier hs-var">k</span></a></span></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span id="local-6989586621684389237"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#AliasedOp"><span class="hs-identifier hs-type">AliasedOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389237"><span class="hs-identifier hs-type">inner</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#AliasedOp"><span class="hs-identifier hs-type">AliasedOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier hs-type">MemOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389237"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-203"></span><span>  </span><span id="local-6989586621684388299"><span class="annot"><span class="annottext">opAliases :: MemOp inner -&gt; [Names]
</span><a href="Futhark.IR.Prop.Aliases.html#opAliases"><span class="hs-identifier hs-var hs-var hs-var hs-var">opAliases</span></a></span></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">]</span><span>
</span><span id="line-204"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#opAliases"><span class="hs-identifier hs-var">opAliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621684388297"><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388297"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">inner -&gt; [Names]
forall op. AliasedOp op =&gt; op -&gt; [Names]
</span><a href="Futhark.IR.Prop.Aliases.html#opAliases"><span class="hs-identifier hs-var">opAliases</span></a></span><span> </span><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388297"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span>  </span><span id="local-6989586621684388294"><span class="annot"><span class="annottext">consumedInOp :: MemOp inner -&gt; Names
</span><a href="Futhark.IR.Prop.Aliases.html#consumedInOp"><span class="hs-identifier hs-var hs-var hs-var hs-var">consumedInOp</span></a></span></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-207"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#consumedInOp"><span class="hs-identifier hs-var">consumedInOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621684388292"><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388292"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">inner -&gt; Names
forall op. AliasedOp op =&gt; op -&gt; Names
</span><a href="Futhark.IR.Prop.Aliases.html#consumedInOp"><span class="hs-identifier hs-var">consumedInOp</span></a></span><span> </span><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388292"><span class="hs-identifier hs-var">k</span></a></span></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span id="local-6989586621684389230"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#CanBeAliased"><span class="hs-identifier hs-type">CanBeAliased</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389230"><span class="hs-identifier hs-type">inner</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#CanBeAliased"><span class="hs-identifier hs-type">CanBeAliased</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier hs-type">MemOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389230"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="OpWithAliases"><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#OpWithAliases"><span class="hs-identifier hs-var">OpWithAliases</span></a></span></span><span> </span><span id="local-6989586621684389230"><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier hs-type">MemOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389230"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier hs-type">MemOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#OpWithAliases"><span class="hs-identifier hs-type">OpWithAliases</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389230"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>  </span><span id="local-6989586621684388279"><span class="annot"><span class="annottext">removeOpAliases :: OpWithAliases (MemOp inner) -&gt; MemOp inner
</span><a href="Futhark.IR.Prop.Aliases.html#removeOpAliases"><span class="hs-identifier hs-var hs-var hs-var hs-var">removeOpAliases</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span id="local-6989586621684388277"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684388277"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span id="local-6989586621684388276"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684388276"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; Space -&gt; MemOp inner
forall inner. SubExp -&gt; Space -&gt; MemOp inner
</span><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-var">Alloc</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684388277"><span class="hs-identifier hs-var">se</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684388276"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-212"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#removeOpAliases"><span class="hs-identifier hs-var">removeOpAliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621684388275"><span class="annot"><span class="annottext">OpWithAliases inner
</span><a href="#local-6989586621684388275"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">inner -&gt; MemOp inner
forall inner. inner -&gt; MemOp inner
</span><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">(inner -&gt; MemOp inner) -&gt; inner -&gt; MemOp inner
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OpWithAliases inner -&gt; inner
forall op. CanBeAliased op =&gt; OpWithAliases op -&gt; op
</span><a href="Futhark.IR.Prop.Aliases.html#removeOpAliases"><span class="hs-identifier hs-var">removeOpAliases</span></a></span><span> </span><span class="annot"><span class="annottext">OpWithAliases inner
</span><a href="#local-6989586621684388275"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span>  </span><span id="local-6989586621684388273"><span class="annot"><span class="annottext">addOpAliases :: AliasTable -&gt; MemOp inner -&gt; OpWithAliases (MemOp inner)
</span><a href="Futhark.IR.Prop.Aliases.html#addOpAliases"><span class="hs-identifier hs-var hs-var hs-var hs-var">addOpAliases</span></a></span></span><span> </span><span class="annot"><span class="annottext">AliasTable
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span id="local-6989586621684388271"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684388271"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span id="local-6989586621684388270"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684388270"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; Space -&gt; MemOp (OpWithAliases inner)
forall inner. SubExp -&gt; Space -&gt; MemOp inner
</span><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-var">Alloc</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684388271"><span class="hs-identifier hs-var">se</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684388270"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-215"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#addOpAliases"><span class="hs-identifier hs-var">addOpAliases</span></a></span><span> </span><span id="local-6989586621684388269"><span class="annot"><span class="annottext">AliasTable
</span><a href="#local-6989586621684388269"><span class="hs-identifier hs-var">aliases</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621684388268"><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388268"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpWithAliases inner -&gt; MemOp (OpWithAliases inner)
forall inner. inner -&gt; MemOp inner
</span><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">(OpWithAliases inner -&gt; MemOp (OpWithAliases inner))
-&gt; OpWithAliases inner -&gt; MemOp (OpWithAliases inner)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AliasTable -&gt; inner -&gt; OpWithAliases inner
forall op. CanBeAliased op =&gt; AliasTable -&gt; op -&gt; OpWithAliases op
</span><a href="Futhark.IR.Prop.Aliases.html#addOpAliases"><span class="hs-identifier hs-var">addOpAliases</span></a></span><span> </span><span class="annot"><span class="annottext">AliasTable
</span><a href="#local-6989586621684388269"><span class="hs-identifier hs-var">aliases</span></a></span><span> </span><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388268"><span class="hs-identifier hs-var">k</span></a></span></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span id="local-6989586621684389222"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.Transform.Rename.html#Rename"><span class="hs-identifier hs-type">Rename</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389222"><span class="hs-identifier hs-type">inner</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.Transform.Rename.html#Rename"><span class="hs-identifier hs-type">Rename</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier hs-type">MemOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389222"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-218"></span><span>  </span><span id="local-6989586621684388254"><span class="annot"><span class="annottext">rename :: MemOp inner -&gt; RenameM (MemOp inner)
</span><a href="Futhark.Transform.Rename.html#rename"><span class="hs-identifier hs-var hs-var hs-var hs-var">rename</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span id="local-6989586621684388252"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684388252"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span id="local-6989586621684388251"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684388251"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; Space -&gt; MemOp inner
forall inner. SubExp -&gt; Space -&gt; MemOp inner
</span><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-var">Alloc</span></a></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; Space -&gt; MemOp inner)
-&gt; RenameM SubExp -&gt; RenameM (Space -&gt; MemOp inner)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; RenameM SubExp
forall a. Rename a =&gt; a -&gt; RenameM a
</span><a href="Futhark.Transform.Rename.html#rename"><span class="hs-identifier hs-var">rename</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684388252"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">RenameM (Space -&gt; MemOp inner)
-&gt; RenameM Space -&gt; RenameM (MemOp inner)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Space -&gt; RenameM Space
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684388251"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-219"></span><span>  </span><span class="annot"><a href="Futhark.Transform.Rename.html#rename"><span class="hs-identifier hs-var">rename</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621684388250"><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388250"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">inner -&gt; MemOp inner
forall inner. inner -&gt; MemOp inner
</span><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">(inner -&gt; MemOp inner) -&gt; RenameM inner -&gt; RenameM (MemOp inner)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">inner -&gt; RenameM inner
forall a. Rename a =&gt; a -&gt; RenameM a
</span><a href="Futhark.Transform.Rename.html#rename"><span class="hs-identifier hs-var">rename</span></a></span><span> </span><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388250"><span class="hs-identifier hs-var">k</span></a></span></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span id="local-6989586621684389215"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.Transform.Substitute.html#Substitute"><span class="hs-identifier hs-type">Substitute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389215"><span class="hs-identifier hs-type">inner</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.Transform.Substitute.html#Substitute"><span class="hs-identifier hs-type">Substitute</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier hs-type">MemOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389215"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-222"></span><span>  </span><span id="local-6989586621684388242"><span class="annot"><span class="annottext">substituteNames :: Map VName VName -&gt; MemOp inner -&gt; MemOp inner
</span><a href="Futhark.Transform.Substitute.html#substituteNames"><span class="hs-identifier hs-var hs-var hs-var hs-var">substituteNames</span></a></span></span><span> </span><span id="local-6989586621684388240"><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684388240"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span id="local-6989586621684388239"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684388239"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span id="local-6989586621684388238"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684388238"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; Space -&gt; MemOp inner
forall inner. SubExp -&gt; Space -&gt; MemOp inner
</span><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-var">Alloc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map VName VName -&gt; SubExp -&gt; SubExp
forall a. Substitute a =&gt; Map VName VName -&gt; a -&gt; a
</span><a href="Futhark.Transform.Substitute.html#substituteNames"><span class="hs-identifier hs-var">substituteNames</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684388240"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684388239"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684388238"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-223"></span><span>  </span><span class="annot"><a href="Futhark.Transform.Substitute.html#substituteNames"><span class="hs-identifier hs-var">substituteNames</span></a></span><span> </span><span id="local-6989586621684388237"><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684388237"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621684388236"><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388236"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">inner -&gt; MemOp inner
forall inner. inner -&gt; MemOp inner
</span><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">(inner -&gt; MemOp inner) -&gt; inner -&gt; MemOp inner
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map VName VName -&gt; inner -&gt; inner
forall a. Substitute a =&gt; Map VName VName -&gt; a -&gt; a
</span><a href="Futhark.Transform.Substitute.html#substituteNames"><span class="hs-identifier hs-var">substituteNames</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684388237"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388236"><span class="hs-identifier hs-var">k</span></a></span></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span id="local-6989586621684389212"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621684388231"><span id="local-6989586621684388233"><span class="annot"><span class="hs-identifier hs-type">PP.Pretty</span></span><span> </span><span class="annot"><a href="#local-6989586621684389212"><span class="hs-identifier hs-type">inner</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PP.Pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier hs-type">MemOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389212"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-226"></span><span>  </span><span id="local-6989586621684388220"><span class="annot"><span class="annottext">ppr :: MemOp inner -&gt; Doc
</span><a href="#local-6989586621684388220"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span id="local-6989586621684388219"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684388219"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="Futhark.IR.Syntax.Core.html#DefaultSpace"><span class="hs-identifier hs-var">DefaultSpace</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc
</span><span class="hs-identifier hs-var">PP.text</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;alloc&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
</span><a href="Futhark.Util.Pretty.html#apply"><span class="hs-identifier hs-var">PP.apply</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SubExp -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">PP.ppr</span></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684388219"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-227"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span id="local-6989586621684388216"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684388216"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684388215"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684388215"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc
</span><span class="hs-identifier hs-var">PP.text</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;alloc&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Doc] -&gt; Doc
</span><a href="Futhark.Util.Pretty.html#apply"><span class="hs-identifier hs-var">PP.apply</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SubExp -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">PP.ppr</span></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684388216"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Space -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">PP.ppr</span></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684388215"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-228"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621684388214"><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388214"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">inner -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">PP.ppr</span></span><span> </span><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388214"><span class="hs-identifier hs-var">k</span></a></span></span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span id="local-6989586621684389206"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.Analysis.Metrics.html#OpMetrics"><span class="hs-identifier hs-type">OpMetrics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389206"><span class="hs-identifier hs-type">inner</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.Metrics.html#OpMetrics"><span class="hs-identifier hs-type">OpMetrics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier hs-type">MemOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389206"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-231"></span><span>  </span><span id="local-6989586621684388206"><span class="annot"><span class="annottext">opMetrics :: MemOp inner -&gt; MetricsM ()
</span><a href="Futhark.Analysis.Metrics.html#opMetrics"><span class="hs-identifier hs-var hs-var hs-var hs-var">opMetrics</span></a></span></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; MetricsM ()
</span><a href="Futhark.Analysis.Metrics.html#seen"><span class="hs-identifier hs-var">seen</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Alloc&quot;</span></span><span>
</span><span id="line-232"></span><span>  </span><span class="annot"><a href="Futhark.Analysis.Metrics.html#opMetrics"><span class="hs-identifier hs-var">opMetrics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621684388203"><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388203"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">inner -&gt; MetricsM ()
forall op. OpMetrics op =&gt; op -&gt; MetricsM ()
</span><a href="Futhark.Analysis.Metrics.html#opMetrics"><span class="hs-identifier hs-var">opMetrics</span></a></span><span> </span><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388203"><span class="hs-identifier hs-var">k</span></a></span></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span id="local-6989586621684389238"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.html#IsOp"><span class="hs-identifier hs-type">IsOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389238"><span class="hs-identifier hs-type">inner</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.html#IsOp"><span class="hs-identifier hs-type">IsOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier hs-type">MemOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389238"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-235"></span><span>  </span><span id="local-6989586621684388164"><span class="annot"><span class="annottext">safeOp :: MemOp inner -&gt; Bool
</span><a href="Futhark.IR.Prop.html#safeOp"><span class="hs-identifier hs-var hs-var hs-var hs-var">safeOp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntValue"><span class="hs-identifier hs-type">IntValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#Int64Value"><span class="hs-identifier hs-type">Int64Value</span></a></span><span> </span><span id="local-6989586621684388159"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621684388159"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621684388159"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Int64 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">0</span></span><span>
</span><span id="line-236"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.html#safeOp"><span class="hs-identifier hs-var">safeOp</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-237"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.html#safeOp"><span class="hs-identifier hs-var">safeOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621684388158"><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388158"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">inner -&gt; Bool
forall op. IsOp op =&gt; op -&gt; Bool
</span><a href="Futhark.IR.Prop.html#safeOp"><span class="hs-identifier hs-var">safeOp</span></a></span><span> </span><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388158"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-238"></span><span>  </span><span id="local-6989586621684388156"><span class="annot"><span class="annottext">cheapOp :: MemOp inner -&gt; Bool
</span><a href="Futhark.IR.Prop.html#cheapOp"><span class="hs-identifier hs-var hs-var hs-var hs-var">cheapOp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621684388154"><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388154"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">inner -&gt; Bool
forall op. IsOp op =&gt; op -&gt; Bool
</span><a href="Futhark.IR.Prop.html#cheapOp"><span class="hs-identifier hs-var">cheapOp</span></a></span><span> </span><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388154"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-239"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.html#cheapOp"><span class="hs-identifier hs-var">cheapOp</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span id="local-6989586621684389188"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.Optimise.Simplify.Rep.html#CanBeWise"><span class="hs-identifier hs-type">CanBeWise</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389188"><span class="hs-identifier hs-type">inner</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.Optimise.Simplify.Rep.html#CanBeWise"><span class="hs-identifier hs-type">CanBeWise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier hs-type">MemOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389188"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="OpWithWisdom"><span class="annot"><a href="Futhark.Optimise.Simplify.Rep.html#OpWithWisdom"><span class="hs-identifier hs-var">OpWithWisdom</span></a></span></span><span> </span><span id="local-6989586621684389188"><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier hs-type">MemOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389188"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier hs-type">MemOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Optimise.Simplify.Rep.html#OpWithWisdom"><span class="hs-identifier hs-type">OpWithWisdom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389188"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>  </span><span id="local-6989586621684388135"><span class="annot"><span class="annottext">removeOpWisdom :: OpWithWisdom (MemOp inner) -&gt; MemOp inner
</span><a href="Futhark.Optimise.Simplify.Rep.html#removeOpWisdom"><span class="hs-identifier hs-var hs-var hs-var hs-var">removeOpWisdom</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span id="local-6989586621684388133"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684388133"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span id="local-6989586621684388132"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684388132"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; Space -&gt; MemOp inner
forall inner. SubExp -&gt; Space -&gt; MemOp inner
</span><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-var">Alloc</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684388133"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684388132"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-244"></span><span>  </span><span class="annot"><a href="Futhark.Optimise.Simplify.Rep.html#removeOpWisdom"><span class="hs-identifier hs-var">removeOpWisdom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621684388131"><span class="annot"><span class="annottext">OpWithWisdom inner
</span><a href="#local-6989586621684388131"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">inner -&gt; MemOp inner
forall inner. inner -&gt; MemOp inner
</span><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">(inner -&gt; MemOp inner) -&gt; inner -&gt; MemOp inner
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OpWithWisdom inner -&gt; inner
forall op. CanBeWise op =&gt; OpWithWisdom op -&gt; op
</span><a href="Futhark.Optimise.Simplify.Rep.html#removeOpWisdom"><span class="hs-identifier hs-var">removeOpWisdom</span></a></span><span> </span><span class="annot"><span class="annottext">OpWithWisdom inner
</span><a href="#local-6989586621684388131"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-245"></span><span>  </span><span id="local-6989586621684388129"><span class="annot"><span class="annottext">addOpWisdom :: MemOp inner -&gt; OpWithWisdom (MemOp inner)
</span><a href="Futhark.Optimise.Simplify.Rep.html#addOpWisdom"><span class="hs-identifier hs-var hs-var hs-var hs-var">addOpWisdom</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span id="local-6989586621684388127"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684388127"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span id="local-6989586621684388126"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684388126"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; Space -&gt; MemOp (OpWithWisdom inner)
forall inner. SubExp -&gt; Space -&gt; MemOp inner
</span><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-var">Alloc</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684388127"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684388126"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-246"></span><span>  </span><span class="annot"><a href="Futhark.Optimise.Simplify.Rep.html#addOpWisdom"><span class="hs-identifier hs-var">addOpWisdom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621684388125"><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388125"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpWithWisdom inner -&gt; MemOp (OpWithWisdom inner)
forall inner. inner -&gt; MemOp inner
</span><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">(OpWithWisdom inner -&gt; MemOp (OpWithWisdom inner))
-&gt; OpWithWisdom inner -&gt; MemOp (OpWithWisdom inner)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">inner -&gt; OpWithWisdom inner
forall op. CanBeWise op =&gt; op -&gt; OpWithWisdom op
</span><a href="Futhark.Optimise.Simplify.Rep.html#addOpWisdom"><span class="hs-identifier hs-var">addOpWisdom</span></a></span><span> </span><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388125"><span class="hs-identifier hs-var">k</span></a></span></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span id="local-6989586621684389179"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.Analysis.SymbolTable.html#IndexOp"><span class="hs-identifier hs-type">ST.IndexOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389179"><span class="hs-identifier hs-type">inner</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.SymbolTable.html#IndexOp"><span class="hs-identifier hs-type">ST.IndexOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier hs-type">MemOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389179"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-249"></span><span>  </span><span id="local-6989586621684388113"><span class="annot"><span class="annottext">indexOp :: forall rep.
(ASTRep rep, IndexOp (Op rep)) =&gt;
SymbolTable rep
-&gt; Int -&gt; MemOp inner -&gt; [TPrimExp Int64 VName] -&gt; Maybe Indexed
</span><a href="Futhark.Analysis.SymbolTable.html#indexOp"><span class="hs-identifier hs-var hs-var hs-var hs-var">indexOp</span></a></span></span><span> </span><span id="local-6989586621684388111"><span class="annot"><span class="annottext">SymbolTable rep
</span><a href="#local-6989586621684388111"><span class="hs-identifier hs-var">vtable</span></a></span></span><span> </span><span id="local-6989586621684388110"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684388110"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621684388109"><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388109"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684388108"><span class="annot"><span class="annottext">[TPrimExp Int64 VName]
</span><a href="#local-6989586621684388108"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SymbolTable rep
-&gt; Int -&gt; inner -&gt; [TPrimExp Int64 VName] -&gt; Maybe Indexed
forall op rep.
(IndexOp op, ASTRep rep, IndexOp (Op rep)) =&gt;
SymbolTable rep
-&gt; Int -&gt; op -&gt; [TPrimExp Int64 VName] -&gt; Maybe Indexed
</span><a href="Futhark.Analysis.SymbolTable.html#indexOp"><span class="hs-identifier hs-var">ST.indexOp</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolTable rep
</span><a href="#local-6989586621684388111"><span class="hs-identifier hs-var">vtable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684388110"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684388109"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">[TPrimExp Int64 VName]
</span><a href="#local-6989586621684388108"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-250"></span><span>  </span><span class="annot"><a href="Futhark.Analysis.SymbolTable.html#indexOp"><span class="hs-identifier hs-var">indexOp</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolTable rep
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MemOp inner
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TPrimExp Int64 VName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Indexed
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span></span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="hs-comment">-- | The index function representation used for memory annotations.</span><span>
</span><span id="line-253"></span><span class="hs-keyword">type</span><span> </span><span id="IxFun"><span class="annot"><a href="Futhark.IR.Mem.html#IxFun"><span class="hs-identifier hs-var">IxFun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.IxFun.html#IxFun"><span class="hs-identifier hs-type">IxFun.IxFun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.PrimExp.html#TPrimExp"><span class="hs-identifier hs-type">TPrimExp</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span class="hs-comment">-- | An index function that may contain existential variables.</span><span>
</span><span id="line-256"></span><span class="hs-keyword">type</span><span> </span><span id="ExtIxFun"><span class="annot"><a href="Futhark.IR.Mem.html#ExtIxFun"><span class="hs-identifier hs-var">ExtIxFun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.IxFun.html#IxFun"><span class="hs-identifier hs-type">IxFun.IxFun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.PrimExp.html#TPrimExp"><span class="hs-identifier hs-type">TPrimExp</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span class="hs-comment">-- | A summary of the memory information for every let-bound</span><span>
</span><span id="line-259"></span><span class="hs-comment">-- identifier, function parameter, and return value.  Parameterisered</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- over uniqueness, dimension, and auxiliary array information.</span><span>
</span><span id="line-261"></span><span class="hs-keyword">data</span><span> </span><span id="MemInfo"><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-var">MemInfo</span></a></span></span><span> </span><span id="local-6989586621684389338"><span class="annot"><a href="#local-6989586621684389338"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span id="local-6989586621684389337"><span class="annot"><a href="#local-6989586621684389337"><span class="hs-identifier hs-type">u</span></a></span></span><span> </span><span id="local-6989586621684389336"><span class="annot"><a href="#local-6989586621684389336"><span class="hs-identifier hs-type">ret</span></a></span></span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | A primitive value.</span><span>
</span><span id="line-263"></span><span>    </span><span id="MemPrim"><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span></span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | A memory block.</span><span>
</span><span id="line-265"></span><span>    </span><span id="MemMem"><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-var">MemMem</span></a></span></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Space"><span class="hs-identifier hs-type">Space</span></a></span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | The array is stored in the named memory block, and with the</span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-comment">-- given index function.  The index function maps indices in the</span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-comment">-- array to /element/ offset, /not/ byte offsets!  To translate to</span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-comment">-- byte offsets, multiply the offset with the size of the array</span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-comment">-- element type.</span><span>
</span><span id="line-271"></span><span>    </span><span id="MemArray"><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span></span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ShapeBase"><span class="hs-identifier hs-type">ShapeBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389338"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621684389337"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389336"><span class="hs-identifier hs-type">ret</span></a></span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | An accumulator, which is not stored anywhere.</span><span>
</span><span id="line-273"></span><span>    </span><span id="MemAcc"><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-var">MemAcc</span></a></span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621684389337"><span class="hs-identifier hs-type">u</span></a></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684388086"><span id="local-6989586621684388103"><span class="annot"><span class="annottext">MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool
(MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool)
-&gt; (MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool)
-&gt; Eq (MemInfo d u ret)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall d u ret.
(Eq d, Eq u, Eq ret) =&gt;
MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool
/= :: MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool
$c/= :: forall d u ret.
(Eq d, Eq u, Eq ret) =&gt;
MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool
== :: MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool
$c== :: forall d u ret.
(Eq d, Eq u, Eq ret) =&gt;
MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684388058"><span id="local-6989586621684388060"><span id="local-6989586621684388082"><span class="annot"><span class="annottext">Int -&gt; MemInfo d u ret -&gt; ShowS
[MemInfo d u ret] -&gt; ShowS
MemInfo d u ret -&gt; String
(Int -&gt; MemInfo d u ret -&gt; ShowS)
-&gt; (MemInfo d u ret -&gt; String)
-&gt; ([MemInfo d u ret] -&gt; ShowS)
-&gt; Show (MemInfo d u ret)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall d u ret.
(Show d, Show u, Show ret) =&gt;
Int -&gt; MemInfo d u ret -&gt; ShowS
forall d u ret.
(Show d, Show u, Show ret) =&gt;
[MemInfo d u ret] -&gt; ShowS
forall d u ret.
(Show d, Show u, Show ret) =&gt;
MemInfo d u ret -&gt; String
showList :: [MemInfo d u ret] -&gt; ShowS
$cshowList :: forall d u ret.
(Show d, Show u, Show ret) =&gt;
[MemInfo d u ret] -&gt; ShowS
show :: MemInfo d u ret -&gt; String
$cshow :: forall d u ret.
(Show d, Show u, Show ret) =&gt;
MemInfo d u ret -&gt; String
showsPrec :: Int -&gt; MemInfo d u ret -&gt; ShowS
$cshowsPrec :: forall d u ret.
(Show d, Show u, Show ret) =&gt;
Int -&gt; MemInfo d u ret -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684388025"><span id="local-6989586621684388027"><span id="local-6989586621684388029"><span id="local-6989586621684388031"><span id="local-6989586621684388033"><span id="local-6989586621684388035"><span id="local-6989586621684388052"><span class="annot"><span class="annottext">Eq (MemInfo d u ret)
Eq (MemInfo d u ret)
-&gt; (MemInfo d u ret -&gt; MemInfo d u ret -&gt; Ordering)
-&gt; (MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool)
-&gt; (MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool)
-&gt; (MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool)
-&gt; (MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool)
-&gt; (MemInfo d u ret -&gt; MemInfo d u ret -&gt; MemInfo d u ret)
-&gt; (MemInfo d u ret -&gt; MemInfo d u ret -&gt; MemInfo d u ret)
-&gt; Ord (MemInfo d u ret)
MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool
MemInfo d u ret -&gt; MemInfo d u ret -&gt; Ordering
MemInfo d u ret -&gt; MemInfo d u ret -&gt; MemInfo d u ret
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall {d} {u} {ret}.
(Ord d, Ord u, Ord ret) =&gt;
Eq (MemInfo d u ret)
forall d u ret.
(Ord d, Ord u, Ord ret) =&gt;
MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool
forall d u ret.
(Ord d, Ord u, Ord ret) =&gt;
MemInfo d u ret -&gt; MemInfo d u ret -&gt; Ordering
forall d u ret.
(Ord d, Ord u, Ord ret) =&gt;
MemInfo d u ret -&gt; MemInfo d u ret -&gt; MemInfo d u ret
min :: MemInfo d u ret -&gt; MemInfo d u ret -&gt; MemInfo d u ret
$cmin :: forall d u ret.
(Ord d, Ord u, Ord ret) =&gt;
MemInfo d u ret -&gt; MemInfo d u ret -&gt; MemInfo d u ret
max :: MemInfo d u ret -&gt; MemInfo d u ret -&gt; MemInfo d u ret
$cmax :: forall d u ret.
(Ord d, Ord u, Ord ret) =&gt;
MemInfo d u ret -&gt; MemInfo d u ret -&gt; MemInfo d u ret
&gt;= :: MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool
$c&gt;= :: forall d u ret.
(Ord d, Ord u, Ord ret) =&gt;
MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool
&gt; :: MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool
$c&gt; :: forall d u ret.
(Ord d, Ord u, Ord ret) =&gt;
MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool
&lt;= :: MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool
$c&lt;= :: forall d u ret.
(Ord d, Ord u, Ord ret) =&gt;
MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool
&lt; :: MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool
$c&lt; :: forall d u ret.
(Ord d, Ord u, Ord ret) =&gt;
MemInfo d u ret -&gt; MemInfo d u ret -&gt; Bool
compare :: MemInfo d u ret -&gt; MemInfo d u ret -&gt; Ordering
$ccompare :: forall d u ret.
(Ord d, Ord u, Ord ret) =&gt;
MemInfo d u ret -&gt; MemInfo d u ret -&gt; Ordering
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">--- XXX Ord?</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="hs-keyword">type</span><span> </span><span id="MemBound"><span class="annot"><a href="Futhark.IR.Mem.html#MemBound"><span class="hs-identifier hs-var">MemBound</span></a></span></span><span> </span><span id="local-6989586621684388022"><span class="annot"><a href="#local-6989586621684388022"><span class="hs-identifier hs-type">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388022"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier hs-type">MemBind</span></a></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span id="local-6989586621684389290"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#FixExt"><span class="hs-identifier hs-type">FixExt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389290"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#DeclExtTyped"><span class="hs-identifier hs-type">DeclExtTyped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ExtSize"><span class="hs-identifier hs-type">ExtSize</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Uniqueness"><span class="hs-identifier hs-type">Uniqueness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389290"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-279"></span><span>  </span><span id="local-6989586621684388014"><span class="annot"><span class="annottext">declExtTypeOf :: MemInfo (Ext SubExp) Uniqueness ret -&gt; DeclExtType
</span><a href="Futhark.IR.Prop.Types.html#declExtTypeOf"><span class="hs-identifier hs-var hs-var hs-var hs-var">declExtTypeOf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span id="local-6989586621684388012"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684388012"><span class="hs-identifier hs-var">pt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; DeclExtType
forall shape u. PrimType -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684388012"><span class="hs-identifier hs-var">pt</span></a></span><span>
</span><span id="line-280"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#declExtTypeOf"><span class="hs-identifier hs-var">declExtTypeOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684388010"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684388010"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Space -&gt; DeclExtType
forall shape u. Space -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Mem"><span class="hs-identifier hs-var">Mem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684388010"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-281"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#declExtTypeOf"><span class="hs-identifier hs-var">declExtTypeOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span id="local-6989586621684388009"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684388009"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621684388008"><span class="annot"><span class="annottext">ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684388008"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span id="local-6989586621684388007"><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684388007"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="annot"><span class="annottext">ret
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; ShapeBase (Ext SubExp) -&gt; Uniqueness -&gt; DeclExtType
forall shape u. PrimType -&gt; shape -&gt; u -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Array"><span class="hs-identifier hs-var">Array</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684388009"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684388008"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684388007"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-282"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#declExtTypeOf"><span class="hs-identifier hs-var">declExtTypeOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684388005"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684388005"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684388004"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684388004"><span class="hs-identifier hs-var">ispace</span></a></span></span><span> </span><span id="local-6989586621684388003"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684388003"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621684388002"><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684388002"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Shape -&gt; [Type] -&gt; Uniqueness -&gt; DeclExtType
forall shape u. VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Acc"><span class="hs-identifier hs-var">Acc</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684388005"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684388004"><span class="hs-identifier hs-var">ispace</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684388003"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684388002"><span class="hs-identifier hs-var">u</span></a></span></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span id="local-6989586621684389283"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#FixExt"><span class="hs-identifier hs-type">FixExt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389283"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#ExtTyped"><span class="hs-identifier hs-type">ExtTyped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ExtSize"><span class="hs-identifier hs-type">ExtSize</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-type">NoUniqueness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389283"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-285"></span><span>  </span><span id="local-6989586621684387995"><span class="annot"><span class="annottext">extTypeOf :: MemInfo (Ext SubExp) NoUniqueness ret -&gt; ExtType
</span><a href="Futhark.IR.Prop.Types.html#extTypeOf"><span class="hs-identifier hs-var hs-var hs-var hs-var">extTypeOf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span id="local-6989586621684387993"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387993"><span class="hs-identifier hs-var">pt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; ExtType
forall shape u. PrimType -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387993"><span class="hs-identifier hs-var">pt</span></a></span><span>
</span><span id="line-286"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#extTypeOf"><span class="hs-identifier hs-var">extTypeOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684387992"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387992"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Space -&gt; ExtType
forall shape u. Space -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Mem"><span class="hs-identifier hs-var">Mem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387992"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-287"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#extTypeOf"><span class="hs-identifier hs-var">extTypeOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span id="local-6989586621684387991"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387991"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621684387990"><span class="annot"><span class="annottext">ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684387990"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span id="local-6989586621684387989"><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684387989"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="annot"><span class="annottext">ret
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; ShapeBase (Ext SubExp) -&gt; NoUniqueness -&gt; ExtType
forall shape u. PrimType -&gt; shape -&gt; u -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Array"><span class="hs-identifier hs-var">Array</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387991"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684387990"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684387989"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-288"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#extTypeOf"><span class="hs-identifier hs-var">extTypeOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684387988"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387988"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684387987"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387987"><span class="hs-identifier hs-var">ispace</span></a></span></span><span> </span><span id="local-6989586621684387986"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387986"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621684387985"><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684387985"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Shape -&gt; [Type] -&gt; NoUniqueness -&gt; ExtType
forall shape u. VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Acc"><span class="hs-identifier hs-var">Acc</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387988"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387987"><span class="hs-identifier hs-var">ispace</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387986"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684387985"><span class="hs-identifier hs-var">u</span></a></span></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span id="local-6989586621684389167"><span id="local-6989586621684389168"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#FixExt"><span class="hs-identifier hs-type">FixExt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389168"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#FixExt"><span class="hs-identifier hs-type">FixExt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ExtSize"><span class="hs-identifier hs-type">ExtSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389167"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389168"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-291"></span><span>  </span><span id="local-6989586621684387976"><span class="annot"><span class="annottext">fixExt :: Int
-&gt; SubExp
-&gt; MemInfo (Ext SubExp) u ret
-&gt; MemInfo (Ext SubExp) u ret
</span><a href="Futhark.IR.Prop.Types.html#fixExt"><span class="hs-identifier hs-var hs-var hs-var hs-var">fixExt</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span id="local-6989586621684387974"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387974"><span class="hs-identifier hs-var">pt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; MemInfo (Ext SubExp) u ret
forall d u ret. PrimType -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387974"><span class="hs-identifier hs-var">pt</span></a></span><span>
</span><span id="line-292"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#fixExt"><span class="hs-identifier hs-var">fixExt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684387973"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387973"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Space -&gt; MemInfo (Ext SubExp) u ret
forall d u ret. Space -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-var">MemMem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387973"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-293"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#fixExt"><span class="hs-identifier hs-var">fixExt</span></a></span><span> </span><span id="local-6989586621684387972"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387972"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621684387971"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684387971"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span id="local-6989586621684387970"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387970"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621684387969"><span class="annot"><span class="annottext">ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684387969"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span id="local-6989586621684387968"><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684387968"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621684387967"><span class="annot"><span class="annottext">ret
</span><a href="#local-6989586621684387967"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-294"></span><span>    </span><span class="annot"><span class="annottext">PrimType
-&gt; ShapeBase (Ext SubExp) -&gt; u -&gt; ret -&gt; MemInfo (Ext SubExp) u ret
forall d u ret.
PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387970"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SubExp -&gt; ShapeBase (Ext SubExp) -&gt; ShapeBase (Ext SubExp)
forall t. FixExt t =&gt; Int -&gt; SubExp -&gt; t -&gt; t
</span><a href="Futhark.IR.Prop.Types.html#fixExt"><span class="hs-identifier hs-var">fixExt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387972"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684387971"><span class="hs-identifier hs-var">se</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684387969"><span class="hs-identifier hs-var">shape</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684387968"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SubExp -&gt; ret -&gt; ret
forall t. FixExt t =&gt; Int -&gt; SubExp -&gt; t -&gt; t
</span><a href="Futhark.IR.Prop.Types.html#fixExt"><span class="hs-identifier hs-var">fixExt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387972"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684387971"><span class="hs-identifier hs-var">se</span></a></span><span> </span><span class="annot"><span class="annottext">ret
</span><a href="#local-6989586621684387967"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#fixExt"><span class="hs-identifier hs-var">fixExt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684387966"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387966"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684387965"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387965"><span class="hs-identifier hs-var">ispace</span></a></span></span><span> </span><span id="local-6989586621684387964"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387964"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621684387963"><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684387963"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; MemInfo (Ext SubExp) u ret
forall d u ret. VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-var">MemAcc</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387966"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387965"><span class="hs-identifier hs-var">ispace</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387964"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684387963"><span class="hs-identifier hs-var">u</span></a></span></span></span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span id="local-6989586621684389158"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#Typed"><span class="hs-identifier hs-type">Typed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Uniqueness"><span class="hs-identifier hs-type">Uniqueness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389158"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-298"></span><span>  </span><span id="local-6989586621684387956"><span class="annot"><span class="annottext">typeOf :: MemInfo SubExp Uniqueness ret -&gt; Type
</span><a href="Futhark.IR.Prop.Types.html#typeOf"><span class="hs-identifier hs-var hs-var hs-var hs-var">typeOf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase Shape Uniqueness -&gt; Type
forall shape.
TypeBase shape Uniqueness -&gt; TypeBase shape NoUniqueness
</span><a href="Futhark.IR.Prop.Types.html#fromDecl"><span class="hs-identifier hs-var">fromDecl</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase Shape Uniqueness -&gt; Type)
-&gt; (MemInfo SubExp Uniqueness ret -&gt; TypeBase Shape Uniqueness)
-&gt; MemInfo SubExp Uniqueness ret
-&gt; Type
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MemInfo SubExp Uniqueness ret -&gt; TypeBase Shape Uniqueness
forall t. DeclTyped t =&gt; t -&gt; TypeBase Shape Uniqueness
</span><a href="Futhark.IR.Prop.Types.html#declTypeOf"><span class="hs-identifier hs-var">declTypeOf</span></a></span></span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span id="local-6989586621684389152"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#Typed"><span class="hs-identifier hs-type">Typed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-type">NoUniqueness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389152"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-301"></span><span>  </span><span id="local-6989586621684387950"><span class="annot"><span class="annottext">typeOf :: MemInfo SubExp NoUniqueness ret -&gt; Type
</span><a href="#local-6989586621684387950"><span class="hs-identifier hs-var hs-var hs-var hs-var">typeOf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span id="local-6989586621684387949"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387949"><span class="hs-identifier hs-var">pt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; Type
forall shape u. PrimType -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387949"><span class="hs-identifier hs-var">pt</span></a></span><span>
</span><span id="line-302"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#typeOf"><span class="hs-identifier hs-var">typeOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684387948"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387948"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Space -&gt; Type
forall shape u. Space -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Mem"><span class="hs-identifier hs-var">Mem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387948"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-303"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#typeOf"><span class="hs-identifier hs-var">typeOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span id="local-6989586621684387947"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387947"><span class="hs-identifier hs-var">bt</span></a></span></span><span> </span><span id="local-6989586621684387946"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387946"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span id="local-6989586621684387945"><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684387945"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="annot"><span class="annottext">ret
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; Shape -&gt; NoUniqueness -&gt; Type
forall shape u. PrimType -&gt; shape -&gt; u -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Array"><span class="hs-identifier hs-var">Array</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387947"><span class="hs-identifier hs-var">bt</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387946"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684387945"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-304"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#typeOf"><span class="hs-identifier hs-var">typeOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684387944"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387944"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684387943"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387943"><span class="hs-identifier hs-var">ispace</span></a></span></span><span> </span><span id="local-6989586621684387942"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387942"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621684387941"><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684387941"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Shape -&gt; [Type] -&gt; NoUniqueness -&gt; Type
forall shape u. VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Acc"><span class="hs-identifier hs-var">Acc</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387944"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387943"><span class="hs-identifier hs-var">ispace</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387942"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684387941"><span class="hs-identifier hs-var">u</span></a></span></span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span id="local-6989586621684389156"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#DeclTyped"><span class="hs-identifier hs-type">DeclTyped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Uniqueness"><span class="hs-identifier hs-type">Uniqueness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389156"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-307"></span><span>  </span><span id="local-6989586621684387938"><span class="annot"><span class="annottext">declTypeOf :: MemInfo SubExp Uniqueness ret -&gt; TypeBase Shape Uniqueness
</span><a href="#local-6989586621684387938"><span class="hs-identifier hs-var hs-var hs-var hs-var">declTypeOf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span id="local-6989586621684387937"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387937"><span class="hs-identifier hs-var">bt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; TypeBase Shape Uniqueness
forall shape u. PrimType -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387937"><span class="hs-identifier hs-var">bt</span></a></span><span>
</span><span id="line-308"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#declTypeOf"><span class="hs-identifier hs-var">declTypeOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684387936"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387936"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Space -&gt; TypeBase Shape Uniqueness
forall shape u. Space -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Mem"><span class="hs-identifier hs-var">Mem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387936"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-309"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#declTypeOf"><span class="hs-identifier hs-var">declTypeOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span id="local-6989586621684387935"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387935"><span class="hs-identifier hs-var">bt</span></a></span></span><span> </span><span id="local-6989586621684387934"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387934"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span id="local-6989586621684387933"><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684387933"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="annot"><span class="annottext">ret
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; Shape -&gt; Uniqueness -&gt; TypeBase Shape Uniqueness
forall shape u. PrimType -&gt; shape -&gt; u -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Array"><span class="hs-identifier hs-var">Array</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387935"><span class="hs-identifier hs-var">bt</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387934"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684387933"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-310"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#declTypeOf"><span class="hs-identifier hs-var">declTypeOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684387932"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387932"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684387931"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387931"><span class="hs-identifier hs-var">ispace</span></a></span></span><span> </span><span id="local-6989586621684387930"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387930"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621684387929"><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684387929"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Shape -&gt; [Type] -&gt; Uniqueness -&gt; TypeBase Shape Uniqueness
forall shape u. VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Acc"><span class="hs-identifier hs-var">Acc</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387932"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387931"><span class="hs-identifier hs-var">ispace</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387930"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684387929"><span class="hs-identifier hs-var">u</span></a></span></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span id="local-6989586621684389145"><span id="local-6989586621684389146"><span id="local-6989586621684389147"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Names.html#FreeIn"><span class="hs-identifier hs-type">FreeIn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389147"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#FreeIn"><span class="hs-identifier hs-type">FreeIn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389146"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#FreeIn"><span class="hs-identifier hs-type">FreeIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389147"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389145"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389146"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-313"></span><span>  </span><span id="local-6989586621684387905"><span class="annot"><span class="annottext">freeIn' :: MemInfo d u ret -&gt; FV
</span><a href="#local-6989586621684387905"><span class="hs-identifier hs-var hs-var hs-var hs-var">freeIn'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684387904"><span class="annot"><span class="annottext">ShapeBase d
</span><a href="#local-6989586621684387904"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span class="annot"><span class="annottext">u
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684387903"><span class="annot"><span class="annottext">ret
</span><a href="#local-6989586621684387903"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShapeBase d -&gt; FV
forall a. FreeIn a =&gt; a -&gt; FV
</span><a href="Futhark.IR.Prop.Names.html#freeIn%27"><span class="hs-identifier hs-var">freeIn'</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase d
</span><a href="#local-6989586621684387904"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="annot"><span class="annottext">FV -&gt; FV -&gt; FV
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ret -&gt; FV
forall a. FreeIn a =&gt; a -&gt; FV
</span><a href="Futhark.IR.Prop.Names.html#freeIn%27"><span class="hs-identifier hs-var">freeIn'</span></a></span><span> </span><span class="annot"><span class="annottext">ret
</span><a href="#local-6989586621684387903"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-314"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#freeIn%27"><span class="hs-identifier hs-var">freeIn'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684387902"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387902"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Space -&gt; FV
forall a. FreeIn a =&gt; a -&gt; FV
</span><a href="Futhark.IR.Prop.Names.html#freeIn%27"><span class="hs-identifier hs-var">freeIn'</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387902"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-315"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#freeIn%27"><span class="hs-identifier hs-var">freeIn'</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FV
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-316"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#freeIn%27"><span class="hs-identifier hs-var">freeIn'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684387901"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387901"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684387900"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387900"><span class="hs-identifier hs-var">ispace</span></a></span></span><span> </span><span id="local-6989586621684387899"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387899"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="annot"><span class="annottext">u
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VName, Shape, [Type]) -&gt; FV
forall a. FreeIn a =&gt; a -&gt; FV
</span><a href="Futhark.IR.Prop.Names.html#freeIn%27"><span class="hs-identifier hs-var">freeIn'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387901"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387900"><span class="hs-identifier hs-var">ispace</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387899"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span id="local-6989586621684389132"><span id="local-6989586621684389133"><span id="local-6989586621684389134"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Transform.Substitute.html#Substitute"><span class="hs-identifier hs-type">Substitute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389134"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Transform.Substitute.html#Substitute"><span class="hs-identifier hs-type">Substitute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389133"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.Transform.Substitute.html#Substitute"><span class="hs-identifier hs-type">Substitute</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389134"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389132"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389133"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-319"></span><span>  </span><span id="local-6989586621684387883"><span class="annot"><span class="annottext">substituteNames :: Map VName VName -&gt; MemInfo d u ret -&gt; MemInfo d u ret
</span><a href="#local-6989586621684387883"><span class="hs-identifier hs-var hs-var hs-var hs-var">substituteNames</span></a></span></span><span> </span><span id="local-6989586621684387882"><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684387882"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span id="local-6989586621684387881"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387881"><span class="hs-identifier hs-var">bt</span></a></span></span><span> </span><span id="local-6989586621684387880"><span class="annot"><span class="annottext">ShapeBase d
</span><a href="#local-6989586621684387880"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span id="local-6989586621684387879"><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684387879"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621684387878"><span class="annot"><span class="annottext">ret
</span><a href="#local-6989586621684387878"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-320"></span><span>    </span><span class="annot"><span class="annottext">PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
forall d u ret.
PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span><span>
</span><span id="line-321"></span><span>      </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387881"><span class="hs-identifier hs-var">bt</span></a></span><span>
</span><span id="line-322"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map VName VName -&gt; ShapeBase d -&gt; ShapeBase d
forall a. Substitute a =&gt; Map VName VName -&gt; a -&gt; a
</span><a href="Futhark.Transform.Substitute.html#substituteNames"><span class="hs-identifier hs-var">substituteNames</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684387882"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase d
</span><a href="#local-6989586621684387880"><span class="hs-identifier hs-var">shape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>      </span><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684387879"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-324"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map VName VName -&gt; ret -&gt; ret
forall a. Substitute a =&gt; Map VName VName -&gt; a -&gt; a
</span><a href="Futhark.Transform.Substitute.html#substituteNames"><span class="hs-identifier hs-var">substituteNames</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684387882"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">ret
</span><a href="#local-6989586621684387878"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>  </span><span class="annot"><a href="Futhark.Transform.Substitute.html#substituteNames"><span class="hs-identifier hs-var">substituteNames</span></a></span><span> </span><span id="local-6989586621684387877"><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684387877"><span class="hs-identifier hs-var">substs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684387876"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387876"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684387875"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387875"><span class="hs-identifier hs-var">ispace</span></a></span></span><span> </span><span id="local-6989586621684387874"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387874"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621684387873"><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684387873"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-326"></span><span>    </span><span class="annot"><span class="annottext">VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; MemInfo d u ret
forall d u ret. VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-var">MemAcc</span></a></span><span>
</span><span id="line-327"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map VName VName -&gt; VName -&gt; VName
forall a. Substitute a =&gt; Map VName VName -&gt; a -&gt; a
</span><a href="Futhark.Transform.Substitute.html#substituteNames"><span class="hs-identifier hs-var">substituteNames</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684387877"><span class="hs-identifier hs-var">substs</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387876"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map VName VName -&gt; Shape -&gt; Shape
forall a. Substitute a =&gt; Map VName VName -&gt; a -&gt; a
</span><a href="Futhark.Transform.Substitute.html#substituteNames"><span class="hs-identifier hs-var">substituteNames</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684387877"><span class="hs-identifier hs-var">substs</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387875"><span class="hs-identifier hs-var">ispace</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map VName VName -&gt; [Type] -&gt; [Type]
forall a. Substitute a =&gt; Map VName VName -&gt; a -&gt; a
</span><a href="Futhark.Transform.Substitute.html#substituteNames"><span class="hs-identifier hs-var">substituteNames</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684387877"><span class="hs-identifier hs-var">substs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387874"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>      </span><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684387873"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-331"></span><span>  </span><span class="annot"><a href="Futhark.Transform.Substitute.html#substituteNames"><span class="hs-identifier hs-var">substituteNames</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684387872"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387872"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-332"></span><span>    </span><span class="annot"><span class="annottext">Space -&gt; MemInfo d u ret
forall d u ret. Space -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-var">MemMem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387872"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-333"></span><span>  </span><span class="annot"><a href="Futhark.Transform.Substitute.html#substituteNames"><span class="hs-identifier hs-var">substituteNames</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span id="local-6989586621684387871"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387871"><span class="hs-identifier hs-var">bt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-334"></span><span>    </span><span class="annot"><span class="annottext">PrimType -&gt; MemInfo d u ret
forall d u ret. PrimType -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387871"><span class="hs-identifier hs-var">bt</span></a></span></span></span></span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span id="local-6989586621684389122"><span id="local-6989586621684389123"><span id="local-6989586621684389124"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Transform.Substitute.html#Substitute"><span class="hs-identifier hs-type">Substitute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389124"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Transform.Substitute.html#Substitute"><span class="hs-identifier hs-type">Substitute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389123"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.Transform.Rename.html#Rename"><span class="hs-identifier hs-type">Rename</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389124"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389122"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389123"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-337"></span><span>  </span><span id="local-6989586621684387865"><span class="annot"><span class="annottext">rename :: MemInfo d u ret -&gt; RenameM (MemInfo d u ret)
</span><a href="#local-6989586621684387865"><span class="hs-identifier hs-var hs-var hs-var hs-var">rename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MemInfo d u ret -&gt; RenameM (MemInfo d u ret)
forall a. Substitute a =&gt; a -&gt; RenameM a
</span><a href="Futhark.Transform.Rename.html#substituteRename"><span class="hs-identifier hs-var">substituteRename</span></a></span></span></span></span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span id="local-6989586621684389120"><span class="annot"><a href="Futhark.IR.Mem.html#simplifyIxFun"><span class="hs-identifier hs-type">simplifyIxFun</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-340"></span><span>  </span><span class="annot"><a href="Futhark.Optimise.Simplify.Engine.html#SimplifiableRep"><span class="hs-identifier hs-type">Engine.SimplifiableRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389120"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-341"></span><span>  </span><span class="annot"><a href="Futhark.IR.Mem.html#IxFun"><span class="hs-identifier hs-type">IxFun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-342"></span><span>  </span><span class="annot"><a href="Futhark.Optimise.Simplify.Engine.html#SimpleM"><span class="hs-identifier hs-type">Engine.SimpleM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389120"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#IxFun"><span class="hs-identifier hs-type">IxFun</span></a></span></span><span>
</span><span id="line-343"></span><span id="simplifyIxFun"><span class="annot"><span class="annottext">simplifyIxFun :: forall rep. SimplifiableRep rep =&gt; IxFun -&gt; SimpleM rep IxFun
</span><a href="Futhark.IR.Mem.html#simplifyIxFun"><span class="hs-identifier hs-var hs-var">simplifyIxFun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TPrimExp Int64 VName -&gt; SimpleM rep (TPrimExp Int64 VName))
-&gt; IxFun -&gt; SimpleM rep IxFun
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">((TPrimExp Int64 VName -&gt; SimpleM rep (TPrimExp Int64 VName))
 -&gt; IxFun -&gt; SimpleM rep IxFun)
-&gt; (TPrimExp Int64 VName -&gt; SimpleM rep (TPrimExp Int64 VName))
-&gt; IxFun
-&gt; SimpleM rep IxFun
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PrimExp VName -&gt; TPrimExp Int64 VName)
-&gt; SimpleM rep (PrimExp VName)
-&gt; SimpleM rep (TPrimExp Int64 VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">PrimExp VName -&gt; TPrimExp Int64 VName
forall v. PrimExp v -&gt; TPrimExp Int64 v
</span><a href="Futhark.Analysis.PrimExp.html#isInt64"><span class="hs-identifier hs-var">isInt64</span></a></span><span> </span><span class="annot"><span class="annottext">(SimpleM rep (PrimExp VName) -&gt; SimpleM rep (TPrimExp Int64 VName))
-&gt; (TPrimExp Int64 VName -&gt; SimpleM rep (PrimExp VName))
-&gt; TPrimExp Int64 VName
-&gt; SimpleM rep (TPrimExp Int64 VName)
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PrimExp VName -&gt; SimpleM rep (PrimExp VName)
forall rep.
SimplifiableRep rep =&gt;
PrimExp VName -&gt; SimpleM rep (PrimExp VName)
</span><a href="Futhark.Analysis.PrimExp.Simplify.html#simplifyPrimExp"><span class="hs-identifier hs-var">simplifyPrimExp</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimExp VName -&gt; SimpleM rep (PrimExp VName))
-&gt; (TPrimExp Int64 VName -&gt; PrimExp VName)
-&gt; TPrimExp Int64 VName
-&gt; SimpleM rep (PrimExp VName)
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TPrimExp Int64 VName -&gt; PrimExp VName
forall t v. TPrimExp t v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#untyped"><span class="hs-identifier hs-var hs-var">untyped</span></a></span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span id="local-6989586621684389098"><span class="annot"><a href="Futhark.IR.Mem.html#simplifyExtIxFun"><span class="hs-identifier hs-type">simplifyExtIxFun</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-346"></span><span>  </span><span class="annot"><a href="Futhark.Optimise.Simplify.Engine.html#SimplifiableRep"><span class="hs-identifier hs-type">Engine.SimplifiableRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389098"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-347"></span><span>  </span><span class="annot"><a href="Futhark.IR.Mem.html#ExtIxFun"><span class="hs-identifier hs-type">ExtIxFun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-348"></span><span>  </span><span class="annot"><a href="Futhark.Optimise.Simplify.Engine.html#SimpleM"><span class="hs-identifier hs-type">Engine.SimpleM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389098"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#ExtIxFun"><span class="hs-identifier hs-type">ExtIxFun</span></a></span></span><span>
</span><span id="line-349"></span><span id="simplifyExtIxFun"><span class="annot"><span class="annottext">simplifyExtIxFun :: forall rep. SimplifiableRep rep =&gt; ExtIxFun -&gt; SimpleM rep ExtIxFun
</span><a href="Futhark.IR.Mem.html#simplifyExtIxFun"><span class="hs-identifier hs-var hs-var">simplifyExtIxFun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TPrimExp Int64 (Ext VName)
 -&gt; SimpleM rep (TPrimExp Int64 (Ext VName)))
-&gt; ExtIxFun -&gt; SimpleM rep ExtIxFun
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">((TPrimExp Int64 (Ext VName)
  -&gt; SimpleM rep (TPrimExp Int64 (Ext VName)))
 -&gt; ExtIxFun -&gt; SimpleM rep ExtIxFun)
-&gt; (TPrimExp Int64 (Ext VName)
    -&gt; SimpleM rep (TPrimExp Int64 (Ext VName)))
-&gt; ExtIxFun
-&gt; SimpleM rep ExtIxFun
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PrimExp (Ext VName) -&gt; TPrimExp Int64 (Ext VName))
-&gt; SimpleM rep (PrimExp (Ext VName))
-&gt; SimpleM rep (TPrimExp Int64 (Ext VName))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">PrimExp (Ext VName) -&gt; TPrimExp Int64 (Ext VName)
forall v. PrimExp v -&gt; TPrimExp Int64 v
</span><a href="Futhark.Analysis.PrimExp.html#isInt64"><span class="hs-identifier hs-var">isInt64</span></a></span><span> </span><span class="annot"><span class="annottext">(SimpleM rep (PrimExp (Ext VName))
 -&gt; SimpleM rep (TPrimExp Int64 (Ext VName)))
-&gt; (TPrimExp Int64 (Ext VName)
    -&gt; SimpleM rep (PrimExp (Ext VName)))
-&gt; TPrimExp Int64 (Ext VName)
-&gt; SimpleM rep (TPrimExp Int64 (Ext VName))
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PrimExp (Ext VName) -&gt; SimpleM rep (PrimExp (Ext VName))
forall rep.
SimplifiableRep rep =&gt;
PrimExp (Ext VName) -&gt; SimpleM rep (PrimExp (Ext VName))
</span><a href="Futhark.Analysis.PrimExp.Simplify.html#simplifyExtPrimExp"><span class="hs-identifier hs-var">simplifyExtPrimExp</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimExp (Ext VName) -&gt; SimpleM rep (PrimExp (Ext VName)))
-&gt; (TPrimExp Int64 (Ext VName) -&gt; PrimExp (Ext VName))
-&gt; TPrimExp Int64 (Ext VName)
-&gt; SimpleM rep (PrimExp (Ext VName))
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TPrimExp Int64 (Ext VName) -&gt; PrimExp (Ext VName)
forall t v. TPrimExp t v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#untyped"><span class="hs-identifier hs-var hs-var">untyped</span></a></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="annot"><a href="Futhark.IR.Mem.html#isStaticIxFun"><span class="hs-identifier hs-type">isStaticIxFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#ExtIxFun"><span class="hs-identifier hs-type">ExtIxFun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#IxFun"><span class="hs-identifier hs-type">IxFun</span></a></span><span>
</span><span id="line-352"></span><span id="isStaticIxFun"><span class="annot"><span class="annottext">isStaticIxFun :: ExtIxFun -&gt; Maybe IxFun
</span><a href="Futhark.IR.Mem.html#isStaticIxFun"><span class="hs-identifier hs-var hs-var">isStaticIxFun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TPrimExp Int64 (Ext VName) -&gt; Maybe (TPrimExp Int64 VName))
-&gt; ExtIxFun -&gt; Maybe IxFun
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">((TPrimExp Int64 (Ext VName) -&gt; Maybe (TPrimExp Int64 VName))
 -&gt; ExtIxFun -&gt; Maybe IxFun)
-&gt; (TPrimExp Int64 (Ext VName) -&gt; Maybe (TPrimExp Int64 VName))
-&gt; ExtIxFun
-&gt; Maybe IxFun
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Ext VName -&gt; Maybe VName)
-&gt; TPrimExp Int64 (Ext VName) -&gt; Maybe (TPrimExp Int64 VName)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">Ext VName -&gt; Maybe VName
forall {a}. Ext a -&gt; Maybe a
</span><a href="#local-6989586621684387826"><span class="hs-identifier hs-var">inst</span></a></span><span>
</span><span id="line-353"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-354"></span><span>    </span><span id="local-6989586621684387826"><span class="annot"><span class="annottext">inst :: Ext a -&gt; Maybe a
</span><a href="#local-6989586621684387826"><span class="hs-identifier hs-var hs-var">inst</span></a></span></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-355"></span><span>    </span><span class="annot"><a href="#local-6989586621684387826"><span class="hs-identifier hs-var">inst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-type">Free</span></a></span><span> </span><span id="local-6989586621684387823"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684387823"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684387823"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span id="local-6989586621684389085"><span id="local-6989586621684389086"><span id="local-6989586621684389087"><span class="hs-keyword">instance</span><span>
</span><span id="line-358"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Optimise.Simplify.Engine.html#Simplifiable"><span class="hs-identifier hs-type">Engine.Simplifiable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389087"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Optimise.Simplify.Engine.html#Simplifiable"><span class="hs-identifier hs-type">Engine.Simplifiable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389086"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-359"></span><span>  </span><span class="annot"><a href="Futhark.Optimise.Simplify.Engine.html#Simplifiable"><span class="hs-identifier hs-type">Engine.Simplifiable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389087"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389085"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389086"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-361"></span><span>  </span><span id="local-6989586621684387780"><span class="annot"><span class="annottext">simplify :: forall rep.
SimplifiableRep rep =&gt;
MemInfo d u ret -&gt; SimpleM rep (MemInfo d u ret)
</span><a href="Futhark.Optimise.Simplify.Engine.html#simplify"><span class="hs-identifier hs-var hs-var hs-var hs-var">simplify</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span id="local-6989586621684387778"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387778"><span class="hs-identifier hs-var">bt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-362"></span><span>    </span><span class="annot"><span class="annottext">MemInfo d u ret -&gt; SimpleM rep (MemInfo d u ret)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(MemInfo d u ret -&gt; SimpleM rep (MemInfo d u ret))
-&gt; MemInfo d u ret -&gt; SimpleM rep (MemInfo d u ret)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; MemInfo d u ret
forall d u ret. PrimType -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387778"><span class="hs-identifier hs-var">bt</span></a></span><span>
</span><span id="line-363"></span><span>  </span><span class="annot"><a href="Futhark.Optimise.Simplify.Engine.html#simplify"><span class="hs-identifier hs-var">simplify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684387777"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387777"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-364"></span><span>    </span><span class="annot"><span class="annottext">MemInfo d u ret -&gt; SimpleM rep (MemInfo d u ret)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(MemInfo d u ret -&gt; SimpleM rep (MemInfo d u ret))
-&gt; MemInfo d u ret -&gt; SimpleM rep (MemInfo d u ret)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Space -&gt; MemInfo d u ret
forall d u ret. Space -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-var">MemMem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387777"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-365"></span><span>  </span><span class="annot"><a href="Futhark.Optimise.Simplify.Engine.html#simplify"><span class="hs-identifier hs-var">simplify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span id="local-6989586621684387776"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387776"><span class="hs-identifier hs-var">bt</span></a></span></span><span> </span><span id="local-6989586621684387775"><span class="annot"><span class="annottext">ShapeBase d
</span><a href="#local-6989586621684387775"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span id="local-6989586621684387774"><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684387774"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621684387773"><span class="annot"><span class="annottext">ret
</span><a href="#local-6989586621684387773"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-366"></span><span>    </span><span class="annot"><span class="annottext">PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
forall d u ret.
PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387776"><span class="hs-identifier hs-var">bt</span></a></span><span> </span><span class="annot"><span class="annottext">(ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret)
-&gt; SimpleM rep (ShapeBase d)
-&gt; SimpleM rep (u -&gt; ret -&gt; MemInfo d u ret)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ShapeBase d -&gt; SimpleM rep (ShapeBase d)
forall e rep.
(Simplifiable e, SimplifiableRep rep) =&gt;
e -&gt; SimpleM rep e
</span><a href="Futhark.Optimise.Simplify.Engine.html#simplify"><span class="hs-identifier hs-var">Engine.simplify</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase d
</span><a href="#local-6989586621684387775"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleM rep (u -&gt; ret -&gt; MemInfo d u ret)
-&gt; SimpleM rep u -&gt; SimpleM rep (ret -&gt; MemInfo d u ret)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">u -&gt; SimpleM rep u
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684387774"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleM rep (ret -&gt; MemInfo d u ret)
-&gt; SimpleM rep ret -&gt; SimpleM rep (MemInfo d u ret)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">ret -&gt; SimpleM rep ret
forall e rep.
(Simplifiable e, SimplifiableRep rep) =&gt;
e -&gt; SimpleM rep e
</span><a href="Futhark.Optimise.Simplify.Engine.html#simplify"><span class="hs-identifier hs-var">Engine.simplify</span></a></span><span> </span><span class="annot"><span class="annottext">ret
</span><a href="#local-6989586621684387773"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-367"></span><span>  </span><span class="annot"><a href="Futhark.Optimise.Simplify.Engine.html#simplify"><span class="hs-identifier hs-var">simplify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684387772"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387772"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684387771"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387771"><span class="hs-identifier hs-var">ispace</span></a></span></span><span> </span><span id="local-6989586621684387770"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387770"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621684387769"><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684387769"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-368"></span><span>    </span><span class="annot"><span class="annottext">VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; MemInfo d u ret
forall d u ret. VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-var">MemAcc</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; MemInfo d u ret)
-&gt; SimpleM rep VName
-&gt; SimpleM rep (Shape -&gt; [Type] -&gt; u -&gt; MemInfo d u ret)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; SimpleM rep VName
forall e rep.
(Simplifiable e, SimplifiableRep rep) =&gt;
e -&gt; SimpleM rep e
</span><a href="Futhark.Optimise.Simplify.Engine.html#simplify"><span class="hs-identifier hs-var">Engine.simplify</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387772"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleM rep (Shape -&gt; [Type] -&gt; u -&gt; MemInfo d u ret)
-&gt; SimpleM rep Shape
-&gt; SimpleM rep ([Type] -&gt; u -&gt; MemInfo d u ret)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Shape -&gt; SimpleM rep Shape
forall e rep.
(Simplifiable e, SimplifiableRep rep) =&gt;
e -&gt; SimpleM rep e
</span><a href="Futhark.Optimise.Simplify.Engine.html#simplify"><span class="hs-identifier hs-var">Engine.simplify</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387771"><span class="hs-identifier hs-var">ispace</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleM rep ([Type] -&gt; u -&gt; MemInfo d u ret)
-&gt; SimpleM rep [Type] -&gt; SimpleM rep (u -&gt; MemInfo d u ret)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; SimpleM rep [Type]
forall e rep.
(Simplifiable e, SimplifiableRep rep) =&gt;
e -&gt; SimpleM rep e
</span><a href="Futhark.Optimise.Simplify.Engine.html#simplify"><span class="hs-identifier hs-var">Engine.simplify</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387770"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleM rep (u -&gt; MemInfo d u ret)
-&gt; SimpleM rep u -&gt; SimpleM rep (MemInfo d u ret)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">u -&gt; SimpleM rep u
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684387769"><span class="hs-identifier hs-var">u</span></a></span></span></span></span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span id="local-6989586621684389076"><span id="local-6989586621684389077"><span id="local-6989586621684389078"><span class="hs-keyword">instance</span><span>
</span><span id="line-371"></span><span>  </span><span id="local-6989586621684387764"><span id="local-6989586621684387766"><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PP.Pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ShapeBase"><span class="hs-identifier hs-type">ShapeBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389078"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-372"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">PP.Pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ShapeBase"><span class="hs-identifier hs-type">ShapeBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389078"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621684389077"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-373"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">PP.Pretty</span></span><span> </span><span class="annot"><a href="#local-6989586621684389078"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-374"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">PP.Pretty</span></span><span> </span><span class="annot"><a href="#local-6989586621684389077"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-375"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">PP.Pretty</span></span><span> </span><span class="annot"><a href="#local-6989586621684389076"><span class="hs-identifier hs-type">ret</span></a></span><span>
</span><span id="line-376"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-377"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PP.Pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389078"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389077"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389076"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-379"></span><span>  </span><span id="local-6989586621684387751"><span class="annot"><span class="annottext">ppr :: MemInfo d u ret -&gt; Doc
</span><a href="#local-6989586621684387751"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span id="local-6989586621684387750"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387750"><span class="hs-identifier hs-var">bt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">PP.ppr</span></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387750"><span class="hs-identifier hs-var">bt</span></a></span><span>
</span><span id="line-380"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="Futhark.IR.Syntax.Core.html#DefaultSpace"><span class="hs-identifier hs-var">DefaultSpace</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc
</span><span class="hs-identifier hs-var">PP.text</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mem&quot;</span></span><span>
</span><span id="line-381"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684387749"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387749"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc
</span><span class="hs-identifier hs-var">PP.text</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mem&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Space -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">PP.ppr</span></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387749"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-382"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span id="local-6989586621684387748"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387748"><span class="hs-identifier hs-var">bt</span></a></span></span><span> </span><span id="local-6989586621684387747"><span class="annot"><span class="annottext">ShapeBase d
</span><a href="#local-6989586621684387747"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span id="local-6989586621684387746"><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684387746"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621684387745"><span class="annot"><span class="annottext">ret
</span><a href="#local-6989586621684387745"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-383"></span><span>    </span><span class="annot"><span class="annottext">TypeBase (ShapeBase d) u -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">PP.ppr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType -&gt; ShapeBase d -&gt; u -&gt; TypeBase (ShapeBase d) u
forall shape u. PrimType -&gt; shape -&gt; u -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Array"><span class="hs-identifier hs-var">Array</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387748"><span class="hs-identifier hs-var">bt</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase d
</span><a href="#local-6989586621684387747"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684387746"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc
</span><span class="hs-identifier hs-var">PP.text</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;@&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">ret -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">PP.ppr</span></span><span> </span><span class="annot"><span class="annottext">ret
</span><a href="#local-6989586621684387745"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-384"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684387744"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387744"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684387743"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387743"><span class="hs-identifier hs-var">ispace</span></a></span></span><span> </span><span id="local-6989586621684387742"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387742"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621684387741"><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684387741"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-385"></span><span>    </span><span class="annot"><span class="annottext">u -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">PP.ppr</span></span><span> </span><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684387741"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">PP.ppr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Shape -&gt; [Type] -&gt; NoUniqueness -&gt; Type
forall shape u. VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Acc"><span class="hs-identifier hs-var">Acc</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387744"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387743"><span class="hs-identifier hs-var">ispace</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387742"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-var">NoUniqueness</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span class="hs-comment">-- | Memory information for an array bound somewhere in the program.</span><span>
</span><span id="line-388"></span><span class="hs-keyword">data</span><span> </span><span id="MemBind"><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier hs-var">MemBind</span></a></span></span><span>
</span><span id="line-389"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | Located in this memory block with this index</span><span>
</span><span id="line-390"></span><span>    </span><span class="hs-comment">-- function.</span><span>
</span><span id="line-391"></span><span>    </span><span id="ArrayIn"><span class="annot"><a href="Futhark.IR.Mem.html#ArrayIn"><span class="hs-identifier hs-var">ArrayIn</span></a></span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#IxFun"><span class="hs-identifier hs-type">IxFun</span></a></span><span>
</span><span id="line-392"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684387728"><span id="local-6989586621684387730"><span id="local-6989586621684387737"><span class="annot"><span class="annottext">Int -&gt; MemBind -&gt; ShowS
[MemBind] -&gt; ShowS
MemBind -&gt; String
(Int -&gt; MemBind -&gt; ShowS)
-&gt; (MemBind -&gt; String) -&gt; ([MemBind] -&gt; ShowS) -&gt; Show MemBind
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [MemBind] -&gt; ShowS
$cshowList :: [MemBind] -&gt; ShowS
show :: MemBind -&gt; String
$cshow :: MemBind -&gt; String
showsPrec :: Int -&gt; MemBind -&gt; ShowS
$cshowsPrec :: Int -&gt; MemBind -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621684387724"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier hs-type">MemBind</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-395"></span><span>  </span><span class="annot"><span class="annottext">MemBind
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684387723"><span class="annot"><span class="annottext">== :: MemBind -&gt; MemBind -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span class="annot"><span class="annottext">MemBind
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621684387708"><span id="local-6989586621684387710"><span id="local-6989586621684387712"><span id="local-6989586621684387714"><span id="local-6989586621684387716"><span id="local-6989586621684387718"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier hs-type">MemBind</span></a></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-398"></span><span>  </span><span class="annot"><span class="annottext">MemBind
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684387707"><span class="annot"><span class="annottext">compare :: MemBind -&gt; MemBind -&gt; Ordering
</span><span class="hs-operator hs-var hs-var hs-var hs-var">`compare`</span></span></span><span> </span><span class="annot"><span class="annottext">MemBind
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.Transform.Rename.html#Rename"><span class="hs-identifier hs-type">Rename</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier hs-type">MemBind</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-401"></span><span>  </span><span id="local-6989586621684387701"><span class="annot"><span class="annottext">rename :: MemBind -&gt; RenameM MemBind
</span><a href="#local-6989586621684387701"><span class="hs-identifier hs-var hs-var hs-var hs-var">rename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MemBind -&gt; RenameM MemBind
forall a. Substitute a =&gt; a -&gt; RenameM a
</span><a href="Futhark.Transform.Rename.html#substituteRename"><span class="hs-identifier hs-var">substituteRename</span></a></span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.Transform.Substitute.html#Substitute"><span class="hs-identifier hs-type">Substitute</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier hs-type">MemBind</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-404"></span><span>  </span><span id="local-6989586621684387694"><span class="annot"><span class="annottext">substituteNames :: Map VName VName -&gt; MemBind -&gt; MemBind
</span><a href="#local-6989586621684387694"><span class="hs-identifier hs-var hs-var hs-var hs-var">substituteNames</span></a></span></span><span> </span><span id="local-6989586621684387693"><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684387693"><span class="hs-identifier hs-var">substs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ArrayIn"><span class="hs-identifier hs-type">ArrayIn</span></a></span><span> </span><span id="local-6989586621684387692"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387692"><span class="hs-identifier hs-var">ident</span></a></span></span><span> </span><span id="local-6989586621684387691"><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684387691"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-405"></span><span>    </span><span class="annot"><span class="annottext">VName -&gt; IxFun -&gt; MemBind
</span><a href="Futhark.IR.Mem.html#ArrayIn"><span class="hs-identifier hs-var">ArrayIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map VName VName -&gt; VName -&gt; VName
forall a. Substitute a =&gt; Map VName VName -&gt; a -&gt; a
</span><a href="Futhark.Transform.Substitute.html#substituteNames"><span class="hs-identifier hs-var">substituteNames</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684387693"><span class="hs-identifier hs-var">substs</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387692"><span class="hs-identifier hs-var">ident</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map VName VName -&gt; IxFun -&gt; IxFun
forall a. Substitute a =&gt; Map VName VName -&gt; a -&gt; a
</span><a href="Futhark.Transform.Substitute.html#substituteNames"><span class="hs-identifier hs-var">substituteNames</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684387693"><span class="hs-identifier hs-var">substs</span></a></span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684387691"><span class="hs-identifier hs-var">ixfun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621684387686"><span id="local-6989586621684387688"><span class="annot"><span class="hs-identifier hs-type">PP.Pretty</span></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier hs-type">MemBind</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-408"></span><span>  </span><span id="local-6989586621684387677"><span class="annot"><span class="annottext">ppr :: MemBind -&gt; Doc
</span><a href="#local-6989586621684387677"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ArrayIn"><span class="hs-identifier hs-type">ArrayIn</span></a></span><span> </span><span id="local-6989586621684387676"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387676"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span id="local-6989586621684387675"><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684387675"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-409"></span><span>    </span><span class="annot"><span class="annottext">VName -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">PP.ppr</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387676"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;-&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">PP.&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">IxFun -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">PP.ppr</span></span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684387675"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#FreeIn"><span class="hs-identifier hs-type">FreeIn</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier hs-type">MemBind</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-412"></span><span>  </span><span id="local-6989586621684387666"><span class="annot"><span class="annottext">freeIn' :: MemBind -&gt; FV
</span><a href="#local-6989586621684387666"><span class="hs-identifier hs-var hs-var hs-var hs-var">freeIn'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ArrayIn"><span class="hs-identifier hs-type">ArrayIn</span></a></span><span> </span><span id="local-6989586621684387665"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387665"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span id="local-6989586621684387664"><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684387664"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; FV
forall a. FreeIn a =&gt; a -&gt; FV
</span><a href="Futhark.IR.Prop.Names.html#freeIn%27"><span class="hs-identifier hs-var">freeIn'</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387665"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">FV -&gt; FV -&gt; FV
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">IxFun -&gt; FV
forall a. FreeIn a =&gt; a -&gt; FV
</span><a href="Futhark.IR.Prop.Names.html#freeIn%27"><span class="hs-identifier hs-var">freeIn'</span></a></span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684387664"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span class="hs-comment">-- | A description of the memory properties of an array being returned</span><span>
</span><span id="line-415"></span><span class="hs-comment">-- by an operation.</span><span>
</span><span id="line-416"></span><span class="hs-keyword">data</span><span> </span><span id="MemReturn"><span class="annot"><a href="Futhark.IR.Mem.html#MemReturn"><span class="hs-identifier hs-var">MemReturn</span></a></span></span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | The array is located in a memory block that is</span><span>
</span><span id="line-418"></span><span>    </span><span class="hs-comment">-- already in scope.</span><span>
</span><span id="line-419"></span><span>    </span><span id="ReturnsInBlock"><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-var">ReturnsInBlock</span></a></span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#ExtIxFun"><span class="hs-identifier hs-type">ExtIxFun</span></a></span><span>
</span><span id="line-420"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | The operation returns a new (existential) memory</span><span>
</span><span id="line-421"></span><span>    </span><span class="hs-comment">-- block.</span><span>
</span><span id="line-422"></span><span>    </span><span id="ReturnsNewBlock"><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsNewBlock"><span class="hs-identifier hs-var">ReturnsNewBlock</span></a></span></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Space"><span class="hs-identifier hs-type">Space</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#ExtIxFun"><span class="hs-identifier hs-type">ExtIxFun</span></a></span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684387647"><span id="local-6989586621684387649"><span id="local-6989586621684387660"><span class="annot"><span class="annottext">Int -&gt; MemReturn -&gt; ShowS
[MemReturn] -&gt; ShowS
MemReturn -&gt; String
(Int -&gt; MemReturn -&gt; ShowS)
-&gt; (MemReturn -&gt; String)
-&gt; ([MemReturn] -&gt; ShowS)
-&gt; Show MemReturn
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [MemReturn] -&gt; ShowS
$cshowList :: [MemReturn] -&gt; ShowS
show :: MemReturn -&gt; String
$cshow :: MemReturn -&gt; String
showsPrec :: Int -&gt; MemReturn -&gt; ShowS
$cshowsPrec :: Int -&gt; MemReturn -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621684387643"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemReturn"><span class="hs-identifier hs-type">MemReturn</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-426"></span><span>  </span><span class="annot"><span class="annottext">MemReturn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684387642"><span class="annot"><span class="annottext">== :: MemReturn -&gt; MemReturn -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span class="annot"><span class="annottext">MemReturn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621684387627"><span id="local-6989586621684387629"><span id="local-6989586621684387631"><span id="local-6989586621684387633"><span id="local-6989586621684387635"><span id="local-6989586621684387637"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemReturn"><span class="hs-identifier hs-type">MemReturn</span></a></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-429"></span><span>  </span><span class="annot"><span class="annottext">MemReturn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684387626"><span class="annot"><span class="annottext">compare :: MemReturn -&gt; MemReturn -&gt; Ordering
</span><a href="#local-6989586621684387626"><span class="hs-operator hs-var hs-var hs-var hs-var">`compare`</span></a></span></span><span> </span><span class="annot"><span class="annottext">MemReturn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.Transform.Rename.html#Rename"><span class="hs-identifier hs-type">Rename</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemReturn"><span class="hs-identifier hs-type">MemReturn</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-432"></span><span>  </span><span id="local-6989586621684387621"><span class="annot"><span class="annottext">rename :: MemReturn -&gt; RenameM MemReturn
</span><a href="#local-6989586621684387621"><span class="hs-identifier hs-var hs-var hs-var hs-var">rename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MemReturn -&gt; RenameM MemReturn
forall a. Substitute a =&gt; a -&gt; RenameM a
</span><a href="Futhark.Transform.Rename.html#substituteRename"><span class="hs-identifier hs-var">substituteRename</span></a></span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.Transform.Substitute.html#Substitute"><span class="hs-identifier hs-type">Substitute</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemReturn"><span class="hs-identifier hs-type">MemReturn</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-435"></span><span>  </span><span id="local-6989586621684387613"><span class="annot"><span class="annottext">substituteNames :: Map VName VName -&gt; MemReturn -&gt; MemReturn
</span><a href="#local-6989586621684387613"><span class="hs-identifier hs-var hs-var hs-var hs-var">substituteNames</span></a></span></span><span> </span><span id="local-6989586621684387612"><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684387612"><span class="hs-identifier hs-var">substs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-type">ReturnsInBlock</span></a></span><span> </span><span id="local-6989586621684387611"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387611"><span class="hs-identifier hs-var">ident</span></a></span></span><span> </span><span id="local-6989586621684387610"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387610"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-436"></span><span>    </span><span class="annot"><span class="annottext">VName -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-var">ReturnsInBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map VName VName -&gt; VName -&gt; VName
forall a. Substitute a =&gt; Map VName VName -&gt; a -&gt; a
</span><a href="Futhark.Transform.Substitute.html#substituteNames"><span class="hs-identifier hs-var">substituteNames</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684387612"><span class="hs-identifier hs-var">substs</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387611"><span class="hs-identifier hs-var">ident</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map VName VName -&gt; ExtIxFun -&gt; ExtIxFun
forall a. Substitute a =&gt; Map VName VName -&gt; a -&gt; a
</span><a href="Futhark.Transform.Substitute.html#substituteNames"><span class="hs-identifier hs-var">substituteNames</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684387612"><span class="hs-identifier hs-var">substs</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387610"><span class="hs-identifier hs-var">ixfun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-437"></span><span>  </span><span class="annot"><a href="Futhark.Transform.Substitute.html#substituteNames"><span class="hs-identifier hs-var">substituteNames</span></a></span><span> </span><span id="local-6989586621684387609"><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684387609"><span class="hs-identifier hs-var">substs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsNewBlock"><span class="hs-identifier hs-type">ReturnsNewBlock</span></a></span><span> </span><span id="local-6989586621684387608"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387608"><span class="hs-identifier hs-var">space</span></a></span></span><span> </span><span id="local-6989586621684387607"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387607"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621684387606"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387606"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-438"></span><span>    </span><span class="annot"><span class="annottext">Space -&gt; Int -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsNewBlock"><span class="hs-identifier hs-var">ReturnsNewBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387608"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387607"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map VName VName -&gt; ExtIxFun -&gt; ExtIxFun
forall a. Substitute a =&gt; Map VName VName -&gt; a -&gt; a
</span><a href="Futhark.Transform.Substitute.html#substituteNames"><span class="hs-identifier hs-var">substituteNames</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684387609"><span class="hs-identifier hs-var">substs</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387606"><span class="hs-identifier hs-var">ixfun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#FixExt"><span class="hs-identifier hs-type">FixExt</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemReturn"><span class="hs-identifier hs-type">MemReturn</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-441"></span><span>  </span><span id="local-6989586621684387600"><span class="annot"><span class="annottext">fixExt :: Int -&gt; SubExp -&gt; MemReturn -&gt; MemReturn
</span><a href="#local-6989586621684387600"><span class="hs-identifier hs-var hs-var hs-var hs-var">fixExt</span></a></span></span><span> </span><span id="local-6989586621684387599"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387599"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684387597"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387597"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsNewBlock"><span class="hs-identifier hs-type">ReturnsNewBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684387596"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387596"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span id="local-6989586621684387595"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387595"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387596"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387599"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-443"></span><span>      </span><span class="annot"><span class="annottext">VName -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-var">ReturnsInBlock</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387597"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(ExtIxFun -&gt; MemReturn) -&gt; ExtIxFun -&gt; MemReturn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-444"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; PrimExp VName -&gt; ExtIxFun -&gt; ExtIxFun
</span><a href="Futhark.IR.Mem.html#fixExtIxFun"><span class="hs-identifier hs-var">fixExtIxFun</span></a></span><span>
</span><span id="line-445"></span><span>          </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387599"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-446"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType -&gt; SubExp -&gt; PrimExp VName
</span><a href="Futhark.Analysis.PrimExp.Convert.html#primExpFromSubExp"><span class="hs-identifier hs-var">primExpFromSubExp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Prop.Types.html#int64"><span class="hs-identifier hs-var">int64</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; SubExp
</span><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387597"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-447"></span><span>          </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387595"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-448"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#fixExt"><span class="hs-identifier hs-var">fixExt</span></a></span><span> </span><span id="local-6989586621684387591"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387591"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621684387590"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684387590"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsNewBlock"><span class="hs-identifier hs-type">ReturnsNewBlock</span></a></span><span> </span><span id="local-6989586621684387589"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387589"><span class="hs-identifier hs-var">space</span></a></span></span><span> </span><span id="local-6989586621684387588"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387588"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span id="local-6989586621684387587"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387587"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-449"></span><span>    </span><span class="annot"><span class="annottext">Space -&gt; Int -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsNewBlock"><span class="hs-identifier hs-var">ReturnsNewBlock</span></a></span><span>
</span><span id="line-450"></span><span>      </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387589"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-451"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387586"><span class="hs-identifier hs-var">j'</span></a></span><span>
</span><span id="line-452"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PrimExp VName -&gt; ExtIxFun -&gt; ExtIxFun
</span><a href="Futhark.IR.Mem.html#fixExtIxFun"><span class="hs-identifier hs-var">fixExtIxFun</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387591"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType -&gt; SubExp -&gt; PrimExp VName
</span><a href="Futhark.Analysis.PrimExp.Convert.html#primExpFromSubExp"><span class="hs-identifier hs-var">primExpFromSubExp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Prop.Types.html#int64"><span class="hs-identifier hs-var">int64</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684387590"><span class="hs-identifier hs-var">se</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387587"><span class="hs-identifier hs-var">ixfun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-454"></span><span>      </span><span id="local-6989586621684387586"><span class="annot"><span class="annottext">j' :: Int
</span><a href="#local-6989586621684387586"><span class="hs-identifier hs-var hs-var">j'</span></a></span></span><span>
</span><span id="line-455"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387591"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387588"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387588"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-456"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387588"><span class="hs-identifier hs-var">j</span></a></span><span>
</span><span id="line-457"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#fixExt"><span class="hs-identifier hs-var">fixExt</span></a></span><span> </span><span id="local-6989586621684387584"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387584"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621684387583"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684387583"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-type">ReturnsInBlock</span></a></span><span> </span><span id="local-6989586621684387582"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387582"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span id="local-6989586621684387581"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387581"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-458"></span><span>    </span><span class="annot"><span class="annottext">VName -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-var">ReturnsInBlock</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387582"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PrimExp VName -&gt; ExtIxFun -&gt; ExtIxFun
</span><a href="Futhark.IR.Mem.html#fixExtIxFun"><span class="hs-identifier hs-var">fixExtIxFun</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387584"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType -&gt; SubExp -&gt; PrimExp VName
</span><a href="Futhark.Analysis.PrimExp.Convert.html#primExpFromSubExp"><span class="hs-identifier hs-var">primExpFromSubExp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Prop.Types.html#int64"><span class="hs-identifier hs-var">int64</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684387583"><span class="hs-identifier hs-var">se</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387581"><span class="hs-identifier hs-var">ixfun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span class="annot"><a href="Futhark.IR.Mem.html#fixExtIxFun"><span class="hs-identifier hs-type">fixExtIxFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.PrimExp.html#PrimExp"><span class="hs-identifier hs-type">PrimExp</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#ExtIxFun"><span class="hs-identifier hs-type">ExtIxFun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#ExtIxFun"><span class="hs-identifier hs-type">ExtIxFun</span></a></span><span>
</span><span id="line-461"></span><span id="fixExtIxFun"><span class="annot"><span class="annottext">fixExtIxFun :: Int -&gt; PrimExp VName -&gt; ExtIxFun -&gt; ExtIxFun
</span><a href="Futhark.IR.Mem.html#fixExtIxFun"><span class="hs-identifier hs-var hs-var">fixExtIxFun</span></a></span></span><span> </span><span id="local-6989586621684387580"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387580"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621684387579"><span class="annot"><span class="annottext">PrimExp VName
</span><a href="#local-6989586621684387579"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TPrimExp Int64 (Ext VName) -&gt; TPrimExp Int64 (Ext VName))
-&gt; ExtIxFun -&gt; ExtIxFun
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((TPrimExp Int64 (Ext VName) -&gt; TPrimExp Int64 (Ext VName))
 -&gt; ExtIxFun -&gt; ExtIxFun)
-&gt; (TPrimExp Int64 (Ext VName) -&gt; TPrimExp Int64 (Ext VName))
-&gt; ExtIxFun
-&gt; ExtIxFun
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimExp (Ext VName) -&gt; TPrimExp Int64 (Ext VName)
forall v. PrimExp v -&gt; TPrimExp Int64 v
</span><a href="Futhark.Analysis.PrimExp.html#isInt64"><span class="hs-identifier hs-var">isInt64</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimExp (Ext VName) -&gt; TPrimExp Int64 (Ext VName))
-&gt; (TPrimExp Int64 (Ext VName) -&gt; PrimExp (Ext VName))
-&gt; TPrimExp Int64 (Ext VName)
-&gt; TPrimExp Int64 (Ext VName)
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Ext VName -&gt; PrimType -&gt; PrimExp (Ext VName))
-&gt; PrimExp (Ext VName) -&gt; PrimExp (Ext VName)
forall a b. (a -&gt; PrimType -&gt; PrimExp b) -&gt; PrimExp a -&gt; PrimExp b
</span><a href="Futhark.Analysis.PrimExp.Convert.html#replaceInPrimExp"><span class="hs-identifier hs-var">replaceInPrimExp</span></a></span><span> </span><span class="annot"><span class="annottext">Ext VName -&gt; PrimType -&gt; PrimExp (Ext VName)
</span><a href="#local-6989586621684387577"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimExp (Ext VName) -&gt; PrimExp (Ext VName))
-&gt; (TPrimExp Int64 (Ext VName) -&gt; PrimExp (Ext VName))
-&gt; TPrimExp Int64 (Ext VName)
-&gt; PrimExp (Ext VName)
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TPrimExp Int64 (Ext VName) -&gt; PrimExp (Ext VName)
forall t v. TPrimExp t v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#untyped"><span class="hs-identifier hs-var hs-var">untyped</span></a></span><span>
</span><span id="line-462"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-463"></span><span>    </span><span id="local-6989586621684387577"><span class="annot"><span class="annottext">update :: Ext VName -&gt; PrimType -&gt; PrimExp (Ext VName)
</span><a href="#local-6989586621684387577"><span class="hs-identifier hs-var hs-var">update</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span id="local-6989586621684387576"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387576"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684387575"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387575"><span class="hs-identifier hs-var">t</span></a></span></span><span>
</span><span id="line-464"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387576"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387580"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ext VName -&gt; PrimType -&gt; PrimExp (Ext VName)
forall v. v -&gt; PrimType -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#LeafExp"><span class="hs-identifier hs-var">LeafExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ext VName
forall a. Int -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Ext VName) -&gt; Int -&gt; Ext VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387576"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387575"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-465"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387576"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387580"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Ext VName) -&gt; PrimExp VName -&gt; PrimExp (Ext VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Ext VName
forall a. a -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-var">Free</span></a></span><span> </span><span class="annot"><span class="annottext">PrimExp VName
</span><a href="#local-6989586621684387579"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-466"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ext VName -&gt; PrimType -&gt; PrimExp (Ext VName)
forall v. v -&gt; PrimType -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#LeafExp"><span class="hs-identifier hs-var">LeafExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ext VName
forall a. Int -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387576"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387575"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-467"></span><span>    </span><span class="annot"><a href="#local-6989586621684387577"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-type">Free</span></a></span><span> </span><span id="local-6989586621684387572"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387572"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684387571"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387571"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ext VName -&gt; PrimType -&gt; PrimExp (Ext VName)
forall v. v -&gt; PrimType -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#LeafExp"><span class="hs-identifier hs-var">LeafExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Ext VName
forall a. a -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-var">Free</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387572"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387571"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span id="local-6989586621684389059"><span class="annot"><a href="Futhark.IR.Mem.html#leafExp"><span class="hs-identifier hs-type">leafExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.PrimExp.html#TPrimExp"><span class="hs-identifier hs-type">TPrimExp</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389059"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-470"></span><span id="leafExp"><span class="annot"><span class="annottext">leafExp :: forall a. Int -&gt; TPrimExp Int64 (Ext a)
</span><a href="Futhark.IR.Mem.html#leafExp"><span class="hs-identifier hs-var hs-var">leafExp</span></a></span></span><span> </span><span id="local-6989586621684387569"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387569"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimExp (Ext a) -&gt; TPrimExp Int64 (Ext a)
forall v. PrimExp v -&gt; TPrimExp Int64 v
</span><a href="Futhark.Analysis.PrimExp.html#isInt64"><span class="hs-identifier hs-var">isInt64</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimExp (Ext a) -&gt; TPrimExp Int64 (Ext a))
-&gt; PrimExp (Ext a) -&gt; TPrimExp Int64 (Ext a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ext a -&gt; PrimType -&gt; PrimExp (Ext a)
forall v. v -&gt; PrimType -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#LeafExp"><span class="hs-identifier hs-var">LeafExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ext a
forall a. Int -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387569"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Prop.Types.html#int64"><span class="hs-identifier hs-var">int64</span></a></span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span class="annot"><a href="Futhark.IR.Mem.html#existentialiseIxFun"><span class="hs-identifier hs-type">existentialiseIxFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#IxFun"><span class="hs-identifier hs-type">IxFun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#ExtIxFun"><span class="hs-identifier hs-type">ExtIxFun</span></a></span><span>
</span><span id="line-473"></span><span id="existentialiseIxFun"><span class="annot"><span class="annottext">existentialiseIxFun :: [VName] -&gt; IxFun -&gt; ExtIxFun
</span><a href="Futhark.IR.Mem.html#existentialiseIxFun"><span class="hs-identifier hs-var hs-var">existentialiseIxFun</span></a></span></span><span> </span><span id="local-6989586621684387568"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684387568"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
-&gt; ExtIxFun -&gt; ExtIxFun
forall a t.
Ord a =&gt;
Map a (TPrimExp t a)
-&gt; IxFun (TPrimExp t a) -&gt; IxFun (TPrimExp t a)
</span><a href="Futhark.IR.Mem.IxFun.html#substituteInIxFun"><span class="hs-identifier hs-var">IxFun.substituteInIxFun</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><a href="#local-6989586621684387566"><span class="hs-identifier hs-var">ctx'</span></a></span><span> </span><span class="annot"><span class="annottext">(ExtIxFun -&gt; ExtIxFun) -&gt; (IxFun -&gt; ExtIxFun) -&gt; IxFun -&gt; ExtIxFun
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TPrimExp Int64 VName -&gt; TPrimExp Int64 (Ext VName))
-&gt; IxFun -&gt; ExtIxFun
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(VName -&gt; Ext VName)
-&gt; TPrimExp Int64 VName -&gt; TPrimExp Int64 (Ext VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Ext VName
forall a. a -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-var">Free</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-475"></span><span>    </span><span id="local-6989586621684387566"><span class="annot"><span class="annottext">ctx' :: Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><a href="#local-6989586621684387566"><span class="hs-identifier hs-var hs-var">ctx'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; TPrimExp Int64 (Ext VName))
-&gt; Map (Ext VName) Int
-&gt; Map (Ext VName) (TPrimExp Int64 (Ext VName))
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TPrimExp Int64 (Ext VName)
forall a. Int -&gt; TPrimExp Int64 (Ext a)
</span><a href="Futhark.IR.Mem.html#leafExp"><span class="hs-identifier hs-var">leafExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (Ext VName) Int
 -&gt; Map (Ext VName) (TPrimExp Int64 (Ext VName)))
-&gt; Map (Ext VName) Int
-&gt; Map (Ext VName) (TPrimExp Int64 (Ext VName))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Ext VName, Int)] -&gt; Map (Ext VName) Int
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Ext VName, Int)] -&gt; Map (Ext VName) Int)
-&gt; [(Ext VName, Int)] -&gt; Map (Ext VName) Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Ext VName] -&gt; [Int] -&gt; [(Ext VName, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(VName -&gt; Ext VName) -&gt; [VName] -&gt; [Ext VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Ext VName
forall a. a -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-var">Free</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684387568"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621684387559"><span id="local-6989586621684387561"><span class="annot"><span class="hs-identifier hs-type">PP.Pretty</span></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemReturn"><span class="hs-identifier hs-type">MemReturn</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-478"></span><span>  </span><span id="local-6989586621684387544"><span class="annot"><span class="annottext">ppr :: MemReturn -&gt; Doc
</span><a href="#local-6989586621684387544"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-type">ReturnsInBlock</span></a></span><span> </span><span id="local-6989586621684387543"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387543"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621684387542"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387542"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-479"></span><span>    </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><span class="hs-identifier hs-var">PP.parens</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; Doc -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387543"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;-&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">PP.&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">ExtIxFun -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">PP.ppr</span></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387542"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-480"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsNewBlock"><span class="hs-identifier hs-type">ReturnsNewBlock</span></a></span><span> </span><span id="local-6989586621684387540"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387540"><span class="hs-identifier hs-var">space</span></a></span></span><span> </span><span id="local-6989586621684387539"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387539"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621684387538"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387538"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-481"></span><span>    </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;?&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387539"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Space -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">PP.ppr</span></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387540"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;-&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">PP.&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">ExtIxFun -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">PP.ppr</span></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387538"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-482"></span><span>
</span><span id="line-483"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#FreeIn"><span class="hs-identifier hs-type">FreeIn</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemReturn"><span class="hs-identifier hs-type">MemReturn</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-484"></span><span>  </span><span id="local-6989586621684387526"><span class="annot"><span class="annottext">freeIn' :: MemReturn -&gt; FV
</span><a href="#local-6989586621684387526"><span class="hs-identifier hs-var hs-var hs-var hs-var">freeIn'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-type">ReturnsInBlock</span></a></span><span> </span><span id="local-6989586621684387525"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387525"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621684387524"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387524"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; FV
forall a. FreeIn a =&gt; a -&gt; FV
</span><a href="Futhark.IR.Prop.Names.html#freeIn%27"><span class="hs-identifier hs-var">freeIn'</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387525"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">FV -&gt; FV -&gt; FV
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ExtIxFun -&gt; FV
forall a. FreeIn a =&gt; a -&gt; FV
</span><a href="Futhark.IR.Prop.Names.html#freeIn%27"><span class="hs-identifier hs-var">freeIn'</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387524"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-485"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#freeIn%27"><span class="hs-identifier hs-var">freeIn'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsNewBlock"><span class="hs-identifier hs-type">ReturnsNewBlock</span></a></span><span> </span><span id="local-6989586621684387523"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387523"><span class="hs-identifier hs-var">space</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684387522"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387522"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Space -&gt; FV
forall a. FreeIn a =&gt; a -&gt; FV
</span><a href="Futhark.IR.Prop.Names.html#freeIn%27"><span class="hs-identifier hs-var">freeIn'</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387523"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">FV -&gt; FV -&gt; FV
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ExtIxFun -&gt; FV
forall a. FreeIn a =&gt; a -&gt; FV
</span><a href="Futhark.IR.Prop.Names.html#freeIn%27"><span class="hs-identifier hs-var">freeIn'</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387522"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.Optimise.Simplify.Engine.html#Simplifiable"><span class="hs-identifier hs-type">Engine.Simplifiable</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemReturn"><span class="hs-identifier hs-type">MemReturn</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-488"></span><span>  </span><span id="local-6989586621684387504"><span class="annot"><span class="annottext">simplify :: forall rep.
SimplifiableRep rep =&gt;
MemReturn -&gt; SimpleM rep MemReturn
</span><a href="#local-6989586621684387504"><span class="hs-identifier hs-var hs-var hs-var hs-var">simplify</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsNewBlock"><span class="hs-identifier hs-type">ReturnsNewBlock</span></a></span><span> </span><span id="local-6989586621684387503"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387503"><span class="hs-identifier hs-var">space</span></a></span></span><span> </span><span id="local-6989586621684387502"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387502"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621684387501"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387501"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-489"></span><span>    </span><span class="annot"><span class="annottext">Space -&gt; Int -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsNewBlock"><span class="hs-identifier hs-var">ReturnsNewBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387503"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387502"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(ExtIxFun -&gt; MemReturn)
-&gt; SimpleM rep ExtIxFun -&gt; SimpleM rep MemReturn
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ExtIxFun -&gt; SimpleM rep ExtIxFun
forall rep. SimplifiableRep rep =&gt; ExtIxFun -&gt; SimpleM rep ExtIxFun
</span><a href="Futhark.IR.Mem.html#simplifyExtIxFun"><span class="hs-identifier hs-var">simplifyExtIxFun</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387501"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-490"></span><span>  </span><span class="annot"><a href="Futhark.Optimise.Simplify.Engine.html#simplify"><span class="hs-identifier hs-var">simplify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-type">ReturnsInBlock</span></a></span><span> </span><span id="local-6989586621684387500"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387500"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621684387499"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387499"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-491"></span><span>    </span><span class="annot"><span class="annottext">VName -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-var">ReturnsInBlock</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; ExtIxFun -&gt; MemReturn)
-&gt; SimpleM rep VName -&gt; SimpleM rep (ExtIxFun -&gt; MemReturn)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; SimpleM rep VName
forall e rep.
(Simplifiable e, SimplifiableRep rep) =&gt;
e -&gt; SimpleM rep e
</span><a href="Futhark.Optimise.Simplify.Engine.html#simplify"><span class="hs-identifier hs-var">Engine.simplify</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387500"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleM rep (ExtIxFun -&gt; MemReturn)
-&gt; SimpleM rep ExtIxFun -&gt; SimpleM rep MemReturn
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">ExtIxFun -&gt; SimpleM rep ExtIxFun
forall rep. SimplifiableRep rep =&gt; ExtIxFun -&gt; SimpleM rep ExtIxFun
</span><a href="Futhark.IR.Mem.html#simplifyExtIxFun"><span class="hs-identifier hs-var">simplifyExtIxFun</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387499"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.Optimise.Simplify.Engine.html#Simplifiable"><span class="hs-identifier hs-type">Engine.Simplifiable</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier hs-type">MemBind</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-494"></span><span>  </span><span id="local-6989586621684387483"><span class="annot"><span class="annottext">simplify :: forall rep. SimplifiableRep rep =&gt; MemBind -&gt; SimpleM rep MemBind
</span><a href="#local-6989586621684387483"><span class="hs-identifier hs-var hs-var hs-var hs-var">simplify</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ArrayIn"><span class="hs-identifier hs-type">ArrayIn</span></a></span><span> </span><span id="local-6989586621684387482"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387482"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span id="local-6989586621684387481"><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684387481"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-495"></span><span>    </span><span class="annot"><span class="annottext">VName -&gt; IxFun -&gt; MemBind
</span><a href="Futhark.IR.Mem.html#ArrayIn"><span class="hs-identifier hs-var">ArrayIn</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; IxFun -&gt; MemBind)
-&gt; SimpleM rep VName -&gt; SimpleM rep (IxFun -&gt; MemBind)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; SimpleM rep VName
forall e rep.
(Simplifiable e, SimplifiableRep rep) =&gt;
e -&gt; SimpleM rep e
</span><a href="Futhark.Optimise.Simplify.Engine.html#simplify"><span class="hs-identifier hs-var">Engine.simplify</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387482"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleM rep (IxFun -&gt; MemBind)
-&gt; SimpleM rep IxFun -&gt; SimpleM rep MemBind
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">IxFun -&gt; SimpleM rep IxFun
forall rep. SimplifiableRep rep =&gt; IxFun -&gt; SimpleM rep IxFun
</span><a href="Futhark.IR.Mem.html#simplifyIxFun"><span class="hs-identifier hs-var">simplifyIxFun</span></a></span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684387481"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.Optimise.Simplify.Engine.html#Simplifiable"><span class="hs-identifier hs-type">Engine.Simplifiable</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Mem.html#FunReturns"><span class="hs-identifier hs-type">FunReturns</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-498"></span><span>  </span><span id="local-6989586621684387463"><span class="annot"><span class="annottext">simplify :: forall rep.
SimplifiableRep rep =&gt;
[FunReturns] -&gt; SimpleM rep [FunReturns]
</span><a href="#local-6989586621684387463"><span class="hs-identifier hs-var hs-var hs-var hs-var">simplify</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FunReturns -&gt; SimpleM rep FunReturns)
-&gt; [FunReturns] -&gt; SimpleM rep [FunReturns]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">FunReturns -&gt; SimpleM rep FunReturns
forall e rep.
(Simplifiable e, SimplifiableRep rep) =&gt;
e -&gt; SimpleM rep e
</span><a href="Futhark.Optimise.Simplify.Engine.html#simplify"><span class="hs-identifier hs-var">Engine.simplify</span></a></span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span class="hs-comment">-- | The memory return of an expression.  An array is annotated with</span><span>
</span><span id="line-501"></span><span class="hs-comment">-- @Maybe MemReturn@, which can be interpreted as the expression</span><span>
</span><span id="line-502"></span><span class="hs-comment">-- either dictating exactly where the array is located when it is</span><span>
</span><span id="line-503"></span><span class="hs-comment">-- returned (if 'Just'), or able to put it whereever the binding</span><span>
</span><span id="line-504"></span><span class="hs-comment">-- prefers (if 'Nothing').</span><span>
</span><span id="line-505"></span><span class="hs-comment">--</span><span>
</span><span id="line-506"></span><span class="hs-comment">-- This is necessary to capture the difference between an expression</span><span>
</span><span id="line-507"></span><span class="hs-comment">-- that is just an array-typed variable, in which the array being</span><span>
</span><span id="line-508"></span><span class="hs-comment">-- &quot;returned&quot; is located where it already is, and a @copy@ expression,</span><span>
</span><span id="line-509"></span><span class="hs-comment">-- whose entire purpose is to store an existing array in some</span><span>
</span><span id="line-510"></span><span class="hs-comment">-- arbitrary location.  This is a consequence of the design decision</span><span>
</span><span id="line-511"></span><span class="hs-comment">-- never to have implicit memory copies.</span><span>
</span><span id="line-512"></span><span class="hs-keyword">type</span><span> </span><span id="ExpReturns"><span class="annot"><a href="Futhark.IR.Mem.html#ExpReturns"><span class="hs-identifier hs-var">ExpReturns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ExtSize"><span class="hs-identifier hs-type">ExtSize</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-type">NoUniqueness</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemReturn"><span class="hs-identifier hs-type">MemReturn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span class="hs-comment">-- | The return of a body, which must always indicate where</span><span>
</span><span id="line-515"></span><span class="hs-comment">-- returned arrays are located.</span><span>
</span><span id="line-516"></span><span class="hs-keyword">type</span><span> </span><span id="BodyReturns"><span class="annot"><a href="Futhark.IR.Mem.html#BodyReturns"><span class="hs-identifier hs-var">BodyReturns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ExtSize"><span class="hs-identifier hs-type">ExtSize</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-type">NoUniqueness</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemReturn"><span class="hs-identifier hs-type">MemReturn</span></a></span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span class="hs-comment">-- | The memory return of a function, which must always indicate where</span><span>
</span><span id="line-519"></span><span class="hs-comment">-- returned arrays are located.</span><span>
</span><span id="line-520"></span><span class="hs-keyword">type</span><span> </span><span id="FunReturns"><span class="annot"><a href="Futhark.IR.Mem.html#FunReturns"><span class="hs-identifier hs-var">FunReturns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ExtSize"><span class="hs-identifier hs-type">ExtSize</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Uniqueness"><span class="hs-identifier hs-type">Uniqueness</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemReturn"><span class="hs-identifier hs-type">MemReturn</span></a></span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span id="local-6989586621684389036"><span id="local-6989586621684389037"><span id="local-6989586621684389038"><span class="annot"><a href="Futhark.IR.Mem.html#maybeReturns"><span class="hs-identifier hs-type">maybeReturns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389038"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389037"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389036"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389038"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389037"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621684389036"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-523"></span><span id="maybeReturns"><span class="annot"><span class="annottext">maybeReturns :: forall d u r. MemInfo d u r -&gt; MemInfo d u (Maybe r)
</span><a href="Futhark.IR.Mem.html#maybeReturns"><span class="hs-identifier hs-var hs-var">maybeReturns</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span id="local-6989586621684387460"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387460"><span class="hs-identifier hs-var">bt</span></a></span></span><span> </span><span id="local-6989586621684387459"><span class="annot"><span class="annottext">ShapeBase d
</span><a href="#local-6989586621684387459"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span id="local-6989586621684387458"><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684387458"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621684387457"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621684387457"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-524"></span><span>  </span><span class="annot"><span class="annottext">PrimType -&gt; ShapeBase d -&gt; u -&gt; Maybe r -&gt; MemInfo d u (Maybe r)
forall d u ret.
PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387460"><span class="hs-identifier hs-var">bt</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase d
</span><a href="#local-6989586621684387459"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684387458"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe r -&gt; MemInfo d u (Maybe r))
-&gt; Maybe r -&gt; MemInfo d u (Maybe r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">r -&gt; Maybe r
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621684387457"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-525"></span><span class="annot"><a href="Futhark.IR.Mem.html#maybeReturns"><span class="hs-identifier hs-var">maybeReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span id="local-6989586621684387456"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387456"><span class="hs-identifier hs-var">bt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-526"></span><span>  </span><span class="annot"><span class="annottext">PrimType -&gt; MemInfo d u (Maybe r)
forall d u ret. PrimType -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387456"><span class="hs-identifier hs-var">bt</span></a></span><span>
</span><span id="line-527"></span><span class="annot"><a href="Futhark.IR.Mem.html#maybeReturns"><span class="hs-identifier hs-var">maybeReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684387455"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387455"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-528"></span><span>  </span><span class="annot"><span class="annottext">Space -&gt; MemInfo d u (Maybe r)
forall d u ret. Space -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-var">MemMem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387455"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-529"></span><span class="annot"><a href="Futhark.IR.Mem.html#maybeReturns"><span class="hs-identifier hs-var">maybeReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684387454"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387454"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684387453"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387453"><span class="hs-identifier hs-var">ispace</span></a></span></span><span> </span><span id="local-6989586621684387452"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387452"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621684387451"><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684387451"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-530"></span><span>  </span><span class="annot"><span class="annottext">VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; MemInfo d u (Maybe r)
forall d u ret. VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-var">MemAcc</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387454"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387453"><span class="hs-identifier hs-var">ispace</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387452"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684387451"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span id="local-6989586621684389030"><span id="local-6989586621684389031"><span id="local-6989586621684389032"><span class="annot"><a href="Futhark.IR.Mem.html#noUniquenessReturns"><span class="hs-identifier hs-type">noUniquenessReturns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389032"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389031"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389030"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389032"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-type">NoUniqueness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389030"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-533"></span><span id="noUniquenessReturns"><span class="annot"><span class="annottext">noUniquenessReturns :: forall d u r. MemInfo d u r -&gt; MemInfo d NoUniqueness r
</span><a href="Futhark.IR.Mem.html#noUniquenessReturns"><span class="hs-identifier hs-var hs-var">noUniquenessReturns</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span id="local-6989586621684387450"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387450"><span class="hs-identifier hs-var">bt</span></a></span></span><span> </span><span id="local-6989586621684387449"><span class="annot"><span class="annottext">ShapeBase d
</span><a href="#local-6989586621684387449"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span class="annot"><span class="annottext">u
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684387448"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621684387448"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-534"></span><span>  </span><span class="annot"><span class="annottext">PrimType
-&gt; ShapeBase d -&gt; NoUniqueness -&gt; r -&gt; MemInfo d NoUniqueness r
forall d u ret.
PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387450"><span class="hs-identifier hs-var">bt</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase d
</span><a href="#local-6989586621684387449"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-var">NoUniqueness</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621684387448"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-535"></span><span class="annot"><a href="Futhark.IR.Mem.html#noUniquenessReturns"><span class="hs-identifier hs-var">noUniquenessReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span id="local-6989586621684387447"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387447"><span class="hs-identifier hs-var">bt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-536"></span><span>  </span><span class="annot"><span class="annottext">PrimType -&gt; MemInfo d NoUniqueness r
forall d u ret. PrimType -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387447"><span class="hs-identifier hs-var">bt</span></a></span><span>
</span><span id="line-537"></span><span class="annot"><a href="Futhark.IR.Mem.html#noUniquenessReturns"><span class="hs-identifier hs-var">noUniquenessReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684387446"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387446"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-538"></span><span>  </span><span class="annot"><span class="annottext">Space -&gt; MemInfo d NoUniqueness r
forall d u ret. Space -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-var">MemMem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387446"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-539"></span><span class="annot"><a href="Futhark.IR.Mem.html#noUniquenessReturns"><span class="hs-identifier hs-var">noUniquenessReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684387445"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387445"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684387444"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387444"><span class="hs-identifier hs-var">ispace</span></a></span></span><span> </span><span id="local-6989586621684387443"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387443"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="annot"><span class="annottext">u
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-540"></span><span>  </span><span class="annot"><span class="annottext">VName
-&gt; Shape -&gt; [Type] -&gt; NoUniqueness -&gt; MemInfo d NoUniqueness r
forall d u ret. VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-var">MemAcc</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387445"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387444"><span class="hs-identifier hs-var">ispace</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387443"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-var">NoUniqueness</span></a></span><span>
</span><span id="line-541"></span><span>
</span><span id="line-542"></span><span class="annot"><a href="Futhark.IR.Mem.html#funReturnsToExpReturns"><span class="hs-identifier hs-type">funReturnsToExpReturns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#FunReturns"><span class="hs-identifier hs-type">FunReturns</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#ExpReturns"><span class="hs-identifier hs-type">ExpReturns</span></a></span><span>
</span><span id="line-543"></span><span id="funReturnsToExpReturns"><span class="annot"><span class="annottext">funReturnsToExpReturns :: FunReturns -&gt; ExpReturns
</span><a href="Futhark.IR.Mem.html#funReturnsToExpReturns"><span class="hs-identifier hs-var hs-var">funReturnsToExpReturns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MemInfo (Ext SubExp) Uniqueness (Maybe MemReturn) -&gt; ExpReturns
forall d u r. MemInfo d u r -&gt; MemInfo d NoUniqueness r
</span><a href="Futhark.IR.Mem.html#noUniquenessReturns"><span class="hs-identifier hs-var">noUniquenessReturns</span></a></span><span> </span><span class="annot"><span class="annottext">(MemInfo (Ext SubExp) Uniqueness (Maybe MemReturn) -&gt; ExpReturns)
-&gt; (FunReturns
    -&gt; MemInfo (Ext SubExp) Uniqueness (Maybe MemReturn))
-&gt; FunReturns
-&gt; ExpReturns
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FunReturns -&gt; MemInfo (Ext SubExp) Uniqueness (Maybe MemReturn)
forall d u r. MemInfo d u r -&gt; MemInfo d u (Maybe r)
</span><a href="Futhark.IR.Mem.html#maybeReturns"><span class="hs-identifier hs-var">maybeReturns</span></a></span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span class="annot"><a href="Futhark.IR.Mem.html#bodyReturnsToExpReturns"><span class="hs-identifier hs-type">bodyReturnsToExpReturns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#BodyReturns"><span class="hs-identifier hs-type">BodyReturns</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#ExpReturns"><span class="hs-identifier hs-type">ExpReturns</span></a></span><span>
</span><span id="line-546"></span><span id="bodyReturnsToExpReturns"><span class="annot"><span class="annottext">bodyReturnsToExpReturns :: BodyReturns -&gt; ExpReturns
</span><a href="Futhark.IR.Mem.html#bodyReturnsToExpReturns"><span class="hs-identifier hs-var hs-var">bodyReturnsToExpReturns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExpReturns -&gt; ExpReturns
forall d u r. MemInfo d u r -&gt; MemInfo d NoUniqueness r
</span><a href="Futhark.IR.Mem.html#noUniquenessReturns"><span class="hs-identifier hs-var">noUniquenessReturns</span></a></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; ExpReturns)
-&gt; (BodyReturns -&gt; ExpReturns) -&gt; BodyReturns -&gt; ExpReturns
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BodyReturns -&gt; ExpReturns
forall d u r. MemInfo d u r -&gt; MemInfo d u (Maybe r)
</span><a href="Futhark.IR.Mem.html#maybeReturns"><span class="hs-identifier hs-var">maybeReturns</span></a></span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span class="annot"><a href="Futhark.IR.Mem.html#varInfoToExpReturns"><span class="hs-identifier hs-type">varInfoToExpReturns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-type">NoUniqueness</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier hs-type">MemBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#ExpReturns"><span class="hs-identifier hs-type">ExpReturns</span></a></span><span>
</span><span id="line-549"></span><span id="varInfoToExpReturns"><span class="annot"><span class="annottext">varInfoToExpReturns :: LetDecMem -&gt; ExpReturns
</span><a href="Futhark.IR.Mem.html#varInfoToExpReturns"><span class="hs-identifier hs-var hs-var">varInfoToExpReturns</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span id="local-6989586621684387440"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387440"><span class="hs-identifier hs-var">et</span></a></span></span><span> </span><span id="local-6989586621684387439"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387439"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span id="local-6989586621684387438"><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684387438"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ArrayIn"><span class="hs-identifier hs-type">ArrayIn</span></a></span><span> </span><span id="local-6989586621684387437"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387437"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span id="local-6989586621684387436"><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684387436"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-550"></span><span>  </span><span class="annot"><span class="annottext">PrimType
-&gt; ShapeBase (Ext SubExp)
-&gt; NoUniqueness
-&gt; Maybe MemReturn
-&gt; ExpReturns
forall d u ret.
PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387440"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SubExp -&gt; Ext SubExp) -&gt; Shape -&gt; ShapeBase (Ext SubExp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; Ext SubExp
forall a. a -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-var">Free</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387439"><span class="hs-identifier hs-var">shape</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684387438"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe MemReturn -&gt; ExpReturns) -&gt; Maybe MemReturn -&gt; ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-551"></span><span>    </span><span class="annot"><span class="annottext">MemReturn -&gt; Maybe MemReturn
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(MemReturn -&gt; Maybe MemReturn) -&gt; MemReturn -&gt; Maybe MemReturn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-var">ReturnsInBlock</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387437"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">(ExtIxFun -&gt; MemReturn) -&gt; ExtIxFun -&gt; MemReturn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; IxFun -&gt; ExtIxFun
</span><a href="Futhark.IR.Mem.html#existentialiseIxFun"><span class="hs-identifier hs-var">existentialiseIxFun</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684387436"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-552"></span><span class="annot"><a href="Futhark.IR.Mem.html#varInfoToExpReturns"><span class="hs-identifier hs-var">varInfoToExpReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span id="local-6989586621684387435"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387435"><span class="hs-identifier hs-var">pt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; ExpReturns
forall d u ret. PrimType -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387435"><span class="hs-identifier hs-var">pt</span></a></span><span>
</span><span id="line-553"></span><span class="annot"><a href="Futhark.IR.Mem.html#varInfoToExpReturns"><span class="hs-identifier hs-var">varInfoToExpReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684387434"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387434"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684387433"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387433"><span class="hs-identifier hs-var">ispace</span></a></span></span><span> </span><span id="local-6989586621684387432"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387432"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621684387431"><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684387431"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Shape -&gt; [Type] -&gt; NoUniqueness -&gt; ExpReturns
forall d u ret. VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-var">MemAcc</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387434"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387433"><span class="hs-identifier hs-var">ispace</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387432"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684387431"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-554"></span><span class="annot"><a href="Futhark.IR.Mem.html#varInfoToExpReturns"><span class="hs-identifier hs-var">varInfoToExpReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684387430"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387430"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Space -&gt; ExpReturns
forall d u ret. Space -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-var">MemMem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387430"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span id="local-6989586621684389024"><span id="local-6989586621684389025"><span class="annot"><a href="Futhark.IR.Mem.html#matchRetTypeToResult"><span class="hs-identifier hs-type">matchRetTypeToResult</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-557"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389025"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389024"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.TypeCheck.html#Checkable"><span class="hs-identifier hs-type">TC.Checkable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389025"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-558"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Mem.html#FunReturns"><span class="hs-identifier hs-type">FunReturns</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-559"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-560"></span><span>  </span><span class="annot"><a href="Futhark.IR.TypeCheck.html#TypeM"><span class="hs-identifier hs-type">TC.TypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684389025"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-561"></span><span id="matchRetTypeToResult"><span class="annot"><span class="annottext">matchRetTypeToResult :: forall rep inner.
(Mem rep inner, Checkable rep) =&gt;
[FunReturns] -&gt; Result -&gt; TypeM rep ()
</span><a href="Futhark.IR.Mem.html#matchRetTypeToResult"><span class="hs-identifier hs-var hs-var">matchRetTypeToResult</span></a></span></span><span> </span><span id="local-6989586621684387367"><span class="annot"><span class="annottext">[FunReturns]
</span><a href="#local-6989586621684387367"><span class="hs-identifier hs-var">rettype</span></a></span></span><span> </span><span id="local-6989586621684387366"><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684387366"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-562"></span><span>  </span><span id="local-6989586621684387365"><span class="annot"><span class="annottext">Scope (Aliases rep)
</span><a href="#local-6989586621684387365"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeM rep (Scope (Aliases rep))
forall rep (m :: * -&gt; *). HasScope rep m =&gt; m (Scope rep)
</span><a href="Futhark.IR.Prop.Scope.html#askScope"><span class="hs-identifier hs-var">askScope</span></a></span><span>
</span><span id="line-563"></span><span>  </span><span id="local-6989586621684387363"><span class="annot"><span class="annottext">[LetDecMem]
</span><a href="#local-6989586621684387363"><span class="hs-identifier hs-var">result_ts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT (Scope rep) (TypeM rep) [LetDecMem]
-&gt; Scope rep -&gt; TypeM rep [LetDecMem]
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var hs-var">runReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SubExpRes -&gt; ReaderT (Scope rep) (TypeM rep) LetDecMem)
-&gt; Result -&gt; ReaderT (Scope rep) (TypeM rep) [LetDecMem]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubExp -&gt; ReaderT (Scope rep) (TypeM rep) LetDecMem
forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Monad m, Mem rep inner) =&gt;
SubExp -&gt; m LetDecMem
</span><a href="Futhark.IR.Mem.html#subExpMemInfo"><span class="hs-identifier hs-var">subExpMemInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; ReaderT (Scope rep) (TypeM rep) LetDecMem)
-&gt; (SubExpRes -&gt; SubExp)
-&gt; SubExpRes
-&gt; ReaderT (Scope rep) (TypeM rep) LetDecMem
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SubExpRes -&gt; SubExp
</span><a href="Futhark.IR.Syntax.html#resSubExp"><span class="hs-identifier hs-var hs-var">resSubExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684387366"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Scope rep -&gt; TypeM rep [LetDecMem])
-&gt; Scope rep -&gt; TypeM rep [LetDecMem]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Scope (Aliases rep) -&gt; Scope rep
forall rep. Scope (Aliases rep) -&gt; Scope rep
</span><a href="Futhark.IR.Aliases.html#removeScopeAliases"><span class="hs-identifier hs-var">removeScopeAliases</span></a></span><span> </span><span class="annot"><span class="annottext">Scope (Aliases rep)
</span><a href="#local-6989586621684387365"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-564"></span><span>  </span><span class="annot"><span class="annottext">[FunReturns] -&gt; [SubExp] -&gt; [LetDecMem] -&gt; TypeM rep ()
forall u rep.
Pretty u =&gt;
[MemInfo (Ext SubExp) u MemReturn]
-&gt; [SubExp] -&gt; [LetDecMem] -&gt; TypeM rep ()
</span><a href="Futhark.IR.Mem.html#matchReturnType"><span class="hs-identifier hs-var">matchReturnType</span></a></span><span> </span><span class="annot"><span class="annottext">[FunReturns]
</span><a href="#local-6989586621684387367"><span class="hs-identifier hs-var">rettype</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SubExpRes -&gt; SubExp) -&gt; Result -&gt; [SubExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">SubExpRes -&gt; SubExp
</span><a href="Futhark.IR.Syntax.html#resSubExp"><span class="hs-identifier hs-var hs-var">resSubExp</span></a></span><span> </span><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684387366"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LetDecMem]
</span><a href="#local-6989586621684387363"><span class="hs-identifier hs-var">result_ts</span></a></span><span>
</span><span id="line-565"></span><span>
</span><span id="line-566"></span><span id="local-6989586621684387358"><span id="local-6989586621684387359"><span class="annot"><a href="Futhark.IR.Mem.html#matchFunctionReturnType"><span class="hs-identifier hs-type">matchFunctionReturnType</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-567"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684387359"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684387358"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.TypeCheck.html#Checkable"><span class="hs-identifier hs-type">TC.Checkable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684387359"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-568"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Mem.html#FunReturns"><span class="hs-identifier hs-type">FunReturns</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-569"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-570"></span><span>  </span><span class="annot"><a href="Futhark.IR.TypeCheck.html#TypeM"><span class="hs-identifier hs-type">TC.TypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684387359"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-571"></span><span id="matchFunctionReturnType"><span class="annot"><span class="annottext">matchFunctionReturnType :: forall rep inner.
(Mem rep inner, Checkable rep) =&gt;
[FunReturns] -&gt; Result -&gt; TypeM rep ()
</span><a href="Futhark.IR.Mem.html#matchFunctionReturnType"><span class="hs-identifier hs-var hs-var">matchFunctionReturnType</span></a></span></span><span> </span><span id="local-6989586621684387304"><span class="annot"><span class="annottext">[FunReturns]
</span><a href="#local-6989586621684387304"><span class="hs-identifier hs-var">rettype</span></a></span></span><span> </span><span id="local-6989586621684387303"><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684387303"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-572"></span><span>  </span><span class="annot"><span class="annottext">[FunReturns] -&gt; Result -&gt; TypeM rep ()
forall rep inner.
(Mem rep inner, Checkable rep) =&gt;
[FunReturns] -&gt; Result -&gt; TypeM rep ()
</span><a href="Futhark.IR.Mem.html#matchRetTypeToResult"><span class="hs-identifier hs-var">matchRetTypeToResult</span></a></span><span> </span><span class="annot"><span class="annottext">[FunReturns]
</span><a href="#local-6989586621684387304"><span class="hs-identifier hs-var">rettype</span></a></span><span> </span><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684387303"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-573"></span><span>  </span><span class="annot"><span class="annottext">(SubExpRes -&gt; TypeM rep ()) -&gt; Result -&gt; TypeM rep ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubExp -&gt; TypeM rep ()
forall {rep} {inner}.
(HasLetDecMem (LetDec rep), ASTRep rep, OpReturns inner,
 FParamInfo rep ~ FParamMem, LParamInfo rep ~ LetDecMem,
 RetType rep ~ FunReturns, BranchType rep ~ BodyReturns,
 Op rep ~ MemOp inner) =&gt;
SubExp -&gt; TypeM rep ()
</span><a href="#local-6989586621684387301"><span class="hs-identifier hs-var">checkResultSubExp</span></a></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; TypeM rep ())
-&gt; (SubExpRes -&gt; SubExp) -&gt; SubExpRes -&gt; TypeM rep ()
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SubExpRes -&gt; SubExp
</span><a href="Futhark.IR.Syntax.html#resSubExp"><span class="hs-identifier hs-var hs-var">resSubExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684387303"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-574"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-575"></span><span>    </span><span id="local-6989586621684387301"><span class="annot"><span class="annottext">checkResultSubExp :: SubExp -&gt; TypeM rep ()
</span><a href="#local-6989586621684387301"><span class="hs-identifier hs-var hs-var">checkResultSubExp</span></a></span></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-576"></span><span>      </span><span class="annot"><span class="annottext">() -&gt; TypeM rep ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>    </span><span class="annot"><a href="#local-6989586621684387301"><span class="hs-identifier hs-var">checkResultSubExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684387243"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387243"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-578"></span><span>      </span><span id="local-6989586621684387242"><span class="annot"><span class="annottext">LetDecMem
</span><a href="#local-6989586621684387242"><span class="hs-identifier hs-var">dec</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; TypeM rep LetDecMem
forall rep inner. Mem rep inner =&gt; VName -&gt; TypeM rep LetDecMem
</span><a href="Futhark.IR.Mem.html#varMemInfo"><span class="hs-identifier hs-var">varMemInfo</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387243"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-579"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LetDecMem
</span><a href="#local-6989586621684387242"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-580"></span><span>        </span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TypeM rep ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span>        </span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TypeM rep ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-582"></span><span>        </span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TypeM rep ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-583"></span><span>        </span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Shape
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ArrayIn"><span class="hs-identifier hs-type">ArrayIn</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684387240"><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684387240"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-584"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IxFun -&gt; Bool
forall num. (Eq num, IntegralExp num) =&gt; IxFun num -&gt; Bool
</span><a href="Futhark.IR.Mem.IxFun.html#isLinear"><span class="hs-identifier hs-var">IxFun.isLinear</span></a></span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684387240"><span class="hs-identifier hs-var">ixfun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-585"></span><span>            </span><span class="annot"><span class="annottext">() -&gt; TypeM rep ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-587"></span><span>            </span><span class="annot"><span class="annottext">ErrorCase rep -&gt; TypeM rep ()
forall rep a. ErrorCase rep -&gt; TypeM rep a
</span><a href="Futhark.IR.TypeCheck.html#bad"><span class="hs-identifier hs-var">TC.bad</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorCase rep -&gt; TypeM rep ()) -&gt; ErrorCase rep -&gt; TypeM rep ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-588"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; ErrorCase rep
forall rep. String -&gt; ErrorCase rep
</span><a href="Futhark.IR.TypeCheck.html#TypeError"><span class="hs-identifier hs-var">TC.TypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ErrorCase rep) -&gt; String -&gt; ErrorCase rep
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-589"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Array &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387243"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-590"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; returned by function, but has nontrivial index function &quot;</span></span><span>
</span><span id="line-591"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">IxFun -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684387240"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-592"></span><span>
</span><span id="line-593"></span><span id="local-6989586621684388964"><span id="local-6989586621684388965"><span class="annot"><a href="Futhark.IR.Mem.html#matchLoopResultMem"><span class="hs-identifier hs-type">matchLoopResultMem</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-594"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388965"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388964"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.TypeCheck.html#Checkable"><span class="hs-identifier hs-type">TC.Checkable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388965"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-595"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Syntax.html#FParam"><span class="hs-identifier hs-type">FParam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Aliases.html#Aliases"><span class="hs-identifier hs-type">Aliases</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388965"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-596"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-597"></span><span>  </span><span class="annot"><a href="Futhark.IR.TypeCheck.html#TypeM"><span class="hs-identifier hs-type">TC.TypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388965"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-598"></span><span id="matchLoopResultMem"><span class="annot"><span class="annottext">matchLoopResultMem :: forall rep inner.
(Mem rep inner, Checkable rep) =&gt;
[FParam (Aliases rep)] -&gt; Result -&gt; TypeM rep ()
</span><a href="Futhark.IR.Mem.html#matchLoopResultMem"><span class="hs-identifier hs-var hs-var">matchLoopResultMem</span></a></span></span><span> </span><span id="local-6989586621684387193"><span class="annot"><span class="annottext">[FParam (Aliases rep)]
</span><a href="#local-6989586621684387193"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FunReturns] -&gt; Result -&gt; TypeM rep ()
forall rep inner.
(Mem rep inner, Checkable rep) =&gt;
[FunReturns] -&gt; Result -&gt; TypeM rep ()
</span><a href="Futhark.IR.Mem.html#matchRetTypeToResult"><span class="hs-identifier hs-var">matchRetTypeToResult</span></a></span><span> </span><span class="annot"><span class="annottext">[FunReturns]
</span><a href="#local-6989586621684387192"><span class="hs-identifier hs-var">rettype</span></a></span><span>
</span><span id="line-599"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-600"></span><span>    </span><span id="local-6989586621684387191"><span class="annot"><span class="annottext">param_names :: [VName]
</span><a href="#local-6989586621684387191"><span class="hs-identifier hs-var hs-var">param_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Param FParamMem -&gt; VName) -&gt; [Param FParamMem] -&gt; [VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Param FParamMem -&gt; VName
forall dec. Param dec -&gt; VName
</span><a href="Futhark.IR.Syntax.Core.html#paramName"><span class="hs-identifier hs-var hs-var">paramName</span></a></span><span> </span><span class="annot"><span class="annottext">[FParam (Aliases rep)]
[Param FParamMem]
</span><a href="#local-6989586621684387193"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span>    </span><span class="hs-comment">-- Invent a ReturnType so we can pretend that the loop body is</span><span>
</span><span id="line-603"></span><span>    </span><span class="hs-comment">-- actually returning from a function.</span><span>
</span><span id="line-604"></span><span>    </span><span id="local-6989586621684387192"><span class="annot"><span class="annottext">rettype :: [FunReturns]
</span><a href="#local-6989586621684387192"><span class="hs-identifier hs-var hs-var">rettype</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Param FParamMem -&gt; FunReturns)
-&gt; [Param FParamMem] -&gt; [FunReturns]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FParamMem -&gt; FunReturns
</span><a href="#local-6989586621684387189"><span class="hs-identifier hs-var">toRet</span></a></span><span> </span><span class="annot"><span class="annottext">(FParamMem -&gt; FunReturns)
-&gt; (Param FParamMem -&gt; FParamMem) -&gt; Param FParamMem -&gt; FunReturns
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Param FParamMem -&gt; FParamMem
forall dec. Param dec -&gt; dec
</span><a href="Futhark.IR.Syntax.Core.html#paramDec"><span class="hs-identifier hs-var hs-var">paramDec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FParam (Aliases rep)]
[Param FParamMem]
</span><a href="#local-6989586621684387193"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-605"></span><span>
</span><span id="line-606"></span><span>    </span><span id="local-6989586621684387187"><span class="annot"><span class="annottext">toExtV :: VName -&gt; Ext VName
</span><a href="#local-6989586621684387187"><span class="hs-identifier hs-var hs-var">toExtV</span></a></span></span><span> </span><span id="local-6989586621684387186"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387186"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-607"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684387185"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387185"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387186"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; [VName] -&gt; Maybe Int
forall a. Eq a =&gt; a -&gt; [a] -&gt; Maybe Int
</span><span class="hs-operator hs-var">`elemIndex`</span></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684387191"><span class="hs-identifier hs-var">param_names</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ext VName
forall a. Int -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387185"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-608"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Ext VName
forall a. a -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-var">Free</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387186"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-609"></span><span>
</span><span id="line-610"></span><span>    </span><span id="local-6989586621684387184"><span class="annot"><span class="annottext">toExtSE :: SubExp -&gt; Ext SubExp
</span><a href="#local-6989586621684387184"><span class="hs-identifier hs-var hs-var">toExtSE</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684387183"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387183"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; SubExp
</span><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; SubExp) -&gt; Ext VName -&gt; Ext SubExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Ext VName
</span><a href="#local-6989586621684387187"><span class="hs-identifier hs-var">toExtV</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387183"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-611"></span><span>    </span><span class="annot"><a href="#local-6989586621684387184"><span class="hs-identifier hs-var">toExtSE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span> </span><span id="local-6989586621684387182"><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684387182"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; Ext SubExp
forall a. a -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-var">Free</span></a></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; Ext SubExp) -&gt; SubExp -&gt; Ext SubExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimValue -&gt; SubExp
</span><a href="Futhark.IR.Syntax.Core.html#Constant"><span class="hs-identifier hs-var">Constant</span></a></span><span> </span><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684387182"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-612"></span><span>
</span><span id="line-613"></span><span>    </span><span id="local-6989586621684387189"><span class="annot"><span class="annottext">toRet :: FParamMem -&gt; FunReturns
</span><a href="#local-6989586621684387189"><span class="hs-identifier hs-var hs-var">toRet</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span id="local-6989586621684387181"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387181"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-614"></span><span>      </span><span class="annot"><span class="annottext">PrimType -&gt; FunReturns
forall d u ret. PrimType -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387181"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-615"></span><span>    </span><span class="annot"><a href="#local-6989586621684387189"><span class="hs-identifier hs-var">toRet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684387180"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387180"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-616"></span><span>      </span><span class="annot"><span class="annottext">Space -&gt; FunReturns
forall d u ret. Space -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-var">MemMem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387180"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-617"></span><span>    </span><span class="annot"><a href="#local-6989586621684387189"><span class="hs-identifier hs-var">toRet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684387179"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387179"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684387178"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387178"><span class="hs-identifier hs-var">ispace</span></a></span></span><span> </span><span id="local-6989586621684387177"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387177"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621684387176"><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684387176"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-618"></span><span>      </span><span class="annot"><span class="annottext">VName -&gt; Shape -&gt; [Type] -&gt; Uniqueness -&gt; FunReturns
forall d u ret. VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-var">MemAcc</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387179"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387178"><span class="hs-identifier hs-var">ispace</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684387177"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684387176"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-619"></span><span>    </span><span class="annot"><a href="#local-6989586621684387189"><span class="hs-identifier hs-var">toRet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span id="local-6989586621684387175"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387175"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621684387174"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387174"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span id="local-6989586621684387173"><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684387173"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ArrayIn"><span class="hs-identifier hs-type">ArrayIn</span></a></span><span> </span><span id="local-6989586621684387172"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387172"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span id="local-6989586621684387171"><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684387171"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684387170"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387170"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387172"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; [VName] -&gt; Maybe Int
forall a. Eq a =&gt; a -&gt; [a] -&gt; Maybe Int
</span><span class="hs-operator hs-var">`elemIndex`</span></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684387191"><span class="hs-identifier hs-var">param_names</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-621"></span><span>        </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Param"><span class="hs-identifier hs-type">Param</span></a></span><span> </span><span class="annot"><span class="annottext">Attrs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684387168"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387168"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Param FParamMem]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Param FParamMem] -&gt; [Param FParamMem]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387170"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">[FParam (Aliases rep)]
[Param FParamMem]
</span><a href="#local-6989586621684387193"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-622"></span><span>        </span><span class="annot"><span class="annottext">PrimType
-&gt; ShapeBase (Ext SubExp) -&gt; Uniqueness -&gt; MemReturn -&gt; FunReturns
forall d u ret.
PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387175"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684387166"><span class="hs-identifier hs-var">shape'</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684387173"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">(MemReturn -&gt; FunReturns) -&gt; MemReturn -&gt; FunReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Space -&gt; Int -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsNewBlock"><span class="hs-identifier hs-var">ReturnsNewBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684387168"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387170"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387165"><span class="hs-identifier hs-var">ixfun'</span></a></span><span>
</span><span id="line-623"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-624"></span><span>        </span><span class="annot"><span class="annottext">PrimType
-&gt; ShapeBase (Ext SubExp) -&gt; Uniqueness -&gt; MemReturn -&gt; FunReturns
forall d u ret.
PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684387175"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684387166"><span class="hs-identifier hs-var">shape'</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684387173"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">(MemReturn -&gt; FunReturns) -&gt; MemReturn -&gt; FunReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-var">ReturnsInBlock</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684387172"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684387165"><span class="hs-identifier hs-var">ixfun'</span></a></span><span>
</span><span id="line-625"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-626"></span><span>        </span><span id="local-6989586621684387166"><span class="annot"><span class="annottext">shape' :: ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684387166"><span class="hs-identifier hs-var hs-var">shape'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; Ext SubExp) -&gt; Shape -&gt; ShapeBase (Ext SubExp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; Ext SubExp
</span><a href="#local-6989586621684387184"><span class="hs-identifier hs-var">toExtSE</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684387174"><span class="hs-identifier hs-var">shape</span></a></span><span>
</span><span id="line-627"></span><span>        </span><span id="local-6989586621684387165"><span class="annot"><span class="annottext">ixfun' :: ExtIxFun
</span><a href="#local-6989586621684387165"><span class="hs-identifier hs-var hs-var">ixfun'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; IxFun -&gt; ExtIxFun
</span><a href="Futhark.IR.Mem.html#existentialiseIxFun"><span class="hs-identifier hs-var">existentialiseIxFun</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684387191"><span class="hs-identifier hs-var">param_names</span></a></span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684387171"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-628"></span><span>
</span><span id="line-629"></span><span id="local-6989586621684388955"><span id="local-6989586621684388956"><span class="annot"><a href="Futhark.IR.Mem.html#matchBranchReturnType"><span class="hs-identifier hs-type">matchBranchReturnType</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-630"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388956"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388955"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.TypeCheck.html#Checkable"><span class="hs-identifier hs-type">TC.Checkable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388956"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-631"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Mem.html#BodyReturns"><span class="hs-identifier hs-type">BodyReturns</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-632"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.html#Body"><span class="hs-identifier hs-type">Body</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Aliases.html#Aliases"><span class="hs-identifier hs-type">Aliases</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388956"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-633"></span><span>  </span><span class="annot"><a href="Futhark.IR.TypeCheck.html#TypeM"><span class="hs-identifier hs-type">TC.TypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388956"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-634"></span><span id="matchBranchReturnType"><span class="annot"><span class="annottext">matchBranchReturnType :: forall rep inner.
(Mem rep inner, Checkable rep) =&gt;
[BodyReturns] -&gt; Body (Aliases rep) -&gt; TypeM rep ()
</span><a href="Futhark.IR.Mem.html#matchBranchReturnType"><span class="hs-identifier hs-var hs-var">matchBranchReturnType</span></a></span></span><span> </span><span id="local-6989586621684387114"><span class="annot"><span class="annottext">[BodyReturns]
</span><a href="#local-6989586621684387114"><span class="hs-identifier hs-var">rettype</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Body"><span class="hs-identifier hs-type">Body</span></a></span><span> </span><span class="annot"><span class="annottext">BodyDec (Aliases rep)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684387112"><span class="annot"><span class="annottext">Stms (Aliases rep)
</span><a href="#local-6989586621684387112"><span class="hs-identifier hs-var">stms</span></a></span></span><span> </span><span id="local-6989586621684387111"><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684387111"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-635"></span><span>  </span><span id="local-6989586621684387110"><span class="annot"><span class="annottext">Scope (Aliases rep)
</span><a href="#local-6989586621684387110"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeM rep (Scope (Aliases rep))
forall rep (m :: * -&gt; *). HasScope rep m =&gt; m (Scope rep)
</span><a href="Futhark.IR.Prop.Scope.html#askScope"><span class="hs-identifier hs-var">askScope</span></a></span><span>
</span><span id="line-636"></span><span>  </span><span id="local-6989586621684387109"><span class="annot"><span class="annottext">[LetDecMem]
</span><a href="#local-6989586621684387109"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT (Scope rep) (TypeM rep) [LetDecMem]
-&gt; Scope rep -&gt; TypeM rep [LetDecMem]
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var hs-var">runReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SubExpRes -&gt; ReaderT (Scope rep) (TypeM rep) LetDecMem)
-&gt; Result -&gt; ReaderT (Scope rep) (TypeM rep) [LetDecMem]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubExp -&gt; ReaderT (Scope rep) (TypeM rep) LetDecMem
forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Monad m, Mem rep inner) =&gt;
SubExp -&gt; m LetDecMem
</span><a href="Futhark.IR.Mem.html#subExpMemInfo"><span class="hs-identifier hs-var">subExpMemInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; ReaderT (Scope rep) (TypeM rep) LetDecMem)
-&gt; (SubExpRes -&gt; SubExp)
-&gt; SubExpRes
-&gt; ReaderT (Scope rep) (TypeM rep) LetDecMem
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SubExpRes -&gt; SubExp
</span><a href="Futhark.IR.Syntax.html#resSubExp"><span class="hs-identifier hs-var hs-var">resSubExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684387111"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Scope rep -&gt; TypeM rep [LetDecMem])
-&gt; Scope rep -&gt; TypeM rep [LetDecMem]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Scope (Aliases rep) -&gt; Scope rep
forall rep. Scope (Aliases rep) -&gt; Scope rep
</span><a href="Futhark.IR.Aliases.html#removeScopeAliases"><span class="hs-identifier hs-var">removeScopeAliases</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope (Aliases rep)
</span><a href="#local-6989586621684387110"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">Scope (Aliases rep) -&gt; Scope (Aliases rep) -&gt; Scope (Aliases rep)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Stms (Aliases rep) -&gt; Scope (Aliases rep)
forall rep a. Scoped rep a =&gt; a -&gt; Scope rep
</span><a href="Futhark.IR.Prop.Scope.html#scopeOf"><span class="hs-identifier hs-var">scopeOf</span></a></span><span> </span><span class="annot"><span class="annottext">Stms (Aliases rep)
</span><a href="#local-6989586621684387112"><span class="hs-identifier hs-var">stms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-637"></span><span>  </span><span class="annot"><span class="annottext">[BodyReturns] -&gt; [SubExp] -&gt; [LetDecMem] -&gt; TypeM rep ()
forall u rep.
Pretty u =&gt;
[MemInfo (Ext SubExp) u MemReturn]
-&gt; [SubExp] -&gt; [LetDecMem] -&gt; TypeM rep ()
</span><a href="Futhark.IR.Mem.html#matchReturnType"><span class="hs-identifier hs-var">matchReturnType</span></a></span><span> </span><span class="annot"><span class="annottext">[BodyReturns]
</span><a href="#local-6989586621684387114"><span class="hs-identifier hs-var">rettype</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SubExpRes -&gt; SubExp) -&gt; Result -&gt; [SubExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">SubExpRes -&gt; SubExp
</span><a href="Futhark.IR.Syntax.html#resSubExp"><span class="hs-identifier hs-var hs-var">resSubExp</span></a></span><span> </span><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684387111"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LetDecMem]
</span><a href="#local-6989586621684387109"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span class="hs-comment">-- | Helper function for index function unification.</span><span>
</span><span id="line-640"></span><span class="hs-comment">--</span><span>
</span><span id="line-641"></span><span class="hs-comment">-- The first return value maps a VName (wrapped in 'Free') to its Int</span><span>
</span><span id="line-642"></span><span class="hs-comment">-- (wrapped in 'Ext').  In case of duplicates, it is mapped to the</span><span>
</span><span id="line-643"></span><span class="hs-comment">-- *first* Int that occurs.</span><span>
</span><span id="line-644"></span><span class="hs-comment">--</span><span>
</span><span id="line-645"></span><span class="hs-comment">-- The second return value maps each Int (wrapped in an 'Ext') to a</span><span>
</span><span id="line-646"></span><span class="hs-comment">-- 'LeafExp' 'Ext' with the Int at which its associated VName first</span><span>
</span><span id="line-647"></span><span class="hs-comment">-- occurs.</span><span>
</span><span id="line-648"></span><span class="annot"><a href="Futhark.IR.Mem.html#getExtMaps"><span class="hs-identifier hs-type">getExtMaps</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-649"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-650"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.PrimExp.html#TPrimExp"><span class="hs-identifier hs-type">TPrimExp</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-651"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.PrimExp.html#TPrimExp"><span class="hs-identifier hs-type">TPrimExp</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-652"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-653"></span><span id="getExtMaps"><span class="annot"><span class="annottext">getExtMaps :: [(VName, Int)]
-&gt; (Map (Ext VName) (TPrimExp Int64 (Ext VName)),
    Map (Ext VName) (TPrimExp Int64 (Ext VName)))
</span><a href="Futhark.IR.Mem.html#getExtMaps"><span class="hs-identifier hs-var hs-var">getExtMaps</span></a></span></span><span> </span><span id="local-6989586621684387106"><span class="annot"><span class="annottext">[(VName, Int)]
</span><a href="#local-6989586621684387106"><span class="hs-identifier hs-var">ctx_lst_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-654"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; TPrimExp Int64 (Ext VName))
-&gt; Map (Ext VName) Int
-&gt; Map (Ext VName) (TPrimExp Int64 (Ext VName))
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TPrimExp Int64 (Ext VName)
forall a. Int -&gt; TPrimExp Int64 (Ext a)
</span><a href="Futhark.IR.Mem.html#leafExp"><span class="hs-identifier hs-var">leafExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (Ext VName) Int
 -&gt; Map (Ext VName) (TPrimExp Int64 (Ext VName)))
-&gt; Map (Ext VName) Int
-&gt; Map (Ext VName) (TPrimExp Int64 (Ext VName))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Ext VName) -&gt; Map VName Int -&gt; Map (Ext VName) Int
forall k2 k1 a. Ord k2 =&gt; (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">M.mapKeys</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Ext VName
forall a. a -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-var">Free</span></a></span><span> </span><span class="annot"><span class="annottext">(Map VName Int -&gt; Map (Ext VName) Int)
-&gt; Map VName Int -&gt; Map (Ext VName) Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int) -&gt; [(VName, Int)] -&gt; Map VName Int
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromListWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int -&gt; Int
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall {k} (cat :: k -&gt; k -&gt; *) (a :: k). Category cat =&gt; cat a a
</span><span class="hs-identifier hs-var">id</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(VName, Int)]
</span><a href="#local-6989586621684387106"><span class="hs-identifier hs-var">ctx_lst_ids</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-655"></span><span>    </span><span class="annot"><span class="annottext">[(Ext VName, TPrimExp Int64 (Ext VName))]
-&gt; Map (Ext VName) (TPrimExp Int64 (Ext VName))
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Ext VName, TPrimExp Int64 (Ext VName))]
 -&gt; Map (Ext VName) (TPrimExp Int64 (Ext VName)))
-&gt; [(Ext VName, TPrimExp Int64 (Ext VName))]
-&gt; Map (Ext VName) (TPrimExp Int64 (Ext VName))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-656"></span><span>      </span><span class="annot"><span class="annottext">((VName, Int) -&gt; Maybe (Ext VName, TPrimExp Int64 (Ext VName)))
-&gt; [(VName, Int)] -&gt; [(Ext VName, TPrimExp Int64 (Ext VName))]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span>
</span><span id="line-657"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Maybe (TPrimExp Int64 (Ext VName)))
-&gt; (Ext VName, VName)
-&gt; Maybe (Ext VName, TPrimExp Int64 (Ext VName))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span>
</span><span id="line-658"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; TPrimExp Int64 (Ext VName))
-&gt; Maybe Int -&gt; Maybe (TPrimExp Int64 (Ext VName))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621684387101"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387101"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimExp (Ext VName) -&gt; TPrimExp Int64 (Ext VName)
forall v. PrimExp v -&gt; TPrimExp Int64 v
</span><a href="Futhark.Analysis.PrimExp.html#isInt64"><span class="hs-identifier hs-var">isInt64</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimExp (Ext VName) -&gt; TPrimExp Int64 (Ext VName))
-&gt; PrimExp (Ext VName) -&gt; TPrimExp Int64 (Ext VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ext VName -&gt; PrimType -&gt; PrimExp (Ext VName)
forall v. v -&gt; PrimType -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#LeafExp"><span class="hs-identifier hs-var">LeafExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ext VName
forall a. Int -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684387101"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Prop.Types.html#int64"><span class="hs-identifier hs-var">int64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>                </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Maybe (TPrimExp Int64 (Ext VName)))
-&gt; (VName -&gt; Maybe Int)
-&gt; VName
-&gt; Maybe (TPrimExp Int64 (Ext VName))
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; [(VName, Int)] -&gt; Maybe Int
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-operator hs-var">`lookup`</span></span><span> </span><span class="annot"><span class="annottext">[(VName, Int)]
</span><a href="#local-6989586621684387106"><span class="hs-identifier hs-var">ctx_lst_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-660"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-661"></span><span>            </span><span class="annot"><span class="annottext">((Ext VName, VName)
 -&gt; Maybe (Ext VName, TPrimExp Int64 (Ext VName)))
-&gt; ((VName, Int) -&gt; (Ext VName, VName))
-&gt; (VName, Int)
-&gt; Maybe (Ext VName, TPrimExp Int64 (Ext VName))
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Ext VName -&gt; (Ext VName, VName))
-&gt; (VName, Ext VName) -&gt; (Ext VName, VName)
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ext VName -&gt; VName -&gt; (Ext VName, VName))
-&gt; VName -&gt; Ext VName -&gt; (Ext VName, VName)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-662"></span><span>            </span><span class="annot"><span class="annottext">((VName, Ext VName) -&gt; (Ext VName, VName))
-&gt; ((VName, Int) -&gt; (VName, Ext VName))
-&gt; (VName, Int)
-&gt; (Ext VName, VName)
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Ext VName) -&gt; (VName, Int) -&gt; (VName, Ext VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ext VName
forall a. Int -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span>
</span><span id="line-663"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-664"></span><span>        </span><span class="annot"><span class="annottext">[(VName, Int)]
</span><a href="#local-6989586621684387106"><span class="hs-identifier hs-var">ctx_lst_ids</span></a></span><span>
</span><span id="line-665"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span id="local-6989586621684388988"><span id="local-6989586621684388989"><span class="annot"><a href="Futhark.IR.Mem.html#matchReturnType"><span class="hs-identifier hs-type">matchReturnType</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-668"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PP.Pretty</span></span><span> </span><span class="annot"><a href="#local-6989586621684388989"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-669"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ExtSize"><span class="hs-identifier hs-type">ExtSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388989"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemReturn"><span class="hs-identifier hs-type">MemReturn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-670"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-671"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-type">NoUniqueness</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier hs-type">MemBind</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-672"></span><span>  </span><span class="annot"><a href="Futhark.IR.TypeCheck.html#TypeM"><span class="hs-identifier hs-type">TC.TypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388988"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-673"></span><span id="matchReturnType"><span class="annot"><span class="annottext">matchReturnType :: forall u rep.
Pretty u =&gt;
[MemInfo (Ext SubExp) u MemReturn]
-&gt; [SubExp] -&gt; [LetDecMem] -&gt; TypeM rep ()
</span><a href="Futhark.IR.Mem.html#matchReturnType"><span class="hs-identifier hs-var hs-var">matchReturnType</span></a></span></span><span> </span><span id="local-6989586621684386968"><span class="annot"><span class="annottext">[MemInfo (Ext SubExp) u MemReturn]
</span><a href="#local-6989586621684386968"><span class="hs-identifier hs-var">rettype</span></a></span></span><span> </span><span id="local-6989586621684386967"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684386967"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span id="local-6989586621684386966"><span class="annot"><span class="annottext">[LetDecMem]
</span><a href="#local-6989586621684386966"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-674"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684386965"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684386965"><span class="hs-identifier hs-var">ctx_res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684386964"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684386964"><span class="hs-identifier hs-var">_val_res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [SubExp] -&gt; ([SubExp], [SubExp])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><a href="Futhark.Util.html#splitFromEnd"><span class="hs-identifier hs-var">splitFromEnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[MemInfo (Ext SubExp) u MemReturn] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[MemInfo (Ext SubExp) u MemReturn]
</span><a href="#local-6989586621684386968"><span class="hs-identifier hs-var">rettype</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684386967"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-675"></span><span>
</span><span id="line-676"></span><span>      </span><span class="annot"><a href="#local-6989586621684386961"><span class="hs-identifier hs-type">existentialiseIxFun0</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#IxFun"><span class="hs-identifier hs-type">IxFun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#ExtIxFun"><span class="hs-identifier hs-type">ExtIxFun</span></a></span><span>
</span><span id="line-677"></span><span>      </span><span id="local-6989586621684386961"><span class="annot"><span class="annottext">existentialiseIxFun0 :: IxFun -&gt; ExtIxFun
</span><a href="#local-6989586621684386961"><span class="hs-identifier hs-var hs-var">existentialiseIxFun0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TPrimExp Int64 VName -&gt; TPrimExp Int64 (Ext VName))
-&gt; IxFun -&gt; ExtIxFun
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((TPrimExp Int64 VName -&gt; TPrimExp Int64 (Ext VName))
 -&gt; IxFun -&gt; ExtIxFun)
-&gt; (TPrimExp Int64 VName -&gt; TPrimExp Int64 (Ext VName))
-&gt; IxFun
-&gt; ExtIxFun
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Ext VName)
-&gt; TPrimExp Int64 VName -&gt; TPrimExp Int64 (Ext VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Ext VName
forall a. a -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-var">Free</span></a></span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span>      </span><span id="local-6989586621684386960"><span class="annot"><span class="annottext">fetchCtx :: Int -&gt; ExceptT String (TypeM rep) (SubExp, LetDecMem)
</span><a href="#local-6989586621684386960"><span class="hs-identifier hs-var hs-var">fetchCtx</span></a></span></span><span> </span><span id="local-6989586621684386959"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386959"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(SubExp, LetDecMem)] -&gt; Maybe (SubExp, LetDecMem)
forall int a. Integral int =&gt; int -&gt; [a] -&gt; Maybe a
</span><a href="Futhark.Util.html#maybeNth"><span class="hs-identifier hs-var">maybeNth</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386959"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">([(SubExp, LetDecMem)] -&gt; Maybe (SubExp, LetDecMem))
-&gt; [(SubExp, LetDecMem)] -&gt; Maybe (SubExp, LetDecMem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SubExp] -&gt; [LetDecMem] -&gt; [(SubExp, LetDecMem)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684386967"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">[LetDecMem]
</span><a href="#local-6989586621684386966"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-680"></span><span>        </span><span class="annot"><span class="annottext">Maybe (SubExp, LetDecMem)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-681"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ExceptT String (TypeM rep) (SubExp, LetDecMem)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ExceptT String (TypeM rep) (SubExp, LetDecMem))
-&gt; String -&gt; ExceptT String (TypeM rep) (SubExp, LetDecMem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot find variable #&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386959"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; in results: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[SubExp] -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684386967"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-682"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684386955"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386955"><span class="hs-identifier hs-var">se</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684386954"><span class="annot"><span class="annottext">LetDecMem
</span><a href="#local-6989586621684386954"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(SubExp, LetDecMem)
-&gt; ExceptT String (TypeM rep) (SubExp, LetDecMem)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386955"><span class="hs-identifier hs-var">se</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LetDecMem
</span><a href="#local-6989586621684386954"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-683"></span><span>
</span><span id="line-684"></span><span>      </span><span id="local-6989586621684386953"><span class="annot"><span class="annottext">checkReturn :: MemInfo (Ext SubExp) u MemReturn
-&gt; LetDecMem -&gt; ExceptT String (TypeM rep) ()
</span><a href="#local-6989586621684386953"><span class="hs-identifier hs-var hs-var">checkReturn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span id="local-6989586621684386952"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386952"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span id="local-6989586621684386951"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386951"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386952"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; PrimType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386951"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT String (TypeM rep) ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-686"></span><span>      </span><span class="annot"><a href="#local-6989586621684386953"><span class="hs-identifier hs-var">checkReturn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684386950"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386950"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684386949"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386949"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-687"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386950"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Space -&gt; Space -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386949"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT String (TypeM rep) ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-688"></span><span>      </span><span class="annot"><a href="#local-6989586621684386953"><span class="hs-identifier hs-var">checkReturn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684386948"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386948"><span class="hs-identifier hs-var">xacc</span></a></span></span><span> </span><span id="local-6989586621684386947"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386947"><span class="hs-identifier hs-var">xispace</span></a></span></span><span> </span><span id="local-6989586621684386946"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684386946"><span class="hs-identifier hs-var">xts</span></a></span></span><span> </span><span class="annot"><span class="annottext">u
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684386945"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386945"><span class="hs-identifier hs-var">yacc</span></a></span></span><span> </span><span id="local-6989586621684386944"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386944"><span class="hs-identifier hs-var">yispace</span></a></span></span><span> </span><span id="local-6989586621684386943"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684386943"><span class="hs-identifier hs-var">yts</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-689"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386948"><span class="hs-identifier hs-var">xacc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386947"><span class="hs-identifier hs-var">xispace</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684386946"><span class="hs-identifier hs-var">xts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(VName, Shape, [Type]) -&gt; (VName, Shape, [Type]) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386945"><span class="hs-identifier hs-var">yacc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386944"><span class="hs-identifier hs-var">yispace</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684386943"><span class="hs-identifier hs-var">yts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-690"></span><span>          </span><span class="annot"><span class="annottext">() -&gt; ExceptT String (TypeM rep) ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-691"></span><span>      </span><span class="annot"><a href="#local-6989586621684386953"><span class="hs-identifier hs-var">checkReturn</span></a></span><span>
</span><span id="line-692"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span id="local-6989586621684386942"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386942"><span class="hs-identifier hs-var">x_pt</span></a></span></span><span> </span><span id="local-6989586621684386941"><span class="annot"><span class="annottext">ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684386941"><span class="hs-identifier hs-var">x_shape</span></a></span></span><span> </span><span class="annot"><span class="annottext">u
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684386940"><span class="annot"><span class="annottext">MemReturn
</span><a href="#local-6989586621684386940"><span class="hs-identifier hs-var">x_ret</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-693"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span id="local-6989586621684386939"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386939"><span class="hs-identifier hs-var">y_pt</span></a></span></span><span> </span><span id="local-6989586621684386938"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386938"><span class="hs-identifier hs-var">y_shape</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684386937"><span class="annot"><span class="annottext">MemBind
</span><a href="#local-6989586621684386937"><span class="hs-identifier hs-var">y_ret</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-694"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386942"><span class="hs-identifier hs-var">x_pt</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; PrimType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386939"><span class="hs-identifier hs-var">y_pt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-695"></span><span>            </span><span class="annot"><span class="annottext">ShapeBase (Ext SubExp) -&gt; Int
forall a. ArrayShape a =&gt; a -&gt; Int
</span><a href="Futhark.IR.Syntax.Core.html#shapeRank"><span class="hs-identifier hs-var">shapeRank</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684386941"><span class="hs-identifier hs-var">x_shape</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Shape -&gt; Int
forall a. ArrayShape a =&gt; a -&gt; Int
</span><a href="Futhark.IR.Syntax.Core.html#shapeRank"><span class="hs-identifier hs-var">shapeRank</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386938"><span class="hs-identifier hs-var">y_shape</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-696"></span><span>            </span><span class="annot"><span class="annottext">(Ext SubExp -&gt; SubExp -&gt; ExceptT String (TypeM rep) ())
-&gt; [Ext SubExp] -&gt; [SubExp] -&gt; ExceptT String (TypeM rep) ()
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m ()
</span><span class="hs-identifier hs-var">zipWithM_</span></span><span> </span><span class="annot"><span class="annottext">Ext SubExp -&gt; SubExp -&gt; ExceptT String (TypeM rep) ()
</span><a href="#local-6989586621684386934"><span class="hs-identifier hs-var">checkDim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShapeBase (Ext SubExp) -&gt; [Ext SubExp]
forall d. ShapeBase d -&gt; [d]
</span><a href="Futhark.IR.Syntax.Core.html#shapeDims"><span class="hs-identifier hs-var hs-var">shapeDims</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684386941"><span class="hs-identifier hs-var">x_shape</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Shape -&gt; [SubExp]
forall d. ShapeBase d -&gt; [d]
</span><a href="Futhark.IR.Syntax.Core.html#shapeDims"><span class="hs-identifier hs-var hs-var">shapeDims</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386938"><span class="hs-identifier hs-var">y_shape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-697"></span><span>            </span><span class="annot"><span class="annottext">MemReturn -&gt; MemBind -&gt; ExceptT String (TypeM rep) ()
</span><a href="#local-6989586621684386932"><span class="hs-identifier hs-var">checkMemReturn</span></a></span><span> </span><span class="annot"><span class="annottext">MemReturn
</span><a href="#local-6989586621684386940"><span class="hs-identifier hs-var">x_ret</span></a></span><span> </span><span class="annot"><span class="annottext">MemBind
</span><a href="#local-6989586621684386937"><span class="hs-identifier hs-var">y_ret</span></a></span><span>
</span><span id="line-698"></span><span>      </span><span class="annot"><a href="#local-6989586621684386953"><span class="hs-identifier hs-var">checkReturn</span></a></span><span> </span><span id="local-6989586621684386931"><span class="annot"><span class="annottext">MemInfo (Ext SubExp) u MemReturn
</span><a href="#local-6989586621684386931"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621684386930"><span class="annot"><span class="annottext">LetDecMem
</span><a href="#local-6989586621684386930"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-699"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ExceptT String (TypeM rep) ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ExceptT String (TypeM rep) ())
-&gt; String -&gt; ExceptT String (TypeM rep) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MemInfo (Ext SubExp) u MemReturn -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">MemInfo (Ext SubExp) u MemReturn
</span><a href="#local-6989586621684386931"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;but got&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LetDecMem -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">LetDecMem
</span><a href="#local-6989586621684386930"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-700"></span><span>
</span><span id="line-701"></span><span>      </span><span id="local-6989586621684386934"><span class="annot"><span class="annottext">checkDim :: Ext SubExp -&gt; SubExp -&gt; ExceptT String (TypeM rep) ()
</span><a href="#local-6989586621684386934"><span class="hs-identifier hs-var hs-var">checkDim</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-type">Free</span></a></span><span> </span><span id="local-6989586621684386928"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386928"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684386927"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386927"><span class="hs-identifier hs-var">y</span></a></span></span><span>
</span><span id="line-702"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386928"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; SubExp -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386927"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT String (TypeM rep) ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-703"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-704"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ExceptT String (TypeM rep) ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ExceptT String (TypeM rep) ())
-&gt; String -&gt; ExceptT String (TypeM rep) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected dim&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386928"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;but got&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386927"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-705"></span><span>      </span><span class="annot"><a href="#local-6989586621684386934"><span class="hs-identifier hs-var">checkDim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span id="local-6989586621684386926"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386926"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684386925"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386925"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-706"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621684386924"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386924"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LetDecMem
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ExceptT String (TypeM rep) (SubExp, LetDecMem)
</span><a href="#local-6989586621684386960"><span class="hs-identifier hs-var">fetchCtx</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386926"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-707"></span><span>        </span><span class="annot"><span class="annottext">Bool
-&gt; ExceptT String (TypeM rep) () -&gt; ExceptT String (TypeM rep) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386924"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; SubExp -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386925"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT String (TypeM rep) () -&gt; ExceptT String (TypeM rep) ())
-&gt; ([String] -&gt; ExceptT String (TypeM rep) ())
-&gt; [String]
-&gt; ExceptT String (TypeM rep) ()
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ExceptT String (TypeM rep) ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ExceptT String (TypeM rep) ())
-&gt; ([String] -&gt; String)
-&gt; [String]
-&gt; ExceptT String (TypeM rep) ()
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; ExceptT String (TypeM rep) ())
-&gt; [String] -&gt; ExceptT String (TypeM rep) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-708"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected ext dim&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386926"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;=&gt;&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386924"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;but got&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386925"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-709"></span><span>
</span><span id="line-710"></span><span>      </span><span id="local-6989586621684386932"><span class="annot"><span class="annottext">checkMemReturn :: MemReturn -&gt; MemBind -&gt; ExceptT String (TypeM rep) ()
</span><a href="#local-6989586621684386932"><span class="hs-identifier hs-var hs-var">checkMemReturn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-type">ReturnsInBlock</span></a></span><span> </span><span id="local-6989586621684386922"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386922"><span class="hs-identifier hs-var">x_mem</span></a></span></span><span> </span><span id="local-6989586621684386921"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386921"><span class="hs-identifier hs-var">x_ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ArrayIn"><span class="hs-identifier hs-type">ArrayIn</span></a></span><span> </span><span id="local-6989586621684386920"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386920"><span class="hs-identifier hs-var">y_mem</span></a></span></span><span> </span><span id="local-6989586621684386919"><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386919"><span class="hs-identifier hs-var">y_ixfun</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-711"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386922"><span class="hs-identifier hs-var">x_mem</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; VName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386920"><span class="hs-identifier hs-var">y_mem</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-712"></span><span>          </span><span class="annot"><span class="annottext">Bool
-&gt; ExceptT String (TypeM rep) () -&gt; ExceptT String (TypeM rep) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExtIxFun -&gt; ExtIxFun -&gt; Bool
forall num. IxFun num -&gt; IxFun num -&gt; Bool
</span><a href="Futhark.IR.Mem.IxFun.html#closeEnough"><span class="hs-identifier hs-var">IxFun.closeEnough</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386921"><span class="hs-identifier hs-var">x_ixfun</span></a></span><span> </span><span class="annot"><span class="annottext">(ExtIxFun -&gt; Bool) -&gt; ExtIxFun -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IxFun -&gt; ExtIxFun
</span><a href="#local-6989586621684386961"><span class="hs-identifier hs-var">existentialiseIxFun0</span></a></span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386919"><span class="hs-identifier hs-var">y_ixfun</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT String (TypeM rep) () -&gt; ExceptT String (TypeM rep) ())
-&gt; ExceptT String (TypeM rep) () -&gt; ExceptT String (TypeM rep) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-713"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ExceptT String (TypeM rep) ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ExceptT String (TypeM rep) ())
-&gt; ([String] -&gt; String)
-&gt; [String]
-&gt; ExceptT String (TypeM rep) ()
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; ExceptT String (TypeM rep) ())
-&gt; [String] -&gt; ExceptT String (TypeM rep) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-714"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Index function unification failed (ReturnsInBlock)&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-715"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nixfun of body result: &quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-716"></span><span>                </span><span class="annot"><span class="annottext">IxFun -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386919"><span class="hs-identifier hs-var">y_ixfun</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-717"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nixfun of return type: &quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-718"></span><span>                </span><span class="annot"><span class="annottext">ExtIxFun -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386921"><span class="hs-identifier hs-var">x_ixfun</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-719"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nand context elements: &quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-720"></span><span>                </span><span class="annot"><span class="annottext">[SubExp] -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684386965"><span class="hs-identifier hs-var">ctx_res</span></a></span><span>
</span><span id="line-721"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-722"></span><span>      </span><span class="annot"><a href="#local-6989586621684386932"><span class="hs-identifier hs-var">checkMemReturn</span></a></span><span>
</span><span id="line-723"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsNewBlock"><span class="hs-identifier hs-type">ReturnsNewBlock</span></a></span><span> </span><span id="local-6989586621684386917"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386917"><span class="hs-identifier hs-var">x_space</span></a></span></span><span> </span><span id="local-6989586621684386916"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386916"><span class="hs-identifier hs-var">x_ext</span></a></span></span><span> </span><span id="local-6989586621684386915"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386915"><span class="hs-identifier hs-var">x_ixfun</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-724"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ArrayIn"><span class="hs-identifier hs-type">ArrayIn</span></a></span><span> </span><span id="local-6989586621684386914"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386914"><span class="hs-identifier hs-var">y_mem</span></a></span></span><span> </span><span id="local-6989586621684386913"><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386913"><span class="hs-identifier hs-var">y_ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-725"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621684386912"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386912"><span class="hs-identifier hs-var">x_mem</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684386911"><span class="annot"><span class="annottext">LetDecMem
</span><a href="#local-6989586621684386911"><span class="hs-identifier hs-var">x_mem_type</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ExceptT String (TypeM rep) (SubExp, LetDecMem)
</span><a href="#local-6989586621684386960"><span class="hs-identifier hs-var">fetchCtx</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386916"><span class="hs-identifier hs-var">x_ext</span></a></span><span>
</span><span id="line-726"></span><span>          </span><span class="annot"><span class="annottext">Bool
-&gt; ExceptT String (TypeM rep) () -&gt; ExceptT String (TypeM rep) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExtIxFun -&gt; ExtIxFun -&gt; Bool
forall num. IxFun num -&gt; IxFun num -&gt; Bool
</span><a href="Futhark.IR.Mem.IxFun.html#closeEnough"><span class="hs-identifier hs-var">IxFun.closeEnough</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386915"><span class="hs-identifier hs-var">x_ixfun</span></a></span><span> </span><span class="annot"><span class="annottext">(ExtIxFun -&gt; Bool) -&gt; ExtIxFun -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IxFun -&gt; ExtIxFun
</span><a href="#local-6989586621684386961"><span class="hs-identifier hs-var">existentialiseIxFun0</span></a></span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386913"><span class="hs-identifier hs-var">y_ixfun</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT String (TypeM rep) () -&gt; ExceptT String (TypeM rep) ())
-&gt; ExceptT String (TypeM rep) () -&gt; ExceptT String (TypeM rep) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-727"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ExceptT String (TypeM rep) ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ExceptT String (TypeM rep) ())
-&gt; (Doc -&gt; String) -&gt; Doc -&gt; ExceptT String (TypeM rep) ()
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; ExceptT String (TypeM rep) ())
-&gt; Doc -&gt; ExceptT String (TypeM rep) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-728"></span><span>              </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Index function unification failed (ReturnsNewBlock)&quot;</span></span><span>
</span><span id="line-729"></span><span>                </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Ixfun of body result:&quot;</span></span><span>
</span><span id="line-730"></span><span>                </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
</span><span class="hs-identifier hs-var">indent</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IxFun -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386913"><span class="hs-identifier hs-var">y_ixfun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-731"></span><span>                </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Ixfun of return type:&quot;</span></span><span>
</span><span id="line-732"></span><span>                </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
</span><span class="hs-identifier hs-var">indent</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExtIxFun -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386915"><span class="hs-identifier hs-var">x_ixfun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-733"></span><span>                </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Context elements: &quot;</span></span><span>
</span><span id="line-734"></span><span>                </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
</span><span class="hs-identifier hs-var">indent</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SubExp] -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684386965"><span class="hs-identifier hs-var">ctx_res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-735"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LetDecMem
</span><a href="#local-6989586621684386911"><span class="hs-identifier hs-var">x_mem_type</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-736"></span><span>            </span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684386910"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386910"><span class="hs-identifier hs-var">y_space</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-737"></span><span>              </span><span class="annot"><span class="annottext">Bool
-&gt; ExceptT String (TypeM rep) () -&gt; ExceptT String (TypeM rep) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386917"><span class="hs-identifier hs-var">x_space</span></a></span><span> </span><span class="annot"><span class="annottext">Space -&gt; Space -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386910"><span class="hs-identifier hs-var">y_space</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT String (TypeM rep) () -&gt; ExceptT String (TypeM rep) ())
-&gt; ([String] -&gt; ExceptT String (TypeM rep) ())
-&gt; [String]
-&gt; ExceptT String (TypeM rep) ()
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ExceptT String (TypeM rep) ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ExceptT String (TypeM rep) ())
-&gt; ([String] -&gt; String)
-&gt; [String]
-&gt; ExceptT String (TypeM rep) ()
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; ExceptT String (TypeM rep) ())
-&gt; [String] -&gt; ExceptT String (TypeM rep) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-738"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected memory&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-739"></span><span>                  </span><span class="annot"><span class="annottext">VName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386914"><span class="hs-identifier hs-var">y_mem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-740"></span><span>                  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;in space&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-741"></span><span>                  </span><span class="annot"><span class="annottext">Space -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386917"><span class="hs-identifier hs-var">x_space</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-742"></span><span>                  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;but actually in space&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-743"></span><span>                  </span><span class="annot"><span class="annottext">Space -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386910"><span class="hs-identifier hs-var">y_space</span></a></span><span>
</span><span id="line-744"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-745"></span><span>            </span><span id="local-6989586621684386909"><span class="annot"><span class="annottext">LetDecMem
</span><a href="#local-6989586621684386909"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-746"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; ExceptT String (TypeM rep) ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ExceptT String (TypeM rep) ())
-&gt; ([String] -&gt; String)
-&gt; [String]
-&gt; ExceptT String (TypeM rep) ()
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; ExceptT String (TypeM rep) ())
-&gt; [String] -&gt; ExceptT String (TypeM rep) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-747"></span><span>                </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected memory&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386916"><span class="hs-identifier hs-var">x_ext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;=&gt;&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386912"><span class="hs-identifier hs-var">x_mem</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;but but has type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LetDecMem -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">LetDecMem
</span><a href="#local-6989586621684386909"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-748"></span><span>      </span><span class="annot"><a href="#local-6989586621684386932"><span class="hs-identifier hs-var">checkMemReturn</span></a></span><span> </span><span id="local-6989586621684386908"><span class="annot"><span class="annottext">MemReturn
</span><a href="#local-6989586621684386908"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621684386907"><span class="annot"><span class="annottext">MemBind
</span><a href="#local-6989586621684386907"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-749"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ExceptT String (TypeM rep) ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ExceptT String (TypeM rep) ())
-&gt; (Doc -&gt; String) -&gt; Doc -&gt; ExceptT String (TypeM rep) ()
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; ExceptT String (TypeM rep) ())
-&gt; Doc -&gt; ExceptT String (TypeM rep) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-750"></span><span>          </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Expected array in&quot;</span></span><span>
</span><span id="line-751"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
</span><span class="hs-identifier hs-var">indent</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MemReturn -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">MemReturn
</span><a href="#local-6989586621684386908"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-752"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;but array returned in&quot;</span></span><span>
</span><span id="line-753"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
</span><span class="hs-identifier hs-var">indent</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MemBind -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">MemBind
</span><a href="#local-6989586621684386907"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-754"></span><span>
</span><span id="line-755"></span><span>      </span><span id="local-6989586621684388893"><span id="local-6989586621684388894"><span class="annot"><a href="#local-6989586621684386906"><span class="hs-identifier hs-type">bad</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.TypeCheck.html#TypeM"><span class="hs-identifier hs-type">TC.TypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388894"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388893"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-756"></span><span>      </span><span id="local-6989586621684386906"><span class="annot"><span class="annottext">bad :: forall rep a. String -&gt; TypeM rep a
</span><a href="#local-6989586621684386906"><span class="hs-identifier hs-var hs-var">bad</span></a></span></span><span> </span><span id="local-6989586621684386900"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684386900"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-757"></span><span>        </span><span class="annot"><span class="annottext">ErrorCase rep -&gt; TypeM rep a
forall rep a. ErrorCase rep -&gt; TypeM rep a
</span><a href="Futhark.IR.TypeCheck.html#bad"><span class="hs-identifier hs-var">TC.bad</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorCase rep -&gt; TypeM rep a) -&gt; ErrorCase rep -&gt; TypeM rep a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-758"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ErrorCase rep
forall rep. String -&gt; ErrorCase rep
</span><a href="Futhark.IR.TypeCheck.html#TypeError"><span class="hs-identifier hs-var">TC.TypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ErrorCase rep) -&gt; String -&gt; ErrorCase rep
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-759"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; String) -&gt; Doc -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-760"></span><span>              </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Return type&quot;</span></span><span>
</span><span id="line-761"></span><span>                </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
</span><span class="hs-identifier hs-var">indent</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[MemInfo (Ext SubExp) u MemReturn] -&gt; Doc
forall a. Pretty a =&gt; [a] -&gt; Doc
</span><a href="Futhark.IR.Pretty.html#ppTuple%27"><span class="hs-identifier hs-var">ppTuple'</span></a></span><span> </span><span class="annot"><span class="annottext">[MemInfo (Ext SubExp) u MemReturn]
</span><a href="#local-6989586621684386968"><span class="hs-identifier hs-var">rettype</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-762"></span><span>                </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;cannot match returns of results&quot;</span></span><span>
</span><span id="line-763"></span><span>                </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
</span><span class="hs-identifier hs-var">indent</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LetDecMem] -&gt; Doc
forall a. Pretty a =&gt; [a] -&gt; Doc
</span><a href="Futhark.IR.Pretty.html#ppTuple%27"><span class="hs-identifier hs-var">ppTuple'</span></a></span><span> </span><span class="annot"><span class="annottext">[LetDecMem]
</span><a href="#local-6989586621684386966"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-764"></span><span>                </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684386900"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-765"></span><span>
</span><span id="line-766"></span><span>  </span><span class="annot"><span class="annottext">(String -&gt; TypeM rep ())
-&gt; (() -&gt; TypeM rep ()) -&gt; Either String () -&gt; TypeM rep ()
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; TypeM rep ()
forall rep a. String -&gt; TypeM rep a
</span><a href="#local-6989586621684386906"><span class="hs-identifier hs-var">bad</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; TypeM rep ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either String () -&gt; TypeM rep ())
-&gt; TypeM rep (Either String ()) -&gt; TypeM rep ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ExceptT String (TypeM rep) () -&gt; TypeM rep (Either String ())
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(MemInfo (Ext SubExp) u MemReturn
 -&gt; LetDecMem -&gt; ExceptT String (TypeM rep) ())
-&gt; [MemInfo (Ext SubExp) u MemReturn]
-&gt; [LetDecMem]
-&gt; ExceptT String (TypeM rep) ()
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m ()
</span><span class="hs-identifier hs-var">zipWithM_</span></span><span> </span><span class="annot"><span class="annottext">MemInfo (Ext SubExp) u MemReturn
-&gt; LetDecMem -&gt; ExceptT String (TypeM rep) ()
</span><a href="#local-6989586621684386953"><span class="hs-identifier hs-var">checkReturn</span></a></span><span> </span><span class="annot"><span class="annottext">[MemInfo (Ext SubExp) u MemReturn]
</span><a href="#local-6989586621684386968"><span class="hs-identifier hs-var">rettype</span></a></span><span> </span><span class="annot"><span class="annottext">[LetDecMem]
</span><a href="#local-6989586621684386966"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-767"></span><span>
</span><span id="line-768"></span><span id="local-6989586621684388879"><span id="local-6989586621684388880"><span class="annot"><a href="Futhark.IR.Mem.html#matchPatToExp"><span class="hs-identifier hs-type">matchPatToExp</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-769"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388880"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388879"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Rep.html#LetDec"><span class="hs-identifier hs-type">LetDec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388880"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#LetDecMem"><span class="hs-identifier hs-type">LetDecMem</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.TypeCheck.html#Checkable"><span class="hs-identifier hs-type">TC.Checkable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388880"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-770"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Aliases.html#Aliases"><span class="hs-identifier hs-type">Aliases</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388880"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-771"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Aliases.html#Aliases"><span class="hs-identifier hs-type">Aliases</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388880"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-772"></span><span>  </span><span class="annot"><a href="Futhark.IR.TypeCheck.html#TypeM"><span class="hs-identifier hs-type">TC.TypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388880"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-773"></span><span id="matchPatToExp"><span class="annot"><span class="annottext">matchPatToExp :: forall rep inner.
(Mem rep inner, LetDec rep ~ LetDecMem, Checkable rep) =&gt;
Pat (Aliases rep) -&gt; Exp (Aliases rep) -&gt; TypeM rep ()
</span><a href="Futhark.IR.Mem.html#matchPatToExp"><span class="hs-identifier hs-var hs-var">matchPatToExp</span></a></span></span><span> </span><span id="local-6989586621684386816"><span class="annot"><span class="annottext">Pat (Aliases rep)
</span><a href="#local-6989586621684386816"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684386815"><span class="annot"><span class="annottext">Exp (Aliases rep)
</span><a href="#local-6989586621684386815"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-774"></span><span>  </span><span id="local-6989586621684386814"><span class="annot"><span class="annottext">Scope rep
</span><a href="#local-6989586621684386814"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Scope (Aliases rep) -&gt; Scope rep) -&gt; TypeM rep (Scope rep)
forall rep (m :: * -&gt; *) a.
HasScope rep m =&gt;
(Scope rep -&gt; a) -&gt; m a
</span><a href="Futhark.IR.Prop.Scope.html#asksScope"><span class="hs-identifier hs-var">asksScope</span></a></span><span> </span><span class="annot"><span class="annottext">Scope (Aliases rep) -&gt; Scope rep
forall rep. Scope (Aliases rep) -&gt; Scope rep
</span><a href="Futhark.IR.Aliases.html#removeScopeAliases"><span class="hs-identifier hs-var">removeScopeAliases</span></a></span><span>
</span><span id="line-775"></span><span>  </span><span id="local-6989586621684386812"><span class="annot"><span class="annottext">[ExpReturns]
</span><a href="#local-6989586621684386812"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT (Scope rep) (TypeM rep) [ExpReturns]
-&gt; Scope rep -&gt; TypeM rep [ExpReturns]
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var hs-var">runReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp rep -&gt; ReaderT (Scope rep) (TypeM rep) [ExpReturns]
forall (m :: * -&gt; *) rep inner.
(Monad m, LocalScope rep m, Mem rep inner) =&gt;
Exp rep -&gt; m [ExpReturns]
</span><a href="Futhark.IR.Mem.html#expReturns"><span class="hs-identifier hs-var">expReturns</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp rep -&gt; ReaderT (Scope rep) (TypeM rep) [ExpReturns])
-&gt; Exp rep -&gt; ReaderT (Scope rep) (TypeM rep) [ExpReturns]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp (Aliases rep) -&gt; Exp rep
forall rep. CanBeAliased (Op rep) =&gt; Exp (Aliases rep) -&gt; Exp rep
</span><a href="Futhark.IR.Aliases.html#removeExpAliases"><span class="hs-identifier hs-var">removeExpAliases</span></a></span><span> </span><span class="annot"><span class="annottext">Exp (Aliases rep)
</span><a href="#local-6989586621684386815"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Scope rep
</span><a href="#local-6989586621684386814"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-776"></span><span>
</span><span id="line-777"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684386811"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684386811"><span class="hs-identifier hs-var">ctx_ids</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684386810"><span class="annot"><span class="annottext">[BodyReturns]
</span><a href="#local-6989586621684386810"><span class="hs-identifier hs-var">val_ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(VName, BodyReturns)] -&gt; ([VName], [BodyReturns])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([(VName, BodyReturns)] -&gt; ([VName], [BodyReturns]))
-&gt; [(VName, BodyReturns)] -&gt; ([VName], [BodyReturns])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatT LetDecMem -&gt; [(VName, BodyReturns)]
</span><a href="Futhark.IR.Mem.html#bodyReturnsFromPat"><span class="hs-identifier hs-var">bodyReturnsFromPat</span></a></span><span> </span><span class="annot"><span class="annottext">(PatT LetDecMem -&gt; [(VName, BodyReturns)])
-&gt; PatT LetDecMem -&gt; [(VName, BodyReturns)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatT (AliasDec, LetDecMem) -&gt; PatT LetDecMem
forall a. PatT (AliasDec, a) -&gt; PatT a
</span><a href="Futhark.IR.Aliases.html#removePatAliases"><span class="hs-identifier hs-var">removePatAliases</span></a></span><span> </span><span class="annot"><span class="annottext">PatT (AliasDec, LetDecMem)
Pat (Aliases rep)
</span><a href="#local-6989586621684386816"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-778"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684386808"><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><a href="#local-6989586621684386808"><span class="hs-identifier hs-var">ctx_map_ids</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684386807"><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><a href="#local-6989586621684386807"><span class="hs-identifier hs-var">ctx_map_exts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(VName, Int)]
-&gt; (Map (Ext VName) (TPrimExp Int64 (Ext VName)),
    Map (Ext VName) (TPrimExp Int64 (Ext VName)))
</span><a href="Futhark.IR.Mem.html#getExtMaps"><span class="hs-identifier hs-var">getExtMaps</span></a></span><span> </span><span class="annot"><span class="annottext">([(VName, Int)]
 -&gt; (Map (Ext VName) (TPrimExp Int64 (Ext VName)),
     Map (Ext VName) (TPrimExp Int64 (Ext VName))))
-&gt; [(VName, Int)]
-&gt; (Map (Ext VName) (TPrimExp Int64 (Ext VName)),
    Map (Ext VName) (TPrimExp Int64 (Ext VName)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; [Int] -&gt; [(VName, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684386811"><span class="hs-identifier hs-var">ctx_ids</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-779"></span><span>
</span><span id="line-780"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TypeM rep () -&gt; TypeM rep ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span>
</span><span id="line-781"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[BodyReturns] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[BodyReturns]
</span><a href="#local-6989586621684386810"><span class="hs-identifier hs-var">val_ts</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[ExpReturns] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[ExpReturns]
</span><a href="#local-6989586621684386812"><span class="hs-identifier hs-var">rt</span></a></span><span>
</span><span id="line-782"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">and</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BodyReturns -&gt; ExpReturns -&gt; Bool)
-&gt; [BodyReturns] -&gt; [ExpReturns] -&gt; [Bool]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
-&gt; Map (Ext VName) (TPrimExp Int64 (Ext VName))
-&gt; BodyReturns
-&gt; ExpReturns
-&gt; Bool
forall {d} {u} {u}.
Eq d =&gt;
Map (Ext VName) (TPrimExp Int64 (Ext VName))
-&gt; Map (Ext VName) (TPrimExp Int64 (Ext VName))
-&gt; MemInfo d u MemReturn
-&gt; MemInfo d u (Maybe MemReturn)
-&gt; Bool
</span><a href="#local-6989586621684386803"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><a href="#local-6989586621684386808"><span class="hs-identifier hs-var">ctx_map_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><a href="#local-6989586621684386807"><span class="hs-identifier hs-var">ctx_map_exts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[BodyReturns]
</span><a href="#local-6989586621684386810"><span class="hs-identifier hs-var">val_ts</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpReturns]
</span><a href="#local-6989586621684386812"><span class="hs-identifier hs-var">rt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-783"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-784"></span><span>    </span><span class="annot"><span class="annottext">(TypeM rep () -&gt; TypeM rep ()) -&gt; TypeM rep () -&gt; TypeM rep ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ErrorCase rep -&gt; TypeM rep ()
forall rep a. ErrorCase rep -&gt; TypeM rep a
</span><a href="Futhark.IR.TypeCheck.html#bad"><span class="hs-identifier hs-var">TC.bad</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorCase rep -&gt; TypeM rep ()) -&gt; ErrorCase rep -&gt; TypeM rep ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-785"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ErrorCase rep
forall rep. String -&gt; ErrorCase rep
</span><a href="Futhark.IR.TypeCheck.html#TypeError"><span class="hs-identifier hs-var">TC.TypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ErrorCase rep) -&gt; String -&gt; ErrorCase rep
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-786"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expression type:\n  &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ExpReturns] -&gt; String
forall a. Pretty a =&gt; [a] -&gt; String
</span><a href="Futhark.Util.Pretty.html#prettyTuple"><span class="hs-identifier hs-var">prettyTuple</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpReturns]
</span><a href="#local-6989586621684386812"><span class="hs-identifier hs-var">rt</span></a></span><span>
</span><span id="line-787"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\ncannot match pattern type:\n  &quot;</span></span><span>
</span><span id="line-788"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[BodyReturns] -&gt; String
forall a. Pretty a =&gt; [a] -&gt; String
</span><a href="Futhark.Util.Pretty.html#prettyTuple"><span class="hs-identifier hs-var">prettyTuple</span></a></span><span> </span><span class="annot"><span class="annottext">[BodyReturns]
</span><a href="#local-6989586621684386810"><span class="hs-identifier hs-var">val_ts</span></a></span><span>
</span><span id="line-789"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-790"></span><span>    </span><span id="local-6989586621684386803"><span class="annot"><span class="annottext">matches :: Map (Ext VName) (TPrimExp Int64 (Ext VName))
-&gt; Map (Ext VName) (TPrimExp Int64 (Ext VName))
-&gt; MemInfo d u MemReturn
-&gt; MemInfo d u (Maybe MemReturn)
-&gt; Bool
</span><a href="#local-6989586621684386803"><span class="hs-identifier hs-var hs-var">matches</span></a></span></span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span id="local-6989586621684386780"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386780"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span id="local-6989586621684386779"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386779"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386780"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; PrimType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386779"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-791"></span><span>    </span><span class="annot"><a href="#local-6989586621684386803"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684386778"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386778"><span class="hs-identifier hs-var">x_space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684386777"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386777"><span class="hs-identifier hs-var">y_space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-792"></span><span>      </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386778"><span class="hs-identifier hs-var">x_space</span></a></span><span> </span><span class="annot"><span class="annottext">Space -&gt; Space -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386777"><span class="hs-identifier hs-var">y_space</span></a></span><span>
</span><span id="line-793"></span><span>    </span><span class="annot"><a href="#local-6989586621684386803"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684386776"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386776"><span class="hs-identifier hs-var">x_accs</span></a></span></span><span> </span><span id="local-6989586621684386775"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386775"><span class="hs-identifier hs-var">x_ispace</span></a></span></span><span> </span><span id="local-6989586621684386774"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684386774"><span class="hs-identifier hs-var">x_ts</span></a></span></span><span> </span><span class="annot"><span class="annottext">u
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684386773"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386773"><span class="hs-identifier hs-var">y_accs</span></a></span></span><span> </span><span id="local-6989586621684386772"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386772"><span class="hs-identifier hs-var">y_ispace</span></a></span></span><span> </span><span id="local-6989586621684386771"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684386771"><span class="hs-identifier hs-var">y_ts</span></a></span></span><span> </span><span class="annot"><span class="annottext">u
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-794"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386776"><span class="hs-identifier hs-var">x_accs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386775"><span class="hs-identifier hs-var">x_ispace</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684386774"><span class="hs-identifier hs-var">x_ts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(VName, Shape, [Type]) -&gt; (VName, Shape, [Type]) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386773"><span class="hs-identifier hs-var">y_accs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386772"><span class="hs-identifier hs-var">y_ispace</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684386771"><span class="hs-identifier hs-var">y_ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-795"></span><span>    </span><span class="annot"><a href="#local-6989586621684386803"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span id="local-6989586621684386770"><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><a href="#local-6989586621684386770"><span class="hs-identifier hs-var">ctxids</span></a></span></span><span> </span><span id="local-6989586621684386769"><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><a href="#local-6989586621684386769"><span class="hs-identifier hs-var">ctxexts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span id="local-6989586621684386768"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386768"><span class="hs-identifier hs-var">x_pt</span></a></span></span><span> </span><span id="local-6989586621684386767"><span class="annot"><span class="annottext">ShapeBase d
</span><a href="#local-6989586621684386767"><span class="hs-identifier hs-var">x_shape</span></a></span></span><span> </span><span class="annot"><span class="annottext">u
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684386766"><span class="annot"><span class="annottext">MemReturn
</span><a href="#local-6989586621684386766"><span class="hs-identifier hs-var">x_ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span id="local-6989586621684386765"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386765"><span class="hs-identifier hs-var">y_pt</span></a></span></span><span> </span><span id="local-6989586621684386764"><span class="annot"><span class="annottext">ShapeBase d
</span><a href="#local-6989586621684386764"><span class="hs-identifier hs-var">y_shape</span></a></span></span><span> </span><span class="annot"><span class="annottext">u
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684386763"><span class="annot"><span class="annottext">Maybe MemReturn
</span><a href="#local-6989586621684386763"><span class="hs-identifier hs-var">y_ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-796"></span><span>      </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386768"><span class="hs-identifier hs-var">x_pt</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; PrimType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386765"><span class="hs-identifier hs-var">y_pt</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">ShapeBase d
</span><a href="#local-6989586621684386767"><span class="hs-identifier hs-var">x_shape</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase d -&gt; ShapeBase d -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ShapeBase d
</span><a href="#local-6989586621684386764"><span class="hs-identifier hs-var">y_shape</span></a></span><span>
</span><span id="line-797"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MemReturn
</span><a href="#local-6989586621684386766"><span class="hs-identifier hs-var">x_ret</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe MemReturn
</span><a href="#local-6989586621684386763"><span class="hs-identifier hs-var">y_ret</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-798"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-type">ReturnsInBlock</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684386762"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386762"><span class="hs-identifier hs-var">x_ixfun</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-type">ReturnsInBlock</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684386761"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386761"><span class="hs-identifier hs-var">y_ixfun</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-799"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684386760"><span class="annot"><span class="annottext">x_ixfun' :: ExtIxFun
</span><a href="#local-6989586621684386760"><span class="hs-identifier hs-var hs-var">x_ixfun'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
-&gt; ExtIxFun -&gt; ExtIxFun
forall a t.
Ord a =&gt;
Map a (TPrimExp t a)
-&gt; IxFun (TPrimExp t a) -&gt; IxFun (TPrimExp t a)
</span><a href="Futhark.IR.Mem.IxFun.html#substituteInIxFun"><span class="hs-identifier hs-var">IxFun.substituteInIxFun</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><a href="#local-6989586621684386770"><span class="hs-identifier hs-var">ctxids</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386762"><span class="hs-identifier hs-var">x_ixfun</span></a></span><span>
</span><span id="line-800"></span><span>                </span><span id="local-6989586621684386759"><span class="annot"><span class="annottext">y_ixfun' :: ExtIxFun
</span><a href="#local-6989586621684386759"><span class="hs-identifier hs-var hs-var">y_ixfun'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
-&gt; ExtIxFun -&gt; ExtIxFun
forall a t.
Ord a =&gt;
Map a (TPrimExp t a)
-&gt; IxFun (TPrimExp t a) -&gt; IxFun (TPrimExp t a)
</span><a href="Futhark.IR.Mem.IxFun.html#substituteInIxFun"><span class="hs-identifier hs-var">IxFun.substituteInIxFun</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><a href="#local-6989586621684386769"><span class="hs-identifier hs-var">ctxexts</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386761"><span class="hs-identifier hs-var">y_ixfun</span></a></span><span>
</span><span id="line-801"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ExtIxFun -&gt; ExtIxFun -&gt; Bool
forall num. IxFun num -&gt; IxFun num -&gt; Bool
</span><a href="Futhark.IR.Mem.IxFun.html#closeEnough"><span class="hs-identifier hs-var">IxFun.closeEnough</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386760"><span class="hs-identifier hs-var">x_ixfun'</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386759"><span class="hs-identifier hs-var">y_ixfun'</span></a></span><span>
</span><span id="line-802"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-type">ReturnsInBlock</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684386758"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386758"><span class="hs-identifier hs-var">x_ixfun</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-803"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsNewBlock"><span class="hs-identifier hs-type">ReturnsNewBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684386757"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386757"><span class="hs-identifier hs-var">y_ixfun</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-804"></span><span>            </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-805"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684386756"><span class="annot"><span class="annottext">x_ixfun' :: ExtIxFun
</span><a href="#local-6989586621684386756"><span class="hs-identifier hs-var hs-var">x_ixfun'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
-&gt; ExtIxFun -&gt; ExtIxFun
forall a t.
Ord a =&gt;
Map a (TPrimExp t a)
-&gt; IxFun (TPrimExp t a) -&gt; IxFun (TPrimExp t a)
</span><a href="Futhark.IR.Mem.IxFun.html#substituteInIxFun"><span class="hs-identifier hs-var">IxFun.substituteInIxFun</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><a href="#local-6989586621684386770"><span class="hs-identifier hs-var">ctxids</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386758"><span class="hs-identifier hs-var">x_ixfun</span></a></span><span>
</span><span id="line-806"></span><span>                  </span><span id="local-6989586621684386755"><span class="annot"><span class="annottext">y_ixfun' :: ExtIxFun
</span><a href="#local-6989586621684386755"><span class="hs-identifier hs-var hs-var">y_ixfun'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
-&gt; ExtIxFun -&gt; ExtIxFun
forall a t.
Ord a =&gt;
Map a (TPrimExp t a)
-&gt; IxFun (TPrimExp t a) -&gt; IxFun (TPrimExp t a)
</span><a href="Futhark.IR.Mem.IxFun.html#substituteInIxFun"><span class="hs-identifier hs-var">IxFun.substituteInIxFun</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><a href="#local-6989586621684386769"><span class="hs-identifier hs-var">ctxexts</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386757"><span class="hs-identifier hs-var">y_ixfun</span></a></span><span>
</span><span id="line-807"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ExtIxFun -&gt; ExtIxFun -&gt; Bool
forall num. IxFun num -&gt; IxFun num -&gt; Bool
</span><a href="Futhark.IR.Mem.IxFun.html#closeEnough"><span class="hs-identifier hs-var">IxFun.closeEnough</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386756"><span class="hs-identifier hs-var">x_ixfun'</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386755"><span class="hs-identifier hs-var">y_ixfun'</span></a></span><span>
</span><span id="line-808"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsNewBlock"><span class="hs-identifier hs-type">ReturnsNewBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684386754"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386754"><span class="hs-identifier hs-var">x_i</span></a></span></span><span> </span><span id="local-6989586621684386753"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386753"><span class="hs-identifier hs-var">x_ixfun</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-809"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsNewBlock"><span class="hs-identifier hs-type">ReturnsNewBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684386752"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386752"><span class="hs-identifier hs-var">y_i</span></a></span></span><span> </span><span id="local-6989586621684386751"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386751"><span class="hs-identifier hs-var">y_ixfun</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-810"></span><span>            </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-811"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684386750"><span class="annot"><span class="annottext">x_ixfun' :: ExtIxFun
</span><a href="#local-6989586621684386750"><span class="hs-identifier hs-var hs-var">x_ixfun'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
-&gt; ExtIxFun -&gt; ExtIxFun
forall a t.
Ord a =&gt;
Map a (TPrimExp t a)
-&gt; IxFun (TPrimExp t a) -&gt; IxFun (TPrimExp t a)
</span><a href="Futhark.IR.Mem.IxFun.html#substituteInIxFun"><span class="hs-identifier hs-var">IxFun.substituteInIxFun</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><a href="#local-6989586621684386770"><span class="hs-identifier hs-var">ctxids</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386753"><span class="hs-identifier hs-var">x_ixfun</span></a></span><span>
</span><span id="line-812"></span><span>                  </span><span id="local-6989586621684386749"><span class="annot"><span class="annottext">y_ixfun' :: ExtIxFun
</span><a href="#local-6989586621684386749"><span class="hs-identifier hs-var hs-var">y_ixfun'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
-&gt; ExtIxFun -&gt; ExtIxFun
forall a t.
Ord a =&gt;
Map a (TPrimExp t a)
-&gt; IxFun (TPrimExp t a) -&gt; IxFun (TPrimExp t a)
</span><a href="Futhark.IR.Mem.IxFun.html#substituteInIxFun"><span class="hs-identifier hs-var">IxFun.substituteInIxFun</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><a href="#local-6989586621684386769"><span class="hs-identifier hs-var">ctxexts</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386751"><span class="hs-identifier hs-var">y_ixfun</span></a></span><span>
</span><span id="line-813"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386754"><span class="hs-identifier hs-var">x_i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386752"><span class="hs-identifier hs-var">y_i</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">ExtIxFun -&gt; ExtIxFun -&gt; Bool
forall num. IxFun num -&gt; IxFun num -&gt; Bool
</span><a href="Futhark.IR.Mem.IxFun.html#closeEnough"><span class="hs-identifier hs-var">IxFun.closeEnough</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386750"><span class="hs-identifier hs-var">x_ixfun'</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684386749"><span class="hs-identifier hs-var">y_ixfun'</span></a></span><span>
</span><span id="line-814"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MemReturn
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe MemReturn
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-815"></span><span>          </span><span class="annot"><span class="annottext">(MemReturn, Maybe MemReturn)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-816"></span><span>    </span><span class="annot"><a href="#local-6989586621684386803"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Map (Ext VName) (TPrimExp Int64 (Ext VName))
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MemInfo d u MemReturn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MemInfo d u (Maybe MemReturn)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-817"></span><span>
</span><span id="line-818"></span><span id="local-6989586621684388973"><span id="local-6989586621684388974"><span class="annot"><a href="Futhark.IR.Mem.html#varMemInfo"><span class="hs-identifier hs-type">varMemInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-819"></span><span>  </span><span class="annot"><a href="Futhark.IR.Mem.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388974"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388973"><span class="hs-identifier hs-type">inner</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-820"></span><span>  </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-821"></span><span>  </span><span class="annot"><a href="Futhark.IR.TypeCheck.html#TypeM"><span class="hs-identifier hs-type">TC.TypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388974"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-type">NoUniqueness</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier hs-type">MemBind</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-822"></span><span id="varMemInfo"><span class="annot"><span class="annottext">varMemInfo :: forall rep inner. Mem rep inner =&gt; VName -&gt; TypeM rep LetDecMem
</span><a href="Futhark.IR.Mem.html#varMemInfo"><span class="hs-identifier hs-var hs-var">varMemInfo</span></a></span></span><span> </span><span id="local-6989586621684386730"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386730"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-823"></span><span>  </span><span id="local-6989586621684386729"><span class="annot"><span class="annottext">NameInfo (Aliases rep)
</span><a href="#local-6989586621684386729"><span class="hs-identifier hs-var">dec</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; TypeM rep (NameInfo (Aliases rep))
forall rep. VName -&gt; TypeM rep (NameInfo (Aliases rep))
</span><a href="Futhark.IR.TypeCheck.html#lookupVar"><span class="hs-identifier hs-var">TC.lookupVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386730"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-824"></span><span>
</span><span id="line-825"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NameInfo (Aliases rep)
</span><a href="#local-6989586621684386729"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-826"></span><span>    </span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#LetName"><span class="hs-identifier hs-type">LetName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AliasDec
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684386726"><span class="annot"><span class="annottext">LetDec rep
</span><a href="#local-6989586621684386726"><span class="hs-identifier hs-var">summary</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LetDecMem -&gt; TypeM rep LetDecMem
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(LetDecMem -&gt; TypeM rep LetDecMem)
-&gt; LetDecMem -&gt; TypeM rep LetDecMem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LetDec rep -&gt; LetDecMem
forall t. HasLetDecMem t =&gt; t -&gt; LetDecMem
</span><a href="Futhark.IR.Mem.html#letDecMem"><span class="hs-identifier hs-var">letDecMem</span></a></span><span> </span><span class="annot"><span class="annottext">LetDec rep
</span><a href="#local-6989586621684386726"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-827"></span><span>    </span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#FParamName"><span class="hs-identifier hs-type">FParamName</span></a></span><span> </span><span id="local-6989586621684386724"><span class="annot"><span class="annottext">FParamInfo (Aliases rep)
</span><a href="#local-6989586621684386724"><span class="hs-identifier hs-var">summary</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LetDecMem -&gt; TypeM rep LetDecMem
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(LetDecMem -&gt; TypeM rep LetDecMem)
-&gt; LetDecMem -&gt; TypeM rep LetDecMem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FParamMem -&gt; LetDecMem
forall d u r. MemInfo d u r -&gt; MemInfo d NoUniqueness r
</span><a href="Futhark.IR.Mem.html#noUniquenessReturns"><span class="hs-identifier hs-var">noUniquenessReturns</span></a></span><span> </span><span class="annot"><span class="annottext">FParamInfo (Aliases rep)
FParamMem
</span><a href="#local-6989586621684386724"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-828"></span><span>    </span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#LParamName"><span class="hs-identifier hs-type">LParamName</span></a></span><span> </span><span id="local-6989586621684386722"><span class="annot"><span class="annottext">LParamInfo (Aliases rep)
</span><a href="#local-6989586621684386722"><span class="hs-identifier hs-var">summary</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LetDecMem -&gt; TypeM rep LetDecMem
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">LParamInfo (Aliases rep)
LetDecMem
</span><a href="#local-6989586621684386722"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-829"></span><span>    </span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#IndexName"><span class="hs-identifier hs-type">IndexName</span></a></span><span> </span><span id="local-6989586621684386720"><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684386720"><span class="hs-identifier hs-var">it</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LetDecMem -&gt; TypeM rep LetDecMem
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(LetDecMem -&gt; TypeM rep LetDecMem)
-&gt; LetDecMem -&gt; TypeM rep LetDecMem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; LetDecMem
forall d u ret. PrimType -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimType -&gt; LetDecMem) -&gt; PrimType -&gt; LetDecMem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-var">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684386720"><span class="hs-identifier hs-var">it</span></a></span><span>
</span><span id="line-830"></span><span>
</span><span id="line-831"></span><span id="local-6989586621684388843"><span id="local-6989586621684388844"><span class="annot"><a href="Futhark.IR.Mem.html#nameInfoToMemInfo"><span class="hs-identifier hs-type">nameInfoToMemInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388844"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388843"><span class="hs-identifier hs-type">inner</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#NameInfo"><span class="hs-identifier hs-type">NameInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388844"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBound"><span class="hs-identifier hs-type">MemBound</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-type">NoUniqueness</span></a></span></span></span><span>
</span><span id="line-832"></span><span id="nameInfoToMemInfo"><span class="annot"><span class="annottext">nameInfoToMemInfo :: forall rep inner. Mem rep inner =&gt; NameInfo rep -&gt; LetDecMem
</span><a href="Futhark.IR.Mem.html#nameInfoToMemInfo"><span class="hs-identifier hs-var hs-var">nameInfoToMemInfo</span></a></span></span><span> </span><span id="local-6989586621684386704"><span class="annot"><span class="annottext">NameInfo rep
</span><a href="#local-6989586621684386704"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-833"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NameInfo rep
</span><a href="#local-6989586621684386704"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-834"></span><span>    </span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#FParamName"><span class="hs-identifier hs-type">FParamName</span></a></span><span> </span><span id="local-6989586621684386703"><span class="annot"><span class="annottext">FParamInfo rep
</span><a href="#local-6989586621684386703"><span class="hs-identifier hs-var">summary</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FParamMem -&gt; LetDecMem
forall d u r. MemInfo d u r -&gt; MemInfo d NoUniqueness r
</span><a href="Futhark.IR.Mem.html#noUniquenessReturns"><span class="hs-identifier hs-var">noUniquenessReturns</span></a></span><span> </span><span class="annot"><span class="annottext">FParamInfo rep
FParamMem
</span><a href="#local-6989586621684386703"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-835"></span><span>    </span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#LParamName"><span class="hs-identifier hs-type">LParamName</span></a></span><span> </span><span id="local-6989586621684386702"><span class="annot"><span class="annottext">LParamInfo rep
</span><a href="#local-6989586621684386702"><span class="hs-identifier hs-var">summary</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LParamInfo rep
LetDecMem
</span><a href="#local-6989586621684386702"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-836"></span><span>    </span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#LetName"><span class="hs-identifier hs-type">LetName</span></a></span><span> </span><span id="local-6989586621684386701"><span class="annot"><span class="annottext">LetDec rep
</span><a href="#local-6989586621684386701"><span class="hs-identifier hs-var">summary</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LetDec rep -&gt; LetDecMem
forall t. HasLetDecMem t =&gt; t -&gt; LetDecMem
</span><a href="Futhark.IR.Mem.html#letDecMem"><span class="hs-identifier hs-var">letDecMem</span></a></span><span> </span><span class="annot"><span class="annottext">LetDec rep
</span><a href="#local-6989586621684386701"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-837"></span><span>    </span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#IndexName"><span class="hs-identifier hs-type">IndexName</span></a></span><span> </span><span id="local-6989586621684386700"><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684386700"><span class="hs-identifier hs-var">it</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; LetDecMem
forall d u ret. PrimType -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimType -&gt; LetDecMem) -&gt; PrimType -&gt; LetDecMem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-var">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684386700"><span class="hs-identifier hs-var">it</span></a></span><span>
</span><span id="line-838"></span><span>
</span><span id="line-839"></span><span id="local-6989586621684388838"><span id="local-6989586621684388839"><span id="local-6989586621684388840"><span class="annot"><a href="Futhark.IR.Mem.html#lookupMemInfo"><span class="hs-identifier hs-type">lookupMemInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-840"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#HasScope"><span class="hs-identifier hs-type">HasScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388840"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388839"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388840"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388838"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-841"></span><span>  </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-842"></span><span>  </span><span class="annot"><a href="#local-6989586621684388839"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-type">NoUniqueness</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier hs-type">MemBind</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-843"></span><span id="lookupMemInfo"><span class="annot"><span class="annottext">lookupMemInfo :: forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Mem rep inner) =&gt;
VName -&gt; m LetDecMem
</span><a href="Futhark.IR.Mem.html#lookupMemInfo"><span class="hs-identifier hs-var hs-var">lookupMemInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NameInfo rep -&gt; LetDecMem) -&gt; m (NameInfo rep) -&gt; m LetDecMem
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">NameInfo rep -&gt; LetDecMem
forall rep inner. Mem rep inner =&gt; NameInfo rep -&gt; LetDecMem
</span><a href="Futhark.IR.Mem.html#nameInfoToMemInfo"><span class="hs-identifier hs-var">nameInfoToMemInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(m (NameInfo rep) -&gt; m LetDecMem)
-&gt; (VName -&gt; m (NameInfo rep)) -&gt; VName -&gt; m LetDecMem
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; m (NameInfo rep)
forall rep (m :: * -&gt; *).
HasScope rep m =&gt;
VName -&gt; m (NameInfo rep)
</span><a href="Futhark.IR.Prop.Scope.html#lookupInfo"><span class="hs-identifier hs-var">lookupInfo</span></a></span><span>
</span><span id="line-844"></span><span>
</span><span id="line-845"></span><span id="local-6989586621684388991"><span id="local-6989586621684388992"><span id="local-6989586621684388993"><span class="annot"><a href="Futhark.IR.Mem.html#subExpMemInfo"><span class="hs-identifier hs-type">subExpMemInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-846"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#HasScope"><span class="hs-identifier hs-type">HasScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388993"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388992"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621684388992"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388993"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388991"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-847"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-848"></span><span>  </span><span class="annot"><a href="#local-6989586621684388992"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-type">NoUniqueness</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier hs-type">MemBind</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-849"></span><span id="subExpMemInfo"><span class="annot"><span class="annottext">subExpMemInfo :: forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Monad m, Mem rep inner) =&gt;
SubExp -&gt; m LetDecMem
</span><a href="Futhark.IR.Mem.html#subExpMemInfo"><span class="hs-identifier hs-var hs-var">subExpMemInfo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684386614"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386614"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; m LetDecMem
forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Mem rep inner) =&gt;
VName -&gt; m LetDecMem
</span><a href="Futhark.IR.Mem.html#lookupMemInfo"><span class="hs-identifier hs-var">lookupMemInfo</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386614"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-850"></span><span class="annot"><a href="Futhark.IR.Mem.html#subExpMemInfo"><span class="hs-identifier hs-var">subExpMemInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span> </span><span id="local-6989586621684386613"><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684386613"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LetDecMem -&gt; m LetDecMem
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(LetDecMem -&gt; m LetDecMem) -&gt; LetDecMem -&gt; m LetDecMem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; LetDecMem
forall d u ret. PrimType -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimType -&gt; LetDecMem) -&gt; PrimType -&gt; LetDecMem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimValue -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#primValueType"><span class="hs-identifier hs-var">primValueType</span></a></span><span> </span><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684386613"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-851"></span><span>
</span><span id="line-852"></span><span id="local-6989586621684388829"><span id="local-6989586621684388830"><span id="local-6989586621684388831"><span class="annot"><a href="Futhark.IR.Mem.html#lookupArraySummary"><span class="hs-identifier hs-type">lookupArraySummary</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-853"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388831"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388830"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#HasScope"><span class="hs-identifier hs-type">HasScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388831"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388829"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621684388829"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-854"></span><span>  </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-855"></span><span>  </span><span class="annot"><a href="#local-6989586621684388829"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.IxFun.html#IxFun"><span class="hs-identifier hs-type">IxFun.IxFun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.PrimExp.html#TPrimExp"><span class="hs-identifier hs-type">TPrimExp</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-856"></span><span id="lookupArraySummary"><span class="annot"><span class="annottext">lookupArraySummary :: forall rep inner (m :: * -&gt; *).
(Mem rep inner, HasScope rep m, Monad m) =&gt;
VName -&gt; m (VName, IxFun)
</span><a href="Futhark.IR.Mem.html#lookupArraySummary"><span class="hs-identifier hs-var hs-var">lookupArraySummary</span></a></span></span><span> </span><span id="local-6989586621684386561"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386561"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-857"></span><span>  </span><span id="local-6989586621684386560"><span class="annot"><span class="annottext">LetDecMem
</span><a href="#local-6989586621684386560"><span class="hs-identifier hs-var">summary</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; m LetDecMem
forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Mem rep inner) =&gt;
VName -&gt; m LetDecMem
</span><a href="Futhark.IR.Mem.html#lookupMemInfo"><span class="hs-identifier hs-var">lookupMemInfo</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386561"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-858"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LetDecMem
</span><a href="#local-6989586621684386560"><span class="hs-identifier hs-var">summary</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-859"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Shape
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ArrayIn"><span class="hs-identifier hs-type">ArrayIn</span></a></span><span> </span><span id="local-6989586621684386559"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386559"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span id="local-6989586621684386558"><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386558"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-860"></span><span>      </span><span class="annot"><span class="annottext">(VName, IxFun) -&gt; m (VName, IxFun)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386559"><span class="hs-identifier hs-var">mem</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386558"><span class="hs-identifier hs-var">ixfun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-861"></span><span>    </span><span class="annot"><span class="annottext">LetDecMem
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-862"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; m (VName, IxFun)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; m (VName, IxFun)) -&gt; String -&gt; m (VName, IxFun)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-863"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386561"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; to be array but bound to:\n&quot;</span></span><span>
</span><span id="line-864"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">LetDecMem -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">LetDecMem
</span><a href="#local-6989586621684386560"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-865"></span><span>
</span><span id="line-866"></span><span id="local-6989586621684388821"><span id="local-6989586621684388822"><span class="annot"><a href="Futhark.IR.Mem.html#checkMemInfo"><span class="hs-identifier hs-type">checkMemInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-867"></span><span>  </span><span class="annot"><a href="Futhark.IR.TypeCheck.html#Checkable"><span class="hs-identifier hs-type">TC.Checkable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388822"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-868"></span><span>  </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-869"></span><span>  </span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388821"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier hs-type">MemBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-870"></span><span>  </span><span class="annot"><a href="Futhark.IR.TypeCheck.html#TypeM"><span class="hs-identifier hs-type">TC.TypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388822"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-871"></span><span id="checkMemInfo"><span class="annot"><span class="annottext">checkMemInfo :: forall rep u.
Checkable rep =&gt;
VName -&gt; MemInfo SubExp u MemBind -&gt; TypeM rep ()
</span><a href="Futhark.IR.Mem.html#checkMemInfo"><span class="hs-identifier hs-var hs-var">checkMemInfo</span></a></span></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TypeM rep ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-872"></span><span class="annot"><a href="Futhark.IR.Mem.html#checkMemInfo"><span class="hs-identifier hs-var">checkMemInfo</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ScalarSpace"><span class="hs-identifier hs-type">ScalarSpace</span></a></span><span> </span><span id="local-6989586621684386516"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684386516"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; TypeM rep ()) -&gt; [SubExp] -&gt; TypeM rep ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; SubExp -&gt; TypeM rep ()
forall rep. Checkable rep =&gt; [Type] -&gt; SubExp -&gt; TypeM rep ()
</span><a href="Futhark.IR.TypeCheck.html#require"><span class="hs-identifier hs-var">TC.require</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PrimType -&gt; Type
forall shape u. PrimType -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Prop.Types.html#int64"><span class="hs-identifier hs-var">int64</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684386516"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-873"></span><span class="annot"><a href="Futhark.IR.Mem.html#checkMemInfo"><span class="hs-identifier hs-var">checkMemInfo</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TypeM rep ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-874"></span><span class="annot"><a href="Futhark.IR.Mem.html#checkMemInfo"><span class="hs-identifier hs-var">checkMemInfo</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684386514"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386514"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684386513"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386513"><span class="hs-identifier hs-var">ispace</span></a></span></span><span> </span><span id="local-6989586621684386512"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684386512"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621684386511"><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684386511"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-875"></span><span>  </span><span class="annot"><span class="annottext">TypeBase Shape u -&gt; TypeM rep ()
forall rep u. Checkable rep =&gt; TypeBase Shape u -&gt; TypeM rep ()
</span><a href="Futhark.IR.TypeCheck.html#checkType"><span class="hs-identifier hs-var">TC.checkType</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase Shape u -&gt; TypeM rep ())
-&gt; TypeBase Shape u -&gt; TypeM rep ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; TypeBase Shape u
forall shape u. VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Acc"><span class="hs-identifier hs-var">Acc</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386514"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386513"><span class="hs-identifier hs-var">ispace</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684386512"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684386511"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-876"></span><span class="annot"><a href="Futhark.IR.Mem.html#checkMemInfo"><span class="hs-identifier hs-var">checkMemInfo</span></a></span><span> </span><span id="local-6989586621684386509"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386509"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684386508"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386508"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span class="annot"><span class="annottext">u
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ArrayIn"><span class="hs-identifier hs-type">ArrayIn</span></a></span><span> </span><span id="local-6989586621684386507"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386507"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621684386506"><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386506"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-877"></span><span>  </span><span id="local-6989586621684386505"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621684386505"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; TypeM rep Type
forall rep (m :: * -&gt; *). HasScope rep m =&gt; VName -&gt; m Type
</span><a href="Futhark.IR.Prop.Scope.html#lookupType"><span class="hs-identifier hs-var">lookupType</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386507"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-878"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621684386505"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-879"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-880"></span><span>      </span><span class="annot"><span class="annottext">() -&gt; TypeM rep ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-881"></span><span>    </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-882"></span><span>      </span><span class="annot"><span class="annottext">ErrorCase rep -&gt; TypeM rep ()
forall rep a. ErrorCase rep -&gt; TypeM rep a
</span><a href="Futhark.IR.TypeCheck.html#bad"><span class="hs-identifier hs-var">TC.bad</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorCase rep -&gt; TypeM rep ()) -&gt; ErrorCase rep -&gt; TypeM rep ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-883"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ErrorCase rep
forall rep. String -&gt; ErrorCase rep
</span><a href="Futhark.IR.TypeCheck.html#TypeError"><span class="hs-identifier hs-var">TC.TypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ErrorCase rep) -&gt; String -&gt; ErrorCase rep
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-884"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Variable &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386507"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-885"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; used as memory block, but is of type &quot;</span></span><span>
</span><span id="line-886"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621684386505"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-887"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-888"></span><span>
</span><span id="line-889"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; TypeM rep () -&gt; TypeM rep ()
forall rep a. String -&gt; TypeM rep a -&gt; TypeM rep a
</span><a href="Futhark.IR.TypeCheck.html#context"><span class="hs-identifier hs-var">TC.context</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;in index function &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">IxFun -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386506"><span class="hs-identifier hs-var">ixfun</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TypeM rep () -&gt; TypeM rep ()) -&gt; TypeM rep () -&gt; TypeM rep ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-890"></span><span>    </span><span class="annot"><span class="annottext">(TPrimExp Int64 VName -&gt; TypeM rep ()) -&gt; IxFun -&gt; TypeM rep ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType -&gt; PrimExp VName -&gt; TypeM rep ()
forall rep.
Checkable rep =&gt;
PrimType -&gt; PrimExp VName -&gt; TypeM rep ()
</span><a href="Futhark.IR.TypeCheck.html#requirePrimExp"><span class="hs-identifier hs-var">TC.requirePrimExp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Prop.Types.html#int64"><span class="hs-identifier hs-var">int64</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimExp VName -&gt; TypeM rep ())
-&gt; (TPrimExp Int64 VName -&gt; PrimExp VName)
-&gt; TPrimExp Int64 VName
-&gt; TypeM rep ()
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TPrimExp Int64 VName -&gt; PrimExp VName
forall t v. TPrimExp t v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#untyped"><span class="hs-identifier hs-var hs-var">untyped</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386506"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-891"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684386501"><span class="annot"><span class="annottext">ixfun_rank :: Int
</span><a href="#local-6989586621684386501"><span class="hs-identifier hs-var hs-var">ixfun_rank</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IxFun -&gt; Int
forall num. IntegralExp num =&gt; IxFun num -&gt; Int
</span><a href="Futhark.IR.Mem.IxFun.html#rank"><span class="hs-identifier hs-var">IxFun.rank</span></a></span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386506"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-892"></span><span>        </span><span id="local-6989586621684386499"><span class="annot"><span class="annottext">ident_rank :: Int
</span><a href="#local-6989586621684386499"><span class="hs-identifier hs-var hs-var">ident_rank</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Shape -&gt; Int
forall a. ArrayShape a =&gt; a -&gt; Int
</span><a href="Futhark.IR.Syntax.Core.html#shapeRank"><span class="hs-identifier hs-var">shapeRank</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386508"><span class="hs-identifier hs-var">shape</span></a></span><span>
</span><span id="line-893"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; TypeM rep () -&gt; TypeM rep ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386501"><span class="hs-identifier hs-var">ixfun_rank</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386499"><span class="hs-identifier hs-var">ident_rank</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TypeM rep () -&gt; TypeM rep ()) -&gt; TypeM rep () -&gt; TypeM rep ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-894"></span><span>      </span><span class="annot"><span class="annottext">ErrorCase rep -&gt; TypeM rep ()
forall rep a. ErrorCase rep -&gt; TypeM rep a
</span><a href="Futhark.IR.TypeCheck.html#bad"><span class="hs-identifier hs-var">TC.bad</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorCase rep -&gt; TypeM rep ()) -&gt; ErrorCase rep -&gt; TypeM rep ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-895"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ErrorCase rep
forall rep. String -&gt; ErrorCase rep
</span><a href="Futhark.IR.TypeCheck.html#TypeError"><span class="hs-identifier hs-var">TC.TypeError</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ErrorCase rep) -&gt; String -&gt; ErrorCase rep
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-896"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Arity of index function (&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386501"><span class="hs-identifier hs-var">ixfun_rank</span></a></span><span>
</span><span id="line-897"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;) does not match rank of array &quot;</span></span><span>
</span><span id="line-898"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386509"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-899"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; (&quot;</span></span><span>
</span><span id="line-900"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386499"><span class="hs-identifier hs-var">ident_rank</span></a></span><span>
</span><span id="line-901"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-902"></span><span>
</span><span id="line-903"></span><span class="annot"><a href="Futhark.IR.Mem.html#bodyReturnsFromPat"><span class="hs-identifier hs-type">bodyReturnsFromPat</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-904"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.html#PatT"><span class="hs-identifier hs-type">PatT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemBound"><span class="hs-identifier hs-type">MemBound</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-type">NoUniqueness</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#BodyReturns"><span class="hs-identifier hs-type">BodyReturns</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-905"></span><span id="bodyReturnsFromPat"><span class="annot"><span class="annottext">bodyReturnsFromPat :: PatT LetDecMem -&gt; [(VName, BodyReturns)]
</span><a href="Futhark.IR.Mem.html#bodyReturnsFromPat"><span class="hs-identifier hs-var hs-var">bodyReturnsFromPat</span></a></span></span><span> </span><span id="local-6989586621684386498"><span class="annot"><span class="annottext">PatT LetDecMem
</span><a href="#local-6989586621684386498"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-906"></span><span>  </span><span class="annot"><span class="annottext">(PatElemT LetDecMem -&gt; (VName, BodyReturns))
-&gt; [PatElemT LetDecMem] -&gt; [(VName, BodyReturns)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PatElemT LetDecMem -&gt; (VName, BodyReturns)
</span><a href="#local-6989586621684386497"><span class="hs-identifier hs-var">asReturns</span></a></span><span> </span><span class="annot"><span class="annottext">([PatElemT LetDecMem] -&gt; [(VName, BodyReturns)])
-&gt; [PatElemT LetDecMem] -&gt; [(VName, BodyReturns)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatT LetDecMem -&gt; [PatElemT LetDecMem]
forall dec. PatT dec -&gt; [PatElemT dec]
</span><a href="Futhark.IR.Syntax.html#patElems"><span class="hs-identifier hs-var hs-var">patElems</span></a></span><span> </span><span class="annot"><span class="annottext">PatT LetDecMem
</span><a href="#local-6989586621684386498"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-907"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-908"></span><span>    </span><span id="local-6989586621684386495"><span class="annot"><span class="annottext">ctx :: [PatElemT LetDecMem]
</span><a href="#local-6989586621684386495"><span class="hs-identifier hs-var hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatT LetDecMem -&gt; [PatElemT LetDecMem]
forall dec. PatT dec -&gt; [PatElemT dec]
</span><a href="Futhark.IR.Syntax.html#patElems"><span class="hs-identifier hs-var hs-var">patElems</span></a></span><span> </span><span class="annot"><span class="annottext">PatT LetDecMem
</span><a href="#local-6989586621684386498"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-909"></span><span>
</span><span id="line-910"></span><span>    </span><span id="local-6989586621684386494"><span class="annot"><span class="annottext">ext :: SubExp -&gt; Ext SubExp
</span><a href="#local-6989586621684386494"><span class="hs-identifier hs-var hs-var">ext</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684386493"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386493"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-911"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684386492"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386492"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PatElemT LetDecMem
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Int, PatElemT LetDecMem) -&gt; Bool)
-&gt; [(Int, PatElemT LetDecMem)] -&gt; Maybe (Int, PatElemT LetDecMem)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; VName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386493"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Bool)
-&gt; ((Int, PatElemT LetDecMem) -&gt; VName)
-&gt; (Int, PatElemT LetDecMem)
-&gt; Bool
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PatElemT LetDecMem -&gt; VName
forall dec. PatElemT dec -&gt; VName
</span><a href="Futhark.IR.Syntax.Core.html#patElemName"><span class="hs-identifier hs-var hs-var">patElemName</span></a></span><span> </span><span class="annot"><span class="annottext">(PatElemT LetDecMem -&gt; VName)
-&gt; ((Int, PatElemT LetDecMem) -&gt; PatElemT LetDecMem)
-&gt; (Int, PatElemT LetDecMem)
-&gt; VName
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int, PatElemT LetDecMem) -&gt; PatElemT LetDecMem
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Int, PatElemT LetDecMem)] -&gt; Maybe (Int, PatElemT LetDecMem))
-&gt; [(Int, PatElemT LetDecMem)] -&gt; Maybe (Int, PatElemT LetDecMem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [PatElemT LetDecMem] -&gt; [(Int, PatElemT LetDecMem)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[PatElemT LetDecMem]
</span><a href="#local-6989586621684386495"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-912"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Ext SubExp
forall a. Int -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386492"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-913"></span><span>    </span><span class="annot"><a href="#local-6989586621684386494"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span id="local-6989586621684386490"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386490"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; Ext SubExp
forall a. a -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-var">Free</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386490"><span class="hs-identifier hs-var">se</span></a></span><span>
</span><span id="line-914"></span><span>
</span><span id="line-915"></span><span>    </span><span id="local-6989586621684386497"><span class="annot"><span class="annottext">asReturns :: PatElemT LetDecMem -&gt; (VName, BodyReturns)
</span><a href="#local-6989586621684386497"><span class="hs-identifier hs-var hs-var">asReturns</span></a></span></span><span> </span><span id="local-6989586621684386489"><span class="annot"><span class="annottext">PatElemT LetDecMem
</span><a href="#local-6989586621684386489"><span class="hs-identifier hs-var">pe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-916"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">PatElemT LetDecMem -&gt; VName
forall dec. PatElemT dec -&gt; VName
</span><a href="Futhark.IR.Syntax.Core.html#patElemName"><span class="hs-identifier hs-var hs-var">patElemName</span></a></span><span> </span><span class="annot"><span class="annottext">PatElemT LetDecMem
</span><a href="#local-6989586621684386489"><span class="hs-identifier hs-var">pe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-917"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PatElemT LetDecMem -&gt; LetDecMem
forall dec. PatElemT dec -&gt; dec
</span><a href="Futhark.IR.Syntax.Core.html#patElemDec"><span class="hs-identifier hs-var hs-var">patElemDec</span></a></span><span> </span><span class="annot"><span class="annottext">PatElemT LetDecMem
</span><a href="#local-6989586621684386489"><span class="hs-identifier hs-var">pe</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-918"></span><span>          </span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span id="local-6989586621684386487"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386487"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; BodyReturns
forall d u ret. PrimType -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386487"><span class="hs-identifier hs-var">pt</span></a></span><span>
</span><span id="line-919"></span><span>          </span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684386486"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386486"><span class="hs-identifier hs-var">space</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Space -&gt; BodyReturns
forall d u ret. Space -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-var">MemMem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386486"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-920"></span><span>          </span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span id="local-6989586621684386485"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386485"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621684386484"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386484"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span id="local-6989586621684386483"><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684386483"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ArrayIn"><span class="hs-identifier hs-type">ArrayIn</span></a></span><span> </span><span id="local-6989586621684386482"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386482"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span id="local-6989586621684386481"><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386481"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-921"></span><span>            </span><span class="annot"><span class="annottext">PrimType
-&gt; ShapeBase (Ext SubExp)
-&gt; NoUniqueness
-&gt; MemReturn
-&gt; BodyReturns
forall d u ret.
PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386485"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ext SubExp] -&gt; ShapeBase (Ext SubExp)
forall d. [d] -&gt; ShapeBase d
</span><a href="Futhark.IR.Syntax.Core.html#Shape"><span class="hs-identifier hs-var">Shape</span></a></span><span> </span><span class="annot"><span class="annottext">([Ext SubExp] -&gt; ShapeBase (Ext SubExp))
-&gt; [Ext SubExp] -&gt; ShapeBase (Ext SubExp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; Ext SubExp) -&gt; [SubExp] -&gt; [Ext SubExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; Ext SubExp
</span><a href="#local-6989586621684386494"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">([SubExp] -&gt; [Ext SubExp]) -&gt; [SubExp] -&gt; [Ext SubExp]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Shape -&gt; [SubExp]
forall d. ShapeBase d -&gt; [d]
</span><a href="Futhark.IR.Syntax.Core.html#shapeDims"><span class="hs-identifier hs-var hs-var">shapeDims</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386484"><span class="hs-identifier hs-var">shape</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684386483"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">(MemReturn -&gt; BodyReturns) -&gt; MemReturn -&gt; BodyReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-922"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">((Int, PatElemT LetDecMem) -&gt; Bool)
-&gt; [(Int, PatElemT LetDecMem)] -&gt; Maybe (Int, PatElemT LetDecMem)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; VName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386482"><span class="hs-identifier hs-var">mem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Bool)
-&gt; ((Int, PatElemT LetDecMem) -&gt; VName)
-&gt; (Int, PatElemT LetDecMem)
-&gt; Bool
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PatElemT LetDecMem -&gt; VName
forall dec. PatElemT dec -&gt; VName
</span><a href="Futhark.IR.Syntax.Core.html#patElemName"><span class="hs-identifier hs-var hs-var">patElemName</span></a></span><span> </span><span class="annot"><span class="annottext">(PatElemT LetDecMem -&gt; VName)
-&gt; ((Int, PatElemT LetDecMem) -&gt; PatElemT LetDecMem)
-&gt; (Int, PatElemT LetDecMem)
-&gt; VName
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int, PatElemT LetDecMem) -&gt; PatElemT LetDecMem
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Int, PatElemT LetDecMem)] -&gt; Maybe (Int, PatElemT LetDecMem))
-&gt; [(Int, PatElemT LetDecMem)] -&gt; Maybe (Int, PatElemT LetDecMem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [PatElemT LetDecMem] -&gt; [(Int, PatElemT LetDecMem)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[PatElemT LetDecMem]
</span><a href="#local-6989586621684386495"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-923"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684386479"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386479"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#PatElem"><span class="hs-identifier hs-type">PatElem</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684386477"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386477"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-924"></span><span>                  </span><span class="annot"><span class="annottext">Space -&gt; Int -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsNewBlock"><span class="hs-identifier hs-var">ReturnsNewBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386477"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386479"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(ExtIxFun -&gt; MemReturn) -&gt; ExtIxFun -&gt; MemReturn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-925"></span><span>                    </span><span class="annot"><span class="annottext">[VName] -&gt; IxFun -&gt; ExtIxFun
</span><a href="Futhark.IR.Mem.html#existentialiseIxFun"><span class="hs-identifier hs-var">existentialiseIxFun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PatElemT LetDecMem -&gt; VName) -&gt; [PatElemT LetDecMem] -&gt; [VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PatElemT LetDecMem -&gt; VName
forall dec. PatElemT dec -&gt; VName
</span><a href="Futhark.IR.Syntax.Core.html#patElemName"><span class="hs-identifier hs-var hs-var">patElemName</span></a></span><span> </span><span class="annot"><span class="annottext">[PatElemT LetDecMem]
</span><a href="#local-6989586621684386495"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386481"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-926"></span><span>                </span><span class="annot"><span class="annottext">Maybe (Int, PatElemT LetDecMem)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VName -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-var">ReturnsInBlock</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386482"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">(ExtIxFun -&gt; MemReturn) -&gt; ExtIxFun -&gt; MemReturn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; IxFun -&gt; ExtIxFun
</span><a href="Futhark.IR.Mem.html#existentialiseIxFun"><span class="hs-identifier hs-var">existentialiseIxFun</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386481"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-927"></span><span>          </span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684386476"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386476"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684386475"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386475"><span class="hs-identifier hs-var">ispace</span></a></span></span><span> </span><span id="local-6989586621684386474"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684386474"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621684386473"><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684386473"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Shape -&gt; [Type] -&gt; NoUniqueness -&gt; BodyReturns
forall d u ret. VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-var">MemAcc</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386476"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386475"><span class="hs-identifier hs-var">ispace</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684386474"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684386473"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-928"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-929"></span><span>
</span><span id="line-930"></span><span class="annot"><a href="Futhark.IR.Mem.html#extReturns"><span class="hs-identifier hs-type">extReturns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ExtType"><span class="hs-identifier hs-type">ExtType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Mem.html#ExpReturns"><span class="hs-identifier hs-type">ExpReturns</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-931"></span><span id="extReturns"><span class="annot"><span class="annottext">extReturns :: [ExtType] -&gt; [ExpReturns]
</span><a href="Futhark.IR.Mem.html#extReturns"><span class="hs-identifier hs-var hs-var">extReturns</span></a></span></span><span> </span><span id="local-6989586621684386472"><span class="annot"><span class="annottext">[ExtType]
</span><a href="#local-6989586621684386472"><span class="hs-identifier hs-var">ets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-932"></span><span>  </span><span class="annot"><span class="annottext">State Int [ExpReturns] -&gt; Int -&gt; [ExpReturns]
forall s a. State s a -&gt; s -&gt; a
</span><span class="hs-identifier hs-var">evalState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ExtType -&gt; StateT Int Identity ExpReturns)
-&gt; [ExtType] -&gt; State Int [ExpReturns]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">ExtType -&gt; StateT Int Identity ExpReturns
forall {m :: * -&gt; *}. MonadState Int m =&gt; ExtType -&gt; m ExpReturns
</span><a href="#local-6989586621684386470"><span class="hs-identifier hs-var">addDec</span></a></span><span> </span><span class="annot"><span class="annottext">[ExtType]
</span><a href="#local-6989586621684386472"><span class="hs-identifier hs-var">ets</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-933"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-934"></span><span>    </span><span id="local-6989586621684386470"><span class="annot"><span class="annottext">addDec :: ExtType -&gt; m ExpReturns
</span><a href="#local-6989586621684386470"><span class="hs-identifier hs-var hs-var">addDec</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span id="local-6989586621684386450"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386450"><span class="hs-identifier hs-var">bt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-935"></span><span>      </span><span class="annot"><span class="annottext">ExpReturns -&gt; m ExpReturns
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; m ExpReturns) -&gt; ExpReturns -&gt; m ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; ExpReturns
forall d u ret. PrimType -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386450"><span class="hs-identifier hs-var">bt</span></a></span><span>
</span><span id="line-936"></span><span>    </span><span class="annot"><a href="#local-6989586621684386470"><span class="hs-identifier hs-var">addDec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span id="local-6989586621684386449"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386449"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-937"></span><span>      </span><span class="annot"><span class="annottext">ExpReturns -&gt; m ExpReturns
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; m ExpReturns) -&gt; ExpReturns -&gt; m ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Space -&gt; ExpReturns
forall d u ret. Space -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-var">MemMem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386449"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-938"></span><span>    </span><span class="annot"><a href="#local-6989586621684386470"><span class="hs-identifier hs-var">addDec</span></a></span><span> </span><span id="local-6989586621684386448"><span class="annot"><span class="annottext">t :: ExtType
</span><a href="#local-6989586621684386448"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span id="local-6989586621684386447"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386447"><span class="hs-identifier hs-var">bt</span></a></span></span><span> </span><span id="local-6989586621684386446"><span class="annot"><span class="annottext">ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684386446"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span id="local-6989586621684386445"><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684386445"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-939"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ExtType -&gt; Bool
</span><a href="Futhark.IR.Prop.Types.html#existential"><span class="hs-identifier hs-var">existential</span></a></span><span> </span><span class="annot"><span class="annottext">ExtType
</span><a href="#local-6989586621684386448"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-940"></span><span>        </span><span id="local-6989586621684386443"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386443"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Int
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span> </span><span class="annot"><span class="annottext">m Int -&gt; m () -&gt; m Int
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-941"></span><span>        </span><span class="annot"><span class="annottext">ExpReturns -&gt; m ExpReturns
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; m ExpReturns) -&gt; ExpReturns -&gt; m ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-942"></span><span>          </span><span class="annot"><span class="annottext">PrimType
-&gt; ShapeBase (Ext SubExp)
-&gt; NoUniqueness
-&gt; Maybe MemReturn
-&gt; ExpReturns
forall d u ret.
PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386447"><span class="hs-identifier hs-var">bt</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684386446"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684386445"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe MemReturn -&gt; ExpReturns) -&gt; Maybe MemReturn -&gt; ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-943"></span><span>            </span><span class="annot"><span class="annottext">MemReturn -&gt; Maybe MemReturn
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(MemReturn -&gt; Maybe MemReturn) -&gt; MemReturn -&gt; Maybe MemReturn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-944"></span><span>              </span><span class="annot"><span class="annottext">Space -&gt; Int -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsNewBlock"><span class="hs-identifier hs-var">ReturnsNewBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="Futhark.IR.Syntax.Core.html#DefaultSpace"><span class="hs-identifier hs-var">DefaultSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386443"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(ExtIxFun -&gt; MemReturn) -&gt; ExtIxFun -&gt; MemReturn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-945"></span><span>                </span><span class="annot"><span class="annottext">Shape (TPrimExp Int64 (Ext VName)) -&gt; ExtIxFun
forall num. IntegralExp num =&gt; Shape num -&gt; IxFun num
</span><a href="Futhark.IR.Mem.IxFun.html#iota"><span class="hs-identifier hs-var">IxFun.iota</span></a></span><span> </span><span class="annot"><span class="annottext">(Shape (TPrimExp Int64 (Ext VName)) -&gt; ExtIxFun)
-&gt; Shape (TPrimExp Int64 (Ext VName)) -&gt; ExtIxFun
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Ext SubExp -&gt; TPrimExp Int64 (Ext VName))
-&gt; [Ext SubExp] -&gt; Shape (TPrimExp Int64 (Ext VName))
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Ext SubExp -&gt; TPrimExp Int64 (Ext VName)
</span><a href="#local-6989586621684386437"><span class="hs-identifier hs-var">convert</span></a></span><span> </span><span class="annot"><span class="annottext">([Ext SubExp] -&gt; Shape (TPrimExp Int64 (Ext VName)))
-&gt; [Ext SubExp] -&gt; Shape (TPrimExp Int64 (Ext VName))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShapeBase (Ext SubExp) -&gt; [Ext SubExp]
forall d. ShapeBase d -&gt; [d]
</span><a href="Futhark.IR.Syntax.Core.html#shapeDims"><span class="hs-identifier hs-var hs-var">shapeDims</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684386446"><span class="hs-identifier hs-var">shape</span></a></span><span>
</span><span id="line-946"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-947"></span><span>        </span><span class="annot"><span class="annottext">ExpReturns -&gt; m ExpReturns
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; m ExpReturns) -&gt; ExpReturns -&gt; m ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType
-&gt; ShapeBase (Ext SubExp)
-&gt; NoUniqueness
-&gt; Maybe MemReturn
-&gt; ExpReturns
forall d u ret.
PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386447"><span class="hs-identifier hs-var">bt</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684386446"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684386445"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe MemReturn
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-948"></span><span>    </span><span class="annot"><a href="#local-6989586621684386470"><span class="hs-identifier hs-var">addDec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Acc"><span class="hs-identifier hs-type">Acc</span></a></span><span> </span><span id="local-6989586621684386436"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386436"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684386435"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386435"><span class="hs-identifier hs-var">ispace</span></a></span></span><span> </span><span id="local-6989586621684386434"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684386434"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621684386433"><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684386433"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-949"></span><span>      </span><span class="annot"><span class="annottext">ExpReturns -&gt; m ExpReturns
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; m ExpReturns) -&gt; ExpReturns -&gt; m ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Shape -&gt; [Type] -&gt; NoUniqueness -&gt; ExpReturns
forall d u ret. VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-var">MemAcc</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386436"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386435"><span class="hs-identifier hs-var">ispace</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684386434"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684386433"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-950"></span><span>    </span><span id="local-6989586621684386437"><span class="annot"><span class="annottext">convert :: Ext SubExp -&gt; TPrimExp Int64 (Ext VName)
</span><a href="#local-6989586621684386437"><span class="hs-identifier hs-var hs-var">convert</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span id="local-6989586621684386431"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386431"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ext VName -&gt; TPrimExp Int64 (Ext VName)
forall a. a -&gt; TPrimExp Int64 a
</span><a href="Futhark.Analysis.PrimExp.Convert.html#le64"><span class="hs-identifier hs-var">le64</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Ext VName
forall a. Int -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386431"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-951"></span><span>    </span><span class="annot"><a href="#local-6989586621684386437"><span class="hs-identifier hs-var">convert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-type">Free</span></a></span><span> </span><span id="local-6989586621684386429"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386429"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Ext VName
forall a. a -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-var">Free</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Ext VName)
-&gt; TPrimExp Int64 VName -&gt; TPrimExp Int64 (Ext VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; TPrimExp Int64 VName
</span><a href="Futhark.Analysis.PrimExp.Convert.html#pe64"><span class="hs-identifier hs-var">pe64</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386429"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-952"></span><span>
</span><span id="line-953"></span><span id="local-6989586621684388787"><span id="local-6989586621684388788"><span id="local-6989586621684388789"><span class="annot"><a href="Futhark.IR.Mem.html#arrayVarReturns"><span class="hs-identifier hs-type">arrayVarReturns</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-954"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#HasScope"><span class="hs-identifier hs-type">HasScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388789"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388788"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621684388788"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388789"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388787"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-955"></span><span>  </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-956"></span><span>  </span><span class="annot"><a href="#local-6989586621684388788"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#IxFun"><span class="hs-identifier hs-type">IxFun</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-957"></span><span id="arrayVarReturns"><span class="annot"><span class="annottext">arrayVarReturns :: forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Monad m, Mem rep inner) =&gt;
VName -&gt; m (PrimType, Shape, VName, IxFun)
</span><a href="Futhark.IR.Mem.html#arrayVarReturns"><span class="hs-identifier hs-var hs-var">arrayVarReturns</span></a></span></span><span> </span><span id="local-6989586621684386377"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386377"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-958"></span><span>  </span><span id="local-6989586621684386376"><span class="annot"><span class="annottext">LetDecMem
</span><a href="#local-6989586621684386376"><span class="hs-identifier hs-var">summary</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; m LetDecMem
forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Mem rep inner) =&gt;
VName -&gt; m LetDecMem
</span><a href="Futhark.IR.Mem.html#lookupMemInfo"><span class="hs-identifier hs-var">lookupMemInfo</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386377"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-959"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LetDecMem
</span><a href="#local-6989586621684386376"><span class="hs-identifier hs-var">summary</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-960"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span id="local-6989586621684386375"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386375"><span class="hs-identifier hs-var">et</span></a></span></span><span> </span><span id="local-6989586621684386374"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386374"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ArrayIn"><span class="hs-identifier hs-type">ArrayIn</span></a></span><span> </span><span id="local-6989586621684386373"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386373"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span id="local-6989586621684386372"><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386372"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-961"></span><span>      </span><span class="annot"><span class="annottext">(PrimType, Shape, VName, IxFun)
-&gt; m (PrimType, Shape, VName, IxFun)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386375"><span class="hs-identifier hs-var">et</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SubExp] -&gt; Shape
forall d. [d] -&gt; ShapeBase d
</span><a href="Futhark.IR.Syntax.Core.html#Shape"><span class="hs-identifier hs-var">Shape</span></a></span><span> </span><span class="annot"><span class="annottext">([SubExp] -&gt; Shape) -&gt; [SubExp] -&gt; Shape
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Shape -&gt; [SubExp]
forall d. ShapeBase d -&gt; [d]
</span><a href="Futhark.IR.Syntax.Core.html#shapeDims"><span class="hs-identifier hs-var hs-var">shapeDims</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386374"><span class="hs-identifier hs-var">shape</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386373"><span class="hs-identifier hs-var">mem</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386372"><span class="hs-identifier hs-var">ixfun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-962"></span><span>    </span><span class="annot"><span class="annottext">LetDecMem
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-963"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; m (PrimType, Shape, VName, IxFun)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; m (PrimType, Shape, VName, IxFun))
-&gt; String -&gt; m (PrimType, Shape, VName, IxFun)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;arrayVarReturns: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386377"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; is not an array.&quot;</span></span><span>
</span><span id="line-964"></span><span>
</span><span id="line-965"></span><span id="local-6989586621684388781"><span id="local-6989586621684388782"><span id="local-6989586621684388783"><span class="annot"><a href="Futhark.IR.Mem.html#varReturns"><span class="hs-identifier hs-type">varReturns</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-966"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#HasScope"><span class="hs-identifier hs-type">HasScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388783"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388782"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621684388782"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388783"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388781"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-967"></span><span>  </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-968"></span><span>  </span><span class="annot"><a href="#local-6989586621684388782"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#ExpReturns"><span class="hs-identifier hs-type">ExpReturns</span></a></span></span></span></span><span>
</span><span id="line-969"></span><span id="varReturns"><span class="annot"><span class="annottext">varReturns :: forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Monad m, Mem rep inner) =&gt;
VName -&gt; m ExpReturns
</span><a href="Futhark.IR.Mem.html#varReturns"><span class="hs-identifier hs-var hs-var">varReturns</span></a></span></span><span> </span><span id="local-6989586621684386324"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386324"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-970"></span><span>  </span><span id="local-6989586621684386323"><span class="annot"><span class="annottext">LetDecMem
</span><a href="#local-6989586621684386323"><span class="hs-identifier hs-var">summary</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; m LetDecMem
forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Mem rep inner) =&gt;
VName -&gt; m LetDecMem
</span><a href="Futhark.IR.Mem.html#lookupMemInfo"><span class="hs-identifier hs-var">lookupMemInfo</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386324"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-971"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LetDecMem
</span><a href="#local-6989586621684386323"><span class="hs-identifier hs-var">summary</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-972"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span id="local-6989586621684386322"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386322"><span class="hs-identifier hs-var">bt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-973"></span><span>      </span><span class="annot"><span class="annottext">ExpReturns -&gt; m ExpReturns
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; m ExpReturns) -&gt; ExpReturns -&gt; m ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; ExpReturns
forall d u ret. PrimType -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386322"><span class="hs-identifier hs-var">bt</span></a></span><span>
</span><span id="line-974"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span id="local-6989586621684386321"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386321"><span class="hs-identifier hs-var">et</span></a></span></span><span> </span><span id="local-6989586621684386320"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386320"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ArrayIn"><span class="hs-identifier hs-type">ArrayIn</span></a></span><span> </span><span id="local-6989586621684386319"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386319"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span id="local-6989586621684386318"><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386318"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-975"></span><span>      </span><span class="annot"><span class="annottext">ExpReturns -&gt; m ExpReturns
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; m ExpReturns) -&gt; ExpReturns -&gt; m ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-976"></span><span>        </span><span class="annot"><span class="annottext">PrimType
-&gt; ShapeBase (Ext SubExp)
-&gt; NoUniqueness
-&gt; Maybe MemReturn
-&gt; ExpReturns
forall d u ret.
PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386321"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SubExp -&gt; Ext SubExp) -&gt; Shape -&gt; ShapeBase (Ext SubExp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; Ext SubExp
forall a. a -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-var">Free</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386320"><span class="hs-identifier hs-var">shape</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-var">NoUniqueness</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe MemReturn -&gt; ExpReturns) -&gt; Maybe MemReturn -&gt; ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-977"></span><span>          </span><span class="annot"><span class="annottext">MemReturn -&gt; Maybe MemReturn
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(MemReturn -&gt; Maybe MemReturn) -&gt; MemReturn -&gt; Maybe MemReturn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-var">ReturnsInBlock</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386319"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">(ExtIxFun -&gt; MemReturn) -&gt; ExtIxFun -&gt; MemReturn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; IxFun -&gt; ExtIxFun
</span><a href="Futhark.IR.Mem.html#existentialiseIxFun"><span class="hs-identifier hs-var">existentialiseIxFun</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386318"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-978"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684386317"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386317"><span class="hs-identifier hs-var">space</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-979"></span><span>      </span><span class="annot"><span class="annottext">ExpReturns -&gt; m ExpReturns
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; m ExpReturns) -&gt; ExpReturns -&gt; m ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Space -&gt; ExpReturns
forall d u ret. Space -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-var">MemMem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684386317"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-980"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684386316"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386316"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684386315"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386315"><span class="hs-identifier hs-var">ispace</span></a></span></span><span> </span><span id="local-6989586621684386314"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684386314"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621684386313"><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684386313"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-981"></span><span>      </span><span class="annot"><span class="annottext">ExpReturns -&gt; m ExpReturns
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; m ExpReturns) -&gt; ExpReturns -&gt; m ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Shape -&gt; [Type] -&gt; NoUniqueness -&gt; ExpReturns
forall d u ret. VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-var">MemAcc</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386316"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684386315"><span class="hs-identifier hs-var">ispace</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684386314"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684386313"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-982"></span><span>
</span><span id="line-983"></span><span id="local-6989586621684388775"><span id="local-6989586621684388776"><span id="local-6989586621684388777"><span class="annot"><a href="Futhark.IR.Mem.html#subExpReturns"><span class="hs-identifier hs-type">subExpReturns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#HasScope"><span class="hs-identifier hs-type">HasScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388777"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388776"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621684388776"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388777"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388775"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621684388776"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#ExpReturns"><span class="hs-identifier hs-type">ExpReturns</span></a></span></span></span></span><span>
</span><span id="line-984"></span><span id="subExpReturns"><span class="annot"><span class="annottext">subExpReturns :: forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Monad m, Mem rep inner) =&gt;
SubExp -&gt; m ExpReturns
</span><a href="Futhark.IR.Mem.html#subExpReturns"><span class="hs-identifier hs-var hs-var">subExpReturns</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684386267"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386267"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-985"></span><span>  </span><span class="annot"><span class="annottext">VName -&gt; m ExpReturns
forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Monad m, Mem rep inner) =&gt;
VName -&gt; m ExpReturns
</span><a href="Futhark.IR.Mem.html#varReturns"><span class="hs-identifier hs-var">varReturns</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386267"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-986"></span><span class="annot"><a href="Futhark.IR.Mem.html#subExpReturns"><span class="hs-identifier hs-var">subExpReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span> </span><span id="local-6989586621684386266"><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684386266"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-987"></span><span>  </span><span class="annot"><span class="annottext">ExpReturns -&gt; m ExpReturns
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; m ExpReturns) -&gt; ExpReturns -&gt; m ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; ExpReturns
forall d u ret. PrimType -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimType -&gt; ExpReturns) -&gt; PrimType -&gt; ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimValue -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#primValueType"><span class="hs-identifier hs-var">primValueType</span></a></span><span> </span><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684386266"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-988"></span><span>
</span><span id="line-989"></span><span class="hs-comment">-- | The return information of an expression.  This can be seen as the</span><span>
</span><span id="line-990"></span><span class="hs-comment">-- &quot;return type with memory annotations&quot; of the expression.</span><span>
</span><span id="line-991"></span><span id="local-6989586621684388864"><span id="local-6989586621684388865"><span id="local-6989586621684388866"><span class="annot"><a href="Futhark.IR.Mem.html#expReturns"><span class="hs-identifier hs-type">expReturns</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-992"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621684388866"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-993"></span><span>    </span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#LocalScope"><span class="hs-identifier hs-type">LocalScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388865"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388866"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-994"></span><span>    </span><span class="annot"><a href="Futhark.IR.Mem.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388865"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388864"><span class="hs-identifier hs-type">inner</span></a></span><span>
</span><span id="line-995"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-996"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388865"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-997"></span><span>  </span><span class="annot"><a href="#local-6989586621684388866"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Mem.html#ExpReturns"><span class="hs-identifier hs-type">ExpReturns</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-998"></span><span id="expReturns"><span class="annot"><span class="annottext">expReturns :: forall (m :: * -&gt; *) rep inner.
(Monad m, LocalScope rep m, Mem rep inner) =&gt;
Exp rep -&gt; m [ExpReturns]
</span><a href="Futhark.IR.Mem.html#expReturns"><span class="hs-identifier hs-var hs-var">expReturns</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-type">BasicOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span id="local-6989586621684386063"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386063"><span class="hs-identifier hs-var">se</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-999"></span><span>  </span><span class="annot"><span class="annottext">ExpReturns -&gt; [ExpReturns]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; [ExpReturns]) -&gt; m ExpReturns -&gt; m [ExpReturns]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; m ExpReturns
forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Monad m, Mem rep inner) =&gt;
SubExp -&gt; m ExpReturns
</span><a href="Futhark.IR.Mem.html#subExpReturns"><span class="hs-identifier hs-var">subExpReturns</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684386063"><span class="hs-identifier hs-var">se</span></a></span><span>
</span><span id="line-1000"></span><span class="annot"><a href="Futhark.IR.Mem.html#expReturns"><span class="hs-identifier hs-var">expReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-type">BasicOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Opaque"><span class="hs-identifier hs-type">Opaque</span></a></span><span> </span><span class="annot"><span class="annottext">OpaqueOp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684386061"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386061"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1001"></span><span>  </span><span class="annot"><span class="annottext">ExpReturns -&gt; [ExpReturns]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; [ExpReturns]) -&gt; m ExpReturns -&gt; m [ExpReturns]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; m ExpReturns
forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Monad m, Mem rep inner) =&gt;
VName -&gt; m ExpReturns
</span><a href="Futhark.IR.Mem.html#varReturns"><span class="hs-identifier hs-var">varReturns</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386061"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1002"></span><span class="annot"><a href="Futhark.IR.Mem.html#expReturns"><span class="hs-identifier hs-var">expReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-type">BasicOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Reshape"><span class="hs-identifier hs-type">Reshape</span></a></span><span> </span><span id="local-6989586621684386059"><span class="annot"><span class="annottext">ShapeChange SubExp
</span><a href="#local-6989586621684386059"><span class="hs-identifier hs-var">newshape</span></a></span></span><span> </span><span id="local-6989586621684386058"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386058"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1003"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684386057"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386057"><span class="hs-identifier hs-var">et</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shape
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684386056"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386056"><span class="hs-identifier hs-var">mem</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684386055"><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386055"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; m (PrimType, Shape, VName, IxFun)
forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Monad m, Mem rep inner) =&gt;
VName -&gt; m (PrimType, Shape, VName, IxFun)
</span><a href="Futhark.IR.Mem.html#arrayVarReturns"><span class="hs-identifier hs-var">arrayVarReturns</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386058"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1004"></span><span>  </span><span class="annot"><span class="annottext">[ExpReturns] -&gt; m [ExpReturns]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-1005"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PrimType
-&gt; ShapeBase (Ext SubExp)
-&gt; NoUniqueness
-&gt; Maybe MemReturn
-&gt; ExpReturns
forall d u ret.
PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386057"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ext SubExp] -&gt; ShapeBase (Ext SubExp)
forall d. [d] -&gt; ShapeBase d
</span><a href="Futhark.IR.Syntax.Core.html#Shape"><span class="hs-identifier hs-var">Shape</span></a></span><span> </span><span class="annot"><span class="annottext">([Ext SubExp] -&gt; ShapeBase (Ext SubExp))
-&gt; [Ext SubExp] -&gt; ShapeBase (Ext SubExp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DimChange SubExp -&gt; Ext SubExp)
-&gt; ShapeChange SubExp -&gt; [Ext SubExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubExp -&gt; Ext SubExp
forall a. a -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-var">Free</span></a></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; Ext SubExp)
-&gt; (DimChange SubExp -&gt; SubExp) -&gt; DimChange SubExp -&gt; Ext SubExp
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DimChange SubExp -&gt; SubExp
forall d. DimChange d -&gt; d
</span><a href="Futhark.IR.Prop.Reshape.html#newDim"><span class="hs-identifier hs-var">newDim</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShapeChange SubExp
</span><a href="#local-6989586621684386059"><span class="hs-identifier hs-var">newshape</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-var">NoUniqueness</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe MemReturn -&gt; ExpReturns) -&gt; Maybe MemReturn -&gt; ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1006"></span><span>        </span><span class="annot"><span class="annottext">MemReturn -&gt; Maybe MemReturn
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(MemReturn -&gt; Maybe MemReturn) -&gt; MemReturn -&gt; Maybe MemReturn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1007"></span><span>          </span><span class="annot"><span class="annottext">VName -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-var">ReturnsInBlock</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386056"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">(ExtIxFun -&gt; MemReturn) -&gt; ExtIxFun -&gt; MemReturn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1008"></span><span>            </span><span class="annot"><span class="annottext">[VName] -&gt; IxFun -&gt; ExtIxFun
</span><a href="Futhark.IR.Mem.html#existentialiseIxFun"><span class="hs-identifier hs-var">existentialiseIxFun</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(IxFun -&gt; ExtIxFun) -&gt; IxFun -&gt; ExtIxFun
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1009"></span><span>              </span><span class="annot"><span class="annottext">IxFun -&gt; ShapeChange (TPrimExp Int64 VName) -&gt; IxFun
forall num.
(Eq num, IntegralExp num) =&gt;
IxFun num -&gt; ShapeChange num -&gt; IxFun num
</span><a href="Futhark.IR.Mem.IxFun.html#reshape"><span class="hs-identifier hs-var">IxFun.reshape</span></a></span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386055"><span class="hs-identifier hs-var">ixfun</span></a></span><span> </span><span class="annot"><span class="annottext">(ShapeChange (TPrimExp Int64 VName) -&gt; IxFun)
-&gt; ShapeChange (TPrimExp Int64 VName) -&gt; IxFun
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DimChange SubExp -&gt; DimChange (TPrimExp Int64 VName))
-&gt; ShapeChange SubExp -&gt; ShapeChange (TPrimExp Int64 VName)
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SubExp -&gt; TPrimExp Int64 VName)
-&gt; DimChange SubExp -&gt; DimChange (TPrimExp Int64 VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; TPrimExp Int64 VName
</span><a href="Futhark.Analysis.PrimExp.Convert.html#pe64"><span class="hs-identifier hs-var">pe64</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShapeChange SubExp
</span><a href="#local-6989586621684386059"><span class="hs-identifier hs-var">newshape</span></a></span><span>
</span><span id="line-1010"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-1011"></span><span class="annot"><a href="Futhark.IR.Mem.html#expReturns"><span class="hs-identifier hs-var">expReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-type">BasicOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Rearrange"><span class="hs-identifier hs-type">Rearrange</span></a></span><span> </span><span id="local-6989586621684386051"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684386051"><span class="hs-identifier hs-var">perm</span></a></span></span><span> </span><span id="local-6989586621684386050"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386050"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1012"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684386049"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386049"><span class="hs-identifier hs-var">et</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span id="local-6989586621684386048"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684386048"><span class="hs-identifier hs-var">dims</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684386047"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386047"><span class="hs-identifier hs-var">mem</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684386046"><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386046"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; m (PrimType, Shape, VName, IxFun)
forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Monad m, Mem rep inner) =&gt;
VName -&gt; m (PrimType, Shape, VName, IxFun)
</span><a href="Futhark.IR.Mem.html#arrayVarReturns"><span class="hs-identifier hs-var">arrayVarReturns</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386050"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1013"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684386045"><span class="annot"><span class="annottext">ixfun' :: IxFun
</span><a href="#local-6989586621684386045"><span class="hs-identifier hs-var hs-var">ixfun'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IxFun -&gt; [Int] -&gt; IxFun
forall num. IntegralExp num =&gt; IxFun num -&gt; [Int] -&gt; IxFun num
</span><a href="Futhark.IR.Mem.IxFun.html#permute"><span class="hs-identifier hs-var">IxFun.permute</span></a></span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386046"><span class="hs-identifier hs-var">ixfun</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684386051"><span class="hs-identifier hs-var">perm</span></a></span><span>
</span><span id="line-1014"></span><span>      </span><span id="local-6989586621684386043"><span class="annot"><span class="annottext">dims' :: [SubExp]
</span><a href="#local-6989586621684386043"><span class="hs-identifier hs-var hs-var">dims'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [SubExp] -&gt; [SubExp]
forall a. [Int] -&gt; [a] -&gt; [a]
</span><a href="Futhark.IR.Prop.Rearrange.html#rearrangeShape"><span class="hs-identifier hs-var">rearrangeShape</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684386051"><span class="hs-identifier hs-var">perm</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684386048"><span class="hs-identifier hs-var">dims</span></a></span><span>
</span><span id="line-1015"></span><span>  </span><span class="annot"><span class="annottext">[ExpReturns] -&gt; m [ExpReturns]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-1016"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PrimType
-&gt; ShapeBase (Ext SubExp)
-&gt; NoUniqueness
-&gt; Maybe MemReturn
-&gt; ExpReturns
forall d u ret.
PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386049"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ext SubExp] -&gt; ShapeBase (Ext SubExp)
forall d. [d] -&gt; ShapeBase d
</span><a href="Futhark.IR.Syntax.Core.html#Shape"><span class="hs-identifier hs-var">Shape</span></a></span><span> </span><span class="annot"><span class="annottext">([Ext SubExp] -&gt; ShapeBase (Ext SubExp))
-&gt; [Ext SubExp] -&gt; ShapeBase (Ext SubExp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; Ext SubExp) -&gt; [SubExp] -&gt; [Ext SubExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; Ext SubExp
forall a. a -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-var">Free</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684386043"><span class="hs-identifier hs-var">dims'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-var">NoUniqueness</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe MemReturn -&gt; ExpReturns) -&gt; Maybe MemReturn -&gt; ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1017"></span><span>        </span><span class="annot"><span class="annottext">MemReturn -&gt; Maybe MemReturn
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(MemReturn -&gt; Maybe MemReturn) -&gt; MemReturn -&gt; Maybe MemReturn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-var">ReturnsInBlock</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386047"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">(ExtIxFun -&gt; MemReturn) -&gt; ExtIxFun -&gt; MemReturn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; IxFun -&gt; ExtIxFun
</span><a href="Futhark.IR.Mem.html#existentialiseIxFun"><span class="hs-identifier hs-var">existentialiseIxFun</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386045"><span class="hs-identifier hs-var">ixfun'</span></a></span><span>
</span><span id="line-1018"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-1019"></span><span class="annot"><a href="Futhark.IR.Mem.html#expReturns"><span class="hs-identifier hs-var">expReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-type">BasicOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Rotate"><span class="hs-identifier hs-type">Rotate</span></a></span><span> </span><span id="local-6989586621684386040"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684386040"><span class="hs-identifier hs-var">offsets</span></a></span></span><span> </span><span id="local-6989586621684386039"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386039"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1020"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684386038"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386038"><span class="hs-identifier hs-var">et</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span id="local-6989586621684386037"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684386037"><span class="hs-identifier hs-var">dims</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684386036"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386036"><span class="hs-identifier hs-var">mem</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684386035"><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386035"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; m (PrimType, Shape, VName, IxFun)
forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Monad m, Mem rep inner) =&gt;
VName -&gt; m (PrimType, Shape, VName, IxFun)
</span><a href="Futhark.IR.Mem.html#arrayVarReturns"><span class="hs-identifier hs-var">arrayVarReturns</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386039"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1021"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684386034"><span class="annot"><span class="annottext">offsets' :: [TPrimExp Int64 VName]
</span><a href="#local-6989586621684386034"><span class="hs-identifier hs-var hs-var">offsets'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; TPrimExp Int64 VName)
-&gt; [SubExp] -&gt; [TPrimExp Int64 VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; TPrimExp Int64 VName
</span><a href="Futhark.Analysis.PrimExp.Convert.html#pe64"><span class="hs-identifier hs-var">pe64</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684386040"><span class="hs-identifier hs-var">offsets</span></a></span><span>
</span><span id="line-1022"></span><span>      </span><span id="local-6989586621684386033"><span class="annot"><span class="annottext">ixfun' :: IxFun
</span><a href="#local-6989586621684386033"><span class="hs-identifier hs-var hs-var">ixfun'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IxFun -&gt; [TPrimExp Int64 VName] -&gt; IxFun
forall num.
(Eq num, IntegralExp num) =&gt;
IxFun num -&gt; Indices num -&gt; IxFun num
</span><a href="Futhark.IR.Mem.IxFun.html#rotate"><span class="hs-identifier hs-var">IxFun.rotate</span></a></span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386035"><span class="hs-identifier hs-var">ixfun</span></a></span><span> </span><span class="annot"><span class="annottext">[TPrimExp Int64 VName]
</span><a href="#local-6989586621684386034"><span class="hs-identifier hs-var">offsets'</span></a></span><span>
</span><span id="line-1023"></span><span>  </span><span class="annot"><span class="annottext">[ExpReturns] -&gt; m [ExpReturns]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-1024"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PrimType
-&gt; ShapeBase (Ext SubExp)
-&gt; NoUniqueness
-&gt; Maybe MemReturn
-&gt; ExpReturns
forall d u ret.
PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386038"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ext SubExp] -&gt; ShapeBase (Ext SubExp)
forall d. [d] -&gt; ShapeBase d
</span><a href="Futhark.IR.Syntax.Core.html#Shape"><span class="hs-identifier hs-var">Shape</span></a></span><span> </span><span class="annot"><span class="annottext">([Ext SubExp] -&gt; ShapeBase (Ext SubExp))
-&gt; [Ext SubExp] -&gt; ShapeBase (Ext SubExp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; Ext SubExp) -&gt; [SubExp] -&gt; [Ext SubExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; Ext SubExp
forall a. a -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-var">Free</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684386037"><span class="hs-identifier hs-var">dims</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-var">NoUniqueness</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe MemReturn -&gt; ExpReturns) -&gt; Maybe MemReturn -&gt; ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1025"></span><span>        </span><span class="annot"><span class="annottext">MemReturn -&gt; Maybe MemReturn
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(MemReturn -&gt; Maybe MemReturn) -&gt; MemReturn -&gt; Maybe MemReturn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-var">ReturnsInBlock</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386036"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">(ExtIxFun -&gt; MemReturn) -&gt; ExtIxFun -&gt; MemReturn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; IxFun -&gt; ExtIxFun
</span><a href="Futhark.IR.Mem.html#existentialiseIxFun"><span class="hs-identifier hs-var">existentialiseIxFun</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386033"><span class="hs-identifier hs-var">ixfun'</span></a></span><span>
</span><span id="line-1026"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-1027"></span><span class="annot"><a href="Futhark.IR.Mem.html#expReturns"><span class="hs-identifier hs-var">expReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-type">BasicOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span id="local-6989586621684386030"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386030"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621684386029"><span class="annot"><span class="annottext">Slice SubExp
</span><a href="#local-6989586621684386029"><span class="hs-identifier hs-var">slice</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1028"></span><span>  </span><span class="annot"><span class="annottext">ExpReturns -&gt; [ExpReturns]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; [ExpReturns])
-&gt; (LetDecMem -&gt; ExpReturns) -&gt; LetDecMem -&gt; [ExpReturns]
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LetDecMem -&gt; ExpReturns
</span><a href="Futhark.IR.Mem.html#varInfoToExpReturns"><span class="hs-identifier hs-var">varInfoToExpReturns</span></a></span><span> </span><span class="annot"><span class="annottext">(LetDecMem -&gt; [ExpReturns]) -&gt; m LetDecMem -&gt; m [ExpReturns]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Slice SubExp -&gt; m LetDecMem
forall (m :: * -&gt; *) rep inner.
(Monad m, HasScope rep m, Mem rep inner) =&gt;
VName -&gt; Slice SubExp -&gt; m LetDecMem
</span><a href="Futhark.IR.Mem.html#sliceInfo"><span class="hs-identifier hs-var">sliceInfo</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386030"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Slice SubExp
</span><a href="#local-6989586621684386029"><span class="hs-identifier hs-var">slice</span></a></span><span>
</span><span id="line-1029"></span><span class="annot"><a href="Futhark.IR.Mem.html#expReturns"><span class="hs-identifier hs-var">expReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-type">BasicOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Update"><span class="hs-identifier hs-type">Update</span></a></span><span> </span><span class="annot"><span class="annottext">Safety
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684386026"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386026"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">Slice SubExp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1030"></span><span>  </span><span class="annot"><span class="annottext">ExpReturns -&gt; [ExpReturns]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; [ExpReturns]) -&gt; m ExpReturns -&gt; m [ExpReturns]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; m ExpReturns
forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Monad m, Mem rep inner) =&gt;
VName -&gt; m ExpReturns
</span><a href="Futhark.IR.Mem.html#varReturns"><span class="hs-identifier hs-var">varReturns</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386026"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1031"></span><span class="annot"><a href="Futhark.IR.Mem.html#expReturns"><span class="hs-identifier hs-var">expReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-type">BasicOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#FlatIndex"><span class="hs-identifier hs-type">FlatIndex</span></a></span><span> </span><span id="local-6989586621684386024"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386024"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621684386023"><span class="annot"><span class="annottext">FlatSlice SubExp
</span><a href="#local-6989586621684386023"><span class="hs-identifier hs-var">slice</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1032"></span><span>  </span><span class="annot"><span class="annottext">ExpReturns -&gt; [ExpReturns]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; [ExpReturns])
-&gt; (LetDecMem -&gt; ExpReturns) -&gt; LetDecMem -&gt; [ExpReturns]
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LetDecMem -&gt; ExpReturns
</span><a href="Futhark.IR.Mem.html#varInfoToExpReturns"><span class="hs-identifier hs-var">varInfoToExpReturns</span></a></span><span> </span><span class="annot"><span class="annottext">(LetDecMem -&gt; [ExpReturns]) -&gt; m LetDecMem -&gt; m [ExpReturns]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; FlatSlice SubExp -&gt; m LetDecMem
forall (m :: * -&gt; *) rep inner.
(Monad m, HasScope rep m, Mem rep inner) =&gt;
VName -&gt; FlatSlice SubExp -&gt; m LetDecMem
</span><a href="Futhark.IR.Mem.html#flatSliceInfo"><span class="hs-identifier hs-var">flatSliceInfo</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386024"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">FlatSlice SubExp
</span><a href="#local-6989586621684386023"><span class="hs-identifier hs-var">slice</span></a></span><span>
</span><span id="line-1033"></span><span class="annot"><a href="Futhark.IR.Mem.html#expReturns"><span class="hs-identifier hs-var">expReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-type">BasicOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#FlatUpdate"><span class="hs-identifier hs-type">FlatUpdate</span></a></span><span> </span><span id="local-6989586621684386020"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386020"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">FlatSlice SubExp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1034"></span><span>  </span><span class="annot"><span class="annottext">ExpReturns -&gt; [ExpReturns]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; [ExpReturns]) -&gt; m ExpReturns -&gt; m [ExpReturns]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; m ExpReturns
forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Monad m, Mem rep inner) =&gt;
VName -&gt; m ExpReturns
</span><a href="Futhark.IR.Mem.html#varReturns"><span class="hs-identifier hs-var">varReturns</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386020"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1035"></span><span class="annot"><a href="Futhark.IR.Mem.html#expReturns"><span class="hs-identifier hs-var">expReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-type">BasicOp</span></a></span><span> </span><span id="local-6989586621684386019"><span class="annot"><span class="annottext">BasicOp
</span><a href="#local-6989586621684386019"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1036"></span><span>  </span><span class="annot"><span class="annottext">[ExtType] -&gt; [ExpReturns]
</span><a href="Futhark.IR.Mem.html#extReturns"><span class="hs-identifier hs-var">extReturns</span></a></span><span> </span><span class="annot"><span class="annottext">([ExtType] -&gt; [ExpReturns])
-&gt; ([Type] -&gt; [ExtType]) -&gt; [Type] -&gt; [ExpReturns]
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [ExtType]
forall u.
[TypeBase Shape u] -&gt; [TypeBase (ShapeBase (Ext SubExp)) u]
</span><a href="Futhark.IR.Prop.Types.html#staticShapes"><span class="hs-identifier hs-var">staticShapes</span></a></span><span> </span><span class="annot"><span class="annottext">([Type] -&gt; [ExpReturns]) -&gt; m [Type] -&gt; m [ExpReturns]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; m [Type]
forall rep (m :: * -&gt; *). HasScope rep m =&gt; BasicOp -&gt; m [Type]
</span><a href="Futhark.IR.Prop.TypeOf.html#basicOpType"><span class="hs-identifier hs-var">basicOpType</span></a></span><span> </span><span class="annot"><span class="annottext">BasicOp
</span><a href="#local-6989586621684386019"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-1037"></span><span class="annot"><a href="Futhark.IR.Mem.html#expReturns"><span class="hs-identifier hs-var">expReturns</span></a></span><span> </span><span id="local-6989586621684386016"><span class="annot"><span class="annottext">e :: ExpT rep
</span><a href="#local-6989586621684386016"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#DoLoop"><span class="hs-identifier hs-type">DoLoop</span></a></span><span> </span><span id="local-6989586621684386014"><span class="annot"><span class="annottext">[(FParam rep, SubExp)]
</span><a href="#local-6989586621684386014"><span class="hs-identifier hs-var">merge</span></a></span></span><span> </span><span class="annot"><span class="annottext">LoopForm rep
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BodyT rep
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1038"></span><span>  </span><span id="local-6989586621684386013"><span class="annot"><span class="annottext">[ExtType]
</span><a href="#local-6989586621684386013"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpT rep -&gt; m [ExtType]
forall rep (m :: * -&gt; *).
(HasScope rep m, TypedOp (Op rep)) =&gt;
Exp rep -&gt; m [ExtType]
</span><a href="Futhark.IR.Prop.TypeOf.html#expExtType"><span class="hs-identifier hs-var">expExtType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpT rep
</span><a href="#local-6989586621684386016"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1039"></span><span>  </span><span class="annot"><span class="annottext">(ExtType -&gt; Param FParamMem -&gt; m ExpReturns)
-&gt; [ExtType] -&gt; [Param FParamMem] -&gt; m [ExpReturns]
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m [c]
</span><span class="hs-identifier hs-var">zipWithM</span></span><span> </span><span class="annot"><span class="annottext">ExtType -&gt; Param FParamMem -&gt; m ExpReturns
</span><a href="#local-6989586621684386010"><span class="hs-identifier hs-var">typeWithDec</span></a></span><span> </span><span class="annot"><span class="annottext">[ExtType]
</span><a href="#local-6989586621684386013"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">([Param FParamMem] -&gt; m [ExpReturns])
-&gt; [Param FParamMem] -&gt; m [ExpReturns]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Param FParamMem, SubExp) -&gt; Param FParamMem)
-&gt; [(Param FParamMem, SubExp)] -&gt; [Param FParamMem]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Param FParamMem, SubExp) -&gt; Param FParamMem
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(FParam rep, SubExp)]
[(Param FParamMem, SubExp)]
</span><a href="#local-6989586621684386014"><span class="hs-identifier hs-var">merge</span></a></span><span>
</span><span id="line-1040"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1041"></span><span>    </span><span id="local-6989586621684386010"><span class="annot"><span class="annottext">typeWithDec :: ExtType -&gt; Param FParamMem -&gt; m ExpReturns
</span><a href="#local-6989586621684386010"><span class="hs-identifier hs-var hs-var">typeWithDec</span></a></span></span><span> </span><span id="local-6989586621684386009"><span class="annot"><span class="annottext">ExtType
</span><a href="#local-6989586621684386009"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621684386008"><span class="annot"><span class="annottext">Param FParamMem
</span><a href="#local-6989586621684386008"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1042"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExtType
</span><a href="#local-6989586621684386009"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Param FParamMem -&gt; FParamMem
forall dec. Param dec -&gt; dec
</span><a href="Futhark.IR.Syntax.Core.html#paramDec"><span class="hs-identifier hs-var hs-var">paramDec</span></a></span><span> </span><span class="annot"><span class="annottext">Param FParamMem
</span><a href="#local-6989586621684386008"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1043"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span id="local-6989586621684386007"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386007"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621684386006"><span class="annot"><span class="annottext">ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684386006"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span id="local-6989586621684386005"><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684386005"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1044"></span><span>          </span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Shape
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ArrayIn"><span class="hs-identifier hs-type">ArrayIn</span></a></span><span> </span><span id="local-6989586621684386004"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386004"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span id="local-6989586621684386003"><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386003"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1045"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-1046"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684386002"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386002"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684386001"><span class="annot"><span class="annottext">Param FParamMem
</span><a href="#local-6989586621684386001"><span class="hs-identifier hs-var">mem_p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Maybe (Int, Param FParamMem)
</span><a href="#local-6989586621684386000"><span class="hs-identifier hs-var">isMergeVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386004"><span class="hs-identifier hs-var">mem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1047"></span><span>              </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span id="local-6989586621684385999"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684385999"><span class="hs-identifier hs-var">space</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Param FParamMem -&gt; Type
forall dec. Typed dec =&gt; Param dec -&gt; Type
</span><a href="Futhark.IR.Prop.Patterns.html#paramType"><span class="hs-identifier hs-var">paramType</span></a></span><span> </span><span class="annot"><span class="annottext">Param FParamMem
</span><a href="#local-6989586621684386001"><span class="hs-identifier hs-var">mem_p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1048"></span><span>              </span><span class="annot"><span class="annottext">ExpReturns -&gt; m ExpReturns
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; m ExpReturns) -&gt; ExpReturns -&gt; m ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType
-&gt; ShapeBase (Ext SubExp)
-&gt; NoUniqueness
-&gt; Maybe MemReturn
-&gt; ExpReturns
forall d u ret.
PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386007"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684386006"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684386005"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe MemReturn -&gt; ExpReturns) -&gt; Maybe MemReturn -&gt; ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MemReturn -&gt; Maybe MemReturn
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(MemReturn -&gt; Maybe MemReturn) -&gt; MemReturn -&gt; Maybe MemReturn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Space -&gt; Int -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsNewBlock"><span class="hs-identifier hs-var">ReturnsNewBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684385999"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684386002"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684385997"><span class="hs-identifier hs-var">ixfun'</span></a></span><span>
</span><span id="line-1049"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1050"></span><span>              </span><span class="annot"><span class="annottext">ExpReturns -&gt; m ExpReturns
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; m ExpReturns) -&gt; ExpReturns -&gt; m ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType
-&gt; ShapeBase (Ext SubExp)
-&gt; NoUniqueness
-&gt; Maybe MemReturn
-&gt; ExpReturns
forall d u ret.
PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684386007"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684386006"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684386005"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe MemReturn -&gt; ExpReturns) -&gt; Maybe MemReturn -&gt; ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MemReturn -&gt; Maybe MemReturn
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(MemReturn -&gt; Maybe MemReturn) -&gt; MemReturn -&gt; Maybe MemReturn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-var">ReturnsInBlock</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684386004"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684385997"><span class="hs-identifier hs-var">ixfun'</span></a></span><span>
</span><span id="line-1051"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-1052"></span><span>              </span><span id="local-6989586621684385997"><span class="annot"><span class="annottext">ixfun' :: ExtIxFun
</span><a href="#local-6989586621684385997"><span class="hs-identifier hs-var hs-var">ixfun'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; IxFun -&gt; ExtIxFun
</span><a href="Futhark.IR.Mem.html#existentialiseIxFun"><span class="hs-identifier hs-var">existentialiseIxFun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Param FParamMem -&gt; VName) -&gt; [Param FParamMem] -&gt; [VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Param FParamMem -&gt; VName
forall dec. Param dec -&gt; VName
</span><a href="Futhark.IR.Syntax.Core.html#paramName"><span class="hs-identifier hs-var hs-var">paramName</span></a></span><span> </span><span class="annot"><span class="annottext">[Param FParamMem]
</span><a href="#local-6989586621684385996"><span class="hs-identifier hs-var">mergevars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684386003"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-1053"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FParamMem
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1054"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; m ExpReturns
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;expReturns: Array return type but not array merge variable.&quot;</span></span><span>
</span><span id="line-1055"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Acc"><span class="hs-identifier hs-type">Acc</span></a></span><span> </span><span id="local-6989586621684385995"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385995"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684385994"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684385994"><span class="hs-identifier hs-var">ispace</span></a></span></span><span> </span><span id="local-6989586621684385993"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684385993"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621684385992"><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684385992"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FParamMem
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1056"></span><span>          </span><span class="annot"><span class="annottext">ExpReturns -&gt; m ExpReturns
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; m ExpReturns) -&gt; ExpReturns -&gt; m ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Shape -&gt; [Type] -&gt; NoUniqueness -&gt; ExpReturns
forall d u ret. VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-var">MemAcc</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385995"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684385994"><span class="hs-identifier hs-var">ispace</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684385993"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="#local-6989586621684385992"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-1057"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span id="local-6989586621684385991"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684385991"><span class="hs-identifier hs-var">pt</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FParamMem
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1058"></span><span>          </span><span class="annot"><span class="annottext">ExpReturns -&gt; m ExpReturns
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; m ExpReturns) -&gt; ExpReturns -&gt; m ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; ExpReturns
forall d u ret. PrimType -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684385991"><span class="hs-identifier hs-var">pt</span></a></span><span>
</span><span id="line-1059"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span id="local-6989586621684385990"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684385990"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FParamMem
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1060"></span><span>          </span><span class="annot"><span class="annottext">ExpReturns -&gt; m ExpReturns
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ExpReturns -&gt; m ExpReturns) -&gt; ExpReturns -&gt; m ExpReturns
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Space -&gt; ExpReturns
forall d u ret. Space -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-var">MemMem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684385990"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-1061"></span><span>    </span><span id="local-6989586621684386000"><span class="annot"><span class="annottext">isMergeVar :: VName -&gt; Maybe (Int, Param FParamMem)
</span><a href="#local-6989586621684386000"><span class="hs-identifier hs-var hs-var">isMergeVar</span></a></span></span><span> </span><span id="local-6989586621684385989"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385989"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Param FParamMem) -&gt; Bool)
-&gt; [(Int, Param FParamMem)] -&gt; Maybe (Int, Param FParamMem)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; VName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385989"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Bool)
-&gt; ((Int, Param FParamMem) -&gt; VName)
-&gt; (Int, Param FParamMem)
-&gt; Bool
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Param FParamMem -&gt; VName
forall dec. Param dec -&gt; VName
</span><a href="Futhark.IR.Syntax.Core.html#paramName"><span class="hs-identifier hs-var hs-var">paramName</span></a></span><span> </span><span class="annot"><span class="annottext">(Param FParamMem -&gt; VName)
-&gt; ((Int, Param FParamMem) -&gt; Param FParamMem)
-&gt; (Int, Param FParamMem)
-&gt; VName
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int, Param FParamMem) -&gt; Param FParamMem
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Int, Param FParamMem)] -&gt; Maybe (Int, Param FParamMem))
-&gt; [(Int, Param FParamMem)] -&gt; Maybe (Int, Param FParamMem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Param FParamMem] -&gt; [(Int, Param FParamMem)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Param FParamMem]
</span><a href="#local-6989586621684385996"><span class="hs-identifier hs-var">mergevars</span></a></span><span>
</span><span id="line-1062"></span><span>    </span><span id="local-6989586621684385996"><span class="annot"><span class="annottext">mergevars :: [Param FParamMem]
</span><a href="#local-6989586621684385996"><span class="hs-identifier hs-var hs-var">mergevars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Param FParamMem, SubExp) -&gt; Param FParamMem)
-&gt; [(Param FParamMem, SubExp)] -&gt; [Param FParamMem]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Param FParamMem, SubExp) -&gt; Param FParamMem
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(FParam rep, SubExp)]
[(Param FParamMem, SubExp)]
</span><a href="#local-6989586621684386014"><span class="hs-identifier hs-var">merge</span></a></span><span>
</span><span id="line-1063"></span><span class="annot"><a href="Futhark.IR.Mem.html#expReturns"><span class="hs-identifier hs-var">expReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[(SubExp, Diet)]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684385987"><span class="annot"><span class="annottext">[RetType rep]
</span><a href="#local-6989586621684385987"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="annot"><span class="annottext">(Safety, SrcLoc, [SrcLoc])
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1064"></span><span>  </span><span class="annot"><span class="annottext">[ExpReturns] -&gt; m [ExpReturns]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([ExpReturns] -&gt; m [ExpReturns]) -&gt; [ExpReturns] -&gt; m [ExpReturns]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(FunReturns -&gt; ExpReturns) -&gt; [FunReturns] -&gt; [ExpReturns]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FunReturns -&gt; ExpReturns
</span><a href="Futhark.IR.Mem.html#funReturnsToExpReturns"><span class="hs-identifier hs-var">funReturnsToExpReturns</span></a></span><span> </span><span class="annot"><span class="annottext">[RetType rep]
[FunReturns]
</span><a href="#local-6989586621684385987"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-1065"></span><span class="annot"><a href="Futhark.IR.Mem.html#expReturns"><span class="hs-identifier hs-var">expReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#If"><span class="hs-identifier hs-type">If</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BodyT rep
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BodyT rep
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#IfDec"><span class="hs-identifier hs-type">IfDec</span></a></span><span> </span><span id="local-6989586621684385984"><span class="annot"><span class="annottext">[BranchType rep]
</span><a href="#local-6989586621684385984"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="annot"><span class="annottext">IfSort
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1066"></span><span>  </span><span class="annot"><span class="annottext">[ExpReturns] -&gt; m [ExpReturns]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([ExpReturns] -&gt; m [ExpReturns]) -&gt; [ExpReturns] -&gt; m [ExpReturns]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(BodyReturns -&gt; ExpReturns) -&gt; [BodyReturns] -&gt; [ExpReturns]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">BodyReturns -&gt; ExpReturns
</span><a href="Futhark.IR.Mem.html#bodyReturnsToExpReturns"><span class="hs-identifier hs-var">bodyReturnsToExpReturns</span></a></span><span> </span><span class="annot"><span class="annottext">[BranchType rep]
[BodyReturns]
</span><a href="#local-6989586621684385984"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-1067"></span><span class="annot"><a href="Futhark.IR.Mem.html#expReturns"><span class="hs-identifier hs-var">expReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span id="local-6989586621684385982"><span class="annot"><span class="annottext">Op rep
</span><a href="#local-6989586621684385982"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1068"></span><span>  </span><span class="annot"><span class="annottext">MemOp inner -&gt; m [ExpReturns]
forall op rep inner (m :: * -&gt; *).
(OpReturns op, Mem rep inner, Monad m, HasScope rep m) =&gt;
op -&gt; m [ExpReturns]
</span><a href="Futhark.IR.Mem.html#opReturns"><span class="hs-identifier hs-var">opReturns</span></a></span><span> </span><span class="annot"><span class="annottext">Op rep
MemOp inner
</span><a href="#local-6989586621684385982"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-1069"></span><span class="annot"><a href="Futhark.IR.Mem.html#expReturns"><span class="hs-identifier hs-var">expReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#WithAcc"><span class="hs-identifier hs-type">WithAcc</span></a></span><span> </span><span id="local-6989586621684385979"><span class="annot"><span class="annottext">[WithAccInput rep]
</span><a href="#local-6989586621684385979"><span class="hs-identifier hs-var">inputs</span></a></span></span><span> </span><span id="local-6989586621684385978"><span class="annot"><span class="annottext">Lambda rep
</span><a href="#local-6989586621684385978"><span class="hs-identifier hs-var">lam</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1070"></span><span>  </span><span class="annot"><span class="annottext">[ExpReturns] -&gt; [ExpReturns] -&gt; [ExpReturns]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span>
</span><span id="line-1071"></span><span>    </span><span class="annot"><span class="annottext">([ExpReturns] -&gt; [ExpReturns] -&gt; [ExpReturns])
-&gt; m [ExpReturns] -&gt; m ([ExpReturns] -&gt; [ExpReturns])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[ExpReturns]] -&gt; [ExpReturns]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[ExpReturns]] -&gt; [ExpReturns])
-&gt; m [[ExpReturns]] -&gt; m [ExpReturns]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(WithAccInput rep -&gt; m [ExpReturns])
-&gt; [WithAccInput rep] -&gt; m [[ExpReturns]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">WithAccInput rep -&gt; m [ExpReturns]
forall {rep} {m :: * -&gt; *} {t :: * -&gt; *} {inner} {a} {c}.
(HasScope rep m, Monad m, Traversable t, HasLetDecMem (LetDec rep),
 ASTRep rep, OpReturns inner, FParamInfo rep ~ FParamMem,
 LParamInfo rep ~ LetDecMem, RetType rep ~ FunReturns,
 BranchType rep ~ BodyReturns, Op rep ~ MemOp inner) =&gt;
(a, t VName, c) -&gt; m (t ExpReturns)
</span><a href="#local-6989586621684385976"><span class="hs-identifier hs-var">inputReturns</span></a></span><span> </span><span class="annot"><span class="annottext">[WithAccInput rep]
</span><a href="#local-6989586621684385979"><span class="hs-identifier hs-var">inputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1072"></span><span>    </span><span class="annot"><span class="annottext">m ([ExpReturns] -&gt; [ExpReturns])
-&gt; m [ExpReturns] -&gt; m [ExpReturns]
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span>
</span><span id="line-1073"></span><span>    </span><span class="hs-comment">-- XXX: this is a bit dubious because it enforces extra copies.  I</span><span>
</span><span id="line-1074"></span><span>    </span><span class="hs-comment">-- think WithAcc should perhaps have a return annotation like If.</span><span>
</span><span id="line-1075"></span><span>    </span><span class="annot"><span class="annottext">[ExpReturns] -&gt; m [ExpReturns]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ExtType] -&gt; [ExpReturns]
</span><a href="Futhark.IR.Mem.html#extReturns"><span class="hs-identifier hs-var">extReturns</span></a></span><span> </span><span class="annot"><span class="annottext">([ExtType] -&gt; [ExpReturns]) -&gt; [ExtType] -&gt; [ExpReturns]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [ExtType]
forall u.
[TypeBase Shape u] -&gt; [TypeBase (ShapeBase (Ext SubExp)) u]
</span><a href="Futhark.IR.Prop.Types.html#staticShapes"><span class="hs-identifier hs-var">staticShapes</span></a></span><span> </span><span class="annot"><span class="annottext">([Type] -&gt; [ExtType]) -&gt; [Type] -&gt; [ExtType]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Type] -&gt; [Type]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684385975"><span class="hs-identifier hs-var">num_accs</span></a></span><span> </span><span class="annot"><span class="annottext">([Type] -&gt; [Type]) -&gt; [Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Lambda rep -&gt; [Type]
forall rep. LambdaT rep -&gt; [Type]
</span><a href="Futhark.IR.Syntax.html#lambdaReturnType"><span class="hs-identifier hs-var hs-var">lambdaReturnType</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda rep
</span><a href="#local-6989586621684385978"><span class="hs-identifier hs-var">lam</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1076"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1077"></span><span>    </span><span id="local-6989586621684385976"><span class="annot"><span class="annottext">inputReturns :: (a, t VName, c) -&gt; m (t ExpReturns)
</span><a href="#local-6989586621684385976"><span class="hs-identifier hs-var hs-var">inputReturns</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684385929"><span class="annot"><span class="annottext">t VName
</span><a href="#local-6989586621684385929"><span class="hs-identifier hs-var">arrs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; m ExpReturns) -&gt; t VName -&gt; m (t ExpReturns)
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; m ExpReturns
forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Monad m, Mem rep inner) =&gt;
VName -&gt; m ExpReturns
</span><a href="Futhark.IR.Mem.html#varReturns"><span class="hs-identifier hs-var">varReturns</span></a></span><span> </span><span class="annot"><span class="annottext">t VName
</span><a href="#local-6989586621684385929"><span class="hs-identifier hs-var">arrs</span></a></span><span>
</span><span id="line-1078"></span><span>    </span><span id="local-6989586621684385975"><span class="annot"><span class="annottext">num_accs :: Int
</span><a href="#local-6989586621684385975"><span class="hs-identifier hs-var hs-var">num_accs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[WithAccInput rep] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[WithAccInput rep]
</span><a href="#local-6989586621684385979"><span class="hs-identifier hs-var">inputs</span></a></span><span>
</span><span id="line-1079"></span><span>
</span><span id="line-1080"></span><span id="local-6989586621684388749"><span id="local-6989586621684388750"><span id="local-6989586621684388751"><span class="annot"><a href="Futhark.IR.Mem.html#sliceInfo"><span class="hs-identifier hs-type">sliceInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1081"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621684388751"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#HasScope"><span class="hs-identifier hs-type">HasScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388750"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388751"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388750"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388749"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1082"></span><span>  </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1083"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1084"></span><span>  </span><span class="annot"><a href="#local-6989586621684388751"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-type">NoUniqueness</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier hs-type">MemBind</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1085"></span><span id="sliceInfo"><span class="annot"><span class="annottext">sliceInfo :: forall (m :: * -&gt; *) rep inner.
(Monad m, HasScope rep m, Mem rep inner) =&gt;
VName -&gt; Slice SubExp -&gt; m LetDecMem
</span><a href="Futhark.IR.Mem.html#sliceInfo"><span class="hs-identifier hs-var hs-var">sliceInfo</span></a></span></span><span> </span><span id="local-6989586621684385876"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385876"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621684385875"><span class="annot"><span class="annottext">Slice SubExp
</span><a href="#local-6989586621684385875"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1086"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684385874"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684385874"><span class="hs-identifier hs-var">et</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shape
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684385873"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385873"><span class="hs-identifier hs-var">mem</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684385872"><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684385872"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; m (PrimType, Shape, VName, IxFun)
forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Monad m, Mem rep inner) =&gt;
VName -&gt; m (PrimType, Shape, VName, IxFun)
</span><a href="Futhark.IR.Mem.html#arrayVarReturns"><span class="hs-identifier hs-var">arrayVarReturns</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385876"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1087"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Slice SubExp -&gt; [SubExp]
forall d. Slice d -&gt; [d]
</span><a href="Futhark.IR.Syntax.Core.html#sliceDims"><span class="hs-identifier hs-var">sliceDims</span></a></span><span> </span><span class="annot"><span class="annottext">Slice SubExp
</span><a href="#local-6989586621684385875"><span class="hs-identifier hs-var">slice</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1088"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LetDecMem -&gt; m LetDecMem
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(LetDecMem -&gt; m LetDecMem) -&gt; LetDecMem -&gt; m LetDecMem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; LetDecMem
forall d u ret. PrimType -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684385874"><span class="hs-identifier hs-var">et</span></a></span><span>
</span><span id="line-1089"></span><span>    </span><span id="local-6989586621684385870"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684385870"><span class="hs-identifier hs-var">dims</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1090"></span><span>      </span><span class="annot"><span class="annottext">LetDecMem -&gt; m LetDecMem
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(LetDecMem -&gt; m LetDecMem) -&gt; LetDecMem -&gt; m LetDecMem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1091"></span><span>        </span><span class="annot"><span class="annottext">PrimType -&gt; Shape -&gt; NoUniqueness -&gt; MemBind -&gt; LetDecMem
forall d u ret.
PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684385874"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SubExp] -&gt; Shape
forall d. [d] -&gt; ShapeBase d
</span><a href="Futhark.IR.Syntax.Core.html#Shape"><span class="hs-identifier hs-var">Shape</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684385870"><span class="hs-identifier hs-var">dims</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-var">NoUniqueness</span></a></span><span> </span><span class="annot"><span class="annottext">(MemBind -&gt; LetDecMem) -&gt; (IxFun -&gt; MemBind) -&gt; IxFun -&gt; LetDecMem
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; IxFun -&gt; MemBind
</span><a href="Futhark.IR.Mem.html#ArrayIn"><span class="hs-identifier hs-var">ArrayIn</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385873"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">(IxFun -&gt; LetDecMem) -&gt; IxFun -&gt; LetDecMem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1092"></span><span>          </span><span class="annot"><span class="annottext">IxFun -&gt; Slice (TPrimExp Int64 VName) -&gt; IxFun
forall num.
(Eq num, IntegralExp num) =&gt;
IxFun num -&gt; Slice num -&gt; IxFun num
</span><a href="Futhark.IR.Mem.IxFun.html#slice"><span class="hs-identifier hs-var">IxFun.slice</span></a></span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684385872"><span class="hs-identifier hs-var">ixfun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SubExp -&gt; TPrimExp Int64 VName)
-&gt; Slice SubExp -&gt; Slice (TPrimExp Int64 VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; TPrimExp Int64 VName
</span><a href="Futhark.Analysis.PrimExp.Convert.html#pe64"><span class="hs-identifier hs-var">pe64</span></a></span><span> </span><span class="annot"><span class="annottext">Slice SubExp
</span><a href="#local-6989586621684385875"><span class="hs-identifier hs-var">slice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1093"></span><span>
</span><span id="line-1094"></span><span id="local-6989586621684388744"><span id="local-6989586621684388745"><span id="local-6989586621684388746"><span class="annot"><a href="Futhark.IR.Mem.html#flatSliceInfo"><span class="hs-identifier hs-type">flatSliceInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1095"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621684388746"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#HasScope"><span class="hs-identifier hs-type">HasScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388745"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388746"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388745"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388744"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1096"></span><span>  </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1097"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#FlatSlice"><span class="hs-identifier hs-type">FlatSlice</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1098"></span><span>  </span><span class="annot"><a href="#local-6989586621684388746"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemInfo"><span class="hs-identifier hs-type">MemInfo</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-type">NoUniqueness</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#MemBind"><span class="hs-identifier hs-type">MemBind</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1099"></span><span id="flatSliceInfo"><span class="annot"><span class="annottext">flatSliceInfo :: forall (m :: * -&gt; *) rep inner.
(Monad m, HasScope rep m, Mem rep inner) =&gt;
VName -&gt; FlatSlice SubExp -&gt; m LetDecMem
</span><a href="Futhark.IR.Mem.html#flatSliceInfo"><span class="hs-identifier hs-var hs-var">flatSliceInfo</span></a></span></span><span> </span><span id="local-6989586621684385817"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385817"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621684385816"><span class="annot"><span class="annottext">slice :: FlatSlice SubExp
</span><a href="#local-6989586621684385816"><span class="hs-identifier hs-var">slice</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#FlatSlice"><span class="hs-identifier hs-type">FlatSlice</span></a></span><span> </span><span id="local-6989586621684385814"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684385814"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span id="local-6989586621684385813"><span class="annot"><span class="annottext">[FlatDimIndex SubExp]
</span><a href="#local-6989586621684385813"><span class="hs-identifier hs-var">idxs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1100"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684385812"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684385812"><span class="hs-identifier hs-var">et</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shape
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684385811"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385811"><span class="hs-identifier hs-var">mem</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684385810"><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684385810"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; m (PrimType, Shape, VName, IxFun)
forall rep (m :: * -&gt; *) inner.
(HasScope rep m, Monad m, Mem rep inner) =&gt;
VName -&gt; m (PrimType, Shape, VName, IxFun)
</span><a href="Futhark.IR.Mem.html#arrayVarReturns"><span class="hs-identifier hs-var">arrayVarReturns</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385817"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1101"></span><span>  </span><span class="annot"><span class="annottext">(FlatDimIndex SubExp -&gt; FlatDimIndex (TPrimExp Int64 VName))
-&gt; [FlatDimIndex SubExp] -&gt; [FlatDimIndex (TPrimExp Int64 VName)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SubExp -&gt; TPrimExp Int64 VName)
-&gt; FlatDimIndex SubExp -&gt; FlatDimIndex (TPrimExp Int64 VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; TPrimExp Int64 VName
</span><a href="Futhark.Analysis.PrimExp.Convert.html#pe64"><span class="hs-identifier hs-var">pe64</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FlatDimIndex SubExp]
</span><a href="#local-6989586621684385813"><span class="hs-identifier hs-var">idxs</span></a></span><span>
</span><span id="line-1102"></span><span>    </span><span class="annot"><span class="annottext">[FlatDimIndex (TPrimExp Int64 VName)]
-&gt; ([FlatDimIndex (TPrimExp Int64 VName)]
    -&gt; FlatSlice (TPrimExp Int64 VName))
-&gt; FlatSlice (TPrimExp Int64 VName)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">TPrimExp Int64 VName
-&gt; [FlatDimIndex (TPrimExp Int64 VName)]
-&gt; FlatSlice (TPrimExp Int64 VName)
forall d. d -&gt; [FlatDimIndex d] -&gt; FlatSlice d
</span><a href="Futhark.IR.Syntax.Core.html#FlatSlice"><span class="hs-identifier hs-var">FlatSlice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubExp -&gt; TPrimExp Int64 VName
</span><a href="Futhark.Analysis.PrimExp.Convert.html#pe64"><span class="hs-identifier hs-var">pe64</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684385814"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1103"></span><span>    </span><span class="annot"><span class="annottext">FlatSlice (TPrimExp Int64 VName)
-&gt; (FlatSlice (TPrimExp Int64 VName) -&gt; IxFun) -&gt; IxFun
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">IxFun -&gt; FlatSlice (TPrimExp Int64 VName) -&gt; IxFun
forall num.
(Eq num, IntegralExp num) =&gt;
IxFun num -&gt; FlatSlice num -&gt; IxFun num
</span><a href="Futhark.IR.Mem.IxFun.html#flatSlice"><span class="hs-identifier hs-var">IxFun.flatSlice</span></a></span><span> </span><span class="annot"><span class="annottext">IxFun
</span><a href="#local-6989586621684385810"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-1104"></span><span>    </span><span class="annot"><span class="annottext">IxFun -&gt; (IxFun -&gt; MemBind) -&gt; MemBind
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; IxFun -&gt; MemBind
</span><a href="Futhark.IR.Mem.html#ArrayIn"><span class="hs-identifier hs-var">ArrayIn</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385811"><span class="hs-identifier hs-var">mem</span></a></span><span>
</span><span id="line-1105"></span><span>    </span><span class="annot"><span class="annottext">MemBind -&gt; (MemBind -&gt; LetDecMem) -&gt; LetDecMem
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; Shape -&gt; NoUniqueness -&gt; MemBind -&gt; LetDecMem
forall d u ret.
PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684385812"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SubExp] -&gt; Shape
forall d. [d] -&gt; ShapeBase d
</span><a href="Futhark.IR.Syntax.Core.html#Shape"><span class="hs-identifier hs-var">Shape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FlatSlice SubExp -&gt; [SubExp]
forall d. FlatSlice d -&gt; [d]
</span><a href="Futhark.IR.Syntax.Core.html#flatSliceDims"><span class="hs-identifier hs-var">flatSliceDims</span></a></span><span> </span><span class="annot"><span class="annottext">FlatSlice SubExp
</span><a href="#local-6989586621684385816"><span class="hs-identifier hs-var">slice</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><a href="Futhark.IR.Syntax.Core.html#NoUniqueness"><span class="hs-identifier hs-var">NoUniqueness</span></a></span><span>
</span><span id="line-1106"></span><span>    </span><span class="annot"><span class="annottext">LetDecMem -&gt; (LetDecMem -&gt; m LetDecMem) -&gt; m LetDecMem
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">LetDecMem -&gt; m LetDecMem
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-1107"></span><span>
</span><span id="line-1108"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.TypeOf.html#TypedOp"><span class="hs-identifier hs-type">TypedOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388725"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="OpReturns"><span class="annot"><a href="Futhark.IR.Mem.html#OpReturns"><span class="hs-identifier hs-var">OpReturns</span></a></span></span><span> </span><span id="local-6989586621684388725"><span class="annot"><a href="#local-6989586621684388725"><span class="hs-identifier hs-type">op</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1109"></span><span>  </span><span id="local-6989586621684388722"><span id="local-6989586621684388723"><span id="local-6989586621684388724"><span id="opReturns"><span class="annot"><a href="Futhark.IR.Mem.html#opReturns"><span class="hs-identifier hs-type">opReturns</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Mem"><span class="hs-identifier hs-type">Mem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388724"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388723"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621684388722"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#HasScope"><span class="hs-identifier hs-type">HasScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388724"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388722"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621684388725"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621684388722"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Mem.html#ExpReturns"><span class="hs-identifier hs-type">ExpReturns</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-1110"></span><span>  </span><span id="local-6989586621684385805"><span class="annot"><a href="Futhark.IR.Mem.html#opReturns"><span class="hs-identifier hs-var hs-var">opReturns</span></a></span><span> </span><span id="local-6989586621684385795"><span class="annot"><span class="annottext">op
</span><a href="#local-6989586621684385795"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ExtType] -&gt; [ExpReturns]
</span><a href="Futhark.IR.Mem.html#extReturns"><span class="hs-identifier hs-var">extReturns</span></a></span><span> </span><span class="annot"><span class="annottext">([ExtType] -&gt; [ExpReturns]) -&gt; m [ExtType] -&gt; m [ExpReturns]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">op -&gt; m [ExtType]
forall op t (m :: * -&gt; *).
(TypedOp op, HasScope t m) =&gt;
op -&gt; m [ExtType]
</span><a href="Futhark.IR.Prop.TypeOf.html#opType"><span class="hs-identifier hs-var">opType</span></a></span><span> </span><span class="annot"><span class="annottext">op
</span><a href="#local-6989586621684385795"><span class="hs-identifier hs-var">op</span></a></span></span><span>
</span><span id="line-1111"></span><span>
</span><span id="line-1112"></span><span id="local-6989586621684388763"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#OpReturns"><span class="hs-identifier hs-type">OpReturns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388763"><span class="hs-identifier hs-type">inner</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#OpReturns"><span class="hs-identifier hs-type">OpReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemOp"><span class="hs-identifier hs-type">MemOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684388763"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1113"></span><span>  </span><span id="local-6989586621684385745"><span class="annot"><span class="annottext">opReturns :: forall rep inner (m :: * -&gt; *).
(Mem rep inner, Monad m, HasScope rep m) =&gt;
MemOp inner -&gt; m [ExpReturns]
</span><a href="#local-6989586621684385745"><span class="hs-identifier hs-var hs-var hs-var hs-var">opReturns</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Alloc"><span class="hs-identifier hs-type">Alloc</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684385744"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684385744"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ExpReturns] -&gt; m [ExpReturns]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Space -&gt; ExpReturns
forall d u ret. Space -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-var">MemMem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684385744"><span class="hs-identifier hs-var">space</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1114"></span><span>  </span><span class="annot"><a href="Futhark.IR.Mem.html#opReturns"><span class="hs-identifier hs-var">opReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621684385743"><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684385743"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">inner -&gt; m [ExpReturns]
forall op rep inner (m :: * -&gt; *).
(OpReturns op, Mem rep inner, Monad m, HasScope rep m) =&gt;
op -&gt; m [ExpReturns]
</span><a href="Futhark.IR.Mem.html#opReturns"><span class="hs-identifier hs-var">opReturns</span></a></span><span> </span><span class="annot"><span class="annottext">inner
</span><a href="#local-6989586621684385743"><span class="hs-identifier hs-var">op</span></a></span></span><span>
</span><span id="line-1115"></span><span>
</span><span id="line-1116"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.IR.Mem.html#OpReturns"><span class="hs-identifier hs-type">OpReturns</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1117"></span><span>  </span><span id="local-6989586621684385732"><span class="annot"><span class="annottext">opReturns :: forall rep inner (m :: * -&gt; *).
(Mem rep inner, Monad m, HasScope rep m) =&gt;
() -&gt; m [ExpReturns]
</span><a href="#local-6989586621684385732"><span class="hs-identifier hs-var hs-var hs-var hs-var">opReturns</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ExpReturns] -&gt; m [ExpReturns]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1118"></span><span>
</span><span id="line-1119"></span><span id="local-6989586621684385731"><span class="annot"><a href="Futhark.IR.Mem.html#applyFunReturns"><span class="hs-identifier hs-type">applyFunReturns</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1120"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Types.html#Typed"><span class="hs-identifier hs-type">Typed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684385731"><span class="hs-identifier hs-type">dec</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1121"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Mem.html#FunReturns"><span class="hs-identifier hs-type">FunReturns</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1122"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Param"><span class="hs-identifier hs-type">Param</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684385731"><span class="hs-identifier hs-type">dec</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1123"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1124"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Mem.html#FunReturns"><span class="hs-identifier hs-type">FunReturns</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-1125"></span><span id="applyFunReturns"><span class="annot"><span class="annottext">applyFunReturns :: forall dec.
Typed dec =&gt;
[FunReturns]
-&gt; [Param dec] -&gt; [(SubExp, Type)] -&gt; Maybe [FunReturns]
</span><a href="Futhark.IR.Mem.html#applyFunReturns"><span class="hs-identifier hs-var hs-var">applyFunReturns</span></a></span></span><span> </span><span id="local-6989586621684385723"><span class="annot"><span class="annottext">[FunReturns]
</span><a href="#local-6989586621684385723"><span class="hs-identifier hs-var">rets</span></a></span></span><span> </span><span id="local-6989586621684385722"><span class="annot"><span class="annottext">[Param dec]
</span><a href="#local-6989586621684385722"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621684385721"><span class="annot"><span class="annottext">[(SubExp, Type)]
</span><a href="#local-6989586621684385721"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-1126"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">[DeclExtType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[DeclExtType]
-&gt; [Param dec] -&gt; [(SubExp, Type)] -&gt; Maybe [DeclExtType]
forall rt dec.
(IsRetType rt, Typed dec) =&gt;
[rt] -&gt; [Param dec] -&gt; [(SubExp, Type)] -&gt; Maybe [rt]
</span><a href="Futhark.IR.RetType.html#applyRetType"><span class="hs-identifier hs-var">applyRetType</span></a></span><span> </span><span class="annot"><span class="annottext">[DeclExtType]
</span><a href="#local-6989586621684385720"><span class="hs-identifier hs-var">rettype</span></a></span><span> </span><span class="annot"><span class="annottext">[Param dec]
</span><a href="#local-6989586621684385722"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">[(SubExp, Type)]
</span><a href="#local-6989586621684385721"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1127"></span><span>    </span><span class="annot"><span class="annottext">[FunReturns] -&gt; Maybe [FunReturns]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">([FunReturns] -&gt; Maybe [FunReturns])
-&gt; [FunReturns] -&gt; Maybe [FunReturns]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(FunReturns -&gt; FunReturns) -&gt; [FunReturns] -&gt; [FunReturns]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FunReturns -&gt; FunReturns
forall {u}.
MemInfo (Ext SubExp) u MemReturn
-&gt; MemInfo (Ext SubExp) u MemReturn
</span><a href="#local-6989586621684385719"><span class="hs-identifier hs-var">correctDims</span></a></span><span> </span><span class="annot"><span class="annottext">[FunReturns]
</span><a href="#local-6989586621684385723"><span class="hs-identifier hs-var">rets</span></a></span><span>
</span><span id="line-1128"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1129"></span><span>    </span><span class="annot"><span class="annottext">Maybe [FunReturns]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1130"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1131"></span><span>    </span><span id="local-6989586621684385720"><span class="annot"><span class="annottext">rettype :: [DeclExtType]
</span><a href="#local-6989586621684385720"><span class="hs-identifier hs-var hs-var">rettype</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FunReturns -&gt; DeclExtType) -&gt; [FunReturns] -&gt; [DeclExtType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FunReturns -&gt; DeclExtType
forall t. DeclExtTyped t =&gt; t -&gt; DeclExtType
</span><a href="Futhark.IR.Prop.Types.html#declExtTypeOf"><span class="hs-identifier hs-var">declExtTypeOf</span></a></span><span> </span><span class="annot"><span class="annottext">[FunReturns]
</span><a href="#local-6989586621684385723"><span class="hs-identifier hs-var">rets</span></a></span><span>
</span><span id="line-1132"></span><span>    </span><span class="annot"><a href="#local-6989586621684385718"><span class="hs-identifier hs-type">parammap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1133"></span><span>    </span><span id="local-6989586621684385718"><span class="annot"><span class="annottext">parammap :: Map VName (SubExp, Type)
</span><a href="#local-6989586621684385718"><span class="hs-identifier hs-var hs-var">parammap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1134"></span><span>      </span><span class="annot"><span class="annottext">[(VName, (SubExp, Type))] -&gt; Map VName (SubExp, Type)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(VName, (SubExp, Type))] -&gt; Map VName (SubExp, Type))
-&gt; [(VName, (SubExp, Type))] -&gt; Map VName (SubExp, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1135"></span><span>        </span><span class="annot"><span class="annottext">[VName] -&gt; [(SubExp, Type)] -&gt; [(VName, (SubExp, Type))]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Param dec -&gt; VName) -&gt; [Param dec] -&gt; [VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Param dec -&gt; VName
forall dec. Param dec -&gt; VName
</span><a href="Futhark.IR.Syntax.Core.html#paramName"><span class="hs-identifier hs-var hs-var">paramName</span></a></span><span> </span><span class="annot"><span class="annottext">[Param dec]
</span><a href="#local-6989586621684385722"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(SubExp, Type)]
</span><a href="#local-6989586621684385721"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1136"></span><span>
</span><span id="line-1137"></span><span>    </span><span id="local-6989586621684385716"><span class="annot"><span class="annottext">substSubExp :: SubExp -&gt; SubExp
</span><a href="#local-6989586621684385716"><span class="hs-identifier hs-var hs-var">substSubExp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684385715"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385715"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1138"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684385714"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684385714"><span class="hs-identifier hs-var">se</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Map VName (SubExp, Type) -&gt; Maybe (SubExp, Type)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385715"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName (SubExp, Type)
</span><a href="#local-6989586621684385718"><span class="hs-identifier hs-var">parammap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684385714"><span class="hs-identifier hs-var">se</span></a></span><span>
</span><span id="line-1139"></span><span>    </span><span class="annot"><a href="#local-6989586621684385716"><span class="hs-identifier hs-var">substSubExp</span></a></span><span> </span><span id="local-6989586621684385712"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684385712"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684385712"><span class="hs-identifier hs-var">se</span></a></span><span>
</span><span id="line-1140"></span><span>
</span><span id="line-1141"></span><span>    </span><span id="local-6989586621684385719"><span class="annot"><span class="annottext">correctDims :: MemInfo (Ext SubExp) u MemReturn
-&gt; MemInfo (Ext SubExp) u MemReturn
</span><a href="#local-6989586621684385719"><span class="hs-identifier hs-var hs-var">correctDims</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-type">MemPrim</span></a></span><span> </span><span id="local-6989586621684385711"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684385711"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1142"></span><span>      </span><span class="annot"><span class="annottext">PrimType -&gt; MemInfo (Ext SubExp) u MemReturn
forall d u ret. PrimType -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemPrim"><span class="hs-identifier hs-var">MemPrim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684385711"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1143"></span><span>    </span><span class="annot"><a href="#local-6989586621684385719"><span class="hs-identifier hs-var">correctDims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-type">MemMem</span></a></span><span> </span><span id="local-6989586621684385710"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684385710"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1144"></span><span>      </span><span class="annot"><span class="annottext">Space -&gt; MemInfo (Ext SubExp) u MemReturn
forall d u ret. Space -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemMem"><span class="hs-identifier hs-var">MemMem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684385710"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-1145"></span><span>    </span><span class="annot"><a href="#local-6989586621684385719"><span class="hs-identifier hs-var">correctDims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-type">MemArray</span></a></span><span> </span><span id="local-6989586621684385709"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684385709"><span class="hs-identifier hs-var">et</span></a></span></span><span> </span><span id="local-6989586621684385708"><span class="annot"><span class="annottext">ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684385708"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span id="local-6989586621684385707"><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684385707"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621684385706"><span class="annot"><span class="annottext">MemReturn
</span><a href="#local-6989586621684385706"><span class="hs-identifier hs-var">memsummary</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1146"></span><span>      </span><span class="annot"><span class="annottext">PrimType
-&gt; ShapeBase (Ext SubExp)
-&gt; u
-&gt; MemReturn
-&gt; MemInfo (Ext SubExp) u MemReturn
forall d u ret.
PrimType -&gt; ShapeBase d -&gt; u -&gt; ret -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemArray"><span class="hs-identifier hs-var">MemArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684385709"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShapeBase (Ext SubExp) -&gt; ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684385705"><span class="hs-identifier hs-var">correctShape</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684385708"><span class="hs-identifier hs-var">shape</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684385707"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">(MemReturn -&gt; MemInfo (Ext SubExp) u MemReturn)
-&gt; MemReturn -&gt; MemInfo (Ext SubExp) u MemReturn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1147"></span><span>        </span><span class="annot"><span class="annottext">MemReturn -&gt; MemReturn
</span><a href="#local-6989586621684385704"><span class="hs-identifier hs-var">correctSummary</span></a></span><span> </span><span class="annot"><span class="annottext">MemReturn
</span><a href="#local-6989586621684385706"><span class="hs-identifier hs-var">memsummary</span></a></span><span>
</span><span id="line-1148"></span><span>    </span><span class="annot"><a href="#local-6989586621684385719"><span class="hs-identifier hs-var">correctDims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-type">MemAcc</span></a></span><span> </span><span id="local-6989586621684385703"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385703"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684385702"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684385702"><span class="hs-identifier hs-var">ispace</span></a></span></span><span> </span><span id="local-6989586621684385701"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684385701"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621684385700"><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684385700"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1149"></span><span>      </span><span class="annot"><span class="annottext">VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; MemInfo (Ext SubExp) u MemReturn
forall d u ret. VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; MemInfo d u ret
</span><a href="Futhark.IR.Mem.html#MemAcc"><span class="hs-identifier hs-var">MemAcc</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385703"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684385702"><span class="hs-identifier hs-var">ispace</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684385701"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684385700"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-1150"></span><span>
</span><span id="line-1151"></span><span>    </span><span id="local-6989586621684385705"><span class="annot"><span class="annottext">correctShape :: ShapeBase (Ext SubExp) -&gt; ShapeBase (Ext SubExp)
</span><a href="#local-6989586621684385705"><span class="hs-identifier hs-var hs-var">correctShape</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ext SubExp] -&gt; ShapeBase (Ext SubExp)
forall d. [d] -&gt; ShapeBase d
</span><a href="Futhark.IR.Syntax.Core.html#Shape"><span class="hs-identifier hs-var">Shape</span></a></span><span> </span><span class="annot"><span class="annottext">([Ext SubExp] -&gt; ShapeBase (Ext SubExp))
-&gt; (ShapeBase (Ext SubExp) -&gt; [Ext SubExp])
-&gt; ShapeBase (Ext SubExp)
-&gt; ShapeBase (Ext SubExp)
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Ext SubExp -&gt; Ext SubExp) -&gt; [Ext SubExp] -&gt; [Ext SubExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Ext SubExp -&gt; Ext SubExp
</span><a href="#local-6989586621684385697"><span class="hs-identifier hs-var">correctDim</span></a></span><span> </span><span class="annot"><span class="annottext">([Ext SubExp] -&gt; [Ext SubExp])
-&gt; (ShapeBase (Ext SubExp) -&gt; [Ext SubExp])
-&gt; ShapeBase (Ext SubExp)
-&gt; [Ext SubExp]
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShapeBase (Ext SubExp) -&gt; [Ext SubExp]
forall d. ShapeBase d -&gt; [d]
</span><a href="Futhark.IR.Syntax.Core.html#shapeDims"><span class="hs-identifier hs-var hs-var">shapeDims</span></a></span><span>
</span><span id="line-1152"></span><span>    </span><span id="local-6989586621684385697"><span class="annot"><span class="annottext">correctDim :: Ext SubExp -&gt; Ext SubExp
</span><a href="#local-6989586621684385697"><span class="hs-identifier hs-var hs-var">correctDim</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span id="local-6989586621684385696"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684385696"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ext SubExp
forall a. Int -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684385696"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1153"></span><span>    </span><span class="annot"><a href="#local-6989586621684385697"><span class="hs-identifier hs-var">correctDim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-type">Free</span></a></span><span> </span><span id="local-6989586621684385695"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684385695"><span class="hs-identifier hs-var">se</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; Ext SubExp
forall a. a -&gt; Ext a
</span><a href="Futhark.IR.Syntax.Core.html#Free"><span class="hs-identifier hs-var">Free</span></a></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; Ext SubExp) -&gt; SubExp -&gt; Ext SubExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; SubExp
</span><a href="#local-6989586621684385716"><span class="hs-identifier hs-var">substSubExp</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684385695"><span class="hs-identifier hs-var">se</span></a></span><span>
</span><span id="line-1154"></span><span>
</span><span id="line-1155"></span><span>    </span><span id="local-6989586621684385704"><span class="annot"><span class="annottext">correctSummary :: MemReturn -&gt; MemReturn
</span><a href="#local-6989586621684385704"><span class="hs-identifier hs-var hs-var">correctSummary</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsNewBlock"><span class="hs-identifier hs-type">ReturnsNewBlock</span></a></span><span> </span><span id="local-6989586621684385693"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684385693"><span class="hs-identifier hs-var">space</span></a></span></span><span> </span><span id="local-6989586621684385692"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684385692"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621684385691"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684385691"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1156"></span><span>      </span><span class="annot"><span class="annottext">Space -&gt; Int -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsNewBlock"><span class="hs-identifier hs-var">ReturnsNewBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684385693"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684385692"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684385691"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-1157"></span><span>    </span><span class="annot"><a href="#local-6989586621684385704"><span class="hs-identifier hs-var">correctSummary</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-type">ReturnsInBlock</span></a></span><span> </span><span id="local-6989586621684385690"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385690"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span id="local-6989586621684385689"><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684385689"><span class="hs-identifier hs-var">ixfun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1158"></span><span>      </span><span class="hs-comment">-- FIXME: we should also do a replacement in ixfun here.</span><span>
</span><span id="line-1159"></span><span>      </span><span class="annot"><span class="annottext">VName -&gt; ExtIxFun -&gt; MemReturn
</span><a href="Futhark.IR.Mem.html#ReturnsInBlock"><span class="hs-identifier hs-var">ReturnsInBlock</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385688"><span class="hs-identifier hs-var">mem'</span></a></span><span> </span><span class="annot"><span class="annottext">ExtIxFun
</span><a href="#local-6989586621684385689"><span class="hs-identifier hs-var">ixfun</span></a></span><span>
</span><span id="line-1160"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1161"></span><span>        </span><span id="local-6989586621684385688"><span class="annot"><span class="annottext">mem' :: VName
</span><a href="#local-6989586621684385688"><span class="hs-identifier hs-var hs-var">mem'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Map VName (SubExp, Type) -&gt; Maybe (SubExp, Type)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385690"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName (SubExp, Type)
</span><a href="#local-6989586621684385718"><span class="hs-identifier hs-var">parammap</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1162"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684385687"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385687"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385687"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1163"></span><span>          </span><span class="annot"><span class="annottext">Maybe (SubExp, Type)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684385690"><span class="hs-identifier hs-var">mem</span></a></span><span>
</span><span id="line-1164"></span></pre></body></html>