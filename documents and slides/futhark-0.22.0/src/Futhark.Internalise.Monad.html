<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE Trustworthy #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Futhark.Internalise.Monad</span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier">InternaliseM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Futhark.Internalise.Monad.html#runInternaliseM"><span class="hs-identifier">runInternaliseM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><span class="hs-identifier">throwError</span></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Futhark.Internalise.Monad.html#VarSubsts"><span class="hs-identifier">VarSubsts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseEnv"><span class="hs-identifier">InternaliseEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Futhark.Internalise.Monad.html#FunInfo"><span class="hs-identifier">FunInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Futhark.Internalise.Monad.html#substitutingVars"><span class="hs-identifier">substitutingVars</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Futhark.Internalise.Monad.html#lookupSubst"><span class="hs-identifier">lookupSubst</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Futhark.Internalise.Monad.html#addFunDef"><span class="hs-identifier">addFunDef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Futhark.Internalise.Monad.html#lookupFunction"><span class="hs-identifier">lookupFunction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Futhark.Internalise.Monad.html#lookupFunction%27"><span class="hs-identifier">lookupFunction'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Futhark.Internalise.Monad.html#lookupConst"><span class="hs-identifier">lookupConst</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Futhark.Internalise.Monad.html#bindFunction"><span class="hs-identifier">bindFunction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Futhark.Internalise.Monad.html#bindConstant"><span class="hs-identifier">bindConstant</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Futhark.Internalise.Monad.html#localConstsScope"><span class="hs-identifier">localConstsScope</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Futhark.Internalise.Monad.html#assert"><span class="hs-identifier">assert</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Convenient reexports</span></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Futhark.Tools.html"><span class="hs-identifier">Futhark.Tools</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">where</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html"><span class="hs-identifier">Futhark.IR.SOACS</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.MonadFreshNames.html"><span class="hs-identifier">Futhark.MonadFreshNames</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Tools.html"><span class="hs-identifier">Futhark.Tools</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">type</span><span> </span><span id="FunInfo"><span class="annot"><a href="Futhark.Internalise.Monad.html#FunInfo"><span class="hs-identifier hs-var">FunInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#DeclType"><span class="hs-identifier hs-type">DeclType</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.SOACS.html#FParam"><span class="hs-identifier hs-type">FParam</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#DeclExtType"><span class="hs-identifier hs-type">DeclExtType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">type</span><span> </span><span id="FunTable"><span class="annot"><a href="Futhark.Internalise.Monad.html#FunTable"><span class="hs-identifier hs-var">FunTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#FunInfo"><span class="hs-identifier hs-type">FunInfo</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-comment">-- | A mapping from external variable names to the corresponding</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- internalised subexpressions.</span><span>
</span><span id="line-50"></span><span class="hs-keyword">type</span><span> </span><span id="VarSubsts"><span class="annot"><a href="Futhark.Internalise.Monad.html#VarSubsts"><span class="hs-identifier hs-var">VarSubsts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">data</span><span> </span><span id="InternaliseEnv"><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseEnv"><span class="hs-identifier hs-var">InternaliseEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="InternaliseEnv"><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseEnv"><span class="hs-identifier hs-var">InternaliseEnv</span></a></span></span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="envSubsts"><span class="annot"><span class="annottext">InternaliseEnv -&gt; VarSubsts
</span><a href="Futhark.Internalise.Monad.html#envSubsts"><span class="hs-identifier hs-var hs-var">envSubsts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#VarSubsts"><span class="hs-identifier hs-type">VarSubsts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span id="envDoBoundsChecks"><span class="annot"><span class="annottext">InternaliseEnv -&gt; Bool
</span><a href="Futhark.Internalise.Monad.html#envDoBoundsChecks"><span class="hs-identifier hs-var hs-var">envDoBoundsChecks</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span id="envSafe"><span class="annot"><span class="annottext">InternaliseEnv -&gt; Bool
</span><a href="Futhark.Internalise.Monad.html#envSafe"><span class="hs-identifier hs-var hs-var">envSafe</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span id="envAttrs"><span class="annot"><span class="annottext">InternaliseEnv -&gt; Attrs
</span><a href="Futhark.Internalise.Monad.html#envAttrs"><span class="hs-identifier hs-var hs-var">envAttrs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Attrs"><span class="hs-identifier hs-type">Attrs</span></a></span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-keyword">data</span><span> </span><span id="InternaliseState"><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseState"><span class="hs-identifier hs-var">InternaliseState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="InternaliseState"><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseState"><span class="hs-identifier hs-var">InternaliseState</span></a></span></span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="stateNameSource"><span class="annot"><span class="annottext">InternaliseState -&gt; VNameSource
</span><a href="Futhark.Internalise.Monad.html#stateNameSource"><span class="hs-identifier hs-var hs-var">stateNameSource</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.FreshNames.html#VNameSource"><span class="hs-identifier hs-type">VNameSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>    </span><span id="stateFunTable"><span class="annot"><span class="annottext">InternaliseState -&gt; FunTable
</span><a href="Futhark.Internalise.Monad.html#stateFunTable"><span class="hs-identifier hs-var hs-var">stateFunTable</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#FunTable"><span class="hs-identifier hs-type">FunTable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>    </span><span id="stateConstSubsts"><span class="annot"><span class="annottext">InternaliseState -&gt; VarSubsts
</span><a href="Futhark.Internalise.Monad.html#stateConstSubsts"><span class="hs-identifier hs-var hs-var">stateConstSubsts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#VarSubsts"><span class="hs-identifier hs-type">VarSubsts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>    </span><span id="stateConstScope"><span class="annot"><span class="annottext">InternaliseState -&gt; Scope SOACS
</span><a href="Futhark.Internalise.Monad.html#stateConstScope"><span class="hs-identifier hs-var hs-var">stateConstScope</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>    </span><span id="stateFuns"><span class="annot"><span class="annottext">InternaliseState -&gt; [FunDef SOACS]
</span><a href="Futhark.Internalise.Monad.html#stateFuns"><span class="hs-identifier hs-var hs-var">stateFuns</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">newtype</span><span> </span><span id="InternaliseM"><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-var">InternaliseM</span></a></span></span><span> </span><span id="local-6989586621684381277"><span class="annot"><a href="#local-6989586621684381277"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="InternaliseM"><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-var">InternaliseM</span></a></span></span><span>
</span><span id="line-69"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Builder.html#BuilderT"><span class="hs-identifier hs-type">BuilderT</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseEnv"><span class="hs-identifier hs-type">InternaliseEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseState"><span class="hs-identifier hs-type">InternaliseState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621684381277"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-keyword">deriving</span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">(</span><span> </span><span id="local-6989586621684381111"><span id="local-6989586621684381117"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; InternaliseM a -&gt; InternaliseM b)
-&gt; (forall a b. a -&gt; InternaliseM b -&gt; InternaliseM a)
-&gt; Functor InternaliseM
forall a b. a -&gt; InternaliseM b -&gt; InternaliseM a
forall a b. (a -&gt; b) -&gt; InternaliseM a -&gt; InternaliseM b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: forall a b. a -&gt; InternaliseM b -&gt; InternaliseM a
$c&lt;$ :: forall a b. a -&gt; InternaliseM b -&gt; InternaliseM a
fmap :: forall a b. (a -&gt; b) -&gt; InternaliseM a -&gt; InternaliseM b
$cfmap :: forall a b. (a -&gt; b) -&gt; InternaliseM a -&gt; InternaliseM b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>      </span><span id="local-6989586621684381075"><span id="local-6989586621684381080"><span id="local-6989586621684381085"><span id="local-6989586621684381090"><span id="local-6989586621684381096"><span class="annot"><span class="annottext">Functor InternaliseM
Functor InternaliseM
-&gt; (forall a. a -&gt; InternaliseM a)
-&gt; (forall a b.
    InternaliseM (a -&gt; b) -&gt; InternaliseM a -&gt; InternaliseM b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c)
    -&gt; InternaliseM a -&gt; InternaliseM b -&gt; InternaliseM c)
-&gt; (forall a b. InternaliseM a -&gt; InternaliseM b -&gt; InternaliseM b)
-&gt; (forall a b. InternaliseM a -&gt; InternaliseM b -&gt; InternaliseM a)
-&gt; Applicative InternaliseM
forall a. a -&gt; InternaliseM a
forall a b. InternaliseM a -&gt; InternaliseM b -&gt; InternaliseM a
forall a b. InternaliseM a -&gt; InternaliseM b -&gt; InternaliseM b
forall a b.
InternaliseM (a -&gt; b) -&gt; InternaliseM a -&gt; InternaliseM b
forall a b c.
(a -&gt; b -&gt; c) -&gt; InternaliseM a -&gt; InternaliseM b -&gt; InternaliseM c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
&lt;* :: forall a b. InternaliseM a -&gt; InternaliseM b -&gt; InternaliseM a
$c&lt;* :: forall a b. InternaliseM a -&gt; InternaliseM b -&gt; InternaliseM a
*&gt; :: forall a b. InternaliseM a -&gt; InternaliseM b -&gt; InternaliseM b
$c*&gt; :: forall a b. InternaliseM a -&gt; InternaliseM b -&gt; InternaliseM b
liftA2 :: forall a b c.
(a -&gt; b -&gt; c) -&gt; InternaliseM a -&gt; InternaliseM b -&gt; InternaliseM c
$cliftA2 :: forall a b c.
(a -&gt; b -&gt; c) -&gt; InternaliseM a -&gt; InternaliseM b -&gt; InternaliseM c
&lt;*&gt; :: forall a b.
InternaliseM (a -&gt; b) -&gt; InternaliseM a -&gt; InternaliseM b
$c&lt;*&gt; :: forall a b.
InternaliseM (a -&gt; b) -&gt; InternaliseM a -&gt; InternaliseM b
pure :: forall a. a -&gt; InternaliseM a
$cpure :: forall a. a -&gt; InternaliseM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>      </span><span id="local-6989586621684381042"><span id="local-6989586621684381047"><span id="local-6989586621684381053"><span class="annot"><span class="annottext">Applicative InternaliseM
Applicative InternaliseM
-&gt; (forall a b.
    InternaliseM a -&gt; (a -&gt; InternaliseM b) -&gt; InternaliseM b)
-&gt; (forall a b. InternaliseM a -&gt; InternaliseM b -&gt; InternaliseM b)
-&gt; (forall a. a -&gt; InternaliseM a)
-&gt; Monad InternaliseM
forall a. a -&gt; InternaliseM a
forall a b. InternaliseM a -&gt; InternaliseM b -&gt; InternaliseM b
forall a b.
InternaliseM a -&gt; (a -&gt; InternaliseM b) -&gt; InternaliseM b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
return :: forall a. a -&gt; InternaliseM a
$creturn :: forall a. a -&gt; InternaliseM a
&gt;&gt; :: forall a b. InternaliseM a -&gt; InternaliseM b -&gt; InternaliseM b
$c&gt;&gt; :: forall a b. InternaliseM a -&gt; InternaliseM b -&gt; InternaliseM b
&gt;&gt;= :: forall a b.
InternaliseM a -&gt; (a -&gt; InternaliseM b) -&gt; InternaliseM b
$c&gt;&gt;= :: forall a b.
InternaliseM a -&gt; (a -&gt; InternaliseM b) -&gt; InternaliseM b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>      </span><span id="local-6989586621684381017"><span id="local-6989586621684381022"><span id="local-6989586621684381028"><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseEnv"><span class="hs-identifier hs-type">InternaliseEnv</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>      </span><span id="local-6989586621684380991"><span id="local-6989586621684380996"><span id="local-6989586621684381002"><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseState"><span class="hs-identifier hs-type">InternaliseState</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>      </span><span id="local-6989586621684380967"><span id="local-6989586621684380973"><span class="annot"><span class="annottext">Monad InternaliseM
Applicative InternaliseM
InternaliseM VNameSource
Applicative InternaliseM
-&gt; Monad InternaliseM
-&gt; InternaliseM VNameSource
-&gt; (VNameSource -&gt; InternaliseM ())
-&gt; MonadFreshNames InternaliseM
VNameSource -&gt; InternaliseM ()
forall (m :: * -&gt; *).
Applicative m
-&gt; Monad m
-&gt; m VNameSource
-&gt; (VNameSource -&gt; m ())
-&gt; MonadFreshNames m
putNameSource :: VNameSource -&gt; InternaliseM ()
$cputNameSource :: VNameSource -&gt; InternaliseM ()
getNameSource :: InternaliseM VNameSource
$cgetNameSource :: InternaliseM VNameSource
</span><a href="Futhark.MonadFreshNames.html#C%3AMonadFreshNames"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadFreshNames</span></a></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>      </span><span id="local-6989586621684380932"><span id="local-6989586621684380938"><span id="local-6989586621684380944"><span id="local-6989586621684380951"><span class="annot"><a href="Futhark.IR.Prop.Scope.html#HasScope"><span class="hs-identifier hs-type">HasScope</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>      </span><span id="local-6989586621684380911"><span class="annot"><a href="Futhark.IR.Prop.Scope.html#LocalScope"><span class="hs-identifier hs-type">LocalScope</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.MonadFreshNames.html#MonadFreshNames"><span class="hs-identifier hs-type">MonadFreshNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseState"><span class="hs-identifier hs-type">InternaliseState</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-82"></span><span>  </span><span id="local-6989586621684380889"><span class="annot"><span class="annottext">getNameSource :: State InternaliseState VNameSource
</span><a href="Futhark.MonadFreshNames.html#getNameSource"><span class="hs-identifier hs-var hs-var hs-var hs-var">getNameSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InternaliseState -&gt; VNameSource)
-&gt; State InternaliseState VNameSource
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">InternaliseState -&gt; VNameSource
</span><a href="Futhark.Internalise.Monad.html#stateNameSource"><span class="hs-identifier hs-var hs-var">stateNameSource</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span id="local-6989586621684380884"><span class="annot"><span class="annottext">putNameSource :: VNameSource -&gt; State InternaliseState ()
</span><a href="Futhark.MonadFreshNames.html#putNameSource"><span class="hs-identifier hs-var hs-var hs-var hs-var">putNameSource</span></a></span></span><span> </span><span id="local-6989586621684380882"><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684380882"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InternaliseState -&gt; InternaliseState) -&gt; State InternaliseState ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((InternaliseState -&gt; InternaliseState)
 -&gt; State InternaliseState ())
-&gt; (InternaliseState -&gt; InternaliseState)
-&gt; State InternaliseState ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684380880"><span class="annot"><span class="annottext">InternaliseState
</span><a href="#local-6989586621684380880"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InternaliseState
</span><a href="#local-6989586621684380880"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">stateNameSource :: VNameSource
</span><a href="Futhark.Internalise.Monad.html#stateNameSource"><span class="hs-identifier hs-var">stateNameSource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684380882"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621684380859"><span id="local-6989586621684380863"><span class="annot"><a href="Futhark.Builder.Class.html#MonadBuilder"><span class="hs-identifier hs-type">MonadBuilder</span></a></span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Rep"><span class="annot"><a href="Futhark.Builder.Class.html#Rep"><span class="hs-identifier hs-var">Rep</span></a></span></span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span>
</span><span id="line-87"></span><span>  </span><span id="local-6989586621684380850"><span class="annot"><span class="annottext">mkExpDecM :: Pat (Rep InternaliseM)
-&gt; Exp (Rep InternaliseM)
-&gt; InternaliseM (ExpDec (Rep InternaliseM))
</span><a href="Futhark.Builder.Class.html#mkExpDecM"><span class="hs-identifier hs-var hs-var hs-var hs-var">mkExpDecM</span></a></span></span><span> </span><span id="local-6989586621684380848"><span class="annot"><span class="annottext">Pat (Rep InternaliseM)
</span><a href="#local-6989586621684380848"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684380847"><span class="annot"><span class="annottext">Exp (Rep InternaliseM)
</span><a href="#local-6989586621684380847"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState)) ()
-&gt; InternaliseM ()
forall a.
BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState)) a
-&gt; InternaliseM a
</span><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-var">InternaliseM</span></a></span><span> </span><span class="annot"><span class="annottext">(BuilderT
   SOACS (ReaderT InternaliseEnv (State InternaliseState)) ()
 -&gt; InternaliseM ())
-&gt; BuilderT
     SOACS (ReaderT InternaliseEnv (State InternaliseState)) ()
-&gt; InternaliseM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat
  (Rep
     (BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState))))
-&gt; Exp
     (Rep
        (BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState))))
-&gt; BuilderT
     SOACS
     (ReaderT InternaliseEnv (State InternaliseState))
     (ExpDec
        (Rep
           (BuilderT
              SOACS (ReaderT InternaliseEnv (State InternaliseState)))))
forall (m :: * -&gt; *).
MonadBuilder m =&gt;
Pat (Rep m) -&gt; Exp (Rep m) -&gt; m (ExpDec (Rep m))
</span><a href="Futhark.Builder.Class.html#mkExpDecM"><span class="hs-identifier hs-var">mkExpDecM</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
  (Rep
     (BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState))))
Pat (Rep InternaliseM)
</span><a href="#local-6989586621684380848"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
  (Rep
     (BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState))))
Exp (Rep InternaliseM)
</span><a href="#local-6989586621684380847"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-88"></span><span>  </span><span id="local-6989586621684380841"><span class="annot"><span class="annottext">mkBodyM :: Stms (Rep InternaliseM)
-&gt; Result -&gt; InternaliseM (Body (Rep InternaliseM))
</span><a href="Futhark.Builder.Class.html#mkBodyM"><span class="hs-identifier hs-var hs-var hs-var hs-var">mkBodyM</span></a></span></span><span> </span><span id="local-6989586621684380839"><span class="annot"><span class="annottext">Stms (Rep InternaliseM)
</span><a href="#local-6989586621684380839"><span class="hs-identifier hs-var">stms</span></a></span></span><span> </span><span id="local-6989586621684380838"><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684380838"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuilderT
  SOACS
  (ReaderT InternaliseEnv (State InternaliseState))
  (Body SOACS)
-&gt; InternaliseM (Body SOACS)
forall a.
BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState)) a
-&gt; InternaliseM a
</span><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-var">InternaliseM</span></a></span><span> </span><span class="annot"><span class="annottext">(BuilderT
   SOACS
   (ReaderT InternaliseEnv (State InternaliseState))
   (Body SOACS)
 -&gt; InternaliseM (Body SOACS))
-&gt; BuilderT
     SOACS
     (ReaderT InternaliseEnv (State InternaliseState))
     (Body SOACS)
-&gt; InternaliseM (Body SOACS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Stms
  (Rep
     (BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState))))
-&gt; Result
-&gt; BuilderT
     SOACS
     (ReaderT InternaliseEnv (State InternaliseState))
     (Body
        (Rep
           (BuilderT
              SOACS (ReaderT InternaliseEnv (State InternaliseState)))))
forall (m :: * -&gt; *).
MonadBuilder m =&gt;
Stms (Rep m) -&gt; Result -&gt; m (Body (Rep m))
</span><a href="Futhark.Builder.Class.html#mkBodyM"><span class="hs-identifier hs-var">mkBodyM</span></a></span><span> </span><span class="annot"><span class="annottext">Stms
  (Rep
     (BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState))))
Stms (Rep InternaliseM)
</span><a href="#local-6989586621684380839"><span class="hs-identifier hs-var">stms</span></a></span><span> </span><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684380838"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-89"></span><span>  </span><span id="local-6989586621684380832"><span class="annot"><span class="annottext">mkLetNamesM :: [VName]
-&gt; Exp (Rep InternaliseM) -&gt; InternaliseM (Stm (Rep InternaliseM))
</span><a href="Futhark.Builder.Class.html#mkLetNamesM"><span class="hs-identifier hs-var hs-var hs-var hs-var">mkLetNamesM</span></a></span></span><span> </span><span id="local-6989586621684380830"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684380830"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684380829"><span class="annot"><span class="annottext">Exp (Rep InternaliseM)
</span><a href="#local-6989586621684380829"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuilderT
  SOACS (ReaderT InternaliseEnv (State InternaliseState)) (Stm SOACS)
-&gt; InternaliseM (Stm SOACS)
forall a.
BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState)) a
-&gt; InternaliseM a
</span><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-var">InternaliseM</span></a></span><span> </span><span class="annot"><span class="annottext">(BuilderT
   SOACS (ReaderT InternaliseEnv (State InternaliseState)) (Stm SOACS)
 -&gt; InternaliseM (Stm SOACS))
-&gt; BuilderT
     SOACS (ReaderT InternaliseEnv (State InternaliseState)) (Stm SOACS)
-&gt; InternaliseM (Stm SOACS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName]
-&gt; Exp
     (Rep
        (BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState))))
-&gt; BuilderT
     SOACS
     (ReaderT InternaliseEnv (State InternaliseState))
     (Stm
        (Rep
           (BuilderT
              SOACS (ReaderT InternaliseEnv (State InternaliseState)))))
forall (m :: * -&gt; *).
MonadBuilder m =&gt;
[VName] -&gt; Exp (Rep m) -&gt; m (Stm (Rep m))
</span><a href="Futhark.Builder.Class.html#mkLetNamesM"><span class="hs-identifier hs-var">mkLetNamesM</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684380830"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
  (Rep
     (BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState))))
Exp (Rep InternaliseM)
</span><a href="#local-6989586621684380829"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span>  </span><span id="local-6989586621684380823"><span class="annot"><span class="annottext">addStms :: Stms (Rep InternaliseM) -&gt; InternaliseM ()
</span><a href="Futhark.Builder.Class.html#addStms"><span class="hs-identifier hs-var hs-var hs-var hs-var">addStms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState)) ()
-&gt; InternaliseM ()
forall a.
BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState)) a
-&gt; InternaliseM a
</span><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-var">InternaliseM</span></a></span><span> </span><span class="annot"><span class="annottext">(BuilderT
   SOACS (ReaderT InternaliseEnv (State InternaliseState)) ()
 -&gt; InternaliseM ())
-&gt; (Stms SOACS
    -&gt; BuilderT
         SOACS (ReaderT InternaliseEnv (State InternaliseState)) ())
-&gt; Stms SOACS
-&gt; InternaliseM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Stms SOACS
-&gt; BuilderT
     SOACS (ReaderT InternaliseEnv (State InternaliseState)) ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stms (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStms"><span class="hs-identifier hs-var">addStms</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span id="local-6989586621684380815"><span class="annot"><span class="annottext">collectStms :: forall a.
InternaliseM a -&gt; InternaliseM (a, Stms (Rep InternaliseM))
</span><a href="Futhark.Builder.Class.html#collectStms"><span class="hs-identifier hs-var hs-var hs-var hs-var">collectStms</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span><span> </span><span id="local-6989586621684380813"><span class="annot"><span class="annottext">BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState)) a
</span><a href="#local-6989586621684380813"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuilderT
  SOACS
  (ReaderT InternaliseEnv (State InternaliseState))
  (a, Stms SOACS)
-&gt; InternaliseM (a, Stms SOACS)
forall a.
BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState)) a
-&gt; InternaliseM a
</span><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-var">InternaliseM</span></a></span><span> </span><span class="annot"><span class="annottext">(BuilderT
   SOACS
   (ReaderT InternaliseEnv (State InternaliseState))
   (a, Stms SOACS)
 -&gt; InternaliseM (a, Stms SOACS))
-&gt; BuilderT
     SOACS
     (ReaderT InternaliseEnv (State InternaliseState))
     (a, Stms SOACS)
-&gt; InternaliseM (a, Stms SOACS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState)) a
-&gt; BuilderT
     SOACS
     (ReaderT InternaliseEnv (State InternaliseState))
     (a,
      Stms
        (Rep
           (BuilderT
              SOACS (ReaderT InternaliseEnv (State InternaliseState)))))
forall (m :: * -&gt; *) a.
MonadBuilder m =&gt;
m a -&gt; m (a, Stms (Rep m))
</span><a href="Futhark.Builder.Class.html#collectStms"><span class="hs-identifier hs-var">collectStms</span></a></span><span> </span><span class="annot"><span class="annottext">BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState)) a
</span><a href="#local-6989586621684380813"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span id="local-6989586621684381272"><span class="annot"><a href="Futhark.Internalise.Monad.html#runInternaliseM"><span class="hs-identifier hs-type">runInternaliseM</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><a href="Futhark.MonadFreshNames.html#MonadFreshNames"><span class="hs-identifier hs-type">MonadFreshNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684381272"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><a href="#local-6989586621684381272"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Stms"><span class="hs-identifier hs-type">Stms</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-99"></span><span id="runInternaliseM"><span class="annot"><span class="annottext">runInternaliseM :: forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Bool -&gt; InternaliseM () -&gt; m (Stms SOACS, [FunDef SOACS])
</span><a href="Futhark.Internalise.Monad.html#runInternaliseM"><span class="hs-identifier hs-var hs-var">runInternaliseM</span></a></span></span><span> </span><span id="local-6989586621684380803"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684380803"><span class="hs-keyword hs-var">safe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span><span> </span><span id="local-6989586621684380802"><span class="annot"><span class="annottext">BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState)) ()
</span><a href="#local-6989586621684380802"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><span class="annottext">(VNameSource -&gt; ((Stms SOACS, [FunDef SOACS]), VNameSource))
-&gt; m (Stms SOACS, [FunDef SOACS])
forall (m :: * -&gt; *) a.
MonadFreshNames m =&gt;
(VNameSource -&gt; (a, VNameSource)) -&gt; m a
</span><a href="Futhark.MonadFreshNames.html#modifyNameSource"><span class="hs-identifier hs-var">modifyNameSource</span></a></span><span> </span><span class="annot"><span class="annottext">((VNameSource -&gt; ((Stms SOACS, [FunDef SOACS]), VNameSource))
 -&gt; m (Stms SOACS, [FunDef SOACS]))
-&gt; (VNameSource -&gt; ((Stms SOACS, [FunDef SOACS]), VNameSource))
-&gt; m (Stms SOACS, [FunDef SOACS])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684380800"><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684380800"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684380799"><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684380799"><span class="hs-identifier hs-var">consts</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621684380798"><span class="annot"><span class="annottext">InternaliseState
</span><a href="#local-6989586621684380798"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-102"></span><span>          </span><span class="annot"><span class="annottext">State InternaliseState ((), Stms SOACS)
-&gt; InternaliseState -&gt; (((), Stms SOACS), InternaliseState)
forall s a. State s a -&gt; s -&gt; (a, s)
</span><span class="hs-identifier hs-var">runState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReaderT InternaliseEnv (State InternaliseState) ((), Stms SOACS)
-&gt; InternaliseEnv -&gt; State InternaliseState ((), Stms SOACS)
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var hs-var">runReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState)) ()
-&gt; Scope SOACS
-&gt; ReaderT InternaliseEnv (State InternaliseState) ((), Stms SOACS)
forall (m :: * -&gt; *) rep a.
MonadFreshNames m =&gt;
BuilderT rep m a -&gt; Scope rep -&gt; m (a, Stms rep)
</span><a href="Futhark.Builder.html#runBuilderT"><span class="hs-identifier hs-var">runBuilderT</span></a></span><span> </span><span class="annot"><span class="annottext">BuilderT SOACS (ReaderT InternaliseEnv (State InternaliseState)) ()
</span><a href="#local-6989586621684380802"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Scope SOACS
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InternaliseEnv
</span><a href="#local-6989586621684380794"><span class="hs-identifier hs-var">newEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VNameSource -&gt; InternaliseState
</span><a href="#local-6989586621684380793"><span class="hs-identifier hs-var">newState</span></a></span><span> </span><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684380800"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684380799"><span class="hs-identifier hs-var">consts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FunDef SOACS] -&gt; [FunDef SOACS]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([FunDef SOACS] -&gt; [FunDef SOACS])
-&gt; [FunDef SOACS] -&gt; [FunDef SOACS]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InternaliseState -&gt; [FunDef SOACS]
</span><a href="Futhark.Internalise.Monad.html#stateFuns"><span class="hs-identifier hs-var hs-var">stateFuns</span></a></span><span> </span><span class="annot"><span class="annottext">InternaliseState
</span><a href="#local-6989586621684380798"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InternaliseState -&gt; VNameSource
</span><a href="Futhark.Internalise.Monad.html#stateNameSource"><span class="hs-identifier hs-var hs-var">stateNameSource</span></a></span><span> </span><span class="annot"><span class="annottext">InternaliseState
</span><a href="#local-6989586621684380798"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-105"></span><span>    </span><span id="local-6989586621684380794"><span class="annot"><span class="annottext">newEnv :: InternaliseEnv
</span><a href="#local-6989586621684380794"><span class="hs-identifier hs-var hs-var">newEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-106"></span><span>      </span><span class="annot"><span class="annottext">InternaliseEnv :: VarSubsts -&gt; Bool -&gt; Bool -&gt; Attrs -&gt; InternaliseEnv
</span><a href="Futhark.Internalise.Monad.html#InternaliseEnv"><span class="hs-identifier hs-type">InternaliseEnv</span></a></span><span>
</span><span id="line-107"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">envSubsts :: VarSubsts
</span><a href="Futhark.Internalise.Monad.html#envSubsts"><span class="hs-identifier hs-var">envSubsts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSubsts
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>          </span><span class="annot"><span class="annottext">envDoBoundsChecks :: Bool
</span><a href="Futhark.Internalise.Monad.html#envDoBoundsChecks"><span class="hs-identifier hs-var">envDoBoundsChecks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>          </span><span class="annot"><span class="annottext">envSafe :: Bool
</span><a href="Futhark.Internalise.Monad.html#envSafe"><span class="hs-identifier hs-var">envSafe</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684380803"><span class="hs-keyword hs-var">safe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>          </span><span class="annot"><span class="annottext">envAttrs :: Attrs
</span><a href="Futhark.Internalise.Monad.html#envAttrs"><span class="hs-identifier hs-var">envAttrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Attrs
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-111"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-112"></span><span>    </span><span id="local-6989586621684380793"><span class="annot"><span class="annottext">newState :: VNameSource -&gt; InternaliseState
</span><a href="#local-6989586621684380793"><span class="hs-identifier hs-var hs-var">newState</span></a></span></span><span> </span><span id="local-6989586621684380786"><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684380786"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><span class="annottext">InternaliseState :: VNameSource
-&gt; FunTable
-&gt; VarSubsts
-&gt; Scope SOACS
-&gt; [FunDef SOACS]
-&gt; InternaliseState
</span><a href="Futhark.Internalise.Monad.html#InternaliseState"><span class="hs-identifier hs-type">InternaliseState</span></a></span><span>
</span><span id="line-114"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">stateNameSource :: VNameSource
</span><a href="Futhark.Internalise.Monad.html#stateNameSource"><span class="hs-identifier hs-var">stateNameSource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684380786"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-115"></span><span>          </span><span class="annot"><span class="annottext">stateFunTable :: FunTable
</span><a href="Futhark.Internalise.Monad.html#stateFunTable"><span class="hs-identifier hs-var">stateFunTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunTable
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span>          </span><span class="annot"><span class="annottext">stateConstSubsts :: VarSubsts
</span><a href="Futhark.Internalise.Monad.html#stateConstSubsts"><span class="hs-identifier hs-var">stateConstSubsts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSubsts
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span>
</span><span id="line-117"></span><span>          </span><span class="annot"><span class="annottext">stateConstScope :: Scope SOACS
</span><a href="Futhark.Internalise.Monad.html#stateConstScope"><span class="hs-identifier hs-var">stateConstScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scope SOACS
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span>
</span><span id="line-118"></span><span>          </span><span class="annot"><span class="annottext">stateFuns :: [FunDef SOACS]
</span><a href="Futhark.Internalise.Monad.html#stateFuns"><span class="hs-identifier hs-var">stateFuns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FunDef SOACS]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-119"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span id="local-6989586621684381252"><span class="annot"><a href="Futhark.Internalise.Monad.html#substitutingVars"><span class="hs-identifier hs-type">substitutingVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#VarSubsts"><span class="hs-identifier hs-type">VarSubsts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684381252"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684381252"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-122"></span><span id="substitutingVars"><span class="annot"><span class="annottext">substitutingVars :: forall a. VarSubsts -&gt; InternaliseM a -&gt; InternaliseM a
</span><a href="Futhark.Internalise.Monad.html#substitutingVars"><span class="hs-identifier hs-var hs-var">substitutingVars</span></a></span></span><span> </span><span id="local-6989586621684380783"><span class="annot"><span class="annottext">VarSubsts
</span><a href="#local-6989586621684380783"><span class="hs-identifier hs-var">substs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InternaliseEnv -&gt; InternaliseEnv)
-&gt; InternaliseM a -&gt; InternaliseM a
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="annot"><span class="annottext">((InternaliseEnv -&gt; InternaliseEnv)
 -&gt; InternaliseM a -&gt; InternaliseM a)
-&gt; (InternaliseEnv -&gt; InternaliseEnv)
-&gt; InternaliseM a
-&gt; InternaliseM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684380781"><span class="annot"><span class="annottext">InternaliseEnv
</span><a href="#local-6989586621684380781"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InternaliseEnv
</span><a href="#local-6989586621684380781"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">envSubsts :: VarSubsts
</span><a href="Futhark.Internalise.Monad.html#envSubsts"><span class="hs-identifier hs-var">envSubsts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSubsts
</span><a href="#local-6989586621684380783"><span class="hs-identifier hs-var">substs</span></a></span><span> </span><span class="annot"><span class="annottext">VarSubsts -&gt; VarSubsts -&gt; VarSubsts
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">InternaliseEnv -&gt; VarSubsts
</span><a href="Futhark.Internalise.Monad.html#envSubsts"><span class="hs-identifier hs-var hs-var">envSubsts</span></a></span><span> </span><span class="annot"><span class="annottext">InternaliseEnv
</span><a href="#local-6989586621684380781"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="annot"><a href="Futhark.Internalise.Monad.html#lookupSubst"><span class="hs-identifier hs-type">lookupSubst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span id="lookupSubst"><span class="annot"><span class="annottext">lookupSubst :: VName -&gt; InternaliseM (Maybe [SubExp])
</span><a href="Futhark.Internalise.Monad.html#lookupSubst"><span class="hs-identifier hs-var hs-var">lookupSubst</span></a></span></span><span> </span><span id="local-6989586621684380780"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684380780"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-126"></span><span>  </span><span id="local-6989586621684380779"><span class="annot"><span class="annottext">Maybe [SubExp]
</span><a href="#local-6989586621684380779"><span class="hs-identifier hs-var">env_substs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(InternaliseEnv -&gt; Maybe [SubExp]) -&gt; InternaliseM (Maybe [SubExp])
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">((InternaliseEnv -&gt; Maybe [SubExp])
 -&gt; InternaliseM (Maybe [SubExp]))
-&gt; (InternaliseEnv -&gt; Maybe [SubExp])
-&gt; InternaliseM (Maybe [SubExp])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; VarSubsts -&gt; Maybe [SubExp]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684380780"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSubsts -&gt; Maybe [SubExp])
-&gt; (InternaliseEnv -&gt; VarSubsts)
-&gt; InternaliseEnv
-&gt; Maybe [SubExp]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">InternaliseEnv -&gt; VarSubsts
</span><a href="Futhark.Internalise.Monad.html#envSubsts"><span class="hs-identifier hs-var hs-var">envSubsts</span></a></span><span>
</span><span id="line-127"></span><span>  </span><span id="local-6989586621684380776"><span class="annot"><span class="annottext">Maybe [SubExp]
</span><a href="#local-6989586621684380776"><span class="hs-identifier hs-var">const_substs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(InternaliseState -&gt; Maybe [SubExp])
-&gt; InternaliseM (Maybe [SubExp])
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">((InternaliseState -&gt; Maybe [SubExp])
 -&gt; InternaliseM (Maybe [SubExp]))
-&gt; (InternaliseState -&gt; Maybe [SubExp])
-&gt; InternaliseM (Maybe [SubExp])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; VarSubsts -&gt; Maybe [SubExp]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684380780"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSubsts -&gt; Maybe [SubExp])
-&gt; (InternaliseState -&gt; VarSubsts)
-&gt; InternaliseState
-&gt; Maybe [SubExp]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">InternaliseState -&gt; VarSubsts
</span><a href="Futhark.Internalise.Monad.html#stateConstSubsts"><span class="hs-identifier hs-var hs-var">stateConstSubsts</span></a></span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><span class="annottext">Maybe [SubExp] -&gt; InternaliseM (Maybe [SubExp])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe [SubExp] -&gt; InternaliseM (Maybe [SubExp]))
-&gt; Maybe [SubExp] -&gt; InternaliseM (Maybe [SubExp])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe [SubExp]
</span><a href="#local-6989586621684380779"><span class="hs-identifier hs-var">env_substs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [SubExp] -&gt; Maybe [SubExp] -&gt; Maybe [SubExp]
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a -&gt; m a -&gt; m a
</span><span class="hs-operator hs-var">`mplus`</span></span><span> </span><span class="annot"><span class="annottext">Maybe [SubExp]
</span><a href="#local-6989586621684380776"><span class="hs-identifier hs-var">const_substs</span></a></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="hs-comment">-- | Add a function definition to the program being constructed.</span><span>
</span><span id="line-131"></span><span class="annot"><a href="Futhark.Internalise.Monad.html#addFunDef"><span class="hs-identifier hs-type">addFunDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span id="addFunDef"><span class="annot"><span class="annottext">addFunDef :: FunDef SOACS -&gt; InternaliseM ()
</span><a href="Futhark.Internalise.Monad.html#addFunDef"><span class="hs-identifier hs-var hs-var">addFunDef</span></a></span></span><span> </span><span id="local-6989586621684380774"><span class="annot"><span class="annottext">FunDef SOACS
</span><a href="#local-6989586621684380774"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InternaliseState -&gt; InternaliseState) -&gt; InternaliseM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((InternaliseState -&gt; InternaliseState) -&gt; InternaliseM ())
-&gt; (InternaliseState -&gt; InternaliseState) -&gt; InternaliseM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684380773"><span class="annot"><span class="annottext">InternaliseState
</span><a href="#local-6989586621684380773"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InternaliseState
</span><a href="#local-6989586621684380773"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">stateFuns :: [FunDef SOACS]
</span><a href="Futhark.Internalise.Monad.html#stateFuns"><span class="hs-identifier hs-var">stateFuns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef SOACS
</span><a href="#local-6989586621684380774"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS -&gt; [FunDef SOACS] -&gt; [FunDef SOACS]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">InternaliseState -&gt; [FunDef SOACS]
</span><a href="Futhark.Internalise.Monad.html#stateFuns"><span class="hs-identifier hs-var hs-var">stateFuns</span></a></span><span> </span><span class="annot"><span class="annottext">InternaliseState
</span><a href="#local-6989586621684380773"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="annot"><a href="Futhark.Internalise.Monad.html#lookupFunction%27"><span class="hs-identifier hs-type">lookupFunction'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#FunInfo"><span class="hs-identifier hs-type">FunInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span id="lookupFunction%27"><span class="annot"><span class="annottext">lookupFunction' :: VName -&gt; InternaliseM (Maybe FunInfo)
</span><a href="Futhark.Internalise.Monad.html#lookupFunction%27"><span class="hs-identifier hs-var hs-var">lookupFunction'</span></a></span></span><span> </span><span id="local-6989586621684380772"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684380772"><span class="hs-identifier hs-var">fname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InternaliseState
 -&gt; Maybe
      ([VName], [DeclType], [Param DeclType],
       [(SubExp, Type)] -&gt; Maybe [DeclExtType]))
-&gt; InternaliseM
     (Maybe
        ([VName], [DeclType], [Param DeclType],
         [(SubExp, Type)] -&gt; Maybe [DeclExtType]))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">((InternaliseState
  -&gt; Maybe
       ([VName], [DeclType], [Param DeclType],
        [(SubExp, Type)] -&gt; Maybe [DeclExtType]))
 -&gt; InternaliseM
      (Maybe
         ([VName], [DeclType], [Param DeclType],
          [(SubExp, Type)] -&gt; Maybe [DeclExtType])))
-&gt; (InternaliseState
    -&gt; Maybe
         ([VName], [DeclType], [Param DeclType],
          [(SubExp, Type)] -&gt; Maybe [DeclExtType]))
-&gt; InternaliseM
     (Maybe
        ([VName], [DeclType], [Param DeclType],
         [(SubExp, Type)] -&gt; Maybe [DeclExtType]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName
-&gt; Map
     VName
     ([VName], [DeclType], [Param DeclType],
      [(SubExp, Type)] -&gt; Maybe [DeclExtType])
-&gt; Maybe
     ([VName], [DeclType], [Param DeclType],
      [(SubExp, Type)] -&gt; Maybe [DeclExtType])
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684380772"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">(Map
   VName
   ([VName], [DeclType], [Param DeclType],
    [(SubExp, Type)] -&gt; Maybe [DeclExtType])
 -&gt; Maybe
      ([VName], [DeclType], [Param DeclType],
       [(SubExp, Type)] -&gt; Maybe [DeclExtType]))
-&gt; (InternaliseState
    -&gt; Map
         VName
         ([VName], [DeclType], [Param DeclType],
          [(SubExp, Type)] -&gt; Maybe [DeclExtType]))
-&gt; InternaliseState
-&gt; Maybe
     ([VName], [DeclType], [Param DeclType],
      [(SubExp, Type)] -&gt; Maybe [DeclExtType])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">InternaliseState
-&gt; Map
     VName
     ([VName], [DeclType], [Param DeclType],
      [(SubExp, Type)] -&gt; Maybe [DeclExtType])
InternaliseState -&gt; FunTable
</span><a href="Futhark.Internalise.Monad.html#stateFunTable"><span class="hs-identifier hs-var hs-var">stateFunTable</span></a></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="annot"><a href="Futhark.Internalise.Monad.html#lookupFunction"><span class="hs-identifier hs-type">lookupFunction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#FunInfo"><span class="hs-identifier hs-type">FunInfo</span></a></span><span>
</span><span id="line-138"></span><span id="lookupFunction"><span class="annot"><span class="annottext">lookupFunction :: VName -&gt; InternaliseM FunInfo
</span><a href="Futhark.Internalise.Monad.html#lookupFunction"><span class="hs-identifier hs-var hs-var">lookupFunction</span></a></span></span><span> </span><span id="local-6989586621684380771"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684380771"><span class="hs-identifier hs-var">fname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InternaliseM
  ([VName], [DeclType], [Param DeclType],
   [(SubExp, Type)] -&gt; Maybe [DeclExtType])
-&gt; (([VName], [DeclType], [Param DeclType],
     [(SubExp, Type)] -&gt; Maybe [DeclExtType])
    -&gt; InternaliseM
         ([VName], [DeclType], [Param DeclType],
          [(SubExp, Type)] -&gt; Maybe [DeclExtType]))
-&gt; Maybe
     ([VName], [DeclType], [Param DeclType],
      [(SubExp, Type)] -&gt; Maybe [DeclExtType])
-&gt; InternaliseM
     ([VName], [DeclType], [Param DeclType],
      [(SubExp, Type)] -&gt; Maybe [DeclExtType])
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">InternaliseM
  ([VName], [DeclType], [Param DeclType],
   [(SubExp, Type)] -&gt; Maybe [DeclExtType])
</span><a href="#local-6989586621684380769"><span class="hs-identifier hs-var">bad</span></a></span><span> </span><span class="annot"><span class="annottext">([VName], [DeclType], [Param DeclType],
 [(SubExp, Type)] -&gt; Maybe [DeclExtType])
-&gt; InternaliseM
     ([VName], [DeclType], [Param DeclType],
      [(SubExp, Type)] -&gt; Maybe [DeclExtType])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe
   ([VName], [DeclType], [Param DeclType],
    [(SubExp, Type)] -&gt; Maybe [DeclExtType])
 -&gt; InternaliseM
      ([VName], [DeclType], [Param DeclType],
       [(SubExp, Type)] -&gt; Maybe [DeclExtType]))
-&gt; InternaliseM
     (Maybe
        ([VName], [DeclType], [Param DeclType],
         [(SubExp, Type)] -&gt; Maybe [DeclExtType]))
-&gt; InternaliseM
     ([VName], [DeclType], [Param DeclType],
      [(SubExp, Type)] -&gt; Maybe [DeclExtType])
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; InternaliseM (Maybe FunInfo)
</span><a href="Futhark.Internalise.Monad.html#lookupFunction%27"><span class="hs-identifier hs-var">lookupFunction'</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684380771"><span class="hs-identifier hs-var">fname</span></a></span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-140"></span><span>    </span><span id="local-6989586621684380769"><span class="annot"><span class="annottext">bad :: InternaliseM
  ([VName], [DeclType], [Param DeclType],
   [(SubExp, Type)] -&gt; Maybe [DeclExtType])
</span><a href="#local-6989586621684380769"><span class="hs-identifier hs-var hs-var">bad</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; InternaliseM
     ([VName], [DeclType], [Param DeclType],
      [(SubExp, Type)] -&gt; Maybe [DeclExtType])
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char]
 -&gt; InternaliseM
      ([VName], [DeclType], [Param DeclType],
       [(SubExp, Type)] -&gt; Maybe [DeclExtType]))
-&gt; [Char]
-&gt; InternaliseM
     ([VName], [DeclType], [Param DeclType],
      [(SubExp, Type)] -&gt; Maybe [DeclExtType])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Internalise.lookupFunction: Function '&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684380771"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;' not found.&quot;</span></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="annot"><a href="Futhark.Internalise.Monad.html#lookupConst"><span class="hs-identifier hs-type">lookupConst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span id="lookupConst"><span class="annot"><span class="annottext">lookupConst :: VName -&gt; InternaliseM (Maybe [SubExp])
</span><a href="Futhark.Internalise.Monad.html#lookupConst"><span class="hs-identifier hs-var hs-var">lookupConst</span></a></span></span><span> </span><span id="local-6989586621684380765"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684380765"><span class="hs-identifier hs-var">fname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InternaliseState -&gt; Maybe [SubExp])
-&gt; InternaliseM (Maybe [SubExp])
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">((InternaliseState -&gt; Maybe [SubExp])
 -&gt; InternaliseM (Maybe [SubExp]))
-&gt; (InternaliseState -&gt; Maybe [SubExp])
-&gt; InternaliseM (Maybe [SubExp])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; VarSubsts -&gt; Maybe [SubExp]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684380765"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSubsts -&gt; Maybe [SubExp])
-&gt; (InternaliseState -&gt; VarSubsts)
-&gt; InternaliseState
-&gt; Maybe [SubExp]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">InternaliseState -&gt; VarSubsts
</span><a href="Futhark.Internalise.Monad.html#stateConstSubsts"><span class="hs-identifier hs-var hs-var">stateConstSubsts</span></a></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="annot"><a href="Futhark.Internalise.Monad.html#bindFunction"><span class="hs-identifier hs-type">bindFunction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#FunInfo"><span class="hs-identifier hs-type">FunInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span id="bindFunction"><span class="annot"><span class="annottext">bindFunction :: VName -&gt; FunDef SOACS -&gt; FunInfo -&gt; InternaliseM ()
</span><a href="Futhark.Internalise.Monad.html#bindFunction"><span class="hs-identifier hs-var hs-var">bindFunction</span></a></span></span><span> </span><span id="local-6989586621684380764"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684380764"><span class="hs-identifier hs-var">fname</span></a></span></span><span> </span><span id="local-6989586621684380763"><span class="annot"><span class="annottext">FunDef SOACS
</span><a href="#local-6989586621684380763"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621684380762"><span class="annot"><span class="annottext">FunInfo
</span><a href="#local-6989586621684380762"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><span class="annottext">FunDef SOACS -&gt; InternaliseM ()
</span><a href="Futhark.Internalise.Monad.html#addFunDef"><span class="hs-identifier hs-var">addFunDef</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS
</span><a href="#local-6989586621684380763"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><span class="annottext">(InternaliseState -&gt; InternaliseState) -&gt; InternaliseM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((InternaliseState -&gt; InternaliseState) -&gt; InternaliseM ())
-&gt; (InternaliseState -&gt; InternaliseState) -&gt; InternaliseM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684380761"><span class="annot"><span class="annottext">InternaliseState
</span><a href="#local-6989586621684380761"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InternaliseState
</span><a href="#local-6989586621684380761"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">stateFunTable :: FunTable
</span><a href="Futhark.Internalise.Monad.html#stateFunTable"><span class="hs-identifier hs-var">stateFunTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName
-&gt; ([VName], [DeclType], [Param DeclType],
    [(SubExp, Type)] -&gt; Maybe [DeclExtType])
-&gt; Map
     VName
     ([VName], [DeclType], [Param DeclType],
      [(SubExp, Type)] -&gt; Maybe [DeclExtType])
-&gt; Map
     VName
     ([VName], [DeclType], [Param DeclType],
      [(SubExp, Type)] -&gt; Maybe [DeclExtType])
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684380764"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">([VName], [DeclType], [Param DeclType],
 [(SubExp, Type)] -&gt; Maybe [DeclExtType])
FunInfo
</span><a href="#local-6989586621684380762"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">(Map
   VName
   ([VName], [DeclType], [Param DeclType],
    [(SubExp, Type)] -&gt; Maybe [DeclExtType])
 -&gt; Map
      VName
      ([VName], [DeclType], [Param DeclType],
       [(SubExp, Type)] -&gt; Maybe [DeclExtType]))
-&gt; Map
     VName
     ([VName], [DeclType], [Param DeclType],
      [(SubExp, Type)] -&gt; Maybe [DeclExtType])
-&gt; Map
     VName
     ([VName], [DeclType], [Param DeclType],
      [(SubExp, Type)] -&gt; Maybe [DeclExtType])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InternaliseState -&gt; FunTable
</span><a href="Futhark.Internalise.Monad.html#stateFunTable"><span class="hs-identifier hs-var hs-var">stateFunTable</span></a></span><span> </span><span class="annot"><span class="annottext">InternaliseState
</span><a href="#local-6989586621684380761"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="annot"><a href="Futhark.Internalise.Monad.html#bindConstant"><span class="hs-identifier hs-type">bindConstant</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span id="bindConstant"><span class="annot"><span class="annottext">bindConstant :: VName -&gt; FunDef SOACS -&gt; InternaliseM ()
</span><a href="Futhark.Internalise.Monad.html#bindConstant"><span class="hs-identifier hs-var hs-var">bindConstant</span></a></span></span><span> </span><span id="local-6989586621684380759"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684380759"><span class="hs-identifier hs-var">cname</span></a></span></span><span> </span><span id="local-6989586621684380758"><span class="annot"><span class="annottext">FunDef SOACS
</span><a href="#local-6989586621684380758"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684380757"><span class="annot"><span class="annottext">stms :: Stms SOACS
</span><a href="#local-6989586621684380757"><span class="hs-identifier hs-var hs-var">stms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Body SOACS -&gt; Stms SOACS
forall rep. BodyT rep -&gt; Stms rep
</span><a href="Futhark.IR.Syntax.html#bodyStms"><span class="hs-identifier hs-var hs-var">bodyStms</span></a></span><span> </span><span class="annot"><span class="annottext">(Body SOACS -&gt; Stms SOACS) -&gt; Body SOACS -&gt; Stms SOACS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS -&gt; Body SOACS
forall rep. FunDef rep -&gt; BodyT rep
</span><a href="Futhark.IR.Syntax.html#funDefBody"><span class="hs-identifier hs-var hs-var">funDefBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS
</span><a href="#local-6989586621684380758"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-153"></span><span>      </span><span id="local-6989586621684380754"><span class="annot"><span class="annottext">substs :: [SubExp]
</span><a href="#local-6989586621684380754"><span class="hs-identifier hs-var hs-var">substs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-154"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; [SubExp] -&gt; [SubExp]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Int -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DeclExtType] -&gt; Set Int
forall u. [TypeBase ExtShape u] -&gt; Set Int
</span><a href="Futhark.IR.Prop.Types.html#shapeContext"><span class="hs-identifier hs-var">shapeContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef SOACS -&gt; [RetType SOACS]
forall rep. FunDef rep -&gt; [RetType rep]
</span><a href="Futhark.IR.Syntax.html#funDefRetType"><span class="hs-identifier hs-var hs-var">funDefRetType</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS
</span><a href="#local-6989586621684380758"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([SubExp] -&gt; [SubExp]) -&gt; [SubExp] -&gt; [SubExp]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-155"></span><span>          </span><span class="annot"><span class="annottext">(SubExpRes -&gt; SubExp) -&gt; Result -&gt; [SubExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">SubExpRes -&gt; SubExp
</span><a href="Futhark.IR.Syntax.html#resSubExp"><span class="hs-identifier hs-var hs-var">resSubExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Result -&gt; [SubExp]) -&gt; Result -&gt; [SubExp]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Body SOACS -&gt; Result
forall rep. BodyT rep -&gt; Result
</span><a href="Futhark.IR.Syntax.html#bodyResult"><span class="hs-identifier hs-var hs-var">bodyResult</span></a></span><span> </span><span class="annot"><span class="annottext">(Body SOACS -&gt; Result) -&gt; Body SOACS -&gt; Result
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS -&gt; Body SOACS
forall rep. FunDef rep -&gt; BodyT rep
</span><a href="Futhark.IR.Syntax.html#funDefBody"><span class="hs-identifier hs-var hs-var">funDefBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS
</span><a href="#local-6989586621684380758"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-156"></span><span>  </span><span class="annot"><span class="annottext">Stms (Rep InternaliseM) -&gt; InternaliseM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stms (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStms"><span class="hs-identifier hs-var">addStms</span></a></span><span> </span><span class="annot"><span class="annottext">Stms (Rep InternaliseM)
Stms SOACS
</span><a href="#local-6989586621684380757"><span class="hs-identifier hs-var">stms</span></a></span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><span class="annottext">(InternaliseState -&gt; InternaliseState) -&gt; InternaliseM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((InternaliseState -&gt; InternaliseState) -&gt; InternaliseM ())
-&gt; (InternaliseState -&gt; InternaliseState) -&gt; InternaliseM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684380747"><span class="annot"><span class="annottext">InternaliseState
</span><a href="#local-6989586621684380747"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><span class="annottext">InternaliseState
</span><a href="#local-6989586621684380747"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-159"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">stateConstSubsts :: VarSubsts
</span><a href="Futhark.Internalise.Monad.html#stateConstSubsts"><span class="hs-identifier hs-var">stateConstSubsts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; [SubExp] -&gt; VarSubsts -&gt; VarSubsts
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684380759"><span class="hs-identifier hs-var">cname</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684380754"><span class="hs-identifier hs-var">substs</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSubsts -&gt; VarSubsts) -&gt; VarSubsts -&gt; VarSubsts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InternaliseState -&gt; VarSubsts
</span><a href="Futhark.Internalise.Monad.html#stateConstSubsts"><span class="hs-identifier hs-var hs-var">stateConstSubsts</span></a></span><span> </span><span class="annot"><span class="annottext">InternaliseState
</span><a href="#local-6989586621684380747"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-160"></span><span>        </span><span class="annot"><span class="annottext">stateConstScope :: Scope SOACS
</span><a href="Futhark.Internalise.Monad.html#stateConstScope"><span class="hs-identifier hs-var">stateConstScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stms SOACS -&gt; Scope SOACS
forall rep a. Scoped rep a =&gt; a -&gt; Scope rep
</span><a href="Futhark.IR.Prop.Scope.html#scopeOf"><span class="hs-identifier hs-var">scopeOf</span></a></span><span> </span><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684380757"><span class="hs-identifier hs-var">stms</span></a></span><span> </span><span class="annot"><span class="annottext">Scope SOACS -&gt; Scope SOACS -&gt; Scope SOACS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">InternaliseState -&gt; Scope SOACS
</span><a href="Futhark.Internalise.Monad.html#stateConstScope"><span class="hs-identifier hs-var hs-var">stateConstScope</span></a></span><span> </span><span class="annot"><span class="annottext">InternaliseState
</span><a href="#local-6989586621684380747"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-161"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span id="local-6989586621684381214"><span class="annot"><a href="Futhark.Internalise.Monad.html#localConstsScope"><span class="hs-identifier hs-type">localConstsScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684381214"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684381214"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-164"></span><span id="localConstsScope"><span class="annot"><span class="annottext">localConstsScope :: forall a. InternaliseM a -&gt; InternaliseM a
</span><a href="Futhark.Internalise.Monad.html#localConstsScope"><span class="hs-identifier hs-var hs-var">localConstsScope</span></a></span></span><span> </span><span id="local-6989586621684380742"><span class="annot"><span class="annottext">InternaliseM a
</span><a href="#local-6989586621684380742"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-165"></span><span>  </span><span id="local-6989586621684380741"><span class="annot"><span class="annottext">Scope SOACS
</span><a href="#local-6989586621684380741"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(InternaliseState -&gt; Scope SOACS) -&gt; InternaliseM (Scope SOACS)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">InternaliseState -&gt; Scope SOACS
</span><a href="Futhark.Internalise.Monad.html#stateConstScope"><span class="hs-identifier hs-var hs-var">stateConstScope</span></a></span><span>
</span><span id="line-166"></span><span>  </span><span class="annot"><span class="annottext">Scope SOACS -&gt; InternaliseM a -&gt; InternaliseM a
forall rep (m :: * -&gt; *) a.
LocalScope rep m =&gt;
Scope rep -&gt; m a -&gt; m a
</span><a href="Futhark.IR.Prop.Scope.html#localScope"><span class="hs-identifier hs-var">localScope</span></a></span><span> </span><span class="annot"><span class="annottext">Scope SOACS
</span><a href="#local-6989586621684380741"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">InternaliseM a
</span><a href="#local-6989586621684380742"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="hs-comment">-- | Construct an 'Assert' statement, but taking attributes into</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- account.  Always use this function, and never construct 'Assert'</span><span>
</span><span id="line-170"></span><span class="hs-comment">-- directly in the internaliser!</span><span>
</span><span id="line-171"></span><span class="annot"><a href="Futhark.Internalise.Monad.html#assert"><span class="hs-identifier hs-type">assert</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-172"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-173"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-174"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ErrorMsg"><span class="hs-identifier hs-type">ErrorMsg</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-175"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-176"></span><span>  </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Certs"><span class="hs-identifier hs-type">Certs</span></a></span><span>
</span><span id="line-177"></span><span id="assert"><span class="annot"><span class="annottext">assert :: [Char] -&gt; SubExp -&gt; ErrorMsg SubExp -&gt; SrcLoc -&gt; InternaliseM Certs
</span><a href="Futhark.Internalise.Monad.html#assert"><span class="hs-identifier hs-var hs-var">assert</span></a></span></span><span> </span><span id="local-6989586621684380739"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684380739"><span class="hs-identifier hs-var">desc</span></a></span></span><span> </span><span id="local-6989586621684380738"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684380738"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span id="local-6989586621684380737"><span class="annot"><span class="annottext">ErrorMsg SubExp
</span><a href="#local-6989586621684380737"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621684380736"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684380736"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InternaliseM VName -&gt; InternaliseM Certs
</span><a href="Futhark.Internalise.Monad.html#assertingOne"><span class="hs-identifier hs-var">assertingOne</span></a></span><span> </span><span class="annot"><span class="annottext">(InternaliseM VName -&gt; InternaliseM Certs)
-&gt; InternaliseM VName -&gt; InternaliseM Certs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-178"></span><span>  </span><span id="local-6989586621684380734"><span class="annot"><span class="annottext">Attrs
</span><a href="#local-6989586621684380734"><span class="hs-identifier hs-var">attrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(InternaliseEnv -&gt; Attrs) -&gt; InternaliseM Attrs
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">((InternaliseEnv -&gt; Attrs) -&gt; InternaliseM Attrs)
-&gt; (InternaliseEnv -&gt; Attrs) -&gt; InternaliseM Attrs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Attrs -&gt; Attrs
</span><a href="Futhark.IR.Prop.html#attrsForAssert"><span class="hs-identifier hs-var">attrsForAssert</span></a></span><span> </span><span class="annot"><span class="annottext">(Attrs -&gt; Attrs)
-&gt; (InternaliseEnv -&gt; Attrs) -&gt; InternaliseEnv -&gt; Attrs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">InternaliseEnv -&gt; Attrs
</span><a href="Futhark.Internalise.Monad.html#envAttrs"><span class="hs-identifier hs-var hs-var">envAttrs</span></a></span><span>
</span><span id="line-179"></span><span>  </span><span class="annot"><span class="annottext">Attrs -&gt; InternaliseM VName -&gt; InternaliseM VName
forall (m :: * -&gt; *) a. MonadBuilder m =&gt; Attrs -&gt; m a -&gt; m a
</span><a href="Futhark.Builder.Class.html#attributing"><span class="hs-identifier hs-var">attributing</span></a></span><span> </span><span class="annot"><span class="annottext">Attrs
</span><a href="#local-6989586621684380734"><span class="hs-identifier hs-var">attrs</span></a></span><span> </span><span class="annot"><span class="annottext">(InternaliseM VName -&gt; InternaliseM VName)
-&gt; InternaliseM VName -&gt; InternaliseM VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Exp (Rep InternaliseM) -&gt; InternaliseM VName
forall (m :: * -&gt; *).
MonadBuilder m =&gt;
[Char] -&gt; Exp (Rep m) -&gt; m VName
</span><a href="Futhark.Construct.html#letExp"><span class="hs-identifier hs-var">letExp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684380739"><span class="hs-identifier hs-var">desc</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp (Rep InternaliseM) -&gt; InternaliseM VName)
-&gt; Exp (Rep InternaliseM) -&gt; InternaliseM VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-181"></span><span>      </span><span class="annot"><span class="annottext">BasicOp -&gt; ExpT SOACS
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; ExpT SOACS) -&gt; BasicOp -&gt; ExpT SOACS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; ErrorMsg SubExp -&gt; (SrcLoc, [SrcLoc]) -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#Assert"><span class="hs-identifier hs-var">Assert</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684380738"><span class="hs-identifier hs-var">se</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMsg SubExp
</span><a href="#local-6989586621684380737"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684380736"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SrcLoc]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-comment">-- | Execute the given action if 'envDoBoundsChecks' is true, otherwise</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- just return an empty list.</span><span>
</span><span id="line-185"></span><span class="annot"><a href="Futhark.Internalise.Monad.html#asserting"><span class="hs-identifier hs-type">asserting</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-186"></span><span>  </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Certs"><span class="hs-identifier hs-type">Certs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Certs"><span class="hs-identifier hs-type">Certs</span></a></span><span>
</span><span id="line-188"></span><span id="asserting"><span class="annot"><span class="annottext">asserting :: InternaliseM Certs -&gt; InternaliseM Certs
</span><a href="Futhark.Internalise.Monad.html#asserting"><span class="hs-identifier hs-var hs-var">asserting</span></a></span></span><span> </span><span id="local-6989586621684380727"><span class="annot"><span class="annottext">InternaliseM Certs
</span><a href="#local-6989586621684380727"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-189"></span><span>  </span><span id="local-6989586621684380726"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684380726"><span class="hs-identifier hs-var">doBoundsChecks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(InternaliseEnv -&gt; Bool) -&gt; InternaliseM Bool
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">InternaliseEnv -&gt; Bool
</span><a href="Futhark.Internalise.Monad.html#envDoBoundsChecks"><span class="hs-identifier hs-var hs-var">envDoBoundsChecks</span></a></span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684380726"><span class="hs-identifier hs-var">doBoundsChecks</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">InternaliseM Certs
</span><a href="#local-6989586621684380727"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Certs -&gt; InternaliseM Certs
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Certs
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-comment">-- | Execute the given action if 'envDoBoundsChecks' is true, otherwise</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- just return an empty list.</span><span>
</span><span id="line-196"></span><span class="annot"><a href="Futhark.Internalise.Monad.html#assertingOne"><span class="hs-identifier hs-type">assertingOne</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-198"></span><span>  </span><span class="annot"><a href="Futhark.Internalise.Monad.html#InternaliseM"><span class="hs-identifier hs-type">InternaliseM</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Certs"><span class="hs-identifier hs-type">Certs</span></a></span><span>
</span><span id="line-199"></span><span id="assertingOne"><span class="annot"><span class="annottext">assertingOne :: InternaliseM VName -&gt; InternaliseM Certs
</span><a href="Futhark.Internalise.Monad.html#assertingOne"><span class="hs-identifier hs-var hs-var">assertingOne</span></a></span></span><span> </span><span id="local-6989586621684380725"><span class="annot"><span class="annottext">InternaliseM VName
</span><a href="#local-6989586621684380725"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InternaliseM Certs -&gt; InternaliseM Certs
</span><a href="Futhark.Internalise.Monad.html#asserting"><span class="hs-identifier hs-var">asserting</span></a></span><span> </span><span class="annot"><span class="annottext">(InternaliseM Certs -&gt; InternaliseM Certs)
-&gt; InternaliseM Certs -&gt; InternaliseM Certs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; Certs
</span><a href="Futhark.IR.Syntax.Core.html#Certs"><span class="hs-identifier hs-var">Certs</span></a></span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; Certs) -&gt; (VName -&gt; [VName]) -&gt; VName -&gt; Certs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; [VName]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Certs) -&gt; InternaliseM VName -&gt; InternaliseM Certs
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">InternaliseM VName
</span><a href="#local-6989586621684380725"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-200"></span></pre></body></html>