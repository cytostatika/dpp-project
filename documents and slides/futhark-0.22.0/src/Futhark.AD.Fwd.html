<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Futhark.AD.Fwd</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.AD.Fwd.html#fwdJVP"><span class="hs-identifier">fwdJVP</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.RWS.Strict</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State.Strict</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">second</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">transpose</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.AD.Derivatives.html"><span class="hs-identifier">Futhark.AD.Derivatives</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Analysis.PrimExp.Convert.html"><span class="hs-identifier">Futhark.Analysis.PrimExp.Convert</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Builder.html"><span class="hs-identifier">Futhark.Builder</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Construct.html"><span class="hs-identifier">Futhark.Construct</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html"><span class="hs-identifier">Futhark.IR.SOACS</span></a></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="annot"><a href="Futhark.AD.Fwd.html#zeroTan"><span class="hs-identifier hs-type">zeroTan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span>
</span><span id="line-25"></span><span id="zeroTan"><span class="annot"><span class="annottext">zeroTan :: Type -&gt; ADM SubExp
</span><a href="Futhark.AD.Fwd.html#zeroTan"><span class="hs-identifier hs-var hs-var">zeroTan</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span id="local-6989586621684466904"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466904"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; ADM SubExp
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; ADM SubExp) -&gt; SubExp -&gt; ADM SubExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimValue -&gt; SubExp
forall v. IsValue v =&gt; v -&gt; SubExp
</span><a href="Futhark.IR.Prop.Constants.html#constant"><span class="hs-identifier hs-var">constant</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimValue -&gt; SubExp) -&gt; PrimValue -&gt; SubExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; PrimValue
</span><a href="Futhark.IR.Primitive.html#blankPrimValue"><span class="hs-identifier hs-var">blankPrimValue</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466904"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-26"></span><span class="annot"><a href="Futhark.AD.Fwd.html#zeroTan"><span class="hs-identifier hs-var">zeroTan</span></a></span><span> </span><span id="local-6989586621684466901"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621684466901"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ADM SubExp
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ADM SubExp) -&gt; [Char] -&gt; ADM SubExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;zeroTan on non-primitive type: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621684466901"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="annot"><a href="Futhark.AD.Fwd.html#zeroExp"><span class="hs-identifier hs-type">zeroExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-29"></span><span id="zeroExp"><span class="annot"><span class="annottext">zeroExp :: Type -&gt; Exp
</span><a href="Futhark.AD.Fwd.html#zeroExp"><span class="hs-identifier hs-var hs-var">zeroExp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span id="local-6989586621684466897"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466897"><span class="hs-identifier hs-var">pt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><span class="annottext">BasicOp -&gt; Exp
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; Exp) -&gt; BasicOp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#SubExp"><span class="hs-identifier hs-var">SubExp</span></a></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; BasicOp) -&gt; SubExp -&gt; BasicOp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimValue -&gt; SubExp
</span><a href="Futhark.IR.Syntax.Core.html#Constant"><span class="hs-identifier hs-var">Constant</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimValue -&gt; SubExp) -&gt; PrimValue -&gt; SubExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; PrimValue
</span><a href="Futhark.IR.Primitive.html#blankPrimValue"><span class="hs-identifier hs-var">blankPrimValue</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466897"><span class="hs-identifier hs-var">pt</span></a></span><span>
</span><span id="line-31"></span><span class="annot"><a href="Futhark.AD.Fwd.html#zeroExp"><span class="hs-identifier hs-var">zeroExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span id="local-6989586621684466892"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466892"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621684466891"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684466891"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoUniqueness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><span class="annottext">BasicOp -&gt; Exp
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; Exp) -&gt; BasicOp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Shape -&gt; SubExp -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#Replicate"><span class="hs-identifier hs-var">Replicate</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684466891"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; BasicOp) -&gt; SubExp -&gt; BasicOp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimValue -&gt; SubExp
</span><a href="Futhark.IR.Syntax.Core.html#Constant"><span class="hs-identifier hs-var">Constant</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimValue -&gt; SubExp) -&gt; PrimValue -&gt; SubExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; PrimValue
</span><a href="Futhark.IR.Primitive.html#blankPrimValue"><span class="hs-identifier hs-var">blankPrimValue</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466892"><span class="hs-identifier hs-var">pt</span></a></span><span>
</span><span id="line-33"></span><span class="annot"><a href="Futhark.AD.Fwd.html#zeroExp"><span class="hs-identifier hs-var">zeroExp</span></a></span><span> </span><span id="local-6989586621684466889"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621684466889"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Exp
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Exp) -&gt; [Char] -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;zeroExp: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621684466889"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span id="local-6989586621684467577"><span id="local-6989586621684467578"><span class="annot"><a href="Futhark.AD.Fwd.html#isAcc"><span class="hs-identifier hs-type">isAcc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467578"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467577"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-36"></span><span id="isAcc"><span class="annot"><span class="annottext">isAcc :: forall s u. TypeBase s u -&gt; Bool
</span><a href="Futhark.AD.Fwd.html#isAcc"><span class="hs-identifier hs-var hs-var">isAcc</span></a></span></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Acc"><span class="hs-identifier hs-type">Acc</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-37"></span><span class="annot"><a href="Futhark.AD.Fwd.html#isAcc"><span class="hs-identifier hs-var">isAcc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase s u
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span id="local-6989586621684467573"><span id="local-6989586621684467574"><span class="annot"><a href="Futhark.AD.Fwd.html#tanType"><span class="hs-identifier hs-type">tanType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467574"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467573"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467574"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467573"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-40"></span><span id="tanType"><span class="annot"><span class="annottext">tanType :: forall s u. TypeBase s u -&gt; ADM (TypeBase s u)
</span><a href="Futhark.AD.Fwd.html#tanType"><span class="hs-identifier hs-var hs-var">tanType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Acc"><span class="hs-identifier hs-type">Acc</span></a></span><span> </span><span id="local-6989586621684466879"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466879"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684466878"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684466878"><span class="hs-identifier hs-var">ispace</span></a></span></span><span> </span><span id="local-6989586621684466877"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684466877"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621684466876"><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684466876"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-41"></span><span>  </span><span id="local-6989586621684466875"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684466875"><span class="hs-identifier hs-var">ts_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; ADM Type) -&gt; [Type] -&gt; ADM [Type]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ADM Type
forall s u. TypeBase s u -&gt; ADM (TypeBase s u)
</span><a href="Futhark.AD.Fwd.html#tanType"><span class="hs-identifier hs-var">tanType</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684466877"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><span class="annottext">TypeBase s u -&gt; ADM (TypeBase s u)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(TypeBase s u -&gt; ADM (TypeBase s u))
-&gt; TypeBase s u -&gt; ADM (TypeBase s u)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; TypeBase s u
forall shape u. VName -&gt; Shape -&gt; [Type] -&gt; u -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Acc"><span class="hs-identifier hs-var">Acc</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466879"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684466878"><span class="hs-identifier hs-var">ispace</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684466877"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684466875"><span class="hs-identifier hs-var">ts_tan</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621684466876"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-43"></span><span class="annot"><a href="Futhark.AD.Fwd.html#tanType"><span class="hs-identifier hs-var">tanType</span></a></span><span> </span><span id="local-6989586621684466873"><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466873"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase s u -&gt; ADM (TypeBase s u)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466873"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span id="local-6989586621684467566"><span class="annot"><a href="Futhark.AD.Fwd.html#slocal%27"><span class="hs-identifier hs-type">slocal'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467566"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467566"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-46"></span><span id="slocal%27"><span class="annot"><span class="annottext">slocal' :: forall a. ADM a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#slocal%27"><span class="hs-identifier hs-var hs-var">slocal'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RState -&gt; RState) -&gt; ADM a -&gt; ADM a
forall a. (RState -&gt; RState) -&gt; ADM a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#slocal"><span class="hs-identifier hs-var">slocal</span></a></span><span> </span><span class="annot"><span class="annottext">RState -&gt; RState
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span id="local-6989586621684467564"><span class="annot"><a href="Futhark.AD.Fwd.html#slocal"><span class="hs-identifier hs-type">slocal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.AD.Fwd.html#RState"><span class="hs-identifier hs-type">RState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#RState"><span class="hs-identifier hs-type">RState</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467564"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467564"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-49"></span><span id="slocal"><span class="annot"><span class="annottext">slocal :: forall a. (RState -&gt; RState) -&gt; ADM a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#slocal"><span class="hs-identifier hs-var hs-var">slocal</span></a></span></span><span> </span><span id="local-6989586621684466861"><span class="annot"><span class="annottext">RState -&gt; RState
</span><a href="#local-6989586621684466861"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621684466860"><span class="annot"><span class="annottext">ADM a
</span><a href="#local-6989586621684466860"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-50"></span><span>  </span><span id="local-6989586621684466859"><span class="annot"><span class="annottext">RState
</span><a href="#local-6989586621684466859"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ADM RState
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><span class="annottext">(RState -&gt; RState) -&gt; ADM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">RState -&gt; RState
</span><a href="#local-6989586621684466861"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-52"></span><span>  </span><span id="local-6989586621684466856"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684466856"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ADM a
</span><a href="#local-6989586621684466860"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><span class="annottext">(RState -&gt; RState) -&gt; ADM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((RState -&gt; RState) -&gt; ADM ()) -&gt; (RState -&gt; RState) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684466855"><span class="annot"><span class="annottext">RState
</span><a href="#local-6989586621684466855"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RState
</span><a href="#local-6989586621684466855"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">stateTans :: Map VName VName
</span><a href="Futhark.AD.Fwd.html#stateTans"><span class="hs-identifier hs-var">stateTans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RState -&gt; Map VName VName
</span><a href="Futhark.AD.Fwd.html#stateTans"><span class="hs-identifier hs-var hs-var">stateTans</span></a></span><span> </span><span class="annot"><span class="annottext">RState
</span><a href="#local-6989586621684466859"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; ADM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684466856"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">data</span><span> </span><span id="RState"><span class="annot"><a href="Futhark.AD.Fwd.html#RState"><span class="hs-identifier hs-var">RState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RState"><span class="annot"><a href="Futhark.AD.Fwd.html#RState"><span class="hs-identifier hs-var">RState</span></a></span></span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="stateTans"><span class="annot"><span class="annottext">RState -&gt; Map VName VName
</span><a href="Futhark.AD.Fwd.html#stateTans"><span class="hs-identifier hs-var hs-var">stateTans</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>    </span><span id="stateNameSource"><span class="annot"><span class="annottext">RState -&gt; VNameSource
</span><a href="Futhark.AD.Fwd.html#stateNameSource"><span class="hs-identifier hs-var hs-var">stateNameSource</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.FreshNames.html#VNameSource"><span class="hs-identifier hs-type">VNameSource</span></a></span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">newtype</span><span> </span><span id="ADM"><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-var">ADM</span></a></span></span><span> </span><span id="local-6989586621684467470"><span class="annot"><a href="#local-6989586621684467470"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ADM"><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-var">ADM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Builder.html#BuilderT"><span class="hs-identifier hs-type">BuilderT</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#RState"><span class="hs-identifier hs-type">RState</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621684467470"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-keyword">deriving</span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">(</span><span> </span><span id="local-6989586621684466843"><span id="local-6989586621684466849"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; ADM a -&gt; ADM b)
-&gt; (forall a b. a -&gt; ADM b -&gt; ADM a) -&gt; Functor ADM
forall a b. a -&gt; ADM b -&gt; ADM a
forall a b. (a -&gt; b) -&gt; ADM a -&gt; ADM b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: forall a b. a -&gt; ADM b -&gt; ADM a
$c&lt;$ :: forall a b. a -&gt; ADM b -&gt; ADM a
fmap :: forall a b. (a -&gt; b) -&gt; ADM a -&gt; ADM b
$cfmap :: forall a b. (a -&gt; b) -&gt; ADM a -&gt; ADM b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>      </span><span id="local-6989586621684466810"><span id="local-6989586621684466815"><span id="local-6989586621684466820"><span id="local-6989586621684466825"><span id="local-6989586621684466831"><span class="annot"><span class="annottext">Functor ADM
Functor ADM
-&gt; (forall a. a -&gt; ADM a)
-&gt; (forall a b. ADM (a -&gt; b) -&gt; ADM a -&gt; ADM b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; ADM a -&gt; ADM b -&gt; ADM c)
-&gt; (forall a b. ADM a -&gt; ADM b -&gt; ADM b)
-&gt; (forall a b. ADM a -&gt; ADM b -&gt; ADM a)
-&gt; Applicative ADM
forall a. a -&gt; ADM a
forall a b. ADM a -&gt; ADM b -&gt; ADM a
forall a b. ADM a -&gt; ADM b -&gt; ADM b
forall a b. ADM (a -&gt; b) -&gt; ADM a -&gt; ADM b
forall a b c. (a -&gt; b -&gt; c) -&gt; ADM a -&gt; ADM b -&gt; ADM c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
&lt;* :: forall a b. ADM a -&gt; ADM b -&gt; ADM a
$c&lt;* :: forall a b. ADM a -&gt; ADM b -&gt; ADM a
*&gt; :: forall a b. ADM a -&gt; ADM b -&gt; ADM b
$c*&gt; :: forall a b. ADM a -&gt; ADM b -&gt; ADM b
liftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; ADM a -&gt; ADM b -&gt; ADM c
$cliftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; ADM a -&gt; ADM b -&gt; ADM c
&lt;*&gt; :: forall a b. ADM (a -&gt; b) -&gt; ADM a -&gt; ADM b
$c&lt;*&gt; :: forall a b. ADM (a -&gt; b) -&gt; ADM a -&gt; ADM b
pure :: forall a. a -&gt; ADM a
$cpure :: forall a. a -&gt; ADM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>      </span><span id="local-6989586621684466784"><span id="local-6989586621684466789"><span id="local-6989586621684466795"><span class="annot"><span class="annottext">Applicative ADM
Applicative ADM
-&gt; (forall a b. ADM a -&gt; (a -&gt; ADM b) -&gt; ADM b)
-&gt; (forall a b. ADM a -&gt; ADM b -&gt; ADM b)
-&gt; (forall a. a -&gt; ADM a)
-&gt; Monad ADM
forall a. a -&gt; ADM a
forall a b. ADM a -&gt; ADM b -&gt; ADM b
forall a b. ADM a -&gt; (a -&gt; ADM b) -&gt; ADM b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
return :: forall a. a -&gt; ADM a
$creturn :: forall a. a -&gt; ADM a
&gt;&gt; :: forall a b. ADM a -&gt; ADM b -&gt; ADM b
$c&gt;&gt; :: forall a b. ADM a -&gt; ADM b -&gt; ADM b
&gt;&gt;= :: forall a b. ADM a -&gt; (a -&gt; ADM b) -&gt; ADM b
$c&gt;&gt;= :: forall a b. ADM a -&gt; (a -&gt; ADM b) -&gt; ADM b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>      </span><span id="local-6989586621684466762"><span id="local-6989586621684466767"><span id="local-6989586621684466773"><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#RState"><span class="hs-identifier hs-type">RState</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>      </span><span id="local-6989586621684466742"><span id="local-6989586621684466748"><span class="annot"><span class="annottext">Monad ADM
Applicative ADM
ADM VNameSource
Applicative ADM
-&gt; Monad ADM
-&gt; ADM VNameSource
-&gt; (VNameSource -&gt; ADM ())
-&gt; MonadFreshNames ADM
VNameSource -&gt; ADM ()
forall (m :: * -&gt; *).
Applicative m
-&gt; Monad m
-&gt; m VNameSource
-&gt; (VNameSource -&gt; m ())
-&gt; MonadFreshNames m
putNameSource :: VNameSource -&gt; ADM ()
$cputNameSource :: VNameSource -&gt; ADM ()
getNameSource :: ADM VNameSource
$cgetNameSource :: ADM VNameSource
</span><a href="Futhark.MonadFreshNames.html#C%3AMonadFreshNames"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadFreshNames</span></a></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>      </span><span id="local-6989586621684466712"><span id="local-6989586621684466718"><span id="local-6989586621684466724"><span id="local-6989586621684466731"><span class="annot"><a href="Futhark.IR.Prop.Scope.html#HasScope"><span class="hs-identifier hs-type">HasScope</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>      </span><span id="local-6989586621684466696"><span class="annot"><a href="Futhark.IR.Prop.Scope.html#LocalScope"><span class="hs-identifier hs-type">LocalScope</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621684466669"><span id="local-6989586621684466673"><span class="annot"><a href="Futhark.Builder.Class.html#MonadBuilder"><span class="hs-identifier hs-type">MonadBuilder</span></a></span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Rep"><span class="annot"><a href="Futhark.Builder.Class.html#Rep"><span class="hs-identifier hs-var">Rep</span></a></span></span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span>
</span><span id="line-74"></span><span>  </span><span id="local-6989586621684466661"><span class="annot"><span class="annottext">mkExpDecM :: Pat (Rep ADM) -&gt; Exp (Rep ADM) -&gt; ADM (ExpDec (Rep ADM))
</span><a href="Futhark.Builder.Class.html#mkExpDecM"><span class="hs-identifier hs-var hs-var hs-var hs-var">mkExpDecM</span></a></span></span><span> </span><span id="local-6989586621684466659"><span class="annot"><span class="annottext">Pat (Rep ADM)
</span><a href="#local-6989586621684466659"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684466658"><span class="annot"><span class="annottext">Exp (Rep ADM)
</span><a href="#local-6989586621684466658"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuilderT SOACS (State RState) () -&gt; ADM ()
forall a. BuilderT SOACS (State RState) a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-var">ADM</span></a></span><span> </span><span class="annot"><span class="annottext">(BuilderT SOACS (State RState) () -&gt; ADM ())
-&gt; BuilderT SOACS (State RState) () -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat (Rep (BuilderT SOACS (State RState)))
-&gt; Exp (Rep (BuilderT SOACS (State RState)))
-&gt; BuilderT
     SOACS (State RState) (ExpDec (Rep (BuilderT SOACS (State RState))))
forall (m :: * -&gt; *).
MonadBuilder m =&gt;
Pat (Rep m) -&gt; Exp (Rep m) -&gt; m (ExpDec (Rep m))
</span><a href="Futhark.Builder.Class.html#mkExpDecM"><span class="hs-identifier hs-var">mkExpDecM</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (Rep (BuilderT SOACS (State RState)))
Pat (Rep ADM)
</span><a href="#local-6989586621684466659"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">Exp (Rep (BuilderT SOACS (State RState)))
Exp (Rep ADM)
</span><a href="#local-6989586621684466658"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-75"></span><span>  </span><span id="local-6989586621684466653"><span class="annot"><span class="annottext">mkBodyM :: Stms (Rep ADM) -&gt; [SubExpRes] -&gt; ADM (Body (Rep ADM))
</span><a href="Futhark.Builder.Class.html#mkBodyM"><span class="hs-identifier hs-var hs-var hs-var hs-var">mkBodyM</span></a></span></span><span> </span><span id="local-6989586621684466651"><span class="annot"><span class="annottext">Stms (Rep ADM)
</span><a href="#local-6989586621684466651"><span class="hs-identifier hs-var">bnds</span></a></span></span><span> </span><span id="local-6989586621684466650"><span class="annot"><span class="annottext">[SubExpRes]
</span><a href="#local-6989586621684466650"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuilderT SOACS (State RState) (Body SOACS) -&gt; ADM (Body SOACS)
forall a. BuilderT SOACS (State RState) a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-var">ADM</span></a></span><span> </span><span class="annot"><span class="annottext">(BuilderT SOACS (State RState) (Body SOACS) -&gt; ADM (Body SOACS))
-&gt; BuilderT SOACS (State RState) (Body SOACS) -&gt; ADM (Body SOACS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Stms (Rep (BuilderT SOACS (State RState)))
-&gt; [SubExpRes]
-&gt; BuilderT
     SOACS (State RState) (Body (Rep (BuilderT SOACS (State RState))))
forall (m :: * -&gt; *).
MonadBuilder m =&gt;
Stms (Rep m) -&gt; [SubExpRes] -&gt; m (Body (Rep m))
</span><a href="Futhark.Builder.Class.html#mkBodyM"><span class="hs-identifier hs-var">mkBodyM</span></a></span><span> </span><span class="annot"><span class="annottext">Stms (Rep (BuilderT SOACS (State RState)))
Stms (Rep ADM)
</span><a href="#local-6989586621684466651"><span class="hs-identifier hs-var">bnds</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExpRes]
</span><a href="#local-6989586621684466650"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-76"></span><span>  </span><span id="local-6989586621684466645"><span class="annot"><span class="annottext">mkLetNamesM :: [VName] -&gt; Exp (Rep ADM) -&gt; ADM (Stm (Rep ADM))
</span><a href="Futhark.Builder.Class.html#mkLetNamesM"><span class="hs-identifier hs-var hs-var hs-var hs-var">mkLetNamesM</span></a></span></span><span> </span><span id="local-6989586621684466643"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466643"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684466642"><span class="annot"><span class="annottext">Exp (Rep ADM)
</span><a href="#local-6989586621684466642"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuilderT SOACS (State RState) Stm -&gt; ADM Stm
forall a. BuilderT SOACS (State RState) a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-var">ADM</span></a></span><span> </span><span class="annot"><span class="annottext">(BuilderT SOACS (State RState) Stm -&gt; ADM Stm)
-&gt; BuilderT SOACS (State RState) Stm -&gt; ADM Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName]
-&gt; Exp (Rep (BuilderT SOACS (State RState)))
-&gt; BuilderT
     SOACS (State RState) (Stm (Rep (BuilderT SOACS (State RState))))
forall (m :: * -&gt; *).
MonadBuilder m =&gt;
[VName] -&gt; Exp (Rep m) -&gt; m (Stm (Rep m))
</span><a href="Futhark.Builder.Class.html#mkLetNamesM"><span class="hs-identifier hs-var">mkLetNamesM</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466643"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">Exp (Rep (BuilderT SOACS (State RState)))
Exp (Rep ADM)
</span><a href="#local-6989586621684466642"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span>  </span><span id="local-6989586621684466637"><span class="annot"><span class="annottext">addStms :: Stms (Rep ADM) -&gt; ADM ()
</span><a href="Futhark.Builder.Class.html#addStms"><span class="hs-identifier hs-var hs-var hs-var hs-var">addStms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuilderT SOACS (State RState) () -&gt; ADM ()
forall a. BuilderT SOACS (State RState) a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-var">ADM</span></a></span><span> </span><span class="annot"><span class="annottext">(BuilderT SOACS (State RState) () -&gt; ADM ())
-&gt; (Stms SOACS -&gt; BuilderT SOACS (State RState) ())
-&gt; Stms SOACS
-&gt; ADM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Stms SOACS -&gt; BuilderT SOACS (State RState) ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stms (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStms"><span class="hs-identifier hs-var">addStms</span></a></span><span>
</span><span id="line-79"></span><span>  </span><span id="local-6989586621684466630"><span class="annot"><span class="annottext">collectStms :: forall a. ADM a -&gt; ADM (a, Stms (Rep ADM))
</span><a href="Futhark.Builder.Class.html#collectStms"><span class="hs-identifier hs-var hs-var hs-var hs-var">collectStms</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span id="local-6989586621684466628"><span class="annot"><span class="annottext">BuilderT SOACS (State RState) a
</span><a href="#local-6989586621684466628"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuilderT SOACS (State RState) (a, Stms SOACS)
-&gt; ADM (a, Stms SOACS)
forall a. BuilderT SOACS (State RState) a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-var">ADM</span></a></span><span> </span><span class="annot"><span class="annottext">(BuilderT SOACS (State RState) (a, Stms SOACS)
 -&gt; ADM (a, Stms SOACS))
-&gt; BuilderT SOACS (State RState) (a, Stms SOACS)
-&gt; ADM (a, Stms SOACS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BuilderT SOACS (State RState) a
-&gt; BuilderT
     SOACS
     (State RState)
     (a, Stms (Rep (BuilderT SOACS (State RState))))
forall (m :: * -&gt; *) a.
MonadBuilder m =&gt;
m a -&gt; m (a, Stms (Rep m))
</span><a href="Futhark.Builder.Class.html#collectStms"><span class="hs-identifier hs-var">collectStms</span></a></span><span> </span><span class="annot"><span class="annottext">BuilderT SOACS (State RState) a
</span><a href="#local-6989586621684466628"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.MonadFreshNames.html#MonadFreshNames"><span class="hs-identifier hs-type">MonadFreshNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#RState"><span class="hs-identifier hs-type">RState</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-82"></span><span>  </span><span id="local-6989586621684466615"><span class="annot"><span class="annottext">getNameSource :: State RState VNameSource
</span><a href="Futhark.MonadFreshNames.html#getNameSource"><span class="hs-identifier hs-var hs-var hs-var hs-var">getNameSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RState -&gt; VNameSource) -&gt; State RState VNameSource
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">RState -&gt; VNameSource
</span><a href="Futhark.AD.Fwd.html#stateNameSource"><span class="hs-identifier hs-var hs-var">stateNameSource</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span id="local-6989586621684466610"><span class="annot"><span class="annottext">putNameSource :: VNameSource -&gt; State RState ()
</span><a href="Futhark.MonadFreshNames.html#putNameSource"><span class="hs-identifier hs-var hs-var hs-var hs-var">putNameSource</span></a></span></span><span> </span><span id="local-6989586621684466608"><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684466608"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RState -&gt; RState) -&gt; State RState ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621684466607"><span class="annot"><span class="annottext">RState
</span><a href="#local-6989586621684466607"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RState
</span><a href="#local-6989586621684466607"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">stateNameSource :: VNameSource
</span><a href="Futhark.AD.Fwd.html#stateNameSource"><span class="hs-identifier hs-var">stateNameSource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684466608"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span id="local-6989586621684467459"><span id="local-6989586621684467460"><span class="annot"><a href="Futhark.AD.Fwd.html#runADM"><span class="hs-identifier hs-type">runADM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.MonadFreshNames.html#MonadFreshNames"><span class="hs-identifier hs-type">MonadFreshNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467460"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467459"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621684467460"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467459"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-86"></span><span id="runADM"><span class="annot"><span class="annottext">runADM :: forall (m :: * -&gt; *) a. MonadFreshNames m =&gt; ADM a -&gt; m a
</span><a href="Futhark.AD.Fwd.html#runADM"><span class="hs-identifier hs-var hs-var">runADM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span id="local-6989586621684466595"><span class="annot"><span class="annottext">BuilderT SOACS (State RState) a
</span><a href="#local-6989586621684466595"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><span class="annottext">(VNameSource -&gt; (a, VNameSource)) -&gt; m a
forall (m :: * -&gt; *) a.
MonadFreshNames m =&gt;
(VNameSource -&gt; (a, VNameSource)) -&gt; m a
</span><a href="Futhark.MonadFreshNames.html#modifyNameSource"><span class="hs-identifier hs-var">modifyNameSource</span></a></span><span> </span><span class="annot"><span class="annottext">((VNameSource -&gt; (a, VNameSource)) -&gt; m a)
-&gt; (VNameSource -&gt; (a, VNameSource)) -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684466593"><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684466593"><span class="hs-identifier hs-var">vn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><span class="annottext">(RState -&gt; VNameSource) -&gt; (a, RState) -&gt; (a, VNameSource)
forall (p :: * -&gt; * -&gt; *) b c a.
Bifunctor p =&gt;
(b -&gt; c) -&gt; p a b -&gt; p a c
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="annot"><span class="annottext">RState -&gt; VNameSource
</span><a href="Futhark.AD.Fwd.html#stateNameSource"><span class="hs-identifier hs-var hs-var">stateNameSource</span></a></span><span> </span><span class="annot"><span class="annottext">((a, RState) -&gt; (a, VNameSource))
-&gt; (a, RState) -&gt; (a, VNameSource)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-89"></span><span>      </span><span class="annot"><span class="annottext">State RState a -&gt; RState -&gt; (a, RState)
forall s a. State s a -&gt; s -&gt; (a, s)
</span><span class="hs-identifier hs-var">runState</span></span><span>
</span><span id="line-90"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a, Stms SOACS) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((a, Stms SOACS) -&gt; a)
-&gt; State RState (a, Stms SOACS) -&gt; State RState a
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">BuilderT SOACS (State RState) a
-&gt; Scope SOACS -&gt; State RState (a, Stms SOACS)
forall (m :: * -&gt; *) rep a.
MonadFreshNames m =&gt;
BuilderT rep m a -&gt; Scope rep -&gt; m (a, Stms rep)
</span><a href="Futhark.Builder.html#runBuilderT"><span class="hs-identifier hs-var">runBuilderT</span></a></span><span> </span><span class="annot"><span class="annottext">BuilderT SOACS (State RState) a
</span><a href="#local-6989586621684466595"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Scope SOACS
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map VName VName -&gt; VNameSource -&gt; RState
</span><a href="Futhark.AD.Fwd.html#RState"><span class="hs-identifier hs-var">RState</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684466593"><span class="hs-identifier hs-var">vn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="annot"><a href="Futhark.AD.Fwd.html#tanVName"><span class="hs-identifier hs-type">tanVName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span>
</span><span id="line-94"></span><span id="tanVName"><span class="annot"><span class="annottext">tanVName :: VName -&gt; ADM VName
</span><a href="Futhark.AD.Fwd.html#tanVName"><span class="hs-identifier hs-var hs-var">tanVName</span></a></span></span><span> </span><span id="local-6989586621684466588"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466588"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ADM VName
forall (m :: * -&gt; *). MonadFreshNames m =&gt; [Char] -&gt; m VName
</span><a href="Futhark.MonadFreshNames.html#newVName"><span class="hs-identifier hs-var">newVName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; [Char]
</span><a href="Language.Futhark.Core.html#baseString"><span class="hs-identifier hs-var">baseString</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466588"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;_tan&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="annot"><a href="Futhark.AD.Fwd.html#insertTan"><span class="hs-identifier hs-type">insertTan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span id="insertTan"><span class="annot"><span class="annottext">insertTan :: VName -&gt; VName -&gt; ADM ()
</span><a href="Futhark.AD.Fwd.html#insertTan"><span class="hs-identifier hs-var hs-var">insertTan</span></a></span></span><span> </span><span id="local-6989586621684466584"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466584"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621684466583"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466583"><span class="hs-identifier hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><span class="annottext">(RState -&gt; RState) -&gt; ADM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((RState -&gt; RState) -&gt; ADM ()) -&gt; (RState -&gt; RState) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684466582"><span class="annot"><span class="annottext">RState
</span><a href="#local-6989586621684466582"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RState
</span><a href="#local-6989586621684466582"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">stateTans :: Map VName VName
</span><a href="Futhark.AD.Fwd.html#stateTans"><span class="hs-identifier hs-var">stateTans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; VName -&gt; Map VName VName -&gt; Map VName VName
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466584"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466583"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RState -&gt; Map VName VName
</span><a href="Futhark.AD.Fwd.html#stateTans"><span class="hs-identifier hs-var hs-var">stateTans</span></a></span><span> </span><span class="annot"><span class="annottext">RState
</span><a href="#local-6989586621684466582"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-keyword">class</span><span> </span><span id="TanBuilder"><span class="annot"><a href="Futhark.AD.Fwd.html#TanBuilder"><span class="hs-identifier hs-var">TanBuilder</span></a></span></span><span> </span><span id="local-6989586621684467431"><span class="annot"><a href="#local-6989586621684467431"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Bundled"><span class="annot"><a href="Futhark.AD.Fwd.html#Bundled"><span class="hs-identifier hs-var">Bundled</span></a></span></span><span> </span><span id="local-6989586621684467431"><span class="annot"><a href="#local-6989586621684467431"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Data.Kind.Type</span></span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Bundled"><span class="annot"><a href="Futhark.AD.Fwd.html#Bundled"><span class="hs-identifier hs-var">Bundled</span></a></span></span><span> </span><span id="local-6989586621684466580"><span class="annot"><a href="#local-6989586621684466580"><span class="hs-identifier hs-type hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621684466580"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-103"></span><span>  </span><span id="newTan"><span class="annot"><a href="Futhark.AD.Fwd.html#newTan"><span class="hs-identifier hs-type">newTan</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621684467431"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467431"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span id="bundleNew"><span class="annot"><a href="Futhark.AD.Fwd.html#bundleNew"><span class="hs-identifier hs-type">bundleNew</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621684467431"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.AD.Fwd.html#Bundled"><span class="hs-identifier hs-type">Bundled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467431"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span id="local-6989586621684467600"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.AD.Fwd.html#Bundled"><span class="hs-identifier hs-type">Bundled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467600"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#TanBuilder"><span class="hs-identifier hs-type">TanBuilder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467600"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#TanBuilder"><span class="hs-identifier hs-type">TanBuilder</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621684467600"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Bundled"><span class="annot"><a href="Futhark.AD.Fwd.html#Bundled"><span class="hs-identifier hs-var">Bundled</span></a></span></span><span> </span><span id="local-6989586621684467600"><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621684467600"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#Bundled"><span class="hs-identifier hs-type">Bundled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467600"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span id="local-6989586621684466568"><span class="annot"><span class="annottext">newTan :: [a] -&gt; ADM [a]
</span><a href="#local-6989586621684466568"><span class="hs-identifier hs-var hs-var hs-var hs-var">newTan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; ADM a) -&gt; [a] -&gt; ADM [a]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; ADM a
forall a. TanBuilder a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#newTan"><span class="hs-identifier hs-var">newTan</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span id="local-6989586621684466562"><span class="annot"><span class="annottext">bundleNew :: [a] -&gt; ADM (Bundled [a])
</span><a href="#local-6989586621684466562"><span class="hs-identifier hs-var hs-var hs-var hs-var">bundleNew</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Bundled a] -&gt; Bundled a) -&gt; ADM [Bundled a] -&gt; ADM (Bundled a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[Bundled a] -&gt; Bundled a
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">(ADM [Bundled a] -&gt; ADM (Bundled a))
-&gt; ([a] -&gt; ADM [Bundled a]) -&gt; [a] -&gt; ADM (Bundled a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; ADM (Bundled a)) -&gt; [a] -&gt; ADM [Bundled a]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; ADM (Bundled a)
forall a. TanBuilder a =&gt; a -&gt; ADM (Bundled a)
</span><a href="Futhark.AD.Fwd.html#bundleNew"><span class="hs-identifier hs-var">bundleNew</span></a></span></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span id="local-6989586621684467601"><span id="local-6989586621684467602"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#TanBuilder"><span class="hs-identifier hs-type">TanBuilder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#PatElemT"><span class="hs-identifier hs-type">PatElemT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467602"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467601"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-112"></span><span>  </span><span id="local-6989586621684466552"><span class="annot"><span class="annottext">newTan :: PatElemT (TypeBase s u) -&gt; ADM (PatElemT (TypeBase s u))
</span><a href="#local-6989586621684466552"><span class="hs-identifier hs-var hs-var hs-var hs-var">newTan</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#PatElem"><span class="hs-identifier hs-type">PatElem</span></a></span><span> </span><span id="local-6989586621684466550"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466550"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621684466549"><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466549"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TypeBase s u -&gt; Bool
forall s u. TypeBase s u -&gt; Bool
</span><a href="Futhark.AD.Fwd.html#isAcc"><span class="hs-identifier hs-var">isAcc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466549"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-114"></span><span>      </span><span class="annot"><span class="annottext">VName -&gt; VName -&gt; ADM ()
</span><a href="Futhark.AD.Fwd.html#insertTan"><span class="hs-identifier hs-var">insertTan</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466550"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466550"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-115"></span><span>      </span><span id="local-6989586621684466548"><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466548"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase s u -&gt; ADM (TypeBase s u)
forall s u. TypeBase s u -&gt; ADM (TypeBase s u)
</span><a href="Futhark.AD.Fwd.html#tanType"><span class="hs-identifier hs-var">tanType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466549"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-116"></span><span>      </span><span class="annot"><span class="annottext">PatElemT (TypeBase s u) -&gt; ADM (PatElemT (TypeBase s u))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PatElemT (TypeBase s u) -&gt; ADM (PatElemT (TypeBase s u)))
-&gt; PatElemT (TypeBase s u) -&gt; ADM (PatElemT (TypeBase s u))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; TypeBase s u -&gt; PatElemT (TypeBase s u)
forall dec. VName -&gt; dec -&gt; PatElemT dec
</span><a href="Futhark.IR.Syntax.Core.html#PatElem"><span class="hs-identifier hs-var">PatElem</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466550"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466548"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-118"></span><span>      </span><span id="local-6989586621684466547"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466547"><span class="hs-identifier hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; ADM VName
</span><a href="Futhark.AD.Fwd.html#tanVName"><span class="hs-identifier hs-var">tanVName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466550"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-119"></span><span>      </span><span class="annot"><span class="annottext">VName -&gt; VName -&gt; ADM ()
</span><a href="Futhark.AD.Fwd.html#insertTan"><span class="hs-identifier hs-var">insertTan</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466550"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466547"><span class="hs-identifier hs-var">p'</span></a></span><span>
</span><span id="line-120"></span><span>      </span><span id="local-6989586621684466546"><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466546"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase s u -&gt; ADM (TypeBase s u)
forall s u. TypeBase s u -&gt; ADM (TypeBase s u)
</span><a href="Futhark.AD.Fwd.html#tanType"><span class="hs-identifier hs-var">tanType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466549"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-121"></span><span>      </span><span class="annot"><span class="annottext">PatElemT (TypeBase s u) -&gt; ADM (PatElemT (TypeBase s u))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PatElemT (TypeBase s u) -&gt; ADM (PatElemT (TypeBase s u)))
-&gt; PatElemT (TypeBase s u) -&gt; ADM (PatElemT (TypeBase s u))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; TypeBase s u -&gt; PatElemT (TypeBase s u)
forall dec. VName -&gt; dec -&gt; PatElemT dec
</span><a href="Futhark.IR.Syntax.Core.html#PatElem"><span class="hs-identifier hs-var">PatElem</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466547"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466546"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-122"></span><span>  </span><span id="local-6989586621684466541"><span class="annot"><span class="annottext">bundleNew :: PatElemT (TypeBase s u) -&gt; ADM (Bundled (PatElemT (TypeBase s u)))
</span><a href="#local-6989586621684466541"><span class="hs-identifier hs-var hs-var hs-var hs-var">bundleNew</span></a></span></span><span> </span><span id="local-6989586621684466540"><span class="annot"><span class="annottext">pe :: PatElemT (TypeBase s u)
</span><a href="#local-6989586621684466540"><span class="hs-identifier hs-var">pe</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#PatElem"><span class="hs-identifier hs-type">PatElem</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684466539"><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466539"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-123"></span><span>    </span><span id="local-6989586621684466538"><span class="annot"><span class="annottext">PatElemT (TypeBase s u)
</span><a href="#local-6989586621684466538"><span class="hs-identifier hs-var">pe'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatElemT (TypeBase s u) -&gt; ADM (PatElemT (TypeBase s u))
forall a. TanBuilder a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#newTan"><span class="hs-identifier hs-var">newTan</span></a></span><span> </span><span class="annot"><span class="annottext">PatElemT (TypeBase s u)
</span><a href="#local-6989586621684466540"><span class="hs-identifier hs-var">pe</span></a></span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TypeBase s u -&gt; Bool
forall s u. TypeBase s u -&gt; Bool
</span><a href="Futhark.AD.Fwd.html#isAcc"><span class="hs-identifier hs-var">isAcc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466539"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-125"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[PatElemT (TypeBase s u)] -&gt; ADM [PatElemT (TypeBase s u)]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PatElemT (TypeBase s u)
</span><a href="#local-6989586621684466538"><span class="hs-identifier hs-var">pe'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-126"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[PatElemT (TypeBase s u)] -&gt; ADM [PatElemT (TypeBase s u)]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PatElemT (TypeBase s u)
</span><a href="#local-6989586621684466540"><span class="hs-identifier hs-var">pe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PatElemT (TypeBase s u)
</span><a href="#local-6989586621684466538"><span class="hs-identifier hs-var">pe'</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span id="local-6989586621684467603"><span id="local-6989586621684467604"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#TanBuilder"><span class="hs-identifier hs-type">TanBuilder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#PatT"><span class="hs-identifier hs-type">PatT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467604"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467603"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Bundled"><span class="annot"><a href="Futhark.AD.Fwd.html#Bundled"><span class="hs-identifier hs-var">Bundled</span></a></span></span><span> </span><span id="local-6989586621684467603"><span id="local-6989586621684467604"><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#PatT"><span class="hs-identifier hs-type">PatT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467604"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467603"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#PatT"><span class="hs-identifier hs-type">PatT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467604"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467603"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>  </span><span id="local-6989586621684466530"><span class="annot"><span class="annottext">newTan :: PatT (TypeBase s u) -&gt; ADM (PatT (TypeBase s u))
</span><a href="#local-6989586621684466530"><span class="hs-identifier hs-var hs-var hs-var hs-var">newTan</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span id="local-6989586621684466528"><span class="annot"><span class="annottext">[PatElemT (TypeBase s u)]
</span><a href="#local-6989586621684466528"><span class="hs-identifier hs-var">pes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PatElemT (TypeBase s u)] -&gt; PatT (TypeBase s u)
forall dec. [PatElemT dec] -&gt; PatT dec
</span><a href="Futhark.IR.Syntax.html#Pat"><span class="hs-identifier hs-var">Pat</span></a></span><span> </span><span class="annot"><span class="annottext">([PatElemT (TypeBase s u)] -&gt; PatT (TypeBase s u))
-&gt; ADM [PatElemT (TypeBase s u)] -&gt; ADM (PatT (TypeBase s u))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[PatElemT (TypeBase s u)] -&gt; ADM [PatElemT (TypeBase s u)]
forall a. TanBuilder a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#newTan"><span class="hs-identifier hs-var">newTan</span></a></span><span> </span><span class="annot"><span class="annottext">[PatElemT (TypeBase s u)]
</span><a href="#local-6989586621684466528"><span class="hs-identifier hs-var">pes</span></a></span><span>
</span><span id="line-131"></span><span>  </span><span id="local-6989586621684466522"><span class="annot"><span class="annottext">bundleNew :: PatT (TypeBase s u) -&gt; ADM (Bundled (PatT (TypeBase s u)))
</span><a href="#local-6989586621684466522"><span class="hs-identifier hs-var hs-var hs-var hs-var">bundleNew</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span id="local-6989586621684466521"><span class="annot"><span class="annottext">[PatElemT (TypeBase s u)]
</span><a href="#local-6989586621684466521"><span class="hs-identifier hs-var">pes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PatElemT (TypeBase s u)] -&gt; PatT (TypeBase s u)
forall dec. [PatElemT dec] -&gt; PatT dec
</span><a href="Futhark.IR.Syntax.html#Pat"><span class="hs-identifier hs-var">Pat</span></a></span><span> </span><span class="annot"><span class="annottext">([PatElemT (TypeBase s u)] -&gt; PatT (TypeBase s u))
-&gt; ADM [PatElemT (TypeBase s u)] -&gt; ADM (PatT (TypeBase s u))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[PatElemT (TypeBase s u)]
-&gt; ADM (Bundled [PatElemT (TypeBase s u)])
forall a. TanBuilder a =&gt; a -&gt; ADM (Bundled a)
</span><a href="Futhark.AD.Fwd.html#bundleNew"><span class="hs-identifier hs-var">bundleNew</span></a></span><span> </span><span class="annot"><span class="annottext">[PatElemT (TypeBase s u)]
</span><a href="#local-6989586621684466521"><span class="hs-identifier hs-var">pes</span></a></span></span></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span id="local-6989586621684467605"><span id="local-6989586621684467606"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#TanBuilder"><span class="hs-identifier hs-type">TanBuilder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Param"><span class="hs-identifier hs-type">Param</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467606"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467605"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-134"></span><span>  </span><span id="local-6989586621684466513"><span class="annot"><span class="annottext">newTan :: Param (TypeBase s u) -&gt; ADM (Param (TypeBase s u))
</span><a href="#local-6989586621684466513"><span class="hs-identifier hs-var hs-var hs-var hs-var">newTan</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Param"><span class="hs-identifier hs-type">Param</span></a></span><span> </span><span class="annot"><span class="annottext">Attrs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684466511"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466511"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621684466510"><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466510"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#PatElem"><span class="hs-identifier hs-type">PatElem</span></a></span><span> </span><span id="local-6989586621684466509"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466509"><span class="hs-identifier hs-var">p'</span></a></span></span><span> </span><span id="local-6989586621684466508"><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466508"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatElemT (TypeBase s u) -&gt; ADM (PatElemT (TypeBase s u))
forall a. TanBuilder a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#newTan"><span class="hs-identifier hs-var">newTan</span></a></span><span> </span><span class="annot"><span class="annottext">(PatElemT (TypeBase s u) -&gt; ADM (PatElemT (TypeBase s u)))
-&gt; PatElemT (TypeBase s u) -&gt; ADM (PatElemT (TypeBase s u))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; TypeBase s u -&gt; PatElemT (TypeBase s u)
forall dec. VName -&gt; dec -&gt; PatElemT dec
</span><a href="Futhark.IR.Syntax.Core.html#PatElem"><span class="hs-identifier hs-var">PatElem</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466511"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466510"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><span class="annottext">Param (TypeBase s u) -&gt; ADM (Param (TypeBase s u))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Param (TypeBase s u) -&gt; ADM (Param (TypeBase s u)))
-&gt; Param (TypeBase s u) -&gt; ADM (Param (TypeBase s u))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Attrs -&gt; VName -&gt; TypeBase s u -&gt; Param (TypeBase s u)
forall dec. Attrs -&gt; VName -&gt; dec -&gt; Param dec
</span><a href="Futhark.IR.Syntax.Core.html#Param"><span class="hs-identifier hs-var">Param</span></a></span><span> </span><span class="annot"><span class="annottext">Attrs
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466509"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466508"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span id="local-6989586621684466502"><span class="annot"><span class="annottext">bundleNew :: Param (TypeBase s u) -&gt; ADM (Bundled (Param (TypeBase s u)))
</span><a href="#local-6989586621684466502"><span class="hs-identifier hs-var hs-var hs-var hs-var">bundleNew</span></a></span></span><span> </span><span id="local-6989586621684466501"><span class="annot"><span class="annottext">param :: Param (TypeBase s u)
</span><a href="#local-6989586621684466501"><span class="hs-identifier hs-var">param</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Param"><span class="hs-identifier hs-type">Param</span></a></span><span> </span><span class="annot"><span class="annottext">Attrs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Primitive.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><span class="annottext">[Param (TypeBase s u)] -&gt; ADM [Param (TypeBase s u)]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Param (TypeBase s u)
</span><a href="#local-6989586621684466501"><span class="hs-identifier hs-var">param</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-139"></span><span>  </span><span class="annot"><a href="Futhark.AD.Fwd.html#bundleNew"><span class="hs-identifier hs-var">bundleNew</span></a></span><span> </span><span id="local-6989586621684466499"><span class="annot"><span class="annottext">param :: Param (TypeBase s u)
</span><a href="#local-6989586621684466499"><span class="hs-identifier hs-var">param</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Param"><span class="hs-identifier hs-type">Param</span></a></span><span> </span><span class="annot"><span class="annottext">Attrs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684466498"><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466498"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-140"></span><span>    </span><span id="local-6989586621684466497"><span class="annot"><span class="annottext">Param (TypeBase s u)
</span><a href="#local-6989586621684466497"><span class="hs-identifier hs-var">param'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Param (TypeBase s u) -&gt; ADM (Param (TypeBase s u))
forall a. TanBuilder a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#newTan"><span class="hs-identifier hs-var">newTan</span></a></span><span> </span><span class="annot"><span class="annottext">Param (TypeBase s u)
</span><a href="#local-6989586621684466499"><span class="hs-identifier hs-var">param</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TypeBase s u -&gt; Bool
forall s u. TypeBase s u -&gt; Bool
</span><a href="Futhark.AD.Fwd.html#isAcc"><span class="hs-identifier hs-var">isAcc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466498"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-142"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Param (TypeBase s u)] -&gt; ADM [Param (TypeBase s u)]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Param (TypeBase s u)
</span><a href="#local-6989586621684466497"><span class="hs-identifier hs-var">param'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-143"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Param (TypeBase s u)] -&gt; ADM [Param (TypeBase s u)]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Param (TypeBase s u)
</span><a href="#local-6989586621684466499"><span class="hs-identifier hs-var">param</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Param (TypeBase s u)
</span><a href="#local-6989586621684466497"><span class="hs-identifier hs-var">param'</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span id="local-6989586621684467594"><span id="local-6989586621684467595"><span id="local-6989586621684467596"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#Tangent"><span class="hs-identifier hs-type">Tangent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467596"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#TanBuilder"><span class="hs-identifier hs-type">TanBuilder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Param"><span class="hs-identifier hs-type">Param</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467595"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467594"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621684467596"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-146"></span><span>  </span><span id="local-6989586621684466489"><span class="annot"><span class="annottext">newTan :: (Param (TypeBase s u), a) -&gt; ADM (Param (TypeBase s u), a)
</span><a href="#local-6989586621684466489"><span class="hs-identifier hs-var hs-var hs-var hs-var">newTan</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684466488"><span class="annot"><span class="annottext">Param (TypeBase s u)
</span><a href="#local-6989586621684466488"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684466487"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684466487"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Param (TypeBase s u) -&gt; a -&gt; (Param (TypeBase s u), a))
-&gt; ADM (Param (TypeBase s u))
-&gt; ADM (a -&gt; (Param (TypeBase s u), a))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Param (TypeBase s u) -&gt; ADM (Param (TypeBase s u))
forall a. TanBuilder a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#newTan"><span class="hs-identifier hs-var">newTan</span></a></span><span> </span><span class="annot"><span class="annottext">Param (TypeBase s u)
</span><a href="#local-6989586621684466488"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">ADM (a -&gt; (Param (TypeBase s u), a))
-&gt; ADM a -&gt; ADM (Param (TypeBase s u), a)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; ADM a
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684466487"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-147"></span><span>  </span><span id="local-6989586621684466480"><span class="annot"><span class="annottext">bundleNew :: (Param (TypeBase s u), a)
-&gt; ADM (Bundled (Param (TypeBase s u), a))
</span><a href="#local-6989586621684466480"><span class="hs-identifier hs-var hs-var hs-var hs-var">bundleNew</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684466479"><span class="annot"><span class="annottext">Param (TypeBase s u)
</span><a href="#local-6989586621684466479"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684466478"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684466478"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-148"></span><span>    </span><span id="local-6989586621684466477"><span class="annot"><span class="annottext">[Param (TypeBase s u)]
</span><a href="#local-6989586621684466477"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Param (TypeBase s u) -&gt; ADM (Bundled (Param (TypeBase s u)))
forall a. TanBuilder a =&gt; a -&gt; ADM (Bundled a)
</span><a href="Futhark.AD.Fwd.html#bundleNew"><span class="hs-identifier hs-var">bundleNew</span></a></span><span> </span><span class="annot"><span class="annottext">Param (TypeBase s u)
</span><a href="#local-6989586621684466479"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span id="local-6989586621684466476"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684466476"><span class="hs-identifier hs-var">x_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; ADM a
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684466478"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><span class="annottext">[(Param (TypeBase s u), a)] -&gt; ADM [(Param (TypeBase s u), a)]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([(Param (TypeBase s u), a)] -&gt; ADM [(Param (TypeBase s u), a)])
-&gt; [(Param (TypeBase s u), a)] -&gt; ADM [(Param (TypeBase s u), a)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Param (TypeBase s u)] -&gt; [a] -&gt; [(Param (TypeBase s u), a)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Param (TypeBase s u)]
</span><a href="#local-6989586621684466477"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684466478"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684466476"><span class="hs-identifier hs-var">x_tan</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-keyword">class</span><span> </span><span id="Tangent"><span class="annot"><a href="Futhark.AD.Fwd.html#Tangent"><span class="hs-identifier hs-var">Tangent</span></a></span></span><span> </span><span id="local-6989586621684467415"><span class="annot"><a href="#local-6989586621684467415"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="BundledTan"><span class="annot"><a href="Futhark.AD.Fwd.html#BundledTan"><span class="hs-identifier hs-var">BundledTan</span></a></span></span><span> </span><span id="local-6989586621684467415"><span class="annot"><a href="#local-6989586621684467415"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Data.Kind.Type</span></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="BundledTan"><span class="annot"><a href="Futhark.AD.Fwd.html#BundledTan"><span class="hs-identifier hs-var">BundledTan</span></a></span></span><span> </span><span id="local-6989586621684466475"><span class="annot"><a href="#local-6989586621684466475"><span class="hs-identifier hs-type hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621684466475"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-155"></span><span>  </span><span id="tangent"><span class="annot"><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-type">tangent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621684467415"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467415"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-156"></span><span>  </span><span id="bundleTan"><span class="annot"><a href="Futhark.AD.Fwd.html#bundleTan"><span class="hs-identifier hs-type">bundleTan</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621684467415"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.AD.Fwd.html#BundledTan"><span class="hs-identifier hs-type">BundledTan</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467415"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span id="local-6989586621684467597"><span id="local-6989586621684467598"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#Tangent"><span class="hs-identifier hs-type">Tangent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467598"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467597"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-159"></span><span>  </span><span id="local-6989586621684466470"><span class="annot"><span class="annottext">tangent :: TypeBase s u -&gt; ADM (TypeBase s u)
</span><a href="#local-6989586621684466470"><span class="hs-identifier hs-var hs-var hs-var hs-var">tangent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase s u -&gt; ADM (TypeBase s u)
forall s u. TypeBase s u -&gt; ADM (TypeBase s u)
</span><a href="Futhark.AD.Fwd.html#tanType"><span class="hs-identifier hs-var">tanType</span></a></span><span>
</span><span id="line-160"></span><span>  </span><span id="local-6989586621684466463"><span class="annot"><span class="annottext">bundleTan :: TypeBase s u -&gt; ADM (BundledTan (TypeBase s u))
</span><a href="#local-6989586621684466463"><span class="hs-identifier hs-var hs-var hs-var hs-var">bundleTan</span></a></span></span><span> </span><span id="local-6989586621684466462"><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466462"><span class="hs-identifier hs-var">t</span></a></span></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TypeBase s u -&gt; Bool
forall s u. TypeBase s u -&gt; Bool
</span><a href="Futhark.AD.Fwd.html#isAcc"><span class="hs-identifier hs-var">isAcc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466462"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-162"></span><span>      </span><span id="local-6989586621684466461"><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466461"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase s u -&gt; ADM (TypeBase s u)
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466462"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-163"></span><span>      </span><span class="annot"><span class="annottext">[TypeBase s u] -&gt; ADM [TypeBase s u]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466461"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-165"></span><span>      </span><span id="local-6989586621684466460"><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466460"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase s u -&gt; ADM (TypeBase s u)
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466462"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-166"></span><span>      </span><span class="annot"><span class="annottext">[TypeBase s u] -&gt; ADM [TypeBase s u]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466462"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBase s u
</span><a href="#local-6989586621684466460"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span id="local-6989586621684467599"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.AD.Fwd.html#BundledTan"><span class="hs-identifier hs-type">BundledTan</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467599"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#Tangent"><span class="hs-identifier hs-type">Tangent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467599"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#Tangent"><span class="hs-identifier hs-type">Tangent</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621684467599"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="BundledTan"><span class="annot"><a href="Futhark.AD.Fwd.html#BundledTan"><span class="hs-identifier hs-var">BundledTan</span></a></span></span><span> </span><span id="local-6989586621684467599"><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621684467599"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#BundledTan"><span class="hs-identifier hs-type">BundledTan</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467599"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-170"></span><span>  </span><span id="local-6989586621684466451"><span class="annot"><span class="annottext">tangent :: [a] -&gt; ADM [a]
</span><a href="#local-6989586621684466451"><span class="hs-identifier hs-var hs-var hs-var hs-var">tangent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; ADM a) -&gt; [a] -&gt; ADM [a]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; ADM a
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span>
</span><span id="line-171"></span><span>  </span><span id="local-6989586621684466445"><span class="annot"><span class="annottext">bundleTan :: [a] -&gt; ADM (BundledTan [a])
</span><a href="#local-6989586621684466445"><span class="hs-identifier hs-var hs-var hs-var hs-var">bundleTan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[BundledTan a] -&gt; BundledTan a
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([BundledTan a] -&gt; BundledTan a)
-&gt; ADM [BundledTan a] -&gt; ADM (BundledTan a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ADM [BundledTan a] -&gt; ADM (BundledTan a))
-&gt; ([a] -&gt; ADM [BundledTan a]) -&gt; [a] -&gt; ADM (BundledTan a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; ADM (BundledTan a)) -&gt; [a] -&gt; ADM [BundledTan a]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; ADM (BundledTan a)
forall a. Tangent a =&gt; a -&gt; ADM (BundledTan a)
</span><a href="Futhark.AD.Fwd.html#bundleTan"><span class="hs-identifier hs-var">bundleTan</span></a></span></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#Tangent"><span class="hs-identifier hs-type">Tangent</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-174"></span><span>  </span><span id="local-6989586621684466433"><span class="annot"><span class="annottext">tangent :: VName -&gt; ADM VName
</span><a href="#local-6989586621684466433"><span class="hs-identifier hs-var hs-var hs-var hs-var">tangent</span></a></span></span><span> </span><span id="local-6989586621684466432"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466432"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-175"></span><span>    </span><span id="local-6989586621684466431"><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684466431"><span class="hs-identifier hs-var">maybeTan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(RState -&gt; Maybe VName) -&gt; ADM (Maybe VName)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">((RState -&gt; Maybe VName) -&gt; ADM (Maybe VName))
-&gt; (RState -&gt; Maybe VName) -&gt; ADM (Maybe VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Map VName VName -&gt; Maybe VName
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466432"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(Map VName VName -&gt; Maybe VName)
-&gt; (RState -&gt; Map VName VName) -&gt; RState -&gt; Maybe VName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RState -&gt; Map VName VName
</span><a href="Futhark.AD.Fwd.html#stateTans"><span class="hs-identifier hs-var hs-var">stateTans</span></a></span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684466431"><span class="hs-identifier hs-var">maybeTan</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-177"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684466429"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466429"><span class="hs-identifier hs-var">v_tan</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VName -&gt; ADM VName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466429"><span class="hs-identifier hs-var">v_tan</span></a></span><span>
</span><span id="line-178"></span><span>      </span><span class="annot"><span class="annottext">Maybe VName
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-179"></span><span>        </span><span id="local-6989586621684466428"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621684466428"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; ADM Type
forall rep (m :: * -&gt; *). HasScope rep m =&gt; VName -&gt; m Type
</span><a href="Futhark.IR.Prop.Scope.html#lookupType"><span class="hs-identifier hs-var">lookupType</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466432"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-180"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Exp (Rep ADM) -&gt; ADM VName
forall (m :: * -&gt; *).
MonadBuilder m =&gt;
[Char] -&gt; Exp (Rep m) -&gt; m VName
</span><a href="Futhark.Construct.html#letExp"><span class="hs-identifier hs-var">letExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; [Char]
</span><a href="Language.Futhark.Core.html#baseString"><span class="hs-identifier hs-var">baseString</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466432"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;_implicit_tan&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp (Rep ADM) -&gt; ADM VName) -&gt; Exp (Rep ADM) -&gt; ADM VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Exp
</span><a href="Futhark.AD.Fwd.html#zeroExp"><span class="hs-identifier hs-var">zeroExp</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621684466428"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-181"></span><span>  </span><span id="local-6989586621684466419"><span class="annot"><span class="annottext">bundleTan :: VName -&gt; ADM (BundledTan VName)
</span><a href="#local-6989586621684466419"><span class="hs-identifier hs-var hs-var hs-var hs-var">bundleTan</span></a></span></span><span> </span><span id="local-6989586621684466418"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466418"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-182"></span><span>    </span><span id="local-6989586621684466417"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621684466417"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; ADM Type
forall rep (m :: * -&gt; *). HasScope rep m =&gt; VName -&gt; m Type
</span><a href="Futhark.IR.Prop.Scope.html#lookupType"><span class="hs-identifier hs-var">lookupType</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466418"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
forall s u. TypeBase s u -&gt; Bool
</span><a href="Futhark.AD.Fwd.html#isAcc"><span class="hs-identifier hs-var">isAcc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621684466417"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-184"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; ADM [VName]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466418"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-185"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-186"></span><span>        </span><span id="local-6989586621684466416"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466416"><span class="hs-identifier hs-var">v_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; ADM VName
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466418"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-187"></span><span>        </span><span class="annot"><span class="annottext">[VName] -&gt; ADM [VName]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466418"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466416"><span class="hs-identifier hs-var">v_tan</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#Tangent"><span class="hs-identifier hs-type">Tangent</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-190"></span><span>  </span><span id="local-6989586621684466411"><span class="annot"><span class="annottext">tangent :: SubExp -&gt; ADM SubExp
</span><a href="#local-6989586621684466411"><span class="hs-identifier hs-var hs-var hs-var hs-var">tangent</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span> </span><span id="local-6989586621684466410"><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684466410"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ADM SubExp
</span><a href="Futhark.AD.Fwd.html#zeroTan"><span class="hs-identifier hs-var">zeroTan</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; ADM SubExp) -&gt; Type -&gt; ADM SubExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; Type
forall shape u. PrimType -&gt; TypeBase shape u
</span><a href="Futhark.IR.Syntax.Core.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimType -&gt; Type) -&gt; PrimType -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimValue -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#primValueType"><span class="hs-identifier hs-var">primValueType</span></a></span><span> </span><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684466410"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-191"></span><span>  </span><span class="annot"><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684466407"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466407"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; SubExp
</span><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; SubExp) -&gt; ADM VName -&gt; ADM SubExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; ADM VName
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466407"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-192"></span><span>  </span><span id="local-6989586621684466399"><span class="annot"><span class="annottext">bundleTan :: SubExp -&gt; ADM (BundledTan SubExp)
</span><a href="#local-6989586621684466399"><span class="hs-identifier hs-var hs-var hs-var hs-var">bundleTan</span></a></span></span><span> </span><span id="local-6989586621684466398"><span class="annot"><span class="annottext">c :: SubExp
</span><a href="#local-6989586621684466398"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621684466397"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466397"><span class="hs-identifier hs-var">c_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; ADM SubExp
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466398"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><span class="annottext">[SubExp] -&gt; ADM [SubExp]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466398"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466397"><span class="hs-identifier hs-var">c_tan</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-195"></span><span>  </span><span class="annot"><a href="Futhark.AD.Fwd.html#bundleTan"><span class="hs-identifier hs-var">bundleTan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684466396"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466396"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; SubExp) -&gt; [VName] -&gt; [SubExp]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; SubExp
</span><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; [SubExp]) -&gt; ADM [VName] -&gt; ADM [SubExp]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; ADM (BundledTan VName)
forall a. Tangent a =&gt; a -&gt; ADM (BundledTan a)
</span><a href="Futhark.AD.Fwd.html#bundleTan"><span class="hs-identifier hs-var">bundleTan</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466396"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#Tangent"><span class="hs-identifier hs-type">Tangent</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#SubExpRes"><span class="hs-identifier hs-type">SubExpRes</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-198"></span><span>  </span><span id="local-6989586621684466391"><span class="annot"><span class="annottext">tangent :: SubExpRes -&gt; ADM SubExpRes
</span><a href="#local-6989586621684466391"><span class="hs-identifier hs-var hs-var hs-var hs-var">tangent</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#SubExpRes"><span class="hs-identifier hs-type">SubExpRes</span></a></span><span> </span><span id="local-6989586621684466389"><span class="annot"><span class="annottext">Certs
</span><a href="#local-6989586621684466389"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621684466388"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466388"><span class="hs-identifier hs-var">se</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Certs -&gt; SubExp -&gt; SubExpRes
</span><a href="Futhark.IR.Syntax.html#SubExpRes"><span class="hs-identifier hs-var">SubExpRes</span></a></span><span> </span><span class="annot"><span class="annottext">Certs
</span><a href="#local-6989586621684466389"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; SubExpRes) -&gt; ADM SubExp -&gt; ADM SubExpRes
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; ADM SubExp
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466388"><span class="hs-identifier hs-var">se</span></a></span><span>
</span><span id="line-199"></span><span>  </span><span id="local-6989586621684466385"><span class="annot"><span class="annottext">bundleTan :: SubExpRes -&gt; ADM (BundledTan SubExpRes)
</span><a href="#local-6989586621684466385"><span class="hs-identifier hs-var hs-var hs-var hs-var">bundleTan</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#SubExpRes"><span class="hs-identifier hs-type">SubExpRes</span></a></span><span> </span><span id="local-6989586621684466384"><span class="annot"><span class="annottext">Certs
</span><a href="#local-6989586621684466384"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621684466383"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466383"><span class="hs-identifier hs-var">se</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; SubExpRes) -&gt; [SubExp] -&gt; [SubExpRes]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Certs -&gt; SubExp -&gt; SubExpRes
</span><a href="Futhark.IR.Syntax.html#SubExpRes"><span class="hs-identifier hs-var">SubExpRes</span></a></span><span> </span><span class="annot"><span class="annottext">Certs
</span><a href="#local-6989586621684466384"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([SubExp] -&gt; [SubExpRes]) -&gt; ADM [SubExp] -&gt; ADM [SubExpRes]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; ADM (BundledTan SubExp)
forall a. Tangent a =&gt; a -&gt; ADM (BundledTan a)
</span><a href="Futhark.AD.Fwd.html#bundleTan"><span class="hs-identifier hs-var">bundleTan</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466383"><span class="hs-identifier hs-var">se</span></a></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="annot"><a href="Futhark.AD.Fwd.html#basicFwd"><span class="hs-identifier hs-type">basicFwd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#StmAux"><span class="hs-identifier hs-type">StmAux</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-type">BasicOp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span id="basicFwd"><span class="annot"><span class="annottext">basicFwd :: Pat -&gt; StmAux () -&gt; BasicOp -&gt; ADM ()
</span><a href="Futhark.AD.Fwd.html#basicFwd"><span class="hs-identifier hs-var hs-var">basicFwd</span></a></span></span><span> </span><span id="local-6989586621684466381"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684466381"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684466380"><span class="annot"><span class="annottext">StmAux ()
</span><a href="#local-6989586621684466380"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span id="local-6989586621684466379"><span class="annot"><span class="annottext">BasicOp
</span><a href="#local-6989586621684466379"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-203"></span><span>  </span><span id="local-6989586621684466378"><span class="annot"><span class="annottext">PatT Type
</span><a href="#local-6989586621684466378"><span class="hs-identifier hs-var">pat_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatT Type -&gt; ADM (PatT Type)
forall a. TanBuilder a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#newTan"><span class="hs-identifier hs-var">newTan</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466381"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BasicOp
</span><a href="#local-6989586621684466379"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span id="local-6989586621684466377"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466377"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-206"></span><span>      </span><span id="local-6989586621684466376"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466376"><span class="hs-identifier hs-var">se_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; ADM SubExp
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466377"><span class="hs-identifier hs-var">se</span></a></span><span>
</span><span id="line-207"></span><span>      </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466378"><span class="hs-identifier hs-var">pat_tan</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466380"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; Exp
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; Exp) -&gt; BasicOp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#SubExp"><span class="hs-identifier hs-var">SubExp</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466376"><span class="hs-identifier hs-var">se_tan</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.html#Opaque"><span class="hs-identifier hs-type">Opaque</span></a></span><span> </span><span id="local-6989586621684466372"><span class="annot"><span class="annottext">OpaqueOp
</span><a href="#local-6989586621684466372"><span class="hs-identifier hs-var">opaqueop</span></a></span></span><span> </span><span id="local-6989586621684466371"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466371"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-209"></span><span>      </span><span id="local-6989586621684466370"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466370"><span class="hs-identifier hs-var">se_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; ADM SubExp
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466371"><span class="hs-identifier hs-var">se</span></a></span><span>
</span><span id="line-210"></span><span>      </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466378"><span class="hs-identifier hs-var">pat_tan</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466380"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; Exp
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; Exp) -&gt; BasicOp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OpaqueOp -&gt; SubExp -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#Opaque"><span class="hs-identifier hs-var">Opaque</span></a></span><span> </span><span class="annot"><span class="annottext">OpaqueOp
</span><a href="#local-6989586621684466372"><span class="hs-identifier hs-var">opaqueop</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466370"><span class="hs-identifier hs-var">se_tan</span></a></span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.html#ArrayLit"><span class="hs-identifier hs-type">ArrayLit</span></a></span><span> </span><span id="local-6989586621684466368"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466368"><span class="hs-identifier hs-var">ses</span></a></span></span><span> </span><span id="local-6989586621684466367"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621684466367"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-212"></span><span>      </span><span id="local-6989586621684466366"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466366"><span class="hs-identifier hs-var">ses_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SubExp] -&gt; ADM [SubExp]
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466368"><span class="hs-identifier hs-var">ses</span></a></span><span>
</span><span id="line-213"></span><span>      </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466378"><span class="hs-identifier hs-var">pat_tan</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466380"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; Exp
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; Exp) -&gt; BasicOp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SubExp] -&gt; Type -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#ArrayLit"><span class="hs-identifier hs-var">ArrayLit</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466366"><span class="hs-identifier hs-var">ses_tan</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621684466367"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.html#UnOp"><span class="hs-identifier hs-type">UnOp</span></a></span><span> </span><span id="local-6989586621684466364"><span class="annot"><span class="annottext">UnOp
</span><a href="#local-6989586621684466364"><span class="hs-identifier hs-var">unop</span></a></span></span><span> </span><span id="local-6989586621684466363"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466363"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-215"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684466362"><span class="annot"><span class="annottext">t :: PrimType
</span><a href="#local-6989586621684466362"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnOp -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#unOpType"><span class="hs-identifier hs-var">unOpType</span></a></span><span> </span><span class="annot"><span class="annottext">UnOp
</span><a href="#local-6989586621684466364"><span class="hs-identifier hs-var">unop</span></a></span><span>
</span><span id="line-216"></span><span>          </span><span id="local-6989586621684466360"><span class="annot"><span class="annottext">x_pe :: PrimExp VName
</span><a href="#local-6989586621684466360"><span class="hs-identifier hs-var hs-var">x_pe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; SubExp -&gt; PrimExp VName
</span><a href="Futhark.Analysis.PrimExp.Convert.html#primExpFromSubExp"><span class="hs-identifier hs-var">primExpFromSubExp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466362"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466363"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-217"></span><span>          </span><span id="local-6989586621684466358"><span class="annot"><span class="annottext">dx :: PrimExp VName
</span><a href="#local-6989586621684466358"><span class="hs-identifier hs-var hs-var">dx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnOp -&gt; PrimExp VName -&gt; PrimExp VName
</span><a href="Futhark.AD.Derivatives.html#pdUnOp"><span class="hs-identifier hs-var">pdUnOp</span></a></span><span> </span><span class="annot"><span class="annottext">UnOp
</span><a href="#local-6989586621684466364"><span class="hs-identifier hs-var">unop</span></a></span><span> </span><span class="annot"><span class="annottext">PrimExp VName
</span><a href="#local-6989586621684466360"><span class="hs-identifier hs-var">x_pe</span></a></span><span>
</span><span id="line-218"></span><span>      </span><span id="local-6989586621684466356"><span class="annot"><span class="annottext">PrimExp VName
</span><a href="#local-6989586621684466356"><span class="hs-identifier hs-var">x_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; SubExp -&gt; PrimExp VName
</span><a href="Futhark.Analysis.PrimExp.Convert.html#primExpFromSubExp"><span class="hs-identifier hs-var">primExpFromSubExp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466362"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; PrimExp VName) -&gt; ADM SubExp -&gt; ADM (PrimExp VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; ADM SubExp
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466363"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-219"></span><span>      </span><span class="annot"><span class="annottext">StmAux () -&gt; ADM () -&gt; ADM ()
forall (m :: * -&gt; *) anyrep a.
MonadBuilder m =&gt;
StmAux anyrep -&gt; m a -&gt; m a
</span><a href="Futhark.Builder.Class.html#auxing"><span class="hs-identifier hs-var">auxing</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
</span><a href="#local-6989586621684466380"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(ADM () -&gt; ADM ()) -&gt; ADM () -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; Exp (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *).
MonadBuilder m =&gt;
[VName] -&gt; Exp (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#letBindNames"><span class="hs-identifier hs-var">letBindNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatT Type -&gt; [VName]
forall dec. PatT dec -&gt; [VName]
</span><a href="Futhark.IR.Prop.Patterns.html#patNames"><span class="hs-identifier hs-var">patNames</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
</span><a href="#local-6989586621684466378"><span class="hs-identifier hs-var">pat_tan</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; ADM ())
-&gt; (PrimExp VName -&gt; ADM Exp) -&gt; PrimExp VName -&gt; ADM ()
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">PrimExp VName -&gt; ADM Exp
forall a (m :: * -&gt; *).
(ToExp a, MonadBuilder m) =&gt;
a -&gt; m (Exp (Rep m))
</span><a href="Futhark.Construct.html#toExp"><span class="hs-identifier hs-var">toExp</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimExp VName -&gt; ADM ()) -&gt; PrimExp VName -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimExp VName
</span><a href="#local-6989586621684466356"><span class="hs-identifier hs-var">x_tan</span></a></span><span> </span><span class="annot"><span class="annottext">PrimExp VName -&gt; PrimExp VName -&gt; PrimExp VName
forall v. PrimExp v -&gt; PrimExp v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#~%2A~"><span class="hs-operator hs-var">~*~</span></a></span><span> </span><span class="annot"><span class="annottext">PrimExp VName
</span><a href="#local-6989586621684466358"><span class="hs-identifier hs-var">dx</span></a></span><span>
</span><span id="line-220"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.html#BinOp"><span class="hs-identifier hs-type">BinOp</span></a></span><span> </span><span id="local-6989586621684466348"><span class="annot"><span class="annottext">BinOp
</span><a href="#local-6989586621684466348"><span class="hs-identifier hs-var">bop</span></a></span></span><span> </span><span id="local-6989586621684466347"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466347"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621684466346"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466346"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-221"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684466345"><span class="annot"><span class="annottext">t :: PrimType
</span><a href="#local-6989586621684466345"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinOp -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#binOpType"><span class="hs-identifier hs-var">binOpType</span></a></span><span> </span><span class="annot"><span class="annottext">BinOp
</span><a href="#local-6989586621684466348"><span class="hs-identifier hs-var">bop</span></a></span><span>
</span><span id="line-222"></span><span>      </span><span id="local-6989586621684466343"><span class="annot"><span class="annottext">PrimExp VName
</span><a href="#local-6989586621684466343"><span class="hs-identifier hs-var">x_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; SubExp -&gt; PrimExp VName
</span><a href="Futhark.Analysis.PrimExp.Convert.html#primExpFromSubExp"><span class="hs-identifier hs-var">primExpFromSubExp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466345"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; PrimExp VName) -&gt; ADM SubExp -&gt; ADM (PrimExp VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; ADM SubExp
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466347"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-223"></span><span>      </span><span id="local-6989586621684466342"><span class="annot"><span class="annottext">PrimExp VName
</span><a href="#local-6989586621684466342"><span class="hs-identifier hs-var">y_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; SubExp -&gt; PrimExp VName
</span><a href="Futhark.Analysis.PrimExp.Convert.html#primExpFromSubExp"><span class="hs-identifier hs-var">primExpFromSubExp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466345"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; PrimExp VName) -&gt; ADM SubExp -&gt; ADM (PrimExp VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; ADM SubExp
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466346"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-224"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684466341"><span class="annot"><span class="annottext">PrimExp VName
</span><a href="#local-6989586621684466341"><span class="hs-identifier hs-var">wrt_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684466340"><span class="annot"><span class="annottext">PrimExp VName
</span><a href="#local-6989586621684466340"><span class="hs-identifier hs-var">wrt_y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-225"></span><span>            </span><span class="annot"><span class="annottext">BinOp
-&gt; PrimExp VName -&gt; PrimExp VName -&gt; (PrimExp VName, PrimExp VName)
</span><a href="Futhark.AD.Derivatives.html#pdBinOp"><span class="hs-identifier hs-var">pdBinOp</span></a></span><span> </span><span class="annot"><span class="annottext">BinOp
</span><a href="#local-6989586621684466348"><span class="hs-identifier hs-var">bop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType -&gt; SubExp -&gt; PrimExp VName
</span><a href="Futhark.Analysis.PrimExp.Convert.html#primExpFromSubExp"><span class="hs-identifier hs-var">primExpFromSubExp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466345"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466347"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType -&gt; SubExp -&gt; PrimExp VName
</span><a href="Futhark.Analysis.PrimExp.Convert.html#primExpFromSubExp"><span class="hs-identifier hs-var">primExpFromSubExp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466345"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466346"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>      </span><span class="annot"><span class="annottext">StmAux () -&gt; ADM () -&gt; ADM ()
forall (m :: * -&gt; *) anyrep a.
MonadBuilder m =&gt;
StmAux anyrep -&gt; m a -&gt; m a
</span><a href="Futhark.Builder.Class.html#auxing"><span class="hs-identifier hs-var">auxing</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
</span><a href="#local-6989586621684466380"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(ADM () -&gt; ADM ()) -&gt; ADM () -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-227"></span><span>        </span><span class="annot"><span class="annottext">[VName] -&gt; Exp (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *).
MonadBuilder m =&gt;
[VName] -&gt; Exp (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#letBindNames"><span class="hs-identifier hs-var">letBindNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatT Type -&gt; [VName]
forall dec. PatT dec -&gt; [VName]
</span><a href="Futhark.IR.Prop.Patterns.html#patNames"><span class="hs-identifier hs-var">patNames</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
</span><a href="#local-6989586621684466378"><span class="hs-identifier hs-var">pat_tan</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; ADM ())
-&gt; (PrimExp VName -&gt; ADM Exp) -&gt; PrimExp VName -&gt; ADM ()
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">PrimExp VName -&gt; ADM Exp
forall a (m :: * -&gt; *).
(ToExp a, MonadBuilder m) =&gt;
a -&gt; m (Exp (Rep m))
</span><a href="Futhark.Construct.html#toExp"><span class="hs-identifier hs-var">toExp</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimExp VName -&gt; ADM ()) -&gt; PrimExp VName -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-228"></span><span>          </span><span class="annot"><span class="annottext">PrimExp VName
</span><a href="#local-6989586621684466343"><span class="hs-identifier hs-var">x_tan</span></a></span><span> </span><span class="annot"><span class="annottext">PrimExp VName -&gt; PrimExp VName -&gt; PrimExp VName
forall v. PrimExp v -&gt; PrimExp v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#~%2A~"><span class="hs-operator hs-var">~*~</span></a></span><span> </span><span class="annot"><span class="annottext">PrimExp VName
</span><a href="#local-6989586621684466341"><span class="hs-identifier hs-var">wrt_x</span></a></span><span> </span><span class="annot"><span class="annottext">PrimExp VName -&gt; PrimExp VName -&gt; PrimExp VName
forall v. PrimExp v -&gt; PrimExp v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#~%2B~"><span class="hs-operator hs-var">~+~</span></a></span><span> </span><span class="annot"><span class="annottext">PrimExp VName
</span><a href="#local-6989586621684466342"><span class="hs-identifier hs-var">y_tan</span></a></span><span> </span><span class="annot"><span class="annottext">PrimExp VName -&gt; PrimExp VName -&gt; PrimExp VName
forall v. PrimExp v -&gt; PrimExp v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#~%2A~"><span class="hs-operator hs-var">~*~</span></a></span><span> </span><span class="annot"><span class="annottext">PrimExp VName
</span><a href="#local-6989586621684466340"><span class="hs-identifier hs-var">wrt_y</span></a></span><span>
</span><span id="line-229"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.html#CmpOp"><span class="hs-identifier hs-type">CmpOp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-230"></span><span>      </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466378"><span class="hs-identifier hs-var">pat_tan</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466380"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; Exp
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">BasicOp
</span><a href="#local-6989586621684466379"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.html#ConvOp"><span class="hs-identifier hs-type">ConvOp</span></a></span><span> </span><span id="local-6989586621684466335"><span class="annot"><span class="annottext">ConvOp
</span><a href="#local-6989586621684466335"><span class="hs-identifier hs-var">cop</span></a></span></span><span> </span><span id="local-6989586621684466334"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466334"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-232"></span><span>      </span><span id="local-6989586621684466333"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466333"><span class="hs-identifier hs-var">x_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; ADM SubExp
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466334"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-233"></span><span>      </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466378"><span class="hs-identifier hs-var">pat_tan</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466380"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; Exp
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; Exp) -&gt; BasicOp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConvOp -&gt; SubExp -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#ConvOp"><span class="hs-identifier hs-var">ConvOp</span></a></span><span> </span><span class="annot"><span class="annottext">ConvOp
</span><a href="#local-6989586621684466335"><span class="hs-identifier hs-var">cop</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466333"><span class="hs-identifier hs-var">x_tan</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.html#Assert"><span class="hs-identifier hs-type">Assert</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ADM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span id="local-6989586621684466330"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466330"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span id="local-6989586621684466329"><span class="annot"><span class="annottext">Slice SubExp
</span><a href="#local-6989586621684466329"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-236"></span><span>      </span><span id="local-6989586621684466328"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466328"><span class="hs-identifier hs-var">arr_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; ADM VName
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466330"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-237"></span><span>      </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466378"><span class="hs-identifier hs-var">pat_tan</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466380"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; Exp
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; Exp) -&gt; BasicOp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Slice SubExp -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#Index"><span class="hs-identifier hs-var">Index</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466328"><span class="hs-identifier hs-var">arr_tan</span></a></span><span> </span><span class="annot"><span class="annottext">Slice SubExp
</span><a href="#local-6989586621684466329"><span class="hs-identifier hs-var">slice</span></a></span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.html#Update"><span class="hs-identifier hs-type">Update</span></a></span><span> </span><span id="local-6989586621684466326"><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621684466326"><span class="hs-identifier hs-var">safety</span></a></span></span><span> </span><span id="local-6989586621684466325"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466325"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span id="local-6989586621684466324"><span class="annot"><span class="annottext">Slice SubExp
</span><a href="#local-6989586621684466324"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span id="local-6989586621684466323"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466323"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-239"></span><span>      </span><span id="local-6989586621684466322"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466322"><span class="hs-identifier hs-var">arr_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; ADM VName
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466325"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-240"></span><span>      </span><span id="local-6989586621684466321"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466321"><span class="hs-identifier hs-var">se_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; ADM SubExp
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466323"><span class="hs-identifier hs-var">se</span></a></span><span>
</span><span id="line-241"></span><span>      </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466378"><span class="hs-identifier hs-var">pat_tan</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466380"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; Exp
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; Exp) -&gt; BasicOp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Safety -&gt; VName -&gt; Slice SubExp -&gt; SubExp -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#Update"><span class="hs-identifier hs-var">Update</span></a></span><span> </span><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621684466326"><span class="hs-identifier hs-var">safety</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466322"><span class="hs-identifier hs-var">arr_tan</span></a></span><span> </span><span class="annot"><span class="annottext">Slice SubExp
</span><a href="#local-6989586621684466324"><span class="hs-identifier hs-var">slice</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466321"><span class="hs-identifier hs-var">se_tan</span></a></span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.html#Concat"><span class="hs-identifier hs-type">Concat</span></a></span><span> </span><span id="local-6989586621684466319"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684466319"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621684466318"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466318"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span id="local-6989586621684466317"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466317"><span class="hs-identifier hs-var">arrs</span></a></span></span><span> </span><span id="local-6989586621684466316"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466316"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-243"></span><span>      </span><span id="local-6989586621684466315"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466315"><span class="hs-identifier hs-var">arr_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; ADM VName
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466318"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-244"></span><span>      </span><span id="local-6989586621684466314"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466314"><span class="hs-identifier hs-var">arrs_tans</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; ADM [VName]
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466317"><span class="hs-identifier hs-var">arrs</span></a></span><span>
</span><span id="line-245"></span><span>      </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466378"><span class="hs-identifier hs-var">pat_tan</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466380"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; Exp
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; Exp) -&gt; BasicOp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; VName -&gt; [VName] -&gt; SubExp -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#Concat"><span class="hs-identifier hs-var">Concat</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684466319"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466315"><span class="hs-identifier hs-var">arr_tan</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466314"><span class="hs-identifier hs-var">arrs_tans</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466316"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.html#Copy"><span class="hs-identifier hs-type">Copy</span></a></span><span> </span><span id="local-6989586621684466312"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466312"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-247"></span><span>      </span><span id="local-6989586621684466311"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466311"><span class="hs-identifier hs-var">arr_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; ADM VName
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466312"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-248"></span><span>      </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466378"><span class="hs-identifier hs-var">pat_tan</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466380"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; Exp
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; Exp) -&gt; BasicOp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#Copy"><span class="hs-identifier hs-var">Copy</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466311"><span class="hs-identifier hs-var">arr_tan</span></a></span><span>
</span><span id="line-249"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.html#Manifest"><span class="hs-identifier hs-type">Manifest</span></a></span><span> </span><span id="local-6989586621684466309"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684466309"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621684466308"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466308"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-250"></span><span>      </span><span id="local-6989586621684466307"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466307"><span class="hs-identifier hs-var">arr_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; ADM VName
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466308"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-251"></span><span>      </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466378"><span class="hs-identifier hs-var">pat_tan</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466380"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; Exp
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; Exp) -&gt; BasicOp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; VName -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#Manifest"><span class="hs-identifier hs-var">Manifest</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684466309"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466307"><span class="hs-identifier hs-var">arr_tan</span></a></span><span>
</span><span id="line-252"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.html#Iota"><span class="hs-identifier hs-type">Iota</span></a></span><span> </span><span id="local-6989586621684466305"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466305"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684466304"><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684466304"><span class="hs-identifier hs-var">it</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-253"></span><span>      </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466378"><span class="hs-identifier hs-var">pat_tan</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466380"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; Exp
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; Exp) -&gt; BasicOp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Shape -&gt; SubExp -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#Replicate"><span class="hs-identifier hs-var">Replicate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SubExp] -&gt; Shape
forall d. [d] -&gt; ShapeBase d
</span><a href="Futhark.IR.Syntax.Core.html#Shape"><span class="hs-identifier hs-var">Shape</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466305"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntType -&gt; Integer -&gt; SubExp
</span><a href="Futhark.IR.Prop.Constants.html#intConst"><span class="hs-identifier hs-var">intConst</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684466304"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.html#Replicate"><span class="hs-identifier hs-type">Replicate</span></a></span><span> </span><span id="local-6989586621684466301"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684466301"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621684466300"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466300"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-255"></span><span>      </span><span id="local-6989586621684466299"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466299"><span class="hs-identifier hs-var">x_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; ADM SubExp
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466300"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-256"></span><span>      </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466378"><span class="hs-identifier hs-var">pat_tan</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466380"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; Exp
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; Exp) -&gt; BasicOp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Shape -&gt; SubExp -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#Replicate"><span class="hs-identifier hs-var">Replicate</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684466301"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466299"><span class="hs-identifier hs-var">x_tan</span></a></span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.html#Scratch"><span class="hs-identifier hs-type">Scratch</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ADM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.html#Reshape"><span class="hs-identifier hs-type">Reshape</span></a></span><span> </span><span id="local-6989586621684466296"><span class="annot"><span class="annottext">ShapeChange SubExp
</span><a href="#local-6989586621684466296"><span class="hs-identifier hs-var">reshape</span></a></span></span><span> </span><span id="local-6989586621684466295"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466295"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-259"></span><span>      </span><span id="local-6989586621684466294"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466294"><span class="hs-identifier hs-var">arr_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; ADM VName
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466295"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-260"></span><span>      </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466378"><span class="hs-identifier hs-var">pat_tan</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466380"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; Exp
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; Exp) -&gt; BasicOp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShapeChange SubExp -&gt; VName -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#Reshape"><span class="hs-identifier hs-var">Reshape</span></a></span><span> </span><span class="annot"><span class="annottext">ShapeChange SubExp
</span><a href="#local-6989586621684466296"><span class="hs-identifier hs-var">reshape</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466294"><span class="hs-identifier hs-var">arr_tan</span></a></span><span>
</span><span id="line-261"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.html#Rearrange"><span class="hs-identifier hs-type">Rearrange</span></a></span><span> </span><span id="local-6989586621684466292"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684466292"><span class="hs-identifier hs-var">perm</span></a></span></span><span> </span><span id="local-6989586621684466291"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466291"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-262"></span><span>      </span><span id="local-6989586621684466290"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466290"><span class="hs-identifier hs-var">arr_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; ADM VName
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466291"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-263"></span><span>      </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466378"><span class="hs-identifier hs-var">pat_tan</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466380"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; Exp
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; Exp) -&gt; BasicOp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; VName -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#Rearrange"><span class="hs-identifier hs-var">Rearrange</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684466292"><span class="hs-identifier hs-var">perm</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466290"><span class="hs-identifier hs-var">arr_tan</span></a></span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.html#Rotate"><span class="hs-identifier hs-type">Rotate</span></a></span><span> </span><span id="local-6989586621684466288"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466288"><span class="hs-identifier hs-var">rots</span></a></span></span><span> </span><span id="local-6989586621684466287"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466287"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-265"></span><span>      </span><span id="local-6989586621684466286"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466286"><span class="hs-identifier hs-var">arr_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; ADM VName
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466287"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-266"></span><span>      </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466378"><span class="hs-identifier hs-var">pat_tan</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466380"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; Exp
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; Exp) -&gt; BasicOp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SubExp] -&gt; VName -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#Rotate"><span class="hs-identifier hs-var">Rotate</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466288"><span class="hs-identifier hs-var">rots</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466286"><span class="hs-identifier hs-var">arr_tan</span></a></span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><span class="annottext">BasicOp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ADM ()
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ADM ()) -&gt; [Char] -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;basicFwd: Unsupported op &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">BasicOp
</span><a href="#local-6989586621684466379"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="annot"><a href="Futhark.AD.Fwd.html#fwdLambda"><span class="hs-identifier hs-type">fwdLambda</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span>
</span><span id="line-270"></span><span id="fwdLambda"><span class="annot"><span class="annottext">fwdLambda :: Lambda -&gt; ADM Lambda
</span><a href="Futhark.AD.Fwd.html#fwdLambda"><span class="hs-identifier hs-var hs-var">fwdLambda</span></a></span></span><span> </span><span id="local-6989586621684466284"><span class="annot"><span class="annottext">l :: Lambda
</span><a href="#local-6989586621684466284"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span id="local-6989586621684466282"><span class="annot"><span class="annottext">[LParam SOACS]
</span><a href="#local-6989586621684466282"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621684466281"><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466281"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621684466280"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684466280"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-271"></span><span>  </span><span class="annot"><span class="annottext">[Param Type] -&gt; Body SOACS -&gt; [Type] -&gt; Lambda
forall rep. [LParam rep] -&gt; BodyT rep -&gt; [Type] -&gt; LambdaT rep
</span><a href="Futhark.IR.Syntax.html#Lambda"><span class="hs-identifier hs-var">Lambda</span></a></span><span> </span><span class="annot"><span class="annottext">([Param Type] -&gt; Body SOACS -&gt; [Type] -&gt; Lambda)
-&gt; ADM [Param Type] -&gt; ADM (Body SOACS -&gt; [Type] -&gt; Lambda)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Param Type] -&gt; ADM (Bundled [Param Type])
forall a. TanBuilder a =&gt; a -&gt; ADM (Bundled a)
</span><a href="Futhark.AD.Fwd.html#bundleNew"><span class="hs-identifier hs-var">bundleNew</span></a></span><span> </span><span class="annot"><span class="annottext">[Param Type]
[LParam SOACS]
</span><a href="#local-6989586621684466282"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">ADM (Body SOACS -&gt; [Type] -&gt; Lambda)
-&gt; ADM (Body SOACS) -&gt; ADM ([Type] -&gt; Lambda)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Lambda -&gt; ADM (Body SOACS) -&gt; ADM (Body SOACS)
forall rep a (m :: * -&gt; *) b.
(Scoped rep a, LocalScope rep m) =&gt;
a -&gt; m b -&gt; m b
</span><a href="Futhark.IR.Prop.Scope.html#inScopeOf"><span class="hs-identifier hs-var">inScopeOf</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466284"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Body SOACS -&gt; ADM (Body SOACS)
</span><a href="Futhark.AD.Fwd.html#fwdBody"><span class="hs-identifier hs-var">fwdBody</span></a></span><span> </span><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466281"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ADM ([Type] -&gt; Lambda) -&gt; ADM [Type] -&gt; ADM Lambda
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; ADM (BundledTan [Type])
forall a. Tangent a =&gt; a -&gt; ADM (BundledTan a)
</span><a href="Futhark.AD.Fwd.html#bundleTan"><span class="hs-identifier hs-var">bundleTan</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684466280"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="annot"><a href="Futhark.AD.Fwd.html#fwdStreamLambda"><span class="hs-identifier hs-type">fwdStreamLambda</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span>
</span><span id="line-274"></span><span id="fwdStreamLambda"><span class="annot"><span class="annottext">fwdStreamLambda :: Lambda -&gt; ADM Lambda
</span><a href="Futhark.AD.Fwd.html#fwdStreamLambda"><span class="hs-identifier hs-var hs-var">fwdStreamLambda</span></a></span></span><span> </span><span id="local-6989586621684466276"><span class="annot"><span class="annottext">l :: Lambda
</span><a href="#local-6989586621684466276"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span id="local-6989586621684466275"><span class="annot"><span class="annottext">[LParam SOACS]
</span><a href="#local-6989586621684466275"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621684466274"><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466274"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621684466273"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684466273"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-275"></span><span>  </span><span class="annot"><span class="annottext">[Param Type] -&gt; Body SOACS -&gt; [Type] -&gt; Lambda
forall rep. [LParam rep] -&gt; BodyT rep -&gt; [Type] -&gt; LambdaT rep
</span><a href="Futhark.IR.Syntax.html#Lambda"><span class="hs-identifier hs-var">Lambda</span></a></span><span> </span><span class="annot"><span class="annottext">([Param Type] -&gt; Body SOACS -&gt; [Type] -&gt; Lambda)
-&gt; ADM [Param Type] -&gt; ADM (Body SOACS -&gt; [Type] -&gt; Lambda)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Param Type] -&gt; [Param Type]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">[Param Type]
[LParam SOACS]
</span><a href="#local-6989586621684466275"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">[Param Type] -&gt; [Param Type] -&gt; [Param Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Param Type] -&gt; [Param Type])
-&gt; ADM [Param Type] -&gt; ADM [Param Type]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Param Type] -&gt; ADM (Bundled [Param Type])
forall a. TanBuilder a =&gt; a -&gt; ADM (Bundled a)
</span><a href="Futhark.AD.Fwd.html#bundleNew"><span class="hs-identifier hs-var">bundleNew</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Param Type] -&gt; [Param Type]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">[Param Type]
[LParam SOACS]
</span><a href="#local-6989586621684466275"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ADM (Body SOACS -&gt; [Type] -&gt; Lambda)
-&gt; ADM (Body SOACS) -&gt; ADM ([Type] -&gt; Lambda)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Lambda -&gt; ADM (Body SOACS) -&gt; ADM (Body SOACS)
forall rep a (m :: * -&gt; *) b.
(Scoped rep a, LocalScope rep m) =&gt;
a -&gt; m b -&gt; m b
</span><a href="Futhark.IR.Prop.Scope.html#inScopeOf"><span class="hs-identifier hs-var">inScopeOf</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466276"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Body SOACS -&gt; ADM (Body SOACS)
</span><a href="Futhark.AD.Fwd.html#fwdBody"><span class="hs-identifier hs-var">fwdBody</span></a></span><span> </span><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466274"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ADM ([Type] -&gt; Lambda) -&gt; ADM [Type] -&gt; ADM Lambda
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; ADM (BundledTan [Type])
forall a. Tangent a =&gt; a -&gt; ADM (BundledTan a)
</span><a href="Futhark.AD.Fwd.html#bundleTan"><span class="hs-identifier hs-var">bundleTan</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684466273"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span id="local-6989586621684466270"><span class="annot"><a href="Futhark.AD.Fwd.html#interleave"><span class="hs-identifier hs-type">interleave</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621684466270"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621684466270"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621684466270"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-278"></span><span id="interleave"><span class="annot"><span class="annottext">interleave :: forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="Futhark.AD.Fwd.html#interleave"><span class="hs-identifier hs-var hs-var">interleave</span></a></span></span><span> </span><span id="local-6989586621684466267"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621684466267"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621684466266"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621684466266"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[a]] -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[a]] -&gt; [a]) -&gt; [[a]] -&gt; [a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[a]] -&gt; [[a]]
forall a. [[a]] -&gt; [[a]]
</span><span class="hs-identifier hs-var">transpose</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621684466267"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621684466266"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span class="annot"><a href="Futhark.AD.Fwd.html#zeroFromSubExp"><span class="hs-identifier hs-type">zeroFromSubExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span>
</span><span id="line-281"></span><span id="zeroFromSubExp"><span class="annot"><span class="annottext">zeroFromSubExp :: SubExp -&gt; ADM VName
</span><a href="Futhark.AD.Fwd.html#zeroFromSubExp"><span class="hs-identifier hs-var hs-var">zeroFromSubExp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span> </span><span id="local-6989586621684466263"><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684466263"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-282"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Exp (Rep ADM) -&gt; ADM VName
forall (m :: * -&gt; *).
MonadBuilder m =&gt;
[Char] -&gt; Exp (Rep m) -&gt; m VName
</span><a href="Futhark.Construct.html#letExp"><span class="hs-identifier hs-var">letExp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;zero&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Exp (Rep ADM) -&gt; ADM VName) -&gt; Exp (Rep ADM) -&gt; ADM VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-283"></span><span>    </span><span class="annot"><span class="annottext">BasicOp -&gt; Exp
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; Exp) -&gt; BasicOp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#SubExp"><span class="hs-identifier hs-var">SubExp</span></a></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; BasicOp) -&gt; SubExp -&gt; BasicOp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimValue -&gt; SubExp
</span><a href="Futhark.IR.Syntax.Core.html#Constant"><span class="hs-identifier hs-var">Constant</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimValue -&gt; SubExp) -&gt; PrimValue -&gt; SubExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; PrimValue
</span><a href="Futhark.IR.Primitive.html#blankPrimValue"><span class="hs-identifier hs-var">blankPrimValue</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimType -&gt; PrimValue) -&gt; PrimType -&gt; PrimValue
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimValue -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#primValueType"><span class="hs-identifier hs-var">primValueType</span></a></span><span> </span><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684466263"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-284"></span><span class="annot"><a href="Futhark.AD.Fwd.html#zeroFromSubExp"><span class="hs-identifier hs-var">zeroFromSubExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684466262"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466262"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-285"></span><span>  </span><span id="local-6989586621684466261"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621684466261"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; ADM Type
forall rep (m :: * -&gt; *). HasScope rep m =&gt; VName -&gt; m Type
</span><a href="Futhark.IR.Prop.Scope.html#lookupType"><span class="hs-identifier hs-var">lookupType</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466262"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-286"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Exp (Rep ADM) -&gt; ADM VName
forall (m :: * -&gt; *).
MonadBuilder m =&gt;
[Char] -&gt; Exp (Rep m) -&gt; m VName
</span><a href="Futhark.Construct.html#letExp"><span class="hs-identifier hs-var">letExp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;zero&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Exp (Rep ADM) -&gt; ADM VName) -&gt; Exp (Rep ADM) -&gt; ADM VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Exp
</span><a href="Futhark.AD.Fwd.html#zeroExp"><span class="hs-identifier hs-var">zeroExp</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621684466261"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="annot"><a href="Futhark.AD.Fwd.html#fwdSOAC"><span class="hs-identifier hs-type">fwdSOAC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#StmAux"><span class="hs-identifier hs-type">StmAux</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.SOAC.html#SOAC"><span class="hs-identifier hs-type">SOAC</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span id="fwdSOAC"><span class="annot"><span class="annottext">fwdSOAC :: Pat -&gt; StmAux () -&gt; SOAC SOACS -&gt; ADM ()
</span><a href="Futhark.AD.Fwd.html#fwdSOAC"><span class="hs-identifier hs-var hs-var">fwdSOAC</span></a></span></span><span> </span><span id="local-6989586621684466259"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684466259"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684466258"><span class="annot"><span class="annottext">StmAux ()
</span><a href="#local-6989586621684466258"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.SOACS.SOAC.html#Screma"><span class="hs-identifier hs-type">Screma</span></a></span><span> </span><span id="local-6989586621684466256"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466256"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span id="local-6989586621684466255"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466255"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.SOACS.SOAC.html#ScremaForm"><span class="hs-identifier hs-type">ScremaForm</span></a></span><span> </span><span id="local-6989586621684466253"><span class="annot"><span class="annottext">[Scan SOACS]
</span><a href="#local-6989586621684466253"><span class="hs-identifier hs-var">scs</span></a></span></span><span> </span><span id="local-6989586621684466252"><span class="annot"><span class="annottext">[Reduce SOACS]
</span><a href="#local-6989586621684466252"><span class="hs-identifier hs-var">reds</span></a></span></span><span> </span><span id="local-6989586621684466251"><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466251"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-290"></span><span>  </span><span id="local-6989586621684466250"><span class="annot"><span class="annottext">PatT Type
</span><a href="#local-6989586621684466250"><span class="hs-identifier hs-var">pat'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatT Type -&gt; ADM (Bundled (PatT Type))
forall a. TanBuilder a =&gt; a -&gt; ADM (Bundled a)
</span><a href="Futhark.AD.Fwd.html#bundleNew"><span class="hs-identifier hs-var">bundleNew</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466259"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-291"></span><span>  </span><span id="local-6989586621684466249"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466249"><span class="hs-identifier hs-var">xs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; ADM (BundledTan [VName])
forall a. Tangent a =&gt; a -&gt; ADM (BundledTan a)
</span><a href="Futhark.AD.Fwd.html#bundleTan"><span class="hs-identifier hs-var">bundleTan</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466255"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-292"></span><span>  </span><span id="local-6989586621684466248"><span class="annot"><span class="annottext">[Scan SOACS]
</span><a href="#local-6989586621684466248"><span class="hs-identifier hs-var">scs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Scan SOACS -&gt; ADM (Scan SOACS))
-&gt; [Scan SOACS] -&gt; ADM [Scan SOACS]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Scan SOACS -&gt; ADM (Scan SOACS)
</span><a href="#local-6989586621684466247"><span class="hs-identifier hs-var">fwdScan</span></a></span><span> </span><span class="annot"><span class="annottext">[Scan SOACS]
</span><a href="#local-6989586621684466253"><span class="hs-identifier hs-var">scs</span></a></span><span>
</span><span id="line-293"></span><span>  </span><span id="local-6989586621684466246"><span class="annot"><span class="annottext">[Reduce SOACS]
</span><a href="#local-6989586621684466246"><span class="hs-identifier hs-var">reds'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Reduce SOACS -&gt; ADM (Reduce SOACS))
-&gt; [Reduce SOACS] -&gt; ADM [Reduce SOACS]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Reduce SOACS -&gt; ADM (Reduce SOACS)
</span><a href="#local-6989586621684466245"><span class="hs-identifier hs-var">fwdRed</span></a></span><span> </span><span class="annot"><span class="annottext">[Reduce SOACS]
</span><a href="#local-6989586621684466252"><span class="hs-identifier hs-var">reds</span></a></span><span>
</span><span id="line-294"></span><span>  </span><span id="local-6989586621684466244"><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466244"><span class="hs-identifier hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lambda -&gt; ADM Lambda
</span><a href="Futhark.AD.Fwd.html#fwdLambda"><span class="hs-identifier hs-var">fwdLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466251"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-295"></span><span>  </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466250"><span class="hs-identifier hs-var">pat'</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466258"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Op SOACS -&gt; Exp
forall rep. Op rep -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#Op"><span class="hs-identifier hs-var">Op</span></a></span><span> </span><span class="annot"><span class="annottext">(Op SOACS -&gt; Exp) -&gt; Op SOACS -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; [VName] -&gt; ScremaForm SOACS -&gt; SOAC SOACS
forall rep. SubExp -&gt; [VName] -&gt; ScremaForm rep -&gt; SOAC rep
</span><a href="Futhark.IR.SOACS.SOAC.html#Screma"><span class="hs-identifier hs-var">Screma</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466256"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466249"><span class="hs-identifier hs-var">xs'</span></a></span><span> </span><span class="annot"><span class="annottext">(ScremaForm SOACS -&gt; SOAC SOACS) -&gt; ScremaForm SOACS -&gt; SOAC SOACS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Scan SOACS] -&gt; [Reduce SOACS] -&gt; Lambda -&gt; ScremaForm SOACS
forall rep.
[Scan rep] -&gt; [Reduce rep] -&gt; Lambda rep -&gt; ScremaForm rep
</span><a href="Futhark.IR.SOACS.SOAC.html#ScremaForm"><span class="hs-identifier hs-var">ScremaForm</span></a></span><span> </span><span class="annot"><span class="annottext">[Scan SOACS]
</span><a href="#local-6989586621684466248"><span class="hs-identifier hs-var">scs'</span></a></span><span> </span><span class="annot"><span class="annottext">[Reduce SOACS]
</span><a href="#local-6989586621684466246"><span class="hs-identifier hs-var">reds'</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466244"><span class="hs-identifier hs-var">f'</span></a></span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-297"></span><span>    </span><span class="annot"><a href="#local-6989586621684466247"><span class="hs-identifier hs-type">fwdScan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.SOAC.html#Scan"><span class="hs-identifier hs-type">Scan</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.SOACS.SOAC.html#Scan"><span class="hs-identifier hs-type">Scan</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>    </span><span id="local-6989586621684466247"><span class="annot"><span class="annottext">fwdScan :: Scan SOACS -&gt; ADM (Scan SOACS)
</span><a href="#local-6989586621684466247"><span class="hs-identifier hs-var hs-var">fwdScan</span></a></span></span><span> </span><span id="local-6989586621684466242"><span class="annot"><span class="annottext">Scan SOACS
</span><a href="#local-6989586621684466242"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-299"></span><span>      </span><span id="local-6989586621684466241"><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466241"><span class="hs-identifier hs-var">op'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lambda -&gt; ADM Lambda
</span><a href="Futhark.AD.Fwd.html#fwdLambda"><span class="hs-identifier hs-var">fwdLambda</span></a></span><span> </span><span class="annot"><span class="annottext">(Lambda -&gt; ADM Lambda) -&gt; Lambda -&gt; ADM Lambda
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Scan SOACS -&gt; Lambda
forall rep. Scan rep -&gt; Lambda rep
</span><a href="Futhark.IR.SOACS.SOAC.html#scanLambda"><span class="hs-identifier hs-var hs-var">scanLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Scan SOACS
</span><a href="#local-6989586621684466242"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-300"></span><span>      </span><span id="local-6989586621684466239"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466239"><span class="hs-identifier hs-var">neutral_tans</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; ADM VName) -&gt; [SubExp] -&gt; ADM [VName]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; ADM VName
</span><a href="Futhark.AD.Fwd.html#zeroFromSubExp"><span class="hs-identifier hs-var">zeroFromSubExp</span></a></span><span> </span><span class="annot"><span class="annottext">([SubExp] -&gt; ADM [VName]) -&gt; [SubExp] -&gt; ADM [VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Scan SOACS -&gt; [SubExp]
forall rep. Scan rep -&gt; [SubExp]
</span><a href="Futhark.IR.SOACS.SOAC.html#scanNeutral"><span class="hs-identifier hs-var hs-var">scanNeutral</span></a></span><span> </span><span class="annot"><span class="annottext">Scan SOACS
</span><a href="#local-6989586621684466242"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-301"></span><span>      </span><span class="annot"><span class="annottext">Scan SOACS -&gt; ADM (Scan SOACS)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Scan SOACS -&gt; ADM (Scan SOACS)) -&gt; Scan SOACS -&gt; ADM (Scan SOACS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-302"></span><span>        </span><span class="annot"><span class="annottext">Scan :: forall rep. Lambda rep -&gt; [SubExp] -&gt; Scan rep
</span><a href="Futhark.IR.SOACS.SOAC.html#Scan"><span class="hs-identifier hs-type">Scan</span></a></span><span>
</span><span id="line-303"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scanNeutral :: [SubExp]
</span><a href="Futhark.IR.SOACS.SOAC.html#scanNeutral"><span class="hs-identifier hs-var">scanNeutral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scan SOACS -&gt; [SubExp]
forall rep. Scan rep -&gt; [SubExp]
</span><a href="Futhark.IR.SOACS.SOAC.html#scanNeutral"><span class="hs-identifier hs-var hs-var">scanNeutral</span></a></span><span> </span><span class="annot"><span class="annottext">Scan SOACS
</span><a href="#local-6989586621684466242"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp] -&gt; [SubExp] -&gt; [SubExp]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="Futhark.AD.Fwd.html#interleave"><span class="hs-operator hs-var">`interleave`</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; SubExp) -&gt; [VName] -&gt; [SubExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; SubExp
</span><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466239"><span class="hs-identifier hs-var">neutral_tans</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-304"></span><span>            </span><span class="annot"><span class="annottext">scanLambda :: Lambda
</span><a href="Futhark.IR.SOACS.SOAC.html#scanLambda"><span class="hs-identifier hs-var">scanLambda</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466241"><span class="hs-identifier hs-var">op'</span></a></span><span>
</span><span id="line-305"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-306"></span><span>    </span><span class="annot"><a href="#local-6989586621684466245"><span class="hs-identifier hs-type">fwdRed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.SOAC.html#Reduce"><span class="hs-identifier hs-type">Reduce</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.SOACS.SOAC.html#Reduce"><span class="hs-identifier hs-type">Reduce</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>    </span><span id="local-6989586621684466245"><span class="annot"><span class="annottext">fwdRed :: Reduce SOACS -&gt; ADM (Reduce SOACS)
</span><a href="#local-6989586621684466245"><span class="hs-identifier hs-var hs-var">fwdRed</span></a></span></span><span> </span><span id="local-6989586621684466236"><span class="annot"><span class="annottext">Reduce SOACS
</span><a href="#local-6989586621684466236"><span class="hs-identifier hs-var">red</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-308"></span><span>      </span><span id="local-6989586621684466235"><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466235"><span class="hs-identifier hs-var">op'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lambda -&gt; ADM Lambda
</span><a href="Futhark.AD.Fwd.html#fwdLambda"><span class="hs-identifier hs-var">fwdLambda</span></a></span><span> </span><span class="annot"><span class="annottext">(Lambda -&gt; ADM Lambda) -&gt; Lambda -&gt; ADM Lambda
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Reduce SOACS -&gt; Lambda
forall rep. Reduce rep -&gt; Lambda rep
</span><a href="Futhark.IR.SOACS.SOAC.html#redLambda"><span class="hs-identifier hs-var hs-var">redLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Reduce SOACS
</span><a href="#local-6989586621684466236"><span class="hs-identifier hs-var">red</span></a></span><span>
</span><span id="line-309"></span><span>      </span><span id="local-6989586621684466233"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466233"><span class="hs-identifier hs-var">neutral_tans</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; ADM VName) -&gt; [SubExp] -&gt; ADM [VName]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; ADM VName
</span><a href="Futhark.AD.Fwd.html#zeroFromSubExp"><span class="hs-identifier hs-var">zeroFromSubExp</span></a></span><span> </span><span class="annot"><span class="annottext">([SubExp] -&gt; ADM [VName]) -&gt; [SubExp] -&gt; ADM [VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Reduce SOACS -&gt; [SubExp]
forall rep. Reduce rep -&gt; [SubExp]
</span><a href="Futhark.IR.SOACS.SOAC.html#redNeutral"><span class="hs-identifier hs-var hs-var">redNeutral</span></a></span><span> </span><span class="annot"><span class="annottext">Reduce SOACS
</span><a href="#local-6989586621684466236"><span class="hs-identifier hs-var">red</span></a></span><span>
</span><span id="line-310"></span><span>      </span><span class="annot"><span class="annottext">Reduce SOACS -&gt; ADM (Reduce SOACS)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Reduce SOACS -&gt; ADM (Reduce SOACS))
-&gt; Reduce SOACS -&gt; ADM (Reduce SOACS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-311"></span><span>        </span><span class="annot"><span class="annottext">Reduce :: forall rep. Commutativity -&gt; Lambda rep -&gt; [SubExp] -&gt; Reduce rep
</span><a href="Futhark.IR.SOACS.SOAC.html#Reduce"><span class="hs-identifier hs-type">Reduce</span></a></span><span>
</span><span id="line-312"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">redComm :: Commutativity
</span><a href="Futhark.IR.SOACS.SOAC.html#redComm"><span class="hs-identifier hs-var">redComm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reduce SOACS -&gt; Commutativity
forall rep. Reduce rep -&gt; Commutativity
</span><a href="Futhark.IR.SOACS.SOAC.html#redComm"><span class="hs-identifier hs-var hs-var">redComm</span></a></span><span> </span><span class="annot"><span class="annottext">Reduce SOACS
</span><a href="#local-6989586621684466236"><span class="hs-identifier hs-var">red</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-313"></span><span>            </span><span class="annot"><span class="annottext">redLambda :: Lambda
</span><a href="Futhark.IR.SOACS.SOAC.html#redLambda"><span class="hs-identifier hs-var">redLambda</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466235"><span class="hs-identifier hs-var">op'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-314"></span><span>            </span><span class="annot"><span class="annottext">redNeutral :: [SubExp]
</span><a href="Futhark.IR.SOACS.SOAC.html#redNeutral"><span class="hs-identifier hs-var">redNeutral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reduce SOACS -&gt; [SubExp]
forall rep. Reduce rep -&gt; [SubExp]
</span><a href="Futhark.IR.SOACS.SOAC.html#redNeutral"><span class="hs-identifier hs-var hs-var">redNeutral</span></a></span><span> </span><span class="annot"><span class="annottext">Reduce SOACS
</span><a href="#local-6989586621684466236"><span class="hs-identifier hs-var">red</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp] -&gt; [SubExp] -&gt; [SubExp]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="Futhark.AD.Fwd.html#interleave"><span class="hs-operator hs-var">`interleave`</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; SubExp) -&gt; [VName] -&gt; [SubExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; SubExp
</span><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466233"><span class="hs-identifier hs-var">neutral_tans</span></a></span><span>
</span><span id="line-315"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-316"></span><span class="annot"><a href="Futhark.AD.Fwd.html#fwdSOAC"><span class="hs-identifier hs-var">fwdSOAC</span></a></span><span> </span><span id="local-6989586621684466229"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684466229"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684466228"><span class="annot"><span class="annottext">StmAux ()
</span><a href="#local-6989586621684466228"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.SOACS.SOAC.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span id="local-6989586621684466226"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466226"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span id="local-6989586621684466225"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466225"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621684466224"><span class="annot"><span class="annottext">StreamForm SOACS
</span><a href="#local-6989586621684466224"><span class="hs-identifier hs-var">form</span></a></span></span><span> </span><span id="local-6989586621684466223"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466223"><span class="hs-identifier hs-var">nes</span></a></span></span><span> </span><span id="local-6989586621684466222"><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466222"><span class="hs-identifier hs-var">lam</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-317"></span><span>  </span><span id="local-6989586621684466221"><span class="annot"><span class="annottext">PatT Type
</span><a href="#local-6989586621684466221"><span class="hs-identifier hs-var">pat'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatT Type -&gt; ADM (Bundled (PatT Type))
forall a. TanBuilder a =&gt; a -&gt; ADM (Bundled a)
</span><a href="Futhark.AD.Fwd.html#bundleNew"><span class="hs-identifier hs-var">bundleNew</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466229"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-318"></span><span>  </span><span id="local-6989586621684466220"><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466220"><span class="hs-identifier hs-var">lam'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lambda -&gt; ADM Lambda
</span><a href="Futhark.AD.Fwd.html#fwdStreamLambda"><span class="hs-identifier hs-var">fwdStreamLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466222"><span class="hs-identifier hs-var">lam</span></a></span><span>
</span><span id="line-319"></span><span>  </span><span id="local-6989586621684466219"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466219"><span class="hs-identifier hs-var">xs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; ADM (BundledTan [VName])
forall a. Tangent a =&gt; a -&gt; ADM (BundledTan a)
</span><a href="Futhark.AD.Fwd.html#bundleTan"><span class="hs-identifier hs-var">bundleTan</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466225"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-320"></span><span>  </span><span id="local-6989586621684466218"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466218"><span class="hs-identifier hs-var">nes_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; ADM SubExp) -&gt; [SubExp] -&gt; ADM [SubExp]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(VName -&gt; SubExp) -&gt; ADM VName -&gt; ADM SubExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; SubExp
</span><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">(ADM VName -&gt; ADM SubExp)
-&gt; (SubExp -&gt; ADM VName) -&gt; SubExp -&gt; ADM SubExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; ADM VName
</span><a href="Futhark.AD.Fwd.html#zeroFromSubExp"><span class="hs-identifier hs-var">zeroFromSubExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466223"><span class="hs-identifier hs-var">nes</span></a></span><span>
</span><span id="line-321"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684466217"><span class="annot"><span class="annottext">nes' :: [SubExp]
</span><a href="#local-6989586621684466217"><span class="hs-identifier hs-var hs-var">nes'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SubExp] -&gt; [SubExp] -&gt; [SubExp]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="Futhark.AD.Fwd.html#interleave"><span class="hs-identifier hs-var">interleave</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466223"><span class="hs-identifier hs-var">nes</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466218"><span class="hs-identifier hs-var">nes_tan</span></a></span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StreamForm SOACS
</span><a href="#local-6989586621684466224"><span class="hs-identifier hs-var">form</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-323"></span><span>    </span><span class="annot"><span class="annottext">StreamForm SOACS
</span><a href="Futhark.IR.SOACS.SOAC.html#Sequential"><span class="hs-identifier hs-var">Sequential</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-324"></span><span>      </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466221"><span class="hs-identifier hs-var">pat'</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466228"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Op SOACS -&gt; Exp
forall rep. Op rep -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#Op"><span class="hs-identifier hs-var">Op</span></a></span><span> </span><span class="annot"><span class="annottext">(Op SOACS -&gt; Exp) -&gt; Op SOACS -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SubExp
-&gt; [VName] -&gt; StreamForm SOACS -&gt; [SubExp] -&gt; Lambda -&gt; SOAC SOACS
forall rep.
SubExp
-&gt; [VName] -&gt; StreamForm rep -&gt; [SubExp] -&gt; Lambda rep -&gt; SOAC rep
</span><a href="Futhark.IR.SOACS.SOAC.html#Stream"><span class="hs-identifier hs-var">Stream</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466226"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466219"><span class="hs-identifier hs-var">xs'</span></a></span><span> </span><span class="annot"><span class="annottext">StreamForm SOACS
forall rep. StreamForm rep
</span><a href="Futhark.IR.SOACS.SOAC.html#Sequential"><span class="hs-identifier hs-var">Sequential</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466217"><span class="hs-identifier hs-var">nes'</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466220"><span class="hs-identifier hs-var">lam'</span></a></span><span>
</span><span id="line-325"></span><span>    </span><span class="annot"><a href="Futhark.IR.SOACS.SOAC.html#Parallel"><span class="hs-identifier hs-type">Parallel</span></a></span><span> </span><span id="local-6989586621684466214"><span class="annot"><span class="annottext">StreamOrd
</span><a href="#local-6989586621684466214"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621684466213"><span class="annot"><span class="annottext">Commutativity
</span><a href="#local-6989586621684466213"><span class="hs-identifier hs-var">comm</span></a></span></span><span> </span><span id="local-6989586621684466212"><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466212"><span class="hs-identifier hs-var">lam0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-326"></span><span>      </span><span id="local-6989586621684466211"><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466211"><span class="hs-identifier hs-var">lam0'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lambda -&gt; ADM Lambda
</span><a href="Futhark.AD.Fwd.html#fwdLambda"><span class="hs-identifier hs-var">fwdLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466212"><span class="hs-identifier hs-var">lam0</span></a></span><span>
</span><span id="line-327"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684466210"><span class="annot"><span class="annottext">form' :: StreamForm SOACS
</span><a href="#local-6989586621684466210"><span class="hs-identifier hs-var hs-var">form'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StreamOrd -&gt; Commutativity -&gt; Lambda -&gt; StreamForm SOACS
forall rep.
StreamOrd -&gt; Commutativity -&gt; Lambda rep -&gt; StreamForm rep
</span><a href="Futhark.IR.SOACS.SOAC.html#Parallel"><span class="hs-identifier hs-var">Parallel</span></a></span><span> </span><span class="annot"><span class="annottext">StreamOrd
</span><a href="#local-6989586621684466214"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Commutativity
</span><a href="#local-6989586621684466213"><span class="hs-identifier hs-var">comm</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466211"><span class="hs-identifier hs-var">lam0'</span></a></span><span>
</span><span id="line-328"></span><span>      </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466221"><span class="hs-identifier hs-var">pat'</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466228"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Op SOACS -&gt; Exp
forall rep. Op rep -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#Op"><span class="hs-identifier hs-var">Op</span></a></span><span> </span><span class="annot"><span class="annottext">(Op SOACS -&gt; Exp) -&gt; Op SOACS -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SubExp
-&gt; [VName] -&gt; StreamForm SOACS -&gt; [SubExp] -&gt; Lambda -&gt; SOAC SOACS
forall rep.
SubExp
-&gt; [VName] -&gt; StreamForm rep -&gt; [SubExp] -&gt; Lambda rep -&gt; SOAC rep
</span><a href="Futhark.IR.SOACS.SOAC.html#Stream"><span class="hs-identifier hs-var">Stream</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466226"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466219"><span class="hs-identifier hs-var">xs'</span></a></span><span> </span><span class="annot"><span class="annottext">StreamForm SOACS
</span><a href="#local-6989586621684466210"><span class="hs-identifier hs-var">form'</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466217"><span class="hs-identifier hs-var">nes'</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466220"><span class="hs-identifier hs-var">lam'</span></a></span><span>
</span><span id="line-329"></span><span class="annot"><a href="Futhark.AD.Fwd.html#fwdSOAC"><span class="hs-identifier hs-var">fwdSOAC</span></a></span><span> </span><span id="local-6989586621684466209"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684466209"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684466208"><span class="annot"><span class="annottext">StmAux ()
</span><a href="#local-6989586621684466208"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.SOACS.SOAC.html#Hist"><span class="hs-identifier hs-type">Hist</span></a></span><span> </span><span id="local-6989586621684466206"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466206"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621684466205"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466205"><span class="hs-identifier hs-var">arrs</span></a></span></span><span> </span><span id="local-6989586621684466204"><span class="annot"><span class="annottext">[HistOp SOACS]
</span><a href="#local-6989586621684466204"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span id="local-6989586621684466203"><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466203"><span class="hs-identifier hs-var">bucket_fun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-330"></span><span>  </span><span id="local-6989586621684466202"><span class="annot"><span class="annottext">PatT Type
</span><a href="#local-6989586621684466202"><span class="hs-identifier hs-var">pat_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatT Type -&gt; ADM (PatT Type)
forall a. TanBuilder a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#newTan"><span class="hs-identifier hs-var">newTan</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466209"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-331"></span><span>  </span><span id="local-6989586621684466201"><span class="annot"><span class="annottext">[HistOp SOACS]
</span><a href="#local-6989586621684466201"><span class="hs-identifier hs-var">ops'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HistOp SOACS -&gt; ADM (HistOp SOACS))
-&gt; [HistOp SOACS] -&gt; ADM [HistOp SOACS]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">HistOp SOACS -&gt; ADM (HistOp SOACS)
</span><a href="#local-6989586621684466200"><span class="hs-identifier hs-var">fwdHist</span></a></span><span> </span><span class="annot"><span class="annottext">[HistOp SOACS]
</span><a href="#local-6989586621684466204"><span class="hs-identifier hs-var">ops</span></a></span><span>
</span><span id="line-332"></span><span>  </span><span id="local-6989586621684466199"><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466199"><span class="hs-identifier hs-var">bucket_fun'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lambda -&gt; ADM Lambda
</span><a href="Futhark.AD.Fwd.html#fwdLambda"><span class="hs-identifier hs-var">fwdLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466203"><span class="hs-identifier hs-var">bucket_fun</span></a></span><span>
</span><span id="line-333"></span><span>  </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466209"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type -&gt; PatT Type -&gt; PatT Type
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">PatT Type
</span><a href="#local-6989586621684466202"><span class="hs-identifier hs-var">pat_tan</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466208"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Op SOACS -&gt; Exp
forall rep. Op rep -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#Op"><span class="hs-identifier hs-var">Op</span></a></span><span> </span><span class="annot"><span class="annottext">(Op SOACS -&gt; Exp) -&gt; Op SOACS -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; [VName] -&gt; [HistOp SOACS] -&gt; Lambda -&gt; SOAC SOACS
forall rep.
SubExp -&gt; [VName] -&gt; [HistOp rep] -&gt; Lambda rep -&gt; SOAC rep
</span><a href="Futhark.IR.SOACS.SOAC.html#Hist"><span class="hs-identifier hs-var">Hist</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466206"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466205"><span class="hs-identifier hs-var">arrs</span></a></span><span> </span><span class="annot"><span class="annottext">[HistOp SOACS]
</span><a href="#local-6989586621684466201"><span class="hs-identifier hs-var">ops'</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466199"><span class="hs-identifier hs-var">bucket_fun'</span></a></span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-335"></span><span>    </span><span class="annot"><a href="#local-6989586621684466200"><span class="hs-identifier hs-type">fwdHist</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.SOAC.html#HistOp"><span class="hs-identifier hs-type">HistOp</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.SOACS.SOAC.html#HistOp"><span class="hs-identifier hs-type">HistOp</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>    </span><span id="local-6989586621684466200"><span class="annot"><span class="annottext">fwdHist :: HistOp SOACS -&gt; ADM (HistOp SOACS)
</span><a href="#local-6989586621684466200"><span class="hs-identifier hs-var hs-var">fwdHist</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.SOACS.SOAC.html#HistOp"><span class="hs-identifier hs-type">HistOp</span></a></span><span> </span><span id="local-6989586621684466197"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684466197"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span id="local-6989586621684466196"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466196"><span class="hs-identifier hs-var">rf</span></a></span></span><span> </span><span id="local-6989586621684466195"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466195"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span id="local-6989586621684466194"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466194"><span class="hs-identifier hs-var">nes</span></a></span></span><span> </span><span id="local-6989586621684466193"><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466193"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-337"></span><span>      </span><span id="local-6989586621684466192"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466192"><span class="hs-identifier hs-var">dest'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; ADM (BundledTan [VName])
forall a. Tangent a =&gt; a -&gt; ADM (BundledTan a)
</span><a href="Futhark.AD.Fwd.html#bundleTan"><span class="hs-identifier hs-var">bundleTan</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466195"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-338"></span><span>      </span><span id="local-6989586621684466191"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466191"><span class="hs-identifier hs-var">nes_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; ADM SubExp) -&gt; [SubExp] -&gt; ADM [SubExp]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(VName -&gt; SubExp) -&gt; ADM VName -&gt; ADM SubExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; SubExp
</span><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">(ADM VName -&gt; ADM SubExp)
-&gt; (SubExp -&gt; ADM VName) -&gt; SubExp -&gt; ADM SubExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; ADM VName
</span><a href="Futhark.AD.Fwd.html#zeroFromSubExp"><span class="hs-identifier hs-var">zeroFromSubExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466194"><span class="hs-identifier hs-var">nes</span></a></span><span>
</span><span id="line-339"></span><span>      </span><span id="local-6989586621684466190"><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466190"><span class="hs-identifier hs-var">op'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lambda -&gt; ADM Lambda
</span><a href="Futhark.AD.Fwd.html#fwdLambda"><span class="hs-identifier hs-var">fwdLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466193"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-340"></span><span>      </span><span class="annot"><span class="annottext">HistOp SOACS -&gt; ADM (HistOp SOACS)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(HistOp SOACS -&gt; ADM (HistOp SOACS))
-&gt; HistOp SOACS -&gt; ADM (HistOp SOACS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-341"></span><span>        </span><span class="annot"><span class="annottext">HistOp :: forall rep.
Shape -&gt; SubExp -&gt; [VName] -&gt; [SubExp] -&gt; Lambda rep -&gt; HistOp rep
</span><a href="Futhark.IR.SOACS.SOAC.html#HistOp"><span class="hs-identifier hs-type">HistOp</span></a></span><span>
</span><span id="line-342"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">histShape :: Shape
</span><a href="Futhark.IR.SOACS.SOAC.html#histShape"><span class="hs-identifier hs-var">histShape</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684466197"><span class="hs-identifier hs-var">shape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-343"></span><span>            </span><span class="annot"><span class="annottext">histRaceFactor :: SubExp
</span><a href="Futhark.IR.SOACS.SOAC.html#histRaceFactor"><span class="hs-identifier hs-var">histRaceFactor</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466196"><span class="hs-identifier hs-var">rf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-344"></span><span>            </span><span class="annot"><span class="annottext">histDest :: [VName]
</span><a href="Futhark.IR.SOACS.SOAC.html#histDest"><span class="hs-identifier hs-var">histDest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466192"><span class="hs-identifier hs-var">dest'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-345"></span><span>            </span><span class="annot"><span class="annottext">histNeutral :: [SubExp]
</span><a href="Futhark.IR.SOACS.SOAC.html#histNeutral"><span class="hs-identifier hs-var">histNeutral</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SubExp] -&gt; [SubExp] -&gt; [SubExp]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="Futhark.AD.Fwd.html#interleave"><span class="hs-identifier hs-var">interleave</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466194"><span class="hs-identifier hs-var">nes</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466191"><span class="hs-identifier hs-var">nes_tan</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-346"></span><span>            </span><span class="annot"><span class="annottext">histOp :: Lambda
</span><a href="Futhark.IR.SOACS.SOAC.html#histOp"><span class="hs-identifier hs-var">histOp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466190"><span class="hs-identifier hs-var">op'</span></a></span><span>
</span><span id="line-347"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-348"></span><span class="annot"><a href="Futhark.AD.Fwd.html#fwdSOAC"><span class="hs-identifier hs-var">fwdSOAC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span id="local-6989586621684466184"><span class="annot"><span class="annottext">[PatElemT (LetDec SOACS)]
</span><a href="#local-6989586621684466184"><span class="hs-identifier hs-var">pes</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684466183"><span class="annot"><span class="annottext">StmAux ()
</span><a href="#local-6989586621684466183"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.SOACS.SOAC.html#Scatter"><span class="hs-identifier hs-type">Scatter</span></a></span><span> </span><span id="local-6989586621684466181"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466181"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621684466180"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466180"><span class="hs-identifier hs-var">ivs</span></a></span></span><span> </span><span id="local-6989586621684466179"><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466179"><span class="hs-identifier hs-var">lam</span></a></span></span><span> </span><span id="local-6989586621684466178"><span class="annot"><span class="annottext">[(Shape, Int, VName)]
</span><a href="#local-6989586621684466178"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-349"></span><span>  </span><span id="local-6989586621684466177"><span class="annot"><span class="annottext">[(Shape, Int, VName)]
</span><a href="#local-6989586621684466177"><span class="hs-identifier hs-var">as_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Shape, Int, VName) -&gt; ADM (Shape, Int, VName))
-&gt; [(Shape, Int, VName)] -&gt; ADM [(Shape, Int, VName)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621684466176"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684466176"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684466175"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684466175"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684466174"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466174"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621684466173"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466173"><span class="hs-identifier hs-var">a_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; ADM VName
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466174"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Shape, Int, VName) -&gt; ADM (Shape, Int, VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684466176"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684466175"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466173"><span class="hs-identifier hs-var">a_tan</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Shape, Int, VName)]
</span><a href="#local-6989586621684466178"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-350"></span><span>  </span><span id="local-6989586621684466172"><span class="annot"><span class="annottext">[PatElemT Type]
</span><a href="#local-6989586621684466172"><span class="hs-identifier hs-var">pes_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[PatElemT Type] -&gt; ADM [PatElemT Type]
forall a. TanBuilder a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#newTan"><span class="hs-identifier hs-var">newTan</span></a></span><span> </span><span class="annot"><span class="annottext">[PatElemT Type]
[PatElemT (LetDec SOACS)]
</span><a href="#local-6989586621684466184"><span class="hs-identifier hs-var">pes</span></a></span><span>
</span><span id="line-351"></span><span>  </span><span id="local-6989586621684466171"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466171"><span class="hs-identifier hs-var">ivs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; ADM (BundledTan [VName])
forall a. Tangent a =&gt; a -&gt; ADM (BundledTan a)
</span><a href="Futhark.AD.Fwd.html#bundleTan"><span class="hs-identifier hs-var">bundleTan</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466180"><span class="hs-identifier hs-var">ivs</span></a></span><span>
</span><span id="line-352"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684466170"><span class="annot"><span class="annottext">[Shape]
</span><a href="#local-6989586621684466170"><span class="hs-identifier hs-var">as_ws</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684466169"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684466169"><span class="hs-identifier hs-var">as_ns</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684466168"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466168"><span class="hs-identifier hs-var">_as_vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Shape, Int, VName)] -&gt; ([Shape], [Int], [VName])
forall a b c. [(a, b, c)] -&gt; ([a], [b], [c])
</span><span class="hs-identifier hs-var">unzip3</span></span><span> </span><span class="annot"><span class="annottext">[(Shape, Int, VName)]
</span><a href="#local-6989586621684466178"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-353"></span><span>      </span><span id="local-6989586621684466166"><span class="annot"><span class="annottext">n_indices :: Int
</span><a href="#local-6989586621684466166"><span class="hs-identifier hs-var hs-var">n_indices</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Int) -&gt; [Int] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int) -&gt; [Int] -&gt; [Int] -&gt; [Int]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(*)</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621684466169"><span class="hs-identifier hs-var">as_ns</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int]) -&gt; [Int] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Shape -&gt; Int) -&gt; [Shape] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Shape -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Shape]
</span><a href="#local-6989586621684466170"><span class="hs-identifier hs-var">as_ws</span></a></span><span>
</span><span id="line-354"></span><span>  </span><span id="local-6989586621684466161"><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466161"><span class="hs-identifier hs-var">lam'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Lambda -&gt; ADM Lambda
</span><a href="#local-6989586621684466160"><span class="hs-identifier hs-var">fwdScatterLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684466166"><span class="hs-identifier hs-var">n_indices</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466179"><span class="hs-identifier hs-var">lam</span></a></span><span>
</span><span id="line-355"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684466159"><span class="annot"><span class="annottext">s :: Stm
</span><a href="#local-6989586621684466159"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PatElemT Type] -&gt; PatT Type
forall dec. [PatElemT dec] -&gt; PatT dec
</span><a href="Futhark.IR.Syntax.html#Pat"><span class="hs-identifier hs-var">Pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PatElemT Type]
[PatElemT (LetDec SOACS)]
</span><a href="#local-6989586621684466184"><span class="hs-identifier hs-var">pes</span></a></span><span> </span><span class="annot"><span class="annottext">[PatElemT Type] -&gt; [PatElemT Type] -&gt; [PatElemT Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PatElemT Type]
</span><a href="#local-6989586621684466172"><span class="hs-identifier hs-var">pes_tan</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466183"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Op SOACS -&gt; Exp
forall rep. Op rep -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#Op"><span class="hs-identifier hs-var">Op</span></a></span><span> </span><span class="annot"><span class="annottext">(Op SOACS -&gt; Exp) -&gt; Op SOACS -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; [VName] -&gt; Lambda -&gt; [(Shape, Int, VName)] -&gt; SOAC SOACS
forall rep.
SubExp
-&gt; [VName] -&gt; Lambda rep -&gt; [(Shape, Int, VName)] -&gt; SOAC rep
</span><a href="Futhark.IR.SOACS.SOAC.html#Scatter"><span class="hs-identifier hs-var">Scatter</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466181"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466171"><span class="hs-identifier hs-var">ivs'</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466161"><span class="hs-identifier hs-var">lam'</span></a></span><span> </span><span class="annot"><span class="annottext">([(Shape, Int, VName)] -&gt; SOAC SOACS)
-&gt; [(Shape, Int, VName)] -&gt; SOAC SOACS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Shape, Int, VName)]
</span><a href="#local-6989586621684466178"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">[(Shape, Int, VName)]
-&gt; [(Shape, Int, VName)] -&gt; [(Shape, Int, VName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Shape, Int, VName)]
</span><a href="#local-6989586621684466177"><span class="hs-identifier hs-var">as_tan</span></a></span><span>
</span><span id="line-356"></span><span>  </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">Stm (Rep ADM)
Stm
</span><a href="#local-6989586621684466159"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-357"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-358"></span><span>    </span><span class="annot"><a href="#local-6989586621684466160"><span class="hs-identifier hs-type">fwdScatterLambda</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span>
</span><span id="line-359"></span><span>    </span><span id="local-6989586621684466160"><span class="annot"><span class="annottext">fwdScatterLambda :: Int -&gt; Lambda -&gt; ADM Lambda
</span><a href="#local-6989586621684466160"><span class="hs-identifier hs-var hs-var">fwdScatterLambda</span></a></span></span><span> </span><span id="local-6989586621684466158"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684466158"><span class="hs-identifier hs-var">n_indices</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span id="local-6989586621684466157"><span class="annot"><span class="annottext">[LParam SOACS]
</span><a href="#local-6989586621684466157"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621684466156"><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466156"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621684466155"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684466155"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-360"></span><span>      </span><span id="local-6989586621684466154"><span class="annot"><span class="annottext">[Param Type]
</span><a href="#local-6989586621684466154"><span class="hs-identifier hs-var">params'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Param Type] -&gt; ADM (Bundled [Param Type])
forall a. TanBuilder a =&gt; a -&gt; ADM (Bundled a)
</span><a href="Futhark.AD.Fwd.html#bundleNew"><span class="hs-identifier hs-var">bundleNew</span></a></span><span> </span><span class="annot"><span class="annottext">[Param Type]
[LParam SOACS]
</span><a href="#local-6989586621684466157"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-361"></span><span>      </span><span id="local-6989586621684466153"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684466153"><span class="hs-identifier hs-var">ret_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; ADM [Type]
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">([Type] -&gt; ADM [Type]) -&gt; [Type] -&gt; ADM [Type]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Type] -&gt; [Type]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684466158"><span class="hs-identifier hs-var">n_indices</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684466155"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-362"></span><span>      </span><span id="local-6989586621684466152"><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466152"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Body SOACS -&gt; ADM (Body SOACS)
</span><a href="#local-6989586621684466151"><span class="hs-identifier hs-var">fwdBodyScatter</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684466158"><span class="hs-identifier hs-var">n_indices</span></a></span><span> </span><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466156"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-363"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684466150"><span class="annot"><span class="annottext">indices :: [Type]
</span><a href="#local-6989586621684466150"><span class="hs-identifier hs-var hs-var">indices</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[Type]] -&gt; [Type]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[Type]] -&gt; [Type]) -&gt; [[Type]] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Type] -&gt; [[Type]]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">([Type] -&gt; [[Type]]) -&gt; [Type] -&gt; [[Type]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Type] -&gt; [Type]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684466158"><span class="hs-identifier hs-var">n_indices</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684466155"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-364"></span><span>          </span><span id="local-6989586621684466148"><span class="annot"><span class="annottext">ret' :: [Type]
</span><a href="#local-6989586621684466148"><span class="hs-identifier hs-var hs-var">ret'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684466150"><span class="hs-identifier hs-var">indices</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Type] -&gt; [Type]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684466158"><span class="hs-identifier hs-var">n_indices</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684466155"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684466153"><span class="hs-identifier hs-var">ret_tan</span></a></span><span>
</span><span id="line-365"></span><span>      </span><span class="annot"><span class="annottext">Lambda -&gt; ADM Lambda
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Lambda -&gt; ADM Lambda) -&gt; Lambda -&gt; ADM Lambda
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[LParam SOACS] -&gt; Body SOACS -&gt; [Type] -&gt; Lambda
forall rep. [LParam rep] -&gt; BodyT rep -&gt; [Type] -&gt; LambdaT rep
</span><a href="Futhark.IR.Syntax.html#Lambda"><span class="hs-identifier hs-var">Lambda</span></a></span><span> </span><span class="annot"><span class="annottext">[Param Type]
[LParam SOACS]
</span><a href="#local-6989586621684466154"><span class="hs-identifier hs-var">params'</span></a></span><span> </span><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466152"><span class="hs-identifier hs-var">body'</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684466148"><span class="hs-identifier hs-var">ret'</span></a></span><span>
</span><span id="line-366"></span><span>    </span><span class="annot"><a href="#local-6989586621684466151"><span class="hs-identifier hs-type">fwdBodyScatter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#Body"><span class="hs-identifier hs-type">Body</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#Body"><span class="hs-identifier hs-type">Body</span></a></span><span>
</span><span id="line-367"></span><span>    </span><span id="local-6989586621684466151"><span class="annot"><span class="annottext">fwdBodyScatter :: Int -&gt; Body SOACS -&gt; ADM (Body SOACS)
</span><a href="#local-6989586621684466151"><span class="hs-identifier hs-var hs-var">fwdBodyScatter</span></a></span></span><span> </span><span id="local-6989586621684466146"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684466146"><span class="hs-identifier hs-var">n_indices</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Body"><span class="hs-identifier hs-type">Body</span></a></span><span> </span><span class="annot"><span class="annottext">BodyDec SOACS
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684466144"><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684466144"><span class="hs-identifier hs-var">stms</span></a></span></span><span> </span><span id="local-6989586621684466143"><span class="annot"><span class="annottext">[SubExpRes]
</span><a href="#local-6989586621684466143"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-368"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684466142"><span class="annot"><span class="annottext">[SubExpRes]
</span><a href="#local-6989586621684466142"><span class="hs-identifier hs-var">res_tan</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684466141"><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684466141"><span class="hs-identifier hs-var">stms'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ADM [SubExpRes] -&gt; ADM ([SubExpRes], Stms (Rep ADM))
forall (m :: * -&gt; *) a.
MonadBuilder m =&gt;
m a -&gt; m (a, Stms (Rep m))
</span><a href="Futhark.Builder.Class.html#collectStms"><span class="hs-identifier hs-var">collectStms</span></a></span><span> </span><span class="annot"><span class="annottext">(ADM [SubExpRes] -&gt; ADM ([SubExpRes], Stms (Rep ADM)))
-&gt; ADM [SubExpRes] -&gt; ADM ([SubExpRes], Stms (Rep ADM))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-369"></span><span>        </span><span class="annot"><span class="annottext">(Stm -&gt; ADM ()) -&gt; Stms SOACS -&gt; ADM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Stm -&gt; ADM ()
</span><a href="Futhark.AD.Fwd.html#fwdStm"><span class="hs-identifier hs-var">fwdStm</span></a></span><span> </span><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684466144"><span class="hs-identifier hs-var">stms</span></a></span><span>
</span><span id="line-370"></span><span>        </span><span class="annot"><span class="annottext">[SubExpRes] -&gt; ADM [SubExpRes]
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">([SubExpRes] -&gt; ADM [SubExpRes]) -&gt; [SubExpRes] -&gt; ADM [SubExpRes]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [SubExpRes] -&gt; [SubExpRes]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684466146"><span class="hs-identifier hs-var">n_indices</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExpRes]
</span><a href="#local-6989586621684466143"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-371"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684466138"><span class="annot"><span class="annottext">indices :: [SubExpRes]
</span><a href="#local-6989586621684466138"><span class="hs-identifier hs-var hs-var">indices</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[SubExpRes]] -&gt; [SubExpRes]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[SubExpRes]] -&gt; [SubExpRes]) -&gt; [[SubExpRes]] -&gt; [SubExpRes]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [SubExpRes] -&gt; [[SubExpRes]]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">([SubExpRes] -&gt; [[SubExpRes]]) -&gt; [SubExpRes] -&gt; [[SubExpRes]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [SubExpRes] -&gt; [SubExpRes]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684466146"><span class="hs-identifier hs-var">n_indices</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExpRes]
</span><a href="#local-6989586621684466143"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-372"></span><span>          </span><span id="local-6989586621684466137"><span class="annot"><span class="annottext">res' :: [SubExpRes]
</span><a href="#local-6989586621684466137"><span class="hs-identifier hs-var hs-var">res'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SubExpRes]
</span><a href="#local-6989586621684466138"><span class="hs-identifier hs-var">indices</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExpRes] -&gt; [SubExpRes] -&gt; [SubExpRes]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [SubExpRes] -&gt; [SubExpRes]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684466146"><span class="hs-identifier hs-var">n_indices</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExpRes]
</span><a href="#local-6989586621684466143"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExpRes] -&gt; [SubExpRes] -&gt; [SubExpRes]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[SubExpRes]
</span><a href="#local-6989586621684466142"><span class="hs-identifier hs-var">res_tan</span></a></span><span>
</span><span id="line-373"></span><span>      </span><span class="annot"><span class="annottext">Body SOACS -&gt; ADM (Body SOACS)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Body SOACS -&gt; ADM (Body SOACS)) -&gt; Body SOACS -&gt; ADM (Body SOACS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Stms SOACS -&gt; [SubExpRes] -&gt; Body SOACS
forall rep. Buildable rep =&gt; Stms rep -&gt; [SubExpRes] -&gt; Body rep
</span><a href="Futhark.Builder.Class.html#mkBody"><span class="hs-identifier hs-var">mkBody</span></a></span><span> </span><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684466141"><span class="hs-identifier hs-var">stms'</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExpRes]
</span><a href="#local-6989586621684466137"><span class="hs-identifier hs-var">res'</span></a></span><span>
</span><span id="line-374"></span><span class="annot"><a href="Futhark.AD.Fwd.html#fwdSOAC"><span class="hs-identifier hs-var">fwdSOAC</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">StmAux ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.SOAC.html#JVP"><span class="hs-identifier hs-type">JVP</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-375"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; ADM ()
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;fwdSOAC: nested JVP not allowed.&quot;</span></span><span>
</span><span id="line-376"></span><span class="annot"><a href="Futhark.AD.Fwd.html#fwdSOAC"><span class="hs-identifier hs-var">fwdSOAC</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">StmAux ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.SOAC.html#VJP"><span class="hs-identifier hs-type">VJP</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-377"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; ADM ()
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;fwdSOAC: nested VJP not allowed.&quot;</span></span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span class="annot"><a href="Futhark.AD.Fwd.html#fwdStm"><span class="hs-identifier hs-type">fwdStm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#Stm"><span class="hs-identifier hs-type">Stm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span id="fwdStm"><span class="annot"><span class="annottext">fwdStm :: Stm -&gt; ADM ()
</span><a href="Futhark.AD.Fwd.html#fwdStm"><span class="hs-identifier hs-var hs-var">fwdStm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621684466133"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684466133"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684466132"><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466132"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-type">BasicOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#UpdateAcc"><span class="hs-identifier hs-type">UpdateAcc</span></a></span><span> </span><span id="local-6989586621684466130"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466130"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621684466129"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466129"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621684466128"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466128"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-381"></span><span>  </span><span id="local-6989586621684466127"><span class="annot"><span class="annottext">PatT Type
</span><a href="#local-6989586621684466127"><span class="hs-identifier hs-var">pat'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatT Type -&gt; ADM (Bundled (PatT Type))
forall a. TanBuilder a =&gt; a -&gt; ADM (Bundled a)
</span><a href="Futhark.AD.Fwd.html#bundleNew"><span class="hs-identifier hs-var">bundleNew</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466133"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-382"></span><span>  </span><span id="local-6989586621684466126"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466126"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SubExp] -&gt; ADM (BundledTan [SubExp])
forall a. Tangent a =&gt; a -&gt; ADM (BundledTan a)
</span><a href="Futhark.AD.Fwd.html#bundleTan"><span class="hs-identifier hs-var">bundleTan</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466128"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-383"></span><span>  </span><span id="local-6989586621684466125"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466125"><span class="hs-identifier hs-var">acc_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; ADM VName
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466130"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-384"></span><span>  </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466127"><span class="hs-identifier hs-var">pat'</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466132"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; Exp
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; Exp) -&gt; BasicOp -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; [SubExp] -&gt; [SubExp] -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#UpdateAcc"><span class="hs-identifier hs-var">UpdateAcc</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466125"><span class="hs-identifier hs-var">acc_tan</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466129"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466126"><span class="hs-identifier hs-var">x'</span></a></span><span>
</span><span id="line-385"></span><span class="annot"><a href="Futhark.AD.Fwd.html#fwdStm"><span class="hs-identifier hs-var">fwdStm</span></a></span><span> </span><span id="local-6989586621684466124"><span class="annot"><span class="annottext">stm :: Stm
</span><a href="#local-6989586621684466124"><span class="hs-identifier hs-var">stm</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621684466123"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684466123"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684466122"><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466122"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-type">BasicOp</span></a></span><span> </span><span id="local-6989586621684466121"><span class="annot"><span class="annottext">BasicOp
</span><a href="#local-6989586621684466121"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-comment">-- XXX: this has to be too naive.</span><span>
</span><span id="line-387"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ADM () -&gt; ADM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; [Type] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
forall s u. TypeBase s u -&gt; Bool
</span><a href="Futhark.AD.Fwd.html#isAcc"><span class="hs-identifier hs-var">isAcc</span></a></span><span> </span><span class="annot"><span class="annottext">([Type] -&gt; Bool) -&gt; [Type] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatT Type -&gt; [Type]
forall dec. Typed dec =&gt; PatT dec -&gt; [Type]
</span><a href="Futhark.IR.Prop.Patterns.html#patTypes"><span class="hs-identifier hs-var">patTypes</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466123"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ADM () -&gt; ADM ()) -&gt; ADM () -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-388"></span><span>    </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">Stm (Rep ADM)
Stm
</span><a href="#local-6989586621684466124"><span class="hs-identifier hs-var">stm</span></a></span><span>
</span><span id="line-389"></span><span>  </span><span class="annot"><span class="annottext">Pat -&gt; StmAux () -&gt; BasicOp -&gt; ADM ()
</span><a href="Futhark.AD.Fwd.html#basicFwd"><span class="hs-identifier hs-var">basicFwd</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684466123"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466122"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">BasicOp
</span><a href="#local-6989586621684466121"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-390"></span><span class="annot"><a href="Futhark.AD.Fwd.html#fwdStm"><span class="hs-identifier hs-var">fwdStm</span></a></span><span> </span><span id="local-6989586621684466117"><span class="annot"><span class="annottext">stm :: Stm
</span><a href="#local-6989586621684466117"><span class="hs-identifier hs-var">stm</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621684466116"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684466116"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621684466114"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684466114"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621684466113"><span class="annot"><span class="annottext">[(SubExp, Diet)]
</span><a href="#local-6989586621684466113"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="annot"><span class="annottext">[RetType SOACS]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(Safety, SrcLoc, [SrcLoc])
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684466112"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466112"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684466111"><span class="annot"><span class="annottext">[PrimType]
</span><a href="#local-6989586621684466111"><span class="hs-identifier hs-var">argts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; Map Name (PrimType, [PrimType]) -&gt; Maybe (PrimType, [PrimType])
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684466114"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (PrimType, [PrimType])
</span><a href="Futhark.IR.Prop.html#builtInFunctions"><span class="hs-identifier hs-var">builtInFunctions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-392"></span><span>    </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">Stm (Rep ADM)
Stm
</span><a href="#local-6989586621684466117"><span class="hs-identifier hs-var">stm</span></a></span><span>
</span><span id="line-393"></span><span>    </span><span id="local-6989586621684466109"><span class="annot"><span class="annottext">[PrimExp VName]
</span><a href="#local-6989586621684466109"><span class="hs-identifier hs-var">arg_tans</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-394"></span><span>      </span><span class="annot"><span class="annottext">(PrimType -&gt; SubExp -&gt; PrimExp VName)
-&gt; [PrimType] -&gt; [SubExp] -&gt; [PrimExp VName]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; SubExp -&gt; PrimExp VName
</span><a href="Futhark.Analysis.PrimExp.Convert.html#primExpFromSubExp"><span class="hs-identifier hs-var">primExpFromSubExp</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimType]
</span><a href="#local-6989586621684466111"><span class="hs-identifier hs-var">argts</span></a></span><span> </span><span class="annot"><span class="annottext">([SubExp] -&gt; [PrimExp VName])
-&gt; ADM [SubExp] -&gt; ADM [PrimExp VName]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">((SubExp, Diet) -&gt; ADM SubExp) -&gt; [(SubExp, Diet)] -&gt; ADM [SubExp]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubExp -&gt; ADM SubExp
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; ADM SubExp)
-&gt; ((SubExp, Diet) -&gt; SubExp) -&gt; (SubExp, Diet) -&gt; ADM SubExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(SubExp, Diet) -&gt; SubExp
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(SubExp, Diet)]
</span><a href="#local-6989586621684466113"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-395"></span><span>    </span><span id="local-6989586621684466108"><span class="annot"><span class="annottext">PatT Type
</span><a href="#local-6989586621684466108"><span class="hs-identifier hs-var">pat_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatT Type -&gt; ADM (PatT Type)
forall a. TanBuilder a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#newTan"><span class="hs-identifier hs-var">newTan</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466116"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-396"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684466107"><span class="annot"><span class="annottext">arg_pes :: [PrimExp VName]
</span><a href="#local-6989586621684466107"><span class="hs-identifier hs-var hs-var">arg_pes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PrimType -&gt; SubExp -&gt; PrimExp VName)
-&gt; [PrimType] -&gt; [SubExp] -&gt; [PrimExp VName]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; SubExp -&gt; PrimExp VName
</span><a href="Futhark.Analysis.PrimExp.Convert.html#primExpFromSubExp"><span class="hs-identifier hs-var">primExpFromSubExp</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimType]
</span><a href="#local-6989586621684466111"><span class="hs-identifier hs-var">argts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((SubExp, Diet) -&gt; SubExp) -&gt; [(SubExp, Diet)] -&gt; [SubExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(SubExp, Diet) -&gt; SubExp
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(SubExp, Diet)]
</span><a href="#local-6989586621684466113"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [PrimExp VName] -&gt; Maybe [PrimExp VName]
</span><a href="Futhark.AD.Derivatives.html#pdBuiltin"><span class="hs-identifier hs-var">pdBuiltin</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684466114"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimExp VName]
</span><a href="#local-6989586621684466107"><span class="hs-identifier hs-var">arg_pes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-398"></span><span>      </span><span class="annot"><span class="annottext">Maybe [PrimExp VName]
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-399"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; ADM ()
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ADM ()) -&gt; [Char] -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;No partial derivative defined for builtin function: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684466114"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-400"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684466105"><span class="annot"><span class="annottext">[PrimExp VName]
</span><a href="#local-6989586621684466105"><span class="hs-identifier hs-var">derivs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-401"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684466093"><span class="annot"><span class="annottext">convertTo :: PrimType -&gt; PrimExp v -&gt; PrimExp v
</span><a href="#local-6989586621684466093"><span class="hs-identifier hs-var hs-var">convertTo</span></a></span></span><span> </span><span id="local-6989586621684466092"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466092"><span class="hs-identifier hs-var">tt</span></a></span></span><span> </span><span id="local-6989586621684466091"><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684466091"><span class="hs-identifier hs-var">e</span></a></span></span><span>
</span><span id="line-402"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466090"><span class="hs-identifier hs-var">e_t</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; PrimType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466092"><span class="hs-identifier hs-var">tt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684466091"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-403"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-404"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466092"><span class="hs-identifier hs-var">tt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466090"><span class="hs-identifier hs-var">e_t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-405"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span id="local-6989586621684466088"><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684466088"><span class="hs-identifier hs-var">tt'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span id="local-6989586621684466087"><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684466087"><span class="hs-identifier hs-var">ft</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConvOp -&gt; PrimExp v -&gt; PrimExp v
forall v. ConvOp -&gt; PrimExp v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#ConvOpExp"><span class="hs-identifier hs-var">ConvOpExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntType -&gt; IntType -&gt; ConvOp
</span><a href="Futhark.IR.Primitive.html#SExt"><span class="hs-identifier hs-var">SExt</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684466087"><span class="hs-identifier hs-var">ft</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684466088"><span class="hs-identifier hs-var">tt'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684466091"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-406"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span id="local-6989586621684466083"><span class="annot"><span class="annottext">FloatType
</span><a href="#local-6989586621684466083"><span class="hs-identifier hs-var">tt'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span id="local-6989586621684466082"><span class="annot"><span class="annottext">FloatType
</span><a href="#local-6989586621684466082"><span class="hs-identifier hs-var">ft</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConvOp -&gt; PrimExp v -&gt; PrimExp v
forall v. ConvOp -&gt; PrimExp v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#ConvOpExp"><span class="hs-identifier hs-var">ConvOpExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FloatType -&gt; FloatType -&gt; ConvOp
</span><a href="Futhark.IR.Primitive.html#FPConv"><span class="hs-identifier hs-var">FPConv</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="#local-6989586621684466082"><span class="hs-identifier hs-var">ft</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="#local-6989586621684466083"><span class="hs-identifier hs-var">tt'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684466091"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-407"></span><span>                  </span><span class="annot"><span class="annottext">(PrimType, PrimType)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PrimExp v
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PrimExp v) -&gt; [Char] -&gt; PrimExp v
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;fwdStm.convertTo: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(PrimType, PrimType) -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466092"><span class="hs-identifier hs-var">tt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466090"><span class="hs-identifier hs-var">e_t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-409"></span><span>                </span><span id="local-6989586621684466090"><span class="annot"><span class="annottext">e_t :: PrimType
</span><a href="#local-6989586621684466090"><span class="hs-identifier hs-var hs-var">e_t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimExp v -&gt; PrimType
forall v. PrimExp v -&gt; PrimType
</span><a href="Futhark.Analysis.PrimExp.html#primExpType"><span class="hs-identifier hs-var">primExpType</span></a></span><span> </span><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684466091"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-410"></span><span>        </span><span class="annot"><span class="annottext">(VName -&gt; Exp -&gt; ADM ()) -&gt; [VName] -&gt; [Exp] -&gt; ADM ()
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m ()
</span><span class="hs-identifier hs-var">zipWithM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[VName] -&gt; Exp -&gt; ADM ()
forall (m :: * -&gt; *).
MonadBuilder m =&gt;
[VName] -&gt; Exp (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#letBindNames"><span class="hs-identifier hs-var">letBindNames</span></a></span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; Exp -&gt; ADM ())
-&gt; (VName -&gt; [VName]) -&gt; VName -&gt; Exp -&gt; ADM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; [VName]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatT Type -&gt; [VName]
forall dec. PatT dec -&gt; [VName]
</span><a href="Futhark.IR.Prop.Patterns.html#patNames"><span class="hs-identifier hs-var">patNames</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
</span><a href="#local-6989586621684466108"><span class="hs-identifier hs-var">pat_tan</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span>          </span><span class="annot"><span class="annottext">([Exp] -&gt; ADM ()) -&gt; ADM [Exp] -&gt; ADM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">(PrimExp VName -&gt; ADM Exp) -&gt; [PrimExp VName] -&gt; ADM [Exp]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">PrimExp VName -&gt; ADM Exp
forall a (m :: * -&gt; *).
(ToExp a, MonadBuilder m) =&gt;
a -&gt; m (Exp (Rep m))
</span><a href="Futhark.Construct.html#toExp"><span class="hs-identifier hs-var">toExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PrimExp VName -&gt; PrimExp VName -&gt; PrimExp VName)
-&gt; [PrimExp VName] -&gt; [PrimExp VName] -&gt; [PrimExp VName]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">PrimExp VName -&gt; PrimExp VName -&gt; PrimExp VName
forall v. PrimExp v -&gt; PrimExp v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#~%2A~"><span class="hs-operator hs-var">(~*~)</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PrimExp VName -&gt; PrimExp VName)
-&gt; [PrimExp VName] -&gt; [PrimExp VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType -&gt; PrimExp VName -&gt; PrimExp VName
forall {v}. PrimType -&gt; PrimExp v -&gt; PrimExp v
</span><a href="#local-6989586621684466093"><span class="hs-identifier hs-var">convertTo</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684466112"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PrimExp VName]
</span><a href="#local-6989586621684466109"><span class="hs-identifier hs-var">arg_tans</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PrimExp VName]
</span><a href="#local-6989586621684466105"><span class="hs-identifier hs-var">derivs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span class="annot"><a href="Futhark.AD.Fwd.html#fwdStm"><span class="hs-identifier hs-var">fwdStm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621684466077"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684466077"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684466076"><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466076"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#If"><span class="hs-identifier hs-type">If</span></a></span><span> </span><span id="local-6989586621684466074"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466074"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span id="local-6989586621684466073"><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466073"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621684466072"><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466072"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#IfDec"><span class="hs-identifier hs-type">IfDec</span></a></span><span> </span><span id="local-6989586621684466070"><span class="annot"><span class="annottext">[BranchType SOACS]
</span><a href="#local-6989586621684466070"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span id="local-6989586621684466069"><span class="annot"><span class="annottext">IfSort
</span><a href="#local-6989586621684466069"><span class="hs-identifier hs-var">ifsort</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-413"></span><span>  </span><span id="local-6989586621684466068"><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466068"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ADM (Body SOACS) -&gt; ADM (Body SOACS)
forall a. ADM a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#slocal%27"><span class="hs-identifier hs-var">slocal'</span></a></span><span> </span><span class="annot"><span class="annottext">(ADM (Body SOACS) -&gt; ADM (Body SOACS))
-&gt; ADM (Body SOACS) -&gt; ADM (Body SOACS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Body SOACS -&gt; ADM (Body SOACS)
</span><a href="Futhark.AD.Fwd.html#fwdBody"><span class="hs-identifier hs-var">fwdBody</span></a></span><span> </span><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466073"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-414"></span><span>  </span><span id="local-6989586621684466067"><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466067"><span class="hs-identifier hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ADM (Body SOACS) -&gt; ADM (Body SOACS)
forall a. ADM a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#slocal%27"><span class="hs-identifier hs-var">slocal'</span></a></span><span> </span><span class="annot"><span class="annottext">(ADM (Body SOACS) -&gt; ADM (Body SOACS))
-&gt; ADM (Body SOACS) -&gt; ADM (Body SOACS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Body SOACS -&gt; ADM (Body SOACS)
</span><a href="Futhark.AD.Fwd.html#fwdBody"><span class="hs-identifier hs-var">fwdBody</span></a></span><span> </span><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466072"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-415"></span><span>  </span><span id="local-6989586621684466066"><span class="annot"><span class="annottext">PatT Type
</span><a href="#local-6989586621684466066"><span class="hs-identifier hs-var">pat'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatT Type -&gt; ADM (Bundled (PatT Type))
forall a. TanBuilder a =&gt; a -&gt; ADM (Bundled a)
</span><a href="Futhark.AD.Fwd.html#bundleNew"><span class="hs-identifier hs-var">bundleNew</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466077"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-416"></span><span>  </span><span id="local-6989586621684466065"><span class="annot"><span class="annottext">[ExtType]
</span><a href="#local-6989586621684466065"><span class="hs-identifier hs-var">ret'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ExtType] -&gt; ADM (BundledTan [ExtType])
forall a. Tangent a =&gt; a -&gt; ADM (BundledTan a)
</span><a href="Futhark.AD.Fwd.html#bundleTan"><span class="hs-identifier hs-var">bundleTan</span></a></span><span> </span><span class="annot"><span class="annottext">[ExtType]
[BranchType SOACS]
</span><a href="#local-6989586621684466070"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-417"></span><span>  </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466066"><span class="hs-identifier hs-var">pat'</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466076"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SubExp
-&gt; Body SOACS -&gt; Body SOACS -&gt; IfDec (BranchType SOACS) -&gt; Exp
forall rep.
SubExp
-&gt; BodyT rep -&gt; BodyT rep -&gt; IfDec (BranchType rep) -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#If"><span class="hs-identifier hs-var">If</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466074"><span class="hs-identifier hs-var">cond</span></a></span><span> </span><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466068"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466067"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">(IfDec (BranchType SOACS) -&gt; Exp)
-&gt; IfDec (BranchType SOACS) -&gt; Exp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ExtType] -&gt; IfSort -&gt; IfDec ExtType
forall rt. [rt] -&gt; IfSort -&gt; IfDec rt
</span><a href="Futhark.IR.Syntax.html#IfDec"><span class="hs-identifier hs-var">IfDec</span></a></span><span> </span><span class="annot"><span class="annottext">[ExtType]
</span><a href="#local-6989586621684466065"><span class="hs-identifier hs-var">ret'</span></a></span><span> </span><span class="annot"><span class="annottext">IfSort
</span><a href="#local-6989586621684466069"><span class="hs-identifier hs-var">ifsort</span></a></span><span>
</span><span id="line-418"></span><span class="annot"><a href="Futhark.AD.Fwd.html#fwdStm"><span class="hs-identifier hs-var">fwdStm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621684466064"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684466064"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684466063"><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466063"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#DoLoop"><span class="hs-identifier hs-type">DoLoop</span></a></span><span> </span><span id="local-6989586621684466061"><span class="annot"><span class="annottext">[(FParam SOACS, SubExp)]
</span><a href="#local-6989586621684466061"><span class="hs-identifier hs-var">val_pats</span></a></span></span><span> </span><span id="local-6989586621684466060"><span class="annot"><span class="annottext">loop :: LoopForm SOACS
</span><a href="#local-6989586621684466060"><span class="hs-identifier hs-var">loop</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#WhileLoop"><span class="hs-identifier hs-type">WhileLoop</span></a></span><span> </span><span id="local-6989586621684466058"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466058"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684466057"><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466057"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-419"></span><span>  </span><span id="local-6989586621684466056"><span class="annot"><span class="annottext">[(Param DeclType, SubExp)]
</span><a href="#local-6989586621684466056"><span class="hs-identifier hs-var">val_pats'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Param DeclType, SubExp)]
-&gt; ADM (Bundled [(Param DeclType, SubExp)])
forall a. TanBuilder a =&gt; a -&gt; ADM (Bundled a)
</span><a href="Futhark.AD.Fwd.html#bundleNew"><span class="hs-identifier hs-var">bundleNew</span></a></span><span> </span><span class="annot"><span class="annottext">[(Param DeclType, SubExp)]
[(FParam SOACS, SubExp)]
</span><a href="#local-6989586621684466061"><span class="hs-identifier hs-var">val_pats</span></a></span><span>
</span><span id="line-420"></span><span>  </span><span id="local-6989586621684466055"><span class="annot"><span class="annottext">PatT Type
</span><a href="#local-6989586621684466055"><span class="hs-identifier hs-var">pat'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatT Type -&gt; ADM (Bundled (PatT Type))
forall a. TanBuilder a =&gt; a -&gt; ADM (Bundled a)
</span><a href="Futhark.AD.Fwd.html#bundleNew"><span class="hs-identifier hs-var">bundleNew</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466064"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-421"></span><span>  </span><span id="local-6989586621684466054"><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466054"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-422"></span><span>    </span><span class="annot"><span class="annottext">Scope SOACS -&gt; ADM (Body SOACS) -&gt; ADM (Body SOACS)
forall rep (m :: * -&gt; *) a.
LocalScope rep m =&gt;
Scope rep -&gt; m a -&gt; m a
</span><a href="Futhark.IR.Prop.Scope.html#localScope"><span class="hs-identifier hs-var">localScope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Param DeclType] -&gt; Scope SOACS
forall rep dec. (FParamInfo rep ~ dec) =&gt; [Param dec] -&gt; Scope rep
</span><a href="Futhark.IR.Prop.Scope.html#scopeOfFParams"><span class="hs-identifier hs-var">scopeOfFParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Param DeclType, SubExp) -&gt; Param DeclType)
-&gt; [(Param DeclType, SubExp)] -&gt; [Param DeclType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Param DeclType, SubExp) -&gt; Param DeclType
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Param DeclType, SubExp)]
[(FParam SOACS, SubExp)]
</span><a href="#local-6989586621684466061"><span class="hs-identifier hs-var">val_pats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Scope SOACS -&gt; Scope SOACS -&gt; Scope SOACS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">LoopForm SOACS -&gt; Scope SOACS
forall rep a. Scoped rep a =&gt; a -&gt; Scope rep
</span><a href="Futhark.IR.Prop.Scope.html#scopeOf"><span class="hs-identifier hs-var">scopeOf</span></a></span><span> </span><span class="annot"><span class="annottext">LoopForm SOACS
</span><a href="#local-6989586621684466060"><span class="hs-identifier hs-var">loop</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ADM (Body SOACS) -&gt; ADM (Body SOACS))
-&gt; ADM (Body SOACS) -&gt; ADM (Body SOACS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-423"></span><span>      </span><span class="annot"><span class="annottext">ADM (Body SOACS) -&gt; ADM (Body SOACS)
forall a. ADM a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#slocal%27"><span class="hs-identifier hs-var">slocal'</span></a></span><span> </span><span class="annot"><span class="annottext">(ADM (Body SOACS) -&gt; ADM (Body SOACS))
-&gt; ADM (Body SOACS) -&gt; ADM (Body SOACS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Body SOACS -&gt; ADM (Body SOACS)
</span><a href="Futhark.AD.Fwd.html#fwdBody"><span class="hs-identifier hs-var">fwdBody</span></a></span><span> </span><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466057"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-424"></span><span>  </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466055"><span class="hs-identifier hs-var">pat'</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466063"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(FParam SOACS, SubExp)] -&gt; LoopForm SOACS -&gt; Body SOACS -&gt; Exp
forall rep.
[(FParam rep, SubExp)] -&gt; LoopForm rep -&gt; BodyT rep -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#DoLoop"><span class="hs-identifier hs-var">DoLoop</span></a></span><span> </span><span class="annot"><span class="annottext">[(Param DeclType, SubExp)]
[(FParam SOACS, SubExp)]
</span><a href="#local-6989586621684466056"><span class="hs-identifier hs-var">val_pats'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; LoopForm SOACS
forall rep. VName -&gt; LoopForm rep
</span><a href="Futhark.IR.Syntax.html#WhileLoop"><span class="hs-identifier hs-var">WhileLoop</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466058"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466054"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-425"></span><span class="annot"><a href="Futhark.AD.Fwd.html#fwdStm"><span class="hs-identifier hs-var">fwdStm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621684466050"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684466050"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684466049"><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466049"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#DoLoop"><span class="hs-identifier hs-type">DoLoop</span></a></span><span> </span><span id="local-6989586621684466048"><span class="annot"><span class="annottext">[(FParam SOACS, SubExp)]
</span><a href="#local-6989586621684466048"><span class="hs-identifier hs-var">val_pats</span></a></span></span><span> </span><span id="local-6989586621684466047"><span class="annot"><span class="annottext">loop :: LoopForm SOACS
</span><a href="#local-6989586621684466047"><span class="hs-identifier hs-var">loop</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#ForLoop"><span class="hs-identifier hs-type">ForLoop</span></a></span><span> </span><span id="local-6989586621684466045"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466045"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621684466044"><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684466044"><span class="hs-identifier hs-var">it</span></a></span></span><span> </span><span id="local-6989586621684466043"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466043"><span class="hs-identifier hs-var">bound</span></a></span></span><span> </span><span id="local-6989586621684466042"><span class="annot"><span class="annottext">[(LParam SOACS, VName)]
</span><a href="#local-6989586621684466042"><span class="hs-identifier hs-var">loop_vars</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684466041"><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466041"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-426"></span><span>  </span><span id="local-6989586621684466040"><span class="annot"><span class="annottext">PatT Type
</span><a href="#local-6989586621684466040"><span class="hs-identifier hs-var">pat'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatT Type -&gt; ADM (Bundled (PatT Type))
forall a. TanBuilder a =&gt; a -&gt; ADM (Bundled a)
</span><a href="Futhark.AD.Fwd.html#bundleNew"><span class="hs-identifier hs-var">bundleNew</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466050"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-427"></span><span>  </span><span id="local-6989586621684466039"><span class="annot"><span class="annottext">[(Param DeclType, SubExp)]
</span><a href="#local-6989586621684466039"><span class="hs-identifier hs-var">val_pats'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Param DeclType, SubExp)]
-&gt; ADM (Bundled [(Param DeclType, SubExp)])
forall a. TanBuilder a =&gt; a -&gt; ADM (Bundled a)
</span><a href="Futhark.AD.Fwd.html#bundleNew"><span class="hs-identifier hs-var">bundleNew</span></a></span><span> </span><span class="annot"><span class="annottext">[(Param DeclType, SubExp)]
[(FParam SOACS, SubExp)]
</span><a href="#local-6989586621684466048"><span class="hs-identifier hs-var">val_pats</span></a></span><span>
</span><span id="line-428"></span><span>  </span><span id="local-6989586621684466038"><span class="annot"><span class="annottext">[(Param Type, VName)]
</span><a href="#local-6989586621684466038"><span class="hs-identifier hs-var">loop_vars'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Param Type, VName)] -&gt; ADM (Bundled [(Param Type, VName)])
forall a. TanBuilder a =&gt; a -&gt; ADM (Bundled a)
</span><a href="Futhark.AD.Fwd.html#bundleNew"><span class="hs-identifier hs-var">bundleNew</span></a></span><span> </span><span class="annot"><span class="annottext">[(Param Type, VName)]
[(LParam SOACS, VName)]
</span><a href="#local-6989586621684466042"><span class="hs-identifier hs-var">loop_vars</span></a></span><span>
</span><span id="line-429"></span><span>  </span><span id="local-6989586621684466037"><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466037"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-430"></span><span>    </span><span class="annot"><span class="annottext">Scope SOACS -&gt; ADM (Body SOACS) -&gt; ADM (Body SOACS)
forall rep (m :: * -&gt; *) a.
LocalScope rep m =&gt;
Scope rep -&gt; m a -&gt; m a
</span><a href="Futhark.IR.Prop.Scope.html#localScope"><span class="hs-identifier hs-var">localScope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Param DeclType] -&gt; Scope SOACS
forall rep dec. (FParamInfo rep ~ dec) =&gt; [Param dec] -&gt; Scope rep
</span><a href="Futhark.IR.Prop.Scope.html#scopeOfFParams"><span class="hs-identifier hs-var">scopeOfFParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Param DeclType, SubExp) -&gt; Param DeclType)
-&gt; [(Param DeclType, SubExp)] -&gt; [Param DeclType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Param DeclType, SubExp) -&gt; Param DeclType
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Param DeclType, SubExp)]
[(FParam SOACS, SubExp)]
</span><a href="#local-6989586621684466048"><span class="hs-identifier hs-var">val_pats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Scope SOACS -&gt; Scope SOACS -&gt; Scope SOACS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">LoopForm SOACS -&gt; Scope SOACS
forall rep a. Scoped rep a =&gt; a -&gt; Scope rep
</span><a href="Futhark.IR.Prop.Scope.html#scopeOf"><span class="hs-identifier hs-var">scopeOf</span></a></span><span> </span><span class="annot"><span class="annottext">LoopForm SOACS
</span><a href="#local-6989586621684466047"><span class="hs-identifier hs-var">loop</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ADM (Body SOACS) -&gt; ADM (Body SOACS))
-&gt; ADM (Body SOACS) -&gt; ADM (Body SOACS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-431"></span><span>      </span><span class="annot"><span class="annottext">ADM (Body SOACS) -&gt; ADM (Body SOACS)
forall a. ADM a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#slocal%27"><span class="hs-identifier hs-var">slocal'</span></a></span><span> </span><span class="annot"><span class="annottext">(ADM (Body SOACS) -&gt; ADM (Body SOACS))
-&gt; ADM (Body SOACS) -&gt; ADM (Body SOACS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Body SOACS -&gt; ADM (Body SOACS)
</span><a href="Futhark.AD.Fwd.html#fwdBody"><span class="hs-identifier hs-var">fwdBody</span></a></span><span> </span><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466041"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-432"></span><span>  </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466040"><span class="hs-identifier hs-var">pat'</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466049"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(FParam SOACS, SubExp)] -&gt; LoopForm SOACS -&gt; Body SOACS -&gt; Exp
forall rep.
[(FParam rep, SubExp)] -&gt; LoopForm rep -&gt; BodyT rep -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#DoLoop"><span class="hs-identifier hs-var">DoLoop</span></a></span><span> </span><span class="annot"><span class="annottext">[(Param DeclType, SubExp)]
[(FParam SOACS, SubExp)]
</span><a href="#local-6989586621684466039"><span class="hs-identifier hs-var">val_pats'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
-&gt; IntType -&gt; SubExp -&gt; [(LParam SOACS, VName)] -&gt; LoopForm SOACS
forall rep.
VName -&gt; IntType -&gt; SubExp -&gt; [(LParam rep, VName)] -&gt; LoopForm rep
</span><a href="Futhark.IR.Syntax.html#ForLoop"><span class="hs-identifier hs-var">ForLoop</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684466045"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684466044"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684466043"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">[(Param Type, VName)]
[(LParam SOACS, VName)]
</span><a href="#local-6989586621684466038"><span class="hs-identifier hs-var">loop_vars'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466037"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-433"></span><span class="annot"><a href="Futhark.AD.Fwd.html#fwdStm"><span class="hs-identifier hs-var">fwdStm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621684466036"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684466036"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684466035"><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466035"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#WithAcc"><span class="hs-identifier hs-type">WithAcc</span></a></span><span> </span><span id="local-6989586621684466033"><span class="annot"><span class="annottext">[WithAccInput SOACS]
</span><a href="#local-6989586621684466033"><span class="hs-identifier hs-var">inputs</span></a></span></span><span> </span><span id="local-6989586621684466032"><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466032"><span class="hs-identifier hs-var">lam</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-434"></span><span>  </span><span id="local-6989586621684466031"><span class="annot"><span class="annottext">[WithAccInput SOACS]
</span><a href="#local-6989586621684466031"><span class="hs-identifier hs-var">inputs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[WithAccInput SOACS]
-&gt; (WithAccInput SOACS -&gt; ADM (WithAccInput SOACS))
-&gt; ADM [WithAccInput SOACS]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[WithAccInput SOACS]
</span><a href="#local-6989586621684466033"><span class="hs-identifier hs-var">inputs</span></a></span><span> </span><span class="annot"><span class="annottext">((WithAccInput SOACS -&gt; ADM (WithAccInput SOACS))
 -&gt; ADM [WithAccInput SOACS])
-&gt; (WithAccInput SOACS -&gt; ADM (WithAccInput SOACS))
-&gt; ADM [WithAccInput SOACS]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621684466029"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684466029"><span class="hs-identifier hs-var">shape</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684466028"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466028"><span class="hs-identifier hs-var">arrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684466027"><span class="annot"><span class="annottext">Maybe (Lambda, [SubExp])
</span><a href="#local-6989586621684466027"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-435"></span><span>    </span><span id="local-6989586621684466026"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466026"><span class="hs-identifier hs-var">arrs_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; ADM [VName]
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466028"><span class="hs-identifier hs-var">arrs</span></a></span><span>
</span><span id="line-436"></span><span>    </span><span id="local-6989586621684466025"><span class="annot"><span class="annottext">Maybe (Lambda, [SubExp])
</span><a href="#local-6989586621684466025"><span class="hs-identifier hs-var">op'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Lambda, [SubExp])
</span><a href="#local-6989586621684466027"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-437"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Lambda, [SubExp])
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Lambda, [SubExp]) -&gt; ADM (Maybe (Lambda, [SubExp]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Lambda, [SubExp])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-438"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684466024"><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466024"><span class="hs-identifier hs-var">op_lam</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684466023"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466023"><span class="hs-identifier hs-var">nes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-439"></span><span>        </span><span id="local-6989586621684466022"><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466022"><span class="hs-identifier hs-var">nes_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; ADM SubExp) -&gt; [SubExp] -&gt; ADM [SubExp]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(VName -&gt; SubExp) -&gt; ADM VName -&gt; ADM SubExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; SubExp
</span><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">(ADM VName -&gt; ADM SubExp)
-&gt; (SubExp -&gt; ADM VName) -&gt; SubExp -&gt; ADM SubExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; ADM VName
</span><a href="Futhark.AD.Fwd.html#zeroFromSubExp"><span class="hs-identifier hs-var">zeroFromSubExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466023"><span class="hs-identifier hs-var">nes</span></a></span><span>
</span><span id="line-440"></span><span>        </span><span id="local-6989586621684466021"><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466021"><span class="hs-identifier hs-var">op_lam'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lambda -&gt; ADM Lambda
</span><a href="Futhark.AD.Fwd.html#fwdLambda"><span class="hs-identifier hs-var">fwdLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466024"><span class="hs-identifier hs-var">op_lam</span></a></span><span>
</span><span id="line-441"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466021"><span class="hs-identifier hs-var">op_lam'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-442"></span><span>          </span><span class="annot"><a href="Futhark.IR.Syntax.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span id="local-6989586621684466020"><span class="annot"><span class="annottext">[LParam SOACS]
</span><a href="#local-6989586621684466020"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621684466019"><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466019"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621684466018"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684466018"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-443"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684466017"><span class="annot"><span class="annottext">op_lam'' :: Lambda
</span><a href="#local-6989586621684466017"><span class="hs-identifier hs-var hs-var">op_lam''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LParam SOACS] -&gt; Body SOACS -&gt; [Type] -&gt; Lambda
forall rep. [LParam rep] -&gt; BodyT rep -&gt; [Type] -&gt; LambdaT rep
</span><a href="Futhark.IR.Syntax.html#Lambda"><span class="hs-identifier hs-var">Lambda</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Param Type] -&gt; [Param Type]
forall {t} {a}. (Eq t, Num t) =&gt; t -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621684466016"><span class="hs-identifier hs-var">removeIndexTans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Shape -&gt; Int
forall a. ArrayShape a =&gt; a -&gt; Int
</span><a href="Futhark.IR.Syntax.Core.html#shapeRank"><span class="hs-identifier hs-var">shapeRank</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684466029"><span class="hs-identifier hs-var">shape</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Param Type]
[LParam SOACS]
</span><a href="#local-6989586621684466020"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684466019"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684466018"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-444"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Lambda, [SubExp]) -&gt; ADM (Maybe (Lambda, [SubExp]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Lambda, [SubExp]) -&gt; ADM (Maybe (Lambda, [SubExp])))
-&gt; Maybe (Lambda, [SubExp]) -&gt; ADM (Maybe (Lambda, [SubExp]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Lambda, [SubExp]) -&gt; Maybe (Lambda, [SubExp])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466017"><span class="hs-identifier hs-var">op_lam''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SubExp] -&gt; [SubExp] -&gt; [SubExp]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="Futhark.AD.Fwd.html#interleave"><span class="hs-identifier hs-var">interleave</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466023"><span class="hs-identifier hs-var">nes</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684466022"><span class="hs-identifier hs-var">nes_tan</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>    </span><span class="annot"><span class="annottext">WithAccInput SOACS -&gt; ADM (WithAccInput SOACS)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621684466029"><span class="hs-identifier hs-var">shape</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466028"><span class="hs-identifier hs-var">arrs</span></a></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; [VName] -&gt; [VName]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684466026"><span class="hs-identifier hs-var">arrs_tan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Lambda, [SubExp])
</span><a href="#local-6989586621684466025"><span class="hs-identifier hs-var">op'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span>  </span><span id="local-6989586621684466014"><span class="annot"><span class="annottext">PatT Type
</span><a href="#local-6989586621684466014"><span class="hs-identifier hs-var">pat'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatT Type -&gt; ADM (Bundled (PatT Type))
forall a. TanBuilder a =&gt; a -&gt; ADM (Bundled a)
</span><a href="Futhark.AD.Fwd.html#bundleNew"><span class="hs-identifier hs-var">bundleNew</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466036"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-447"></span><span>  </span><span id="local-6989586621684466013"><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466013"><span class="hs-identifier hs-var">lam'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lambda -&gt; ADM Lambda
</span><a href="Futhark.AD.Fwd.html#fwdLambda"><span class="hs-identifier hs-var">fwdLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466032"><span class="hs-identifier hs-var">lam</span></a></span><span>
</span><span id="line-448"></span><span>  </span><span class="annot"><span class="annottext">Stm (Rep ADM) -&gt; ADM ()
forall (m :: * -&gt; *). MonadBuilder m =&gt; Stm (Rep m) -&gt; m ()
</span><a href="Futhark.Builder.Class.html#addStm"><span class="hs-identifier hs-var">addStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm (Rep ADM) -&gt; ADM ()) -&gt; Stm (Rep ADM) -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; Exp -&gt; Stm
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684466014"><span class="hs-identifier hs-var">pat'</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466035"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Stm) -&gt; Exp -&gt; Stm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[WithAccInput SOACS] -&gt; Lambda -&gt; Exp
forall rep. [WithAccInput rep] -&gt; Lambda rep -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#WithAcc"><span class="hs-identifier hs-var">WithAcc</span></a></span><span> </span><span class="annot"><span class="annottext">[WithAccInput SOACS]
</span><a href="#local-6989586621684466031"><span class="hs-identifier hs-var">inputs'</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684466013"><span class="hs-identifier hs-var">lam'</span></a></span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-450"></span><span>    </span><span id="local-6989586621684466016"><span class="annot"><span class="annottext">removeIndexTans :: t -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621684466016"><span class="hs-identifier hs-var hs-var">removeIndexTans</span></a></span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">0</span></span><span> </span><span id="local-6989586621684466006"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621684466006"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621684466006"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-451"></span><span>    </span><span class="annot"><a href="#local-6989586621684466016"><span class="hs-identifier hs-var">removeIndexTans</span></a></span><span> </span><span id="local-6989586621684466005"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621684466005"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684466004"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684466004"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684466003"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621684466003"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684466004"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">t -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621684466016"><span class="hs-identifier hs-var">removeIndexTans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621684466005"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621684466003"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-452"></span><span>    </span><span class="annot"><a href="#local-6989586621684466016"><span class="hs-identifier hs-var">removeIndexTans</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684466002"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621684466002"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621684466002"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-453"></span><span class="annot"><a href="Futhark.AD.Fwd.html#fwdStm"><span class="hs-identifier hs-var">fwdStm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621684466001"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684466001"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684466000"><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466000"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span id="local-6989586621684465999"><span class="annot"><span class="annottext">Op SOACS
</span><a href="#local-6989586621684465999"><span class="hs-identifier hs-var">soac</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux () -&gt; SOAC SOACS -&gt; ADM ()
</span><a href="Futhark.AD.Fwd.html#fwdSOAC"><span class="hs-identifier hs-var">fwdSOAC</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684466001"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684466000"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">Op SOACS
SOAC SOACS
</span><a href="#local-6989586621684465999"><span class="hs-identifier hs-var">soac</span></a></span><span>
</span><span id="line-454"></span><span class="annot"><a href="Futhark.AD.Fwd.html#fwdStm"><span class="hs-identifier hs-var">fwdStm</span></a></span><span> </span><span id="local-6989586621684465998"><span class="annot"><span class="annottext">Stm
</span><a href="#local-6989586621684465998"><span class="hs-identifier hs-var">stm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-455"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; ADM ()
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ADM ()) -&gt; [Char] -&gt; ADM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;unhandled forward mode AD for Stm: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Stm -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Stm
</span><a href="#local-6989586621684465998"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Stm -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Stm
</span><a href="#local-6989586621684465998"><span class="hs-identifier hs-var">stm</span></a></span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span class="annot"><a href="Futhark.AD.Fwd.html#fwdBody"><span class="hs-identifier hs-type">fwdBody</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#Body"><span class="hs-identifier hs-type">Body</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#Body"><span class="hs-identifier hs-type">Body</span></a></span><span>
</span><span id="line-458"></span><span id="fwdBody"><span class="annot"><span class="annottext">fwdBody :: Body SOACS -&gt; ADM (Body SOACS)
</span><a href="Futhark.AD.Fwd.html#fwdBody"><span class="hs-identifier hs-var hs-var">fwdBody</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Body"><span class="hs-identifier hs-type">Body</span></a></span><span> </span><span class="annot"><span class="annottext">BodyDec SOACS
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684465997"><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684465997"><span class="hs-identifier hs-var">stms</span></a></span></span><span> </span><span id="local-6989586621684465996"><span class="annot"><span class="annottext">[SubExpRes]
</span><a href="#local-6989586621684465996"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ADM [SubExpRes] -&gt; ADM (Body (Rep ADM))
forall (m :: * -&gt; *).
MonadBuilder m =&gt;
m [SubExpRes] -&gt; m (Body (Rep m))
</span><a href="Futhark.Construct.html#buildBody_"><span class="hs-identifier hs-var">buildBody_</span></a></span><span> </span><span class="annot"><span class="annottext">(ADM [SubExpRes] -&gt; ADM (Body (Rep ADM)))
-&gt; ADM [SubExpRes] -&gt; ADM (Body (Rep ADM))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-459"></span><span>  </span><span class="annot"><span class="annottext">(Stm -&gt; ADM ()) -&gt; Stms SOACS -&gt; ADM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Stm -&gt; ADM ()
</span><a href="Futhark.AD.Fwd.html#fwdStm"><span class="hs-identifier hs-var">fwdStm</span></a></span><span> </span><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684465997"><span class="hs-identifier hs-var">stms</span></a></span><span>
</span><span id="line-460"></span><span>  </span><span class="annot"><span class="annottext">[SubExpRes] -&gt; ADM (BundledTan [SubExpRes])
forall a. Tangent a =&gt; a -&gt; ADM (BundledTan a)
</span><a href="Futhark.AD.Fwd.html#bundleTan"><span class="hs-identifier hs-var">bundleTan</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExpRes]
</span><a href="#local-6989586621684465996"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-461"></span><span>
</span><span id="line-462"></span><span class="annot"><a href="Futhark.AD.Fwd.html#fwdBodyTansLast"><span class="hs-identifier hs-type">fwdBodyTansLast</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#Body"><span class="hs-identifier hs-type">Body</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.AD.Fwd.html#ADM"><span class="hs-identifier hs-type">ADM</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#Body"><span class="hs-identifier hs-type">Body</span></a></span><span>
</span><span id="line-463"></span><span id="fwdBodyTansLast"><span class="annot"><span class="annottext">fwdBodyTansLast :: Body SOACS -&gt; ADM (Body SOACS)
</span><a href="Futhark.AD.Fwd.html#fwdBodyTansLast"><span class="hs-identifier hs-var hs-var">fwdBodyTansLast</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Body"><span class="hs-identifier hs-type">Body</span></a></span><span> </span><span class="annot"><span class="annottext">BodyDec SOACS
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684465993"><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684465993"><span class="hs-identifier hs-var">stms</span></a></span></span><span> </span><span id="local-6989586621684465992"><span class="annot"><span class="annottext">[SubExpRes]
</span><a href="#local-6989586621684465992"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ADM [SubExpRes] -&gt; ADM (Body (Rep ADM))
forall (m :: * -&gt; *).
MonadBuilder m =&gt;
m [SubExpRes] -&gt; m (Body (Rep m))
</span><a href="Futhark.Construct.html#buildBody_"><span class="hs-identifier hs-var">buildBody_</span></a></span><span> </span><span class="annot"><span class="annottext">(ADM [SubExpRes] -&gt; ADM (Body (Rep ADM)))
-&gt; ADM [SubExpRes] -&gt; ADM (Body (Rep ADM))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-464"></span><span>  </span><span class="annot"><span class="annottext">(Stm -&gt; ADM ()) -&gt; Stms SOACS -&gt; ADM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Stm -&gt; ADM ()
</span><a href="Futhark.AD.Fwd.html#fwdStm"><span class="hs-identifier hs-var">fwdStm</span></a></span><span> </span><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684465993"><span class="hs-identifier hs-var">stms</span></a></span><span>
</span><span id="line-465"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SubExpRes]
</span><a href="#local-6989586621684465992"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExpRes] -&gt; [SubExpRes] -&gt; [SubExpRes]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([SubExpRes] -&gt; [SubExpRes]) -&gt; ADM [SubExpRes] -&gt; ADM [SubExpRes]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[SubExpRes] -&gt; ADM [SubExpRes]
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExpRes]
</span><a href="#local-6989586621684465992"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span id="local-6989586621684467295"><span class="annot"><a href="Futhark.AD.Fwd.html#fwdJVP"><span class="hs-identifier hs-type">fwdJVP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.MonadFreshNames.html#MonadFreshNames"><span class="hs-identifier hs-type">MonadFreshNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684467295"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Scope.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621684467295"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span></span><span>
</span><span id="line-468"></span><span id="fwdJVP"><span class="annot"><span class="annottext">fwdJVP :: forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Scope SOACS -&gt; Lambda -&gt; m Lambda
</span><a href="Futhark.AD.Fwd.html#fwdJVP"><span class="hs-identifier hs-var hs-var">fwdJVP</span></a></span></span><span> </span><span id="local-6989586621684465979"><span class="annot"><span class="annottext">Scope SOACS
</span><a href="#local-6989586621684465979"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span id="local-6989586621684465978"><span class="annot"><span class="annottext">l :: Lambda
</span><a href="#local-6989586621684465978"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span id="local-6989586621684465977"><span class="annot"><span class="annottext">[LParam SOACS]
</span><a href="#local-6989586621684465977"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621684465976"><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684465976"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621684465975"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684465975"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-469"></span><span>  </span><span class="annot"><span class="annottext">ADM Lambda -&gt; m Lambda
forall (m :: * -&gt; *) a. MonadFreshNames m =&gt; ADM a -&gt; m a
</span><a href="Futhark.AD.Fwd.html#runADM"><span class="hs-identifier hs-var">runADM</span></a></span><span> </span><span class="annot"><span class="annottext">(ADM Lambda -&gt; m Lambda)
-&gt; (ADM Lambda -&gt; ADM Lambda) -&gt; ADM Lambda -&gt; m Lambda
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Scope SOACS -&gt; ADM Lambda -&gt; ADM Lambda
forall rep (m :: * -&gt; *) a.
LocalScope rep m =&gt;
Scope rep -&gt; m a -&gt; m a
</span><a href="Futhark.IR.Prop.Scope.html#localScope"><span class="hs-identifier hs-var">localScope</span></a></span><span> </span><span class="annot"><span class="annottext">Scope SOACS
</span><a href="#local-6989586621684465979"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">(ADM Lambda -&gt; ADM Lambda)
-&gt; (ADM Lambda -&gt; ADM Lambda) -&gt; ADM Lambda -&gt; ADM Lambda
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Lambda -&gt; ADM Lambda -&gt; ADM Lambda
forall rep a (m :: * -&gt; *) b.
(Scoped rep a, LocalScope rep m) =&gt;
a -&gt; m b -&gt; m b
</span><a href="Futhark.IR.Prop.Scope.html#inScopeOf"><span class="hs-identifier hs-var">inScopeOf</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda
</span><a href="#local-6989586621684465978"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">(ADM Lambda -&gt; m Lambda) -&gt; ADM Lambda -&gt; m Lambda
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-470"></span><span>    </span><span id="local-6989586621684465974"><span class="annot"><span class="annottext">[Param Type]
</span><a href="#local-6989586621684465974"><span class="hs-identifier hs-var">params_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Param Type] -&gt; ADM [Param Type]
forall a. TanBuilder a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#newTan"><span class="hs-identifier hs-var">newTan</span></a></span><span> </span><span class="annot"><span class="annottext">[Param Type]
[LParam SOACS]
</span><a href="#local-6989586621684465977"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-471"></span><span>    </span><span id="local-6989586621684465973"><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684465973"><span class="hs-identifier hs-var">body_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Body SOACS -&gt; ADM (Body SOACS)
</span><a href="Futhark.AD.Fwd.html#fwdBodyTansLast"><span class="hs-identifier hs-var">fwdBodyTansLast</span></a></span><span> </span><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684465976"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-472"></span><span>    </span><span id="local-6989586621684465972"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684465972"><span class="hs-identifier hs-var">ret_tan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; ADM [Type]
forall a. Tangent a =&gt; a -&gt; ADM a
</span><a href="Futhark.AD.Fwd.html#tangent"><span class="hs-identifier hs-var">tangent</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684465975"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-473"></span><span>    </span><span class="annot"><span class="annottext">Lambda -&gt; ADM Lambda
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Lambda -&gt; ADM Lambda) -&gt; Lambda -&gt; ADM Lambda
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[LParam SOACS] -&gt; Body SOACS -&gt; [Type] -&gt; Lambda
forall rep. [LParam rep] -&gt; BodyT rep -&gt; [Type] -&gt; LambdaT rep
</span><a href="Futhark.IR.Syntax.html#Lambda"><span class="hs-identifier hs-var">Lambda</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Param Type]
[LParam SOACS]
</span><a href="#local-6989586621684465977"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">[Param Type] -&gt; [Param Type] -&gt; [Param Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Param Type]
</span><a href="#local-6989586621684465974"><span class="hs-identifier hs-var">params_tan</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Body SOACS
</span><a href="#local-6989586621684465973"><span class="hs-identifier hs-var">body_tan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684465975"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684465972"><span class="hs-identifier hs-var">ret_tan</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-474"></span></pre></body></html>