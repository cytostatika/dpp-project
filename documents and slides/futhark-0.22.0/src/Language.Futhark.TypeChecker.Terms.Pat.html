<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.Futhark.TypeChecker.Terms.Pat</span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#binding"><span class="hs-identifier">binding</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingParams"><span class="hs-identifier">bindingParams</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat"><span class="hs-identifier">checkPat</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingPat"><span class="hs-identifier">bindingPat</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingIdent"><span class="hs-identifier">bindingIdent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingSizes"><span class="hs-identifier">bindingSizes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#doNotShadow"><span class="hs-identifier">doNotShadow</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#boundAliases"><span class="hs-identifier">boundAliases</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">where</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bitraversable</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">find</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isPrefixOf</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sort</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Util.Pretty.html"><span class="hs-identifier">Futhark.Util.Pretty</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">group</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">space</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.html"><span class="hs-identifier">Language.Futhark</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html"><span class="hs-identifier">Language.Futhark.TypeChecker.Monad</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Semantic.html#BoundV"><span class="hs-identifier">BoundV</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html"><span class="hs-identifier">Language.Futhark.TypeChecker.Terms.Monad</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Types.html"><span class="hs-identifier">Language.Futhark.TypeChecker.Types</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html"><span class="hs-identifier">Language.Futhark.TypeChecker.Unify</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#Usage"><span class="hs-identifier">Usage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mod</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-comment">-- | Names that may not be shadowed.</span><span>
</span><span id="line-34"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#doNotShadow"><span class="hs-identifier hs-type">doNotShadow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>
</span><span id="line-35"></span><span id="doNotShadow"><span class="annot"><span class="annottext">doNotShadow :: [[Char]]
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#doNotShadow"><span class="hs-identifier hs-var hs-var">doNotShadow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&amp;&amp;&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;||&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#nonrigidFor"><span class="hs-identifier hs-type">nonrigidFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Syntax.html#SizeBinder"><span class="hs-identifier hs-type">SizeBinder</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#StructType"><span class="hs-identifier hs-type">StructType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#StructType"><span class="hs-identifier hs-type">StructType</span></a></span><span>
</span><span id="line-38"></span><span id="nonrigidFor"><span class="annot"><span class="annottext">nonrigidFor :: [SizeBinder VName] -&gt; StructType -&gt; TermTypeM StructType
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#nonrigidFor"><span class="hs-identifier hs-var hs-var">nonrigidFor</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621684558678"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558678"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StructType -&gt; TermTypeM StructType
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558678"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-comment">-- Minor optimisation.</span><span>
</span><span id="line-39"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#nonrigidFor"><span class="hs-identifier hs-var">nonrigidFor</span></a></span><span> </span><span id="local-6989586621684558677"><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558677"><span class="hs-identifier hs-var">sizes</span></a></span></span><span> </span><span id="local-6989586621684558676"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558676"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateT [(VName, VName)] TermTypeM StructType
-&gt; [(VName, VName)] -&gt; TermTypeM StructType
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><span class="hs-identifier hs-var">evalStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DimDecl VName
 -&gt; StateT [(VName, VName)] TermTypeM (DimDecl VName))
-&gt; (() -&gt; StateT [(VName, VName)] TermTypeM ())
-&gt; StructType
-&gt; StateT [(VName, VName)] TermTypeM StructType
forall (t :: * -&gt; * -&gt; *) (f :: * -&gt; *) a c b d.
(Bitraversable t, Applicative f) =&gt;
(a -&gt; f c) -&gt; (b -&gt; f d) -&gt; t a b -&gt; f (t c d)
</span><span class="hs-identifier hs-var">bitraverse</span></span><span> </span><span class="annot"><span class="annottext">DimDecl VName -&gt; StateT [(VName, VName)] TermTypeM (DimDecl VName)
forall {t :: (* -&gt; *) -&gt; * -&gt; *}.
(MonadState [(VName, VName)] (t TermTypeM), MonadTrans t) =&gt;
DimDecl VName -&gt; t TermTypeM (DimDecl VName)
</span><a href="#local-6989586621684558673"><span class="hs-identifier hs-var">onDim</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; StateT [(VName, VName)] TermTypeM ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558676"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(VName, VName)]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-41"></span><span>    </span><span id="local-6989586621684558673"><span class="annot"><span class="annottext">onDim :: DimDecl VName -&gt; t TermTypeM (DimDecl VName)
</span><a href="#local-6989586621684558673"><span class="hs-identifier hs-var hs-var">onDim</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#NamedDim"><span class="hs-identifier hs-type">NamedDim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#QualName"><span class="hs-identifier hs-type">QualName</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684558644"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558644"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684558643"><span class="annot"><span class="annottext">SizeBinder VName
</span><a href="#local-6989586621684558643"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SizeBinder VName -&gt; Bool)
-&gt; [SizeBinder VName] -&gt; Maybe (SizeBinder VName)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; VName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558644"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Bool)
-&gt; (SizeBinder VName -&gt; VName) -&gt; SizeBinder VName -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SizeBinder VName -&gt; VName
forall vn. SizeBinder vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#sizeName"><span class="hs-identifier hs-var hs-var">sizeName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558677"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-43"></span><span>        </span><span id="local-6989586621684558640"><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684558640"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([(VName, VName)] -&gt; Maybe VName) -&gt; t TermTypeM (Maybe VName)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">(([(VName, VName)] -&gt; Maybe VName) -&gt; t TermTypeM (Maybe VName))
-&gt; ([(VName, VName)] -&gt; Maybe VName) -&gt; t TermTypeM (Maybe VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; [(VName, VName)] -&gt; Maybe VName
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558644"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-44"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684558640"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-45"></span><span>          </span><span class="annot"><span class="annottext">Maybe VName
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-46"></span><span>            </span><span id="local-6989586621684558637"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558637"><span class="hs-identifier hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TermTypeM VName -&gt; t TermTypeM VName
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TermTypeM VName -&gt; t TermTypeM VName)
-&gt; TermTypeM VName -&gt; t TermTypeM VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TermTypeM VName
forall (m :: * -&gt; *). MonadTypeChecker m =&gt; Name -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Monad.html#newID"><span class="hs-identifier hs-var">newID</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; TermTypeM VName) -&gt; Name -&gt; TermTypeM VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Name
</span><a href="Language.Futhark.Core.html#baseName"><span class="hs-identifier hs-var">baseName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558644"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-47"></span><span>            </span><span class="annot"><span class="annottext">TermTypeM () -&gt; t TermTypeM ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TermTypeM () -&gt; t TermTypeM ()) -&gt; TermTypeM () -&gt; t TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Constraint -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#constrain"><span class="hs-identifier hs-var">constrain</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558637"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">(Constraint -&gt; TermTypeM ()) -&gt; Constraint -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe (DimDecl VName) -&gt; Usage -&gt; Constraint
</span><a href="Language.Futhark.TypeChecker.Unify.html#Size"><span class="hs-identifier hs-var">Size</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (DimDecl VName)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">(Usage -&gt; Constraint) -&gt; Usage -&gt; Constraint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage%27"><span class="hs-identifier hs-var">mkUsage'</span></a></span><span> </span><span class="annot"><span class="annottext">(SrcLoc -&gt; Usage) -&gt; SrcLoc -&gt; Usage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SizeBinder VName -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">SizeBinder VName
</span><a href="#local-6989586621684558643"><span class="hs-identifier hs-var">size</span></a></span><span>
</span><span id="line-48"></span><span>            </span><span class="annot"><span class="annottext">([(VName, VName)] -&gt; [(VName, VName)]) -&gt; t TermTypeM ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558644"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558637"><span class="hs-identifier hs-var">v'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(VName, VName) -&gt; [(VName, VName)] -&gt; [(VName, VName)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>            </span><span class="annot"><span class="annottext">DimDecl VName -&gt; t TermTypeM (DimDecl VName)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(DimDecl VName -&gt; t TermTypeM (DimDecl VName))
-&gt; DimDecl VName -&gt; t TermTypeM (DimDecl VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; DimDecl VName
forall vn. QualName vn -&gt; DimDecl vn
</span><a href="Language.Futhark.Syntax.html#NamedDim"><span class="hs-identifier hs-var">NamedDim</span></a></span><span> </span><span class="annot"><span class="annottext">(QualName VName -&gt; DimDecl VName)
-&gt; QualName VName -&gt; DimDecl VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558637"><span class="hs-identifier hs-var">v'</span></a></span><span>
</span><span id="line-50"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684558627"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558627"><span class="hs-identifier hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-51"></span><span>            </span><span class="annot"><span class="annottext">DimDecl VName -&gt; t TermTypeM (DimDecl VName)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(DimDecl VName -&gt; t TermTypeM (DimDecl VName))
-&gt; DimDecl VName -&gt; t TermTypeM (DimDecl VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; DimDecl VName
forall vn. QualName vn -&gt; DimDecl vn
</span><a href="Language.Futhark.Syntax.html#NamedDim"><span class="hs-identifier hs-var">NamedDim</span></a></span><span> </span><span class="annot"><span class="annottext">(QualName VName -&gt; DimDecl VName)
-&gt; QualName VName -&gt; DimDecl VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558627"><span class="hs-identifier hs-var">v'</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="#local-6989586621684558673"><span class="hs-identifier hs-var">onDim</span></a></span><span> </span><span id="local-6989586621684558626"><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684558626"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DimDecl VName -&gt; t TermTypeM (DimDecl VName)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684558626"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-comment">-- | The set of in-scope variables that are being aliased.</span><span>
</span><span id="line-55"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#boundAliases"><span class="hs-identifier hs-type">boundAliases</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Aliasing"><span class="hs-identifier hs-type">Aliasing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span>
</span><span id="line-56"></span><span id="boundAliases"><span class="annot"><span class="annottext">boundAliases :: Aliasing -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#boundAliases"><span class="hs-identifier hs-var hs-var">boundAliases</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; VName) -&gt; Aliasing -&gt; Set VName
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">S.map</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; VName
</span><a href="Language.Futhark.Syntax.html#aliasVar"><span class="hs-identifier hs-var hs-var">aliasVar</span></a></span><span> </span><span class="annot"><span class="annottext">(Aliasing -&gt; Set VName)
-&gt; (Aliasing -&gt; Aliasing) -&gt; Aliasing -&gt; Set VName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; Bool) -&gt; Aliasing -&gt; Aliasing
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.filter</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Bool
</span><a href="#local-6989586621684558622"><span class="hs-identifier hs-var">bound</span></a></span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-58"></span><span>    </span><span id="local-6989586621684558622"><span class="annot"><span class="annottext">bound :: Alias -&gt; Bool
</span><a href="#local-6989586621684558622"><span class="hs-identifier hs-var hs-var">bound</span></a></span></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#AliasBound"><span class="hs-identifier hs-type">AliasBound</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><a href="#local-6989586621684558622"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#AliasFree"><span class="hs-identifier hs-type">AliasFree</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkIfUsed"><span class="hs-identifier hs-type">checkIfUsed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Occurrences"><span class="hs-identifier hs-type">Occurrences</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span id="checkIfUsed"><span class="annot"><span class="annottext">checkIfUsed :: Occurrences -&gt; Ident -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkIfUsed"><span class="hs-identifier hs-var hs-var">checkIfUsed</span></a></span></span><span> </span><span id="local-6989586621684558618"><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684558618"><span class="hs-identifier hs-var">occs</span></a></span></span><span> </span><span id="local-6989586621684558617"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621684558617"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; VName
forall (f :: * -&gt; *) vn. IdentBase f vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#identName"><span class="hs-identifier hs-var hs-var">identName</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621684558617"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Occurrences -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#allOccurring"><span class="hs-identifier hs-var">allOccurring</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684558618"><span class="hs-identifier hs-var">occs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><span class="hs-operator hs-var">`isPrefixOf`</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; [Char]
forall v. IsName v =&gt; v -&gt; [Char]
</span><a href="Language.Futhark.Pretty.html#prettyName"><span class="hs-identifier hs-var">prettyName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; VName
forall (f :: * -&gt; *) vn. IdentBase f vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#identName"><span class="hs-identifier hs-var hs-var">identName</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621684558617"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><span class="annottext">SrcLoc -&gt; Doc -&gt; TermTypeM ()
forall (m :: * -&gt; *) loc.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Doc -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Monad.html#warn"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621684558617"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM ()) -&gt; Doc -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Unused variable&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Doc
forall v. IsName v =&gt; v -&gt; Doc
</span><a href="Language.Futhark.Pretty.html#pprName"><span class="hs-identifier hs-var">pprName</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Doc) -&gt; VName -&gt; Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; VName
forall (f :: * -&gt; *) vn. IdentBase f vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#identName"><span class="hs-identifier hs-var hs-var">identName</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621684558617"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><span class="annottext">() -&gt; TermTypeM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span id="local-6989586621684559174"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#binding"><span class="hs-identifier hs-type">binding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684559174"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684559174"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-70"></span><span id="binding"><span class="annot"><span class="annottext">binding :: forall a. [Ident] -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#binding"><span class="hs-identifier hs-var hs-var">binding</span></a></span></span><span> </span><span id="local-6989586621684558602"><span class="annot"><span class="annottext">[Ident]
</span><a href="#local-6989586621684558602"><span class="hs-identifier hs-var">stms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermTypeM a -&gt; TermTypeM a
forall {b}. TermTypeM b -&gt; TermTypeM b
</span><a href="#local-6989586621684558601"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">(TermTypeM a -&gt; TermTypeM a)
-&gt; (TermTypeM a -&gt; TermTypeM a) -&gt; TermTypeM a -&gt; TermTypeM a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TermTypeM a -&gt; TermTypeM a
forall {b}. TermTypeM b -&gt; TermTypeM b
</span><a href="#local-6989586621684558600"><span class="hs-identifier hs-var">handleVars</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-72"></span><span>    </span><span id="local-6989586621684558600"><span class="annot"><span class="annottext">handleVars :: TermTypeM a -&gt; TermTypeM a
</span><a href="#local-6989586621684558600"><span class="hs-identifier hs-var hs-var">handleVars</span></a></span></span><span> </span><span id="local-6989586621684558595"><span class="annot"><span class="annottext">TermTypeM a
</span><a href="#local-6989586621684558595"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-73"></span><span>      </span><span class="annot"><span class="annottext">(TermScope -&gt; TermScope) -&gt; TermTypeM a -&gt; TermTypeM a
forall a. (TermScope -&gt; TermScope) -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#localScope"><span class="hs-identifier hs-var">localScope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermScope -&gt; [Ident] -&gt; TermScope
</span><a href="#local-6989586621684558593"><span class="hs-operator hs-var">`bindVars`</span></a></span><span> </span><span class="annot"><span class="annottext">[Ident]
</span><a href="#local-6989586621684558602"><span class="hs-identifier hs-var">stms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM a -&gt; TermTypeM a) -&gt; TermTypeM a -&gt; TermTypeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-74"></span><span>        </span><span class="hs-comment">-- Those identifiers that can potentially also be sizes are</span><span>
</span><span id="line-75"></span><span>        </span><span class="hs-comment">-- added as type constraints.  This is necessary so that we</span><span>
</span><span id="line-76"></span><span>        </span><span class="hs-comment">-- can properly detect scope violations during unification.</span><span>
</span><span id="line-77"></span><span>        </span><span class="hs-comment">-- We do this for *all* identifiers, not just those that are</span><span>
</span><span id="line-78"></span><span>        </span><span class="hs-comment">-- integers, because they may become integers later due to</span><span>
</span><span id="line-79"></span><span>        </span><span class="hs-comment">-- inference...</span><span>
</span><span id="line-80"></span><span>        </span><span class="annot"><span class="annottext">[Ident] -&gt; (Ident -&gt; TermTypeM ()) -&gt; TermTypeM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">[Ident]
</span><a href="#local-6989586621684558602"><span class="hs-identifier hs-var">stms</span></a></span><span> </span><span class="annot"><span class="annottext">((Ident -&gt; TermTypeM ()) -&gt; TermTypeM ())
-&gt; (Ident -&gt; TermTypeM ()) -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684558591"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621684558591"><span class="hs-identifier hs-var">ident</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-81"></span><span>          </span><span class="annot"><span class="annottext">VName -&gt; Constraint -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#constrain"><span class="hs-identifier hs-var">constrain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ident -&gt; VName
forall (f :: * -&gt; *) vn. IdentBase f vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#identName"><span class="hs-identifier hs-var hs-var">identName</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621684558591"><span class="hs-identifier hs-var">ident</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Constraint -&gt; TermTypeM ()) -&gt; Constraint -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Constraint
</span><a href="Language.Futhark.TypeChecker.Unify.html#ParamSize"><span class="hs-identifier hs-var">ParamSize</span></a></span><span> </span><span class="annot"><span class="annottext">(SrcLoc -&gt; Constraint) -&gt; SrcLoc -&gt; Constraint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621684558591"><span class="hs-identifier hs-var">ident</span></a></span><span>
</span><span id="line-82"></span><span>        </span><span class="annot"><span class="annottext">TermTypeM a
</span><a href="#local-6989586621684558595"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><a href="#local-6989586621684558593"><span class="hs-identifier hs-type">bindVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermScope"><span class="hs-identifier hs-type">TermScope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermScope"><span class="hs-identifier hs-type">TermScope</span></a></span><span>
</span><span id="line-85"></span><span>    </span><span id="local-6989586621684558593"><span class="annot"><span class="annottext">bindVars :: TermScope -&gt; [Ident] -&gt; TermScope
</span><a href="#local-6989586621684558593"><span class="hs-identifier hs-var hs-var">bindVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TermScope -&gt; Ident -&gt; TermScope)
-&gt; TermScope -&gt; [Ident] -&gt; TermScope
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">TermScope -&gt; Ident -&gt; TermScope
</span><a href="#local-6989586621684558588"><span class="hs-identifier hs-var">bindVar</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><a href="#local-6989586621684558588"><span class="hs-identifier hs-type">bindVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermScope"><span class="hs-identifier hs-type">TermScope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermScope"><span class="hs-identifier hs-type">TermScope</span></a></span><span>
</span><span id="line-88"></span><span>    </span><span id="local-6989586621684558588"><span class="annot"><span class="annottext">bindVar :: TermScope -&gt; Ident -&gt; TermScope
</span><a href="#local-6989586621684558588"><span class="hs-identifier hs-var hs-var">bindVar</span></a></span></span><span> </span><span id="local-6989586621684558587"><span class="annot"><span class="annottext">TermScope
</span><a href="#local-6989586621684558587"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span id="local-6989586621684558585"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558585"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span id="local-6989586621684558583"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558583"><span class="hs-identifier hs-var">tp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-89"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684558580"><span class="annot"><span class="annottext">inedges :: Set VName
</span><a href="#local-6989586621684558580"><span class="hs-identifier hs-var hs-var">inedges</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Aliasing -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#boundAliases"><span class="hs-identifier hs-var">boundAliases</span></a></span><span> </span><span class="annot"><span class="annottext">(Aliasing -&gt; Set VName) -&gt; Aliasing -&gt; Set VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatType -&gt; Aliasing
forall as shape. Monoid as =&gt; TypeBase shape as -&gt; as
</span><a href="Language.Futhark.Prop.html#aliases"><span class="hs-identifier hs-var">aliases</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558583"><span class="hs-identifier hs-var">tp</span></a></span><span>
</span><span id="line-90"></span><span>          </span><span id="local-6989586621684558577"><span class="annot"><span class="annottext">update :: ValBinding -&gt; ValBinding
</span><a href="#local-6989586621684558577"><span class="hs-identifier hs-var hs-var">update</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#BoundV"><span class="hs-identifier hs-type">BoundV</span></a></span><span> </span><span id="local-6989586621684558575"><span class="annot"><span class="annottext">Locality
</span><a href="#local-6989586621684558575"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621684558574"><span class="annot"><span class="annottext">[TypeParam]
</span><a href="#local-6989586621684558574"><span class="hs-identifier hs-var">tparams</span></a></span></span><span> </span><span id="local-6989586621684558573"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558573"><span class="hs-identifier hs-var">in_t</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>            </span><span class="hs-comment">-- If 'name' is record or sum-typed, don't alias the</span><span>
</span><span id="line-92"></span><span>            </span><span class="hs-comment">-- components to 'name', because these no identity</span><span>
</span><span id="line-93"></span><span>            </span><span class="hs-comment">-- beyond their components.</span><span>
</span><span id="line-94"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558583"><span class="hs-identifier hs-var">tp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Locality -&gt; [TypeParam] -&gt; PatType -&gt; ValBinding
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#BoundV"><span class="hs-identifier hs-var">BoundV</span></a></span><span> </span><span class="annot"><span class="annottext">Locality
</span><a href="#local-6989586621684558575"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParam]
</span><a href="#local-6989586621684558574"><span class="hs-identifier hs-var">tparams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558573"><span class="hs-identifier hs-var">in_t</span></a></span><span> </span><span class="annot"><span class="annottext">PatType -&gt; (Aliasing -&gt; Aliasing) -&gt; PatType
forall dim asf ast.
TypeBase dim asf -&gt; (asf -&gt; ast) -&gt; TypeBase dim ast
</span><a href="Language.Futhark.Prop.html#addAliases"><span class="hs-operator hs-var">`addAliases`</span></a></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Aliasing -&gt; Aliasing
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Alias
</span><a href="Language.Futhark.Syntax.html#AliasBound"><span class="hs-identifier hs-var">AliasBound</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558585"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Locality -&gt; [TypeParam] -&gt; PatType -&gt; ValBinding
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#BoundV"><span class="hs-identifier hs-var">BoundV</span></a></span><span> </span><span class="annot"><span class="annottext">Locality
</span><a href="#local-6989586621684558575"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParam]
</span><a href="#local-6989586621684558574"><span class="hs-identifier hs-var">tparams</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558573"><span class="hs-identifier hs-var">in_t</span></a></span><span>
</span><span id="line-96"></span><span>          </span><span class="annot"><a href="#local-6989586621684558577"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span id="local-6989586621684558569"><span class="annot"><span class="annottext">ValBinding
</span><a href="#local-6989586621684558569"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ValBinding
</span><a href="#local-6989586621684558569"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span>          </span><span id="local-6989586621684558567"><span class="annot"><span class="annottext">tp' :: PatType
</span><a href="#local-6989586621684558567"><span class="hs-identifier hs-var hs-var">tp'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558583"><span class="hs-identifier hs-var">tp</span></a></span><span> </span><span class="annot"><span class="annottext">PatType -&gt; (Aliasing -&gt; Aliasing) -&gt; PatType
forall dim asf ast.
TypeBase dim asf -&gt; (asf -&gt; ast) -&gt; TypeBase dim ast
</span><a href="Language.Futhark.Prop.html#addAliases"><span class="hs-operator hs-var">`addAliases`</span></a></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Aliasing -&gt; Aliasing
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Alias
</span><a href="Language.Futhark.Syntax.html#AliasBound"><span class="hs-identifier hs-var">AliasBound</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558585"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">TermScope
</span><a href="#local-6989586621684558587"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-100"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scopeVtable :: Map VName ValBinding
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#scopeVtable"><span class="hs-identifier hs-var">scopeVtable</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-101"></span><span>                </span><span class="annot"><span class="annottext">VName -&gt; ValBinding -&gt; Map VName ValBinding -&gt; Map VName ValBinding
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558585"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Locality -&gt; [TypeParam] -&gt; PatType -&gt; ValBinding
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#BoundV"><span class="hs-identifier hs-var">BoundV</span></a></span><span> </span><span class="annot"><span class="annottext">Locality
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Local"><span class="hs-identifier hs-var">Local</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558567"><span class="hs-identifier hs-var">tp'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Map VName ValBinding -&gt; Map VName ValBinding)
-&gt; Map VName ValBinding -&gt; Map VName ValBinding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-102"></span><span>                  </span><span class="annot"><span class="annottext">(ValBinding -&gt; ValBinding)
-&gt; Set VName -&gt; Map VName ValBinding -&gt; Map VName ValBinding
forall {t :: * -&gt; *} {a} {a}.
(Foldable t, Ord a) =&gt;
(a -&gt; a) -&gt; t a -&gt; Map a a -&gt; Map a a
</span><a href="#local-6989586621684558563"><span class="hs-identifier hs-var">adjustSeveral</span></a></span><span> </span><span class="annot"><span class="annottext">ValBinding -&gt; ValBinding
</span><a href="#local-6989586621684558577"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684558580"><span class="hs-identifier hs-var">inedges</span></a></span><span> </span><span class="annot"><span class="annottext">(Map VName ValBinding -&gt; Map VName ValBinding)
-&gt; Map VName ValBinding -&gt; Map VName ValBinding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-103"></span><span>                    </span><span class="annot"><span class="annottext">TermScope -&gt; Map VName ValBinding
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#scopeVtable"><span class="hs-identifier hs-var hs-var">scopeVtable</span></a></span><span> </span><span class="annot"><span class="annottext">TermScope
</span><a href="#local-6989586621684558587"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-104"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span>    </span><span id="local-6989586621684558563"><span class="annot"><span class="annottext">adjustSeveral :: (a -&gt; a) -&gt; t a -&gt; Map a a -&gt; Map a a
</span><a href="#local-6989586621684558563"><span class="hs-identifier hs-var hs-var">adjustSeveral</span></a></span></span><span> </span><span id="local-6989586621684558558"><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621684558558"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map a a -&gt; t a -&gt; Map a a) -&gt; t a -&gt; Map a a -&gt; Map a a
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">((Map a a -&gt; t a -&gt; Map a a) -&gt; t a -&gt; Map a a -&gt; Map a a)
-&gt; (Map a a -&gt; t a -&gt; Map a a) -&gt; t a -&gt; Map a a -&gt; Map a a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Map a a -&gt; a -&gt; Map a a) -&gt; Map a a -&gt; t a -&gt; Map a a
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">((Map a a -&gt; a -&gt; Map a a) -&gt; Map a a -&gt; t a -&gt; Map a a)
-&gt; (Map a a -&gt; a -&gt; Map a a) -&gt; Map a a -&gt; t a -&gt; Map a a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Map a a -&gt; Map a a) -&gt; Map a a -&gt; a -&gt; Map a a
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">((a -&gt; Map a a -&gt; Map a a) -&gt; Map a a -&gt; a -&gt; Map a a)
-&gt; (a -&gt; Map a a -&gt; Map a a) -&gt; Map a a -&gt; a -&gt; Map a a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; a -&gt; Map a a -&gt; Map a a
forall k a. Ord k =&gt; (a -&gt; a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.adjust</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621684558558"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-comment">-- Check whether the bound variables have been used correctly</span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-comment">-- within their scope.</span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621684558601"><span class="annot"><span class="annottext">check :: TermTypeM b -&gt; TermTypeM b
</span><a href="#local-6989586621684558601"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span id="local-6989586621684558549"><span class="annot"><span class="annottext">TermTypeM b
</span><a href="#local-6989586621684558549"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-111"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684558548"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621684558548"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684558547"><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684558547"><span class="hs-identifier hs-var">usages</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TermTypeM b -&gt; TermTypeM (b, Occurrences)
forall {a}. TermTypeM a -&gt; TermTypeM (a, Occurrences)
</span><a href="#local-6989586621684558546"><span class="hs-identifier hs-var">collectBindingsOccurrences</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM b
</span><a href="#local-6989586621684558549"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-112"></span><span>      </span><span class="annot"><span class="annottext">Occurrences -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#checkOccurrences"><span class="hs-identifier hs-var">checkOccurrences</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684558547"><span class="hs-identifier hs-var">usages</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span>      </span><span class="annot"><span class="annottext">(Ident -&gt; TermTypeM ()) -&gt; [Ident] -&gt; TermTypeM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Occurrences -&gt; Ident -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkIfUsed"><span class="hs-identifier hs-var">checkIfUsed</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684558547"><span class="hs-identifier hs-var">usages</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Ident]
</span><a href="#local-6989586621684558602"><span class="hs-identifier hs-var">stms</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span>      </span><span class="annot"><span class="annottext">b -&gt; TermTypeM b
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621684558548"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-comment">-- Collect and remove all occurences in @stms@.  This relies</span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-comment">-- on the fact that no variables shadow any other.</span><span>
</span><span id="line-120"></span><span>    </span><span id="local-6989586621684558546"><span class="annot"><span class="annottext">collectBindingsOccurrences :: TermTypeM a -&gt; TermTypeM (a, Occurrences)
</span><a href="#local-6989586621684558546"><span class="hs-identifier hs-var hs-var">collectBindingsOccurrences</span></a></span></span><span> </span><span id="local-6989586621684558540"><span class="annot"><span class="annottext">TermTypeM a
</span><a href="#local-6989586621684558540"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-121"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684558539"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684558539"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684558538"><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684558538"><span class="hs-identifier hs-var">usage</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TermTypeM a -&gt; TermTypeM (a, Occurrences)
forall {a}. TermTypeM a -&gt; TermTypeM (a, Occurrences)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#collectOccurrences"><span class="hs-identifier hs-var">collectOccurrences</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM a
</span><a href="#local-6989586621684558540"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-122"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684558536"><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684558536"><span class="hs-identifier hs-var">relevant</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684558535"><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684558535"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Occurrences -&gt; (Occurrences, Occurrences)
</span><a href="#local-6989586621684558534"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684558538"><span class="hs-identifier hs-var">usage</span></a></span><span>
</span><span id="line-123"></span><span>      </span><span class="annot"><span class="annottext">Occurrences -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#occur"><span class="hs-identifier hs-var">occur</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684558535"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-124"></span><span>      </span><span class="annot"><span class="annottext">(a, Occurrences) -&gt; TermTypeM (a, Occurrences)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684558539"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Occurrences
</span><a href="#local-6989586621684558536"><span class="hs-identifier hs-var">relevant</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-126"></span><span>        </span><span id="local-6989586621684558534"><span class="annot"><span class="annottext">split :: Occurrences -&gt; (Occurrences, Occurrences)
</span><a href="#local-6989586621684558534"><span class="hs-identifier hs-var hs-var">split</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-127"></span><span>          </span><span class="annot"><span class="annottext">[(Occurrence, Occurrence)] -&gt; (Occurrences, Occurrences)
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span>
</span><span id="line-128"></span><span>            </span><span class="annot"><span class="annottext">([(Occurrence, Occurrence)] -&gt; (Occurrences, Occurrences))
-&gt; (Occurrences -&gt; [(Occurrence, Occurrence)])
-&gt; Occurrences
-&gt; (Occurrences, Occurrences)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Occurrence -&gt; (Occurrence, Occurrence))
-&gt; Occurrences -&gt; [(Occurrence, Occurrence)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span>
</span><span id="line-129"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684558531"><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621684558531"><span class="hs-identifier hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-130"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684558530"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684558530"><span class="hs-identifier hs-var">obs1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684558529"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684558529"><span class="hs-identifier hs-var">obs2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; (Set VName, Set VName)
</span><a href="#local-6989586621684558528"><span class="hs-identifier hs-var">divide</span></a></span><span> </span><span class="annot"><span class="annottext">(Set VName -&gt; (Set VName, Set VName))
-&gt; Set VName -&gt; (Set VName, Set VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#observed"><span class="hs-identifier hs-var hs-var">observed</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621684558531"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-131"></span><span>                      </span><span id="local-6989586621684558524"><span class="annot"><span class="annottext">occ_cons :: Maybe (Set VName, Set VName)
</span><a href="#local-6989586621684558524"><span class="hs-identifier hs-var hs-var">occ_cons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; (Set VName, Set VName)
</span><a href="#local-6989586621684558528"><span class="hs-identifier hs-var">divide</span></a></span><span> </span><span class="annot"><span class="annottext">(Set VName -&gt; (Set VName, Set VName))
-&gt; Maybe (Set VName) -&gt; Maybe (Set VName, Set VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Occurrence -&gt; Maybe (Set VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#consumed"><span class="hs-identifier hs-var hs-var">consumed</span></a></span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621684558531"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-132"></span><span>                      </span><span id="local-6989586621684558520"><span class="annot"><span class="annottext">con1 :: Maybe (Set VName)
</span><a href="#local-6989586621684558520"><span class="hs-identifier hs-var hs-var">con1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set VName, Set VName) -&gt; Set VName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Set VName, Set VName) -&gt; Set VName)
-&gt; Maybe (Set VName, Set VName) -&gt; Maybe (Set VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Set VName, Set VName)
</span><a href="#local-6989586621684558524"><span class="hs-identifier hs-var">occ_cons</span></a></span><span>
</span><span id="line-133"></span><span>                      </span><span id="local-6989586621684558518"><span class="annot"><span class="annottext">con2 :: Maybe (Set VName)
</span><a href="#local-6989586621684558518"><span class="hs-identifier hs-var hs-var">con2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set VName, Set VName) -&gt; Set VName
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Set VName, Set VName) -&gt; Set VName)
-&gt; Maybe (Set VName, Set VName) -&gt; Maybe (Set VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Set VName, Set VName)
</span><a href="#local-6989586621684558524"><span class="hs-identifier hs-var">occ_cons</span></a></span><span>
</span><span id="line-134"></span><span>                   </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621684558531"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">observed :: Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#observed"><span class="hs-identifier hs-var">observed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684558530"><span class="hs-identifier hs-var">obs1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">consumed :: Maybe (Set VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#consumed"><span class="hs-identifier hs-var">consumed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Set VName)
</span><a href="#local-6989586621684558520"><span class="hs-identifier hs-var">con1</span></a></span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-135"></span><span>                        </span><span class="annot"><span class="annottext">Occurrence
</span><a href="#local-6989586621684558531"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">observed :: Set VName
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#observed"><span class="hs-identifier hs-var">observed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684558529"><span class="hs-identifier hs-var">obs2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">consumed :: Maybe (Set VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#consumed"><span class="hs-identifier hs-var">consumed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Set VName)
</span><a href="#local-6989586621684558518"><span class="hs-identifier hs-var">con2</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-136"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>        </span><span id="local-6989586621684558516"><span class="annot"><span class="annottext">names :: Set VName
</span><a href="#local-6989586621684558516"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; Set VName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; Set VName) -&gt; [VName] -&gt; Set VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Ident -&gt; VName) -&gt; [Ident] -&gt; [VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; VName
forall (f :: * -&gt; *) vn. IdentBase f vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#identName"><span class="hs-identifier hs-var hs-var">identName</span></a></span><span> </span><span class="annot"><span class="annottext">[Ident]
</span><a href="#local-6989586621684558602"><span class="hs-identifier hs-var">stms</span></a></span><span>
</span><span id="line-139"></span><span>        </span><span id="local-6989586621684558528"><span class="annot"><span class="annottext">divide :: Set VName -&gt; (Set VName, Set VName)
</span><a href="#local-6989586621684558528"><span class="hs-identifier hs-var hs-var">divide</span></a></span></span><span> </span><span id="local-6989586621684558512"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684558512"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684558512"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`S.intersection`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684558516"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684558512"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`S.difference`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684558516"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span id="local-6989586621684559122"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingTypes"><span class="hs-identifier hs-type">bindingTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#TypeBinding"><span class="hs-identifier hs-type">TypeBinding</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Unify.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-143"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684559122"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-144"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684559122"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-145"></span><span id="bindingTypes"><span class="annot"><span class="annottext">bindingTypes :: forall a.
[Either (VName, TypeBinding) (VName, Constraint)]
-&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingTypes"><span class="hs-identifier hs-var hs-var">bindingTypes</span></a></span></span><span> </span><span id="local-6989586621684558501"><span class="annot"><span class="annottext">[Either (VName, TypeBinding) (VName, Constraint)]
</span><a href="#local-6989586621684558501"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span id="local-6989586621684558500"><span class="annot"><span class="annottext">TermTypeM a
</span><a href="#local-6989586621684558500"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-146"></span><span>  </span><span id="local-6989586621684558499"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684558499"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TermTypeM Int
forall (m :: * -&gt; *). MonadUnify m =&gt; m Int
</span><a href="Language.Futhark.TypeChecker.Unify.html#curLevel"><span class="hs-identifier hs-var">curLevel</span></a></span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><span class="annottext">(Map VName (Int, Constraint) -&gt; Map VName (Int, Constraint))
-&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
(Map VName (Int, Constraint) -&gt; Map VName (Int, Constraint))
-&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#modifyConstraints"><span class="hs-identifier hs-var">modifyConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map VName (Int, Constraint)
-&gt; Map VName (Int, Constraint) -&gt; Map VName (Int, Constraint)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Constraint -&gt; (Int, Constraint))
-&gt; Map VName Constraint -&gt; Map VName (Int, Constraint)
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684558499"><span class="hs-identifier hs-var">lvl</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(VName, Constraint)] -&gt; Map VName Constraint
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(VName, Constraint)]
</span><a href="#local-6989586621684558494"><span class="hs-identifier hs-var">constraints</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><span class="annottext">(TermScope -&gt; TermScope) -&gt; TermTypeM a -&gt; TermTypeM a
forall a. (TermScope -&gt; TermScope) -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#localScope"><span class="hs-identifier hs-var">localScope</span></a></span><span> </span><span class="annot"><span class="annottext">TermScope -&gt; TermScope
</span><a href="#local-6989586621684558493"><span class="hs-identifier hs-var">extend</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM a
</span><a href="#local-6989586621684558500"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684558492"><span class="annot"><span class="annottext">[(VName, TypeBinding)]
</span><a href="#local-6989586621684558492"><span class="hs-identifier hs-var">tbinds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684558494"><span class="annot"><span class="annottext">[(VName, Constraint)]
</span><a href="#local-6989586621684558494"><span class="hs-identifier hs-var">constraints</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either (VName, TypeBinding) (VName, Constraint)]
-&gt; ([(VName, TypeBinding)], [(VName, Constraint)])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span> </span><span class="annot"><span class="annottext">[Either (VName, TypeBinding) (VName, Constraint)]
</span><a href="#local-6989586621684558501"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span id="local-6989586621684558493"><span class="annot"><span class="annottext">extend :: TermScope -&gt; TermScope
</span><a href="#local-6989586621684558493"><span class="hs-identifier hs-var hs-var">extend</span></a></span></span><span> </span><span id="local-6989586621684558487"><span class="annot"><span class="annottext">TermScope
</span><a href="#local-6989586621684558487"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-152"></span><span>      </span><span class="annot"><span class="annottext">TermScope
</span><a href="#local-6989586621684558487"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-153"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scopeTypeTable :: Map VName TypeBinding
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#scopeTypeTable"><span class="hs-identifier hs-var">scopeTypeTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(VName, TypeBinding)] -&gt; Map VName TypeBinding
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(VName, TypeBinding)]
</span><a href="#local-6989586621684558492"><span class="hs-identifier hs-var">tbinds</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName TypeBinding
-&gt; Map VName TypeBinding -&gt; Map VName TypeBinding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TermScope -&gt; Map VName TypeBinding
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#scopeTypeTable"><span class="hs-identifier hs-var hs-var">scopeTypeTable</span></a></span><span> </span><span class="annot"><span class="annottext">TermScope
</span><a href="#local-6989586621684558487"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-154"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span id="local-6989586621684559109"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingTypeParams"><span class="hs-identifier hs-type">bindingTypeParams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#TypeParam"><span class="hs-identifier hs-type">TypeParam</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684559109"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684559109"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-157"></span><span id="bindingTypeParams"><span class="annot"><span class="annottext">bindingTypeParams :: forall a. [TypeParam] -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingTypeParams"><span class="hs-identifier hs-var hs-var">bindingTypeParams</span></a></span></span><span> </span><span id="local-6989586621684558483"><span class="annot"><span class="annottext">[TypeParam]
</span><a href="#local-6989586621684558483"><span class="hs-identifier hs-var">tparams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><span class="annottext">[Ident] -&gt; TermTypeM a -&gt; TermTypeM a
forall a. [Ident] -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#binding"><span class="hs-identifier hs-var">binding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeParam -&gt; Maybe Ident) -&gt; [TypeParam] -&gt; [Ident]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">TypeParam -&gt; Maybe Ident
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#typeParamIdent"><span class="hs-identifier hs-var">typeParamIdent</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParam]
</span><a href="#local-6989586621684558483"><span class="hs-identifier hs-var">tparams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><span class="annottext">(TermTypeM a -&gt; TermTypeM a)
-&gt; (TermTypeM a -&gt; TermTypeM a) -&gt; TermTypeM a -&gt; TermTypeM a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Either (VName, TypeBinding) (VName, Constraint)]
-&gt; TermTypeM a -&gt; TermTypeM a
forall a.
[Either (VName, TypeBinding) (VName, Constraint)]
-&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingTypes"><span class="hs-identifier hs-var">bindingTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeParam -&gt; [Either (VName, TypeBinding) (VName, Constraint)])
-&gt; [TypeParam] -&gt; [Either (VName, TypeBinding) (VName, Constraint)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">TypeParam -&gt; [Either (VName, TypeBinding) (VName, Constraint)]
</span><a href="#local-6989586621684558479"><span class="hs-identifier hs-var">typeParamType</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParam]
</span><a href="#local-6989586621684558483"><span class="hs-identifier hs-var">tparams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-161"></span><span>    </span><span id="local-6989586621684558479"><span class="annot"><span class="annottext">typeParamType :: TypeParam -&gt; [Either (VName, TypeBinding) (VName, Constraint)]
</span><a href="#local-6989586621684558479"><span class="hs-identifier hs-var hs-var">typeParamType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeParamType"><span class="hs-identifier hs-type">TypeParamType</span></a></span><span> </span><span id="local-6989586621684558477"><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684558477"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621684558476"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558476"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621684558475"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558475"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-162"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(VName, TypeBinding)
-&gt; Either (VName, TypeBinding) (VName, Constraint)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558476"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Liftedness -&gt; [TypeParam] -&gt; StructRetType -&gt; TypeBinding
</span><a href="Language.Futhark.Semantic.html#TypeAbbr"><span class="hs-identifier hs-var">TypeAbbr</span></a></span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684558477"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(StructRetType -&gt; TypeBinding) -&gt; StructRetType -&gt; TypeBinding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; StructType -&gt; StructRetType
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(StructType -&gt; StructRetType) -&gt; StructType -&gt; StructRetType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; StructType
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">()
-&gt; Uniqueness
-&gt; TypeName
-&gt; [TypeArg (DimDecl VName)]
-&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as.
as
-&gt; Uniqueness -&gt; TypeName -&gt; [TypeArg dim] -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Nonunique"><span class="hs-identifier hs-var">Nonunique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; TypeName
</span><a href="Language.Futhark.Prop.html#typeName"><span class="hs-identifier hs-var">typeName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558476"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-163"></span><span>        </span><span class="annot"><span class="annottext">(VName, Constraint)
-&gt; Either (VName, TypeBinding) (VName, Constraint)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558476"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Liftedness -&gt; SrcLoc -&gt; Constraint
</span><a href="Language.Futhark.TypeChecker.Unify.html#ParamType"><span class="hs-identifier hs-var">ParamType</span></a></span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684558477"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558475"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><a href="#local-6989586621684558479"><span class="hs-identifier hs-var">typeParamType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeParamDim"><span class="hs-identifier hs-type">TypeParamDim</span></a></span><span> </span><span id="local-6989586621684558466"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558466"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621684558465"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558465"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-166"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(VName, Constraint)
-&gt; Either (VName, TypeBinding) (VName, Constraint)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558466"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Constraint
</span><a href="Language.Futhark.TypeChecker.Unify.html#ParamSize"><span class="hs-identifier hs-var">ParamSize</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558465"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#typeParamIdent"><span class="hs-identifier hs-type">typeParamIdent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#TypeParam"><span class="hs-identifier hs-type">TypeParam</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.Futhark.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span>
</span><span id="line-169"></span><span id="typeParamIdent"><span class="annot"><span class="annottext">typeParamIdent :: TypeParam -&gt; Maybe Ident
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#typeParamIdent"><span class="hs-identifier hs-var hs-var">typeParamIdent</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeParamDim"><span class="hs-identifier hs-type">TypeParamDim</span></a></span><span> </span><span id="local-6989586621684558464"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558464"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621684558463"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558463"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-170"></span><span>  </span><span class="annot"><span class="annottext">Ident -&gt; Maybe Ident
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Ident -&gt; Maybe Ident) -&gt; Ident -&gt; Maybe Ident
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Info PatType -&gt; SrcLoc -&gt; Ident
forall (f :: * -&gt; *) vn.
vn -&gt; f PatType -&gt; SrcLoc -&gt; IdentBase f vn
</span><a href="Language.Futhark.Syntax.html#Ident"><span class="hs-identifier hs-var">Ident</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558464"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; Info PatType
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">(PatType -&gt; Info PatType) -&gt; PatType -&gt; Info PatType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing -&gt; PatType
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) Aliasing -&gt; PatType)
-&gt; ScalarTypeBase (DimDecl VName) Aliasing -&gt; PatType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall dim as. PrimType -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimType -&gt; ScalarTypeBase (DimDecl VName) Aliasing)
-&gt; PrimType -&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Language.Futhark.Syntax.html#Signed"><span class="hs-identifier hs-var">Signed</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558463"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-171"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#typeParamIdent"><span class="hs-identifier hs-var">typeParamIdent</span></a></span><span> </span><span class="annot"><span class="annottext">TypeParam
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Ident
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span id="local-6989586621684559084"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingIdent"><span class="hs-identifier hs-type">bindingIdent</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-174"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#IdentBase"><span class="hs-identifier hs-type">IdentBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-175"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatType"><span class="hs-identifier hs-type">PatType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684559084"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-177"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684559084"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-178"></span><span id="bindingIdent"><span class="annot"><span class="annottext">bindingIdent :: forall a.
IdentBase NoInfo Name
-&gt; PatType -&gt; (Ident -&gt; TermTypeM a) -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingIdent"><span class="hs-identifier hs-var hs-var">bindingIdent</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span> </span><span id="local-6989586621684558456"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558456"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo PatType
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684558454"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558454"><span class="hs-identifier hs-var">vloc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684558453"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558453"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621684558452"><span class="annot"><span class="annottext">Ident -&gt; TermTypeM a
</span><a href="#local-6989586621684558452"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-179"></span><span>  </span><span class="annot"><span class="annottext">[(Namespace, Name)] -&gt; TermTypeM a -&gt; TermTypeM a
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
[(Namespace, Name)] -&gt; m a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#bindSpaced"><span class="hs-identifier hs-var">bindSpaced</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558456"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TermTypeM a -&gt; TermTypeM a) -&gt; TermTypeM a -&gt; TermTypeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-180"></span><span>    </span><span id="local-6989586621684558449"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558449"><span class="hs-identifier hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Namespace -&gt; Name -&gt; SrcLoc -&gt; TermTypeM VName
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
Namespace -&gt; Name -&gt; SrcLoc -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Monad.html#checkName"><span class="hs-identifier hs-var">checkName</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558456"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558454"><span class="hs-identifier hs-var">vloc</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684558447"><span class="annot"><span class="annottext">ident :: Ident
</span><a href="#local-6989586621684558447"><span class="hs-identifier hs-var hs-var">ident</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Info PatType -&gt; SrcLoc -&gt; Ident
forall (f :: * -&gt; *) vn.
vn -&gt; f PatType -&gt; SrcLoc -&gt; IdentBase f vn
</span><a href="Language.Futhark.Syntax.html#Ident"><span class="hs-identifier hs-var">Ident</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558449"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; Info PatType
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558453"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558454"><span class="hs-identifier hs-var">vloc</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><span class="annottext">[Ident] -&gt; TermTypeM a -&gt; TermTypeM a
forall a. [Ident] -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#binding"><span class="hs-identifier hs-var">binding</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621684558447"><span class="hs-identifier hs-var">ident</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TermTypeM a -&gt; TermTypeM a) -&gt; TermTypeM a -&gt; TermTypeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; TermTypeM a
</span><a href="#local-6989586621684558452"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621684558447"><span class="hs-identifier hs-var">ident</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span id="local-6989586621684559079"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingSizes"><span class="hs-identifier hs-type">bindingSizes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Syntax.html#SizeBinder"><span class="hs-identifier hs-type">SizeBinder</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Syntax.html#SizeBinder"><span class="hs-identifier hs-type">SizeBinder</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684559079"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684559079"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-185"></span><span id="bindingSizes"><span class="annot"><span class="annottext">bindingSizes :: forall a.
[SizeBinder Name]
-&gt; ([SizeBinder VName] -&gt; TermTypeM a) -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingSizes"><span class="hs-identifier hs-var hs-var">bindingSizes</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621684558434"><span class="annot"><span class="annottext">[SizeBinder VName] -&gt; TermTypeM a
</span><a href="#local-6989586621684558434"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName] -&gt; TermTypeM a
</span><a href="#local-6989586621684558434"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Minor optimisation.</span><span>
</span><span id="line-186"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingSizes"><span class="hs-identifier hs-var">bindingSizes</span></a></span><span> </span><span id="local-6989586621684558433"><span class="annot"><span class="annottext">[SizeBinder Name]
</span><a href="#local-6989586621684558433"><span class="hs-identifier hs-var">sizes</span></a></span></span><span> </span><span id="local-6989586621684558432"><span class="annot"><span class="annottext">[SizeBinder VName] -&gt; TermTypeM a
</span><a href="#local-6989586621684558432"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><span class="annottext">(Map Name SrcLoc -&gt; SizeBinder Name -&gt; TermTypeM (Map Name SrcLoc))
-&gt; Map Name SrcLoc -&gt; [SizeBinder Name] -&gt; TermTypeM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">foldM_</span></span><span> </span><span class="annot"><span class="annottext">Map Name SrcLoc -&gt; SizeBinder Name -&gt; TermTypeM (Map Name SrcLoc)
forall {k} {m :: * -&gt; *}.
(Ord k, MonadTypeChecker m) =&gt;
Map k SrcLoc -&gt; SizeBinder k -&gt; m (Map k SrcLoc)
</span><a href="#local-6989586621684558430"><span class="hs-identifier hs-var">lookForDuplicates</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name SrcLoc
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">[SizeBinder Name]
</span><a href="#local-6989586621684558433"><span class="hs-identifier hs-var">sizes</span></a></span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><span class="annottext">[(Namespace, Name)] -&gt; TermTypeM a -&gt; TermTypeM a
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
[(Namespace, Name)] -&gt; m a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#bindSpaced"><span class="hs-identifier hs-var">bindSpaced</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SizeBinder Name -&gt; (Namespace, Name))
-&gt; [SizeBinder Name] -&gt; [(Namespace, Name)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">SizeBinder Name -&gt; (Namespace, Name)
forall {b}. SizeBinder b -&gt; (Namespace, b)
</span><a href="#local-6989586621684558429"><span class="hs-identifier hs-var">sizeWithSpace</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder Name]
</span><a href="#local-6989586621684558433"><span class="hs-identifier hs-var">sizes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM a -&gt; TermTypeM a) -&gt; TermTypeM a -&gt; TermTypeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-189"></span><span>    </span><span id="local-6989586621684558428"><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558428"><span class="hs-identifier hs-var">sizes'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SizeBinder Name -&gt; TermTypeM (SizeBinder VName))
-&gt; [SizeBinder Name] -&gt; TermTypeM [SizeBinder VName]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">SizeBinder Name -&gt; TermTypeM (SizeBinder VName)
forall {f :: * -&gt; *}.
MonadTypeChecker f =&gt;
SizeBinder Name -&gt; f (SizeBinder VName)
</span><a href="#local-6989586621684558426"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder Name]
</span><a href="#local-6989586621684558433"><span class="hs-identifier hs-var">sizes</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><span class="annottext">[Ident] -&gt; TermTypeM a -&gt; TermTypeM a
forall a. [Ident] -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#binding"><span class="hs-identifier hs-var">binding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SizeBinder VName -&gt; Ident) -&gt; [SizeBinder VName] -&gt; [Ident]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">SizeBinder VName -&gt; Ident
forall {vn}. SizeBinder vn -&gt; IdentBase Info vn
</span><a href="#local-6989586621684558425"><span class="hs-identifier hs-var">sizeWithType</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558428"><span class="hs-identifier hs-var">sizes'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM a -&gt; TermTypeM a) -&gt; TermTypeM a -&gt; TermTypeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName] -&gt; TermTypeM a
</span><a href="#local-6989586621684558432"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558428"><span class="hs-identifier hs-var">sizes'</span></a></span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621684558430"><span class="annot"><span class="annottext">lookForDuplicates :: Map k SrcLoc -&gt; SizeBinder k -&gt; m (Map k SrcLoc)
</span><a href="#local-6989586621684558430"><span class="hs-identifier hs-var hs-var">lookForDuplicates</span></a></span></span><span> </span><span id="local-6989586621684558405"><span class="annot"><span class="annottext">Map k SrcLoc
</span><a href="#local-6989586621684558405"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span id="local-6989586621684558404"><span class="annot"><span class="annottext">SizeBinder k
</span><a href="#local-6989586621684558404"><span class="hs-identifier hs-var">size</span></a></span></span><span>
</span><span id="line-193"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684558403"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558403"><span class="hs-identifier hs-var">prevloc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">k -&gt; Map k SrcLoc -&gt; Maybe SrcLoc
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SizeBinder k -&gt; k
forall vn. SizeBinder vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#sizeName"><span class="hs-identifier hs-var hs-var">sizeName</span></a></span><span> </span><span class="annot"><span class="annottext">SizeBinder k
</span><a href="#local-6989586621684558404"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map k SrcLoc
</span><a href="#local-6989586621684558405"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-194"></span><span>        </span><span class="annot"><span class="annottext">SizeBinder k -&gt; Notes -&gt; Doc -&gt; m (Map k SrcLoc)
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SizeBinder k
</span><a href="#local-6989586621684558404"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; m (Map k SrcLoc)) -&gt; Doc -&gt; m (Map k SrcLoc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-195"></span><span>          </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Size name also bound at &quot;</span></span><span>
</span><span id="line-196"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Doc
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; SrcLoc -&gt; [Char]
forall a b. (Located a, Located b) =&gt; a -&gt; b -&gt; [Char]
</span><a href="Language.Futhark.Core.html#locStrRel"><span class="hs-identifier hs-var">locStrRel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SizeBinder k -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">SizeBinder k
</span><a href="#local-6989586621684558404"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558403"><span class="hs-identifier hs-var">prevloc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-198"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-199"></span><span>        </span><span class="annot"><span class="annottext">Map k SrcLoc -&gt; m (Map k SrcLoc)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Map k SrcLoc -&gt; m (Map k SrcLoc))
-&gt; Map k SrcLoc -&gt; m (Map k SrcLoc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">k -&gt; SrcLoc -&gt; Map k SrcLoc -&gt; Map k SrcLoc
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SizeBinder k -&gt; k
forall vn. SizeBinder vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#sizeName"><span class="hs-identifier hs-var hs-var">sizeName</span></a></span><span> </span><span class="annot"><span class="annottext">SizeBinder k
</span><a href="#local-6989586621684558404"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SizeBinder k -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">SizeBinder k
</span><a href="#local-6989586621684558404"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map k SrcLoc
</span><a href="#local-6989586621684558405"><span class="hs-identifier hs-var">prev</span></a></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>    </span><span id="local-6989586621684558429"><span class="annot"><span class="annottext">sizeWithSpace :: SizeBinder b -&gt; (Namespace, b)
</span><a href="#local-6989586621684558429"><span class="hs-identifier hs-var hs-var">sizeWithSpace</span></a></span></span><span> </span><span id="local-6989586621684558398"><span class="annot"><span class="annottext">SizeBinder b
</span><a href="#local-6989586621684558398"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-202"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SizeBinder b -&gt; b
forall vn. SizeBinder vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#sizeName"><span class="hs-identifier hs-var hs-var">sizeName</span></a></span><span> </span><span class="annot"><span class="annottext">SizeBinder b
</span><a href="#local-6989586621684558398"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>    </span><span id="local-6989586621684558425"><span class="annot"><span class="annottext">sizeWithType :: SizeBinder vn -&gt; IdentBase Info vn
</span><a href="#local-6989586621684558425"><span class="hs-identifier hs-var hs-var">sizeWithType</span></a></span></span><span> </span><span id="local-6989586621684558396"><span class="annot"><span class="annottext">SizeBinder vn
</span><a href="#local-6989586621684558396"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-204"></span><span>      </span><span class="annot"><span class="annottext">vn -&gt; Info PatType -&gt; SrcLoc -&gt; IdentBase Info vn
forall (f :: * -&gt; *) vn.
vn -&gt; f PatType -&gt; SrcLoc -&gt; IdentBase f vn
</span><a href="Language.Futhark.Syntax.html#Ident"><span class="hs-identifier hs-var">Ident</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SizeBinder vn -&gt; vn
forall vn. SizeBinder vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#sizeName"><span class="hs-identifier hs-var hs-var">sizeName</span></a></span><span> </span><span class="annot"><span class="annottext">SizeBinder vn
</span><a href="#local-6989586621684558396"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; Info PatType
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing -&gt; PatType
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType -&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall dim as. PrimType -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Language.Futhark.Syntax.html#Signed"><span class="hs-identifier hs-var">Signed</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SizeBinder vn -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">SizeBinder vn
</span><a href="#local-6989586621684558396"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span>    </span><span id="local-6989586621684558426"><span class="annot"><span class="annottext">check :: SizeBinder Name -&gt; f (SizeBinder VName)
</span><a href="#local-6989586621684558426"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#SizeBinder"><span class="hs-identifier hs-type">SizeBinder</span></a></span><span> </span><span id="local-6989586621684558385"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558385"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621684558384"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558384"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-207"></span><span>      </span><span class="annot"><span class="annottext">VName -&gt; SrcLoc -&gt; SizeBinder VName
forall vn. vn -&gt; SrcLoc -&gt; SizeBinder vn
</span><a href="Language.Futhark.Syntax.html#SizeBinder"><span class="hs-identifier hs-var">SizeBinder</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; SrcLoc -&gt; SizeBinder VName)
-&gt; f VName -&gt; f (SrcLoc -&gt; SizeBinder VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Namespace -&gt; Name -&gt; SrcLoc -&gt; f VName
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
Namespace -&gt; Name -&gt; SrcLoc -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Monad.html#checkName"><span class="hs-identifier hs-var">checkName</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558385"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558384"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">f (SrcLoc -&gt; SizeBinder VName) -&gt; f SrcLoc -&gt; f (SizeBinder VName)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; f SrcLoc
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558384"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#patternDims"><span class="hs-identifier hs-type">patternDims</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#Ident"><span class="hs-identifier hs-type">Ident</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-210"></span><span id="patternDims"><span class="annot"><span class="annottext">patternDims :: PatBase Info VName -&gt; [Ident]
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#patternDims"><span class="hs-identifier hs-var hs-var">patternDims</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatParens"><span class="hs-identifier hs-type">PatParens</span></a></span><span> </span><span id="local-6989586621684558380"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684558380"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; [Ident]
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#patternDims"><span class="hs-identifier hs-var">patternDims</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684558380"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-211"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#patternDims"><span class="hs-identifier hs-var">patternDims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TuplePat"><span class="hs-identifier hs-type">TuplePat</span></a></span><span> </span><span id="local-6989586621684558378"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684558378"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; [Ident]) -&gt; [PatBase Info VName] -&gt; [Ident]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; [Ident]
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#patternDims"><span class="hs-identifier hs-var">patternDims</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684558378"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-212"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#patternDims"><span class="hs-identifier hs-var">patternDims</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatAscription"><span class="hs-identifier hs-type">PatAscription</span></a></span><span> </span><span id="local-6989586621684558376"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684558376"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeDecl"><span class="hs-identifier hs-type">TypeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span id="local-6989586621684558374"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558374"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-213"></span><span>  </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; [Ident]
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#patternDims"><span class="hs-identifier hs-var">patternDims</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684558376"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[Ident] -&gt; [Ident] -&gt; [Ident]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(DimDecl VName -&gt; Maybe Ident) -&gt; [DimDecl VName] -&gt; [Ident]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; DimDecl VName -&gt; Maybe Ident
forall {p} {vn} {a}. p -&gt; DimDecl vn -&gt; Maybe a
</span><a href="#local-6989586621684558373"><span class="hs-identifier hs-var">dimIdent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatBase Info VName -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684558376"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StructType -&gt; [DimDecl VName]
forall as. TypeBase (DimDecl VName) as -&gt; [DimDecl VName]
</span><a href="Language.Futhark.Prop.html#nestedDims"><span class="hs-identifier hs-var">nestedDims</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558374"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-215"></span><span>    </span><span id="local-6989586621684558373"><span class="annot"><span class="annottext">dimIdent :: p -&gt; DimDecl vn -&gt; Maybe a
</span><a href="#local-6989586621684558373"><span class="hs-identifier hs-var hs-var">dimIdent</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#AnyDim"><span class="hs-identifier hs-type">AnyDim</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe vn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Maybe a
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;patternDims: AnyDim&quot;</span></span><span>
</span><span id="line-216"></span><span>    </span><span class="annot"><a href="#local-6989586621684558373"><span class="hs-identifier hs-var">dimIdent</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ConstDim"><span class="hs-identifier hs-type">ConstDim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-217"></span><span>    </span><span class="annot"><a href="#local-6989586621684558373"><span class="hs-identifier hs-var">dimIdent</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NamedDim"><span class="hs-identifier hs-type">NamedDim</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-218"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#patternDims"><span class="hs-identifier hs-var">patternDims</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span id="local-6989586621684559044"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingPat"><span class="hs-identifier hs-type">bindingPat</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Syntax.html#SizeBinder"><span class="hs-identifier hs-type">SizeBinder</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-222"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatBase"><span class="hs-identifier hs-type">PatBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-223"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#InferredType"><span class="hs-identifier hs-type">InferredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684559044"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-225"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684559044"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-226"></span><span id="bindingPat"><span class="annot"><span class="annottext">bindingPat :: forall a.
[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; (PatBase Info VName -&gt; TermTypeM a)
-&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingPat"><span class="hs-identifier hs-var hs-var">bindingPat</span></a></span></span><span> </span><span id="local-6989586621684558357"><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558357"><span class="hs-identifier hs-var">sizes</span></a></span></span><span> </span><span id="local-6989586621684558356"><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558356"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621684558355"><span class="annot"><span class="annottext">InferredType
</span><a href="#local-6989586621684558355"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621684558354"><span class="annot"><span class="annottext">PatBase Info VName -&gt; TermTypeM a
</span><a href="#local-6989586621684558354"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-227"></span><span>  </span><span class="annot"><span class="annottext">[PatBase NoInfo Name] -&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
[PatBase NoInfo Name] -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Types.html#checkForDuplicateNames"><span class="hs-identifier hs-var">checkForDuplicateNames</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558356"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-228"></span><span>  </span><span class="annot"><span class="annottext">[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; (PatBase Info VName -&gt; TermTypeM a)
-&gt; TermTypeM a
forall a.
[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; (PatBase Info VName -&gt; TermTypeM a)
-&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat"><span class="hs-identifier hs-var">checkPat</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558357"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558356"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">InferredType
</span><a href="#local-6989586621684558355"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">((PatBase Info VName -&gt; TermTypeM a) -&gt; TermTypeM a)
-&gt; (PatBase Info VName -&gt; TermTypeM a) -&gt; TermTypeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684558352"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684558352"><span class="hs-identifier hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Ident] -&gt; TermTypeM a -&gt; TermTypeM a
forall a. [Ident] -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#binding"><span class="hs-identifier hs-var">binding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Ident -&gt; [Ident]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set Ident -&gt; [Ident]) -&gt; Set Ident -&gt; [Ident]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Set Ident
forall (f :: * -&gt; *) vn.
(Functor f, Ord vn) =&gt;
PatBase f vn -&gt; Set (IdentBase f vn)
</span><a href="Language.Futhark.Prop.html#patIdents"><span class="hs-identifier hs-var">patIdents</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684558352"><span class="hs-identifier hs-var">p'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM a -&gt; TermTypeM a) -&gt; TermTypeM a -&gt; TermTypeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-comment">-- Perform an observation of every declared dimension.  This</span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-comment">-- prevents unused-name warnings for otherwise unused dimensions.</span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><span class="annottext">(Ident -&gt; TermTypeM ()) -&gt; [Ident] -&gt; TermTypeM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#observe"><span class="hs-identifier hs-var">observe</span></a></span><span> </span><span class="annot"><span class="annottext">([Ident] -&gt; TermTypeM ()) -&gt; [Ident] -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; [Ident]
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#patternDims"><span class="hs-identifier hs-var">patternDims</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684558352"><span class="hs-identifier hs-var">p'</span></a></span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684558348"><span class="annot"><span class="annottext">used_sizes :: Set VName
</span><a href="#local-6989586621684558348"><span class="hs-identifier hs-var hs-var">used_sizes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StructType -&gt; Set VName
forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="Language.Futhark.Prop.html#typeDimNames"><span class="hs-identifier hs-var">typeDimNames</span></a></span><span> </span><span class="annot"><span class="annottext">(StructType -&gt; Set VName) -&gt; StructType -&gt; Set VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; StructType
</span><a href="Language.Futhark.Prop.html#patternStructType"><span class="hs-identifier hs-var">patternStructType</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684558352"><span class="hs-identifier hs-var">p'</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(SizeBinder VName -&gt; Bool)
-&gt; [SizeBinder VName] -&gt; [SizeBinder VName]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.notMember`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684558348"><span class="hs-identifier hs-var">used_sizes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Bool)
-&gt; (SizeBinder VName -&gt; VName) -&gt; SizeBinder VName -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SizeBinder VName -&gt; VName
forall vn. SizeBinder vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#sizeName"><span class="hs-identifier hs-var hs-var">sizeName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558357"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-235"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; TermTypeM a
</span><a href="#local-6989586621684558354"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684558352"><span class="hs-identifier hs-var">p'</span></a></span><span>
</span><span id="line-236"></span><span>      </span><span id="local-6989586621684558344"><span class="annot"><span class="annottext">SizeBinder VName
</span><a href="#local-6989586621684558344"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SizeBinder VName -&gt; TermTypeM a
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
SizeBinder VName -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#unusedSize"><span class="hs-identifier hs-var">unusedSize</span></a></span><span> </span><span class="annot"><span class="annottext">SizeBinder VName
</span><a href="#local-6989586621684558344"><span class="hs-identifier hs-var">size</span></a></span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span class="hs-comment">-- All this complexity is just so we can handle un-suffixed numeric</span><span>
</span><span id="line-239"></span><span class="hs-comment">-- literals in patterns.</span><span>
</span><span id="line-240"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#patLitMkType"><span class="hs-identifier hs-type">patLitMkType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#PatLit"><span class="hs-identifier hs-type">PatLit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#StructType"><span class="hs-identifier hs-type">StructType</span></a></span><span>
</span><span id="line-241"></span><span id="patLitMkType"><span class="annot"><span class="annottext">patLitMkType :: PatLit -&gt; SrcLoc -&gt; TermTypeM StructType
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#patLitMkType"><span class="hs-identifier hs-var hs-var">patLitMkType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatLitInt"><span class="hs-identifier hs-type">PatLitInt</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684558340"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558340"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-242"></span><span>  </span><span id="local-6989586621684558339"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558339"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Name -&gt; TermTypeM StructType
forall (m :: * -&gt; *) als dim.
(MonadUnify m, Monoid als) =&gt;
SrcLoc -&gt; Name -&gt; m (TypeBase dim als)
</span><a href="Language.Futhark.TypeChecker.Unify.html#newTypeVar"><span class="hs-identifier hs-var">newTypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558340"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;t&quot;</span></span><span>
</span><span id="line-243"></span><span>  </span><span class="annot"><span class="annottext">[PrimType] -&gt; Usage -&gt; StructType -&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
[PrimType] -&gt; Usage -&gt; StructType -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#mustBeOneOf"><span class="hs-identifier hs-var">mustBeOneOf</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimType]
</span><a href="Language.Futhark.TypeChecker.Monad.html#anyNumberType"><span class="hs-identifier hs-var">anyNumberType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; [Char] -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558340"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;integer literal&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558339"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-244"></span><span>  </span><span class="annot"><span class="annottext">StructType -&gt; TermTypeM StructType
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558339"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-245"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#patLitMkType"><span class="hs-identifier hs-var">patLitMkType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatLitFloat"><span class="hs-identifier hs-type">PatLitFloat</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684558333"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558333"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>  </span><span id="local-6989586621684558332"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558332"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Name -&gt; TermTypeM StructType
forall (m :: * -&gt; *) als dim.
(MonadUnify m, Monoid als) =&gt;
SrcLoc -&gt; Name -&gt; m (TypeBase dim als)
</span><a href="Language.Futhark.TypeChecker.Unify.html#newTypeVar"><span class="hs-identifier hs-var">newTypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558333"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;t&quot;</span></span><span>
</span><span id="line-247"></span><span>  </span><span class="annot"><span class="annottext">[PrimType] -&gt; Usage -&gt; StructType -&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
[PrimType] -&gt; Usage -&gt; StructType -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#mustBeOneOf"><span class="hs-identifier hs-var">mustBeOneOf</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimType]
</span><a href="Language.Futhark.TypeChecker.Monad.html#anyFloatType"><span class="hs-identifier hs-var">anyFloatType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; [Char] -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558333"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;float literal&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558332"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-248"></span><span>  </span><span class="annot"><span class="annottext">StructType -&gt; TermTypeM StructType
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558332"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-249"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#patLitMkType"><span class="hs-identifier hs-var">patLitMkType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatLitPrim"><span class="hs-identifier hs-type">PatLitPrim</span></a></span><span> </span><span id="local-6989586621684558329"><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684558329"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-250"></span><span>  </span><span class="annot"><span class="annottext">StructType -&gt; TermTypeM StructType
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(StructType -&gt; TermTypeM StructType)
-&gt; StructType -&gt; TermTypeM StructType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; StructType
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) () -&gt; StructType)
-&gt; ScalarTypeBase (DimDecl VName) () -&gt; StructType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as. PrimType -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimType -&gt; ScalarTypeBase (DimDecl VName) ())
-&gt; PrimType -&gt; ScalarTypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimValue -&gt; PrimType
</span><a href="Language.Futhark.Prop.html#primValueType"><span class="hs-identifier hs-var">primValueType</span></a></span><span> </span><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684558329"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-type">checkPat'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Syntax.html#SizeBinder"><span class="hs-identifier hs-type">SizeBinder</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-254"></span><span>  </span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedPat"><span class="hs-identifier hs-type">UncheckedPat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-255"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#InferredType"><span class="hs-identifier hs-type">InferredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-256"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span>
</span><span id="line-257"></span><span id="checkPat%27"><span class="annot"><span class="annottext">checkPat' :: [SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; TermTypeM (PatBase Info VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var hs-var">checkPat'</span></a></span></span><span> </span><span id="local-6989586621684558325"><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558325"><span class="hs-identifier hs-var">sizes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatParens"><span class="hs-identifier hs-type">PatParens</span></a></span><span> </span><span id="local-6989586621684558324"><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558324"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621684558323"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558323"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684558322"><span class="annot"><span class="annottext">InferredType
</span><a href="#local-6989586621684558322"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-258"></span><span>  </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; SrcLoc -&gt; PatBase Info VName
forall (f :: * -&gt; *) vn. PatBase f vn -&gt; SrcLoc -&gt; PatBase f vn
</span><a href="Language.Futhark.Syntax.html#PatParens"><span class="hs-identifier hs-var">PatParens</span></a></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; SrcLoc -&gt; PatBase Info VName)
-&gt; TermTypeM (PatBase Info VName)
-&gt; TermTypeM (SrcLoc -&gt; PatBase Info VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; TermTypeM (PatBase Info VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558325"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558324"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">InferredType
</span><a href="#local-6989586621684558322"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM (SrcLoc -&gt; PatBase Info VName)
-&gt; TermTypeM SrcLoc -&gt; TermTypeM (PatBase Info VName)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; TermTypeM SrcLoc
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558323"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-259"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span id="local-6989586621684558321"><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558321"><span class="hs-identifier hs-var">sizes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatAttr"><span class="hs-identifier hs-type">PatAttr</span></a></span><span> </span><span id="local-6989586621684558319"><span class="annot"><span class="annottext">AttrInfo Name
</span><a href="#local-6989586621684558319"><span class="hs-identifier hs-var">attr</span></a></span></span><span> </span><span id="local-6989586621684558318"><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558318"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621684558317"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558317"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684558316"><span class="annot"><span class="annottext">InferredType
</span><a href="#local-6989586621684558316"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-260"></span><span>  </span><span class="annot"><span class="annottext">AttrInfo VName
-&gt; PatBase Info VName -&gt; SrcLoc -&gt; PatBase Info VName
forall (f :: * -&gt; *) vn.
AttrInfo vn -&gt; PatBase f vn -&gt; SrcLoc -&gt; PatBase f vn
</span><a href="Language.Futhark.Syntax.html#PatAttr"><span class="hs-identifier hs-var">PatAttr</span></a></span><span> </span><span class="annot"><span class="annottext">(AttrInfo VName
 -&gt; PatBase Info VName -&gt; SrcLoc -&gt; PatBase Info VName)
-&gt; TermTypeM (AttrInfo VName)
-&gt; TermTypeM (PatBase Info VName -&gt; SrcLoc -&gt; PatBase Info VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">AttrInfo Name -&gt; TermTypeM (AttrInfo VName)
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
AttrInfo Name -&gt; m (AttrInfo VName)
</span><a href="Language.Futhark.TypeChecker.Monad.html#checkAttr"><span class="hs-identifier hs-var">checkAttr</span></a></span><span> </span><span class="annot"><span class="annottext">AttrInfo Name
</span><a href="#local-6989586621684558319"><span class="hs-identifier hs-var">attr</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM (PatBase Info VName -&gt; SrcLoc -&gt; PatBase Info VName)
-&gt; TermTypeM (PatBase Info VName)
-&gt; TermTypeM (SrcLoc -&gt; PatBase Info VName)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; TermTypeM (PatBase Info VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558321"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558318"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">InferredType
</span><a href="#local-6989586621684558316"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM (SrcLoc -&gt; PatBase Info VName)
-&gt; TermTypeM SrcLoc -&gt; TermTypeM (PatBase Info VName)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; TermTypeM SrcLoc
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558317"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-261"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span id="local-6989586621684558313"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558313"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo PatType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684558312"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558312"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InferredType
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684558311"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [[Char]] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#doNotShadow"><span class="hs-identifier hs-var">doNotShadow</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-263"></span><span>    </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TermTypeM (PatBase Info VName)
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558312"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM (PatBase Info VName))
-&gt; Doc -&gt; TermTypeM (PatBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;The&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Doc
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684558311"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;operator may not be redefined.&quot;</span></span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-265"></span><span>    </span><span id="local-6989586621684558311"><span class="annot"><span class="annottext">name' :: [Char]
</span><a href="#local-6989586621684558311"><span class="hs-identifier hs-var hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Char]
</span><a href="Language.Futhark.Core.html#nameToString"><span class="hs-identifier hs-var">nameToString</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558313"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-266"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span id="local-6989586621684558308"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558308"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo PatType
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684558307"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558307"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Ascribed"><span class="hs-identifier hs-type">Ascribed</span></a></span><span> </span><span id="local-6989586621684558305"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558305"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-267"></span><span>  </span><span id="local-6989586621684558304"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558304"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TermTypeM VName
forall (m :: * -&gt; *). MonadTypeChecker m =&gt; Name -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Monad.html#newID"><span class="hs-identifier hs-var">newID</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558308"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-268"></span><span>  </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; TermTypeM (PatBase Info VName))
-&gt; PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Info PatType -&gt; SrcLoc -&gt; PatBase Info VName
forall (f :: * -&gt; *) vn. vn -&gt; f PatType -&gt; SrcLoc -&gt; PatBase f vn
</span><a href="Language.Futhark.Syntax.html#Id"><span class="hs-identifier hs-var">Id</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558304"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; Info PatType
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558305"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558307"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-269"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span id="local-6989586621684558303"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558303"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo PatType
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684558302"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558302"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#NoneInferred"><span class="hs-identifier hs-var">NoneInferred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-270"></span><span>  </span><span id="local-6989586621684558300"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558300"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TermTypeM VName
forall (m :: * -&gt; *). MonadTypeChecker m =&gt; Name -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Monad.html#newID"><span class="hs-identifier hs-var">newID</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558303"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-271"></span><span>  </span><span id="local-6989586621684558299"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558299"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Name -&gt; TermTypeM PatType
forall (m :: * -&gt; *) als dim.
(MonadUnify m, Monoid als) =&gt;
SrcLoc -&gt; Name -&gt; m (TypeBase dim als)
</span><a href="Language.Futhark.TypeChecker.Unify.html#newTypeVar"><span class="hs-identifier hs-var">newTypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558302"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;t&quot;</span></span><span>
</span><span id="line-272"></span><span>  </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; TermTypeM (PatBase Info VName))
-&gt; PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Info PatType -&gt; SrcLoc -&gt; PatBase Info VName
forall (f :: * -&gt; *) vn. vn -&gt; f PatType -&gt; SrcLoc -&gt; PatBase f vn
</span><a href="Language.Futhark.Syntax.html#Id"><span class="hs-identifier hs-var">Id</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558300"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; Info PatType
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558299"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558302"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-273"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Wildcard"><span class="hs-identifier hs-type">Wildcard</span></a></span><span> </span><span class="annot"><span class="annottext">NoInfo PatType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684558297"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558297"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Ascribed"><span class="hs-identifier hs-type">Ascribed</span></a></span><span> </span><span id="local-6989586621684558296"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558296"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; TermTypeM (PatBase Info VName))
-&gt; PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Info PatType -&gt; SrcLoc -&gt; PatBase Info VName
forall (f :: * -&gt; *) vn. f PatType -&gt; SrcLoc -&gt; PatBase f vn
</span><a href="Language.Futhark.Syntax.html#Wildcard"><span class="hs-identifier hs-var">Wildcard</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; Info PatType
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">(PatType -&gt; Info PatType) -&gt; PatType -&gt; Info PatType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558296"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">PatType -&gt; Uniqueness -&gt; PatType
forall dim as. TypeBase dim as -&gt; Uniqueness -&gt; TypeBase dim as
</span><a href="Language.Futhark.Prop.html#setUniqueness"><span class="hs-operator hs-var">`setUniqueness`</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Nonunique"><span class="hs-identifier hs-var">Nonunique</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558297"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-275"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Wildcard"><span class="hs-identifier hs-type">Wildcard</span></a></span><span> </span><span class="annot"><span class="annottext">NoInfo PatType
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684558294"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558294"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#NoneInferred"><span class="hs-identifier hs-var">NoneInferred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-276"></span><span>  </span><span id="local-6989586621684558293"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558293"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Name -&gt; TermTypeM PatType
forall (m :: * -&gt; *) als dim.
(MonadUnify m, Monoid als) =&gt;
SrcLoc -&gt; Name -&gt; m (TypeBase dim als)
</span><a href="Language.Futhark.TypeChecker.Unify.html#newTypeVar"><span class="hs-identifier hs-var">newTypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558294"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;t&quot;</span></span><span>
</span><span id="line-277"></span><span>  </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; TermTypeM (PatBase Info VName))
-&gt; PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Info PatType -&gt; SrcLoc -&gt; PatBase Info VName
forall (f :: * -&gt; *) vn. f PatType -&gt; SrcLoc -&gt; PatBase f vn
</span><a href="Language.Futhark.Syntax.html#Wildcard"><span class="hs-identifier hs-var">Wildcard</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; Info PatType
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558293"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558294"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-278"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span id="local-6989586621684558292"><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558292"><span class="hs-identifier hs-var">sizes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TuplePat"><span class="hs-identifier hs-type">TuplePat</span></a></span><span> </span><span id="local-6989586621684558291"><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684558291"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621684558290"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558290"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Ascribed"><span class="hs-identifier hs-type">Ascribed</span></a></span><span> </span><span id="local-6989586621684558289"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558289"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684558288"><span class="annot"><span class="annottext">[PatType]
</span><a href="#local-6989586621684558288"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatType -&gt; Maybe [PatType]
forall dim as. TypeBase dim as -&gt; Maybe [TypeBase dim as]
</span><a href="Language.Futhark.Prop.html#isTupleRecord"><span class="hs-identifier hs-var">isTupleRecord</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558289"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-280"></span><span>    </span><span class="annot"><span class="annottext">[PatType] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[PatType]
</span><a href="#local-6989586621684558288"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[PatBase NoInfo Name] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684558291"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-281"></span><span>    </span><span class="annot"><span class="annottext">[PatBase Info VName] -&gt; SrcLoc -&gt; PatBase Info VName
forall (f :: * -&gt; *) vn. [PatBase f vn] -&gt; SrcLoc -&gt; PatBase f vn
</span><a href="Language.Futhark.Syntax.html#TuplePat"><span class="hs-identifier hs-var">TuplePat</span></a></span><span>
</span><span id="line-282"></span><span>      </span><span class="annot"><span class="annottext">([PatBase Info VName] -&gt; SrcLoc -&gt; PatBase Info VName)
-&gt; TermTypeM [PatBase Info VName]
-&gt; TermTypeM (SrcLoc -&gt; PatBase Info VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(PatBase NoInfo Name
 -&gt; InferredType -&gt; TermTypeM (PatBase Info VName))
-&gt; [PatBase NoInfo Name]
-&gt; [InferredType]
-&gt; TermTypeM [PatBase Info VName]
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m [c]
</span><span class="hs-identifier hs-var">zipWithM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; TermTypeM (PatBase Info VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558292"><span class="hs-identifier hs-var">sizes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684558291"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PatType -&gt; InferredType) -&gt; [PatType] -&gt; [InferredType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PatType -&gt; InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Ascribed"><span class="hs-identifier hs-var">Ascribed</span></a></span><span> </span><span class="annot"><span class="annottext">[PatType]
</span><a href="#local-6989586621684558288"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>      </span><span class="annot"><span class="annottext">TermTypeM (SrcLoc -&gt; PatBase Info VName)
-&gt; TermTypeM SrcLoc -&gt; TermTypeM (PatBase Info VName)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; TermTypeM SrcLoc
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558290"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-284"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span id="local-6989586621684558284"><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558284"><span class="hs-identifier hs-var">sizes</span></a></span></span><span> </span><span id="local-6989586621684558283"><span class="annot"><span class="annottext">p :: PatBase NoInfo Name
</span><a href="#local-6989586621684558283"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TuplePat"><span class="hs-identifier hs-type">TuplePat</span></a></span><span> </span><span id="local-6989586621684558282"><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684558282"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621684558281"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558281"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Ascribed"><span class="hs-identifier hs-type">Ascribed</span></a></span><span> </span><span id="local-6989586621684558280"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558280"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-285"></span><span>  </span><span id="local-6989586621684558279"><span class="annot"><span class="annottext">[StructType]
</span><a href="#local-6989586621684558279"><span class="hs-identifier hs-var">ps_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TermTypeM StructType -&gt; TermTypeM [StructType]
forall (m :: * -&gt; *) a. Applicative m =&gt; Int -&gt; m a -&gt; m [a]
</span><span class="hs-identifier hs-var">replicateM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PatBase NoInfo Name] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684558282"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; Name -&gt; TermTypeM StructType
forall (m :: * -&gt; *) als dim.
(MonadUnify m, Monoid als) =&gt;
SrcLoc -&gt; Name -&gt; m (TypeBase dim als)
</span><a href="Language.Futhark.TypeChecker.Unify.html#newTypeVar"><span class="hs-identifier hs-var">newTypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558281"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;t&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>  </span><span class="annot"><span class="annottext">Usage -&gt; StructType -&gt; StructType -&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage -&gt; StructType -&gt; StructType -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; [Char] -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558281"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;matching a tuple pattern&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; StructType
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[StructType] -&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as. [TypeBase dim as] -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Prop.html#tupleRecord"><span class="hs-identifier hs-var">tupleRecord</span></a></span><span> </span><span class="annot"><span class="annottext">[StructType]
</span><a href="#local-6989586621684558279"><span class="hs-identifier hs-var">ps_t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StructType -&gt; TermTypeM ()) -&gt; StructType -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatType -&gt; StructType
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558280"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-287"></span><span>  </span><span id="local-6989586621684558274"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558274"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatType -&gt; TermTypeM PatType
forall a (m :: * -&gt; *). (Substitutable a, MonadUnify m) =&gt; a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Unify.html#normTypeFully"><span class="hs-identifier hs-var">normTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558280"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-288"></span><span>  </span><span class="annot"><span class="annottext">[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; TermTypeM (PatBase Info VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558284"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558283"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">(InferredType -&gt; TermTypeM (PatBase Info VName))
-&gt; InferredType -&gt; TermTypeM (PatBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatType -&gt; InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Ascribed"><span class="hs-identifier hs-var">Ascribed</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558274"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-289"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span id="local-6989586621684558272"><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558272"><span class="hs-identifier hs-var">sizes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TuplePat"><span class="hs-identifier hs-type">TuplePat</span></a></span><span> </span><span id="local-6989586621684558271"><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684558271"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621684558270"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558270"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#NoneInferred"><span class="hs-identifier hs-var">NoneInferred</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-290"></span><span>  </span><span class="annot"><span class="annottext">[PatBase Info VName] -&gt; SrcLoc -&gt; PatBase Info VName
forall (f :: * -&gt; *) vn. [PatBase f vn] -&gt; SrcLoc -&gt; PatBase f vn
</span><a href="Language.Futhark.Syntax.html#TuplePat"><span class="hs-identifier hs-var">TuplePat</span></a></span><span> </span><span class="annot"><span class="annottext">([PatBase Info VName] -&gt; SrcLoc -&gt; PatBase Info VName)
-&gt; TermTypeM [PatBase Info VName]
-&gt; TermTypeM (SrcLoc -&gt; PatBase Info VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(PatBase NoInfo Name -&gt; TermTypeM (PatBase Info VName))
-&gt; [PatBase NoInfo Name] -&gt; TermTypeM [PatBase Info VName]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621684558269"><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558269"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; TermTypeM (PatBase Info VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558272"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558269"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#NoneInferred"><span class="hs-identifier hs-var">NoneInferred</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684558271"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM (SrcLoc -&gt; PatBase Info VName)
-&gt; TermTypeM SrcLoc -&gt; TermTypeM (PatBase Info VName)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; TermTypeM SrcLoc
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558270"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-291"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RecordPat"><span class="hs-identifier hs-type">RecordPat</span></a></span><span> </span><span id="local-6989586621684558267"><span class="annot"><span class="annottext">[(Name, PatBase NoInfo Name)]
</span><a href="#local-6989586621684558267"><span class="hs-identifier hs-var">p_fs</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InferredType
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684558266"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558266"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684558265"><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558265"><span class="hs-identifier hs-var">fp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Name, PatBase NoInfo Name) -&gt; Bool)
-&gt; [(Name, PatBase NoInfo Name)]
-&gt; Maybe (Name, PatBase NoInfo Name)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><span class="hs-operator hs-var">`isPrefixOf`</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Bool)
-&gt; ((Name, PatBase NoInfo Name) -&gt; [Char])
-&gt; (Name, PatBase NoInfo Name)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Char]
</span><a href="Language.Futhark.Core.html#nameToString"><span class="hs-identifier hs-var">nameToString</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; [Char])
-&gt; ((Name, PatBase NoInfo Name) -&gt; Name)
-&gt; (Name, PatBase NoInfo Name)
-&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name, PatBase NoInfo Name) -&gt; Name
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, PatBase NoInfo Name)]
</span><a href="#local-6989586621684558267"><span class="hs-identifier hs-var">p_fs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-293"></span><span>    </span><span class="annot"><span class="annottext">PatBase NoInfo Name
-&gt; Notes -&gt; Doc -&gt; TermTypeM (PatBase Info VName)
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558265"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM (PatBase Info VName))
-&gt; Doc -&gt; TermTypeM (PatBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-294"></span><span>      </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Underscore-prefixed fields are not allowed.&quot;</span></span><span>
</span><span id="line-295"></span><span>        </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Did you mean&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><span class="hs-identifier hs-var">dquotes</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Doc
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Char] -&gt; [Char]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Char]
</span><a href="Language.Futhark.Core.html#nameToString"><span class="hs-identifier hs-var">nameToString</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558266"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;=_&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;?&quot;</span></span><span>
</span><span id="line-296"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span id="local-6989586621684558261"><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558261"><span class="hs-identifier hs-var">sizes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RecordPat"><span class="hs-identifier hs-type">RecordPat</span></a></span><span> </span><span id="local-6989586621684558260"><span class="annot"><span class="annottext">[(Name, PatBase NoInfo Name)]
</span><a href="#local-6989586621684558260"><span class="hs-identifier hs-var">p_fs</span></a></span></span><span> </span><span id="local-6989586621684558259"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558259"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Ascribed"><span class="hs-identifier hs-type">Ascribed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span id="local-6989586621684558257"><span class="annot"><span class="annottext">Map Name PatType
</span><a href="#local-6989586621684558257"><span class="hs-identifier hs-var">t_fs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sort</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Name, PatBase NoInfo Name) -&gt; Name)
-&gt; [(Name, PatBase NoInfo Name)] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Name, PatBase NoInfo Name) -&gt; Name
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Name, PatBase NoInfo Name)]
</span><a href="#local-6989586621684558260"><span class="hs-identifier hs-var">p_fs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sort</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name PatType -&gt; [Name]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">M.keys</span></span><span> </span><span class="annot"><span class="annottext">Map Name PatType
</span><a href="#local-6989586621684558257"><span class="hs-identifier hs-var">t_fs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-298"></span><span>    </span><span class="annot"><span class="annottext">[(Name, PatBase Info VName)] -&gt; SrcLoc -&gt; PatBase Info VName
forall (f :: * -&gt; *) vn.
[(Name, PatBase f vn)] -&gt; SrcLoc -&gt; PatBase f vn
</span><a href="Language.Futhark.Syntax.html#RecordPat"><span class="hs-identifier hs-var">RecordPat</span></a></span><span> </span><span class="annot"><span class="annottext">([(Name, PatBase Info VName)] -&gt; SrcLoc -&gt; PatBase Info VName)
-&gt; (Map Name (PatBase Info VName) -&gt; [(Name, PatBase Info VName)])
-&gt; Map Name (PatBase Info VName)
-&gt; SrcLoc
-&gt; PatBase Info VName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map Name (PatBase Info VName) -&gt; [(Name, PatBase Info VName)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map Name (PatBase Info VName) -&gt; SrcLoc -&gt; PatBase Info VName)
-&gt; TermTypeM (Map Name (PatBase Info VName))
-&gt; TermTypeM (SrcLoc -&gt; PatBase Info VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TermTypeM (Map Name (PatBase Info VName))
</span><a href="#local-6989586621684558254"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">TermTypeM (SrcLoc -&gt; PatBase Info VName)
-&gt; TermTypeM SrcLoc -&gt; TermTypeM (PatBase Info VName)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; TermTypeM SrcLoc
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558259"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-300"></span><span>    </span><span id="local-6989586621684558254"><span class="annot"><span class="annottext">check :: TermTypeM (Map Name (PatBase Info VName))
</span><a href="#local-6989586621684558254"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-301"></span><span>      </span><span class="annot"><span class="annottext">((PatBase NoInfo Name, InferredType)
 -&gt; TermTypeM (PatBase Info VName))
-&gt; Map Name (PatBase NoInfo Name, InferredType)
-&gt; TermTypeM (Map Name (PatBase Info VName))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PatBase NoInfo Name
 -&gt; InferredType -&gt; TermTypeM (PatBase Info VName))
-&gt; (PatBase NoInfo Name, InferredType)
-&gt; TermTypeM (PatBase Info VName)
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; TermTypeM (PatBase Info VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558261"><span class="hs-identifier hs-var">sizes</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Map Name (PatBase NoInfo Name, InferredType)
 -&gt; TermTypeM (Map Name (PatBase Info VName)))
-&gt; Map Name (PatBase NoInfo Name, InferredType)
-&gt; TermTypeM (Map Name (PatBase Info VName))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-302"></span><span>        </span><span class="annot"><span class="annottext">(PatBase NoInfo Name
 -&gt; InferredType -&gt; (PatBase NoInfo Name, InferredType))
-&gt; Map Name (PatBase NoInfo Name)
-&gt; Map Name InferredType
-&gt; Map Name (PatBase NoInfo Name, InferredType)
forall k a b c.
Ord k =&gt;
(a -&gt; b -&gt; c) -&gt; Map k a -&gt; Map k b -&gt; Map k c
</span><span class="hs-identifier hs-var">M.intersectionWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Name, PatBase NoInfo Name)] -&gt; Map Name (PatBase NoInfo Name)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(Name, PatBase NoInfo Name)]
</span><a href="#local-6989586621684558260"><span class="hs-identifier hs-var">p_fs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PatType -&gt; InferredType)
-&gt; Map Name PatType -&gt; Map Name InferredType
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">PatType -&gt; InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Ascribed"><span class="hs-identifier hs-var">Ascribed</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name PatType
</span><a href="#local-6989586621684558257"><span class="hs-identifier hs-var">t_fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span id="local-6989586621684558244"><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558244"><span class="hs-identifier hs-var">sizes</span></a></span></span><span> </span><span id="local-6989586621684558243"><span class="annot"><span class="annottext">p :: PatBase NoInfo Name
</span><a href="#local-6989586621684558243"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RecordPat"><span class="hs-identifier hs-type">RecordPat</span></a></span><span> </span><span id="local-6989586621684558242"><span class="annot"><span class="annottext">[(Name, PatBase NoInfo Name)]
</span><a href="#local-6989586621684558242"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span id="local-6989586621684558241"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558241"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Ascribed"><span class="hs-identifier hs-type">Ascribed</span></a></span><span> </span><span id="local-6989586621684558240"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558240"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-304"></span><span>  </span><span id="local-6989586621684558239"><span class="annot"><span class="annottext">Map Name StructType
</span><a href="#local-6989586621684558239"><span class="hs-identifier hs-var">fields'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PatBase NoInfo Name -&gt; TermTypeM StructType)
-&gt; Map Name (PatBase NoInfo Name)
-&gt; TermTypeM (Map Name StructType)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermTypeM StructType -&gt; PatBase NoInfo Name -&gt; TermTypeM StructType
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(TermTypeM StructType
 -&gt; PatBase NoInfo Name -&gt; TermTypeM StructType)
-&gt; TermTypeM StructType
-&gt; PatBase NoInfo Name
-&gt; TermTypeM StructType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Name -&gt; TermTypeM StructType
forall (m :: * -&gt; *) als dim.
(MonadUnify m, Monoid als) =&gt;
SrcLoc -&gt; Name -&gt; m (TypeBase dim als)
</span><a href="Language.Futhark.TypeChecker.Unify.html#newTypeVar"><span class="hs-identifier hs-var">newTypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558241"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;t&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Map Name (PatBase NoInfo Name) -&gt; TermTypeM (Map Name StructType))
-&gt; Map Name (PatBase NoInfo Name)
-&gt; TermTypeM (Map Name StructType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Name, PatBase NoInfo Name)] -&gt; Map Name (PatBase NoInfo Name)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(Name, PatBase NoInfo Name)]
</span><a href="#local-6989586621684558242"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TermTypeM () -&gt; TermTypeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; [Name]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sort</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name StructType -&gt; [Name]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">M.keys</span></span><span> </span><span class="annot"><span class="annottext">Map Name StructType
</span><a href="#local-6989586621684558239"><span class="hs-identifier hs-var">fields'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sort</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Name, PatBase NoInfo Name) -&gt; Name)
-&gt; [(Name, PatBase NoInfo Name)] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Name, PatBase NoInfo Name) -&gt; Name
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Name, PatBase NoInfo Name)]
</span><a href="#local-6989586621684558242"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM () -&gt; TermTypeM ()) -&gt; TermTypeM () -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-307"></span><span>    </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TermTypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558241"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM ()) -&gt; Doc -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Duplicate fields in record pattern&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">PatBase NoInfo Name -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558243"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span>  </span><span class="annot"><span class="annottext">Usage -&gt; StructType -&gt; StructType -&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage -&gt; StructType -&gt; StructType -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; [Char] -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558241"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;matching a record pattern&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; StructType
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name StructType -&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as. Map Name (TypeBase dim as) -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Record"><span class="hs-identifier hs-var">Record</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name StructType
</span><a href="#local-6989586621684558239"><span class="hs-identifier hs-var">fields'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StructType -&gt; TermTypeM ()) -&gt; StructType -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatType -&gt; StructType
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558240"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-310"></span><span>  </span><span id="local-6989586621684558234"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558234"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatType -&gt; TermTypeM PatType
forall a (m :: * -&gt; *). (Substitutable a, MonadUnify m) =&gt; a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Unify.html#normTypeFully"><span class="hs-identifier hs-var">normTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558240"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-311"></span><span>  </span><span class="annot"><span class="annottext">[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; TermTypeM (PatBase Info VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558244"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558243"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">(InferredType -&gt; TermTypeM (PatBase Info VName))
-&gt; InferredType -&gt; TermTypeM (PatBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatType -&gt; InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Ascribed"><span class="hs-identifier hs-var">Ascribed</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558234"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-312"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span id="local-6989586621684558233"><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558233"><span class="hs-identifier hs-var">sizes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RecordPat"><span class="hs-identifier hs-type">RecordPat</span></a></span><span> </span><span id="local-6989586621684558232"><span class="annot"><span class="annottext">[(Name, PatBase NoInfo Name)]
</span><a href="#local-6989586621684558232"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621684558231"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558231"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#NoneInferred"><span class="hs-identifier hs-var">NoneInferred</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-313"></span><span>  </span><span class="annot"><span class="annottext">[(Name, PatBase Info VName)] -&gt; SrcLoc -&gt; PatBase Info VName
forall (f :: * -&gt; *) vn.
[(Name, PatBase f vn)] -&gt; SrcLoc -&gt; PatBase f vn
</span><a href="Language.Futhark.Syntax.html#RecordPat"><span class="hs-identifier hs-var">RecordPat</span></a></span><span> </span><span class="annot"><span class="annottext">([(Name, PatBase Info VName)] -&gt; SrcLoc -&gt; PatBase Info VName)
-&gt; (Map Name (PatBase Info VName) -&gt; [(Name, PatBase Info VName)])
-&gt; Map Name (PatBase Info VName)
-&gt; SrcLoc
-&gt; PatBase Info VName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map Name (PatBase Info VName) -&gt; [(Name, PatBase Info VName)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span>
</span><span id="line-314"></span><span>    </span><span class="annot"><span class="annottext">(Map Name (PatBase Info VName) -&gt; SrcLoc -&gt; PatBase Info VName)
-&gt; TermTypeM (Map Name (PatBase Info VName))
-&gt; TermTypeM (SrcLoc -&gt; PatBase Info VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(PatBase NoInfo Name -&gt; TermTypeM (PatBase Info VName))
-&gt; Map Name (PatBase NoInfo Name)
-&gt; TermTypeM (Map Name (PatBase Info VName))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621684558230"><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558230"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; TermTypeM (PatBase Info VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558233"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558230"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#NoneInferred"><span class="hs-identifier hs-var">NoneInferred</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Name, PatBase NoInfo Name)] -&gt; Map Name (PatBase NoInfo Name)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(Name, PatBase NoInfo Name)]
</span><a href="#local-6989586621684558232"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>    </span><span class="annot"><span class="annottext">TermTypeM (SrcLoc -&gt; PatBase Info VName)
-&gt; TermTypeM SrcLoc -&gt; TermTypeM (PatBase Info VName)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; TermTypeM SrcLoc
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558231"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-316"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span id="local-6989586621684558229"><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558229"><span class="hs-identifier hs-var">sizes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatAscription"><span class="hs-identifier hs-type">PatAscription</span></a></span><span> </span><span id="local-6989586621684558228"><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558228"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeDecl"><span class="hs-identifier hs-type">TypeDecl</span></a></span><span> </span><span id="local-6989586621684558227"><span class="annot"><span class="annottext">TypeExp Name
</span><a href="#local-6989586621684558227"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo StructType
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684558226"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558226"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684558225"><span class="annot"><span class="annottext">InferredType
</span><a href="#local-6989586621684558225"><span class="hs-identifier hs-var">maybe_outer_t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-317"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684558224"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684558224"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684558223"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558223"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeExp Name -&gt; TermTypeM (TypeExp VName, StructType, [VName])
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#checkTypeExpNonrigid"><span class="hs-identifier hs-var">checkTypeExpNonrigid</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp Name
</span><a href="#local-6989586621684558227"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684558221"><span class="annot"><span class="annottext">st' :: PatType
</span><a href="#local-6989586621684558221"><span class="hs-identifier hs-var hs-var">st'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StructType -&gt; PatType
forall dim as. TypeBase dim as -&gt; TypeBase dim Aliasing
</span><a href="Language.Futhark.Prop.html#fromStruct"><span class="hs-identifier hs-var">fromStruct</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558223"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">InferredType
</span><a href="#local-6989586621684558225"><span class="hs-identifier hs-var">maybe_outer_t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-321"></span><span>    </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Ascribed"><span class="hs-identifier hs-type">Ascribed</span></a></span><span> </span><span id="local-6989586621684558219"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558219"><span class="hs-identifier hs-var">outer_t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-322"></span><span>      </span><span id="local-6989586621684558218"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558218"><span class="hs-identifier hs-var">st_forunify</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName] -&gt; StructType -&gt; TermTypeM StructType
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#nonrigidFor"><span class="hs-identifier hs-var">nonrigidFor</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558229"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558223"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-323"></span><span>      </span><span class="annot"><span class="annottext">Usage -&gt; StructType -&gt; StructType -&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage -&gt; StructType -&gt; StructType -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; [Char] -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558226"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;explicit type ascription&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558218"><span class="hs-identifier hs-var">st_forunify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; StructType
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558219"><span class="hs-identifier hs-var">outer_t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span>      </span><span class="hs-comment">-- We also have to make sure that uniqueness matches.  This is</span><span>
</span><span id="line-326"></span><span>      </span><span class="hs-comment">-- done explicitly, because it is ignored by unification.</span><span>
</span><span id="line-327"></span><span>      </span><span id="local-6989586621684558217"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558217"><span class="hs-identifier hs-var">st''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatType -&gt; TermTypeM PatType
forall a (m :: * -&gt; *). (Substitutable a, MonadUnify m) =&gt; a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Unify.html#normTypeFully"><span class="hs-identifier hs-var">normTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558221"><span class="hs-identifier hs-var">st'</span></a></span><span>
</span><span id="line-328"></span><span>      </span><span id="local-6989586621684558216"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558216"><span class="hs-identifier hs-var">outer_t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatType -&gt; TermTypeM PatType
forall a (m :: * -&gt; *). (Substitutable a, MonadUnify m) =&gt; a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Unify.html#normTypeFully"><span class="hs-identifier hs-var">normTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558219"><span class="hs-identifier hs-var">outer_t</span></a></span><span>
</span><span id="line-329"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Uniqueness -&gt; Uniqueness -&gt; Maybe Uniqueness)
-&gt; PatType -&gt; PatType -&gt; Maybe PatType
forall als dim.
(Monoid als, ArrayDim dim) =&gt;
(Uniqueness -&gt; Uniqueness -&gt; Maybe Uniqueness)
-&gt; TypeBase dim als -&gt; TypeBase dim als -&gt; Maybe (TypeBase dim als)
</span><a href="Language.Futhark.TypeChecker.Types.html#unifyTypesU"><span class="hs-identifier hs-var">unifyTypesU</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness -&gt; Uniqueness -&gt; Maybe Uniqueness
</span><a href="#local-6989586621684558214"><span class="hs-identifier hs-var">unifyUniqueness</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558217"><span class="hs-identifier hs-var">st''</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558216"><span class="hs-identifier hs-var">outer_t'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-330"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684558213"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558213"><span class="hs-identifier hs-var">outer_t''</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-331"></span><span>          </span><span class="annot"><span class="annottext">PatBase Info VName
-&gt; TypeDeclBase Info VName -&gt; SrcLoc -&gt; PatBase Info VName
forall (f :: * -&gt; *) vn.
PatBase f vn -&gt; TypeDeclBase f vn -&gt; SrcLoc -&gt; PatBase f vn
</span><a href="Language.Futhark.Syntax.html#PatAscription"><span class="hs-identifier hs-var">PatAscription</span></a></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName
 -&gt; TypeDeclBase Info VName -&gt; SrcLoc -&gt; PatBase Info VName)
-&gt; TermTypeM (PatBase Info VName)
-&gt; TermTypeM
     (TypeDeclBase Info VName -&gt; SrcLoc -&gt; PatBase Info VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; TermTypeM (PatBase Info VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558229"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558228"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Ascribed"><span class="hs-identifier hs-var">Ascribed</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558213"><span class="hs-identifier hs-var">outer_t''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>            </span><span class="annot"><span class="annottext">TermTypeM (TypeDeclBase Info VName -&gt; SrcLoc -&gt; PatBase Info VName)
-&gt; TermTypeM (TypeDeclBase Info VName)
-&gt; TermTypeM (SrcLoc -&gt; PatBase Info VName)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName -&gt; TermTypeM (TypeDeclBase Info VName)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeExp VName -&gt; Info StructType -&gt; TypeDeclBase Info VName
forall (f :: * -&gt; *) vn.
TypeExp vn -&gt; f StructType -&gt; TypeDeclBase f vn
</span><a href="Language.Futhark.Syntax.html#TypeDecl"><span class="hs-identifier hs-var">TypeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684558224"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StructType -&gt; Info StructType
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558223"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>            </span><span class="annot"><span class="annottext">TermTypeM (SrcLoc -&gt; PatBase Info VName)
-&gt; TermTypeM SrcLoc -&gt; TermTypeM (PatBase Info VName)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; TermTypeM SrcLoc
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558226"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-334"></span><span>        </span><span class="annot"><span class="annottext">Maybe PatType
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-335"></span><span>          </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TermTypeM (PatBase Info VName)
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558226"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM (PatBase Info VName))
-&gt; Doc -&gt; TermTypeM (PatBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-336"></span><span>            </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Cannot match type&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558216"><span class="hs-identifier hs-var">outer_t'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;with expected type&quot;</span></span><span>
</span><span id="line-337"></span><span>              </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558217"><span class="hs-identifier hs-var">st''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-338"></span><span>    </span><span class="annot"><span class="annottext">InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#NoneInferred"><span class="hs-identifier hs-var">NoneInferred</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-339"></span><span>      </span><span class="annot"><span class="annottext">PatBase Info VName
-&gt; TypeDeclBase Info VName -&gt; SrcLoc -&gt; PatBase Info VName
forall (f :: * -&gt; *) vn.
PatBase f vn -&gt; TypeDeclBase f vn -&gt; SrcLoc -&gt; PatBase f vn
</span><a href="Language.Futhark.Syntax.html#PatAscription"><span class="hs-identifier hs-var">PatAscription</span></a></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName
 -&gt; TypeDeclBase Info VName -&gt; SrcLoc -&gt; PatBase Info VName)
-&gt; TermTypeM (PatBase Info VName)
-&gt; TermTypeM
     (TypeDeclBase Info VName -&gt; SrcLoc -&gt; PatBase Info VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; TermTypeM (PatBase Info VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558229"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558228"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Ascribed"><span class="hs-identifier hs-var">Ascribed</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558221"><span class="hs-identifier hs-var">st'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>        </span><span class="annot"><span class="annottext">TermTypeM (TypeDeclBase Info VName -&gt; SrcLoc -&gt; PatBase Info VName)
-&gt; TermTypeM (TypeDeclBase Info VName)
-&gt; TermTypeM (SrcLoc -&gt; PatBase Info VName)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName -&gt; TermTypeM (TypeDeclBase Info VName)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeExp VName -&gt; Info StructType -&gt; TypeDeclBase Info VName
forall (f :: * -&gt; *) vn.
TypeExp vn -&gt; f StructType -&gt; TypeDeclBase f vn
</span><a href="Language.Futhark.Syntax.html#TypeDecl"><span class="hs-identifier hs-var">TypeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684558224"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StructType -&gt; Info StructType
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558223"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>        </span><span class="annot"><span class="annottext">TermTypeM (SrcLoc -&gt; PatBase Info VName)
-&gt; TermTypeM SrcLoc -&gt; TermTypeM (PatBase Info VName)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; TermTypeM SrcLoc
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558226"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-342"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-343"></span><span>    </span><span id="local-6989586621684558214"><span class="annot"><span class="annottext">unifyUniqueness :: Uniqueness -&gt; Uniqueness -&gt; Maybe Uniqueness
</span><a href="#local-6989586621684558214"><span class="hs-identifier hs-var hs-var">unifyUniqueness</span></a></span></span><span> </span><span id="local-6989586621684558212"><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684558212"><span class="hs-identifier hs-var">u1</span></a></span></span><span> </span><span id="local-6989586621684558211"><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684558211"><span class="hs-identifier hs-var">u2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684558211"><span class="hs-identifier hs-var">u2</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness -&gt; Uniqueness -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.Types.html#subuniqueOf"><span class="hs-operator hs-var">`subuniqueOf`</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684558212"><span class="hs-identifier hs-var">u1</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Uniqueness -&gt; Maybe Uniqueness
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684558212"><span class="hs-identifier hs-var">u1</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe Uniqueness
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-344"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatLit"><span class="hs-identifier hs-type">PatLit</span></a></span><span> </span><span id="local-6989586621684558208"><span class="annot"><span class="annottext">PatLit
</span><a href="#local-6989586621684558208"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo PatType
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684558207"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558207"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Ascribed"><span class="hs-identifier hs-type">Ascribed</span></a></span><span> </span><span id="local-6989586621684558206"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558206"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-345"></span><span>  </span><span id="local-6989586621684558205"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558205"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatLit -&gt; SrcLoc -&gt; TermTypeM StructType
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#patLitMkType"><span class="hs-identifier hs-var">patLitMkType</span></a></span><span> </span><span class="annot"><span class="annottext">PatLit
</span><a href="#local-6989586621684558208"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558207"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-346"></span><span>  </span><span class="annot"><span class="annottext">Usage -&gt; StructType -&gt; StructType -&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage -&gt; StructType -&gt; StructType -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; [Char] -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558207"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;matching against literal&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558205"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; StructType
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558206"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>  </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; TermTypeM (PatBase Info VName))
-&gt; PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatLit -&gt; Info PatType -&gt; SrcLoc -&gt; PatBase Info VName
forall (f :: * -&gt; *) vn.
PatLit -&gt; f PatType -&gt; SrcLoc -&gt; PatBase f vn
</span><a href="Language.Futhark.Syntax.html#PatLit"><span class="hs-identifier hs-var">PatLit</span></a></span><span> </span><span class="annot"><span class="annottext">PatLit
</span><a href="#local-6989586621684558208"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; Info PatType
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StructType -&gt; PatType
forall dim as. TypeBase dim as -&gt; TypeBase dim Aliasing
</span><a href="Language.Futhark.Prop.html#fromStruct"><span class="hs-identifier hs-var">fromStruct</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558205"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558207"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-348"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatLit"><span class="hs-identifier hs-type">PatLit</span></a></span><span> </span><span id="local-6989586621684558204"><span class="annot"><span class="annottext">PatLit
</span><a href="#local-6989586621684558204"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo PatType
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684558203"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558203"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#NoneInferred"><span class="hs-identifier hs-var">NoneInferred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-349"></span><span>  </span><span id="local-6989586621684558202"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558202"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatLit -&gt; SrcLoc -&gt; TermTypeM StructType
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#patLitMkType"><span class="hs-identifier hs-var">patLitMkType</span></a></span><span> </span><span class="annot"><span class="annottext">PatLit
</span><a href="#local-6989586621684558204"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558203"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-350"></span><span>  </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; TermTypeM (PatBase Info VName))
-&gt; PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatLit -&gt; Info PatType -&gt; SrcLoc -&gt; PatBase Info VName
forall (f :: * -&gt; *) vn.
PatLit -&gt; f PatType -&gt; SrcLoc -&gt; PatBase f vn
</span><a href="Language.Futhark.Syntax.html#PatLit"><span class="hs-identifier hs-var">PatLit</span></a></span><span> </span><span class="annot"><span class="annottext">PatLit
</span><a href="#local-6989586621684558204"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; Info PatType
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StructType -&gt; PatType
forall dim as. TypeBase dim as -&gt; TypeBase dim Aliasing
</span><a href="Language.Futhark.Prop.html#fromStruct"><span class="hs-identifier hs-var">fromStruct</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558202"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558203"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-351"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span id="local-6989586621684558201"><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558201"><span class="hs-identifier hs-var">sizes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatConstr"><span class="hs-identifier hs-type">PatConstr</span></a></span><span> </span><span id="local-6989586621684558199"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558199"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo PatType
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684558198"><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684558198"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621684558197"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558197"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Ascribed"><span class="hs-identifier hs-type">Ascribed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Sum"><span class="hs-identifier hs-type">Sum</span></a></span><span> </span><span id="local-6989586621684558195"><span class="annot"><span class="annottext">Map Name [PatType]
</span><a href="#local-6989586621684558195"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684558194"><span class="annot"><span class="annottext">[PatType]
</span><a href="#local-6989586621684558194"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Map Name [PatType] -&gt; Maybe [PatType]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558199"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name [PatType]
</span><a href="#local-6989586621684558195"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-353"></span><span>    </span><span id="local-6989586621684558193"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684558193"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PatBase NoInfo Name
 -&gt; InferredType -&gt; TermTypeM (PatBase Info VName))
-&gt; [PatBase NoInfo Name]
-&gt; [InferredType]
-&gt; TermTypeM [PatBase Info VName]
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m [c]
</span><span class="hs-identifier hs-var">zipWithM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; TermTypeM (PatBase Info VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558201"><span class="hs-identifier hs-var">sizes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684558198"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">([InferredType] -&gt; TermTypeM [PatBase Info VName])
-&gt; [InferredType] -&gt; TermTypeM [PatBase Info VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PatType -&gt; InferredType) -&gt; [PatType] -&gt; [InferredType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PatType -&gt; InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Ascribed"><span class="hs-identifier hs-var">Ascribed</span></a></span><span> </span><span class="annot"><span class="annottext">[PatType]
</span><a href="#local-6989586621684558194"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-354"></span><span>    </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; TermTypeM (PatBase Info VName))
-&gt; PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; Info PatType
-&gt; [PatBase Info VName]
-&gt; SrcLoc
-&gt; PatBase Info VName
forall (f :: * -&gt; *) vn.
Name -&gt; f PatType -&gt; [PatBase f vn] -&gt; SrcLoc -&gt; PatBase f vn
</span><a href="Language.Futhark.Syntax.html#PatConstr"><span class="hs-identifier hs-var">PatConstr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558199"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; Info PatType
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) Aliasing -&gt; PatType
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name [PatType] -&gt; ScalarTypeBase (DimDecl VName) Aliasing
forall dim as. Map Name [TypeBase dim as] -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Sum"><span class="hs-identifier hs-var">Sum</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name [PatType]
</span><a href="#local-6989586621684558195"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684558193"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558197"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-355"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span id="local-6989586621684558192"><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558192"><span class="hs-identifier hs-var">sizes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatConstr"><span class="hs-identifier hs-type">PatConstr</span></a></span><span> </span><span id="local-6989586621684558191"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558191"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo PatType
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684558190"><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684558190"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621684558189"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558189"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#Ascribed"><span class="hs-identifier hs-type">Ascribed</span></a></span><span> </span><span id="local-6989586621684558188"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558188"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-356"></span><span>  </span><span id="local-6989586621684558187"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558187"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Name -&gt; TermTypeM StructType
forall (m :: * -&gt; *) als dim.
(MonadUnify m, Monoid als) =&gt;
SrcLoc -&gt; Name -&gt; m (TypeBase dim als)
</span><a href="Language.Futhark.TypeChecker.Unify.html#newTypeVar"><span class="hs-identifier hs-var">newTypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558189"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;t&quot;</span></span><span>
</span><span id="line-357"></span><span>  </span><span id="local-6989586621684558186"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684558186"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PatBase NoInfo Name -&gt; TermTypeM (PatBase Info VName))
-&gt; [PatBase NoInfo Name] -&gt; TermTypeM [PatBase Info VName]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621684558185"><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558185"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; TermTypeM (PatBase Info VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558192"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558185"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#NoneInferred"><span class="hs-identifier hs-var">NoneInferred</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684558190"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-358"></span><span>  </span><span class="annot"><span class="annottext">Usage -&gt; Name -&gt; StructType -&gt; [StructType] -&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage -&gt; Name -&gt; StructType -&gt; [StructType] -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#mustHaveConstr"><span class="hs-identifier hs-var">mustHaveConstr</span></a></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684558183"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558191"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558187"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatBase Info VName -&gt; StructType
</span><a href="Language.Futhark.Prop.html#patternStructType"><span class="hs-identifier hs-var">patternStructType</span></a></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; StructType)
-&gt; [PatBase Info VName] -&gt; [StructType]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684558186"><span class="hs-identifier hs-var">ps'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>  </span><span class="annot"><span class="annottext">Usage -&gt; StructType -&gt; StructType -&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage -&gt; StructType -&gt; StructType -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684558183"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558187"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; StructType
forall dim as. TypeBase dim as -&gt; TypeBase dim ()
</span><a href="Language.Futhark.Prop.html#toStruct"><span class="hs-identifier hs-var">toStruct</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558188"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>  </span><span id="local-6989586621684558182"><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558182"><span class="hs-identifier hs-var">t''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatType -&gt; TermTypeM PatType
forall a (m :: * -&gt; *). (Substitutable a, MonadUnify m) =&gt; a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Unify.html#normTypeFully"><span class="hs-identifier hs-var">normTypeFully</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558188"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-361"></span><span>  </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; TermTypeM (PatBase Info VName))
-&gt; PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; Info PatType
-&gt; [PatBase Info VName]
-&gt; SrcLoc
-&gt; PatBase Info VName
forall (f :: * -&gt; *) vn.
Name -&gt; f PatType -&gt; [PatBase f vn] -&gt; SrcLoc -&gt; PatBase f vn
</span><a href="Language.Futhark.Syntax.html#PatConstr"><span class="hs-identifier hs-var">PatConstr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558191"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; Info PatType
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">PatType
</span><a href="#local-6989586621684558182"><span class="hs-identifier hs-var">t''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684558186"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558189"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-362"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-363"></span><span>    </span><span id="local-6989586621684558183"><span class="annot"><span class="annottext">usage :: Usage
</span><a href="#local-6989586621684558183"><span class="hs-identifier hs-var hs-var">usage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; [Char] -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558189"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;matching against constructor&quot;</span></span><span>
</span><span id="line-364"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span id="local-6989586621684558181"><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558181"><span class="hs-identifier hs-var">sizes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatConstr"><span class="hs-identifier hs-type">PatConstr</span></a></span><span> </span><span id="local-6989586621684558180"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558180"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo PatType
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684558179"><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684558179"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621684558178"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558178"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#NoneInferred"><span class="hs-identifier hs-var">NoneInferred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-365"></span><span>  </span><span id="local-6989586621684558177"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684558177"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PatBase NoInfo Name -&gt; TermTypeM (PatBase Info VName))
-&gt; [PatBase NoInfo Name] -&gt; TermTypeM [PatBase Info VName]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621684558176"><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558176"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; TermTypeM (PatBase Info VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558181"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558176"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#NoneInferred"><span class="hs-identifier hs-var">NoneInferred</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684558179"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-366"></span><span>  </span><span id="local-6989586621684558175"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558175"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Name -&gt; TermTypeM StructType
forall (m :: * -&gt; *) als dim.
(MonadUnify m, Monoid als) =&gt;
SrcLoc -&gt; Name -&gt; m (TypeBase dim als)
</span><a href="Language.Futhark.TypeChecker.Unify.html#newTypeVar"><span class="hs-identifier hs-var">newTypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558178"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;t&quot;</span></span><span>
</span><span id="line-367"></span><span>  </span><span class="annot"><span class="annottext">Usage -&gt; Name -&gt; StructType -&gt; [StructType] -&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadUnify m =&gt;
Usage -&gt; Name -&gt; StructType -&gt; [StructType] -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Unify.html#mustHaveConstr"><span class="hs-identifier hs-var">mustHaveConstr</span></a></span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621684558174"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558180"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558175"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatBase Info VName -&gt; StructType
</span><a href="Language.Futhark.Prop.html#patternStructType"><span class="hs-identifier hs-var">patternStructType</span></a></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; StructType)
-&gt; [PatBase Info VName] -&gt; [StructType]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684558177"><span class="hs-identifier hs-var">ps'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>  </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PatBase Info VName -&gt; TermTypeM (PatBase Info VName))
-&gt; PatBase Info VName -&gt; TermTypeM (PatBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; Info PatType
-&gt; [PatBase Info VName]
-&gt; SrcLoc
-&gt; PatBase Info VName
forall (f :: * -&gt; *) vn.
Name -&gt; f PatType -&gt; [PatBase f vn] -&gt; SrcLoc -&gt; PatBase f vn
</span><a href="Language.Futhark.Syntax.html#PatConstr"><span class="hs-identifier hs-var">PatConstr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684558180"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatType -&gt; Info PatType
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">(PatType -&gt; Info PatType) -&gt; PatType -&gt; Info PatType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StructType -&gt; PatType
forall dim as. TypeBase dim as -&gt; TypeBase dim Aliasing
</span><a href="Language.Futhark.Prop.html#fromStruct"><span class="hs-identifier hs-var">fromStruct</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684558175"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684558177"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558178"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-370"></span><span>    </span><span id="local-6989586621684558174"><span class="annot"><span class="annottext">usage :: Usage
</span><a href="#local-6989586621684558174"><span class="hs-identifier hs-var hs-var">usage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; [Char] -&gt; Usage
</span><a href="Language.Futhark.TypeChecker.Unify.html#mkUsage"><span class="hs-identifier hs-var">mkUsage</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684558178"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;matching against constructor&quot;</span></span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#patNameMap"><span class="hs-identifier hs-type">patNameMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#NameMap"><span class="hs-identifier hs-type">NameMap</span></a></span><span>
</span><span id="line-373"></span><span id="patNameMap"><span class="annot"><span class="annottext">patNameMap :: PatBase Info VName -&gt; NameMap
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#patNameMap"><span class="hs-identifier hs-var hs-var">patNameMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[((Namespace, Name), QualName VName)] -&gt; NameMap
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">([((Namespace, Name), QualName VName)] -&gt; NameMap)
-&gt; (PatBase Info VName -&gt; [((Namespace, Name), QualName VName)])
-&gt; PatBase Info VName
-&gt; NameMap
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; ((Namespace, Name), QualName VName))
-&gt; [VName] -&gt; [((Namespace, Name), QualName VName)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; ((Namespace, Name), QualName VName)
</span><a href="#local-6989586621684558172"><span class="hs-identifier hs-var">asTerm</span></a></span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; [((Namespace, Name), QualName VName)])
-&gt; (PatBase Info VName -&gt; [VName])
-&gt; PatBase Info VName
-&gt; [((Namespace, Name), QualName VName)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; [VName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set VName -&gt; [VName])
-&gt; (PatBase Info VName -&gt; Set VName)
-&gt; PatBase Info VName
-&gt; [VName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Set VName
forall (f :: * -&gt; *) vn.
(Functor f, Ord vn) =&gt;
PatBase f vn -&gt; Set vn
</span><a href="Language.Futhark.Prop.html#patNames"><span class="hs-identifier hs-var">patNames</span></a></span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-375"></span><span>    </span><span id="local-6989586621684558172"><span class="annot"><span class="annottext">asTerm :: VName -&gt; ((Namespace, Name), QualName VName)
</span><a href="#local-6989586621684558172"><span class="hs-identifier hs-var hs-var">asTerm</span></a></span></span><span> </span><span id="local-6989586621684558170"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558170"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Name
</span><a href="Language.Futhark.Core.html#baseName"><span class="hs-identifier hs-var">baseName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558170"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684558170"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span id="local-6989586621684558169"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat"><span class="hs-identifier hs-type">checkPat</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Syntax.html#SizeBinder"><span class="hs-identifier hs-type">SizeBinder</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-379"></span><span>  </span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedPat"><span class="hs-identifier hs-type">UncheckedPat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-380"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#InferredType"><span class="hs-identifier hs-type">InferredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684558169"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-382"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684558169"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-383"></span><span id="checkPat"><span class="annot"><span class="annottext">checkPat :: forall a.
[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; (PatBase Info VName -&gt; TermTypeM a)
-&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat"><span class="hs-identifier hs-var hs-var">checkPat</span></a></span></span><span> </span><span id="local-6989586621684558156"><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558156"><span class="hs-identifier hs-var">sizes</span></a></span></span><span> </span><span id="local-6989586621684558155"><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558155"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621684558154"><span class="annot"><span class="annottext">InferredType
</span><a href="#local-6989586621684558154"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621684558153"><span class="annot"><span class="annottext">PatBase Info VName -&gt; TermTypeM a
</span><a href="#local-6989586621684558153"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-384"></span><span>  </span><span class="annot"><span class="annottext">[PatBase NoInfo Name] -&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
[PatBase NoInfo Name] -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Types.html#checkForDuplicateNames"><span class="hs-identifier hs-var">checkForDuplicateNames</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558155"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-385"></span><span>  </span><span id="local-6989586621684558152"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684558152"><span class="hs-identifier hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Checking
-&gt; TermTypeM (PatBase Info VName) -&gt; TermTypeM (PatBase Info VName)
forall a. Checking -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#onFailure"><span class="hs-identifier hs-var">onFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatBase NoInfo Name -&gt; InferredType -&gt; Checking
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#CheckingPat"><span class="hs-identifier hs-var">CheckingPat</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558155"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">InferredType
</span><a href="#local-6989586621684558154"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM (PatBase Info VName) -&gt; TermTypeM (PatBase Info VName))
-&gt; TermTypeM (PatBase Info VName) -&gt; TermTypeM (PatBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; TermTypeM (PatBase Info VName)
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat%27"><span class="hs-identifier hs-var">checkPat'</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558156"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558155"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">InferredType
</span><a href="#local-6989586621684558154"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684558149"><span class="annot"><span class="annottext">explicit :: Set VName
</span><a href="#local-6989586621684558149"><span class="hs-identifier hs-var hs-var">explicit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StructType -&gt; Set VName
</span><a href="Language.Futhark.Prop.html#mustBeExplicitInType"><span class="hs-identifier hs-var">mustBeExplicitInType</span></a></span><span> </span><span class="annot"><span class="annottext">(StructType -&gt; Set VName) -&gt; StructType -&gt; Set VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; StructType
</span><a href="Language.Futhark.Prop.html#patternStructType"><span class="hs-identifier hs-var">patternStructType</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684558152"><span class="hs-identifier hs-var">p'</span></a></span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(SizeBinder VName -&gt; Bool)
-&gt; [SizeBinder VName] -&gt; [SizeBinder VName]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684558149"><span class="hs-identifier hs-var">explicit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Bool)
-&gt; (SizeBinder VName -&gt; VName) -&gt; SizeBinder VName -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SizeBinder VName -&gt; VName
forall vn. SizeBinder vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#sizeName"><span class="hs-identifier hs-var hs-var">sizeName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><a href="#local-6989586621684558156"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-390"></span><span>    </span><span id="local-6989586621684558147"><span class="annot"><span class="annottext">SizeBinder VName
</span><a href="#local-6989586621684558147"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[SizeBinder VName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-391"></span><span>      </span><span class="annot"><span class="annottext">SizeBinder VName -&gt; Notes -&gt; Doc -&gt; TermTypeM a
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SizeBinder VName
</span><a href="#local-6989586621684558147"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TermTypeM a) -&gt; Doc -&gt; TermTypeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-392"></span><span>        </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Cannot bind&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">SizeBinder VName -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">SizeBinder VName
</span><a href="#local-6989586621684558147"><span class="hs-identifier hs-var">size</span></a></span><span>
</span><span id="line-393"></span><span>          </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;as it is never used as the size of a concrete (non-function) value.&quot;</span></span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-395"></span><span>      </span><span class="annot"><span class="annottext">NameMap -&gt; TermTypeM a -&gt; TermTypeM a
forall (m :: * -&gt; *) a. MonadTypeChecker m =&gt; NameMap -&gt; m a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#bindNameMap"><span class="hs-identifier hs-var">bindNameMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatBase Info VName -&gt; NameMap
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#patNameMap"><span class="hs-identifier hs-var">patNameMap</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684558152"><span class="hs-identifier hs-var">p'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM a -&gt; TermTypeM a) -&gt; TermTypeM a -&gt; TermTypeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; TermTypeM a
</span><a href="#local-6989586621684558153"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684558152"><span class="hs-identifier hs-var">p'</span></a></span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span id="local-6989586621684558965"><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingParams"><span class="hs-identifier hs-type">bindingParams</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-398"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedTypeParam"><span class="hs-identifier hs-type">UncheckedTypeParam</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-399"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedPat"><span class="hs-identifier hs-type">UncheckedPat</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-400"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#TypeParam"><span class="hs-identifier hs-type">TypeParam</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684558965"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-401"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.Monad.html#TermTypeM"><span class="hs-identifier hs-type">TermTypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684558965"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-402"></span><span id="bindingParams"><span class="annot"><span class="annottext">bindingParams :: forall a.
[UncheckedTypeParam]
-&gt; [PatBase NoInfo Name]
-&gt; ([TypeParam] -&gt; [PatBase Info VName] -&gt; TermTypeM a)
-&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingParams"><span class="hs-identifier hs-var hs-var">bindingParams</span></a></span></span><span> </span><span id="local-6989586621684558142"><span class="annot"><span class="annottext">[UncheckedTypeParam]
</span><a href="#local-6989586621684558142"><span class="hs-identifier hs-var">tps</span></a></span></span><span> </span><span id="local-6989586621684558141"><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684558141"><span class="hs-identifier hs-var">orig_ps</span></a></span></span><span> </span><span id="local-6989586621684558140"><span class="annot"><span class="annottext">[TypeParam] -&gt; [PatBase Info VName] -&gt; TermTypeM a
</span><a href="#local-6989586621684558140"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-403"></span><span>  </span><span class="annot"><span class="annottext">[PatBase NoInfo Name] -&gt; TermTypeM ()
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
[PatBase NoInfo Name] -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Types.html#checkForDuplicateNames"><span class="hs-identifier hs-var">checkForDuplicateNames</span></a></span><span> </span><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684558141"><span class="hs-identifier hs-var">orig_ps</span></a></span><span>
</span><span id="line-404"></span><span>  </span><span class="annot"><span class="annottext">[UncheckedTypeParam] -&gt; ([TypeParam] -&gt; TermTypeM a) -&gt; TermTypeM a
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
[UncheckedTypeParam] -&gt; ([TypeParam] -&gt; m a) -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Types.html#checkTypeParams"><span class="hs-identifier hs-var">checkTypeParams</span></a></span><span> </span><span class="annot"><span class="annottext">[UncheckedTypeParam]
</span><a href="#local-6989586621684558142"><span class="hs-identifier hs-var">tps</span></a></span><span> </span><span class="annot"><span class="annottext">(([TypeParam] -&gt; TermTypeM a) -&gt; TermTypeM a)
-&gt; ([TypeParam] -&gt; TermTypeM a) -&gt; TermTypeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684558138"><span class="annot"><span class="annottext">[TypeParam]
</span><a href="#local-6989586621684558138"><span class="hs-identifier hs-var">tps'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TypeParam] -&gt; TermTypeM a -&gt; TermTypeM a
forall a. [TypeParam] -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#bindingTypeParams"><span class="hs-identifier hs-var">bindingTypeParams</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParam]
</span><a href="#local-6989586621684558138"><span class="hs-identifier hs-var">tps'</span></a></span><span> </span><span class="annot"><span class="annottext">(TermTypeM a -&gt; TermTypeM a) -&gt; TermTypeM a -&gt; TermTypeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684558132"><span class="annot"><span class="annottext">descend :: [PatBase Info VName] -&gt; [PatBase NoInfo Name] -&gt; TermTypeM a
</span><a href="#local-6989586621684558132"><span class="hs-identifier hs-var hs-var">descend</span></a></span></span><span> </span><span id="local-6989586621684558131"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684558131"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684558130"><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558130"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684558129"><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684558129"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-406"></span><span>          </span><span class="annot"><span class="annottext">[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; (PatBase Info VName -&gt; TermTypeM a)
-&gt; TermTypeM a
forall a.
[SizeBinder VName]
-&gt; PatBase NoInfo Name
-&gt; InferredType
-&gt; (PatBase Info VName -&gt; TermTypeM a)
-&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#checkPat"><span class="hs-identifier hs-var">checkPat</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">PatBase NoInfo Name
</span><a href="#local-6989586621684558130"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">InferredType
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#NoneInferred"><span class="hs-identifier hs-var">NoneInferred</span></a></span><span> </span><span class="annot"><span class="annottext">((PatBase Info VName -&gt; TermTypeM a) -&gt; TermTypeM a)
-&gt; (PatBase Info VName -&gt; TermTypeM a) -&gt; TermTypeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684558128"><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684558128"><span class="hs-identifier hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-407"></span><span>            </span><span class="annot"><span class="annottext">[Ident] -&gt; TermTypeM a -&gt; TermTypeM a
forall a. [Ident] -&gt; TermTypeM a -&gt; TermTypeM a
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#binding"><span class="hs-identifier hs-var">binding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Ident -&gt; [Ident]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set Ident -&gt; [Ident]) -&gt; Set Ident -&gt; [Ident]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; Set Ident
forall (f :: * -&gt; *) vn.
(Functor f, Ord vn) =&gt;
PatBase f vn -&gt; Set (IdentBase f vn)
</span><a href="Language.Futhark.Prop.html#patIdents"><span class="hs-identifier hs-var">patIdents</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684558128"><span class="hs-identifier hs-var">p'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermTypeM a -&gt; TermTypeM a) -&gt; TermTypeM a -&gt; TermTypeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName] -&gt; [PatBase NoInfo Name] -&gt; TermTypeM a
</span><a href="#local-6989586621684558132"><span class="hs-identifier hs-var">descend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatBase Info VName
</span><a href="#local-6989586621684558128"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase Info VName -&gt; [PatBase Info VName] -&gt; [PatBase Info VName]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684558131"><span class="hs-identifier hs-var">ps'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684558129"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-408"></span><span>        </span><span class="annot"><a href="#local-6989586621684558132"><span class="hs-identifier hs-var">descend</span></a></span><span> </span><span id="local-6989586621684558127"><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684558127"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-409"></span><span>          </span><span class="hs-comment">-- Perform an observation of every type parameter.  This</span><span>
</span><span id="line-410"></span><span>          </span><span class="hs-comment">-- prevents unused-name warnings for otherwise unused</span><span>
</span><span id="line-411"></span><span>          </span><span class="hs-comment">-- dimensions.</span><span>
</span><span id="line-412"></span><span>          </span><span class="annot"><span class="annottext">(Ident -&gt; TermTypeM ()) -&gt; [Ident] -&gt; TermTypeM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; TermTypeM ()
</span><a href="Language.Futhark.TypeChecker.Terms.Monad.html#observe"><span class="hs-identifier hs-var">observe</span></a></span><span> </span><span class="annot"><span class="annottext">([Ident] -&gt; TermTypeM ()) -&gt; [Ident] -&gt; TermTypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TypeParam -&gt; Maybe Ident) -&gt; [TypeParam] -&gt; [Ident]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">TypeParam -&gt; Maybe Ident
</span><a href="Language.Futhark.TypeChecker.Terms.Pat.html#typeParamIdent"><span class="hs-identifier hs-var">typeParamIdent</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParam]
</span><a href="#local-6989586621684558138"><span class="hs-identifier hs-var">tps'</span></a></span><span>
</span><span id="line-413"></span><span>          </span><span class="annot"><span class="annottext">[TypeParam] -&gt; [PatBase Info VName] -&gt; TermTypeM a
</span><a href="#local-6989586621684558140"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParam]
</span><a href="#local-6989586621684558138"><span class="hs-identifier hs-var">tps'</span></a></span><span> </span><span class="annot"><span class="annottext">([PatBase Info VName] -&gt; TermTypeM a)
-&gt; [PatBase Info VName] -&gt; TermTypeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName] -&gt; [PatBase Info VName]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[PatBase Info VName]
</span><a href="#local-6989586621684558127"><span class="hs-identifier hs-var">ps'</span></a></span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span>    </span><span class="annot"><span class="annottext">[PatBase Info VName] -&gt; [PatBase NoInfo Name] -&gt; TermTypeM a
</span><a href="#local-6989586621684558132"><span class="hs-identifier hs-var">descend</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684558141"><span class="hs-identifier hs-var">orig_ps</span></a></span><span>
</span><span id="line-416"></span></pre></body></html>