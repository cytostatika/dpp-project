<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">-- | Various boilerplate definitions for the PyOpenCL backend.</span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Futhark.CodeGen.Backends.PyOpenCL.Boilerplate</span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.PyOpenCL.Boilerplate.html#openClInit"><span class="hs-identifier">openClInit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">where</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Identity</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html"><span class="hs-identifier">Futhark.CodeGen.Backends.GenericPython</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Py</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html"><span class="hs-identifier">Futhark.CodeGen.Backends.GenericPython.AST</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.OpenCL.html"><span class="hs-identifier">Futhark.CodeGen.ImpCode.OpenCL</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ErrorMsg"><span class="hs-identifier">ErrorMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ErrorMsgPart"><span class="hs-identifier">ErrorMsgPart</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.OpenCL.html#FailureMsg"><span class="hs-identifier">FailureMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier">PrimType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Futhark.IR.GPU.Sizes.html#SizeClass"><span class="hs-identifier">SizeClass</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#errorMsgArgTypes"><span class="hs-identifier">errorMsgArgTypes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Futhark.IR.GPU.Sizes.html#sizeDefault"><span class="hs-identifier">sizeDefault</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.PrimExp.html#untyped"><span class="hs-identifier">untyped</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.CodeGen.OpenCL.Heuristics.html"><span class="hs-identifier">Futhark.CodeGen.OpenCL.Heuristics</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Util.Pretty.html"><span class="hs-identifier">Futhark.Util.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier">pretty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Util.Pretty.html#prettyText"><span class="hs-identifier">prettyText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">NeatInterpolation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">text</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span id="local-6989586621684570286"><span class="annot"><a href="Futhark.CodeGen.Backends.PyOpenCL.Boilerplate.html#errorMsgNumArgs"><span class="hs-identifier hs-type">errorMsgNumArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ErrorMsg"><span class="hs-identifier hs-type">ErrorMsg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684570286"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-31"></span><span id="errorMsgNumArgs"><span class="annot"><span class="annottext">errorMsgNumArgs :: forall a. ErrorMsg a -&gt; Int
</span><a href="Futhark.CodeGen.Backends.PyOpenCL.Boilerplate.html#errorMsgNumArgs"><span class="hs-identifier hs-var hs-var">errorMsgNumArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PrimType] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([PrimType] -&gt; Int)
-&gt; (ErrorMsg a -&gt; [PrimType]) -&gt; ErrorMsg a -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsg a -&gt; [PrimType]
forall a. ErrorMsg a -&gt; [PrimType]
</span><a href="Futhark.IR.Syntax.Core.html#errorMsgArgTypes"><span class="hs-identifier hs-var">errorMsgArgTypes</span></a></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-comment">-- | Python code (as a string) that calls the</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- @initiatialize_opencl_object@ procedure.  Should be put in the</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- class constructor.</span><span>
</span><span id="line-36"></span><span class="annot"><a href="Futhark.CodeGen.Backends.PyOpenCL.Boilerplate.html#openClInit"><span class="hs-identifier hs-type">openClInit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPU.Sizes.html#SizeClass"><span class="hs-identifier hs-type">SizeClass</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.OpenCL.html#FailureMsg"><span class="hs-identifier hs-type">FailureMsg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-37"></span><span id="openClInit"><span class="annot"><span class="annottext">openClInit :: [PrimType] -&gt; [Char] -&gt; Map Name SizeClass -&gt; [FailureMsg] -&gt; Text
</span><a href="Futhark.CodeGen.Backends.PyOpenCL.Boilerplate.html#openClInit"><span class="hs-identifier hs-var hs-var">openClInit</span></a></span></span><span> </span><span id="local-6989586621684570211"><span class="annot"><span class="annottext">[PrimType]
</span><a href="#local-6989586621684570211"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span id="local-6989586621684570210"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684570210"><span class="hs-identifier hs-var">assign</span></a></span></span><span> </span><span id="local-6989586621684570209"><span class="annot"><span class="annottext">Map Name SizeClass
</span><a href="#local-6989586621684570209"><span class="hs-identifier hs-var">sizes</span></a></span></span><span> </span><span id="local-6989586621684570208"><span class="annot"><span class="annottext">[FailureMsg]
</span><a href="#local-6989586621684570208"><span class="hs-identifier hs-var">failures</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><span class="">[text|
size_heuristics=$size_heuristics
self.global_failure_args_max = $max_num_args
self.failure_msgs=$failure_msgs
program = initialise_opencl_object(self,
                                   program_src=fut_opencl_src,
                                   command_queue=command_queue,
                                   interactive=interactive,
                                   platform_pref=platform_pref,
                                   device_pref=device_pref,
                                   default_group_size=default_group_size,
                                   default_num_groups=default_num_groups,
                                   default_tile_size=default_tile_size,
                                   default_reg_tile_size=default_reg_tile_size,
                                   default_threshold=default_threshold,
                                   size_heuristics=size_heuristics,
                                   required_types=$types',
                                   user_sizes=sizes,
                                   all_sizes=$sizes')
$assign'
|]</span></span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-60"></span><span>    </span><span id="local-6989586621684570207"><span class="annot"><span class="annottext">assign' :: Text
</span><a href="#local-6989586621684570207"><span class="hs-identifier hs-var hs-var">assign'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684570210"><span class="hs-identifier hs-var">assign</span></a></span><span>
</span><span id="line-61"></span><span>    </span><span id="local-6989586621684570206"><span class="annot"><span class="annottext">size_heuristics :: Text
</span><a href="#local-6989586621684570206"><span class="hs-identifier hs-var hs-var">size_heuristics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; Text
forall a. Pretty a =&gt; a -&gt; Text
</span><a href="Futhark.Util.Pretty.html#prettyText"><span class="hs-identifier hs-var">prettyText</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; Text) -&gt; PyExp -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SizeHeuristic] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.PyOpenCL.Boilerplate.html#sizeHeuristicsToPython"><span class="hs-identifier hs-var">sizeHeuristicsToPython</span></a></span><span> </span><span class="annot"><span class="annottext">[SizeHeuristic]
</span><a href="Futhark.CodeGen.OpenCL.Heuristics.html#sizeHeuristicsTable"><span class="hs-identifier hs-var">sizeHeuristicsTable</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span id="local-6989586621684570205"><span class="annot"><span class="annottext">types' :: Text
</span><a href="#local-6989586621684570205"><span class="hs-identifier hs-var hs-var">types'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; Text
forall a. Pretty a =&gt; a -&gt; Text
</span><a href="Futhark.Util.Pretty.html#prettyText"><span class="hs-identifier hs-var">prettyText</span></a></span><span> </span><span class="annot"><span class="annottext">([[Char]] -&gt; Text) -&gt; [[Char]] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PrimType -&gt; [Char]) -&gt; [PrimType] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; [Char]) -&gt; (PrimType -&gt; [Char]) -&gt; PrimType -&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PrimType]
</span><a href="#local-6989586621684570211"><span class="hs-identifier hs-var">types</span></a></span><span> </span><span class="hs-comment">-- Looks enough like Python.</span><span>
</span><span id="line-63"></span><span>    </span><span id="local-6989586621684570204"><span class="annot"><span class="annottext">sizes' :: Text
</span><a href="#local-6989586621684570204"><span class="hs-identifier hs-var hs-var">sizes'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; Text
forall a. Pretty a =&gt; a -&gt; Text
</span><a href="Futhark.Util.Pretty.html#prettyText"><span class="hs-identifier hs-var">prettyText</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; Text) -&gt; PyExp -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Name SizeClass -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.PyOpenCL.Boilerplate.html#sizeClassesToPython"><span class="hs-identifier hs-var">sizeClassesToPython</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name SizeClass
</span><a href="#local-6989586621684570209"><span class="hs-identifier hs-var">sizes</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span id="local-6989586621684570203"><span class="annot"><span class="annottext">max_num_args :: Text
</span><a href="#local-6989586621684570203"><span class="hs-identifier hs-var hs-var">max_num_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall a. Pretty a =&gt; a -&gt; Text
</span><a href="Futhark.Util.Pretty.html#prettyText"><span class="hs-identifier hs-var">prettyText</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Text) -&gt; Int -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int) -&gt; Int -&gt; [Int] -&gt; Int
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Int) -&gt; [Int] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(FailureMsg -&gt; Int) -&gt; [FailureMsg] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorMsg Exp -&gt; Int
forall a. ErrorMsg a -&gt; Int
</span><a href="Futhark.CodeGen.Backends.PyOpenCL.Boilerplate.html#errorMsgNumArgs"><span class="hs-identifier hs-var">errorMsgNumArgs</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMsg Exp -&gt; Int)
-&gt; (FailureMsg -&gt; ErrorMsg Exp) -&gt; FailureMsg -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FailureMsg -&gt; ErrorMsg Exp
</span><a href="Futhark.CodeGen.ImpCode.OpenCL.html#failureError"><span class="hs-identifier hs-var hs-var">failureError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FailureMsg]
</span><a href="#local-6989586621684570208"><span class="hs-identifier hs-var">failures</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span id="local-6989586621684570202"><span class="annot"><span class="annottext">failure_msgs :: Text
</span><a href="#local-6989586621684570202"><span class="hs-identifier hs-var hs-var">failure_msgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; Text
forall a. Pretty a =&gt; a -&gt; Text
</span><a href="Futhark.Util.Pretty.html#prettyText"><span class="hs-identifier hs-var">prettyText</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; Text) -&gt; PyExp -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#List"><span class="hs-identifier hs-var">List</span></a></span><span> </span><span class="annot"><span class="annottext">([PyExp] -&gt; PyExp) -&gt; [PyExp] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(FailureMsg -&gt; PyExp) -&gt; [FailureMsg] -&gt; [PyExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FailureMsg -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.PyOpenCL.Boilerplate.html#formatFailure"><span class="hs-identifier hs-var">formatFailure</span></a></span><span> </span><span class="annot"><span class="annottext">[FailureMsg]
</span><a href="#local-6989586621684570208"><span class="hs-identifier hs-var">failures</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="annot"><a href="Futhark.CodeGen.Backends.PyOpenCL.Boilerplate.html#formatFailure"><span class="hs-identifier hs-type">formatFailure</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.OpenCL.html#FailureMsg"><span class="hs-identifier hs-type">FailureMsg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span>
</span><span id="line-68"></span><span id="formatFailure"><span class="annot"><span class="annottext">formatFailure :: FailureMsg -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.PyOpenCL.Boilerplate.html#formatFailure"><span class="hs-identifier hs-var hs-var">formatFailure</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.OpenCL.html#FailureMsg"><span class="hs-identifier hs-type">FailureMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ErrorMsg"><span class="hs-identifier hs-type">ErrorMsg</span></a></span><span> </span><span id="local-6989586621684570163"><span class="annot"><span class="annottext">[ErrorMsgPart Exp]
</span><a href="#local-6989586621684570163"><span class="hs-identifier hs-var">parts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684570162"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684570162"><span class="hs-identifier hs-var">backtrace</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [Char] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ErrorMsgPart Exp -&gt; [Char]) -&gt; [ErrorMsgPart Exp] -&gt; [Char]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsgPart Exp -&gt; [Char]
forall {a}. ErrorMsgPart a -&gt; [Char]
</span><a href="#local-6989586621684570159"><span class="hs-identifier hs-var">onPart</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrorMsgPart Exp]
</span><a href="#local-6989586621684570163"><span class="hs-identifier hs-var">parts</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="#local-6989586621684570158"><span class="hs-identifier hs-var">formatEscape</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684570162"><span class="hs-identifier hs-var">backtrace</span></a></span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-71"></span><span>    </span><span id="local-6989586621684570158"><span class="annot"><span class="annottext">formatEscape :: [Char] -&gt; [Char]
</span><a href="#local-6989586621684570158"><span class="hs-identifier hs-var hs-var">formatEscape</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-72"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684570153"><span class="annot"><span class="annottext">escapeChar :: Char -&gt; [Char]
</span><a href="#local-6989586621684570153"><span class="hs-identifier hs-var hs-var">escapeChar</span></a></span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'{'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;{{&quot;</span></span><span>
</span><span id="line-73"></span><span>          </span><span class="annot"><a href="#local-6989586621684570153"><span class="hs-identifier hs-var">escapeChar</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'}'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;}}&quot;</span></span><span>
</span><span id="line-74"></span><span>          </span><span class="annot"><a href="#local-6989586621684570153"><span class="hs-identifier hs-var">escapeChar</span></a></span><span> </span><span id="local-6989586621684570152"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621684570152"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621684570152"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-75"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; [Char]) -&gt; [Char] -&gt; [Char]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; [Char]
</span><a href="#local-6989586621684570153"><span class="hs-identifier hs-var">escapeChar</span></a></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span>    </span><span id="local-6989586621684570159"><span class="annot"><span class="annottext">onPart :: ErrorMsgPart a -&gt; [Char]
</span><a href="#local-6989586621684570159"><span class="hs-identifier hs-var hs-var">onPart</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ErrorString"><span class="hs-identifier hs-type">ErrorString</span></a></span><span> </span><span id="local-6989586621684570150"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684570150"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="#local-6989586621684570158"><span class="hs-identifier hs-var">formatEscape</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684570150"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><a href="#local-6989586621684570159"><span class="hs-identifier hs-var">onPart</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ErrorVal"><span class="hs-identifier hs-type">ErrorVal</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;{}&quot;</span></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="annot"><a href="Futhark.CodeGen.Backends.PyOpenCL.Boilerplate.html#sizeClassesToPython"><span class="hs-identifier hs-type">sizeClassesToPython</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPU.Sizes.html#SizeClass"><span class="hs-identifier hs-type">SizeClass</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span>
</span><span id="line-81"></span><span id="sizeClassesToPython"><span class="annot"><span class="annottext">sizeClassesToPython :: Map Name SizeClass -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.PyOpenCL.Boilerplate.html#sizeClassesToPython"><span class="hs-identifier hs-var hs-var">sizeClassesToPython</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(PyExp, PyExp)] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Dict"><span class="hs-identifier hs-var">Dict</span></a></span><span> </span><span class="annot"><span class="annottext">([(PyExp, PyExp)] -&gt; PyExp)
-&gt; (Map Name SizeClass -&gt; [(PyExp, PyExp)])
-&gt; Map Name SizeClass
-&gt; PyExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Name, SizeClass) -&gt; (PyExp, PyExp))
-&gt; [(Name, SizeClass)] -&gt; [(PyExp, PyExp)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Name, SizeClass) -&gt; (PyExp, PyExp)
forall {a}. Pretty a =&gt; (a, SizeClass) -&gt; (PyExp, PyExp)
</span><a href="#local-6989586621684570147"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">([(Name, SizeClass)] -&gt; [(PyExp, PyExp)])
-&gt; (Map Name SizeClass -&gt; [(Name, SizeClass)])
-&gt; Map Name SizeClass
-&gt; [(PyExp, PyExp)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map Name SizeClass -&gt; [(Name, SizeClass)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-83"></span><span>    </span><span id="local-6989586621684570147"><span class="annot"><span class="annottext">f :: (a, SizeClass) -&gt; (PyExp, PyExp)
</span><a href="#local-6989586621684570147"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684570137"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684570137"><span class="hs-identifier hs-var">size_name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684570136"><span class="annot"><span class="annottext">SizeClass
</span><a href="#local-6989586621684570136"><span class="hs-identifier hs-var">size_class</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-84"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [Char] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684570137"><span class="hs-identifier hs-var">size_name</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>        </span><span class="annot"><span class="annottext">[(PyExp, PyExp)] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Dict"><span class="hs-identifier hs-var">Dict</span></a></span><span>
</span><span id="line-86"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;class&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [Char] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SizeClass -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">SizeClass
</span><a href="#local-6989586621684570136"><span class="hs-identifier hs-var">size_class</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;value&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>              </span><span class="annot"><span class="annottext">PyExp -&gt; (Int64 -&gt; PyExp) -&gt; Maybe Int64 -&gt; PyExp
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#None"><span class="hs-identifier hs-var">None</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; PyExp) -&gt; (Int64 -&gt; Integer) -&gt; Int64 -&gt; PyExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Int64 -&gt; PyExp) -&gt; Maybe Int64 -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-89"></span><span>                </span><span class="annot"><span class="annottext">SizeClass -&gt; Maybe Int64
</span><a href="Futhark.IR.GPU.Sizes.html#sizeDefault"><span class="hs-identifier hs-var">sizeDefault</span></a></span><span> </span><span class="annot"><span class="annottext">SizeClass
</span><a href="#local-6989586621684570136"><span class="hs-identifier hs-var">size_class</span></a></span><span>
</span><span id="line-90"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-92"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="annot"><a href="Futhark.CodeGen.Backends.PyOpenCL.Boilerplate.html#sizeHeuristicsToPython"><span class="hs-identifier hs-type">sizeHeuristicsToPython</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.OpenCL.Heuristics.html#SizeHeuristic"><span class="hs-identifier hs-type">SizeHeuristic</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span>
</span><span id="line-95"></span><span id="sizeHeuristicsToPython"><span class="annot"><span class="annottext">sizeHeuristicsToPython :: [SizeHeuristic] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.PyOpenCL.Boilerplate.html#sizeHeuristicsToPython"><span class="hs-identifier hs-var hs-var">sizeHeuristicsToPython</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#List"><span class="hs-identifier hs-var">List</span></a></span><span> </span><span class="annot"><span class="annottext">([PyExp] -&gt; PyExp)
-&gt; ([SizeHeuristic] -&gt; [PyExp]) -&gt; [SizeHeuristic] -&gt; PyExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(SizeHeuristic -&gt; PyExp) -&gt; [SizeHeuristic] -&gt; [PyExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">SizeHeuristic -&gt; PyExp
</span><a href="#local-6989586621684570132"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-97"></span><span>    </span><span id="local-6989586621684570132"><span class="annot"><span class="annottext">f :: SizeHeuristic -&gt; PyExp
</span><a href="#local-6989586621684570132"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.OpenCL.Heuristics.html#SizeHeuristic"><span class="hs-identifier hs-type">SizeHeuristic</span></a></span><span> </span><span id="local-6989586621684570130"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684570130"><span class="hs-identifier hs-var">platform_name</span></a></span></span><span> </span><span id="local-6989586621684570129"><span class="annot"><span class="annottext">DeviceType
</span><a href="#local-6989586621684570129"><span class="hs-identifier hs-var">device_type</span></a></span></span><span> </span><span id="local-6989586621684570128"><span class="annot"><span class="annottext">WhichSize
</span><a href="#local-6989586621684570128"><span class="hs-identifier hs-var">which</span></a></span></span><span> </span><span id="local-6989586621684570127"><span class="annot"><span class="annottext">TPrimExp Int32 DeviceInfo
</span><a href="#local-6989586621684570127"><span class="hs-identifier hs-var">what</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-98"></span><span>      </span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Tuple"><span class="hs-identifier hs-var">Tuple</span></a></span><span>
</span><span id="line-99"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684570130"><span class="hs-identifier hs-var">platform_name</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>          </span><span class="annot"><span class="annottext">DeviceType -&gt; PyExp
</span><a href="#local-6989586621684570125"><span class="hs-identifier hs-var">clDeviceType</span></a></span><span> </span><span class="annot"><span class="annottext">DeviceType
</span><a href="#local-6989586621684570129"><span class="hs-identifier hs-var">device_type</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>          </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684570124"><span class="hs-identifier hs-var">which'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>          </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684570123"><span class="hs-identifier hs-var">what'</span></a></span><span>
</span><span id="line-103"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-104"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-105"></span><span>        </span><span id="local-6989586621684570125"><span class="annot"><span class="annottext">clDeviceType :: DeviceType -&gt; PyExp
</span><a href="#local-6989586621684570125"><span class="hs-identifier hs-var hs-var">clDeviceType</span></a></span></span><span> </span><span class="annot"><span class="annottext">DeviceType
</span><a href="Futhark.CodeGen.OpenCL.Heuristics.html#DeviceGPU"><span class="hs-identifier hs-var">DeviceGPU</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cl.device_type.GPU&quot;</span></span><span>
</span><span id="line-106"></span><span>        </span><span class="annot"><a href="#local-6989586621684570125"><span class="hs-identifier hs-var">clDeviceType</span></a></span><span> </span><span class="annot"><span class="annottext">DeviceType
</span><a href="Futhark.CodeGen.OpenCL.Heuristics.html#DeviceCPU"><span class="hs-identifier hs-var">DeviceCPU</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cl.device_type.CPU&quot;</span></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span>        </span><span id="local-6989586621684570124"><span class="annot"><span class="annottext">which' :: PyExp
</span><a href="#local-6989586621684570124"><span class="hs-identifier hs-var hs-var">which'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WhichSize
</span><a href="#local-6989586621684570128"><span class="hs-identifier hs-var">which</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-109"></span><span>          </span><span class="annot"><span class="annottext">WhichSize
</span><a href="Futhark.CodeGen.OpenCL.Heuristics.html#LockstepWidth"><span class="hs-identifier hs-var">LockstepWidth</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lockstep_width&quot;</span></span><span>
</span><span id="line-110"></span><span>          </span><span class="annot"><span class="annottext">WhichSize
</span><a href="Futhark.CodeGen.OpenCL.Heuristics.html#NumGroups"><span class="hs-identifier hs-var">NumGroups</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;num_groups&quot;</span></span><span>
</span><span id="line-111"></span><span>          </span><span class="annot"><span class="annottext">WhichSize
</span><a href="Futhark.CodeGen.OpenCL.Heuristics.html#GroupSize"><span class="hs-identifier hs-var">GroupSize</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;group_size&quot;</span></span><span>
</span><span id="line-112"></span><span>          </span><span class="annot"><span class="annottext">WhichSize
</span><a href="Futhark.CodeGen.OpenCL.Heuristics.html#TileSize"><span class="hs-identifier hs-var">TileSize</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tile_size&quot;</span></span><span>
</span><span id="line-113"></span><span>          </span><span class="annot"><span class="annottext">WhichSize
</span><a href="Futhark.CodeGen.OpenCL.Heuristics.html#RegTileSize"><span class="hs-identifier hs-var">RegTileSize</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;reg_tile_size&quot;</span></span><span>
</span><span id="line-114"></span><span>          </span><span class="annot"><span class="annottext">WhichSize
</span><a href="Futhark.CodeGen.OpenCL.Heuristics.html#Threshold"><span class="hs-identifier hs-var">Threshold</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;threshold&quot;</span></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span>        </span><span id="local-6989586621684570123"><span class="annot"><span class="annottext">what' :: PyExp
</span><a href="#local-6989586621684570123"><span class="hs-identifier hs-var hs-var">what'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-117"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Lambda"><span class="hs-identifier hs-var">Lambda</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;device&quot;</span></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyExp) -&gt; PyExp -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-118"></span><span>            </span><span class="annot"><span class="annottext">Identity PyExp -&gt; PyExp
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity PyExp -&gt; PyExp) -&gt; Identity PyExp -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-119"></span><span>              </span><span class="annot"><span class="annottext">(DeviceInfo -&gt; Identity PyExp)
-&gt; PrimExp DeviceInfo -&gt; Identity PyExp
forall (m :: * -&gt; *) v.
Monad m =&gt;
(v -&gt; m PyExp) -&gt; PrimExp v -&gt; m PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimExp"><span class="hs-identifier hs-var">Py.compilePrimExp</span></a></span><span> </span><span class="annot"><span class="annottext">DeviceInfo -&gt; Identity PyExp
forall {f :: * -&gt; *}. Applicative f =&gt; DeviceInfo -&gt; f PyExp
</span><a href="#local-6989586621684570106"><span class="hs-identifier hs-var">onLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimExp DeviceInfo -&gt; Identity PyExp)
-&gt; PrimExp DeviceInfo -&gt; Identity PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TPrimExp Int32 DeviceInfo -&gt; PrimExp DeviceInfo
forall t v. TPrimExp t v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#untyped"><span class="hs-identifier hs-var hs-var">untyped</span></a></span><span> </span><span class="annot"><span class="annottext">TPrimExp Int32 DeviceInfo
</span><a href="#local-6989586621684570127"><span class="hs-identifier hs-var">what</span></a></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span>        </span><span id="local-6989586621684570106"><span class="annot"><span class="annottext">onLeaf :: DeviceInfo -&gt; f PyExp
</span><a href="#local-6989586621684570106"><span class="hs-identifier hs-var hs-var">onLeaf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.OpenCL.Heuristics.html#DeviceInfo"><span class="hs-identifier hs-type">DeviceInfo</span></a></span><span> </span><span id="local-6989586621684570102"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684570102"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-122"></span><span>          </span><span class="annot"><span class="annottext">PyExp -&gt; f PyExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; f PyExp) -&gt; PyExp -&gt; f PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-123"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">Py.simpleCall</span></a></span><span>
</span><span id="line-124"></span><span>              </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;device.get_info&quot;</span></span><span>
</span><span id="line-125"></span><span>              </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">Py.simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;getattr&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cl.device_info&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684570102"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-126"></span></pre></body></html>