<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE Trustworthy #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-comment">-- | Code generation for standalone executables.</span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Futhark.CodeGen.Backends.GenericC.CLI</span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#cliDefs"><span class="hs-identifier">cliDefs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">where</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unzip5</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericC.Options.html"><span class="hs-identifier">Futhark.CodeGen.Backends.GenericC.Options</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html"><span class="hs-identifier">Futhark.CodeGen.Backends.SimpleRep</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#cproduct"><span class="hs-identifier">cproduct</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#primAPIType"><span class="hs-identifier">primAPIType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#primStorageType"><span class="hs-identifier">primStorageType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#scalarToPrim"><span class="hs-identifier">scalarToPrim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.CodeGen.RTS.C.html"><span class="hs-identifier">Futhark.CodeGen.RTS.C</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.RTS.C.html#tuningH"><span class="hs-identifier">tuningH</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.RTS.C.html#valuesH"><span class="hs-identifier">valuesH</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Futhark.Manifest</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Util.Pretty.html"><span class="hs-identifier">Futhark.Util.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier">pretty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Util.Pretty.html#prettyText"><span class="hs-identifier">prettyText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Language.C.Quote.OpenCL</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Language.C.Syntax</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#genericOptions"><span class="hs-identifier hs-type">genericOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericC.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-32"></span><span id="genericOptions"><span class="annot"><span class="annottext">genericOptions :: [Option]
</span><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#genericOptions"><span class="hs-identifier hs-var hs-var">genericOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Option :: String -&gt; Maybe Char -&gt; OptionArgument -&gt; String -&gt; Stm -&gt; Option
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span>
</span><span id="line-34"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">optionLongName :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionLongName"><span class="hs-identifier hs-var">optionLongName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;write-runtime-to&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>        </span><span class="annot"><span class="annottext">optionShortName :: Maybe Char
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionShortName"><span class="hs-identifier hs-var">optionShortName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Maybe Char
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'t'</span></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>        </span><span class="annot"><span class="annottext">optionArgument :: OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionArgument"><span class="hs-identifier hs-var">optionArgument</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#RequiredArgument"><span class="hs-identifier hs-var">RequiredArgument</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;FILE&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>        </span><span class="annot"><span class="annottext">optionDescription :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionDescription"><span class="hs-identifier hs-var">optionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Print the time taken to execute the program to the indicated file, an integral number of microseconds.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>        </span><span class="annot"><span class="annottext">optionAction :: Stm
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionAction"><span class="hs-identifier hs-var">optionAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stm
</span><a href="#local-6989586621684475527"><span class="hs-identifier hs-var">set_runtime_file</span></a></span><span>
</span><span id="line-39"></span><span>      </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><span class="annottext">Option :: String -&gt; Maybe Char -&gt; OptionArgument -&gt; String -&gt; Stm -&gt; Option
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span>
</span><span id="line-41"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">optionLongName :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionLongName"><span class="hs-identifier hs-var">optionLongName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runs&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>        </span><span class="annot"><span class="annottext">optionShortName :: Maybe Char
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionShortName"><span class="hs-identifier hs-var">optionShortName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Maybe Char
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'r'</span></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>        </span><span class="annot"><span class="annottext">optionArgument :: OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionArgument"><span class="hs-identifier hs-var">optionArgument</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#RequiredArgument"><span class="hs-identifier hs-var">RequiredArgument</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;INT&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><span class="annottext">optionDescription :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionDescription"><span class="hs-identifier hs-var">optionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Perform NUM runs of the program.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>        </span><span class="annot"><span class="annottext">optionAction :: Stm
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionAction"><span class="hs-identifier hs-var">optionAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stm
</span><a href="#local-6989586621684475526"><span class="hs-identifier hs-var">set_num_runs</span></a></span><span>
</span><span id="line-46"></span><span>      </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><span class="annottext">Option :: String -&gt; Maybe Char -&gt; OptionArgument -&gt; String -&gt; Stm -&gt; Option
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span>
</span><span id="line-48"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">optionLongName :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionLongName"><span class="hs-identifier hs-var">optionLongName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;debugging&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>        </span><span class="annot"><span class="annottext">optionShortName :: Maybe Char
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionShortName"><span class="hs-identifier hs-var">optionShortName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Maybe Char
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'D'</span></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>        </span><span class="annot"><span class="annottext">optionArgument :: OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionArgument"><span class="hs-identifier hs-var">optionArgument</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#NoArgument"><span class="hs-identifier hs-var">NoArgument</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>        </span><span class="annot"><span class="annottext">optionDescription :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionDescription"><span class="hs-identifier hs-var">optionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Perform possibly expensive internal correctness checks and verbose logging.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>        </span><span class="annot"><span class="annottext">optionAction :: Stm
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionAction"><span class="hs-identifier hs-var">optionAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cstm|futhark_context_config_set_debugging(cfg, 1);|]</span></span><span>
</span><span id="line-53"></span><span>      </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><span class="annottext">Option :: String -&gt; Maybe Char -&gt; OptionArgument -&gt; String -&gt; Stm -&gt; Option
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span>
</span><span id="line-55"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">optionLongName :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionLongName"><span class="hs-identifier hs-var">optionLongName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;log&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>        </span><span class="annot"><span class="annottext">optionShortName :: Maybe Char
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionShortName"><span class="hs-identifier hs-var">optionShortName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Maybe Char
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'L'</span></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>        </span><span class="annot"><span class="annottext">optionArgument :: OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionArgument"><span class="hs-identifier hs-var">optionArgument</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#NoArgument"><span class="hs-identifier hs-var">NoArgument</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>        </span><span class="annot"><span class="annottext">optionDescription :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionDescription"><span class="hs-identifier hs-var">optionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Print various low-overhead logging information to stderr while running.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>        </span><span class="annot"><span class="annottext">optionAction :: Stm
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionAction"><span class="hs-identifier hs-var">optionAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cstm|futhark_context_config_set_logging(cfg, 1);|]</span></span><span>
</span><span id="line-60"></span><span>      </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><span class="annottext">Option :: String -&gt; Maybe Char -&gt; OptionArgument -&gt; String -&gt; Stm -&gt; Option
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span>
</span><span id="line-62"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">optionLongName :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionLongName"><span class="hs-identifier hs-var">optionLongName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;entry-point&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>        </span><span class="annot"><span class="annottext">optionShortName :: Maybe Char
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionShortName"><span class="hs-identifier hs-var">optionShortName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Maybe Char
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'e'</span></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>        </span><span class="annot"><span class="annottext">optionArgument :: OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionArgument"><span class="hs-identifier hs-var">optionArgument</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#RequiredArgument"><span class="hs-identifier hs-var">RequiredArgument</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NAME&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>        </span><span class="annot"><span class="annottext">optionDescription :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionDescription"><span class="hs-identifier hs-var">optionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The entry point to run. Defaults to main.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>        </span><span class="annot"><span class="annottext">optionAction :: Stm
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionAction"><span class="hs-identifier hs-var">optionAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cstm|if (entry_point != NULL) entry_point = optarg;|]</span></span><span>
</span><span id="line-67"></span><span>      </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><span class="annottext">Option :: String -&gt; Maybe Char -&gt; OptionArgument -&gt; String -&gt; Stm -&gt; Option
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span>
</span><span id="line-69"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">optionLongName :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionLongName"><span class="hs-identifier hs-var">optionLongName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;binary-output&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>        </span><span class="annot"><span class="annottext">optionShortName :: Maybe Char
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionShortName"><span class="hs-identifier hs-var">optionShortName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Maybe Char
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'b'</span></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>        </span><span class="annot"><span class="annottext">optionArgument :: OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionArgument"><span class="hs-identifier hs-var">optionArgument</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#NoArgument"><span class="hs-identifier hs-var">NoArgument</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>        </span><span class="annot"><span class="annottext">optionDescription :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionDescription"><span class="hs-identifier hs-var">optionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Print the program result in the binary output format.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>        </span><span class="annot"><span class="annottext">optionAction :: Stm
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionAction"><span class="hs-identifier hs-var">optionAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cstm|binary_output = 1;|]</span></span><span>
</span><span id="line-74"></span><span>      </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><span class="annottext">Option :: String -&gt; Maybe Char -&gt; OptionArgument -&gt; String -&gt; Stm -&gt; Option
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span>
</span><span id="line-76"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">optionLongName :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionLongName"><span class="hs-identifier hs-var">optionLongName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;no-print-result&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>        </span><span class="annot"><span class="annottext">optionShortName :: Maybe Char
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionShortName"><span class="hs-identifier hs-var">optionShortName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Maybe Char
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'n'</span></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>        </span><span class="annot"><span class="annottext">optionArgument :: OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionArgument"><span class="hs-identifier hs-var">optionArgument</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#NoArgument"><span class="hs-identifier hs-var">NoArgument</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>        </span><span class="annot"><span class="annottext">optionDescription :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionDescription"><span class="hs-identifier hs-var">optionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Do not print the program result.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>        </span><span class="annot"><span class="annottext">optionAction :: Stm
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionAction"><span class="hs-identifier hs-var">optionAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cstm|print_result = 0;|]</span></span><span>
</span><span id="line-81"></span><span>      </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><span class="annottext">Option :: String -&gt; Maybe Char -&gt; OptionArgument -&gt; String -&gt; Stm -&gt; Option
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span>
</span><span id="line-83"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">optionLongName :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionLongName"><span class="hs-identifier hs-var">optionLongName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;help&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>        </span><span class="annot"><span class="annottext">optionShortName :: Maybe Char
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionShortName"><span class="hs-identifier hs-var">optionShortName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Maybe Char
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'h'</span></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>        </span><span class="annot"><span class="annottext">optionArgument :: OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionArgument"><span class="hs-identifier hs-var">optionArgument</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#NoArgument"><span class="hs-identifier hs-var">NoArgument</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>        </span><span class="annot"><span class="annottext">optionDescription :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionDescription"><span class="hs-identifier hs-var">optionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Print help information and exit.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>        </span><span class="annot"><span class="annottext">optionAction :: Stm
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionAction"><span class="hs-identifier hs-var">optionAction</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-88"></span><span>          </span><span class="annot"><span class="">[C.cstm|{
                   printf(&quot;Usage: %s [OPTION]...\nOptions:\n\n%s\nFor more information, consult the Futhark User's Guide or the man pages.\n&quot;,
                          fut_progname, option_descriptions);
                   exit(0);
                  }|]</span></span><span>
</span><span id="line-93"></span><span>      </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><span class="annottext">Option :: String -&gt; Maybe Char -&gt; OptionArgument -&gt; String -&gt; Stm -&gt; Option
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span>
</span><span id="line-95"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">optionLongName :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionLongName"><span class="hs-identifier hs-var">optionLongName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;print-params&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>        </span><span class="annot"><span class="annottext">optionShortName :: Maybe Char
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionShortName"><span class="hs-identifier hs-var">optionShortName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Char
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>        </span><span class="annot"><span class="annottext">optionArgument :: OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionArgument"><span class="hs-identifier hs-var">optionArgument</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#NoArgument"><span class="hs-identifier hs-var">NoArgument</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>        </span><span class="annot"><span class="annottext">optionDescription :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionDescription"><span class="hs-identifier hs-var">optionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Print all tuning parameters that can be set with --param or --tuning.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>        </span><span class="annot"><span class="annottext">optionAction :: Stm
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionAction"><span class="hs-identifier hs-var">optionAction</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-100"></span><span>          </span><span class="annot"><span class="">[C.cstm|{
                int n = futhark_get_tuning_param_count();
                for (int i = 0; i &lt; n; i++) {
                  printf(&quot;%s (%s)\n&quot;, futhark_get_tuning_param_name(i),
                                      futhark_get_tuning_param_class(i));
                }
                exit(0);
              }|]</span></span><span>
</span><span id="line-108"></span><span>      </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><span class="annottext">Option :: String -&gt; Maybe Char -&gt; OptionArgument -&gt; String -&gt; Stm -&gt; Option
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span>
</span><span id="line-110"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">optionLongName :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionLongName"><span class="hs-identifier hs-var">optionLongName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;param&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>        </span><span class="annot"><span class="annottext">optionShortName :: Maybe Char
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionShortName"><span class="hs-identifier hs-var">optionShortName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Char
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>        </span><span class="annot"><span class="annottext">optionArgument :: OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionArgument"><span class="hs-identifier hs-var">optionArgument</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#RequiredArgument"><span class="hs-identifier hs-var">RequiredArgument</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ASSIGNMENT&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-113"></span><span>        </span><span class="annot"><span class="annottext">optionDescription :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionDescription"><span class="hs-identifier hs-var">optionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Set a tuning parameter to the given value.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-114"></span><span>        </span><span class="annot"><span class="annottext">optionAction :: Stm
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionAction"><span class="hs-identifier hs-var">optionAction</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-115"></span><span>          </span><span class="annot"><span class="">[C.cstm|{
                char *name = optarg;
                char *equals = strstr(optarg, &quot;=&quot;);
                char *value_str = equals != NULL ? equals+1 : optarg;
                int value = atoi(value_str);
                if (equals != NULL) {
                  *equals = 0;
                  if (futhark_context_config_set_tuning_param(cfg, name, (size_t)value) != 0) {
                    futhark_panic(1, &quot;Unknown size: %s\n&quot;, name);
                  }
                } else {
                  futhark_panic(1, &quot;Invalid argument for size option: %s\n&quot;, optarg);
                }}|]</span></span><span>
</span><span id="line-128"></span><span>      </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><span class="annottext">Option :: String -&gt; Maybe Char -&gt; OptionArgument -&gt; String -&gt; Stm -&gt; Option
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span>
</span><span id="line-130"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">optionLongName :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionLongName"><span class="hs-identifier hs-var">optionLongName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tuning&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-131"></span><span>        </span><span class="annot"><span class="annottext">optionShortName :: Maybe Char
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionShortName"><span class="hs-identifier hs-var">optionShortName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Char
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-132"></span><span>        </span><span class="annot"><span class="annottext">optionArgument :: OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionArgument"><span class="hs-identifier hs-var">optionArgument</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#RequiredArgument"><span class="hs-identifier hs-var">RequiredArgument</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;FILE&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><span class="annottext">optionDescription :: String
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionDescription"><span class="hs-identifier hs-var">optionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Read size=value assignments from the given file.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-134"></span><span>        </span><span class="annot"><span class="annottext">optionAction :: Stm
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#optionAction"><span class="hs-identifier hs-var">optionAction</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-135"></span><span>          </span><span class="annot"><span class="">[C.cstm|{
                char *ret = load_tuning_file(optarg, cfg, (int(*)(void*, const char*, size_t))
                                                          futhark_context_config_set_tuning_param);
                if (ret != NULL) {
                  futhark_panic(1, &quot;When loading tuning from '%s': %s\n&quot;, optarg, ret);
                }}|]</span></span><span>
</span><span id="line-141"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-144"></span><span>    </span><span id="local-6989586621684475527"><span class="annot"><span class="annottext">set_runtime_file :: Stm
</span><a href="#local-6989586621684475527"><span class="hs-identifier hs-var hs-var">set_runtime_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-145"></span><span>      </span><span class="annot"><span class="">[C.cstm|{
          runtime_file = fopen(optarg, &quot;w&quot;);
          if (runtime_file == NULL) {
            futhark_panic(1, &quot;Cannot open %s: %s\n&quot;, optarg, strerror(errno));
          }
        }|]</span></span><span>
</span><span id="line-151"></span><span>    </span><span id="local-6989586621684475526"><span class="annot"><span class="annottext">set_num_runs :: Stm
</span><a href="#local-6989586621684475526"><span class="hs-identifier hs-var hs-var">set_num_runs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-152"></span><span>      </span><span class="annot"><span class="">[C.cstm|{
          num_runs = atoi(optarg);
          perform_warmup = 1;
          if (num_runs &lt;= 0) {
            futhark_panic(1, &quot;Need a positive number of runs, not %s\n&quot;, optarg);
          }
        }|]</span></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#readInput"><span class="hs-identifier hs-type">readInput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Manifest</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">C.BlockItem</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Stm</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Stm</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Stm</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Exp</span></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span id="readInput"><span class="annot"><span class="annottext">readInput :: Manifest -&gt; Int -&gt; Text -&gt; ([BlockItem], Stm, Stm, Stm, Exp)
</span><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#readInput"><span class="hs-identifier hs-var hs-var">readInput</span></a></span></span><span> </span><span id="local-6989586621684475474"><span class="annot"><span class="annottext">Manifest
</span><a href="#local-6989586621684475474"><span class="hs-identifier hs-var">manifest</span></a></span></span><span> </span><span id="local-6989586621684475473"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684475473"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621684475472"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475472"><span class="hs-identifier hs-var">tname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Map Text Type -&gt; Maybe Type
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475472"><span class="hs-identifier hs-var">tname</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Text Type -&gt; Maybe Type) -&gt; Map Text Type -&gt; Maybe Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Manifest -&gt; Map Text Type
</span><span class="hs-identifier hs-var hs-var">manifestTypes</span></span><span> </span><span class="annot"><span class="annottext">Manifest
</span><a href="#local-6989586621684475474"><span class="hs-identifier hs-var">manifest</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><span class="annottext">Maybe Type
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-164"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684475469"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684475469"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Signedness, PrimType)
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#scalarToPrim"><span class="hs-identifier hs-var">scalarToPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475472"><span class="hs-identifier hs-var">tname</span></a></span><span>
</span><span id="line-165"></span><span>          </span><span id="local-6989586621684475465"><span class="annot"><span class="annottext">dest :: String
</span><a href="#local-6989586621684475465"><span class="hs-identifier hs-var hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;read_value_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684475473"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-166"></span><span>          </span><span id="local-6989586621684475459"><span class="annot"><span class="annottext">info :: String
</span><a href="#local-6989586621684475459"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475472"><span class="hs-identifier hs-var">tname</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_info&quot;</span></span><span>
</span><span id="line-167"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="">[C.citems|
             $ty:(primStorageType t) $id:dest;
             if (read_scalar(stdin, &amp;$id:info, &amp;$id:dest) != 0) {
             futhark_panic(1, &quot;Error when reading input #%d of type %s (errno: %s).\n&quot;,
                           $int:i,
                           $string:(T.unpack tname),
                           strerror(errno));
                           };|]</span></span><span class="hs-special">,</span><span>
</span><span id="line-175"></span><span>            </span><span class="annot"><span class="">[C.cstm|;|]</span></span><span class="hs-special">,</span><span>
</span><span id="line-176"></span><span>            </span><span class="annot"><span class="">[C.cstm|;|]</span></span><span class="hs-special">,</span><span>
</span><span id="line-177"></span><span>            </span><span class="annot"><span class="">[C.cstm|;|]</span></span><span class="hs-special">,</span><span>
</span><span id="line-178"></span><span>            </span><span class="annot"><span class="">[C.cexp|$id:dest|]</span></span><span>
</span><span id="line-179"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeOpaque</span></span><span> </span><span id="local-6989586621684475449"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475449"><span class="hs-identifier hs-var">desc</span></a></span></span><span> </span><span class="annot"><span class="annottext">OpaqueOps
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-181"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="">[C.citems|futhark_panic(1, &quot;Cannot read input #%d of type %s\n&quot;, $int:i, $string:(T.unpack desc));|]</span></span><span class="hs-special">,</span><span>
</span><span id="line-182"></span><span>        </span><span class="annot"><span class="">[C.cstm|;|]</span></span><span class="hs-special">,</span><span>
</span><span id="line-183"></span><span>        </span><span class="annot"><span class="">[C.cstm|;|]</span></span><span class="hs-special">,</span><span>
</span><span id="line-184"></span><span>        </span><span class="annot"><span class="">[C.cstm|;|]</span></span><span class="hs-special">,</span><span>
</span><span id="line-185"></span><span>        </span><span class="annot"><span class="">[C.cexp|NULL|]</span></span><span>
</span><span id="line-186"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeArray</span></span><span> </span><span id="local-6989586621684475447"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475447"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621684475446"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475446"><span class="hs-identifier hs-var">et</span></a></span></span><span> </span><span id="local-6989586621684475445"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684475445"><span class="hs-identifier hs-var">rank</span></a></span></span><span> </span><span id="local-6989586621684475444"><span class="annot"><span class="annottext">ArrayOps
</span><a href="#local-6989586621684475444"><span class="hs-identifier hs-var">ops</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-188"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684475440"><span class="annot"><span class="annottext">dest :: String
</span><a href="#local-6989586621684475440"><span class="hs-identifier hs-var hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;read_value_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684475473"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-189"></span><span>          </span><span id="local-6989586621684475436"><span class="annot"><span class="annottext">shape :: String
</span><a href="#local-6989586621684475436"><span class="hs-identifier hs-var hs-var">shape</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;read_shape_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684475473"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-190"></span><span>          </span><span id="local-6989586621684475432"><span class="annot"><span class="annottext">arr :: String
</span><a href="#local-6989586621684475432"><span class="hs-identifier hs-var hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;read_arr_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684475473"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>          </span><span id="local-6989586621684475430"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621684475430"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cty|typename $id:t|]</span></span><span>
</span><span id="line-193"></span><span>          </span><span id="local-6989586621684475421"><span class="annot"><span class="annottext">dims_exps :: [Exp]
</span><a href="#local-6989586621684475421"><span class="hs-identifier hs-var hs-var">dims_exps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="">[C.cexp|$id:shape[$int:j]|]</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621684475420"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684475420"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684475445"><span class="hs-identifier hs-var">rank</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-194"></span><span>          </span><span id="local-6989586621684475418"><span class="annot"><span class="annottext">t' :: Type
</span><a href="#local-6989586621684475418"><span class="hs-identifier hs-var hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Signedness -&gt; PrimType -&gt; Type) -&gt; (Signedness, PrimType) -&gt; Type
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">Signedness -&gt; PrimType -&gt; Type
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#primAPIType"><span class="hs-identifier hs-var">primAPIType</span></a></span><span> </span><span class="annot"><span class="annottext">((Signedness, PrimType) -&gt; Type) -&gt; (Signedness, PrimType) -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Signedness, PrimType)
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#scalarToPrim"><span class="hs-identifier hs-var">scalarToPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475446"><span class="hs-identifier hs-var">et</span></a></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span>          </span><span id="local-6989586621684475416"><span class="annot"><span class="annottext">new_array :: Text
</span><a href="#local-6989586621684475416"><span class="hs-identifier hs-var hs-var">new_array</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrayOps -&gt; Text
</span><span class="hs-identifier hs-var hs-var">arrayNew</span></span><span> </span><span class="annot"><span class="annottext">ArrayOps
</span><a href="#local-6989586621684475444"><span class="hs-identifier hs-var">ops</span></a></span><span>
</span><span id="line-197"></span><span>          </span><span id="local-6989586621684475414"><span class="annot"><span class="annottext">free_array :: Text
</span><a href="#local-6989586621684475414"><span class="hs-identifier hs-var hs-var">free_array</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrayOps -&gt; Text
</span><span class="hs-identifier hs-var hs-var">arrayFree</span></span><span> </span><span class="annot"><span class="annottext">ArrayOps
</span><a href="#local-6989586621684475444"><span class="hs-identifier hs-var">ops</span></a></span><span>
</span><span id="line-198"></span><span>          </span><span id="local-6989586621684475409"><span class="annot"><span class="annottext">info :: String
</span><a href="#local-6989586621684475409"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475446"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_info&quot;</span></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span>          </span><span id="local-6989586621684475388"><span class="annot"><span class="annottext">items :: [BlockItem]
</span><a href="#local-6989586621684475388"><span class="hs-identifier hs-var hs-var">items</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-201"></span><span>            </span><span class="annot"><span class="">[C.citems|
               $ty:ty $id:dest;
               typename int64_t $id:shape[$int:rank];
               $ty:t' *$id:arr = NULL;
               errno = 0;
               if (read_array(stdin,
                              &amp;$id:info,
                              (void**) &amp;$id:arr,
                              $id:shape,
                              $int:rank)
                   != 0) {
                 futhark_panic(1, &quot;Cannot read input #%d of type %s%s (errno: %s).\n&quot;,
                               $int:i,
                               $string:(T.unpack tname),
                               $id:info.type_name,
                               strerror(errno));
               }|]</span></span><span>
</span><span id="line-218"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[BlockItem]
</span><a href="#local-6989586621684475388"><span class="hs-identifier hs-var">items</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-219"></span><span>            </span><span class="annot"><span class="">[C.cstm|assert(($id:dest = $id:new_array(ctx, $id:arr, $args:dims_exps)) != NULL);|]</span></span><span class="hs-special">,</span><span>
</span><span id="line-220"></span><span>            </span><span class="annot"><span class="">[C.cstm|assert($id:free_array(ctx, $id:dest) == 0);|]</span></span><span class="hs-special">,</span><span>
</span><span id="line-221"></span><span>            </span><span class="annot"><span class="">[C.cstm|free($id:arr);|]</span></span><span class="hs-special">,</span><span>
</span><span id="line-222"></span><span>            </span><span class="annot"><span class="">[C.cexp|$id:dest|]</span></span><span>
</span><span id="line-223"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#readInputs"><span class="hs-identifier hs-type">readInputs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Manifest</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">C.BlockItem</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Stm</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Stm</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Stm</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Exp</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-226"></span><span id="readInputs"><span class="annot"><span class="annottext">readInputs :: Manifest -&gt; [Text] -&gt; [([BlockItem], Stm, Stm, Stm, Exp)]
</span><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#readInputs"><span class="hs-identifier hs-var hs-var">readInputs</span></a></span></span><span> </span><span id="local-6989586621684475371"><span class="annot"><span class="annottext">Manifest
</span><a href="#local-6989586621684475371"><span class="hs-identifier hs-var">manifest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Text -&gt; ([BlockItem], Stm, Stm, Stm, Exp))
-&gt; [Int] -&gt; [Text] -&gt; [([BlockItem], Stm, Stm, Stm, Exp)]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Manifest -&gt; Int -&gt; Text -&gt; ([BlockItem], Stm, Stm, Stm, Exp)
</span><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#readInput"><span class="hs-identifier hs-var">readInput</span></a></span><span> </span><span class="annot"><span class="annottext">Manifest
</span><a href="#local-6989586621684475371"><span class="hs-identifier hs-var">manifest</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#prepareOutputs"><span class="hs-identifier hs-type">prepareOutputs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Manifest</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.BlockItem</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Exp</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Stm</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-229"></span><span id="prepareOutputs"><span class="annot"><span class="annottext">prepareOutputs :: Manifest -&gt; [Text] -&gt; [(BlockItem, Exp, Stm)]
</span><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#prepareOutputs"><span class="hs-identifier hs-var hs-var">prepareOutputs</span></a></span></span><span> </span><span id="local-6989586621684475368"><span class="annot"><span class="annottext">Manifest
</span><a href="#local-6989586621684475368"><span class="hs-identifier hs-var">manifest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Text -&gt; (BlockItem, Exp, Stm))
-&gt; [Int] -&gt; [Text] -&gt; [(BlockItem, Exp, Stm)]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; (BlockItem, Exp, Stm)
forall {p}. Show p =&gt; p -&gt; Text -&gt; (BlockItem, Exp, Stm)
</span><a href="#local-6989586621684475367"><span class="hs-identifier hs-var">prepareResult</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-231"></span><span>    </span><span id="local-6989586621684475367"><span class="annot"><span class="annottext">prepareResult :: p -&gt; Text -&gt; (BlockItem, Exp, Stm)
</span><a href="#local-6989586621684475367"><span class="hs-identifier hs-var hs-var">prepareResult</span></a></span></span><span> </span><span id="local-6989586621684475352"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621684475352"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621684475351"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475351"><span class="hs-identifier hs-var">tname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-232"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684475347"><span class="annot"><span class="annottext">result :: String
</span><a href="#local-6989586621684475347"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;result_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">p -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621684475352"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Map Text Type -&gt; Maybe Type
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475351"><span class="hs-identifier hs-var">tname</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Text Type -&gt; Maybe Type) -&gt; Map Text Type -&gt; Maybe Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Manifest -&gt; Map Text Type
</span><span class="hs-identifier hs-var hs-var">manifestTypes</span></span><span> </span><span class="annot"><span class="annottext">Manifest
</span><a href="#local-6989586621684475368"><span class="hs-identifier hs-var">manifest</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-235"></span><span>        </span><span class="annot"><span class="annottext">Maybe Type
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-236"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684475346"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684475346"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684475345"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684475345"><span class="hs-identifier hs-var">pt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Signedness, PrimType)
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#scalarToPrim"><span class="hs-identifier hs-var">scalarToPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475351"><span class="hs-identifier hs-var">tname</span></a></span><span>
</span><span id="line-237"></span><span>              </span><span id="local-6989586621684475344"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621684475344"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Signedness -&gt; PrimType -&gt; Type
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#primAPIType"><span class="hs-identifier hs-var">primAPIType</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684475346"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684475345"><span class="hs-identifier hs-var">pt</span></a></span><span>
</span><span id="line-238"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="">[C.citem|$ty:ty $id:result;|]</span></span><span class="hs-special">,</span><span>
</span><span id="line-239"></span><span>                </span><span class="annot"><span class="">[C.cexp|$id:result|]</span></span><span class="hs-special">,</span><span>
</span><span id="line-240"></span><span>                </span><span class="annot"><span class="">[C.cstm|;|]</span></span><span>
</span><span id="line-241"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeArray</span></span><span> </span><span id="local-6989586621684475338"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475338"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684475337"><span class="annot"><span class="annottext">ArrayOps
</span><a href="#local-6989586621684475337"><span class="hs-identifier hs-var">ops</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-243"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="">[C.citem|typename $id:t $id:result;|]</span></span><span class="hs-special">,</span><span>
</span><span id="line-244"></span><span>            </span><span class="annot"><span class="">[C.cexp|$id:result|]</span></span><span class="hs-special">,</span><span>
</span><span id="line-245"></span><span>            </span><span class="annot"><span class="">[C.cstm|assert($id:(arrayFree ops)(ctx, $id:result) == 0);|]</span></span><span>
</span><span id="line-246"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeOpaque</span></span><span> </span><span id="local-6989586621684475336"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475336"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621684475335"><span class="annot"><span class="annottext">OpaqueOps
</span><a href="#local-6989586621684475335"><span class="hs-identifier hs-var">ops</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-248"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="">[C.citem|typename $id:t $id:result;|]</span></span><span class="hs-special">,</span><span>
</span><span id="line-249"></span><span>            </span><span class="annot"><span class="">[C.cexp|$id:result|]</span></span><span class="hs-special">,</span><span>
</span><span id="line-250"></span><span>            </span><span class="annot"><span class="">[C.cstm|assert($id:(opaqueFree ops)(ctx, $id:result) == 0);|]</span></span><span>
</span><span id="line-251"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="hs-comment">-- | Return a statement printing the given external value.</span><span>
</span><span id="line-254"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#printStm"><span class="hs-identifier hs-type">printStm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Manifest</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Exp</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Stm</span></span><span>
</span><span id="line-255"></span><span id="printStm"><span class="annot"><span class="annottext">printStm :: Manifest -&gt; Text -&gt; Exp -&gt; Stm
</span><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#printStm"><span class="hs-identifier hs-var hs-var">printStm</span></a></span></span><span> </span><span id="local-6989586621684475332"><span class="annot"><span class="annottext">Manifest
</span><a href="#local-6989586621684475332"><span class="hs-identifier hs-var">manifest</span></a></span></span><span> </span><span id="local-6989586621684475331"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475331"><span class="hs-identifier hs-var">tname</span></a></span></span><span> </span><span id="local-6989586621684475330"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684475330"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Map Text Type -&gt; Maybe Type
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475331"><span class="hs-identifier hs-var">tname</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Text Type -&gt; Maybe Type) -&gt; Map Text Type -&gt; Maybe Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Manifest -&gt; Map Text Type
</span><span class="hs-identifier hs-var hs-var">manifestTypes</span></span><span> </span><span class="annot"><span class="annottext">Manifest
</span><a href="#local-6989586621684475332"><span class="hs-identifier hs-var">manifest</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><span class="annottext">Maybe Type
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-258"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684475325"><span class="annot"><span class="annottext">info :: Text
</span><a href="#local-6989586621684475325"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475331"><span class="hs-identifier hs-var">tname</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_info&quot;</span></span><span>
</span><span id="line-259"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="">[C.cstm|write_scalar(stdout, binary_output, &amp;$id:info, &amp;$exp:e);|]</span></span><span>
</span><span id="line-260"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeOpaque</span></span><span> </span><span id="local-6989586621684475324"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475324"><span class="hs-identifier hs-var">desc</span></a></span></span><span> </span><span class="annot"><span class="annottext">OpaqueOps
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-261"></span><span>      </span><span class="annot"><span class="">[C.cstm|printf(&quot;#&lt;opaque %s&gt;&quot;, $string:(T.unpack desc));|]</span></span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeArray</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684475323"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475323"><span class="hs-identifier hs-var">et</span></a></span></span><span> </span><span id="local-6989586621684475322"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684475322"><span class="hs-identifier hs-var">rank</span></a></span></span><span> </span><span id="local-6989586621684475321"><span class="annot"><span class="annottext">ArrayOps
</span><a href="#local-6989586621684475321"><span class="hs-identifier hs-var">ops</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-263"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684475320"><span class="annot"><span class="annottext">et' :: Type
</span><a href="#local-6989586621684475320"><span class="hs-identifier hs-var hs-var">et'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Signedness -&gt; PrimType -&gt; Type) -&gt; (Signedness, PrimType) -&gt; Type
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">Signedness -&gt; PrimType -&gt; Type
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#primAPIType"><span class="hs-identifier hs-var">primAPIType</span></a></span><span> </span><span class="annot"><span class="annottext">((Signedness, PrimType) -&gt; Type) -&gt; (Signedness, PrimType) -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Signedness, PrimType)
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#scalarToPrim"><span class="hs-identifier hs-var">scalarToPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475323"><span class="hs-identifier hs-var">et</span></a></span><span>
</span><span id="line-264"></span><span>          </span><span id="local-6989586621684475319"><span class="annot"><span class="annottext">values_array :: Text
</span><a href="#local-6989586621684475319"><span class="hs-identifier hs-var hs-var">values_array</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrayOps -&gt; Text
</span><span class="hs-identifier hs-var hs-var">arrayValues</span></span><span> </span><span class="annot"><span class="annottext">ArrayOps
</span><a href="#local-6989586621684475321"><span class="hs-identifier hs-var">ops</span></a></span><span>
</span><span id="line-265"></span><span>          </span><span id="local-6989586621684475317"><span class="annot"><span class="annottext">shape_array :: Text
</span><a href="#local-6989586621684475317"><span class="hs-identifier hs-var hs-var">shape_array</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrayOps -&gt; Text
</span><span class="hs-identifier hs-var hs-var">arrayShape</span></span><span> </span><span class="annot"><span class="annottext">ArrayOps
</span><a href="#local-6989586621684475321"><span class="hs-identifier hs-var">ops</span></a></span><span>
</span><span id="line-266"></span><span>          </span><span id="local-6989586621684475306"><span class="annot"><span class="annottext">num_elems :: Exp
</span><a href="#local-6989586621684475306"><span class="hs-identifier hs-var hs-var">num_elems</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-267"></span><span>            </span><span class="annot"><span class="annottext">[Exp] -&gt; Exp
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#cproduct"><span class="hs-identifier hs-var">cproduct</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="">[C.cexp|$id:shape_array(ctx, $exp:e)[$int:i]|]</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621684475305"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684475305"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684475322"><span class="hs-identifier hs-var">rank</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-268"></span><span>          </span><span id="local-6989586621684475302"><span class="annot"><span class="annottext">info :: Text
</span><a href="#local-6989586621684475302"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475323"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_info&quot;</span></span><span>
</span><span id="line-269"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="">[C.cstm|{
                 $ty:et' *arr = calloc($exp:num_elems, $id:info.size);
                 assert(arr != NULL);
                 assert($id:values_array(ctx, $exp:e, arr) == 0);
                 write_array(stdout, binary_output, &amp;$id:info, arr,
                             $id:shape_array(ctx, $exp:e), $int:rank);
                 free(arr);
                 }|]</span></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#printResult"><span class="hs-identifier hs-type">printResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Manifest</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Exp</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">C.Stm</span></span><span class="hs-special">]</span><span>
</span><span id="line-279"></span><span id="printResult"><span class="annot"><span class="annottext">printResult :: Manifest -&gt; [(Text, Exp)] -&gt; [Stm]
</span><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#printResult"><span class="hs-identifier hs-var hs-var">printResult</span></a></span></span><span> </span><span id="local-6989586621684475295"><span class="annot"><span class="annottext">Manifest
</span><a href="#local-6989586621684475295"><span class="hs-identifier hs-var">manifest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Text, Exp) -&gt; [Stm]) -&gt; [(Text, Exp)] -&gt; [Stm]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(Text, Exp) -&gt; [Stm]
</span><a href="#local-6989586621684475293"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-281"></span><span>    </span><span id="local-6989586621684475293"><span class="annot"><span class="annottext">f :: (Text, Exp) -&gt; [Stm]
</span><a href="#local-6989586621684475293"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684475290"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475290"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684475289"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684475289"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Manifest -&gt; Text -&gt; Exp -&gt; Stm
</span><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#printStm"><span class="hs-identifier hs-var">printStm</span></a></span><span> </span><span class="annot"><span class="annottext">Manifest
</span><a href="#local-6989586621684475295"><span class="hs-identifier hs-var">manifest</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475290"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684475289"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[C.cstm|printf(&quot;\n&quot;);|]</span></span><span class="hs-special">]</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#cliEntryPoint"><span class="hs-identifier hs-type">cliEntryPoint</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-284"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Manifest</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EntryPoint</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.Definition</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Initializer</span></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span id="cliEntryPoint"><span class="annot"><span class="annottext">cliEntryPoint :: Manifest -&gt; Text -&gt; EntryPoint -&gt; (Definition, Initializer)
</span><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#cliEntryPoint"><span class="hs-identifier hs-var hs-var">cliEntryPoint</span></a></span></span><span> </span><span id="local-6989586621684475287"><span class="annot"><span class="annottext">Manifest
</span><a href="#local-6989586621684475287"><span class="hs-identifier hs-var">manifest</span></a></span></span><span> </span><span id="local-6989586621684475286"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475286"><span class="hs-identifier hs-var">entry_point_name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EntryPoint</span></span><span> </span><span id="local-6989586621684475284"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475284"><span class="hs-identifier hs-var">cfun</span></a></span></span><span> </span><span id="local-6989586621684475283"><span class="annot"><span class="annottext">[Output]
</span><a href="#local-6989586621684475283"><span class="hs-identifier hs-var">outputs</span></a></span></span><span> </span><span id="local-6989586621684475282"><span class="annot"><span class="annottext">[Input]
</span><a href="#local-6989586621684475282"><span class="hs-identifier hs-var">inputs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684475281"><span class="annot"><span class="annottext">[[BlockItem]]
</span><a href="#local-6989586621684475281"><span class="hs-identifier hs-var">input_items</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684475280"><span class="annot"><span class="annottext">[Stm]
</span><a href="#local-6989586621684475280"><span class="hs-identifier hs-var">pack_input</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684475279"><span class="annot"><span class="annottext">[Stm]
</span><a href="#local-6989586621684475279"><span class="hs-identifier hs-var">free_input</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684475278"><span class="annot"><span class="annottext">[Stm]
</span><a href="#local-6989586621684475278"><span class="hs-identifier hs-var">free_parsed</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684475277"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621684475277"><span class="hs-identifier hs-var">input_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-287"></span><span>        </span><span class="annot"><span class="annottext">[([BlockItem], Stm, Stm, Stm, Exp)]
-&gt; ([[BlockItem]], [Stm], [Stm], [Stm], [Exp])
forall a b c d e. [(a, b, c, d, e)] -&gt; ([a], [b], [c], [d], [e])
</span><span class="hs-identifier hs-var">unzip5</span></span><span> </span><span class="annot"><span class="annottext">([([BlockItem], Stm, Stm, Stm, Exp)]
 -&gt; ([[BlockItem]], [Stm], [Stm], [Stm], [Exp]))
-&gt; [([BlockItem], Stm, Stm, Stm, Exp)]
-&gt; ([[BlockItem]], [Stm], [Stm], [Stm], [Exp])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Manifest -&gt; [Text] -&gt; [([BlockItem], Stm, Stm, Stm, Exp)]
</span><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#readInputs"><span class="hs-identifier hs-var">readInputs</span></a></span><span> </span><span class="annot"><span class="annottext">Manifest
</span><a href="#local-6989586621684475287"><span class="hs-identifier hs-var">manifest</span></a></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; [([BlockItem], Stm, Stm, Stm, Exp)])
-&gt; [Text] -&gt; [([BlockItem], Stm, Stm, Stm, Exp)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Input -&gt; Text) -&gt; [Input] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Input -&gt; Text
</span><span class="hs-identifier hs-var hs-var">inputType</span></span><span> </span><span class="annot"><span class="annottext">[Input]
</span><a href="#local-6989586621684475282"><span class="hs-identifier hs-var">inputs</span></a></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684475275"><span class="annot"><span class="annottext">[BlockItem]
</span><a href="#local-6989586621684475275"><span class="hs-identifier hs-var">output_decls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684475274"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621684475274"><span class="hs-identifier hs-var">output_vals</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684475273"><span class="annot"><span class="annottext">[Stm]
</span><a href="#local-6989586621684475273"><span class="hs-identifier hs-var">free_outputs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-290"></span><span>        </span><span class="annot"><span class="annottext">[(BlockItem, Exp, Stm)] -&gt; ([BlockItem], [Exp], [Stm])
forall a b c. [(a, b, c)] -&gt; ([a], [b], [c])
</span><span class="hs-identifier hs-var">unzip3</span></span><span> </span><span class="annot"><span class="annottext">([(BlockItem, Exp, Stm)] -&gt; ([BlockItem], [Exp], [Stm]))
-&gt; [(BlockItem, Exp, Stm)] -&gt; ([BlockItem], [Exp], [Stm])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Manifest -&gt; [Text] -&gt; [(BlockItem, Exp, Stm)]
</span><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#prepareOutputs"><span class="hs-identifier hs-var">prepareOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">Manifest
</span><a href="#local-6989586621684475287"><span class="hs-identifier hs-var">manifest</span></a></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; [(BlockItem, Exp, Stm)])
-&gt; [Text] -&gt; [(BlockItem, Exp, Stm)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Text) -&gt; [Output] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Output -&gt; Text
</span><span class="hs-identifier hs-var hs-var">outputType</span></span><span> </span><span class="annot"><span class="annottext">[Output]
</span><a href="#local-6989586621684475283"><span class="hs-identifier hs-var">outputs</span></a></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span>      </span><span id="local-6989586621684475270"><span class="annot"><span class="annottext">printstms :: [Stm]
</span><a href="#local-6989586621684475270"><span class="hs-identifier hs-var hs-var">printstms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-293"></span><span>        </span><span class="annot"><span class="annottext">Manifest -&gt; [(Text, Exp)] -&gt; [Stm]
</span><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#printResult"><span class="hs-identifier hs-var">printResult</span></a></span><span> </span><span class="annot"><span class="annottext">Manifest
</span><a href="#local-6989586621684475287"><span class="hs-identifier hs-var">manifest</span></a></span><span> </span><span class="annot"><span class="annottext">([(Text, Exp)] -&gt; [Stm]) -&gt; [(Text, Exp)] -&gt; [Stm]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Exp] -&gt; [(Text, Exp)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Output -&gt; Text) -&gt; [Output] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Output -&gt; Text
</span><span class="hs-identifier hs-var hs-var">outputType</span></span><span> </span><span class="annot"><span class="annottext">[Output]
</span><a href="#local-6989586621684475283"><span class="hs-identifier hs-var">outputs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621684475274"><span class="hs-identifier hs-var">output_vals</span></a></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span>      </span><span id="local-6989586621684475269"><span class="annot"><span class="annottext">ctx_ty :: Type
</span><a href="#local-6989586621684475269"><span class="hs-identifier hs-var hs-var">ctx_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cty|struct futhark_context|]</span></span><span>
</span><span id="line-296"></span><span>      </span><span id="local-6989586621684475266"><span class="annot"><span class="annottext">sync_ctx :: Text
</span><a href="#local-6989586621684475266"><span class="hs-identifier hs-var hs-var">sync_ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;futhark_context_sync&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-297"></span><span>      </span><span id="local-6989586621684475264"><span class="annot"><span class="annottext">error_ctx :: Text
</span><a href="#local-6989586621684475264"><span class="hs-identifier hs-var hs-var">error_ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;futhark_context_get_error&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span>      </span><span id="local-6989586621684475261"><span class="annot"><span class="annottext">cli_entry_point_function_name :: String
</span><a href="#local-6989586621684475261"><span class="hs-identifier hs-var hs-var">cli_entry_point_function_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;futrts_cli_entry_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684475286"><span class="hs-identifier hs-var">entry_point_name</span></a></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span>      </span><span id="local-6989586621684475259"><span class="annot"><span class="annottext">pause_profiling :: Text
</span><a href="#local-6989586621684475259"><span class="hs-identifier hs-var hs-var">pause_profiling</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;futhark_context_pause_profiling&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-302"></span><span>      </span><span id="local-6989586621684475257"><span class="annot"><span class="annottext">unpause_profiling :: Text
</span><a href="#local-6989586621684475257"><span class="hs-identifier hs-var hs-var">unpause_profiling</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;futhark_context_unpause_profiling&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span>      </span><span id="local-6989586621684475254"><span class="annot"><span class="annottext">addrOf :: a -&gt; Exp
</span><a href="#local-6989586621684475254"><span class="hs-identifier hs-var hs-var">addrOf</span></a></span></span><span> </span><span id="local-6989586621684475253"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684475253"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cexp|&amp;$exp:e|]</span></span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span>      </span><span id="local-6989586621684475236"><span class="annot"><span class="annottext">run_it :: [BlockItem]
</span><a href="#local-6989586621684475236"><span class="hs-identifier hs-var hs-var">run_it</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-307"></span><span>        </span><span class="annot"><span class="">[C.citems|
                int r;
                // Run the program once.
                $stms:pack_input
                if ($id:sync_ctx(ctx) != 0) {
                  futhark_panic(1, &quot;%s&quot;, $id:error_ctx(ctx));
                };
                // Only profile last run.
                if (profile_run) {
                  $id:unpause_profiling(ctx);
                }
                t_start = get_wall_time();
                r = $id:cfun(ctx,
                             $args:(map addrOf output_vals),
                             $args:input_args);
                if (r != 0) {
                  futhark_panic(1, &quot;%s&quot;, $id:error_ctx(ctx));
                }
                if ($id:sync_ctx(ctx) != 0) {
                  futhark_panic(1, &quot;%s&quot;, $id:error_ctx(ctx));
                };
                if (profile_run) {
                  $id:pause_profiling(ctx);
                }
                t_end = get_wall_time();
                long int elapsed_usec = t_end - t_start;
                if (time_runs &amp;&amp; runtime_file != NULL) {
                  fprintf(runtime_file, &quot;%lld\n&quot;, (long long) elapsed_usec);
                  fflush(runtime_file);
                }
                $stms:free_input
              |]</span></span><span>
</span><span id="line-339"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="">[C.cedecl|
   static void $id:cli_entry_point_function_name($ty:ctx_ty *ctx) {
     typename int64_t t_start, t_end;
     int time_runs = 0, profile_run = 0;

     // We do not want to profile all the initialisation.
     $id:pause_profiling(ctx);

     // Declare and read input.
     set_binary_mode(stdin);
     $items:(mconcat input_items)

     if (end_of_input(stdin) != 0) {
       futhark_panic(1, &quot;Expected EOF on stdin after reading input for \&quot;%s\&quot;.\n&quot;, $string:(pretty entry_point_name));
     }

     $items:output_decls

     // Warmup run
     if (perform_warmup) {
       $items:run_it
       $stms:free_outputs
     }
     time_runs = 1;
     // Proper run.
     for (int run = 0; run &lt; num_runs; run++) {
       // Only profile last run.
       profile_run = run == num_runs -1;
       $items:run_it
       if (run &lt; num_runs-1) {
         $stms:free_outputs
       }
     }

     // Free the parsed input.
     $stms:free_parsed

     if (print_result) {
       // Print the final result.
       if (binary_output) {
         set_binary_mode(stdout);
       }
       $stms:printstms
     }

     $stms:free_outputs
   }|]</span></span><span class="hs-special">,</span><span>
</span><span id="line-386"></span><span>        </span><span class="annot"><span class="">[C.cinit|{ .name = $string:(T.unpack entry_point_name),
                       .fun = $id:cli_entry_point_function_name }|]</span></span><span>
</span><span id="line-388"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#cliDefs"><span class="hs-pragma hs-type">cliDefs</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span class="hs-comment">-- | Generate Futhark standalone executable code.</span><span>
</span><span id="line-393"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#cliDefs"><span class="hs-identifier hs-type">cliDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericC.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Manifest</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-394"></span><span id="cliDefs"><span class="annot"><span class="annottext">cliDefs :: [Option] -&gt; Manifest -&gt; Text
</span><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#cliDefs"><span class="hs-identifier hs-var hs-var">cliDefs</span></a></span></span><span> </span><span id="local-6989586621684475217"><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621684475217"><span class="hs-identifier hs-var">options</span></a></span></span><span> </span><span id="local-6989586621684475216"><span class="annot"><span class="annottext">Manifest
</span><a href="#local-6989586621684475216"><span class="hs-identifier hs-var">manifest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684475215"><span class="annot"><span class="annottext">option_parser :: Func
</span><a href="#local-6989586621684475215"><span class="hs-identifier hs-var hs-var">option_parser</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-396"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; [Option] -&gt; Func
</span><a href="Futhark.CodeGen.Backends.GenericC.Options.html#generateOptionParser"><span class="hs-identifier hs-var">generateOptionParser</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;parse_options&quot;</span></span><span> </span><span class="annot"><span class="annottext">([Option] -&gt; Func) -&gt; [Option] -&gt; Func
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#genericOptions"><span class="hs-identifier hs-var">genericOptions</span></a></span><span> </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621684475217"><span class="hs-identifier hs-var">options</span></a></span><span>
</span><span id="line-397"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684475213"><span class="annot"><span class="annottext">[Definition]
</span><a href="#local-6989586621684475213"><span class="hs-identifier hs-var">cli_entry_point_decls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684475212"><span class="annot"><span class="annottext">[Initializer]
</span><a href="#local-6989586621684475212"><span class="hs-identifier hs-var">entry_point_inits</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-398"></span><span>        </span><span class="annot"><span class="annottext">[(Definition, Initializer)] -&gt; ([Definition], [Initializer])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([(Definition, Initializer)] -&gt; ([Definition], [Initializer]))
-&gt; [(Definition, Initializer)] -&gt; ([Definition], [Initializer])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-399"></span><span>          </span><span class="annot"><span class="annottext">((Text, EntryPoint) -&gt; (Definition, Initializer))
-&gt; [(Text, EntryPoint)] -&gt; [(Definition, Initializer)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text -&gt; EntryPoint -&gt; (Definition, Initializer))
-&gt; (Text, EntryPoint) -&gt; (Definition, Initializer)
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Manifest -&gt; Text -&gt; EntryPoint -&gt; (Definition, Initializer)
</span><a href="Futhark.CodeGen.Backends.GenericC.CLI.html#cliEntryPoint"><span class="hs-identifier hs-var">cliEntryPoint</span></a></span><span> </span><span class="annot"><span class="annottext">Manifest
</span><a href="#local-6989586621684475216"><span class="hs-identifier hs-var">manifest</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Text, EntryPoint)] -&gt; [(Definition, Initializer)])
-&gt; [(Text, EntryPoint)] -&gt; [(Definition, Initializer)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-400"></span><span>            </span><span class="annot"><span class="annottext">Map Text EntryPoint -&gt; [(Text, EntryPoint)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map Text EntryPoint -&gt; [(Text, EntryPoint)])
-&gt; Map Text EntryPoint -&gt; [(Text, EntryPoint)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Manifest -&gt; Map Text EntryPoint
</span><span class="hs-identifier hs-var hs-var">manifestEntryPoints</span></span><span> </span><span class="annot"><span class="annottext">Manifest
</span><a href="#local-6989586621684475216"><span class="hs-identifier hs-var">manifest</span></a></span><span>
</span><span id="line-401"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Definition] -&gt; Text
forall a. Pretty a =&gt; a -&gt; Text
</span><a href="Futhark.Util.Pretty.html#prettyText"><span class="hs-identifier hs-var">prettyText</span></a></span><span>
</span><span id="line-402"></span><span>        </span><span class="annot"><span class="">[C.cunit|
$esc:(&quot;#include &lt;getopt.h&gt;&quot;)
$esc:(&quot;#include &lt;ctype.h&gt;&quot;)
$esc:(&quot;#include &lt;inttypes.h&gt;&quot;)
$esc:(&quot;#include &lt;unistd.h&gt;&quot;)

$esc:(T.unpack valuesH)

static int binary_output = 0;
static int print_result = 1;
static typename FILE *runtime_file;
static int perform_warmup = 0;
static int num_runs = 1;
// If the entry point is NULL, the program will terminate after doing initialisation and such.
static const char *entry_point = &quot;main&quot;;

$esc:(T.unpack tuningH)

$func:option_parser

$edecls:cli_entry_point_decls

typedef void entry_point_fun(struct futhark_context*);

struct entry_point_entry {
  const char *name;
  entry_point_fun *fun;
};

int main(int argc, char** argv) {
  fut_progname = argv[0];

  struct futhark_context_config *cfg = futhark_context_config_new();
  assert(cfg != NULL);

  int parsed_options = parse_options(cfg, argc, argv);
  argc -= parsed_options;
  argv += parsed_options;

  if (argc != 0) {
    futhark_panic(1, &quot;Excess non-option: %s\n&quot;, argv[0]);
  }

  struct futhark_context *ctx = futhark_context_new(cfg);
  assert (ctx != NULL);

  char* error = futhark_context_get_error(ctx);
  if (error != NULL) {
    futhark_panic(1, &quot;%s&quot;, error);
  }

  struct entry_point_entry entry_points[] = {
    $inits:entry_point_inits
  };

  if (entry_point != NULL) {
    int num_entry_points = sizeof(entry_points) / sizeof(entry_points[0]);
    entry_point_fun *entry_point_fun = NULL;
    for (int i = 0; i &lt; num_entry_points; i++) {
      if (strcmp(entry_points[i].name, entry_point) == 0) {
        entry_point_fun = entry_points[i].fun;
        break;
      }
    }

    if (entry_point_fun == NULL) {
      fprintf(stderr, &quot;No entry point '%s'.  Select another with --entry-point.  Options are:\n&quot;,
                      entry_point);
      for (int i = 0; i &lt; num_entry_points; i++) {
        fprintf(stderr, &quot;%s\n&quot;, entry_points[i].name);
      }
      return 1;
    }

    if (isatty(fileno(stdin))) {
      fprintf(stderr, &quot;Reading input from TTY.\n&quot;);
      fprintf(stderr, &quot;Send EOF (CTRL-d) after typing all input values.\n&quot;);
    }

    entry_point_fun(ctx);

    if (runtime_file != NULL) {
      fclose(runtime_file);
    }

    char *report = futhark_context_report(ctx);
    fputs(report, stderr);
    free(report);
  }

  futhark_context_free(ctx);
  futhark_context_config_free(cfg);
  return 0;
}|]</span></span><span>
</span><span id="line-496"></span></pre></body></html>