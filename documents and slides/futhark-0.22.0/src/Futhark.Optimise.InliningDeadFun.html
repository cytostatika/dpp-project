<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">-- | This module implements a compiler pass for inlining functions,</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- then removing those that have become dead.</span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Futhark.Optimise.InliningDeadFun</span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Futhark.Optimise.InliningDeadFun.html#inlineAggressively"><span class="hs-identifier">inlineAggressively</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Futhark.Optimise.InliningDeadFun.html#inlineConservatively"><span class="hs-identifier">inlineConservatively</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Futhark.Optimise.InliningDeadFun.html#removeDeadFunctions"><span class="hs-identifier">removeDeadFunctions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">where</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Identity</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Parallel.Strategies</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">partition</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Analysis.CallGraph.html"><span class="hs-identifier">Futhark.Analysis.CallGraph</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.Analysis.SymbolTable.html"><span class="hs-identifier">Futhark.Analysis.SymbolTable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ST</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Builder.html"><span class="hs-identifier">Futhark.Builder</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html"><span class="hs-identifier">Futhark.IR.SOACS</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.Simplify.html"><span class="hs-identifier">Futhark.IR.SOACS.Simplify</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.Simplify.html#simpleSOACS"><span class="hs-identifier">simpleSOACS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Futhark.IR.SOACS.Simplify.html#simplifyConsts"><span class="hs-identifier">simplifyConsts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Futhark.IR.SOACS.Simplify.html#simplifyFun"><span class="hs-identifier">simplifyFun</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Optimise.CSE.html"><span class="hs-identifier">Futhark.Optimise.CSE</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Optimise.Simplify.Rep.html"><span class="hs-identifier">Futhark.Optimise.Simplify.Rep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Optimise.Simplify.Rep.html#addScopeWisdom"><span class="hs-identifier">addScopeWisdom</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Optimise.Simplify.Rep.html#informStms"><span class="hs-identifier">informStms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Pass.html"><span class="hs-identifier">Futhark.Pass</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Transform.CopyPropagate.html"><span class="hs-identifier">Futhark.Transform.CopyPropagate</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Futhark.Transform.CopyPropagate.html#copyPropagateInFun"><span class="hs-identifier">copyPropagateInFun</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><a href="Futhark.Transform.CopyPropagate.html#copyPropagateInProg"><span class="hs-identifier">copyPropagateInProg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Transform.Rename.html"><span class="hs-identifier">Futhark.Transform.Rename</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span id="local-6989586621684432626"><span id="local-6989586621684432628"><span id="local-6989586621684432629"><span class="annot"><a href="Futhark.Optimise.InliningDeadFun.html#parMapM"><span class="hs-identifier hs-type">parMapM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.MonadFreshNames.html#MonadFreshNames"><span class="hs-identifier hs-type">MonadFreshNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684432629"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621684432628"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Futhark.FreshNames.html#VNameSource"><span class="hs-identifier hs-type">VNameSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684432626"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621684432628"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621684432629"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621684432626"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-38"></span><span class="hs-comment">-- The special-casing of [] is quite important here!  If 'as' is</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- empty, then we might otherwise create an empty name source below,</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- which can wreak all kinds of havoc.</span><span>
</span><span id="line-41"></span><span id="parMapM"><span class="annot"><span class="annottext">parMapM :: forall (m :: * -&gt; *) a b.
MonadFreshNames m =&gt;
(a -&gt; State VNameSource b) -&gt; [a] -&gt; m [b]
</span><a href="Futhark.Optimise.InliningDeadFun.html#parMapM"><span class="hs-identifier hs-var hs-var">parMapM</span></a></span></span><span> </span><span class="annot"><span class="annottext">a -&gt; State VNameSource b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[b] -&gt; m [b]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-42"></span><span class="annot"><a href="Futhark.Optimise.InliningDeadFun.html#parMapM"><span class="hs-identifier hs-var">parMapM</span></a></span><span> </span><span id="local-6989586621684432325"><span class="annot"><span class="annottext">a -&gt; State VNameSource b
</span><a href="#local-6989586621684432325"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621684432324"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621684432324"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><span class="annottext">(VNameSource -&gt; ([b], VNameSource)) -&gt; m [b]
forall (m :: * -&gt; *) a.
MonadFreshNames m =&gt;
(VNameSource -&gt; (a, VNameSource)) -&gt; m a
</span><a href="Futhark.MonadFreshNames.html#modifyNameSource"><span class="hs-identifier hs-var">modifyNameSource</span></a></span><span> </span><span class="annot"><span class="annottext">((VNameSource -&gt; ([b], VNameSource)) -&gt; m [b])
-&gt; (VNameSource -&gt; ([b], VNameSource)) -&gt; m [b]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684432322"><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684432322"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684432321"><span class="annot"><span class="annottext">f' :: a -&gt; (b, VNameSource)
</span><a href="#local-6989586621684432321"><span class="hs-identifier hs-var hs-var">f'</span></a></span></span><span> </span><span id="local-6989586621684432320"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684432320"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State VNameSource b -&gt; VNameSource -&gt; (b, VNameSource)
forall s a. State s a -&gt; s -&gt; (a, s)
</span><span class="hs-identifier hs-var">runState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; State VNameSource b
</span><a href="#local-6989586621684432325"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684432320"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684432322"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-45"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621684432318"><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621684432318"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684432317"><span class="annot"><span class="annottext">[VNameSource]
</span><a href="#local-6989586621684432317"><span class="hs-identifier hs-var">srcs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(b, VNameSource)] -&gt; ([b], [VNameSource])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([(b, VNameSource)] -&gt; ([b], [VNameSource]))
-&gt; [(b, VNameSource)] -&gt; ([b], [VNameSource])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Strategy (b, VNameSource)
-&gt; (a -&gt; (b, VNameSource)) -&gt; [a] -&gt; [(b, VNameSource)]
forall b a. Strategy b -&gt; (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">parMap</span></span><span> </span><span class="annot"><span class="annottext">Strategy (b, VNameSource)
forall a. Strategy a
</span><span class="hs-identifier hs-var">rpar</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; (b, VNameSource)
</span><a href="#local-6989586621684432321"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621684432324"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-46"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621684432318"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VNameSource] -&gt; VNameSource
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">[VNameSource]
</span><a href="#local-6989586621684432317"><span class="hs-identifier hs-var">srcs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-comment">-- It is more efficient to shrink the program as soon as possible,</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- rather than wait until it has balooned after full inlining.  This</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- is the inverse rate at which we perform full simplification after</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- inlining.  For the other steps we just do copy propagation.  The</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- simplification rates used have been determined heuristically and</span><span>
</span><span id="line-53"></span><span class="hs-comment">-- are probably not optimal for any given program.</span><span>
</span><span id="line-54"></span><span id="local-6989586621684432603"><span class="annot"><a href="Futhark.Optimise.InliningDeadFun.html#inlineFunctions"><span class="hs-identifier hs-type">inlineFunctions</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><a href="Futhark.MonadFreshNames.html#MonadFreshNames"><span class="hs-identifier hs-type">MonadFreshNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684432603"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><a href="Futhark.Analysis.CallGraph.html#CallGraph"><span class="hs-identifier hs-type">CallGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-60"></span><span>  </span><span class="annot"><a href="#local-6989586621684432603"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-61"></span><span id="inlineFunctions"><span class="annot"><span class="annottext">inlineFunctions :: forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Int -&gt; CallGraph -&gt; Set Name -&gt; Prog SOACS -&gt; m (Prog SOACS)
</span><a href="Futhark.Optimise.InliningDeadFun.html#inlineFunctions"><span class="hs-identifier hs-var hs-var">inlineFunctions</span></a></span></span><span> </span><span id="local-6989586621684432306"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684432306"><span class="hs-identifier hs-var">simplify_rate</span></a></span></span><span> </span><span id="local-6989586621684432305"><span class="annot"><span class="annottext">CallGraph
</span><a href="#local-6989586621684432305"><span class="hs-identifier hs-var">cg</span></a></span></span><span> </span><span id="local-6989586621684432304"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621684432304"><span class="hs-identifier hs-var">what_should_be_inlined</span></a></span></span><span> </span><span id="local-6989586621684432303"><span class="annot"><span class="annottext">Prog SOACS
</span><a href="#local-6989586621684432303"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span> </span><span id="local-6989586621684432301"><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684432301"><span class="hs-identifier hs-var">consts</span></a></span></span><span> </span><span id="local-6989586621684432300"><span class="annot"><span class="annottext">[FunDef SOACS]
</span><a href="#local-6989586621684432300"><span class="hs-identifier hs-var">funs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Prog SOACS
</span><a href="#local-6989586621684432303"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-63"></span><span>      </span><span id="local-6989586621684432290"><span class="annot"><span class="annottext">vtable :: SymbolTable (Wise SOACS)
</span><a href="#local-6989586621684432290"><span class="hs-identifier hs-var hs-var">vtable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scope (Wise SOACS) -&gt; SymbolTable (Wise SOACS)
forall rep. ASTRep rep =&gt; Scope rep -&gt; SymbolTable rep
</span><a href="Futhark.Analysis.SymbolTable.html#fromScope"><span class="hs-identifier hs-var">ST.fromScope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope SOACS -&gt; Scope (Wise SOACS)
forall rep. Scope rep -&gt; Scope (Wise rep)
</span><a href="Futhark.Optimise.Simplify.Rep.html#addScopeWisdom"><span class="hs-identifier hs-var">addScopeWisdom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stms SOACS -&gt; Scope SOACS
forall rep a. Scoped rep a =&gt; a -&gt; Scope rep
</span><a href="Futhark.IR.Prop.Scope.html#scopeOf"><span class="hs-identifier hs-var">scopeOf</span></a></span><span> </span><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684432301"><span class="hs-identifier hs-var">consts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><span class="annottext">(Stms SOACS -&gt; [FunDef SOACS] -&gt; Prog SOACS)
-&gt; (Stms SOACS, [FunDef SOACS]) -&gt; Prog SOACS
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">Stms SOACS -&gt; [FunDef SOACS] -&gt; Prog SOACS
forall rep. Stms rep -&gt; [FunDef rep] -&gt; Prog rep
</span><a href="Futhark.IR.Syntax.html#Prog"><span class="hs-identifier hs-var">Prog</span></a></span><span> </span><span class="annot"><span class="annottext">((Stms SOACS, [FunDef SOACS]) -&gt; Prog SOACS)
-&gt; m (Stms SOACS, [FunDef SOACS]) -&gt; m (Prog SOACS)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Int, SymbolTable (Wise SOACS))
-&gt; (Stms SOACS, [FunDef SOACS])
-&gt; Set Name
-&gt; m (Stms SOACS, [FunDef SOACS])
forall {f :: * -&gt; *}.
MonadFreshNames f =&gt;
(Int, SymbolTable (Wise SOACS))
-&gt; (Stms SOACS, [FunDef SOACS])
-&gt; Set Name
-&gt; f (Stms SOACS, [FunDef SOACS])
</span><a href="#local-6989586621684432285"><span class="hs-identifier hs-var">recurse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SymbolTable (Wise SOACS)
</span><a href="#local-6989586621684432290"><span class="hs-identifier hs-var">vtable</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684432301"><span class="hs-identifier hs-var">consts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FunDef SOACS]
</span><a href="#local-6989586621684432300"><span class="hs-identifier hs-var">funs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621684432304"><span class="hs-identifier hs-var">what_should_be_inlined</span></a></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-67"></span><span>    </span><span id="local-6989586621684432283"><span class="annot"><span class="annottext">fdmap :: [FunDef rep] -&gt; Map Name (FunDef rep)
</span><a href="#local-6989586621684432283"><span class="hs-identifier hs-var hs-var">fdmap</span></a></span></span><span> </span><span id="local-6989586621684432282"><span class="annot"><span class="annottext">[FunDef rep]
</span><a href="#local-6989586621684432282"><span class="hs-identifier hs-var">fds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, FunDef rep)] -&gt; Map Name (FunDef rep)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Name, FunDef rep)] -&gt; Map Name (FunDef rep))
-&gt; [(Name, FunDef rep)] -&gt; Map Name (FunDef rep)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [FunDef rep] -&gt; [(Name, FunDef rep)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FunDef rep -&gt; Name) -&gt; [FunDef rep] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FunDef rep -&gt; Name
forall rep. FunDef rep -&gt; Name
</span><a href="Futhark.IR.Syntax.html#funDefName"><span class="hs-identifier hs-var hs-var">funDefName</span></a></span><span> </span><span class="annot"><span class="annottext">[FunDef rep]
</span><a href="#local-6989586621684432282"><span class="hs-identifier hs-var">fds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FunDef rep]
</span><a href="#local-6989586621684432282"><span class="hs-identifier hs-var">fds</span></a></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span>    </span><span id="local-6989586621684432278"><span class="annot"><span class="annottext">noCallsTo :: Set Name -&gt; Name -&gt; Bool
</span><a href="#local-6989586621684432278"><span class="hs-identifier hs-var hs-var">noCallsTo</span></a></span></span><span> </span><span id="local-6989586621684432277"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621684432277"><span class="hs-identifier hs-var">which</span></a></span></span><span> </span><span id="local-6989586621684432276"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684432276"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">S.null</span></span><span> </span><span class="annot"><span class="annottext">(Set Name -&gt; Bool) -&gt; Set Name -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; CallGraph -&gt; Set Name
</span><a href="Futhark.Analysis.CallGraph.html#allCalledBy"><span class="hs-identifier hs-var">allCalledBy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684432276"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">CallGraph
</span><a href="#local-6989586621684432305"><span class="hs-identifier hs-var">cg</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; Set Name -&gt; Set Name
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`S.intersection`</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621684432277"><span class="hs-identifier hs-var">which</span></a></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span>    </span><span id="local-6989586621684432285"><span class="annot"><span class="annottext">recurse :: (Int, SymbolTable (Wise SOACS))
-&gt; (Stms SOACS, [FunDef SOACS])
-&gt; Set Name
-&gt; f (Stms SOACS, [FunDef SOACS])
</span><a href="#local-6989586621684432285"><span class="hs-identifier hs-var hs-var">recurse</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684432216"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684432216"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684432215"><span class="annot"><span class="annottext">SymbolTable (Wise SOACS)
</span><a href="#local-6989586621684432215"><span class="hs-identifier hs-var">vtable</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684432214"><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684432214"><span class="hs-identifier hs-var">consts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684432213"><span class="annot"><span class="annottext">[FunDef SOACS]
</span><a href="#local-6989586621684432213"><span class="hs-identifier hs-var">funs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684432212"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621684432212"><span class="hs-identifier hs-var">to_inline</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-72"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684432211"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621684432211"><span class="hs-identifier hs-var">to_inline_now</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684432210"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621684432210"><span class="hs-identifier hs-var">to_inline_later</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-73"></span><span>            </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; Set Name -&gt; (Set Name, Set Name)
forall a. (a -&gt; Bool) -&gt; Set a -&gt; (Set a, Set a)
</span><span class="hs-identifier hs-var">S.partition</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Name -&gt; Name -&gt; Bool
</span><a href="#local-6989586621684432278"><span class="hs-identifier hs-var">noCallsTo</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621684432212"><span class="hs-identifier hs-var">to_inline</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621684432212"><span class="hs-identifier hs-var">to_inline</span></a></span><span>
</span><span id="line-74"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621684432208"><span class="annot"><span class="annottext">[FunDef SOACS]
</span><a href="#local-6989586621684432208"><span class="hs-identifier hs-var">dont_inline_in</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684432207"><span class="annot"><span class="annottext">[FunDef SOACS]
</span><a href="#local-6989586621684432207"><span class="hs-identifier hs-var">to_inline_in</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-75"></span><span>            </span><span class="annot"><span class="annottext">(FunDef SOACS -&gt; Bool)
-&gt; [FunDef SOACS] -&gt; ([FunDef SOACS], [FunDef SOACS])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">partition</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Name -&gt; Name -&gt; Bool
</span><a href="#local-6989586621684432278"><span class="hs-identifier hs-var">noCallsTo</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621684432211"><span class="hs-identifier hs-var">to_inline_now</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; (FunDef SOACS -&gt; Name) -&gt; FunDef SOACS -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS -&gt; Name
forall rep. FunDef rep -&gt; Name
</span><a href="Futhark.IR.Syntax.html#funDefName"><span class="hs-identifier hs-var hs-var">funDefName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FunDef SOACS]
</span><a href="#local-6989586621684432213"><span class="hs-identifier hs-var">funs</span></a></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621684432211"><span class="hs-identifier hs-var">to_inline_now</span></a></span><span>
</span><span id="line-78"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Stms SOACS, [FunDef SOACS]) -&gt; f (Stms SOACS, [FunDef SOACS])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684432214"><span class="hs-identifier hs-var">consts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FunDef SOACS]
</span><a href="#local-6989586621684432213"><span class="hs-identifier hs-var">funs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-80"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684432203"><span class="annot"><span class="annottext">inlinemap :: Map Name (FunDef SOACS)
</span><a href="#local-6989586621684432203"><span class="hs-identifier hs-var hs-var">inlinemap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-81"></span><span>                </span><span class="annot"><span class="annottext">[FunDef SOACS] -&gt; Map Name (FunDef SOACS)
forall {rep}. [FunDef rep] -&gt; Map Name (FunDef rep)
</span><a href="#local-6989586621684432283"><span class="hs-identifier hs-var">fdmap</span></a></span><span> </span><span class="annot"><span class="annottext">([FunDef SOACS] -&gt; Map Name (FunDef SOACS))
-&gt; [FunDef SOACS] -&gt; Map Name (FunDef SOACS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(FunDef SOACS -&gt; Bool) -&gt; [FunDef SOACS] -&gt; [FunDef SOACS]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Set Name -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621684432211"><span class="hs-identifier hs-var">to_inline_now</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; (FunDef SOACS -&gt; Name) -&gt; FunDef SOACS -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS -&gt; Name
forall rep. FunDef rep -&gt; Name
</span><a href="Futhark.IR.Syntax.html#funDefName"><span class="hs-identifier hs-var hs-var">funDefName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FunDef SOACS]
</span><a href="#local-6989586621684432208"><span class="hs-identifier hs-var">dont_inline_in</span></a></span><span>
</span><span id="line-82"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621684432201"><span class="annot"><span class="annottext">SymbolTable (Wise SOACS)
</span><a href="#local-6989586621684432201"><span class="hs-identifier hs-var">vtable'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684432200"><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684432200"><span class="hs-identifier hs-var">consts'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-83"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; Set Name -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; CallGraph -&gt; Bool
</span><a href="Futhark.Analysis.CallGraph.html#calledByConsts"><span class="hs-operator hs-var">`calledByConsts`</span></a></span><span> </span><span class="annot"><span class="annottext">CallGraph
</span><a href="#local-6989586621684432305"><span class="hs-identifier hs-var">cg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621684432211"><span class="hs-identifier hs-var">to_inline_now</span></a></span><span>
</span><span id="line-84"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-85"></span><span>                </span><span id="local-6989586621684432197"><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684432197"><span class="hs-identifier hs-var">consts'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-86"></span><span>                  </span><span class="annot"><span class="annottext">Stms SOACS -&gt; f (Stms SOACS)
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Stms SOACS -&gt; m (Stms SOACS)
</span><a href="Futhark.IR.SOACS.Simplify.html#simplifyConsts"><span class="hs-identifier hs-var">simplifyConsts</span></a></span><span> </span><span class="annot"><span class="annottext">(Stms SOACS -&gt; f (Stms SOACS))
-&gt; (Stms SOACS -&gt; Stms SOACS) -&gt; Stms SOACS -&gt; f (Stms SOACS)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Stms SOACS -&gt; Stms SOACS
forall rep.
(ASTRep rep, CanBeAliased (Op rep),
 CSEInOp (OpWithAliases (Op rep))) =&gt;
Bool -&gt; Stms rep -&gt; Stms rep
</span><a href="Futhark.Optimise.CSE.html#performCSEOnStms"><span class="hs-identifier hs-var">performCSEOnStms</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-87"></span><span>                    </span><span class="annot"><span class="annottext">(Stms SOACS -&gt; f (Stms SOACS)) -&gt; f (Stms SOACS) -&gt; f (Stms SOACS)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Map Name (FunDef SOACS) -&gt; Stms SOACS -&gt; f (Stms SOACS)
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Map Name (FunDef SOACS) -&gt; Stms SOACS -&gt; m (Stms SOACS)
</span><a href="Futhark.Optimise.InliningDeadFun.html#inlineInStms"><span class="hs-identifier hs-var">inlineInStms</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (FunDef SOACS)
</span><a href="#local-6989586621684432203"><span class="hs-identifier hs-var">inlinemap</span></a></span><span> </span><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684432214"><span class="hs-identifier hs-var">consts</span></a></span><span>
</span><span id="line-88"></span><span>                </span><span class="annot"><span class="annottext">(SymbolTable (Wise SOACS), Stms SOACS)
-&gt; f (SymbolTable (Wise SOACS), Stms SOACS)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stms (Wise SOACS)
-&gt; SymbolTable (Wise SOACS) -&gt; SymbolTable (Wise SOACS)
forall rep.
(ASTRep rep, IndexOp (Op rep), Aliased rep) =&gt;
Stms rep -&gt; SymbolTable rep -&gt; SymbolTable rep
</span><a href="Futhark.Analysis.SymbolTable.html#insertStms"><span class="hs-identifier hs-var">ST.insertStms</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stms SOACS -&gt; Stms (Wise SOACS)
forall rep. Informing rep =&gt; Stms rep -&gt; Stms (Wise rep)
</span><a href="Futhark.Optimise.Simplify.Rep.html#informStms"><span class="hs-identifier hs-var">informStms</span></a></span><span> </span><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684432197"><span class="hs-identifier hs-var">consts'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SymbolTable (Wise SOACS)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684432197"><span class="hs-identifier hs-var">consts'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(SymbolTable (Wise SOACS), Stms SOACS)
-&gt; f (SymbolTable (Wise SOACS), Stms SOACS)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SymbolTable (Wise SOACS)
</span><a href="#local-6989586621684432215"><span class="hs-identifier hs-var">vtable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684432214"><span class="hs-identifier hs-var">consts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684432150"><span class="annot"><span class="annottext">simplifyFun' :: FunDef SOACS -&gt; m (FunDef SOACS)
</span><a href="#local-6989586621684432150"><span class="hs-identifier hs-var hs-var">simplifyFun'</span></a></span></span><span> </span><span id="local-6989586621684432149"><span class="annot"><span class="annottext">FunDef SOACS
</span><a href="#local-6989586621684432149"><span class="hs-identifier hs-var">fd</span></a></span></span><span>
</span><span id="line-92"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684432216"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`rem`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684432306"><span class="hs-identifier hs-var">simplify_rate</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-93"></span><span>                  </span><span class="annot"><span class="annottext">SimpleOps SOACS
-&gt; SymbolTable (Wise SOACS) -&gt; FunDef SOACS -&gt; m (FunDef SOACS)
forall (m :: * -&gt; *) rep.
(MonadFreshNames m, SimplifiableRep rep) =&gt;
SimpleOps rep
-&gt; SymbolTable (Wise rep) -&gt; FunDef rep -&gt; m (FunDef rep)
</span><a href="Futhark.Transform.CopyPropagate.html#copyPropagateInFun"><span class="hs-identifier hs-var">copyPropagateInFun</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleOps SOACS
</span><a href="Futhark.IR.SOACS.Simplify.html#simpleSOACS"><span class="hs-identifier hs-var">simpleSOACS</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolTable (Wise SOACS)
</span><a href="#local-6989586621684432201"><span class="hs-identifier hs-var">vtable'</span></a></span><span>
</span><span id="line-94"></span><span>                    </span><span class="annot"><span class="annottext">(FunDef SOACS -&gt; m (FunDef SOACS))
-&gt; (FunDef SOACS -&gt; FunDef SOACS)
-&gt; FunDef SOACS
-&gt; m (FunDef SOACS)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; FunDef SOACS -&gt; FunDef SOACS
forall rep.
(ASTRep rep, CanBeAliased (Op rep),
 CSEInOp (OpWithAliases (Op rep))) =&gt;
Bool -&gt; FunDef rep -&gt; FunDef rep
</span><a href="Futhark.Optimise.CSE.html#performCSEOnFunDef"><span class="hs-identifier hs-var">performCSEOnFunDef</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-95"></span><span>                    </span><span class="annot"><span class="annottext">(FunDef SOACS -&gt; m (FunDef SOACS))
-&gt; m (FunDef SOACS) -&gt; m (FunDef SOACS)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">SymbolTable (Wise SOACS) -&gt; FunDef SOACS -&gt; m (FunDef SOACS)
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
SymbolTable (Wise SOACS) -&gt; FunDef SOACS -&gt; m (FunDef SOACS)
</span><a href="Futhark.IR.SOACS.Simplify.html#simplifyFun"><span class="hs-identifier hs-var">simplifyFun</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolTable (Wise SOACS)
</span><a href="#local-6989586621684432201"><span class="hs-identifier hs-var">vtable'</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS
</span><a href="#local-6989586621684432149"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-96"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-97"></span><span>                  </span><span class="annot"><span class="annottext">SimpleOps SOACS
-&gt; SymbolTable (Wise SOACS) -&gt; FunDef SOACS -&gt; m (FunDef SOACS)
forall (m :: * -&gt; *) rep.
(MonadFreshNames m, SimplifiableRep rep) =&gt;
SimpleOps rep
-&gt; SymbolTable (Wise rep) -&gt; FunDef rep -&gt; m (FunDef rep)
</span><a href="Futhark.Transform.CopyPropagate.html#copyPropagateInFun"><span class="hs-identifier hs-var">copyPropagateInFun</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleOps SOACS
</span><a href="Futhark.IR.SOACS.Simplify.html#simpleSOACS"><span class="hs-identifier hs-var">simpleSOACS</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolTable (Wise SOACS)
</span><a href="#local-6989586621684432201"><span class="hs-identifier hs-var">vtable'</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS
</span><a href="#local-6989586621684432149"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span>              </span><span id="local-6989586621684432141"><span class="annot"><span class="annottext">onFun :: FunDef SOACS -&gt; m (FunDef SOACS)
</span><a href="#local-6989586621684432141"><span class="hs-identifier hs-var hs-var">onFun</span></a></span></span><span> </span><span id="local-6989586621684432140"><span class="annot"><span class="annottext">FunDef SOACS
</span><a href="#local-6989586621684432140"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-100"></span><span>                </span><span class="annot"><span class="annottext">FunDef SOACS -&gt; m (FunDef SOACS)
forall {m :: * -&gt; *}.
MonadFreshNames m =&gt;
FunDef SOACS -&gt; m (FunDef SOACS)
</span><a href="#local-6989586621684432150"><span class="hs-identifier hs-var">simplifyFun'</span></a></span><span> </span><span class="annot"><span class="annottext">(FunDef SOACS -&gt; m (FunDef SOACS))
-&gt; (FunDef SOACS -&gt; m (FunDef SOACS))
-&gt; FunDef SOACS
-&gt; m (FunDef SOACS)
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">Map Name (FunDef SOACS) -&gt; FunDef SOACS -&gt; m (FunDef SOACS)
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Map Name (FunDef SOACS) -&gt; FunDef SOACS -&gt; m (FunDef SOACS)
</span><a href="Futhark.Optimise.InliningDeadFun.html#inlineInFunDef"><span class="hs-identifier hs-var">inlineInFunDef</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (FunDef SOACS)
</span><a href="#local-6989586621684432203"><span class="hs-identifier hs-var">inlinemap</span></a></span><span> </span><span class="annot"><span class="annottext">(FunDef SOACS -&gt; m (FunDef SOACS))
-&gt; FunDef SOACS -&gt; m (FunDef SOACS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS
</span><a href="#local-6989586621684432140"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span>          </span><span id="local-6989586621684432137"><span class="annot"><span class="annottext">[FunDef SOACS]
</span><a href="#local-6989586621684432137"><span class="hs-identifier hs-var">to_inline_in'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(FunDef SOACS -&gt; State VNameSource (FunDef SOACS))
-&gt; [FunDef SOACS] -&gt; f [FunDef SOACS]
forall (m :: * -&gt; *) a b.
MonadFreshNames m =&gt;
(a -&gt; State VNameSource b) -&gt; [a] -&gt; m [b]
</span><a href="Futhark.Optimise.InliningDeadFun.html#parMapM"><span class="hs-identifier hs-var">parMapM</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS -&gt; State VNameSource (FunDef SOACS)
forall {m :: * -&gt; *}.
MonadFreshNames m =&gt;
FunDef SOACS -&gt; m (FunDef SOACS)
</span><a href="#local-6989586621684432141"><span class="hs-identifier hs-var">onFun</span></a></span><span> </span><span class="annot"><span class="annottext">[FunDef SOACS]
</span><a href="#local-6989586621684432207"><span class="hs-identifier hs-var">to_inline_in</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span>          </span><span class="annot"><span class="annottext">(Int, SymbolTable (Wise SOACS))
-&gt; (Stms SOACS, [FunDef SOACS])
-&gt; Set Name
-&gt; f (Stms SOACS, [FunDef SOACS])
</span><a href="#local-6989586621684432285"><span class="hs-identifier hs-var">recurse</span></a></span><span>
</span><span id="line-105"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684432216"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SymbolTable (Wise SOACS)
</span><a href="#local-6989586621684432201"><span class="hs-identifier hs-var">vtable'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684432200"><span class="hs-identifier hs-var">consts'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FunDef SOACS]
</span><a href="#local-6989586621684432208"><span class="hs-identifier hs-var">dont_inline_in</span></a></span><span> </span><span class="annot"><span class="annottext">[FunDef SOACS] -&gt; [FunDef SOACS] -&gt; [FunDef SOACS]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[FunDef SOACS]
</span><a href="#local-6989586621684432137"><span class="hs-identifier hs-var">to_inline_in'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>            </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621684432210"><span class="hs-identifier hs-var">to_inline_later</span></a></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="annot"><a href="Futhark.Optimise.InliningDeadFun.html#calledOnce"><span class="hs-identifier hs-type">calledOnce</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Analysis.CallGraph.html#CallGraph"><span class="hs-identifier hs-type">CallGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-110"></span><span id="calledOnce"><span class="annot"><span class="annottext">calledOnce :: CallGraph -&gt; Set Name
</span><a href="Futhark.Optimise.InliningDeadFun.html#calledOnce"><span class="hs-identifier hs-var hs-var">calledOnce</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Set Name
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; Set Name)
-&gt; (CallGraph -&gt; [Name]) -&gt; CallGraph -&gt; Set Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Name, Int) -&gt; Name) -&gt; [(Name, Int)] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Name, Int) -&gt; Name
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">([(Name, Int)] -&gt; [Name])
-&gt; (CallGraph -&gt; [(Name, Int)]) -&gt; CallGraph -&gt; [Name]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Name, Int) -&gt; Bool) -&gt; [(Name, Int)] -&gt; [(Name, Int)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Bool) -&gt; ((Name, Int) -&gt; Int) -&gt; (Name, Int) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name, Int) -&gt; Int
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Name, Int)] -&gt; [(Name, Int)])
-&gt; (CallGraph -&gt; [(Name, Int)]) -&gt; CallGraph -&gt; [(Name, Int)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map Name Int -&gt; [(Name, Int)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map Name Int -&gt; [(Name, Int)])
-&gt; (CallGraph -&gt; Map Name Int) -&gt; CallGraph -&gt; [(Name, Int)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CallGraph -&gt; Map Name Int
</span><a href="Futhark.Analysis.CallGraph.html#numOccurences"><span class="hs-identifier hs-var">numOccurences</span></a></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="annot"><a href="Futhark.Optimise.InliningDeadFun.html#inlineBecauseTiny"><span class="hs-identifier hs-type">inlineBecauseTiny</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-113"></span><span id="inlineBecauseTiny"><span class="annot"><span class="annottext">inlineBecauseTiny :: Prog SOACS -&gt; Set Name
</span><a href="Futhark.Optimise.InliningDeadFun.html#inlineBecauseTiny"><span class="hs-identifier hs-var hs-var">inlineBecauseTiny</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FunDef SOACS -&gt; Set Name) -&gt; [FunDef SOACS] -&gt; Set Name
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS -&gt; Set Name
forall {rep}. FunDef rep -&gt; Set Name
</span><a href="#local-6989586621684432129"><span class="hs-identifier hs-var">onFunDef</span></a></span><span> </span><span class="annot"><span class="annottext">([FunDef SOACS] -&gt; Set Name)
-&gt; (Prog SOACS -&gt; [FunDef SOACS]) -&gt; Prog SOACS -&gt; Set Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Prog SOACS -&gt; [FunDef SOACS]
forall rep. Prog rep -&gt; [FunDef rep]
</span><a href="Futhark.IR.Syntax.html#progFuns"><span class="hs-identifier hs-var hs-var">progFuns</span></a></span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-115"></span><span>    </span><span id="local-6989586621684432129"><span class="annot"><span class="annottext">onFunDef :: FunDef rep -&gt; Set Name
</span><a href="#local-6989586621684432129"><span class="hs-identifier hs-var hs-var">onFunDef</span></a></span></span><span> </span><span id="local-6989586621684432118"><span class="annot"><span class="annottext">FunDef rep
</span><a href="#local-6989586621684432118"><span class="hs-identifier hs-var">fd</span></a></span></span><span>
</span><span id="line-116"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Seq (Stm rep) -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BodyT rep -&gt; Seq (Stm rep)
forall rep. BodyT rep -&gt; Stms rep
</span><a href="Futhark.IR.Syntax.html#bodyStms"><span class="hs-identifier hs-var hs-var">bodyStms</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef rep -&gt; BodyT rep
forall rep. FunDef rep -&gt; BodyT rep
</span><a href="Futhark.IR.Syntax.html#funDefBody"><span class="hs-identifier hs-var hs-var">funDefBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef rep
</span><a href="#local-6989586621684432118"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-117"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Attr
</span><span class="hs-string">&quot;inline&quot;</span></span><span> </span><span class="annot"><span class="annottext">Attr -&gt; Attrs -&gt; Bool
</span><a href="Futhark.IR.Syntax.Core.html#inAttrs"><span class="hs-operator hs-var">`inAttrs`</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef rep -&gt; Attrs
forall rep. FunDef rep -&gt; Attrs
</span><a href="Futhark.IR.Syntax.html#funDefAttrs"><span class="hs-identifier hs-var hs-var">funDefAttrs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef rep
</span><a href="#local-6989586621684432118"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-118"></span><span>        </span><span class="annot"><span class="annottext">Name -&gt; Set Name
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">S.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef rep -&gt; Name
forall rep. FunDef rep -&gt; Name
</span><a href="Futhark.IR.Syntax.html#funDefName"><span class="hs-identifier hs-var hs-var">funDefName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef rep
</span><a href="#local-6989586621684432118"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Name
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-comment">-- Conservative inlining of functions that are called just once, or</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- have #[inline] on them.</span><span>
</span><span id="line-123"></span><span id="local-6989586621684432501"><span class="annot"><a href="Futhark.Optimise.InliningDeadFun.html#consInlineFunctions"><span class="hs-identifier hs-type">consInlineFunctions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.MonadFreshNames.html#MonadFreshNames"><span class="hs-identifier hs-type">MonadFreshNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684432501"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621684432501"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-124"></span><span id="consInlineFunctions"><span class="annot"><span class="annottext">consInlineFunctions :: forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Prog SOACS -&gt; m (Prog SOACS)
</span><a href="Futhark.Optimise.InliningDeadFun.html#consInlineFunctions"><span class="hs-identifier hs-var hs-var">consInlineFunctions</span></a></span></span><span> </span><span id="local-6989586621684432104"><span class="annot"><span class="annottext">Prog SOACS
</span><a href="#local-6989586621684432104"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; CallGraph -&gt; Set Name -&gt; Prog SOACS -&gt; m (Prog SOACS)
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Int -&gt; CallGraph -&gt; Set Name -&gt; Prog SOACS -&gt; m (Prog SOACS)
</span><a href="Futhark.Optimise.InliningDeadFun.html#inlineFunctions"><span class="hs-identifier hs-var">inlineFunctions</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">CallGraph
</span><a href="#local-6989586621684432103"><span class="hs-identifier hs-var">cg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CallGraph -&gt; Set Name
</span><a href="Futhark.Optimise.InliningDeadFun.html#calledOnce"><span class="hs-identifier hs-var">calledOnce</span></a></span><span> </span><span class="annot"><span class="annottext">CallGraph
</span><a href="#local-6989586621684432103"><span class="hs-identifier hs-var">cg</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; Set Name -&gt; Set Name
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Prog SOACS -&gt; Set Name
</span><a href="Futhark.Optimise.InliningDeadFun.html#inlineBecauseTiny"><span class="hs-identifier hs-var">inlineBecauseTiny</span></a></span><span> </span><span class="annot"><span class="annottext">Prog SOACS
</span><a href="#local-6989586621684432104"><span class="hs-identifier hs-var">prog</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Prog SOACS
</span><a href="#local-6989586621684432104"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-127"></span><span>    </span><span id="local-6989586621684432103"><span class="annot"><span class="annottext">cg :: CallGraph
</span><a href="#local-6989586621684432103"><span class="hs-identifier hs-var hs-var">cg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Prog SOACS -&gt; CallGraph
</span><a href="Futhark.Analysis.CallGraph.html#buildCallGraph"><span class="hs-identifier hs-var">buildCallGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Prog SOACS
</span><a href="#local-6989586621684432104"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span id="local-6989586621684432101"><span class="annot"><a href="Futhark.Optimise.InliningDeadFun.html#aggInlineFunctions"><span class="hs-identifier hs-type">aggInlineFunctions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.MonadFreshNames.html#MonadFreshNames"><span class="hs-identifier hs-type">MonadFreshNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684432101"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621684432101"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-130"></span><span id="aggInlineFunctions"><span class="annot"><span class="annottext">aggInlineFunctions :: forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Prog SOACS -&gt; m (Prog SOACS)
</span><a href="Futhark.Optimise.InliningDeadFun.html#aggInlineFunctions"><span class="hs-identifier hs-var hs-var">aggInlineFunctions</span></a></span></span><span> </span><span id="local-6989586621684432096"><span class="annot"><span class="annottext">Prog SOACS
</span><a href="#local-6989586621684432096"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; CallGraph -&gt; Set Name -&gt; Prog SOACS -&gt; m (Prog SOACS)
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Int -&gt; CallGraph -&gt; Set Name -&gt; Prog SOACS -&gt; m (Prog SOACS)
</span><a href="Futhark.Optimise.InliningDeadFun.html#inlineFunctions"><span class="hs-identifier hs-var">inlineFunctions</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">CallGraph
</span><a href="#local-6989586621684432095"><span class="hs-identifier hs-var">cg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; Set Name
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; Set Name) -&gt; [Name] -&gt; Set Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(FunDef SOACS -&gt; Name) -&gt; [FunDef SOACS] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS -&gt; Name
forall rep. FunDef rep -&gt; Name
</span><a href="Futhark.IR.Syntax.html#funDefName"><span class="hs-identifier hs-var hs-var">funDefName</span></a></span><span> </span><span class="annot"><span class="annottext">([FunDef SOACS] -&gt; [Name]) -&gt; [FunDef SOACS] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Prog SOACS -&gt; [FunDef SOACS]
forall rep. Prog rep -&gt; [FunDef rep]
</span><a href="Futhark.IR.Syntax.html#progFuns"><span class="hs-identifier hs-var hs-var">progFuns</span></a></span><span> </span><span class="annot"><span class="annottext">Prog SOACS
</span><a href="#local-6989586621684432096"><span class="hs-identifier hs-var">prog</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Prog SOACS
</span><a href="#local-6989586621684432096"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-133"></span><span>    </span><span id="local-6989586621684432095"><span class="annot"><span class="annottext">cg :: CallGraph
</span><a href="#local-6989586621684432095"><span class="hs-identifier hs-var hs-var">cg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Prog SOACS -&gt; CallGraph
</span><a href="Futhark.Analysis.CallGraph.html#buildCallGraph"><span class="hs-identifier hs-var">buildCallGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Prog SOACS
</span><a href="#local-6989586621684432096"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-comment">-- | @inlineInFunDef constf fdmap caller@ inlines in @calleer@ the</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- functions in @fdmap@ that are called as @constf@. At this point the</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- preconditions are that if @fdmap@ is not empty, and, more</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- importantly, the functions in @fdmap@ do not call any other</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- functions.</span><span>
</span><span id="line-140"></span><span id="local-6989586621684432522"><span class="annot"><a href="Futhark.Optimise.InliningDeadFun.html#inlineInFunDef"><span class="hs-identifier hs-type">inlineInFunDef</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-141"></span><span>  </span><span class="annot"><a href="Futhark.MonadFreshNames.html#MonadFreshNames"><span class="hs-identifier hs-type">MonadFreshNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684432522"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-142"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-143"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-144"></span><span>  </span><span class="annot"><a href="#local-6989586621684432522"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-145"></span><span id="inlineInFunDef"><span class="annot"><span class="annottext">inlineInFunDef :: forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Map Name (FunDef SOACS) -&gt; FunDef SOACS -&gt; m (FunDef SOACS)
</span><a href="Futhark.Optimise.InliningDeadFun.html#inlineInFunDef"><span class="hs-identifier hs-var hs-var">inlineInFunDef</span></a></span></span><span> </span><span id="local-6989586621684432089"><span class="annot"><span class="annottext">Map Name (FunDef SOACS)
</span><a href="#local-6989586621684432089"><span class="hs-identifier hs-var">fdmap</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span> </span><span id="local-6989586621684432087"><span class="annot"><span class="annottext">Maybe EntryPoint
</span><a href="#local-6989586621684432087"><span class="hs-identifier hs-var">entry</span></a></span></span><span> </span><span id="local-6989586621684432086"><span class="annot"><span class="annottext">Attrs
</span><a href="#local-6989586621684432086"><span class="hs-identifier hs-var">attrs</span></a></span></span><span> </span><span id="local-6989586621684432085"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684432085"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621684432084"><span class="annot"><span class="annottext">[RetType SOACS]
</span><a href="#local-6989586621684432084"><span class="hs-identifier hs-var">rtp</span></a></span></span><span> </span><span id="local-6989586621684432083"><span class="annot"><span class="annottext">[FParam SOACS]
</span><a href="#local-6989586621684432083"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621684432082"><span class="annot"><span class="annottext">BodyT SOACS
</span><a href="#local-6989586621684432082"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><span class="annottext">Maybe EntryPoint
-&gt; Attrs
-&gt; Name
-&gt; [RetType SOACS]
-&gt; [FParam SOACS]
-&gt; BodyT SOACS
-&gt; FunDef SOACS
forall rep.
Maybe EntryPoint
-&gt; Attrs
-&gt; Name
-&gt; [RetType rep]
-&gt; [FParam rep]
-&gt; BodyT rep
-&gt; FunDef rep
</span><a href="Futhark.IR.Syntax.html#FunDef"><span class="hs-identifier hs-var">FunDef</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe EntryPoint
</span><a href="#local-6989586621684432087"><span class="hs-identifier hs-var">entry</span></a></span><span> </span><span class="annot"><span class="annottext">Attrs
</span><a href="#local-6989586621684432086"><span class="hs-identifier hs-var">attrs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684432085"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[RetType SOACS]
</span><a href="#local-6989586621684432084"><span class="hs-identifier hs-var">rtp</span></a></span><span> </span><span class="annot"><span class="annottext">[FParam SOACS]
</span><a href="#local-6989586621684432083"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">(BodyT SOACS -&gt; FunDef SOACS)
-&gt; m (BodyT SOACS) -&gt; m (FunDef SOACS)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map Name (FunDef SOACS) -&gt; BodyT SOACS -&gt; m (BodyT SOACS)
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Map Name (FunDef SOACS) -&gt; BodyT SOACS -&gt; m (BodyT SOACS)
</span><a href="Futhark.Optimise.InliningDeadFun.html#inlineInBody"><span class="hs-identifier hs-var">inlineInBody</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (FunDef SOACS)
</span><a href="#local-6989586621684432089"><span class="hs-identifier hs-var">fdmap</span></a></span><span> </span><span class="annot"><span class="annottext">BodyT SOACS
</span><a href="#local-6989586621684432082"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span id="local-6989586621684432490"><span id="local-6989586621684432492"><span class="annot"><a href="Futhark.Optimise.InliningDeadFun.html#inlineFunction"><span class="hs-identifier hs-type">inlineFunction</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-149"></span><span>  </span><span class="annot"><a href="Futhark.MonadFreshNames.html#MonadFreshNames"><span class="hs-identifier hs-type">MonadFreshNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684432492"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><a href="Futhark.IR.SOACS.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-151"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.html#StmAux"><span class="hs-identifier hs-type">StmAux</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684432490"><span class="hs-identifier hs-type">dec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Diet"><span class="hs-identifier hs-type">Diet</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#Safety"><span class="hs-identifier hs-type">Safety</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-154"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-155"></span><span>  </span><span class="annot"><a href="#local-6989586621684432492"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Stms"><span class="hs-identifier hs-type">Stms</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-156"></span><span id="inlineFunction"><span class="annot"><span class="annottext">inlineFunction :: forall (m :: * -&gt; *) dec.
MonadFreshNames m =&gt;
Pat
-&gt; StmAux dec
-&gt; [(SubExp, Diet)]
-&gt; (Safety, SrcLoc, [SrcLoc])
-&gt; FunDef SOACS
-&gt; m (Stms SOACS)
</span><a href="Futhark.Optimise.InliningDeadFun.html#inlineFunction"><span class="hs-identifier hs-var hs-var">inlineFunction</span></a></span></span><span> </span><span id="local-6989586621684432045"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684432045"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684432044"><span class="annot"><span class="annottext">StmAux dec
</span><a href="#local-6989586621684432044"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span id="local-6989586621684432043"><span class="annot"><span class="annottext">[(SubExp, Diet)]
</span><a href="#local-6989586621684432043"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684432042"><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621684432042"><span class="hs-identifier hs-var">safety</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684432041"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684432041"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684432040"><span class="annot"><span class="annottext">[SrcLoc]
</span><a href="#local-6989586621684432040"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684432039"><span class="annot"><span class="annottext">FunDef SOACS
</span><a href="#local-6989586621684432039"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.html#Body"><span class="hs-identifier hs-type">Body</span></a></span><span> </span><span class="annot"><span class="annottext">BodyDec SOACS
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684432037"><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684432037"><span class="hs-identifier hs-var">stms</span></a></span></span><span> </span><span id="local-6989586621684432036"><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684432036"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><span class="annottext">BodyT SOACS -&gt; m (BodyT SOACS)
forall rep (m :: * -&gt; *).
(Renameable rep, MonadFreshNames m) =&gt;
Body rep -&gt; m (Body rep)
</span><a href="Futhark.Transform.Rename.html#renameBody"><span class="hs-identifier hs-var">renameBody</span></a></span><span> </span><span class="annot"><span class="annottext">(BodyT SOACS -&gt; m (BodyT SOACS)) -&gt; BodyT SOACS -&gt; m (BodyT SOACS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Stms SOACS -&gt; Result -&gt; BodyT SOACS
forall rep. Buildable rep =&gt; Stms rep -&gt; Result -&gt; Body rep
</span><a href="Futhark.Builder.Class.html#mkBody"><span class="hs-identifier hs-var">mkBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684432033"><span class="hs-identifier hs-var">param_stms</span></a></span><span> </span><span class="annot"><span class="annottext">Stms SOACS -&gt; Stms SOACS -&gt; Stms SOACS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684432032"><span class="hs-identifier hs-var">body_stms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BodyT SOACS -&gt; Result
forall rep. BodyT rep -&gt; Result
</span><a href="Futhark.IR.Syntax.html#bodyResult"><span class="hs-identifier hs-var hs-var">bodyResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef SOACS -&gt; BodyT SOACS
forall rep. FunDef rep -&gt; BodyT rep
</span><a href="Futhark.IR.Syntax.html#funDefBody"><span class="hs-identifier hs-var hs-var">funDefBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS
</span><a href="#local-6989586621684432039"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>  </span><span class="annot"><span class="annottext">Stms SOACS -&gt; m (Stms SOACS)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Stms SOACS -&gt; m (Stms SOACS)) -&gt; Stms SOACS -&gt; m (Stms SOACS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684432037"><span class="hs-identifier hs-var">stms</span></a></span><span> </span><span class="annot"><span class="annottext">Stms SOACS -&gt; Stms SOACS -&gt; Stms SOACS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Stm SOACS] -&gt; Stms SOACS
forall rep. [Stm rep] -&gt; Stms rep
</span><a href="Futhark.IR.Syntax.html#stmsFromList"><span class="hs-identifier hs-var">stmsFromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ident -&gt; SubExpRes -&gt; Stm SOACS)
-&gt; [Ident] -&gt; Result -&gt; [Stm SOACS]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; SubExpRes -&gt; Stm SOACS
forall {rep}. Buildable rep =&gt; Ident -&gt; SubExpRes -&gt; Stm rep
</span><a href="#local-6989586621684432028"><span class="hs-identifier hs-var">bindSubExpRes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatT Type -&gt; [Ident]
forall dec. Typed dec =&gt; PatT dec -&gt; [Ident]
</span><a href="Futhark.IR.Prop.Patterns.html#patIdents"><span class="hs-identifier hs-var">patIdents</span></a></span><span> </span><span class="annot"><span class="annottext">PatT Type
Pat
</span><a href="#local-6989586621684432045"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684432036"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-161"></span><span>    </span><span id="local-6989586621684432033"><span class="annot"><span class="annottext">param_stms :: Stms SOACS
</span><a href="#local-6989586621684432033"><span class="hs-identifier hs-var hs-var">param_stms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-162"></span><span>      </span><span class="annot"><span class="annottext">[Stm SOACS] -&gt; Stms SOACS
forall rep. [Stm rep] -&gt; Stms rep
</span><a href="Futhark.IR.Syntax.html#stmsFromList"><span class="hs-identifier hs-var">stmsFromList</span></a></span><span> </span><span class="annot"><span class="annottext">([Stm SOACS] -&gt; Stms SOACS) -&gt; [Stm SOACS] -&gt; Stms SOACS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-163"></span><span>        </span><span class="annot"><span class="annottext">Certs -&gt; Stm SOACS -&gt; Stm SOACS
forall rep. Certs -&gt; Stm rep -&gt; Stm rep
</span><a href="Futhark.IR.Prop.html#certify"><span class="hs-identifier hs-var">certify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StmAux dec -&gt; Certs
forall dec. StmAux dec -&gt; Certs
</span><a href="Futhark.IR.Syntax.html#stmAuxCerts"><span class="hs-identifier hs-var hs-var">stmAuxCerts</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux dec
</span><a href="#local-6989586621684432044"><span class="hs-identifier hs-var">aux</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>          </span><span class="annot"><span class="annottext">(Stm SOACS -&gt; Stm SOACS) -&gt; [Stm SOACS] -&gt; [Stm SOACS]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Ident -&gt; SubExp -&gt; Stm SOACS)
-&gt; [Ident] -&gt; [SubExp] -&gt; [Stm SOACS]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; SubExp -&gt; Stm SOACS
forall {rep}. Buildable rep =&gt; Ident -&gt; SubExp -&gt; Stm rep
</span><a href="#local-6989586621684432019"><span class="hs-identifier hs-var">bindSubExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Param DeclType -&gt; Ident) -&gt; [Param DeclType] -&gt; [Ident]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Param DeclType -&gt; Ident
forall dec. Typed dec =&gt; Param dec -&gt; Ident
</span><a href="Futhark.IR.Prop.Patterns.html#paramIdent"><span class="hs-identifier hs-var">paramIdent</span></a></span><span> </span><span class="annot"><span class="annottext">([Param DeclType] -&gt; [Ident]) -&gt; [Param DeclType] -&gt; [Ident]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS -&gt; [FParam SOACS]
forall rep. FunDef rep -&gt; [FParam rep]
</span><a href="Futhark.IR.Syntax.html#funDefParams"><span class="hs-identifier hs-var hs-var">funDefParams</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS
</span><a href="#local-6989586621684432039"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((SubExp, Diet) -&gt; SubExp) -&gt; [(SubExp, Diet)] -&gt; [SubExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(SubExp, Diet) -&gt; SubExp
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(SubExp, Diet)]
</span><a href="#local-6989586621684432043"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span>    </span><span id="local-6989586621684432032"><span class="annot"><span class="annottext">body_stms :: Stms SOACS
</span><a href="#local-6989586621684432032"><span class="hs-identifier hs-var hs-var">body_stms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-167"></span><span>      </span><span class="annot"><span class="annottext">Attrs -&gt; Safety -&gt; [SrcLoc] -&gt; Stms SOACS -&gt; Stms SOACS
</span><a href="Futhark.Optimise.InliningDeadFun.html#addLocations"><span class="hs-identifier hs-var">addLocations</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StmAux dec -&gt; Attrs
forall dec. StmAux dec -&gt; Attrs
</span><a href="Futhark.IR.Syntax.html#stmAuxAttrs"><span class="hs-identifier hs-var hs-var">stmAuxAttrs</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux dec
</span><a href="#local-6989586621684432044"><span class="hs-identifier hs-var">aux</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621684432042"><span class="hs-identifier hs-var">safety</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SrcLoc -&gt; Bool) -&gt; [SrcLoc] -&gt; [SrcLoc]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Bool
</span><a href="#local-6989586621684432014"><span class="hs-identifier hs-var">notmempty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684432041"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; [SrcLoc] -&gt; [SrcLoc]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[SrcLoc]
</span><a href="#local-6989586621684432040"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Stms SOACS -&gt; Stms SOACS) -&gt; Stms SOACS -&gt; Stms SOACS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-168"></span><span>        </span><span class="annot"><span class="annottext">BodyT SOACS -&gt; Stms SOACS
forall rep. BodyT rep -&gt; Stms rep
</span><a href="Futhark.IR.Syntax.html#bodyStms"><span class="hs-identifier hs-var hs-var">bodyStms</span></a></span><span> </span><span class="annot"><span class="annottext">(BodyT SOACS -&gt; Stms SOACS) -&gt; BodyT SOACS -&gt; Stms SOACS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS -&gt; BodyT SOACS
forall rep. FunDef rep -&gt; BodyT rep
</span><a href="Futhark.IR.Syntax.html#funDefBody"><span class="hs-identifier hs-var hs-var">funDefBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS
</span><a href="#local-6989586621684432039"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-comment">-- Note that the sizes of arrays may not be correct at this</span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-comment">-- point - it is crucial that we run copy propagation before</span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-comment">-- the type checker sees this!</span><span>
</span><span id="line-173"></span><span>    </span><span id="local-6989586621684432019"><span class="annot"><span class="annottext">bindSubExp :: Ident -&gt; SubExp -&gt; Stm rep
</span><a href="#local-6989586621684432019"><span class="hs-identifier hs-var hs-var">bindSubExp</span></a></span></span><span> </span><span id="local-6989586621684432011"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621684432011"><span class="hs-identifier hs-var">ident</span></a></span></span><span> </span><span id="local-6989586621684432010"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684432010"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-174"></span><span>      </span><span class="annot"><span class="annottext">[Ident] -&gt; Exp rep -&gt; Stm rep
forall rep. Buildable rep =&gt; [Ident] -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.Builder.Class.html#mkLet"><span class="hs-identifier hs-var">mkLet</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621684432011"><span class="hs-identifier hs-var">ident</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Exp rep -&gt; Stm rep) -&gt; Exp rep -&gt; Stm rep
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; Exp rep
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; Exp rep) -&gt; BasicOp -&gt; Exp rep
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#SubExp"><span class="hs-identifier hs-var">SubExp</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684432010"><span class="hs-identifier hs-var">se</span></a></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>    </span><span id="local-6989586621684432028"><span class="annot"><span class="annottext">bindSubExpRes :: Ident -&gt; SubExpRes -&gt; Stm rep
</span><a href="#local-6989586621684432028"><span class="hs-identifier hs-var hs-var">bindSubExpRes</span></a></span></span><span> </span><span id="local-6989586621684432004"><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621684432004"><span class="hs-identifier hs-var">ident</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#SubExpRes"><span class="hs-identifier hs-type">SubExpRes</span></a></span><span> </span><span id="local-6989586621684432002"><span class="annot"><span class="annottext">Certs
</span><a href="#local-6989586621684432002"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621684432001"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684432001"><span class="hs-identifier hs-var">se</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-177"></span><span>      </span><span class="annot"><span class="annottext">Certs -&gt; Stm rep -&gt; Stm rep
forall rep. Certs -&gt; Stm rep -&gt; Stm rep
</span><a href="Futhark.IR.Prop.html#certify"><span class="hs-identifier hs-var">certify</span></a></span><span> </span><span class="annot"><span class="annottext">Certs
</span><a href="#local-6989586621684432002"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm rep -&gt; Stm rep) -&gt; Stm rep -&gt; Stm rep
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ident -&gt; SubExp -&gt; Stm rep
forall {rep}. Buildable rep =&gt; Ident -&gt; SubExp -&gt; Stm rep
</span><a href="#local-6989586621684432019"><span class="hs-identifier hs-var">bindSubExp</span></a></span><span> </span><span class="annot"><span class="annottext">Ident
</span><a href="#local-6989586621684432004"><span class="hs-identifier hs-var">ident</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684432001"><span class="hs-identifier hs-var">se</span></a></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span>    </span><span id="local-6989586621684432014"><span class="annot"><span class="annottext">notmempty :: SrcLoc -&gt; Bool
</span><a href="#local-6989586621684432014"><span class="hs-identifier hs-var hs-var">notmempty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Loc -&gt; Loc -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Loc
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Loc -&gt; Bool) -&gt; (SrcLoc -&gt; Loc) -&gt; SrcLoc -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Loc
forall a. Located a =&gt; a -&gt; Loc
</span><span class="hs-identifier hs-var">locOf</span></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span id="local-6989586621684432538"><span class="annot"><a href="Futhark.Optimise.InliningDeadFun.html#inlineInStms"><span class="hs-identifier hs-type">inlineInStms</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><a href="Futhark.MonadFreshNames.html#MonadFreshNames"><span class="hs-identifier hs-type">MonadFreshNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684432538"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-183"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.html#Stms"><span class="hs-identifier hs-type">Stms</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-185"></span><span>  </span><span class="annot"><a href="#local-6989586621684432538"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Stms"><span class="hs-identifier hs-type">Stms</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-186"></span><span id="inlineInStms"><span class="annot"><span class="annottext">inlineInStms :: forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Map Name (FunDef SOACS) -&gt; Stms SOACS -&gt; m (Stms SOACS)
</span><a href="Futhark.Optimise.InliningDeadFun.html#inlineInStms"><span class="hs-identifier hs-var hs-var">inlineInStms</span></a></span></span><span> </span><span id="local-6989586621684431986"><span class="annot"><span class="annottext">Map Name (FunDef SOACS)
</span><a href="#local-6989586621684431986"><span class="hs-identifier hs-var">fdmap</span></a></span></span><span> </span><span id="local-6989586621684431985"><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684431985"><span class="hs-identifier hs-var">stms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><span class="annottext">BodyT SOACS -&gt; Stms SOACS
forall rep. BodyT rep -&gt; Stms rep
</span><a href="Futhark.IR.Syntax.html#bodyStms"><span class="hs-identifier hs-var hs-var">bodyStms</span></a></span><span> </span><span class="annot"><span class="annottext">(BodyT SOACS -&gt; Stms SOACS) -&gt; m (BodyT SOACS) -&gt; m (Stms SOACS)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map Name (FunDef SOACS) -&gt; BodyT SOACS -&gt; m (BodyT SOACS)
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Map Name (FunDef SOACS) -&gt; BodyT SOACS -&gt; m (BodyT SOACS)
</span><a href="Futhark.Optimise.InliningDeadFun.html#inlineInBody"><span class="hs-identifier hs-var">inlineInBody</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (FunDef SOACS)
</span><a href="#local-6989586621684431986"><span class="hs-identifier hs-var">fdmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stms SOACS -&gt; Result -&gt; BodyT SOACS
forall rep. Buildable rep =&gt; Stms rep -&gt; Result -&gt; Body rep
</span><a href="Futhark.Builder.Class.html#mkBody"><span class="hs-identifier hs-var">mkBody</span></a></span><span> </span><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684431985"><span class="hs-identifier hs-var">stms</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span id="local-6989586621684432493"><span class="annot"><a href="Futhark.Optimise.InliningDeadFun.html#inlineInBody"><span class="hs-identifier hs-type">inlineInBody</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-190"></span><span>  </span><span class="annot"><a href="Futhark.MonadFreshNames.html#MonadFreshNames"><span class="hs-identifier hs-type">MonadFreshNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684432493"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-191"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-192"></span><span>  </span><span class="annot"><a href="Futhark.IR.SOACS.html#Body"><span class="hs-identifier hs-type">Body</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-193"></span><span>  </span><span class="annot"><a href="#local-6989586621684432493"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#Body"><span class="hs-identifier hs-type">Body</span></a></span></span><span>
</span><span id="line-194"></span><span id="inlineInBody"><span class="annot"><span class="annottext">inlineInBody :: forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Map Name (FunDef SOACS) -&gt; BodyT SOACS -&gt; m (BodyT SOACS)
</span><a href="Futhark.Optimise.InliningDeadFun.html#inlineInBody"><span class="hs-identifier hs-var hs-var">inlineInBody</span></a></span></span><span> </span><span id="local-6989586621684431979"><span class="annot"><span class="annottext">Map Name (FunDef SOACS)
</span><a href="#local-6989586621684431979"><span class="hs-identifier hs-var">fdmap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BodyT SOACS -&gt; m (BodyT SOACS)
</span><a href="#local-6989586621684431978"><span class="hs-identifier hs-var">onBody</span></a></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621684431948"><span class="annot"><span class="annottext">inline :: [Stm SOACS] -&gt; m (Stms SOACS)
</span><a href="#local-6989586621684431948"><span class="hs-identifier hs-var hs-var">inline</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621684431946"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684431946"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684431945"><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684431945"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621684431943"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684431943"><span class="hs-identifier hs-var">fname</span></a></span></span><span> </span><span id="local-6989586621684431942"><span class="annot"><span class="annottext">[(SubExp, Diet)]
</span><a href="#local-6989586621684431942"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="annot"><span class="annottext">[RetType SOACS]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684431941"><span class="annot"><span class="annottext">(Safety, SrcLoc, [SrcLoc])
</span><a href="#local-6989586621684431941"><span class="hs-identifier hs-var">what</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684431940"><span class="annot"><span class="annottext">[Stm SOACS]
</span><a href="#local-6989586621684431940"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684431939"><span class="annot"><span class="annottext">FunDef SOACS
</span><a href="#local-6989586621684431939"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Map Name (FunDef SOACS) -&gt; Maybe (FunDef SOACS)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684431943"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (FunDef SOACS)
</span><a href="#local-6989586621684431979"><span class="hs-identifier hs-var">fdmap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-198"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Attr
</span><span class="hs-string">&quot;noinline&quot;</span></span><span> </span><span class="annot"><span class="annottext">Attr -&gt; Attrs -&gt; Bool
</span><a href="Futhark.IR.Syntax.Core.html#inAttrs"><span class="hs-operator hs-var">`inAttrs`</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS -&gt; Attrs
forall rep. FunDef rep -&gt; Attrs
</span><a href="Futhark.IR.Syntax.html#funDefAttrs"><span class="hs-identifier hs-var hs-var">funDefAttrs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS
</span><a href="#local-6989586621684431939"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-199"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Attr
</span><span class="hs-string">&quot;noinline&quot;</span></span><span> </span><span class="annot"><span class="annottext">Attr -&gt; Attrs -&gt; Bool
</span><a href="Futhark.IR.Syntax.Core.html#inAttrs"><span class="hs-operator hs-var">`inAttrs`</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux () -&gt; Attrs
forall dec. StmAux dec -&gt; Attrs
</span><a href="Futhark.IR.Syntax.html#stmAuxAttrs"><span class="hs-identifier hs-var hs-var">stmAuxAttrs</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684431945"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-200"></span><span>        </span><span class="annot"><span class="annottext">Stms SOACS -&gt; Stms SOACS -&gt; Stms SOACS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">(Stms SOACS -&gt; Stms SOACS -&gt; Stms SOACS)
-&gt; m (Stms SOACS) -&gt; m (Stms SOACS -&gt; Stms SOACS)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pat
-&gt; StmAux ()
-&gt; [(SubExp, Diet)]
-&gt; (Safety, SrcLoc, [SrcLoc])
-&gt; FunDef SOACS
-&gt; m (Stms SOACS)
forall (m :: * -&gt; *) dec.
MonadFreshNames m =&gt;
Pat
-&gt; StmAux dec
-&gt; [(SubExp, Diet)]
-&gt; (Safety, SrcLoc, [SrcLoc])
-&gt; FunDef SOACS
-&gt; m (Stms SOACS)
</span><a href="Futhark.Optimise.InliningDeadFun.html#inlineFunction"><span class="hs-identifier hs-var">inlineFunction</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684431946"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684431945"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">[(SubExp, Diet)]
</span><a href="#local-6989586621684431942"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">(Safety, SrcLoc, [SrcLoc])
</span><a href="#local-6989586621684431941"><span class="hs-identifier hs-var">what</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS
</span><a href="#local-6989586621684431939"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stms SOACS -&gt; Stms SOACS) -&gt; m (Stms SOACS) -&gt; m (Stms SOACS)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Stm SOACS] -&gt; m (Stms SOACS)
</span><a href="#local-6989586621684431948"><span class="hs-identifier hs-var">inline</span></a></span><span> </span><span class="annot"><span class="annottext">[Stm SOACS]
</span><a href="#local-6989586621684431940"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-201"></span><span>    </span><span class="annot"><a href="#local-6989586621684431948"><span class="hs-identifier hs-var">inline</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684431936"><span class="annot"><span class="annottext">stm :: Stm SOACS
</span><a href="#local-6989586621684431936"><span class="hs-identifier hs-var">stm</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-type">BasicOp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684431935"><span class="annot"><span class="annottext">[Stm SOACS]
</span><a href="#local-6989586621684431935"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-202"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stm SOACS -&gt; Stms SOACS
forall rep. Stm rep -&gt; Stms rep
</span><a href="Futhark.IR.Syntax.html#oneStm"><span class="hs-identifier hs-var">oneStm</span></a></span><span> </span><span class="annot"><span class="annottext">Stm SOACS
</span><a href="#local-6989586621684431936"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">Stms SOACS -&gt; Stms SOACS -&gt; Stms SOACS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Stms SOACS -&gt; Stms SOACS) -&gt; m (Stms SOACS) -&gt; m (Stms SOACS)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Stm SOACS] -&gt; m (Stms SOACS)
</span><a href="#local-6989586621684431948"><span class="hs-identifier hs-var">inline</span></a></span><span> </span><span class="annot"><span class="annottext">[Stm SOACS]
</span><a href="#local-6989586621684431935"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><a href="#local-6989586621684431948"><span class="hs-identifier hs-var">inline</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684431933"><span class="annot"><span class="annottext">Stm SOACS
</span><a href="#local-6989586621684431933"><span class="hs-identifier hs-var">stm</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684431932"><span class="annot"><span class="annottext">[Stm SOACS]
</span><a href="#local-6989586621684431932"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-204"></span><span>      </span><span class="annot"><span class="annottext">Stms SOACS -&gt; Stms SOACS -&gt; Stms SOACS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">(Stms SOACS -&gt; Stms SOACS -&gt; Stms SOACS)
-&gt; m (Stms SOACS) -&gt; m (Stms SOACS -&gt; Stms SOACS)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stm SOACS -&gt; Stms SOACS
forall rep. Stm rep -&gt; Stms rep
</span><a href="Futhark.IR.Syntax.html#oneStm"><span class="hs-identifier hs-var">oneStm</span></a></span><span> </span><span class="annot"><span class="annottext">(Stm SOACS -&gt; Stms SOACS) -&gt; m (Stm SOACS) -&gt; m (Stms SOACS)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Stm SOACS -&gt; m (Stm SOACS)
</span><a href="#local-6989586621684431931"><span class="hs-identifier hs-var">onStm</span></a></span><span> </span><span class="annot"><span class="annottext">Stm SOACS
</span><a href="#local-6989586621684431933"><span class="hs-identifier hs-var">stm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Stms SOACS -&gt; Stms SOACS) -&gt; m (Stms SOACS) -&gt; m (Stms SOACS)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Stm SOACS] -&gt; m (Stms SOACS)
</span><a href="#local-6989586621684431948"><span class="hs-identifier hs-var">inline</span></a></span><span> </span><span class="annot"><span class="annottext">[Stm SOACS]
</span><a href="#local-6989586621684431932"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><a href="#local-6989586621684431948"><span class="hs-identifier hs-var">inline</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-206"></span><span>      </span><span class="annot"><span class="annottext">Stms SOACS -&gt; m (Stms SOACS)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Stms SOACS
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span>    </span><span id="local-6989586621684431978"><span class="annot"><span class="annottext">onBody :: BodyT SOACS -&gt; m (BodyT SOACS)
</span><a href="#local-6989586621684431978"><span class="hs-identifier hs-var hs-var">onBody</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Body"><span class="hs-identifier hs-type">Body</span></a></span><span> </span><span id="local-6989586621684431930"><span class="annot"><span class="annottext">BodyDec SOACS
</span><a href="#local-6989586621684431930"><span class="hs-identifier hs-var">dec</span></a></span></span><span> </span><span id="local-6989586621684431929"><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684431929"><span class="hs-identifier hs-var">stms</span></a></span></span><span> </span><span id="local-6989586621684431928"><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684431928"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-209"></span><span>      </span><span class="annot"><span class="annottext">BodyDec SOACS -&gt; Stms SOACS -&gt; Result -&gt; BodyT SOACS
forall rep. BodyDec rep -&gt; Stms rep -&gt; Result -&gt; BodyT rep
</span><a href="Futhark.IR.Syntax.html#Body"><span class="hs-identifier hs-var">Body</span></a></span><span> </span><span class="annot"><span class="annottext">BodyDec SOACS
</span><a href="#local-6989586621684431930"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">(Stms SOACS -&gt; Result -&gt; BodyT SOACS)
-&gt; m (Stms SOACS) -&gt; m (Result -&gt; BodyT SOACS)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Stm SOACS] -&gt; m (Stms SOACS)
</span><a href="#local-6989586621684431948"><span class="hs-identifier hs-var">inline</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stms SOACS -&gt; [Stm SOACS]
forall rep. Stms rep -&gt; [Stm rep]
</span><a href="Futhark.IR.Syntax.html#stmsToList"><span class="hs-identifier hs-var">stmsToList</span></a></span><span> </span><span class="annot"><span class="annottext">Stms SOACS
</span><a href="#local-6989586621684431929"><span class="hs-identifier hs-var">stms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Result -&gt; BodyT SOACS) -&gt; m Result -&gt; m (BodyT SOACS)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Result -&gt; m Result
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Result
</span><a href="#local-6989586621684431928"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-210"></span><span>    </span><span id="local-6989586621684431931"><span class="annot"><span class="annottext">onStm :: Stm SOACS -&gt; m (Stm SOACS)
</span><a href="#local-6989586621684431931"><span class="hs-identifier hs-var hs-var">onStm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621684431926"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684431926"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684431925"><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684431925"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span id="local-6989586621684431924"><span class="annot"><span class="annottext">ExpT SOACS
</span><a href="#local-6989586621684431924"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; ExpT SOACS -&gt; Stm SOACS
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684431926"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684431925"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(ExpT SOACS -&gt; Stm SOACS) -&gt; m (ExpT SOACS) -&gt; m (Stm SOACS)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Mapper SOACS SOACS m -&gt; ExpT SOACS -&gt; m (ExpT SOACS)
forall (m :: * -&gt; *) frep trep.
(Applicative m, Monad m) =&gt;
Mapper frep trep m -&gt; Exp frep -&gt; m (Exp trep)
</span><a href="Futhark.IR.Traversals.html#mapExpM"><span class="hs-identifier hs-var">mapExpM</span></a></span><span> </span><span class="annot"><span class="annottext">Mapper SOACS SOACS m
</span><a href="#local-6989586621684431922"><span class="hs-identifier hs-var">inliner</span></a></span><span> </span><span class="annot"><span class="annottext">ExpT SOACS
</span><a href="#local-6989586621684431924"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span>    </span><span id="local-6989586621684431922"><span class="annot"><span class="annottext">inliner :: Mapper SOACS SOACS m
</span><a href="#local-6989586621684431922"><span class="hs-identifier hs-var hs-var">inliner</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-213"></span><span>      </span><span class="annot"><span class="annottext">Mapper SOACS SOACS m
forall (m :: * -&gt; *) rep. Monad m =&gt; Mapper rep rep m
</span><a href="Futhark.IR.Traversals.html#identityMapper"><span class="hs-identifier hs-var">identityMapper</span></a></span><span>
</span><span id="line-214"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mapOnBody :: Scope SOACS -&gt; BodyT SOACS -&gt; m (BodyT SOACS)
</span><a href="Futhark.IR.Traversals.html#mapOnBody"><span class="hs-identifier hs-var">mapOnBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BodyT SOACS -&gt; m (BodyT SOACS))
-&gt; Scope SOACS -&gt; BodyT SOACS -&gt; m (BodyT SOACS)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">BodyT SOACS -&gt; m (BodyT SOACS)
</span><a href="#local-6989586621684431978"><span class="hs-identifier hs-var">onBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-215"></span><span>          </span><span class="annot"><span class="annottext">mapOnOp :: Op SOACS -&gt; m (Op SOACS)
</span><a href="#local-6989586621684431918"><span class="hs-identifier hs-var">mapOnOp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Op SOACS -&gt; m (Op SOACS)
SOAC SOACS -&gt; m (SOAC SOACS)
</span><a href="#local-6989586621684431917"><span class="hs-identifier hs-var">onSOAC</span></a></span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span>    </span><span id="local-6989586621684431917"><span class="annot"><span class="annottext">onSOAC :: SOAC SOACS -&gt; m (SOAC SOACS)
</span><a href="#local-6989586621684431917"><span class="hs-identifier hs-var hs-var">onSOAC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-219"></span><span>      </span><span class="annot"><span class="annottext">SOACMapper SOACS SOACS m -&gt; SOAC SOACS -&gt; m (SOAC SOACS)
forall (m :: * -&gt; *) frep trep.
(Applicative m, Monad m) =&gt;
SOACMapper frep trep m -&gt; SOAC frep -&gt; m (SOAC trep)
</span><a href="Futhark.IR.SOACS.SOAC.html#mapSOACM"><span class="hs-identifier hs-var">mapSOACM</span></a></span><span> </span><span class="annot"><span class="annottext">SOACMapper Any Any m
forall (m :: * -&gt; *) rep. Monad m =&gt; SOACMapper rep rep m
</span><a href="Futhark.IR.SOACS.SOAC.html#identitySOACMapper"><span class="hs-identifier hs-var">identitySOACMapper</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">mapOnSOACLambda :: Lambda SOACS -&gt; m (Lambda SOACS)
</span><a href="Futhark.IR.SOACS.SOAC.html#mapOnSOACLambda"><span class="hs-identifier hs-var">mapOnSOACLambda</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lambda SOACS -&gt; m (Lambda SOACS)
</span><a href="#local-6989586621684431913"><span class="hs-identifier hs-var">onLambda</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span>    </span><span id="local-6989586621684431913"><span class="annot"><span class="annottext">onLambda :: Lambda SOACS -&gt; m (Lambda SOACS)
</span><a href="#local-6989586621684431913"><span class="hs-identifier hs-var hs-var">onLambda</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span id="local-6989586621684431911"><span class="annot"><span class="annottext">[LParam SOACS]
</span><a href="#local-6989586621684431911"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621684431910"><span class="annot"><span class="annottext">BodyT SOACS
</span><a href="#local-6989586621684431910"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621684431909"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684431909"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-222"></span><span>      </span><span class="annot"><span class="annottext">[LParam SOACS] -&gt; BodyT SOACS -&gt; [Type] -&gt; Lambda SOACS
forall rep. [LParam rep] -&gt; BodyT rep -&gt; [Type] -&gt; LambdaT rep
</span><a href="Futhark.IR.Syntax.html#Lambda"><span class="hs-identifier hs-var">Lambda</span></a></span><span> </span><span class="annot"><span class="annottext">[LParam SOACS]
</span><a href="#local-6989586621684431911"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">(BodyT SOACS -&gt; [Type] -&gt; Lambda SOACS)
-&gt; m (BodyT SOACS) -&gt; m ([Type] -&gt; Lambda SOACS)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">BodyT SOACS -&gt; m (BodyT SOACS)
</span><a href="#local-6989586621684431978"><span class="hs-identifier hs-var">onBody</span></a></span><span> </span><span class="annot"><span class="annottext">BodyT SOACS
</span><a href="#local-6989586621684431910"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">m ([Type] -&gt; Lambda SOACS) -&gt; m [Type] -&gt; m (Lambda SOACS)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; m [Type]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621684431909"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="hs-comment">-- Propagate source locations and attributes to the inlined</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- statements.  Attributes are propagated only when applicable (this</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- probably means that every supported attribute needs to be handled</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- specially here).</span><span>
</span><span id="line-228"></span><span class="annot"><a href="Futhark.Optimise.InliningDeadFun.html#addLocations"><span class="hs-identifier hs-type">addLocations</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Attrs"><span class="hs-identifier hs-type">Attrs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#Safety"><span class="hs-identifier hs-type">Safety</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Stms"><span class="hs-identifier hs-type">Stms</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Stms"><span class="hs-identifier hs-type">Stms</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span>
</span><span id="line-229"></span><span id="addLocations"><span class="annot"><span class="annottext">addLocations :: Attrs -&gt; Safety -&gt; [SrcLoc] -&gt; Stms SOACS -&gt; Stms SOACS
</span><a href="Futhark.Optimise.InliningDeadFun.html#addLocations"><span class="hs-identifier hs-var hs-var">addLocations</span></a></span></span><span> </span><span id="local-6989586621684431908"><span class="annot"><span class="annottext">Attrs
</span><a href="#local-6989586621684431908"><span class="hs-identifier hs-var">attrs</span></a></span></span><span> </span><span id="local-6989586621684431907"><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621684431907"><span class="hs-identifier hs-var">caller_safety</span></a></span></span><span> </span><span id="local-6989586621684431906"><span class="annot"><span class="annottext">[SrcLoc]
</span><a href="#local-6989586621684431906"><span class="hs-identifier hs-var">more_locs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Stm SOACS -&gt; Stm SOACS) -&gt; Stms SOACS -&gt; Stms SOACS
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Stm SOACS -&gt; Stm SOACS
</span><a href="#local-6989586621684431905"><span class="hs-identifier hs-var">onStm</span></a></span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-231"></span><span>    </span><span id="local-6989586621684431905"><span class="annot"><span class="annottext">onStm :: Stm SOACS -&gt; Stm SOACS
</span><a href="#local-6989586621684431905"><span class="hs-identifier hs-var hs-var">onStm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621684431898"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684431898"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684431897"><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684431897"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621684431896"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684431896"><span class="hs-identifier hs-var">fname</span></a></span></span><span> </span><span id="local-6989586621684431895"><span class="annot"><span class="annottext">[(SubExp, Diet)]
</span><a href="#local-6989586621684431895"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621684431894"><span class="annot"><span class="annottext">[RetType SOACS]
</span><a href="#local-6989586621684431894"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684431893"><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621684431893"><span class="hs-identifier hs-var">safety</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684431892"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684431892"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684431891"><span class="annot"><span class="annottext">[SrcLoc]
</span><a href="#local-6989586621684431891"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-232"></span><span>      </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; ExpT SOACS -&gt; Stm SOACS
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684431898"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684431890"><span class="hs-identifier hs-var">aux'</span></a></span><span> </span><span class="annot"><span class="annottext">(ExpT SOACS -&gt; Stm SOACS) -&gt; ExpT SOACS -&gt; Stm SOACS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-233"></span><span>        </span><span class="annot"><span class="annottext">Name
-&gt; [(SubExp, Diet)]
-&gt; [RetType SOACS]
-&gt; (Safety, SrcLoc, [SrcLoc])
-&gt; ExpT SOACS
forall rep.
Name
-&gt; [(SubExp, Diet)]
-&gt; [RetType rep]
-&gt; (Safety, SrcLoc, [SrcLoc])
-&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684431896"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">[(SubExp, Diet)]
</span><a href="#local-6989586621684431895"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[RetType SOACS]
</span><a href="#local-6989586621684431894"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Safety -&gt; Safety -&gt; Safety
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621684431907"><span class="hs-identifier hs-var">caller_safety</span></a></span><span> </span><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621684431893"><span class="hs-identifier hs-var">safety</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684431892"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SrcLoc]
</span><a href="#local-6989586621684431891"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="annot"><span class="annottext">[SrcLoc] -&gt; [SrcLoc] -&gt; [SrcLoc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[SrcLoc]
</span><a href="#local-6989586621684431906"><span class="hs-identifier hs-var">more_locs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-235"></span><span>        </span><span id="local-6989586621684431890"><span class="annot"><span class="annottext">aux' :: StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684431890"><span class="hs-identifier hs-var hs-var">aux'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684431897"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">stmAuxAttrs :: Attrs
</span><a href="Futhark.IR.Syntax.html#stmAuxAttrs"><span class="hs-identifier hs-var">stmAuxAttrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Attrs
</span><a href="#local-6989586621684431908"><span class="hs-identifier hs-var">attrs</span></a></span><span> </span><span class="annot"><span class="annottext">Attrs -&gt; Attrs -&gt; Attrs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StmAux (ExpDec SOACS) -&gt; Attrs
forall dec. StmAux dec -&gt; Attrs
</span><a href="Futhark.IR.Syntax.html#stmAuxAttrs"><span class="hs-identifier hs-var hs-var">stmAuxAttrs</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684431897"><span class="hs-identifier hs-var">aux</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><a href="#local-6989586621684431905"><span class="hs-identifier hs-var">onStm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621684431886"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684431886"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684431885"><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684431885"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-type">BasicOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Assert"><span class="hs-identifier hs-type">Assert</span></a></span><span> </span><span id="local-6989586621684431883"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684431883"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span id="local-6989586621684431882"><span class="annot"><span class="annottext">ErrorMsg SubExp
</span><a href="#local-6989586621684431882"><span class="hs-identifier hs-var">desc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684431881"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684431881"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684431880"><span class="annot"><span class="annottext">[SrcLoc]
</span><a href="#local-6989586621684431880"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-237"></span><span>      </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; ExpT SOACS -&gt; Stm SOACS
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684431886"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Attrs -&gt; StmAux () -&gt; StmAux ()
forall {dec}. Attrs -&gt; StmAux dec -&gt; StmAux dec
</span><a href="#local-6989586621684431879"><span class="hs-identifier hs-var">withAttrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Attrs -&gt; Attrs
</span><a href="Futhark.IR.Prop.html#attrsForAssert"><span class="hs-identifier hs-var">attrsForAssert</span></a></span><span> </span><span class="annot"><span class="annottext">Attrs
</span><a href="#local-6989586621684431908"><span class="hs-identifier hs-var">attrs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684431885"><span class="hs-identifier hs-var">aux</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExpT SOACS -&gt; Stm SOACS) -&gt; ExpT SOACS -&gt; Stm SOACS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-238"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621684431907"><span class="hs-identifier hs-var">caller_safety</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-239"></span><span>          </span><span class="annot"><span class="annottext">Safety
</span><a href="Futhark.IR.Primitive.html#Safe"><span class="hs-identifier hs-var">Safe</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; ExpT SOACS
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; ExpT SOACS) -&gt; BasicOp -&gt; ExpT SOACS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; ErrorMsg SubExp -&gt; (SrcLoc, [SrcLoc]) -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#Assert"><span class="hs-identifier hs-var">Assert</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684431883"><span class="hs-identifier hs-var">cond</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMsg SubExp
</span><a href="#local-6989586621684431882"><span class="hs-identifier hs-var">desc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684431881"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SrcLoc]
</span><a href="#local-6989586621684431880"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="annot"><span class="annottext">[SrcLoc] -&gt; [SrcLoc] -&gt; [SrcLoc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[SrcLoc]
</span><a href="#local-6989586621684431906"><span class="hs-identifier hs-var">more_locs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>          </span><span class="annot"><span class="annottext">Safety
</span><a href="Futhark.IR.Primitive.html#Unsafe"><span class="hs-identifier hs-var">Unsafe</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BasicOp -&gt; ExpT SOACS
forall rep. BasicOp -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-var">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BasicOp -&gt; ExpT SOACS) -&gt; BasicOp -&gt; ExpT SOACS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; BasicOp
</span><a href="Futhark.IR.Syntax.html#SubExp"><span class="hs-identifier hs-var">SubExp</span></a></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; BasicOp) -&gt; SubExp -&gt; BasicOp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimValue -&gt; SubExp
</span><a href="Futhark.IR.Syntax.Core.html#Constant"><span class="hs-identifier hs-var">Constant</span></a></span><span> </span><span class="annot"><span class="annottext">PrimValue
</span><a href="Futhark.IR.Primitive.html#UnitValue"><span class="hs-identifier hs-var">UnitValue</span></a></span><span>
</span><span id="line-241"></span><span>    </span><span class="annot"><a href="#local-6989586621684431905"><span class="hs-identifier hs-var">onStm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621684431873"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684431873"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684431872"><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684431872"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span id="local-6989586621684431870"><span class="annot"><span class="annottext">Op SOACS
</span><a href="#local-6989586621684431870"><span class="hs-identifier hs-var">soac</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-242"></span><span>      </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; ExpT SOACS -&gt; Stm SOACS
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684431873"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Attrs -&gt; StmAux () -&gt; StmAux ()
forall {dec}. Attrs -&gt; StmAux dec -&gt; StmAux dec
</span><a href="#local-6989586621684431879"><span class="hs-identifier hs-var">withAttrs</span></a></span><span> </span><span class="annot"><span class="annottext">Attrs
</span><a href="#local-6989586621684431869"><span class="hs-identifier hs-var">attrs'</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux ()
StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684431872"><span class="hs-identifier hs-var">aux</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExpT SOACS -&gt; Stm SOACS) -&gt; ExpT SOACS -&gt; Stm SOACS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-243"></span><span>        </span><span class="annot"><span class="annottext">Op SOACS -&gt; ExpT SOACS
forall rep. Op rep -&gt; ExpT rep
</span><a href="Futhark.IR.Syntax.html#Op"><span class="hs-identifier hs-var">Op</span></a></span><span> </span><span class="annot"><span class="annottext">(Op SOACS -&gt; ExpT SOACS) -&gt; Op SOACS -&gt; ExpT SOACS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-244"></span><span>          </span><span class="annot"><span class="annottext">Identity (SOAC SOACS) -&gt; SOAC SOACS
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity (SOAC SOACS) -&gt; SOAC SOACS)
-&gt; Identity (SOAC SOACS) -&gt; SOAC SOACS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-245"></span><span>            </span><span class="annot"><span class="annottext">SOACMapper SOACS SOACS Identity
-&gt; SOAC SOACS -&gt; Identity (SOAC SOACS)
forall (m :: * -&gt; *) frep trep.
(Applicative m, Monad m) =&gt;
SOACMapper frep trep m -&gt; SOAC frep -&gt; m (SOAC trep)
</span><a href="Futhark.IR.SOACS.SOAC.html#mapSOACM"><span class="hs-identifier hs-var">mapSOACM</span></a></span><span>
</span><span id="line-246"></span><span>              </span><span class="annot"><span class="annottext">SOACMapper Any Any Identity
forall (m :: * -&gt; *) rep. Monad m =&gt; SOACMapper rep rep m
</span><a href="Futhark.IR.SOACS.SOAC.html#identitySOACMapper"><span class="hs-identifier hs-var">identitySOACMapper</span></a></span><span>
</span><span id="line-247"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mapOnSOACLambda :: Lambda SOACS -&gt; Identity (Lambda SOACS)
</span><a href="Futhark.IR.SOACS.SOAC.html#mapOnSOACLambda"><span class="hs-identifier hs-var">mapOnSOACLambda</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lambda SOACS -&gt; Identity (Lambda SOACS)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Lambda SOACS -&gt; Identity (Lambda SOACS))
-&gt; (Lambda SOACS -&gt; Lambda SOACS)
-&gt; Lambda SOACS
-&gt; Identity (Lambda SOACS)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Lambda SOACS -&gt; Lambda SOACS
</span><a href="#local-6989586621684431867"><span class="hs-identifier hs-var">onLambda</span></a></span><span>
</span><span id="line-248"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-249"></span><span>              </span><span class="annot"><span class="annottext">Op SOACS
SOAC SOACS
</span><a href="#local-6989586621684431870"><span class="hs-identifier hs-var">soac</span></a></span><span>
</span><span id="line-250"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-251"></span><span>        </span><span id="local-6989586621684431869"><span class="annot"><span class="annottext">attrs' :: Attrs
</span><a href="#local-6989586621684431869"><span class="hs-identifier hs-var hs-var">attrs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Attrs
</span><a href="#local-6989586621684431908"><span class="hs-identifier hs-var">attrs</span></a></span><span> </span><span class="annot"><span class="annottext">Attrs -&gt; Attrs -&gt; Attrs
</span><a href="Futhark.IR.Syntax.Core.html#withoutAttrs"><span class="hs-operator hs-var">`withoutAttrs`</span></a></span><span> </span><span class="annot"><span class="annottext">Attrs
</span><a href="#local-6989586621684431865"><span class="hs-identifier hs-var">for_assert</span></a></span><span>
</span><span id="line-252"></span><span>        </span><span id="local-6989586621684431865"><span class="annot"><span class="annottext">for_assert :: Attrs
</span><a href="#local-6989586621684431865"><span class="hs-identifier hs-var hs-var">for_assert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Attrs -&gt; Attrs
</span><a href="Futhark.IR.Prop.html#attrsForAssert"><span class="hs-identifier hs-var">attrsForAssert</span></a></span><span> </span><span class="annot"><span class="annottext">Attrs
</span><a href="#local-6989586621684431908"><span class="hs-identifier hs-var">attrs</span></a></span><span>
</span><span id="line-253"></span><span>        </span><span id="local-6989586621684431867"><span class="annot"><span class="annottext">onLambda :: Lambda SOACS -&gt; Lambda SOACS
</span><a href="#local-6989586621684431867"><span class="hs-identifier hs-var hs-var">onLambda</span></a></span></span><span> </span><span id="local-6989586621684431864"><span class="annot"><span class="annottext">Lambda SOACS
</span><a href="#local-6989586621684431864"><span class="hs-identifier hs-var">lam</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-254"></span><span>          </span><span class="annot"><span class="annottext">Lambda SOACS
</span><a href="#local-6989586621684431864"><span class="hs-identifier hs-var">lam</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">lambdaBody :: BodyT SOACS
</span><a href="Futhark.IR.Syntax.html#lambdaBody"><span class="hs-identifier hs-var">lambdaBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Attrs -&gt; BodyT SOACS -&gt; BodyT SOACS
</span><a href="#local-6989586621684431862"><span class="hs-identifier hs-var">onBody</span></a></span><span> </span><span class="annot"><span class="annottext">Attrs
</span><a href="#local-6989586621684431865"><span class="hs-identifier hs-var">for_assert</span></a></span><span> </span><span class="annot"><span class="annottext">(BodyT SOACS -&gt; BodyT SOACS) -&gt; BodyT SOACS -&gt; BodyT SOACS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Lambda SOACS -&gt; BodyT SOACS
forall rep. LambdaT rep -&gt; BodyT rep
</span><a href="Futhark.IR.Syntax.html#lambdaBody"><span class="hs-identifier hs-var hs-var">lambdaBody</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda SOACS
</span><a href="#local-6989586621684431864"><span class="hs-identifier hs-var">lam</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-255"></span><span>    </span><span class="annot"><a href="#local-6989586621684431905"><span class="hs-identifier hs-var">onStm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621684431861"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684431861"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684431860"><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684431860"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span id="local-6989586621684431859"><span class="annot"><span class="annottext">ExpT SOACS
</span><a href="#local-6989586621684431859"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-256"></span><span>      </span><span class="annot"><span class="annottext">Pat -&gt; StmAux (ExpDec SOACS) -&gt; ExpT SOACS -&gt; Stm SOACS
forall rep. Pat rep -&gt; StmAux (ExpDec rep) -&gt; Exp rep -&gt; Stm rep
</span><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684431861"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux (ExpDec SOACS)
</span><a href="#local-6989586621684431860"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">(ExpT SOACS -&gt; Stm SOACS) -&gt; ExpT SOACS -&gt; Stm SOACS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExpT SOACS -&gt; ExpT SOACS
</span><a href="#local-6989586621684431858"><span class="hs-identifier hs-var">onExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpT SOACS
</span><a href="#local-6989586621684431859"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span>    </span><span id="local-6989586621684431858"><span class="annot"><span class="annottext">onExp :: ExpT SOACS -&gt; ExpT SOACS
</span><a href="#local-6989586621684431858"><span class="hs-identifier hs-var hs-var">onExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-259"></span><span>      </span><span class="annot"><span class="annottext">Mapper SOACS SOACS Identity -&gt; ExpT SOACS -&gt; ExpT SOACS
forall frep trep. Mapper frep trep Identity -&gt; Exp frep -&gt; Exp trep
</span><a href="Futhark.IR.Traversals.html#mapExp"><span class="hs-identifier hs-var">mapExp</span></a></span><span>
</span><span id="line-260"></span><span>        </span><span class="annot"><span class="annottext">Mapper SOACS SOACS Identity
forall (m :: * -&gt; *) rep. Monad m =&gt; Mapper rep rep m
</span><a href="Futhark.IR.Traversals.html#identityMapper"><span class="hs-identifier hs-var">identityMapper</span></a></span><span>
</span><span id="line-261"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mapOnBody :: Scope SOACS -&gt; BodyT SOACS -&gt; Identity (BodyT SOACS)
</span><a href="Futhark.IR.Traversals.html#mapOnBody"><span class="hs-identifier hs-var">mapOnBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BodyT SOACS -&gt; Identity (BodyT SOACS))
-&gt; Scope SOACS -&gt; BodyT SOACS -&gt; Identity (BodyT SOACS)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">((BodyT SOACS -&gt; Identity (BodyT SOACS))
 -&gt; Scope SOACS -&gt; BodyT SOACS -&gt; Identity (BodyT SOACS))
-&gt; (BodyT SOACS -&gt; Identity (BodyT SOACS))
-&gt; Scope SOACS
-&gt; BodyT SOACS
-&gt; Identity (BodyT SOACS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BodyT SOACS -&gt; Identity (BodyT SOACS)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(BodyT SOACS -&gt; Identity (BodyT SOACS))
-&gt; (BodyT SOACS -&gt; BodyT SOACS)
-&gt; BodyT SOACS
-&gt; Identity (BodyT SOACS)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Attrs -&gt; BodyT SOACS -&gt; BodyT SOACS
</span><a href="#local-6989586621684431862"><span class="hs-identifier hs-var">onBody</span></a></span><span> </span><span class="annot"><span class="annottext">Attrs
</span><a href="#local-6989586621684431908"><span class="hs-identifier hs-var">attrs</span></a></span><span>
</span><span id="line-262"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span>    </span><span id="local-6989586621684431879"><span class="annot"><span class="annottext">withAttrs :: Attrs -&gt; StmAux dec -&gt; StmAux dec
</span><a href="#local-6989586621684431879"><span class="hs-identifier hs-var hs-var">withAttrs</span></a></span></span><span> </span><span id="local-6989586621684431853"><span class="annot"><span class="annottext">Attrs
</span><a href="#local-6989586621684431853"><span class="hs-identifier hs-var">attrs'</span></a></span></span><span> </span><span id="local-6989586621684431852"><span class="annot"><span class="annottext">StmAux dec
</span><a href="#local-6989586621684431852"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StmAux dec
</span><a href="#local-6989586621684431852"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">stmAuxAttrs :: Attrs
</span><a href="Futhark.IR.Syntax.html#stmAuxAttrs"><span class="hs-identifier hs-var">stmAuxAttrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Attrs
</span><a href="#local-6989586621684431853"><span class="hs-identifier hs-var">attrs'</span></a></span><span> </span><span class="annot"><span class="annottext">Attrs -&gt; Attrs -&gt; Attrs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StmAux dec -&gt; Attrs
forall dec. StmAux dec -&gt; Attrs
</span><a href="Futhark.IR.Syntax.html#stmAuxAttrs"><span class="hs-identifier hs-var hs-var">stmAuxAttrs</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux dec
</span><a href="#local-6989586621684431852"><span class="hs-identifier hs-var">aux</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span>    </span><span id="local-6989586621684431862"><span class="annot"><span class="annottext">onBody :: Attrs -&gt; BodyT SOACS -&gt; BodyT SOACS
</span><a href="#local-6989586621684431862"><span class="hs-identifier hs-var hs-var">onBody</span></a></span></span><span> </span><span id="local-6989586621684431851"><span class="annot"><span class="annottext">Attrs
</span><a href="#local-6989586621684431851"><span class="hs-identifier hs-var">attrs'</span></a></span></span><span> </span><span id="local-6989586621684431850"><span class="annot"><span class="annottext">BodyT SOACS
</span><a href="#local-6989586621684431850"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-267"></span><span>      </span><span class="annot"><span class="annottext">BodyT SOACS
</span><a href="#local-6989586621684431850"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-268"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">bodyStms :: Stms SOACS
</span><a href="Futhark.IR.Syntax.html#bodyStms"><span class="hs-identifier hs-var">bodyStms</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-269"></span><span>            </span><span class="annot"><span class="annottext">Attrs -&gt; Safety -&gt; [SrcLoc] -&gt; Stms SOACS -&gt; Stms SOACS
</span><a href="Futhark.Optimise.InliningDeadFun.html#addLocations"><span class="hs-identifier hs-var">addLocations</span></a></span><span> </span><span class="annot"><span class="annottext">Attrs
</span><a href="#local-6989586621684431851"><span class="hs-identifier hs-var">attrs'</span></a></span><span> </span><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621684431907"><span class="hs-identifier hs-var">caller_safety</span></a></span><span> </span><span class="annot"><span class="annottext">[SrcLoc]
</span><a href="#local-6989586621684431906"><span class="hs-identifier hs-var">more_locs</span></a></span><span> </span><span class="annot"><span class="annottext">(Stms SOACS -&gt; Stms SOACS) -&gt; Stms SOACS -&gt; Stms SOACS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-270"></span><span>              </span><span class="annot"><span class="annottext">BodyT SOACS -&gt; Stms SOACS
forall rep. BodyT rep -&gt; Stms rep
</span><a href="Futhark.IR.Syntax.html#bodyStms"><span class="hs-identifier hs-var hs-var">bodyStms</span></a></span><span> </span><span class="annot"><span class="annottext">BodyT SOACS
</span><a href="#local-6989586621684431850"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-271"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="hs-comment">-- | Remove functions not ultimately called from an entry point or a</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- constant.</span><span>
</span><span id="line-275"></span><span class="annot"><a href="Futhark.Optimise.InliningDeadFun.html#removeDeadFunctionsF"><span class="hs-identifier hs-type">removeDeadFunctionsF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span>
</span><span id="line-276"></span><span id="removeDeadFunctionsF"><span class="annot"><span class="annottext">removeDeadFunctionsF :: Prog SOACS -&gt; Prog SOACS
</span><a href="Futhark.Optimise.InliningDeadFun.html#removeDeadFunctionsF"><span class="hs-identifier hs-var hs-var">removeDeadFunctionsF</span></a></span></span><span> </span><span id="local-6989586621684431848"><span class="annot"><span class="annottext">Prog SOACS
</span><a href="#local-6989586621684431848"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684431847"><span class="annot"><span class="annottext">cg :: CallGraph
</span><a href="#local-6989586621684431847"><span class="hs-identifier hs-var hs-var">cg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Prog SOACS -&gt; CallGraph
</span><a href="Futhark.Analysis.CallGraph.html#buildCallGraph"><span class="hs-identifier hs-var">buildCallGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Prog SOACS
</span><a href="#local-6989586621684431848"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-278"></span><span>      </span><span id="local-6989586621684431846"><span class="annot"><span class="annottext">live_funs :: [FunDef SOACS]
</span><a href="#local-6989586621684431846"><span class="hs-identifier hs-var hs-var">live_funs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FunDef SOACS -&gt; Bool) -&gt; [FunDef SOACS] -&gt; [FunDef SOACS]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; CallGraph -&gt; Bool
</span><a href="Futhark.Analysis.CallGraph.html#isFunInCallGraph"><span class="hs-operator hs-var">`isFunInCallGraph`</span></a></span><span> </span><span class="annot"><span class="annottext">CallGraph
</span><a href="#local-6989586621684431847"><span class="hs-identifier hs-var">cg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; (FunDef SOACS -&gt; Name) -&gt; FunDef SOACS -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FunDef SOACS -&gt; Name
forall rep. FunDef rep -&gt; Name
</span><a href="Futhark.IR.Syntax.html#funDefName"><span class="hs-identifier hs-var hs-var">funDefName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([FunDef SOACS] -&gt; [FunDef SOACS])
-&gt; [FunDef SOACS] -&gt; [FunDef SOACS]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Prog SOACS -&gt; [FunDef SOACS]
forall rep. Prog rep -&gt; [FunDef rep]
</span><a href="Futhark.IR.Syntax.html#progFuns"><span class="hs-identifier hs-var hs-var">progFuns</span></a></span><span> </span><span class="annot"><span class="annottext">Prog SOACS
</span><a href="#local-6989586621684431848"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-279"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Prog SOACS
</span><a href="#local-6989586621684431848"><span class="hs-identifier hs-var">prog</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">progFuns :: [FunDef SOACS]
</span><a href="Futhark.IR.Syntax.html#progFuns"><span class="hs-identifier hs-var">progFuns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FunDef SOACS]
</span><a href="#local-6989586621684431846"><span class="hs-identifier hs-var">live_funs</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="hs-comment">-- | Inline all functions and remove the resulting dead functions.</span><span>
</span><span id="line-282"></span><span class="annot"><a href="Futhark.Optimise.InliningDeadFun.html#inlineAggressively"><span class="hs-identifier hs-type">inlineAggressively</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Pass.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span>
</span><span id="line-283"></span><span id="inlineAggressively"><span class="annot"><span class="annottext">inlineAggressively :: Pass SOACS SOACS
</span><a href="Futhark.Optimise.InliningDeadFun.html#inlineAggressively"><span class="hs-identifier hs-var hs-var">inlineAggressively</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-284"></span><span>  </span><span class="annot"><span class="annottext">Pass :: forall fromrep torep.
String
-&gt; String
-&gt; (Prog fromrep -&gt; PassM (Prog torep))
-&gt; Pass fromrep torep
</span><a href="Futhark.Pass.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">passName :: String
</span><a href="Futhark.Pass.html#passName"><span class="hs-identifier hs-var">passName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Inline aggressively&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-286"></span><span>      </span><span class="annot"><span class="annottext">passDescription :: String
</span><a href="Futhark.Pass.html#passDescription"><span class="hs-identifier hs-var">passDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Aggressively inline and remove resulting dead functions.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-287"></span><span>      </span><span class="annot"><span class="annottext">passFunction :: Prog SOACS -&gt; PassM (Prog SOACS)
</span><a href="Futhark.Pass.html#passFunction"><span class="hs-identifier hs-var">passFunction</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-288"></span><span>        </span><span class="annot"><span class="annottext">SimpleOps SOACS -&gt; Prog SOACS -&gt; PassM (Prog SOACS)
forall rep.
SimplifiableRep rep =&gt;
SimpleOps rep -&gt; Prog rep -&gt; PassM (Prog rep)
</span><a href="Futhark.Transform.CopyPropagate.html#copyPropagateInProg"><span class="hs-identifier hs-var">copyPropagateInProg</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleOps SOACS
</span><a href="Futhark.IR.SOACS.Simplify.html#simpleSOACS"><span class="hs-identifier hs-var">simpleSOACS</span></a></span><span> </span><span class="annot"><span class="annottext">(Prog SOACS -&gt; PassM (Prog SOACS))
-&gt; (Prog SOACS -&gt; Prog SOACS) -&gt; Prog SOACS -&gt; PassM (Prog SOACS)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Prog SOACS -&gt; Prog SOACS
</span><a href="Futhark.Optimise.InliningDeadFun.html#removeDeadFunctionsF"><span class="hs-identifier hs-var">removeDeadFunctionsF</span></a></span><span> </span><span class="annot"><span class="annottext">(Prog SOACS -&gt; PassM (Prog SOACS))
-&gt; (Prog SOACS -&gt; PassM (Prog SOACS))
-&gt; Prog SOACS
-&gt; PassM (Prog SOACS)
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">Prog SOACS -&gt; PassM (Prog SOACS)
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Prog SOACS -&gt; m (Prog SOACS)
</span><a href="Futhark.Optimise.InliningDeadFun.html#aggInlineFunctions"><span class="hs-identifier hs-var">aggInlineFunctions</span></a></span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span class="hs-comment">-- | Inline some functions and remove the resulting dead functions.</span><span>
</span><span id="line-292"></span><span class="annot"><a href="Futhark.Optimise.InliningDeadFun.html#inlineConservatively"><span class="hs-identifier hs-type">inlineConservatively</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Pass.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span>
</span><span id="line-293"></span><span id="inlineConservatively"><span class="annot"><span class="annottext">inlineConservatively :: Pass SOACS SOACS
</span><a href="Futhark.Optimise.InliningDeadFun.html#inlineConservatively"><span class="hs-identifier hs-var hs-var">inlineConservatively</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-294"></span><span>  </span><span class="annot"><span class="annottext">Pass :: forall fromrep torep.
String
-&gt; String
-&gt; (Prog fromrep -&gt; PassM (Prog torep))
-&gt; Pass fromrep torep
</span><a href="Futhark.Pass.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span>
</span><span id="line-295"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">passName :: String
</span><a href="Futhark.Pass.html#passName"><span class="hs-identifier hs-var">passName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Inline conservatively&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-296"></span><span>      </span><span class="annot"><span class="annottext">passDescription :: String
</span><a href="Futhark.Pass.html#passDescription"><span class="hs-identifier hs-var">passDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Conservatively inline and remove resulting dead functions.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-297"></span><span>      </span><span class="annot"><span class="annottext">passFunction :: Prog SOACS -&gt; PassM (Prog SOACS)
</span><a href="Futhark.Pass.html#passFunction"><span class="hs-identifier hs-var">passFunction</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-298"></span><span>        </span><span class="annot"><span class="annottext">SimpleOps SOACS -&gt; Prog SOACS -&gt; PassM (Prog SOACS)
forall rep.
SimplifiableRep rep =&gt;
SimpleOps rep -&gt; Prog rep -&gt; PassM (Prog rep)
</span><a href="Futhark.Transform.CopyPropagate.html#copyPropagateInProg"><span class="hs-identifier hs-var">copyPropagateInProg</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleOps SOACS
</span><a href="Futhark.IR.SOACS.Simplify.html#simpleSOACS"><span class="hs-identifier hs-var">simpleSOACS</span></a></span><span> </span><span class="annot"><span class="annottext">(Prog SOACS -&gt; PassM (Prog SOACS))
-&gt; (Prog SOACS -&gt; Prog SOACS) -&gt; Prog SOACS -&gt; PassM (Prog SOACS)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Prog SOACS -&gt; Prog SOACS
</span><a href="Futhark.Optimise.InliningDeadFun.html#removeDeadFunctionsF"><span class="hs-identifier hs-var">removeDeadFunctionsF</span></a></span><span> </span><span class="annot"><span class="annottext">(Prog SOACS -&gt; PassM (Prog SOACS))
-&gt; (Prog SOACS -&gt; PassM (Prog SOACS))
-&gt; Prog SOACS
-&gt; PassM (Prog SOACS)
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">Prog SOACS -&gt; PassM (Prog SOACS)
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Prog SOACS -&gt; m (Prog SOACS)
</span><a href="Futhark.Optimise.InliningDeadFun.html#consInlineFunctions"><span class="hs-identifier hs-var">consInlineFunctions</span></a></span><span>
</span><span id="line-299"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span class="hs-comment">-- | @removeDeadFunctions prog@ removes the functions that are unreachable from</span><span>
</span><span id="line-302"></span><span class="hs-comment">-- the main function from the program.</span><span>
</span><span id="line-303"></span><span class="annot"><a href="Futhark.Optimise.InliningDeadFun.html#removeDeadFunctions"><span class="hs-identifier hs-type">removeDeadFunctions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Pass.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span>
</span><span id="line-304"></span><span id="removeDeadFunctions"><span class="annot"><span class="annottext">removeDeadFunctions :: Pass SOACS SOACS
</span><a href="Futhark.Optimise.InliningDeadFun.html#removeDeadFunctions"><span class="hs-identifier hs-var hs-var">removeDeadFunctions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-305"></span><span>  </span><span class="annot"><span class="annottext">Pass :: forall fromrep torep.
String
-&gt; String
-&gt; (Prog fromrep -&gt; PassM (Prog torep))
-&gt; Pass fromrep torep
</span><a href="Futhark.Pass.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">passName :: String
</span><a href="Futhark.Pass.html#passName"><span class="hs-identifier hs-var">passName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Remove dead functions&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-307"></span><span>      </span><span class="annot"><span class="annottext">passDescription :: String
</span><a href="Futhark.Pass.html#passDescription"><span class="hs-identifier hs-var">passDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Remove the functions that are unreachable from entry points&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-308"></span><span>      </span><span class="annot"><span class="annottext">passFunction :: Prog SOACS -&gt; PassM (Prog SOACS)
</span><a href="Futhark.Pass.html#passFunction"><span class="hs-identifier hs-var">passFunction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Prog SOACS -&gt; PassM (Prog SOACS)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Prog SOACS -&gt; PassM (Prog SOACS))
-&gt; (Prog SOACS -&gt; Prog SOACS) -&gt; Prog SOACS -&gt; PassM (Prog SOACS)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Prog SOACS -&gt; Prog SOACS
</span><a href="Futhark.Optimise.InliningDeadFun.html#removeDeadFunctionsF"><span class="hs-identifier hs-var">removeDeadFunctionsF</span></a></span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-310"></span></pre></body></html>