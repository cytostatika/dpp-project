<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">-- | A generic Python code generator which is polymorphic in the type</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- of the operations.  Concretely, we use this to handle both</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- sequential and PyOpenCL Python code.</span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Futhark.CodeGen.Backends.GenericPython</span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileProg"><span class="hs-identifier">compileProg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Futhark.Compiler.CLI.html#CompilerMode"><span class="hs-identifier">CompilerMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Constructor"><span class="hs-identifier">Constructor</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#emptyConstructor"><span class="hs-identifier">emptyConstructor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileName"><span class="hs-identifier">compileName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier">compileVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileDim"><span class="hs-identifier">compileDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier">compileExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimExp"><span class="hs-identifier">compilePrimExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier">compileCode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimValue"><span class="hs-identifier">compilePrimValue</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimType"><span class="hs-identifier">compilePrimType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimTypeExt"><span class="hs-identifier">compilePrimTypeExt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimToNp"><span class="hs-identifier">compilePrimToNp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimToExtNp"><span class="hs-identifier">compilePrimToExtNp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#fromStorage"><span class="hs-identifier">fromStorage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#toStorage"><span class="hs-identifier">toStorage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Operations"><span class="hs-identifier">Operations</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#defaultOperations"><span class="hs-identifier">defaultOperations</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#unpackDim"><span class="hs-identifier">unpackDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier">CompilerM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#OpCompiler"><span class="hs-identifier">OpCompiler</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#WriteScalar"><span class="hs-identifier">WriteScalar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#ReadScalar"><span class="hs-identifier">ReadScalar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Allocate"><span class="hs-identifier">Allocate</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Copy"><span class="hs-identifier">Copy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#StaticArray"><span class="hs-identifier">StaticArray</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#EntryOutput"><span class="hs-identifier">EntryOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#EntryInput"><span class="hs-identifier">EntryInput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerEnv"><span class="hs-identifier">CompilerEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerState"><span class="hs-identifier">CompilerState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier">stm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#atInit"><span class="hs-identifier">atInit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#collect%27"><span class="hs-identifier">collect'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#collect"><span class="hs-identifier">collect</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier">simpleCall</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#copyMemoryDefaultSpace"><span class="hs-identifier">copyMemoryDefaultSpace</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">where</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Identity</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.RWS</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html"><span class="hs-identifier">Futhark.CodeGen.Backends.GenericPython.AST</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.Options.html"><span class="hs-identifier">Futhark.CodeGen.Backends.GenericPython.Options</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html"><span class="hs-identifier">Futhark.CodeGen.ImpCode</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Imp</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.CodeGen.RTS.Python.html"><span class="hs-identifier">Futhark.CodeGen.RTS.Python</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Compiler.CLI.html"><span class="hs-identifier">Futhark.Compiler.CLI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Compiler.CLI.html#CompilerMode"><span class="hs-identifier">CompilerMode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html"><span class="hs-identifier">Futhark.IR.Primitive</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#Bool"><span class="hs-identifier">Bool</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.html"><span class="hs-identifier">Futhark.IR.Prop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.html#isBuiltInFunction"><span class="hs-identifier">isBuiltInFunction</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.html#subExpVars"><span class="hs-identifier">subExpVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html"><span class="hs-identifier">Futhark.IR.Syntax</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Space"><span class="hs-identifier">Space</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.MonadFreshNames.html"><span class="hs-identifier">Futhark.MonadFreshNames</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Util.html"><span class="hs-identifier">Futhark.Util</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Util.html#zEncodeString"><span class="hs-identifier">zEncodeString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Util.Pretty.html"><span class="hs-identifier">Futhark.Util.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier">pretty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Util.Pretty.html#prettyText"><span class="hs-identifier">prettyText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-comment">-- | A substitute expression compiler, tried before the main</span><span>
</span><span id="line-68"></span><span class="hs-comment">-- compilation function.</span><span>
</span><span id="line-69"></span><span class="hs-keyword">type</span><span> </span><span id="OpCompiler"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#OpCompiler"><span class="hs-identifier hs-var">OpCompiler</span></a></span></span><span> </span><span id="local-6989586621684569385"><span class="annot"><a href="#local-6989586621684569385"><span class="hs-identifier hs-type">op</span></a></span></span><span> </span><span id="local-6989586621684569384"><span class="annot"><a href="#local-6989586621684569384"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621684569385"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569385"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569384"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-comment">-- | Write a scalar to the given memory block with the given index and</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- in the given memory space.</span><span>
</span><span id="line-73"></span><span class="hs-keyword">type</span><span> </span><span id="WriteScalar"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#WriteScalar"><span class="hs-identifier hs-var">WriteScalar</span></a></span></span><span> </span><span id="local-6989586621684569383"><span class="annot"><a href="#local-6989586621684569383"><span class="hs-identifier hs-type">op</span></a></span></span><span> </span><span id="local-6989586621684569382"><span class="annot"><a href="#local-6989586621684569382"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SpaceId"><span class="hs-identifier hs-type">Imp.SpaceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569383"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569382"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-comment">-- | Read a scalar from the given memory block with the given index and</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- in the given memory space.</span><span>
</span><span id="line-83"></span><span class="hs-keyword">type</span><span> </span><span id="ReadScalar"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#ReadScalar"><span class="hs-identifier hs-var">ReadScalar</span></a></span></span><span> </span><span id="local-6989586621684569380"><span class="annot"><a href="#local-6989586621684569380"><span class="hs-identifier hs-type">op</span></a></span></span><span> </span><span id="local-6989586621684569379"><span class="annot"><a href="#local-6989586621684569379"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-84"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SpaceId"><span class="hs-identifier hs-type">Imp.SpaceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569380"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569379"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">-- | Allocate a memory block of the given size in the given memory</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- space, saving a reference in the given variable name.</span><span>
</span><span id="line-92"></span><span class="hs-keyword">type</span><span> </span><span id="Allocate"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Allocate"><span class="hs-identifier hs-var">Allocate</span></a></span></span><span> </span><span id="local-6989586621684569378"><span class="annot"><a href="#local-6989586621684569378"><span class="hs-identifier hs-type">op</span></a></span></span><span> </span><span id="local-6989586621684569377"><span class="annot"><a href="#local-6989586621684569377"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SpaceId"><span class="hs-identifier hs-type">Imp.SpaceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569378"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569377"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">-- | Copy from one memory block to another.</span><span>
</span><span id="line-99"></span><span class="hs-keyword">type</span><span> </span><span id="Copy"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Copy"><span class="hs-identifier hs-var">Copy</span></a></span></span><span> </span><span id="local-6989586621684569376"><span class="annot"><a href="#local-6989586621684569376"><span class="hs-identifier hs-type">op</span></a></span></span><span> </span><span id="local-6989586621684569375"><span class="annot"><a href="#local-6989586621684569375"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Space"><span class="hs-identifier hs-type">Imp.Space</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-105"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Space"><span class="hs-identifier hs-type">Imp.Space</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-108"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569376"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569375"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">-- | Create a static array of values - initialised at load time.</span><span>
</span><span id="line-111"></span><span class="hs-keyword">type</span><span> </span><span id="StaticArray"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#StaticArray"><span class="hs-identifier hs-var">StaticArray</span></a></span></span><span> </span><span id="local-6989586621684569374"><span class="annot"><a href="#local-6989586621684569374"><span class="hs-identifier hs-type">op</span></a></span></span><span> </span><span id="local-6989586621684569373"><span class="annot"><a href="#local-6989586621684569373"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SpaceId"><span class="hs-identifier hs-type">Imp.SpaceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ArrayContents"><span class="hs-identifier hs-type">Imp.ArrayContents</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569374"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569373"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-comment">-- | Construct the Python array being returned from an entry point.</span><span>
</span><span id="line-114"></span><span class="hs-keyword">type</span><span> </span><span id="EntryOutput"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#EntryOutput"><span class="hs-identifier hs-var">EntryOutput</span></a></span></span><span> </span><span id="local-6989586621684569372"><span class="annot"><a href="#local-6989586621684569372"><span class="hs-identifier hs-type">op</span></a></span></span><span> </span><span id="local-6989586621684569371"><span class="annot"><a href="#local-6989586621684569371"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-115"></span><span>  </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-116"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SpaceId"><span class="hs-identifier hs-type">Imp.SpaceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-117"></span><span>  </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-118"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Signedness"><span class="hs-identifier hs-type">Imp.Signedness</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#DimSize"><span class="hs-identifier hs-type">Imp.DimSize</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569372"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569371"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-comment">-- | Unpack the array being passed to an entry point.</span><span>
</span><span id="line-123"></span><span class="hs-keyword">type</span><span> </span><span id="EntryInput"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#EntryInput"><span class="hs-identifier hs-var">EntryInput</span></a></span></span><span> </span><span id="local-6989586621684569370"><span class="annot"><a href="#local-6989586621684569370"><span class="hs-identifier hs-type">op</span></a></span></span><span> </span><span id="local-6989586621684569369"><span class="annot"><a href="#local-6989586621684569369"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-124"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SpaceId"><span class="hs-identifier hs-type">Imp.SpaceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Signedness"><span class="hs-identifier hs-type">Imp.Signedness</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#DimSize"><span class="hs-identifier hs-type">Imp.DimSize</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-129"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569370"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569369"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-keyword">data</span><span> </span><span id="Operations"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Operations"><span class="hs-identifier hs-var">Operations</span></a></span></span><span> </span><span id="local-6989586621684569992"><span class="annot"><a href="#local-6989586621684569992"><span class="hs-identifier hs-type">op</span></a></span></span><span> </span><span id="local-6989586621684569991"><span class="annot"><a href="#local-6989586621684569991"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Operations"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Operations"><span class="hs-identifier hs-var">Operations</span></a></span></span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="opsWriteScalar"><span class="annot"><span class="annottext">forall op s. Operations op s -&gt; WriteScalar op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsWriteScalar"><span class="hs-identifier hs-var hs-var">opsWriteScalar</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#WriteScalar"><span class="hs-identifier hs-type">WriteScalar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569992"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569991"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-134"></span><span>    </span><span id="opsReadScalar"><span class="annot"><span class="annottext">forall op s. Operations op s -&gt; ReadScalar op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsReadScalar"><span class="hs-identifier hs-var hs-var">opsReadScalar</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#ReadScalar"><span class="hs-identifier hs-type">ReadScalar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569992"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569991"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-135"></span><span>    </span><span id="opsAllocate"><span class="annot"><span class="annottext">forall op s. Operations op s -&gt; Allocate op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsAllocate"><span class="hs-identifier hs-var hs-var">opsAllocate</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Allocate"><span class="hs-identifier hs-type">Allocate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569992"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569991"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-136"></span><span>    </span><span id="opsCopy"><span class="annot"><span class="annottext">forall op s. Operations op s -&gt; Copy op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsCopy"><span class="hs-identifier hs-var hs-var">opsCopy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Copy"><span class="hs-identifier hs-type">Copy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569992"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569991"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-137"></span><span>    </span><span id="opsStaticArray"><span class="annot"><span class="annottext">forall op s. Operations op s -&gt; StaticArray op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsStaticArray"><span class="hs-identifier hs-var hs-var">opsStaticArray</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#StaticArray"><span class="hs-identifier hs-type">StaticArray</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569992"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569991"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-138"></span><span>    </span><span id="opsCompiler"><span class="annot"><span class="annottext">forall op s. Operations op s -&gt; OpCompiler op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsCompiler"><span class="hs-identifier hs-var hs-var">opsCompiler</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#OpCompiler"><span class="hs-identifier hs-type">OpCompiler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569992"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569991"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-139"></span><span>    </span><span id="opsEntryOutput"><span class="annot"><span class="annottext">forall op s. Operations op s -&gt; EntryOutput op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsEntryOutput"><span class="hs-identifier hs-var hs-var">opsEntryOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#EntryOutput"><span class="hs-identifier hs-type">EntryOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569992"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569991"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-140"></span><span>    </span><span id="opsEntryInput"><span class="annot"><span class="annottext">forall op s. Operations op s -&gt; EntryInput op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsEntryInput"><span class="hs-identifier hs-var hs-var">opsEntryInput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#EntryInput"><span class="hs-identifier hs-type">EntryInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569992"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569991"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-comment">-- | A set of operations that fail for every operation involving</span><span>
</span><span id="line-144"></span><span class="hs-comment">-- non-default memory spaces.  Uses plain pointers and @malloc@ for</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- memory management.</span><span>
</span><span id="line-146"></span><span id="local-6989586621684569964"><span id="local-6989586621684569965"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#defaultOperations"><span class="hs-identifier hs-type">defaultOperations</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Operations"><span class="hs-identifier hs-type">Operations</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569965"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569964"><span class="hs-identifier hs-type">s</span></a></span></span></span><span>
</span><span id="line-147"></span><span id="defaultOperations"><span class="annot"><span class="annottext">defaultOperations :: forall op s. Operations op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#defaultOperations"><span class="hs-identifier hs-var hs-var">defaultOperations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><span class="annottext">Operations :: forall op s.
WriteScalar op s
-&gt; ReadScalar op s
-&gt; Allocate op s
-&gt; Copy op s
-&gt; StaticArray op s
-&gt; OpCompiler op s
-&gt; EntryOutput op s
-&gt; EntryInput op s
-&gt; Operations op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#Operations"><span class="hs-identifier hs-type">Operations</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">opsWriteScalar :: WriteScalar op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsWriteScalar"><span class="hs-identifier hs-var">opsWriteScalar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WriteScalar op s
forall {p} {p} {p} {p} {p} {a}. p -&gt; p -&gt; p -&gt; p -&gt; p -&gt; a
</span><a href="#local-6989586621684569359"><span class="hs-identifier hs-var">defWriteScalar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-150"></span><span>      </span><span class="annot"><span class="annottext">opsReadScalar :: ReadScalar op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsReadScalar"><span class="hs-identifier hs-var">opsReadScalar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReadScalar op s
forall {p} {p} {p} {p} {a}. p -&gt; p -&gt; p -&gt; p -&gt; a
</span><a href="#local-6989586621684569358"><span class="hs-identifier hs-var">defReadScalar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-151"></span><span>      </span><span class="annot"><span class="annottext">opsAllocate :: Allocate op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsAllocate"><span class="hs-identifier hs-var">opsAllocate</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Allocate op s
forall {p} {p} {p} {a}. p -&gt; p -&gt; p -&gt; a
</span><a href="#local-6989586621684569357"><span class="hs-identifier hs-var">defAllocate</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-152"></span><span>      </span><span class="annot"><span class="annottext">opsCopy :: Copy op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsCopy"><span class="hs-identifier hs-var">opsCopy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Copy op s
forall {p} {p} {p} {p} {p} {p} {p} {p} {a}.
p -&gt; p -&gt; p -&gt; p -&gt; p -&gt; p -&gt; p -&gt; p -&gt; a
</span><a href="#local-6989586621684569356"><span class="hs-identifier hs-var">defCopy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-153"></span><span>      </span><span class="annot"><span class="annottext">opsStaticArray :: StaticArray op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsStaticArray"><span class="hs-identifier hs-var">opsStaticArray</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StaticArray op s
forall {p} {p} {p} {p} {a}. p -&gt; p -&gt; p -&gt; p -&gt; a
</span><a href="#local-6989586621684569355"><span class="hs-identifier hs-var">defStaticArray</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-154"></span><span>      </span><span class="annot"><span class="annottext">opsCompiler :: OpCompiler op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsCompiler"><span class="hs-identifier hs-var">opsCompiler</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpCompiler op s
forall {p} {a}. p -&gt; a
</span><a href="#local-6989586621684569354"><span class="hs-identifier hs-var">defCompiler</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-155"></span><span>      </span><span class="annot"><span class="annottext">opsEntryOutput :: EntryOutput op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsEntryOutput"><span class="hs-identifier hs-var">opsEntryOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntryOutput op s
forall {p} {p} {p} {p} {a}. p -&gt; p -&gt; p -&gt; p -&gt; a
</span><a href="#local-6989586621684569353"><span class="hs-identifier hs-var">defEntryOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-156"></span><span>      </span><span class="annot"><span class="annottext">opsEntryInput :: EntryInput op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsEntryInput"><span class="hs-identifier hs-var">opsEntryInput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntryInput op s
forall {p} {p} {p} {p} {a}. p -&gt; p -&gt; p -&gt; p -&gt; a
</span><a href="#local-6989586621684569352"><span class="hs-identifier hs-var">defEntryInput</span></a></span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-159"></span><span>    </span><span id="local-6989586621684569359"><span class="annot"><span class="annottext">defWriteScalar :: p -&gt; p -&gt; p -&gt; p -&gt; p -&gt; a
</span><a href="#local-6989586621684569359"><span class="hs-identifier hs-var hs-var">defWriteScalar</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-160"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; a
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Cannot write to non-default memory space because I am dumb&quot;</span></span><span>
</span><span id="line-161"></span><span>    </span><span id="local-6989586621684569358"><span class="annot"><span class="annottext">defReadScalar :: p -&gt; p -&gt; p -&gt; p -&gt; a
</span><a href="#local-6989586621684569358"><span class="hs-identifier hs-var hs-var">defReadScalar</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-162"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; a
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Cannot read from non-default memory space&quot;</span></span><span>
</span><span id="line-163"></span><span>    </span><span id="local-6989586621684569357"><span class="annot"><span class="annottext">defAllocate :: p -&gt; p -&gt; p -&gt; a
</span><a href="#local-6989586621684569357"><span class="hs-identifier hs-var hs-var">defAllocate</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-164"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; a
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Cannot allocate in non-default memory space&quot;</span></span><span>
</span><span id="line-165"></span><span>    </span><span id="local-6989586621684569356"><span class="annot"><span class="annottext">defCopy :: p -&gt; p -&gt; p -&gt; p -&gt; p -&gt; p -&gt; p -&gt; p -&gt; a
</span><a href="#local-6989586621684569356"><span class="hs-identifier hs-var hs-var">defCopy</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-166"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; a
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Cannot copy to or from non-default memory space&quot;</span></span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621684569355"><span class="annot"><span class="annottext">defStaticArray :: p -&gt; p -&gt; p -&gt; p -&gt; a
</span><a href="#local-6989586621684569355"><span class="hs-identifier hs-var hs-var">defStaticArray</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-168"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; a
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Cannot create static array in non-default memory space&quot;</span></span><span>
</span><span id="line-169"></span><span>    </span><span id="local-6989586621684569354"><span class="annot"><span class="annottext">defCompiler :: p -&gt; a
</span><a href="#local-6989586621684569354"><span class="hs-identifier hs-var hs-var">defCompiler</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-170"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; a
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;The default compiler cannot compile extended operations&quot;</span></span><span>
</span><span id="line-171"></span><span>    </span><span id="local-6989586621684569353"><span class="annot"><span class="annottext">defEntryOutput :: p -&gt; p -&gt; p -&gt; p -&gt; a
</span><a href="#local-6989586621684569353"><span class="hs-identifier hs-var hs-var">defEntryOutput</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-172"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; a
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Cannot return array not in default memory space&quot;</span></span><span>
</span><span id="line-173"></span><span>    </span><span id="local-6989586621684569352"><span class="annot"><span class="annottext">defEntryInput :: p -&gt; p -&gt; p -&gt; p -&gt; a
</span><a href="#local-6989586621684569352"><span class="hs-identifier hs-var hs-var">defEntryInput</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-174"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; a
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Cannot accept array not in default memory space&quot;</span></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-keyword">data</span><span> </span><span id="CompilerEnv"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerEnv"><span class="hs-identifier hs-var">CompilerEnv</span></a></span></span><span> </span><span id="local-6989586621684569917"><span class="annot"><a href="#local-6989586621684569917"><span class="hs-identifier hs-type">op</span></a></span></span><span> </span><span id="local-6989586621684569916"><span class="annot"><a href="#local-6989586621684569916"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CompilerEnv"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerEnv"><span class="hs-identifier hs-var">CompilerEnv</span></a></span></span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="envOperations"><span class="annot"><span class="annottext">forall op s. CompilerEnv op s -&gt; Operations op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envOperations"><span class="hs-identifier hs-var hs-var">envOperations</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Operations"><span class="hs-identifier hs-type">Operations</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569917"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569916"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-178"></span><span>    </span><span id="envVarExp"><span class="annot"><span class="annottext">forall op s. CompilerEnv op s -&gt; Map VName PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envVarExp"><span class="hs-identifier hs-var hs-var">envVarExp</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span id="local-6989586621684569907"><span id="local-6989586621684569908"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#envOpCompiler"><span class="hs-identifier hs-type">envOpCompiler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerEnv"><span class="hs-identifier hs-type">CompilerEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569908"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569907"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#OpCompiler"><span class="hs-identifier hs-type">OpCompiler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569908"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569907"><span class="hs-identifier hs-type">s</span></a></span></span></span><span>
</span><span id="line-182"></span><span id="envOpCompiler"><span class="annot"><span class="annottext">envOpCompiler :: forall op s. CompilerEnv op s -&gt; OpCompiler op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envOpCompiler"><span class="hs-identifier hs-var hs-var">envOpCompiler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operations op s -&gt; OpCompiler op s
forall op s. Operations op s -&gt; OpCompiler op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsCompiler"><span class="hs-identifier hs-var hs-var">opsCompiler</span></a></span><span> </span><span class="annot"><span class="annottext">(Operations op s -&gt; OpCompiler op s)
-&gt; (CompilerEnv op s -&gt; Operations op s)
-&gt; CompilerEnv op s
-&gt; OpCompiler op s
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CompilerEnv op s -&gt; Operations op s
forall op s. CompilerEnv op s -&gt; Operations op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envOperations"><span class="hs-identifier hs-var hs-var">envOperations</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span id="local-6989586621684569900"><span id="local-6989586621684569901"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#envReadScalar"><span class="hs-identifier hs-type">envReadScalar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerEnv"><span class="hs-identifier hs-type">CompilerEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569901"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569900"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#ReadScalar"><span class="hs-identifier hs-type">ReadScalar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569901"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569900"><span class="hs-identifier hs-type">s</span></a></span></span></span><span>
</span><span id="line-185"></span><span id="envReadScalar"><span class="annot"><span class="annottext">envReadScalar :: forall op s. CompilerEnv op s -&gt; ReadScalar op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envReadScalar"><span class="hs-identifier hs-var hs-var">envReadScalar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operations op s -&gt; ReadScalar op s
forall op s. Operations op s -&gt; ReadScalar op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsReadScalar"><span class="hs-identifier hs-var hs-var">opsReadScalar</span></a></span><span> </span><span class="annot"><span class="annottext">(Operations op s -&gt; ReadScalar op s)
-&gt; (CompilerEnv op s -&gt; Operations op s)
-&gt; CompilerEnv op s
-&gt; ReadScalar op s
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CompilerEnv op s -&gt; Operations op s
forall op s. CompilerEnv op s -&gt; Operations op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envOperations"><span class="hs-identifier hs-var hs-var">envOperations</span></a></span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span id="local-6989586621684569896"><span id="local-6989586621684569897"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#envWriteScalar"><span class="hs-identifier hs-type">envWriteScalar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerEnv"><span class="hs-identifier hs-type">CompilerEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569897"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569896"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#WriteScalar"><span class="hs-identifier hs-type">WriteScalar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569897"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569896"><span class="hs-identifier hs-type">s</span></a></span></span></span><span>
</span><span id="line-188"></span><span id="envWriteScalar"><span class="annot"><span class="annottext">envWriteScalar :: forall op s. CompilerEnv op s -&gt; WriteScalar op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envWriteScalar"><span class="hs-identifier hs-var hs-var">envWriteScalar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operations op s -&gt; WriteScalar op s
forall op s. Operations op s -&gt; WriteScalar op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsWriteScalar"><span class="hs-identifier hs-var hs-var">opsWriteScalar</span></a></span><span> </span><span class="annot"><span class="annottext">(Operations op s -&gt; WriteScalar op s)
-&gt; (CompilerEnv op s -&gt; Operations op s)
-&gt; CompilerEnv op s
-&gt; WriteScalar op s
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CompilerEnv op s -&gt; Operations op s
forall op s. CompilerEnv op s -&gt; Operations op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envOperations"><span class="hs-identifier hs-var hs-var">envOperations</span></a></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span id="local-6989586621684569892"><span id="local-6989586621684569893"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#envAllocate"><span class="hs-identifier hs-type">envAllocate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerEnv"><span class="hs-identifier hs-type">CompilerEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569893"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569892"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Allocate"><span class="hs-identifier hs-type">Allocate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569893"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569892"><span class="hs-identifier hs-type">s</span></a></span></span></span><span>
</span><span id="line-191"></span><span id="envAllocate"><span class="annot"><span class="annottext">envAllocate :: forall op s. CompilerEnv op s -&gt; Allocate op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envAllocate"><span class="hs-identifier hs-var hs-var">envAllocate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operations op s -&gt; Allocate op s
forall op s. Operations op s -&gt; Allocate op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsAllocate"><span class="hs-identifier hs-var hs-var">opsAllocate</span></a></span><span> </span><span class="annot"><span class="annottext">(Operations op s -&gt; Allocate op s)
-&gt; (CompilerEnv op s -&gt; Operations op s)
-&gt; CompilerEnv op s
-&gt; Allocate op s
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CompilerEnv op s -&gt; Operations op s
forall op s. CompilerEnv op s -&gt; Operations op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envOperations"><span class="hs-identifier hs-var hs-var">envOperations</span></a></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span id="local-6989586621684569888"><span id="local-6989586621684569889"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#envCopy"><span class="hs-identifier hs-type">envCopy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerEnv"><span class="hs-identifier hs-type">CompilerEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569889"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569888"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Copy"><span class="hs-identifier hs-type">Copy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569889"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569888"><span class="hs-identifier hs-type">s</span></a></span></span></span><span>
</span><span id="line-194"></span><span id="envCopy"><span class="annot"><span class="annottext">envCopy :: forall op s. CompilerEnv op s -&gt; Copy op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envCopy"><span class="hs-identifier hs-var hs-var">envCopy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operations op s -&gt; Copy op s
forall op s. Operations op s -&gt; Copy op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsCopy"><span class="hs-identifier hs-var hs-var">opsCopy</span></a></span><span> </span><span class="annot"><span class="annottext">(Operations op s -&gt; Copy op s)
-&gt; (CompilerEnv op s -&gt; Operations op s)
-&gt; CompilerEnv op s
-&gt; Copy op s
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CompilerEnv op s -&gt; Operations op s
forall op s. CompilerEnv op s -&gt; Operations op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envOperations"><span class="hs-identifier hs-var hs-var">envOperations</span></a></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span id="local-6989586621684569884"><span id="local-6989586621684569885"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#envStaticArray"><span class="hs-identifier hs-type">envStaticArray</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerEnv"><span class="hs-identifier hs-type">CompilerEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569885"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569884"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#StaticArray"><span class="hs-identifier hs-type">StaticArray</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569885"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569884"><span class="hs-identifier hs-type">s</span></a></span></span></span><span>
</span><span id="line-197"></span><span id="envStaticArray"><span class="annot"><span class="annottext">envStaticArray :: forall op s. CompilerEnv op s -&gt; StaticArray op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envStaticArray"><span class="hs-identifier hs-var hs-var">envStaticArray</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operations op s -&gt; StaticArray op s
forall op s. Operations op s -&gt; StaticArray op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsStaticArray"><span class="hs-identifier hs-var hs-var">opsStaticArray</span></a></span><span> </span><span class="annot"><span class="annottext">(Operations op s -&gt; StaticArray op s)
-&gt; (CompilerEnv op s -&gt; Operations op s)
-&gt; CompilerEnv op s
-&gt; StaticArray op s
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CompilerEnv op s -&gt; Operations op s
forall op s. CompilerEnv op s -&gt; Operations op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envOperations"><span class="hs-identifier hs-var hs-var">envOperations</span></a></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span id="local-6989586621684569880"><span id="local-6989586621684569881"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#envEntryOutput"><span class="hs-identifier hs-type">envEntryOutput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerEnv"><span class="hs-identifier hs-type">CompilerEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569881"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569880"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#EntryOutput"><span class="hs-identifier hs-type">EntryOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569881"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569880"><span class="hs-identifier hs-type">s</span></a></span></span></span><span>
</span><span id="line-200"></span><span id="envEntryOutput"><span class="annot"><span class="annottext">envEntryOutput :: forall op s. CompilerEnv op s -&gt; EntryOutput op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envEntryOutput"><span class="hs-identifier hs-var hs-var">envEntryOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operations op s -&gt; EntryOutput op s
forall op s. Operations op s -&gt; EntryOutput op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsEntryOutput"><span class="hs-identifier hs-var hs-var">opsEntryOutput</span></a></span><span> </span><span class="annot"><span class="annottext">(Operations op s -&gt; EntryOutput op s)
-&gt; (CompilerEnv op s -&gt; Operations op s)
-&gt; CompilerEnv op s
-&gt; EntryOutput op s
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CompilerEnv op s -&gt; Operations op s
forall op s. CompilerEnv op s -&gt; Operations op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envOperations"><span class="hs-identifier hs-var hs-var">envOperations</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span id="local-6989586621684569876"><span id="local-6989586621684569877"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#envEntryInput"><span class="hs-identifier hs-type">envEntryInput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerEnv"><span class="hs-identifier hs-type">CompilerEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569877"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569876"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#EntryInput"><span class="hs-identifier hs-type">EntryInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569877"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569876"><span class="hs-identifier hs-type">s</span></a></span></span></span><span>
</span><span id="line-203"></span><span id="envEntryInput"><span class="annot"><span class="annottext">envEntryInput :: forall op s. CompilerEnv op s -&gt; EntryInput op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envEntryInput"><span class="hs-identifier hs-var hs-var">envEntryInput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operations op s -&gt; EntryInput op s
forall op s. Operations op s -&gt; EntryInput op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opsEntryInput"><span class="hs-identifier hs-var hs-var">opsEntryInput</span></a></span><span> </span><span class="annot"><span class="annottext">(Operations op s -&gt; EntryInput op s)
-&gt; (CompilerEnv op s -&gt; Operations op s)
-&gt; CompilerEnv op s
-&gt; EntryInput op s
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CompilerEnv op s -&gt; Operations op s
forall op s. CompilerEnv op s -&gt; Operations op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envOperations"><span class="hs-identifier hs-var hs-var">envOperations</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span id="local-6989586621684569872"><span id="local-6989586621684569873"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#newCompilerEnv"><span class="hs-identifier hs-type">newCompilerEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Operations"><span class="hs-identifier hs-type">Operations</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569873"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569872"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerEnv"><span class="hs-identifier hs-type">CompilerEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569873"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569872"><span class="hs-identifier hs-type">s</span></a></span></span></span><span>
</span><span id="line-206"></span><span id="newCompilerEnv"><span class="annot"><span class="annottext">newCompilerEnv :: forall op s. Operations op s -&gt; CompilerEnv op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#newCompilerEnv"><span class="hs-identifier hs-var hs-var">newCompilerEnv</span></a></span></span><span> </span><span id="local-6989586621684569317"><span class="annot"><span class="annottext">Operations op s
</span><a href="#local-6989586621684569317"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-207"></span><span>  </span><span class="annot"><span class="annottext">CompilerEnv :: forall op s. Operations op s -&gt; Map VName PyExp -&gt; CompilerEnv op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerEnv"><span class="hs-identifier hs-type">CompilerEnv</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">envOperations :: Operations op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envOperations"><span class="hs-identifier hs-var">envOperations</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operations op s
</span><a href="#local-6989586621684569317"><span class="hs-identifier hs-var">ops</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-209"></span><span>      </span><span class="annot"><span class="annottext">envVarExp :: Map VName PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envVarExp"><span class="hs-identifier hs-var">envVarExp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map VName PyExp
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-keyword">data</span><span> </span><span id="CompilerState"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerState"><span class="hs-identifier hs-var">CompilerState</span></a></span></span><span> </span><span id="local-6989586621684569866"><span class="annot"><a href="#local-6989586621684569866"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CompilerState"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerState"><span class="hs-identifier hs-var">CompilerState</span></a></span></span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="compNameSrc"><span class="annot"><span class="annottext">forall s. CompilerState s -&gt; VNameSource
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compNameSrc"><span class="hs-identifier hs-var hs-var">compNameSrc</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.FreshNames.html#VNameSource"><span class="hs-identifier hs-type">VNameSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-214"></span><span>    </span><span id="compInit"><span class="annot"><span class="annottext">forall s. CompilerState s -&gt; [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compInit"><span class="hs-identifier hs-var hs-var">compInit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-215"></span><span>    </span><span id="compUserState"><span class="annot"><span class="annottext">forall s. CompilerState s -&gt; s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compUserState"><span class="hs-identifier hs-var hs-var">compUserState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621684569866"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span id="local-6989586621684569860"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#newCompilerState"><span class="hs-identifier hs-type">newCompilerState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.FreshNames.html#VNameSource"><span class="hs-identifier hs-type">VNameSource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621684569860"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerState"><span class="hs-identifier hs-type">CompilerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569860"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-219"></span><span id="newCompilerState"><span class="annot"><span class="annottext">newCompilerState :: forall s. VNameSource -&gt; s -&gt; CompilerState s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#newCompilerState"><span class="hs-identifier hs-var hs-var">newCompilerState</span></a></span></span><span> </span><span id="local-6989586621684569311"><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684569311"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621684569310"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621684569310"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-220"></span><span>  </span><span class="annot"><span class="annottext">CompilerState :: forall s. VNameSource -&gt; [PyStmt] -&gt; s -&gt; CompilerState s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerState"><span class="hs-identifier hs-type">CompilerState</span></a></span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">compNameSrc :: VNameSource
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compNameSrc"><span class="hs-identifier hs-var">compNameSrc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684569311"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-222"></span><span>      </span><span class="annot"><span class="annottext">compInit :: [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compInit"><span class="hs-identifier hs-var">compInit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-223"></span><span>      </span><span class="annot"><span class="annottext">compUserState :: s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compUserState"><span class="hs-identifier hs-var">compUserState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621684569310"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="hs-keyword">newtype</span><span> </span><span id="CompilerM"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-var">CompilerM</span></a></span></span><span> </span><span id="local-6989586621684569839"><span class="annot"><a href="#local-6989586621684569839"><span class="hs-identifier hs-type">op</span></a></span></span><span> </span><span id="local-6989586621684569838"><span class="annot"><a href="#local-6989586621684569838"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621684569309"><span class="annot"><a href="#local-6989586621684569309"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CompilerM"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-var">CompilerM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RWS</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerEnv"><span class="hs-identifier hs-type">CompilerEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569839"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569838"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerState"><span class="hs-identifier hs-type">CompilerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569838"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621684569309"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-keyword">deriving</span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-special">(</span><span> </span><span id="local-6989586621684569300"><span id="local-6989586621684569306"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; CompilerM op s a -&gt; CompilerM op s b)
-&gt; (forall a b. a -&gt; CompilerM op s b -&gt; CompilerM op s a)
-&gt; Functor (CompilerM op s)
forall a b. a -&gt; CompilerM op s b -&gt; CompilerM op s a
forall a b. (a -&gt; b) -&gt; CompilerM op s a -&gt; CompilerM op s b
forall op s a b. a -&gt; CompilerM op s b -&gt; CompilerM op s a
forall op s a b. (a -&gt; b) -&gt; CompilerM op s a -&gt; CompilerM op s b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: forall a b. a -&gt; CompilerM op s b -&gt; CompilerM op s a
$c&lt;$ :: forall op s a b. a -&gt; CompilerM op s b -&gt; CompilerM op s a
fmap :: forall a b. (a -&gt; b) -&gt; CompilerM op s a -&gt; CompilerM op s b
$cfmap :: forall op s a b. (a -&gt; b) -&gt; CompilerM op s a -&gt; CompilerM op s b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-229"></span><span>      </span><span id="local-6989586621684569261"><span id="local-6989586621684569268"><span id="local-6989586621684569275"><span id="local-6989586621684569282"><span id="local-6989586621684569290"><span class="annot"><span class="annottext">Functor (CompilerM op s)
Functor (CompilerM op s)
-&gt; (forall a. a -&gt; CompilerM op s a)
-&gt; (forall a b.
    CompilerM op s (a -&gt; b) -&gt; CompilerM op s a -&gt; CompilerM op s b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c)
    -&gt; CompilerM op s a -&gt; CompilerM op s b -&gt; CompilerM op s c)
-&gt; (forall a b.
    CompilerM op s a -&gt; CompilerM op s b -&gt; CompilerM op s b)
-&gt; (forall a b.
    CompilerM op s a -&gt; CompilerM op s b -&gt; CompilerM op s a)
-&gt; Applicative (CompilerM op s)
forall a. a -&gt; CompilerM op s a
forall op s. Functor (CompilerM op s)
forall a b.
CompilerM op s a -&gt; CompilerM op s b -&gt; CompilerM op s a
forall a b.
CompilerM op s a -&gt; CompilerM op s b -&gt; CompilerM op s b
forall a b.
CompilerM op s (a -&gt; b) -&gt; CompilerM op s a -&gt; CompilerM op s b
forall op s a. a -&gt; CompilerM op s a
forall a b c.
(a -&gt; b -&gt; c)
-&gt; CompilerM op s a -&gt; CompilerM op s b -&gt; CompilerM op s c
forall op s a b.
CompilerM op s a -&gt; CompilerM op s b -&gt; CompilerM op s a
forall op s a b.
CompilerM op s a -&gt; CompilerM op s b -&gt; CompilerM op s b
forall op s a b.
CompilerM op s (a -&gt; b) -&gt; CompilerM op s a -&gt; CompilerM op s b
forall op s a b c.
(a -&gt; b -&gt; c)
-&gt; CompilerM op s a -&gt; CompilerM op s b -&gt; CompilerM op s c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
&lt;* :: forall a b.
CompilerM op s a -&gt; CompilerM op s b -&gt; CompilerM op s a
$c&lt;* :: forall op s a b.
CompilerM op s a -&gt; CompilerM op s b -&gt; CompilerM op s a
*&gt; :: forall a b.
CompilerM op s a -&gt; CompilerM op s b -&gt; CompilerM op s b
$c*&gt; :: forall op s a b.
CompilerM op s a -&gt; CompilerM op s b -&gt; CompilerM op s b
liftA2 :: forall a b c.
(a -&gt; b -&gt; c)
-&gt; CompilerM op s a -&gt; CompilerM op s b -&gt; CompilerM op s c
$cliftA2 :: forall op s a b c.
(a -&gt; b -&gt; c)
-&gt; CompilerM op s a -&gt; CompilerM op s b -&gt; CompilerM op s c
&lt;*&gt; :: forall a b.
CompilerM op s (a -&gt; b) -&gt; CompilerM op s a -&gt; CompilerM op s b
$c&lt;*&gt; :: forall op s a b.
CompilerM op s (a -&gt; b) -&gt; CompilerM op s a -&gt; CompilerM op s b
pure :: forall a. a -&gt; CompilerM op s a
$cpure :: forall op s a. a -&gt; CompilerM op s a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-230"></span><span>      </span><span id="local-6989586621684569235"><span id="local-6989586621684569241"><span id="local-6989586621684569248"><span class="annot"><span class="annottext">Applicative (CompilerM op s)
Applicative (CompilerM op s)
-&gt; (forall a b.
    CompilerM op s a -&gt; (a -&gt; CompilerM op s b) -&gt; CompilerM op s b)
-&gt; (forall a b.
    CompilerM op s a -&gt; CompilerM op s b -&gt; CompilerM op s b)
-&gt; (forall a. a -&gt; CompilerM op s a)
-&gt; Monad (CompilerM op s)
forall a. a -&gt; CompilerM op s a
forall op s. Applicative (CompilerM op s)
forall a b.
CompilerM op s a -&gt; CompilerM op s b -&gt; CompilerM op s b
forall a b.
CompilerM op s a -&gt; (a -&gt; CompilerM op s b) -&gt; CompilerM op s b
forall op s a. a -&gt; CompilerM op s a
forall op s a b.
CompilerM op s a -&gt; CompilerM op s b -&gt; CompilerM op s b
forall op s a b.
CompilerM op s a -&gt; (a -&gt; CompilerM op s b) -&gt; CompilerM op s b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
return :: forall a. a -&gt; CompilerM op s a
$creturn :: forall op s a. a -&gt; CompilerM op s a
&gt;&gt; :: forall a b.
CompilerM op s a -&gt; CompilerM op s b -&gt; CompilerM op s b
$c&gt;&gt; :: forall op s a b.
CompilerM op s a -&gt; CompilerM op s b -&gt; CompilerM op s b
&gt;&gt;= :: forall a b.
CompilerM op s a -&gt; (a -&gt; CompilerM op s b) -&gt; CompilerM op s b
$c&gt;&gt;= :: forall op s a b.
CompilerM op s a -&gt; (a -&gt; CompilerM op s b) -&gt; CompilerM op s b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-231"></span><span>      </span><span id="local-6989586621684569212"><span id="local-6989586621684569218"><span id="local-6989586621684569225"><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerState"><span class="hs-identifier hs-type">CompilerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569838"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-232"></span><span>      </span><span id="local-6989586621684569189"><span id="local-6989586621684569195"><span id="local-6989586621684569202"><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerEnv"><span class="hs-identifier hs-type">CompilerEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569839"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569838"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-233"></span><span>      </span><span id="local-6989586621684569158"><span id="local-6989586621684569164"><span id="local-6989586621684569170"><span id="local-6989586621684569177"><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">]</span></span></span></span></span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span id="local-6989586621684569748"><span id="local-6989586621684569749"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Futhark.MonadFreshNames.html#MonadFreshNames"><span class="hs-identifier hs-type">MonadFreshNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569749"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569748"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-237"></span><span>  </span><span id="local-6989586621684569142"><span class="annot"><span class="annottext">getNameSource :: CompilerM op s VNameSource
</span><a href="Futhark.MonadFreshNames.html#getNameSource"><span class="hs-identifier hs-var hs-var hs-var hs-var">getNameSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CompilerState s -&gt; VNameSource) -&gt; CompilerM op s VNameSource
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">CompilerState s -&gt; VNameSource
forall s. CompilerState s -&gt; VNameSource
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compNameSrc"><span class="hs-identifier hs-var hs-var">compNameSrc</span></a></span><span>
</span><span id="line-238"></span><span>  </span><span id="local-6989586621684569138"><span class="annot"><span class="annottext">putNameSource :: VNameSource -&gt; CompilerM op s ()
</span><a href="Futhark.MonadFreshNames.html#putNameSource"><span class="hs-identifier hs-var hs-var hs-var hs-var">putNameSource</span></a></span></span><span> </span><span id="local-6989586621684569136"><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684569136"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CompilerState s -&gt; CompilerState s) -&gt; CompilerM op s ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((CompilerState s -&gt; CompilerState s) -&gt; CompilerM op s ())
-&gt; (CompilerState s -&gt; CompilerState s) -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684569134"><span class="annot"><span class="annottext">CompilerState s
</span><a href="#local-6989586621684569134"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompilerState s
</span><a href="#local-6989586621684569134"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">compNameSrc :: VNameSource
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compNameSrc"><span class="hs-identifier hs-var">compNameSrc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684569136"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">}</span></span></span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span id="local-6989586621684569738"><span id="local-6989586621684569739"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#collect"><span class="hs-identifier hs-type">collect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569739"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569738"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569739"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569738"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-241"></span><span id="collect"><span class="annot"><span class="annottext">collect :: forall op s. CompilerM op s () -&gt; CompilerM op s [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#collect"><span class="hs-identifier hs-var hs-var">collect</span></a></span></span><span> </span><span id="local-6989586621684569128"><span class="annot"><span class="annottext">CompilerM op s ()
</span><a href="#local-6989586621684569128"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompilerM op s ([PyStmt], [PyStmt] -&gt; [PyStmt])
-&gt; CompilerM op s [PyStmt]
forall w (m :: * -&gt; *) a. MonadWriter w m =&gt; m (a, w -&gt; w) -&gt; m a
</span><span class="hs-identifier hs-var">pass</span></span><span> </span><span class="annot"><span class="annottext">(CompilerM op s ([PyStmt], [PyStmt] -&gt; [PyStmt])
 -&gt; CompilerM op s [PyStmt])
-&gt; CompilerM op s ([PyStmt], [PyStmt] -&gt; [PyStmt])
-&gt; CompilerM op s [PyStmt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621684569126"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684569126"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompilerM op s () -&gt; CompilerM op s ((), [PyStmt])
forall w (m :: * -&gt; *) a. MonadWriter w m =&gt; m a -&gt; m (a, w)
</span><span class="hs-identifier hs-var">listen</span></span><span> </span><span class="annot"><span class="annottext">CompilerM op s ()
</span><a href="#local-6989586621684569128"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-243"></span><span>  </span><span class="annot"><span class="annottext">([PyStmt], [PyStmt] -&gt; [PyStmt])
-&gt; CompilerM op s ([PyStmt], [PyStmt] -&gt; [PyStmt])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684569126"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span id="local-6989586621684569121"><span id="local-6989586621684569122"><span id="local-6989586621684569123"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#collect%27"><span class="hs-identifier hs-type">collect'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569123"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569122"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569121"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569123"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569122"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621684569121"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-246"></span><span id="collect%27"><span class="annot"><span class="annottext">collect' :: forall op s a. CompilerM op s a -&gt; CompilerM op s (a, [PyStmt])
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#collect%27"><span class="hs-identifier hs-var hs-var">collect'</span></a></span></span><span> </span><span id="local-6989586621684569115"><span class="annot"><span class="annottext">CompilerM op s a
</span><a href="#local-6989586621684569115"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompilerM op s ((a, [PyStmt]), [PyStmt] -&gt; [PyStmt])
-&gt; CompilerM op s (a, [PyStmt])
forall w (m :: * -&gt; *) a. MonadWriter w m =&gt; m (a, w -&gt; w) -&gt; m a
</span><span class="hs-identifier hs-var">pass</span></span><span> </span><span class="annot"><span class="annottext">(CompilerM op s ((a, [PyStmt]), [PyStmt] -&gt; [PyStmt])
 -&gt; CompilerM op s (a, [PyStmt]))
-&gt; CompilerM op s ((a, [PyStmt]), [PyStmt] -&gt; [PyStmt])
-&gt; CompilerM op s (a, [PyStmt])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684569114"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684569114"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684569113"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684569113"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompilerM op s a -&gt; CompilerM op s (a, [PyStmt])
forall w (m :: * -&gt; *) a. MonadWriter w m =&gt; m a -&gt; m (a, w)
</span><span class="hs-identifier hs-var">listen</span></span><span> </span><span class="annot"><span class="annottext">CompilerM op s a
</span><a href="#local-6989586621684569115"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-248"></span><span>  </span><span class="annot"><span class="annottext">((a, [PyStmt]), [PyStmt] -&gt; [PyStmt])
-&gt; CompilerM op s ((a, [PyStmt]), [PyStmt] -&gt; [PyStmt])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684569114"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684569113"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span id="local-6989586621684569729"><span id="local-6989586621684569730"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#atInit"><span class="hs-identifier hs-type">atInit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569730"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569729"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-251"></span><span id="atInit"><span class="annot"><span class="annottext">atInit :: forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#atInit"><span class="hs-identifier hs-var hs-var">atInit</span></a></span></span><span> </span><span id="local-6989586621684569111"><span class="annot"><span class="annottext">PyStmt
</span><a href="#local-6989586621684569111"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CompilerState s -&gt; CompilerState s) -&gt; CompilerM op s ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((CompilerState s -&gt; CompilerState s) -&gt; CompilerM op s ())
-&gt; (CompilerState s -&gt; CompilerState s) -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684569110"><span class="annot"><span class="annottext">CompilerState s
</span><a href="#local-6989586621684569110"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-252"></span><span>  </span><span class="annot"><span class="annottext">CompilerState s
</span><a href="#local-6989586621684569110"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">compInit :: [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compInit"><span class="hs-identifier hs-var">compInit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompilerState s -&gt; [PyStmt]
forall s. CompilerState s -&gt; [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compInit"><span class="hs-identifier hs-var hs-var">compInit</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerState s
</span><a href="#local-6989586621684569110"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyStmt
</span><a href="#local-6989586621684569111"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span id="local-6989586621684569108"><span id="local-6989586621684569109"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-type">stm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569109"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569108"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-255"></span><span id="stm"><span class="annot"><span class="annottext">stm :: forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var hs-var">stm</span></a></span></span><span> </span><span id="local-6989586621684569106"><span class="annot"><span class="annottext">PyStmt
</span><a href="#local-6989586621684569106"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PyStmt] -&gt; CompilerM op s ()
forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><span class="hs-identifier hs-var">tell</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyStmt
</span><a href="#local-6989586621684569106"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#futharkFun"><span class="hs-identifier hs-type">futharkFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-258"></span><span id="futharkFun"><span class="annot"><span class="annottext">futharkFun :: [Char] -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#futharkFun"><span class="hs-identifier hs-var hs-var">futharkFun</span></a></span></span><span> </span><span id="local-6989586621684569103"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684569103"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;futhark_&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="Futhark.Util.html#zEncodeString"><span class="hs-identifier hs-var">zEncodeString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684569103"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileOutput"><span class="hs-identifier hs-type">compileOutput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Param"><span class="hs-identifier hs-type">Imp.Param</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-261"></span><span id="compileOutput"><span class="annot"><span class="annottext">compileOutput :: [Param] -&gt; [PyExp]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileOutput"><span class="hs-identifier hs-var hs-var">compileOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Param -&gt; PyExp) -&gt; [Param] -&gt; [PyExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; (Param -&gt; [Char]) -&gt; Param -&gt; PyExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileName"><span class="hs-identifier hs-var">compileName</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; [Char]) -&gt; (Param -&gt; VName) -&gt; Param -&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Param -&gt; VName
</span><a href="Futhark.CodeGen.ImpCode.html#paramName"><span class="hs-identifier hs-var">Imp.paramName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span id="local-6989586621684569718"><span id="local-6989586621684569719"><span id="local-6989586621684569720"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#runCompilerM"><span class="hs-identifier hs-type">runCompilerM</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-264"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Operations"><span class="hs-identifier hs-type">Operations</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569720"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569719"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-265"></span><span>  </span><span class="annot"><a href="Futhark.FreshNames.html#VNameSource"><span class="hs-identifier hs-type">VNameSource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-266"></span><span>  </span><span class="annot"><a href="#local-6989586621684569719"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-267"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569720"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569719"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569718"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-268"></span><span>  </span><span class="annot"><a href="#local-6989586621684569718"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-269"></span><span id="runCompilerM"><span class="annot"><span class="annottext">runCompilerM :: forall op s a.
Operations op s -&gt; VNameSource -&gt; s -&gt; CompilerM op s a -&gt; a
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#runCompilerM"><span class="hs-identifier hs-var hs-var">runCompilerM</span></a></span></span><span> </span><span id="local-6989586621684569098"><span class="annot"><span class="annottext">Operations op s
</span><a href="#local-6989586621684569098"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span id="local-6989586621684569097"><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684569097"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621684569096"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621684569096"><span class="hs-identifier hs-var">userstate</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span id="local-6989586621684569095"><span class="annot"><span class="annottext">RWS (CompilerEnv op s) [PyStmt] (CompilerState s) a
</span><a href="#local-6989586621684569095"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-270"></span><span>  </span><span class="annot"><span class="annottext">(a, [PyStmt]) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((a, [PyStmt]) -&gt; a) -&gt; (a, [PyStmt]) -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RWS (CompilerEnv op s) [PyStmt] (CompilerState s) a
-&gt; CompilerEnv op s -&gt; CompilerState s -&gt; (a, [PyStmt])
forall r w s a. RWS r w s a -&gt; r -&gt; s -&gt; (a, w)
</span><span class="hs-identifier hs-var">evalRWS</span></span><span> </span><span class="annot"><span class="annottext">RWS (CompilerEnv op s) [PyStmt] (CompilerState s) a
</span><a href="#local-6989586621684569095"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operations op s -&gt; CompilerEnv op s
forall op s. Operations op s -&gt; CompilerEnv op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#newCompilerEnv"><span class="hs-identifier hs-var">newCompilerEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Operations op s
</span><a href="#local-6989586621684569098"><span class="hs-identifier hs-var">ops</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VNameSource -&gt; s -&gt; CompilerState s
forall s. VNameSource -&gt; s -&gt; CompilerState s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#newCompilerState"><span class="hs-identifier hs-var">newCompilerState</span></a></span><span> </span><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684569097"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621684569096"><span class="hs-identifier hs-var">userstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#standardOptions"><span class="hs-identifier hs-type">standardOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-273"></span><span id="standardOptions"><span class="annot"><span class="annottext">standardOptions :: [Option]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#standardOptions"><span class="hs-identifier hs-var hs-var">standardOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Option :: [Char] -&gt; Maybe Char -&gt; OptionArgument -&gt; [PyStmt] -&gt; Option
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span>
</span><span id="line-275"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">optionLongName :: [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionLongName"><span class="hs-identifier hs-var">optionLongName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tuning&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-276"></span><span>        </span><span class="annot"><span class="annottext">optionShortName :: Maybe Char
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionShortName"><span class="hs-identifier hs-var">optionShortName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Char
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-277"></span><span>        </span><span class="annot"><span class="annottext">optionArgument :: OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionArgument"><span class="hs-identifier hs-var">optionArgument</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#RequiredArgument"><span class="hs-identifier hs-var">RequiredArgument</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;open&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><span class="annottext">optionAction :: [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionAction"><span class="hs-identifier hs-var">optionAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;read_tuning_file&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;sizes&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;optarg&quot;</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-279"></span><span>      </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-280"></span><span>    </span><span class="annot"><span class="annottext">Option :: [Char] -&gt; Maybe Char -&gt; OptionArgument -&gt; [PyStmt] -&gt; Option
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span>
</span><span id="line-281"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">optionLongName :: [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionLongName"><span class="hs-identifier hs-var">optionLongName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;log&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-282"></span><span>        </span><span class="annot"><span class="annottext">optionShortName :: Maybe Char
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionShortName"><span class="hs-identifier hs-var">optionShortName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Maybe Char
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'L'</span></span><span class="hs-special">,</span><span>
</span><span id="line-283"></span><span>        </span><span class="annot"><span class="annottext">optionArgument :: OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionArgument"><span class="hs-identifier hs-var">optionArgument</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#NoArgument"><span class="hs-identifier hs-var">NoArgument</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-284"></span><span>        </span><span class="annot"><span class="annottext">optionAction :: [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionAction"><span class="hs-identifier hs-var">optionAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Pass"><span class="hs-identifier hs-var">Pass</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-285"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#executableOptions"><span class="hs-identifier hs-type">executableOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-289"></span><span id="executableOptions"><span class="annot"><span class="annottext">executableOptions :: [Option]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#executableOptions"><span class="hs-identifier hs-var hs-var">executableOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-290"></span><span>  </span><span class="annot"><span class="annottext">[Option]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#standardOptions"><span class="hs-identifier hs-var">standardOptions</span></a></span><span>
</span><span id="line-291"></span><span>    </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Option :: [Char] -&gt; Maybe Char -&gt; OptionArgument -&gt; [PyStmt] -&gt; Option
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span>
</span><span id="line-292"></span><span>           </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">optionLongName :: [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionLongName"><span class="hs-identifier hs-var">optionLongName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;write-runtime-to&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-293"></span><span>             </span><span class="annot"><span class="annottext">optionShortName :: Maybe Char
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionShortName"><span class="hs-identifier hs-var">optionShortName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Maybe Char
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'t'</span></span><span class="hs-special">,</span><span>
</span><span id="line-294"></span><span>             </span><span class="annot"><span class="annottext">optionArgument :: OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionArgument"><span class="hs-identifier hs-var">optionArgument</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#RequiredArgument"><span class="hs-identifier hs-var">RequiredArgument</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;str&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-295"></span><span>             </span><span class="annot"><span class="annottext">optionAction :: [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionAction"><span class="hs-identifier hs-var">optionAction</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-296"></span><span>               </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; [PyStmt] -&gt; [PyStmt] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#If"><span class="hs-identifier hs-var">If</span></a></span><span>
</span><span id="line-297"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;runtime_file&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>                   </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;runtime_file.close&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-299"></span><span>                   </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-300"></span><span>                 </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;runtime_file&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-301"></span><span>                   </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;open&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;optarg&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;w&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-302"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-303"></span><span>           </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-304"></span><span>         </span><span class="annot"><span class="annottext">Option :: [Char] -&gt; Maybe Char -&gt; OptionArgument -&gt; [PyStmt] -&gt; Option
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span>
</span><span id="line-305"></span><span>           </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">optionLongName :: [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionLongName"><span class="hs-identifier hs-var">optionLongName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;runs&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-306"></span><span>             </span><span class="annot"><span class="annottext">optionShortName :: Maybe Char
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionShortName"><span class="hs-identifier hs-var">optionShortName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Maybe Char
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'r'</span></span><span class="hs-special">,</span><span>
</span><span id="line-307"></span><span>             </span><span class="annot"><span class="annottext">optionArgument :: OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionArgument"><span class="hs-identifier hs-var">optionArgument</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#RequiredArgument"><span class="hs-identifier hs-var">RequiredArgument</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;str&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-308"></span><span>             </span><span class="annot"><span class="annottext">optionAction :: [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionAction"><span class="hs-identifier hs-var">optionAction</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-309"></span><span>               </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;num_runs&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;optarg&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-310"></span><span>                 </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;do_warmup_run&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Bool"><span class="hs-identifier hs-var">Bool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-311"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-312"></span><span>           </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-313"></span><span>         </span><span class="annot"><span class="annottext">Option :: [Char] -&gt; Maybe Char -&gt; OptionArgument -&gt; [PyStmt] -&gt; Option
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span>
</span><span id="line-314"></span><span>           </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">optionLongName :: [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionLongName"><span class="hs-identifier hs-var">optionLongName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;entry-point&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-315"></span><span>             </span><span class="annot"><span class="annottext">optionShortName :: Maybe Char
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionShortName"><span class="hs-identifier hs-var">optionShortName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Maybe Char
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'e'</span></span><span class="hs-special">,</span><span>
</span><span id="line-316"></span><span>             </span><span class="annot"><span class="annottext">optionArgument :: OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionArgument"><span class="hs-identifier hs-var">optionArgument</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#RequiredArgument"><span class="hs-identifier hs-var">RequiredArgument</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;str&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-317"></span><span>             </span><span class="annot"><span class="annottext">optionAction :: [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionAction"><span class="hs-identifier hs-var">optionAction</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-318"></span><span>               </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;entry_point&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;optarg&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-319"></span><span>           </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-320"></span><span>         </span><span class="annot"><span class="annottext">Option :: [Char] -&gt; Maybe Char -&gt; OptionArgument -&gt; [PyStmt] -&gt; Option
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span>
</span><span id="line-321"></span><span>           </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">optionLongName :: [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionLongName"><span class="hs-identifier hs-var">optionLongName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;binary-output&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-322"></span><span>             </span><span class="annot"><span class="annottext">optionShortName :: Maybe Char
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionShortName"><span class="hs-identifier hs-var">optionShortName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Maybe Char
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'b'</span></span><span class="hs-special">,</span><span>
</span><span id="line-323"></span><span>             </span><span class="annot"><span class="annottext">optionArgument :: OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionArgument"><span class="hs-identifier hs-var">optionArgument</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OptionArgument
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#NoArgument"><span class="hs-identifier hs-var">NoArgument</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-324"></span><span>             </span><span class="annot"><span class="annottext">optionAction :: [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#optionAction"><span class="hs-identifier hs-var">optionAction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;binary_output&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Bool"><span class="hs-identifier hs-var">Bool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">]</span><span>
</span><span id="line-325"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-326"></span><span>       </span><span class="hs-special">]</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span id="local-6989586621684569705"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#functionExternalValues"><span class="hs-identifier hs-type">functionExternalValues</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Function"><span class="hs-identifier hs-type">Imp.Function</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569705"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ExternalValue"><span class="hs-identifier hs-type">Imp.ExternalValue</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-329"></span><span id="functionExternalValues"><span class="annot"><span class="annottext">functionExternalValues :: forall a. Function a -&gt; [ExternalValue]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#functionExternalValues"><span class="hs-identifier hs-var hs-var">functionExternalValues</span></a></span></span><span> </span><span id="local-6989586621684569077"><span class="annot"><span class="annottext">Function a
</span><a href="#local-6989586621684569077"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Function a -&gt; [ExternalValue]
forall a. Function a -&gt; [ExternalValue]
</span><a href="Futhark.CodeGen.ImpCode.html#functionResult"><span class="hs-identifier hs-var hs-var">Imp.functionResult</span></a></span><span> </span><span class="annot"><span class="annottext">Function a
</span><a href="#local-6989586621684569077"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">[ExternalValue] -&gt; [ExternalValue] -&gt; [ExternalValue]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">((Name, ExternalValue) -&gt; ExternalValue)
-&gt; [(Name, ExternalValue)] -&gt; [ExternalValue]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Name, ExternalValue) -&gt; ExternalValue
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Function a -&gt; [(Name, ExternalValue)]
forall a. FunctionT a -&gt; [(Name, ExternalValue)]
</span><a href="Futhark.CodeGen.ImpCode.html#functionArgs"><span class="hs-identifier hs-var hs-var">Imp.functionArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Function a
</span><a href="#local-6989586621684569077"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span id="local-6989586621684569696"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#opaqueDefs"><span class="hs-identifier hs-type">opaqueDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Functions"><span class="hs-identifier hs-type">Imp.Functions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569696"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-332"></span><span id="opaqueDefs"><span class="annot"><span class="annottext">opaqueDefs :: forall a. Functions a -&gt; Map [Char] [PyExp]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opaqueDefs"><span class="hs-identifier hs-var hs-var">opaqueDefs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Functions"><span class="hs-identifier hs-type">Imp.Functions</span></a></span><span> </span><span id="local-6989586621684569066"><span class="annot"><span class="annottext">[(Name, Function a)]
</span><a href="#local-6989586621684569066"><span class="hs-identifier hs-var">funs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-333"></span><span>  </span><span class="annot"><span class="annottext">[Map [Char] [PyExp]] -&gt; Map [Char] [PyExp]
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Map [Char] [PyExp]] -&gt; Map [Char] [PyExp])
-&gt; ([(Name, Function a)] -&gt; [Map [Char] [PyExp]])
-&gt; [(Name, Function a)]
-&gt; Map [Char] [PyExp]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ExternalValue -&gt; Map [Char] [PyExp])
-&gt; [ExternalValue] -&gt; [Map [Char] [PyExp]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ExternalValue -&gt; Map [Char] [PyExp]
</span><a href="#local-6989586621684569065"><span class="hs-identifier hs-var">evd</span></a></span><span> </span><span class="annot"><span class="annottext">([ExternalValue] -&gt; [Map [Char] [PyExp]])
-&gt; ([(Name, Function a)] -&gt; [ExternalValue])
-&gt; [(Name, Function a)]
-&gt; [Map [Char] [PyExp]]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Name, Function a) -&gt; [ExternalValue])
-&gt; [(Name, Function a)] -&gt; [ExternalValue]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Function a -&gt; [ExternalValue]
forall a. Function a -&gt; [ExternalValue]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#functionExternalValues"><span class="hs-identifier hs-var">functionExternalValues</span></a></span><span> </span><span class="annot"><span class="annottext">(Function a -&gt; [ExternalValue])
-&gt; ((Name, Function a) -&gt; Function a)
-&gt; (Name, Function a)
-&gt; [ExternalValue]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name, Function a) -&gt; Function a
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Name, Function a)] -&gt; Map [Char] [PyExp])
-&gt; [(Name, Function a)] -&gt; Map [Char] [PyExp]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-334"></span><span>    </span><span class="annot"><span class="annottext">((Name, Function a) -&gt; Bool)
-&gt; [(Name, Function a)] -&gt; [(Name, Function a)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Name -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Name -&gt; Bool)
-&gt; ((Name, Function a) -&gt; Maybe Name) -&gt; (Name, Function a) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Function a -&gt; Maybe Name
forall a. FunctionT a -&gt; Maybe Name
</span><a href="Futhark.CodeGen.ImpCode.html#functionEntry"><span class="hs-identifier hs-var hs-var">Imp.functionEntry</span></a></span><span> </span><span class="annot"><span class="annottext">(Function a -&gt; Maybe Name)
-&gt; ((Name, Function a) -&gt; Function a)
-&gt; (Name, Function a)
-&gt; Maybe Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name, Function a) -&gt; Function a
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, Function a)]
</span><a href="#local-6989586621684569066"><span class="hs-identifier hs-var">funs</span></a></span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-336"></span><span>    </span><span id="local-6989586621684569065"><span class="annot"><span class="annottext">evd :: ExternalValue -&gt; Map [Char] [PyExp]
</span><a href="#local-6989586621684569065"><span class="hs-identifier hs-var hs-var">evd</span></a></span></span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#TransparentValue"><span class="hs-identifier hs-type">Imp.TransparentValue</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map [Char] [PyExp]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-337"></span><span>    </span><span class="annot"><a href="#local-6989586621684569065"><span class="hs-identifier hs-var">evd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#OpaqueValue"><span class="hs-identifier hs-type">Imp.OpaqueValue</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684569056"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684569056"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621684569055"><span class="annot"><span class="annottext">[ValueDesc]
</span><a href="#local-6989586621684569055"><span class="hs-identifier hs-var">vds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-338"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; Map [Char] [PyExp]
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684569056"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">([PyExp] -&gt; Map [Char] [PyExp]) -&gt; [PyExp] -&gt; Map [Char] [PyExp]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ValueDesc -&gt; PyExp) -&gt; [ValueDesc] -&gt; [PyExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; (ValueDesc -&gt; [Char]) -&gt; ValueDesc -&gt; PyExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ValueDesc -&gt; [Char]
</span><a href="#local-6989586621684569053"><span class="hs-identifier hs-var">vd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ValueDesc]
</span><a href="#local-6989586621684569055"><span class="hs-identifier hs-var">vds</span></a></span><span>
</span><span id="line-339"></span><span>    </span><span id="local-6989586621684569053"><span class="annot"><span class="annottext">vd :: ValueDesc -&gt; [Char]
</span><a href="#local-6989586621684569053"><span class="hs-identifier hs-var hs-var">vd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ScalarValue"><span class="hs-identifier hs-type">Imp.ScalarValue</span></a></span><span> </span><span id="local-6989586621684569047"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684569047"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621684569046"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684569046"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-340"></span><span>      </span><span class="annot"><span class="annottext">PrimType -&gt; Signedness -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#readTypeEnum"><span class="hs-identifier hs-var">readTypeEnum</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684569047"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684569046"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-341"></span><span>    </span><span class="annot"><a href="#local-6989586621684569053"><span class="hs-identifier hs-var">vd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ArrayValue"><span class="hs-identifier hs-type">Imp.ArrayValue</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684569043"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684569043"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621684569042"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684569042"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621684569041"><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684569041"><span class="hs-identifier hs-var">dims</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-342"></span><span>      </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Char] -&gt; [[Char]]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DimSize] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684569041"><span class="hs-identifier hs-var">dims</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;[]&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; Signedness -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#readTypeEnum"><span class="hs-identifier hs-var">readTypeEnum</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684569043"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684569042"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span class="hs-comment">-- | The class generated by the code generator must have a</span><span>
</span><span id="line-345"></span><span class="hs-comment">-- constructor, although it can be vacuous.</span><span>
</span><span id="line-346"></span><span class="hs-keyword">data</span><span> </span><span id="Constructor"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Constructor"><span class="hs-identifier hs-var">Constructor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Constructor"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Constructor"><span class="hs-identifier hs-var">Constructor</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="hs-comment">-- | A constructor that takes no arguments and does nothing.</span><span>
</span><span id="line-349"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#emptyConstructor"><span class="hs-identifier hs-type">emptyConstructor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span>
</span><span id="line-350"></span><span id="emptyConstructor"><span class="annot"><span class="annottext">emptyConstructor :: Constructor
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#emptyConstructor"><span class="hs-identifier hs-var hs-var">emptyConstructor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [PyStmt] -&gt; Constructor
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#Constructor"><span class="hs-identifier hs-var">Constructor</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;self&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Pass"><span class="hs-identifier hs-var">Pass</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#constructorToFunDef"><span class="hs-identifier hs-type">constructorToFunDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyFunDef"><span class="hs-identifier hs-type">PyFunDef</span></a></span><span>
</span><span id="line-353"></span><span id="constructorToFunDef"><span class="annot"><span class="annottext">constructorToFunDef :: Constructor -&gt; [PyStmt] -&gt; PyFunDef
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#constructorToFunDef"><span class="hs-identifier hs-var hs-var">constructorToFunDef</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span> </span><span id="local-6989586621684569035"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684569035"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621684569034"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684569034"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684569033"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684569033"><span class="hs-identifier hs-var">at_init</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-354"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; [[Char]] -&gt; [PyStmt] -&gt; PyFunDef
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;__init__&quot;</span></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684569035"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">([PyStmt] -&gt; PyFunDef) -&gt; [PyStmt] -&gt; PyFunDef
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684569034"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684569033"><span class="hs-identifier hs-var">at_init</span></a></span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span id="local-6989586621684569668"><span id="local-6989586621684569669"><span id="local-6989586621684569671"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileProg"><span class="hs-identifier hs-type">compileProg</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-357"></span><span>  </span><span class="annot"><a href="Futhark.MonadFreshNames.html#MonadFreshNames"><span class="hs-identifier hs-type">MonadFreshNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569671"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-358"></span><span>  </span><span class="annot"><a href="Futhark.Compiler.CLI.html#CompilerMode"><span class="hs-identifier hs-type">CompilerMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-359"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-360"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-362"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-363"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#Operations"><span class="hs-identifier hs-type">Operations</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569669"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569668"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-364"></span><span>  </span><span class="annot"><a href="#local-6989586621684569668"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-365"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-366"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-367"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Definitions"><span class="hs-identifier hs-type">Imp.Definitions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569669"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-368"></span><span>  </span><span class="annot"><a href="#local-6989586621684569671"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span></span></span></span><span>
</span><span id="line-369"></span><span id="compileProg"><span class="annot"><span class="annottext">compileProg :: forall (m :: * -&gt; *) op s.
MonadFreshNames m =&gt;
CompilerMode
-&gt; [Char]
-&gt; Constructor
-&gt; [PyStmt]
-&gt; [PyStmt]
-&gt; Operations op s
-&gt; s
-&gt; [PyStmt]
-&gt; [Option]
-&gt; Definitions op
-&gt; m Text
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileProg"><span class="hs-identifier hs-var hs-var">compileProg</span></a></span></span><span> </span><span id="local-6989586621684569021"><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684569021"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621684569020"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684569020"><span class="hs-identifier hs-var">class_name</span></a></span></span><span> </span><span id="local-6989586621684569019"><span class="annot"><span class="annottext">Constructor
</span><a href="#local-6989586621684569019"><span class="hs-identifier hs-var">constructor</span></a></span></span><span> </span><span id="local-6989586621684569018"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684569018"><span class="hs-identifier hs-var">imports</span></a></span></span><span> </span><span id="local-6989586621684569017"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684569017"><span class="hs-identifier hs-var">defines</span></a></span></span><span> </span><span id="local-6989586621684569016"><span class="annot"><span class="annottext">Operations op s
</span><a href="#local-6989586621684569016"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span id="local-6989586621684569015"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621684569015"><span class="hs-identifier hs-var">userstate</span></a></span></span><span> </span><span id="local-6989586621684569014"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684569014"><span class="hs-identifier hs-var">sync</span></a></span></span><span> </span><span id="local-6989586621684569013"><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621684569013"><span class="hs-identifier hs-var">options</span></a></span></span><span> </span><span id="local-6989586621684569012"><span class="annot"><span class="annottext">Definitions op
</span><a href="#local-6989586621684569012"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-370"></span><span>  </span><span id="local-6989586621684569011"><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684569011"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m VNameSource
forall (m :: * -&gt; *). MonadFreshNames m =&gt; m VNameSource
</span><a href="Futhark.MonadFreshNames.html#getNameSource"><span class="hs-identifier hs-var">getNameSource</span></a></span><span>
</span><span id="line-371"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684569010"><span class="annot"><span class="annottext">prog' :: [PyStmt]
</span><a href="#local-6989586621684569010"><span class="hs-identifier hs-var hs-var">prog'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operations op s
-&gt; VNameSource -&gt; s -&gt; CompilerM op s [PyStmt] -&gt; [PyStmt]
forall op s a.
Operations op s -&gt; VNameSource -&gt; s -&gt; CompilerM op s a -&gt; a
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#runCompilerM"><span class="hs-identifier hs-var">runCompilerM</span></a></span><span> </span><span class="annot"><span class="annottext">Operations op s
</span><a href="#local-6989586621684569016"><span class="hs-identifier hs-var">ops</span></a></span><span> </span><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684569011"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621684569015"><span class="hs-identifier hs-var">userstate</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerM op s [PyStmt]
forall {s}. CompilerM op s [PyStmt]
</span><a href="#local-6989586621684569009"><span class="hs-identifier hs-var">compileProg'</span></a></span><span>
</span><span id="line-372"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; m Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m Text) -&gt; ([PyStmt] -&gt; Text) -&gt; [PyStmt] -&gt; m Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PyProg -&gt; Text
forall a. Pretty a =&gt; a -&gt; Text
</span><a href="Futhark.Util.Pretty.html#prettyText"><span class="hs-identifier hs-var">prettyText</span></a></span><span> </span><span class="annot"><span class="annottext">(PyProg -&gt; Text) -&gt; ([PyStmt] -&gt; PyProg) -&gt; [PyStmt] -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[PyStmt] -&gt; PyProg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyProg"><span class="hs-identifier hs-var">PyProg</span></a></span><span> </span><span class="annot"><span class="annottext">([PyStmt] -&gt; m Text) -&gt; [PyStmt] -&gt; m Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-373"></span><span>    </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684569018"><span class="hs-identifier hs-var">imports</span></a></span><span>
</span><span id="line-374"></span><span>      </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Maybe [Char] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Import"><span class="hs-identifier hs-var">Import</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;argparse&quot;</span></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-375"></span><span>           </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;sizes&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(PyExp, PyExp)] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Dict"><span class="hs-identifier hs-var">Dict</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-376"></span><span>         </span><span class="hs-special">]</span><span>
</span><span id="line-377"></span><span>      </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684569017"><span class="hs-identifier hs-var">defines</span></a></span><span>
</span><span id="line-378"></span><span>      </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Escape"><span class="hs-identifier hs-var">Escape</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Futhark.CodeGen.RTS.Python.html#valuesPy"><span class="hs-identifier hs-var">valuesPy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-379"></span><span>           </span><span class="annot"><span class="annottext">Text -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Escape"><span class="hs-identifier hs-var">Escape</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Futhark.CodeGen.RTS.Python.html#memoryPy"><span class="hs-identifier hs-var">memoryPy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-380"></span><span>           </span><span class="annot"><span class="annottext">Text -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Escape"><span class="hs-identifier hs-var">Escape</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Futhark.CodeGen.RTS.Python.html#panicPy"><span class="hs-identifier hs-var">panicPy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-381"></span><span>           </span><span class="annot"><span class="annottext">Text -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Escape"><span class="hs-identifier hs-var">Escape</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Futhark.CodeGen.RTS.Python.html#tuningPy"><span class="hs-identifier hs-var">tuningPy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-382"></span><span>           </span><span class="annot"><span class="annottext">Text -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Escape"><span class="hs-identifier hs-var">Escape</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Futhark.CodeGen.RTS.Python.html#scalarPy"><span class="hs-identifier hs-var">scalarPy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-383"></span><span>           </span><span class="annot"><span class="annottext">Text -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Escape"><span class="hs-identifier hs-var">Escape</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Futhark.CodeGen.RTS.Python.html#serverPy"><span class="hs-identifier hs-var">serverPy</span></a></span><span>
</span><span id="line-384"></span><span>         </span><span class="hs-special">]</span><span>
</span><span id="line-385"></span><span>      </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684569010"><span class="hs-identifier hs-var">prog'</span></a></span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-387"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Definitions"><span class="hs-identifier hs-type">Imp.Definitions</span></a></span><span> </span><span id="local-6989586621684568997"><span class="annot"><span class="annottext">Constants op
</span><a href="#local-6989586621684568997"><span class="hs-identifier hs-var">consts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Functions"><span class="hs-identifier hs-type">Imp.Functions</span></a></span><span> </span><span id="local-6989586621684568996"><span class="annot"><span class="annottext">[(Name, Function op)]
</span><a href="#local-6989586621684568996"><span class="hs-identifier hs-var">funs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definitions op
</span><a href="#local-6989586621684569012"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-388"></span><span>    </span><span id="local-6989586621684569009"><span class="annot"><span class="annottext">compileProg' :: CompilerM op s [PyStmt]
</span><a href="#local-6989586621684569009"><span class="hs-identifier hs-var hs-var">compileProg'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constants op -&gt; CompilerM op s [PyStmt] -&gt; CompilerM op s [PyStmt]
forall op s a. Constants op -&gt; CompilerM op s a -&gt; CompilerM op s a
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#withConstantSubsts"><span class="hs-identifier hs-var">withConstantSubsts</span></a></span><span> </span><span class="annot"><span class="annottext">Constants op
</span><a href="#local-6989586621684568997"><span class="hs-identifier hs-var">consts</span></a></span><span> </span><span class="annot"><span class="annottext">(CompilerM op s [PyStmt] -&gt; CompilerM op s [PyStmt])
-&gt; CompilerM op s [PyStmt] -&gt; CompilerM op s [PyStmt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-389"></span><span>      </span><span class="annot"><span class="annottext">Constants op -&gt; CompilerM op s ()
forall op s. Constants op -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileConstants"><span class="hs-identifier hs-var">compileConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Constants op
</span><a href="#local-6989586621684568997"><span class="hs-identifier hs-var">consts</span></a></span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span>      </span><span id="local-6989586621684568971"><span class="annot"><span class="annottext">[PyFunDef]
</span><a href="#local-6989586621684568971"><span class="hs-identifier hs-var">definitions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Name, Function op) -&gt; CompilerM op s PyFunDef)
-&gt; [(Name, Function op)] -&gt; CompilerM op s [PyFunDef]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">(Name, Function op) -&gt; CompilerM op s PyFunDef
forall op s. (Name, Function op) -&gt; CompilerM op s PyFunDef
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileFunc"><span class="hs-identifier hs-var">compileFunc</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Function op)]
</span><a href="#local-6989586621684568996"><span class="hs-identifier hs-var">funs</span></a></span><span>
</span><span id="line-392"></span><span>      </span><span id="local-6989586621684568968"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568968"><span class="hs-identifier hs-var">at_inits</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CompilerState s -&gt; [PyStmt]) -&gt; CompilerM op s [PyStmt]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">CompilerState s -&gt; [PyStmt]
forall s. CompilerState s -&gt; [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compInit"><span class="hs-identifier hs-var hs-var">compInit</span></a></span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568967"><span class="annot"><span class="annottext">constructor' :: PyFunDef
</span><a href="#local-6989586621684568967"><span class="hs-identifier hs-var hs-var">constructor'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constructor -&gt; [PyStmt] -&gt; PyFunDef
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#constructorToFunDef"><span class="hs-identifier hs-var">constructorToFunDef</span></a></span><span> </span><span class="annot"><span class="annottext">Constructor
</span><a href="#local-6989586621684569019"><span class="hs-identifier hs-var">constructor</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568968"><span class="hs-identifier hs-var">at_inits</span></a></span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684569021"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-397"></span><span>        </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="Futhark.Compiler.CLI.html#ToLibrary"><span class="hs-identifier hs-var">ToLibrary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-398"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621684568965"><span class="annot"><span class="annottext">[PyFunDef]
</span><a href="#local-6989586621684568965"><span class="hs-identifier hs-var">entry_points</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568964"><span class="annot"><span class="annottext">[(PyExp, PyExp)]
</span><a href="#local-6989586621684568964"><span class="hs-identifier hs-var">entry_point_types</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-399"></span><span>            </span><span class="annot"><span class="annottext">[(PyFunDef, (PyExp, PyExp))] -&gt; ([PyFunDef], [(PyExp, PyExp)])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([(PyFunDef, (PyExp, PyExp))] -&gt; ([PyFunDef], [(PyExp, PyExp)]))
-&gt; ([Maybe (PyFunDef, (PyExp, PyExp))]
    -&gt; [(PyFunDef, (PyExp, PyExp))])
-&gt; [Maybe (PyFunDef, (PyExp, PyExp))]
-&gt; ([PyFunDef], [(PyExp, PyExp)])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Maybe (PyFunDef, (PyExp, PyExp))] -&gt; [(PyFunDef, (PyExp, PyExp))]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe (PyFunDef, (PyExp, PyExp))]
 -&gt; ([PyFunDef], [(PyExp, PyExp)]))
-&gt; CompilerM op s [Maybe (PyFunDef, (PyExp, PyExp))]
-&gt; CompilerM op s ([PyFunDef], [(PyExp, PyExp)])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">((Name, Function op)
 -&gt; CompilerM op s (Maybe (PyFunDef, (PyExp, PyExp))))
-&gt; [(Name, Function op)]
-&gt; CompilerM op s [Maybe (PyFunDef, (PyExp, PyExp))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PyStmt]
-&gt; ReturnTiming
-&gt; (Name, Function op)
-&gt; CompilerM op s (Maybe (PyFunDef, (PyExp, PyExp)))
forall op s.
[PyStmt]
-&gt; ReturnTiming
-&gt; (Name, Function op)
-&gt; CompilerM op s (Maybe (PyFunDef, (PyExp, PyExp)))
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileEntryFun"><span class="hs-identifier hs-var">compileEntryFun</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684569014"><span class="hs-identifier hs-var">sync</span></a></span><span> </span><span class="annot"><span class="annottext">ReturnTiming
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#DoNotReturnTiming"><span class="hs-identifier hs-var">DoNotReturnTiming</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, Function op)]
</span><a href="#local-6989586621684568996"><span class="hs-identifier hs-var">funs</span></a></span><span>
</span><span id="line-400"></span><span>          </span><span class="annot"><span class="annottext">[PyStmt] -&gt; CompilerM op s [PyStmt]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-401"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyClassDef -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#ClassDef"><span class="hs-identifier hs-var">ClassDef</span></a></span><span> </span><span class="annot"><span class="annottext">(PyClassDef -&gt; PyStmt) -&gt; PyClassDef -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-402"></span><span>                </span><span class="annot"><span class="annottext">[Char] -&gt; [PyStmt] -&gt; PyClassDef
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Class"><span class="hs-identifier hs-var">Class</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684569020"><span class="hs-identifier hs-var">class_name</span></a></span><span> </span><span class="annot"><span class="annottext">([PyStmt] -&gt; PyClassDef) -&gt; [PyStmt] -&gt; PyClassDef
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-403"></span><span>                  </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;entry_points&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(PyExp, PyExp)] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Dict"><span class="hs-identifier hs-var">Dict</span></a></span><span> </span><span class="annot"><span class="annottext">[(PyExp, PyExp)]
</span><a href="#local-6989586621684568964"><span class="hs-identifier hs-var">entry_point_types</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PyStmt -&gt; [PyStmt] -&gt; [PyStmt]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-404"></span><span>                  </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span>
</span><span id="line-405"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;opaques&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(PyExp, PyExp)] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Dict"><span class="hs-identifier hs-var">Dict</span></a></span><span> </span><span class="annot"><span class="annottext">([(PyExp, PyExp)] -&gt; PyExp) -&gt; [(PyExp, PyExp)] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PyExp] -&gt; [PyExp] -&gt; [(PyExp, PyExp)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [[Char]] -&gt; [PyExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568956"><span class="hs-identifier hs-var">opaque_names</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([PyExp] -&gt; PyExp) -&gt; [[PyExp]] -&gt; [PyExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Tuple"><span class="hs-identifier hs-var">Tuple</span></a></span><span> </span><span class="annot"><span class="annottext">[[PyExp]]
</span><a href="#local-6989586621684568954"><span class="hs-identifier hs-var">opaque_payloads</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PyStmt -&gt; [PyStmt] -&gt; [PyStmt]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-407"></span><span>                  </span><span class="annot"><span class="annottext">(PyFunDef -&gt; PyStmt) -&gt; [PyFunDef] -&gt; [PyStmt]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PyFunDef -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#FunDef"><span class="hs-identifier hs-var">FunDef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyFunDef
</span><a href="#local-6989586621684568967"><span class="hs-identifier hs-var">constructor'</span></a></span><span> </span><span class="annot"><span class="annottext">PyFunDef -&gt; [PyFunDef] -&gt; [PyFunDef]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[PyFunDef]
</span><a href="#local-6989586621684568971"><span class="hs-identifier hs-var">definitions</span></a></span><span> </span><span class="annot"><span class="annottext">[PyFunDef] -&gt; [PyFunDef] -&gt; [PyFunDef]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PyFunDef]
</span><a href="#local-6989586621684568965"><span class="hs-identifier hs-var">entry_points</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-409"></span><span>        </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="Futhark.Compiler.CLI.html#ToServer"><span class="hs-identifier hs-var">ToServer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-410"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621684568951"><span class="annot"><span class="annottext">[PyFunDef]
</span><a href="#local-6989586621684568951"><span class="hs-identifier hs-var">entry_points</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568950"><span class="annot"><span class="annottext">[(PyExp, PyExp)]
</span><a href="#local-6989586621684568950"><span class="hs-identifier hs-var">entry_point_types</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-411"></span><span>            </span><span class="annot"><span class="annottext">[(PyFunDef, (PyExp, PyExp))] -&gt; ([PyFunDef], [(PyExp, PyExp)])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([(PyFunDef, (PyExp, PyExp))] -&gt; ([PyFunDef], [(PyExp, PyExp)]))
-&gt; ([Maybe (PyFunDef, (PyExp, PyExp))]
    -&gt; [(PyFunDef, (PyExp, PyExp))])
-&gt; [Maybe (PyFunDef, (PyExp, PyExp))]
-&gt; ([PyFunDef], [(PyExp, PyExp)])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Maybe (PyFunDef, (PyExp, PyExp))] -&gt; [(PyFunDef, (PyExp, PyExp))]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe (PyFunDef, (PyExp, PyExp))]
 -&gt; ([PyFunDef], [(PyExp, PyExp)]))
-&gt; CompilerM op s [Maybe (PyFunDef, (PyExp, PyExp))]
-&gt; CompilerM op s ([PyFunDef], [(PyExp, PyExp)])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">((Name, Function op)
 -&gt; CompilerM op s (Maybe (PyFunDef, (PyExp, PyExp))))
-&gt; [(Name, Function op)]
-&gt; CompilerM op s [Maybe (PyFunDef, (PyExp, PyExp))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PyStmt]
-&gt; ReturnTiming
-&gt; (Name, Function op)
-&gt; CompilerM op s (Maybe (PyFunDef, (PyExp, PyExp)))
forall op s.
[PyStmt]
-&gt; ReturnTiming
-&gt; (Name, Function op)
-&gt; CompilerM op s (Maybe (PyFunDef, (PyExp, PyExp)))
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileEntryFun"><span class="hs-identifier hs-var">compileEntryFun</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684569014"><span class="hs-identifier hs-var">sync</span></a></span><span> </span><span class="annot"><span class="annottext">ReturnTiming
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#ReturnTiming"><span class="hs-identifier hs-var">ReturnTiming</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, Function op)]
</span><a href="#local-6989586621684568996"><span class="hs-identifier hs-var">funs</span></a></span><span>
</span><span id="line-412"></span><span>          </span><span class="annot"><span class="annottext">[PyStmt] -&gt; CompilerM op s [PyStmt]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([PyStmt] -&gt; CompilerM op s [PyStmt])
-&gt; [PyStmt] -&gt; CompilerM op s [PyStmt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-413"></span><span>            </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568948"><span class="hs-identifier hs-var">parse_options_server</span></a></span><span>
</span><span id="line-414"></span><span>              </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyClassDef -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#ClassDef"><span class="hs-identifier hs-var">ClassDef</span></a></span><span>
</span><span id="line-415"></span><span>                     </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyStmt] -&gt; PyClassDef
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Class"><span class="hs-identifier hs-var">Class</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684569020"><span class="hs-identifier hs-var">class_name</span></a></span><span> </span><span class="annot"><span class="annottext">([PyStmt] -&gt; PyClassDef) -&gt; [PyStmt] -&gt; PyClassDef
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-416"></span><span>                         </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;entry_points&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(PyExp, PyExp)] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Dict"><span class="hs-identifier hs-var">Dict</span></a></span><span> </span><span class="annot"><span class="annottext">[(PyExp, PyExp)]
</span><a href="#local-6989586621684568950"><span class="hs-identifier hs-var">entry_point_types</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PyStmt -&gt; [PyStmt] -&gt; [PyStmt]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-417"></span><span>                         </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span>
</span><span id="line-418"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;opaques&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(PyExp, PyExp)] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Dict"><span class="hs-identifier hs-var">Dict</span></a></span><span> </span><span class="annot"><span class="annottext">([(PyExp, PyExp)] -&gt; PyExp) -&gt; [(PyExp, PyExp)] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PyExp] -&gt; [PyExp] -&gt; [(PyExp, PyExp)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [[Char]] -&gt; [PyExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568956"><span class="hs-identifier hs-var">opaque_names</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([PyExp] -&gt; PyExp) -&gt; [[PyExp]] -&gt; [PyExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Tuple"><span class="hs-identifier hs-var">Tuple</span></a></span><span> </span><span class="annot"><span class="annottext">[[PyExp]]
</span><a href="#local-6989586621684568954"><span class="hs-identifier hs-var">opaque_payloads</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PyStmt -&gt; [PyStmt] -&gt; [PyStmt]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-420"></span><span>                         </span><span class="annot"><span class="annottext">(PyFunDef -&gt; PyStmt) -&gt; [PyFunDef] -&gt; [PyStmt]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PyFunDef -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#FunDef"><span class="hs-identifier hs-var">FunDef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyFunDef
</span><a href="#local-6989586621684568967"><span class="hs-identifier hs-var">constructor'</span></a></span><span> </span><span class="annot"><span class="annottext">PyFunDef -&gt; [PyFunDef] -&gt; [PyFunDef]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[PyFunDef]
</span><a href="#local-6989586621684568971"><span class="hs-identifier hs-var">definitions</span></a></span><span> </span><span class="annot"><span class="annottext">[PyFunDef] -&gt; [PyFunDef] -&gt; [PyFunDef]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PyFunDef]
</span><a href="#local-6989586621684568951"><span class="hs-identifier hs-var">entry_points</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>                     </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-422"></span><span>                   </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span>
</span><span id="line-423"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;server&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Server&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684569020"><span class="hs-identifier hs-var">class_name</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-425"></span><span>                   </span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;server.run&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-426"></span><span>                 </span><span class="hs-special">]</span><span>
</span><span id="line-427"></span><span>        </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="Futhark.Compiler.CLI.html#ToExecutable"><span class="hs-identifier hs-var">ToExecutable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-428"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568946"><span class="annot"><span class="annottext">classinst :: PyStmt
</span><a href="#local-6989586621684568946"><span class="hs-identifier hs-var hs-var">classinst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;self&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684569020"><span class="hs-identifier hs-var">class_name</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-429"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621684568945"><span class="annot"><span class="annottext">[PyFunDef]
</span><a href="#local-6989586621684568945"><span class="hs-identifier hs-var">entry_point_defs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568944"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568944"><span class="hs-identifier hs-var">entry_point_names</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568943"><span class="annot"><span class="annottext">[PyExp]
</span><a href="#local-6989586621684568943"><span class="hs-identifier hs-var">entry_points</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-430"></span><span>            </span><span class="annot"><span class="annottext">[(PyFunDef, [Char], PyExp)] -&gt; ([PyFunDef], [[Char]], [PyExp])
forall a b c. [(a, b, c)] -&gt; ([a], [b], [c])
</span><span class="hs-identifier hs-var">unzip3</span></span><span> </span><span class="annot"><span class="annottext">([(PyFunDef, [Char], PyExp)] -&gt; ([PyFunDef], [[Char]], [PyExp]))
-&gt; ([Maybe (PyFunDef, [Char], PyExp)]
    -&gt; [(PyFunDef, [Char], PyExp)])
-&gt; [Maybe (PyFunDef, [Char], PyExp)]
-&gt; ([PyFunDef], [[Char]], [PyExp])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Maybe (PyFunDef, [Char], PyExp)] -&gt; [(PyFunDef, [Char], PyExp)]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe (PyFunDef, [Char], PyExp)]
 -&gt; ([PyFunDef], [[Char]], [PyExp]))
-&gt; CompilerM op s [Maybe (PyFunDef, [Char], PyExp)]
-&gt; CompilerM op s ([PyFunDef], [[Char]], [PyExp])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">((Name, Function op)
 -&gt; CompilerM op s (Maybe (PyFunDef, [Char], PyExp)))
-&gt; [(Name, Function op)]
-&gt; CompilerM op s [Maybe (PyFunDef, [Char], PyExp)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PyStmt]
-&gt; (Name, Function op)
-&gt; CompilerM op s (Maybe (PyFunDef, [Char], PyExp))
forall op s.
[PyStmt]
-&gt; (Name, Function op)
-&gt; CompilerM op s (Maybe (PyFunDef, [Char], PyExp))
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#callEntryFun"><span class="hs-identifier hs-var">callEntryFun</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684569014"><span class="hs-identifier hs-var">sync</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, Function op)]
</span><a href="#local-6989586621684568996"><span class="hs-identifier hs-var">funs</span></a></span><span>
</span><span id="line-431"></span><span>          </span><span class="annot"><span class="annottext">[PyStmt] -&gt; CompilerM op s [PyStmt]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([PyStmt] -&gt; CompilerM op s [PyStmt])
-&gt; [PyStmt] -&gt; CompilerM op s [PyStmt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-432"></span><span>            </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568940"><span class="hs-identifier hs-var">parse_options_executable</span></a></span><span>
</span><span id="line-433"></span><span>              </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">PyClassDef -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#ClassDef"><span class="hs-identifier hs-var">ClassDef</span></a></span><span>
</span><span id="line-434"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyStmt] -&gt; PyClassDef
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Class"><span class="hs-identifier hs-var">Class</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684569020"><span class="hs-identifier hs-var">class_name</span></a></span><span> </span><span class="annot"><span class="annottext">([PyStmt] -&gt; PyClassDef) -&gt; [PyStmt] -&gt; PyClassDef
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-435"></span><span>                    </span><span class="annot"><span class="annottext">(PyFunDef -&gt; PyStmt) -&gt; [PyFunDef] -&gt; [PyStmt]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PyFunDef -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#FunDef"><span class="hs-identifier hs-var">FunDef</span></a></span><span> </span><span class="annot"><span class="annottext">([PyFunDef] -&gt; [PyStmt]) -&gt; [PyFunDef] -&gt; [PyStmt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-436"></span><span>                      </span><span class="annot"><span class="annottext">PyFunDef
</span><a href="#local-6989586621684568967"><span class="hs-identifier hs-var">constructor'</span></a></span><span> </span><span class="annot"><span class="annottext">PyFunDef -&gt; [PyFunDef] -&gt; [PyFunDef]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[PyFunDef]
</span><a href="#local-6989586621684568971"><span class="hs-identifier hs-var">definitions</span></a></span><span>
</span><span id="line-437"></span><span>                </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PyStmt -&gt; [PyStmt] -&gt; [PyStmt]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-438"></span><span>            </span><span class="annot"><span class="annottext">PyStmt
</span><a href="#local-6989586621684568946"><span class="hs-identifier hs-var">classinst</span></a></span><span> </span><span class="annot"><span class="annottext">PyStmt -&gt; [PyStmt] -&gt; [PyStmt]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-439"></span><span>            </span><span class="annot"><span class="annottext">(PyFunDef -&gt; PyStmt) -&gt; [PyFunDef] -&gt; [PyStmt]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PyFunDef -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#FunDef"><span class="hs-identifier hs-var">FunDef</span></a></span><span> </span><span class="annot"><span class="annottext">[PyFunDef]
</span><a href="#local-6989586621684568945"><span class="hs-identifier hs-var">entry_point_defs</span></a></span><span>
</span><span id="line-440"></span><span>              </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [PyExp] -&gt; [PyStmt]
</span><a href="#local-6989586621684568939"><span class="hs-identifier hs-var">selectEntryPoint</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568944"><span class="hs-identifier hs-var">entry_point_names</span></a></span><span> </span><span class="annot"><span class="annottext">[PyExp]
</span><a href="#local-6989586621684568943"><span class="hs-identifier hs-var">entry_points</span></a></span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span>    </span><span id="local-6989586621684568940"><span class="annot"><span class="annottext">parse_options_executable :: [PyStmt]
</span><a href="#local-6989586621684568940"><span class="hs-identifier hs-var hs-var">parse_options_executable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-443"></span><span>      </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;runtime_file&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#None"><span class="hs-identifier hs-var">None</span></a></span><span> </span><span class="annot"><span class="annottext">PyStmt -&gt; [PyStmt] -&gt; [PyStmt]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-444"></span><span>      </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;do_warmup_run&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Bool"><span class="hs-identifier hs-var">Bool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PyStmt -&gt; [PyStmt] -&gt; [PyStmt]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-445"></span><span>      </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;num_runs&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PyStmt -&gt; [PyStmt] -&gt; [PyStmt]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-446"></span><span>      </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;entry_point&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;main&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PyStmt -&gt; [PyStmt] -&gt; [PyStmt]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-447"></span><span>      </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;binary_output&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Bool"><span class="hs-identifier hs-var">Bool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PyStmt -&gt; [PyStmt] -&gt; [PyStmt]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-448"></span><span>      </span><span class="annot"><span class="annottext">[Option] -&gt; [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#generateOptionParser"><span class="hs-identifier hs-var">generateOptionParser</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Option]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#executableOptions"><span class="hs-identifier hs-var">executableOptions</span></a></span><span> </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621684569013"><span class="hs-identifier hs-var">options</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span>    </span><span id="local-6989586621684568948"><span class="annot"><span class="annottext">parse_options_server :: [PyStmt]
</span><a href="#local-6989586621684568948"><span class="hs-identifier hs-var hs-var">parse_options_server</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-451"></span><span>      </span><span class="annot"><span class="annottext">[Option] -&gt; [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.Options.html#generateOptionParser"><span class="hs-identifier hs-var">generateOptionParser</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Option]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#standardOptions"><span class="hs-identifier hs-var">standardOptions</span></a></span><span> </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621684569013"><span class="hs-identifier hs-var">options</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684568956"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568956"><span class="hs-identifier hs-var">opaque_names</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568954"><span class="annot"><span class="annottext">[[PyExp]]
</span><a href="#local-6989586621684568954"><span class="hs-identifier hs-var">opaque_payloads</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-454"></span><span>      </span><span class="annot"><span class="annottext">[([Char], [PyExp])] -&gt; ([[Char]], [[PyExp]])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([([Char], [PyExp])] -&gt; ([[Char]], [[PyExp]]))
-&gt; [([Char], [PyExp])] -&gt; ([[Char]], [[PyExp]])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map [Char] [PyExp] -&gt; [([Char], [PyExp])]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map [Char] [PyExp] -&gt; [([Char], [PyExp])])
-&gt; Map [Char] [PyExp] -&gt; [([Char], [PyExp])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Functions op -&gt; Map [Char] [PyExp]
forall a. Functions a -&gt; Map [Char] [PyExp]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#opaqueDefs"><span class="hs-identifier hs-var">opaqueDefs</span></a></span><span> </span><span class="annot"><span class="annottext">(Functions op -&gt; Map [Char] [PyExp])
-&gt; Functions op -&gt; Map [Char] [PyExp]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Definitions op -&gt; Functions op
forall a. Definitions a -&gt; Functions a
</span><a href="Futhark.CodeGen.ImpCode.html#defFuns"><span class="hs-identifier hs-var hs-var">Imp.defFuns</span></a></span><span> </span><span class="annot"><span class="annottext">Definitions op
</span><a href="#local-6989586621684569012"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span>    </span><span id="local-6989586621684568939"><span class="annot"><span class="annottext">selectEntryPoint :: [[Char]] -&gt; [PyExp] -&gt; [PyStmt]
</span><a href="#local-6989586621684568939"><span class="hs-identifier hs-var hs-var">selectEntryPoint</span></a></span></span><span> </span><span id="local-6989586621684568933"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568933"><span class="hs-identifier hs-var">entry_point_names</span></a></span></span><span> </span><span id="local-6989586621684568932"><span class="annot"><span class="annottext">[PyExp]
</span><a href="#local-6989586621684568932"><span class="hs-identifier hs-var">entry_points</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-457"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;entry_points&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-458"></span><span>          </span><span class="annot"><span class="annottext">[(PyExp, PyExp)] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Dict"><span class="hs-identifier hs-var">Dict</span></a></span><span> </span><span class="annot"><span class="annottext">([(PyExp, PyExp)] -&gt; PyExp) -&gt; [(PyExp, PyExp)] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PyExp] -&gt; [PyExp] -&gt; [(PyExp, PyExp)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [[Char]] -&gt; [PyExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568933"><span class="hs-identifier hs-var">entry_point_names</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PyExp]
</span><a href="#local-6989586621684568932"><span class="hs-identifier hs-var">entry_points</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-459"></span><span>        </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;entry_point_fun&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-460"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;entry_points.get&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;entry_point&quot;</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-461"></span><span>        </span><span class="annot"><span class="annottext">PyExp -&gt; [PyStmt] -&gt; [PyStmt] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#If"><span class="hs-identifier hs-var">If</span></a></span><span>
</span><span id="line-462"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;==&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;entry_point_fun&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#None"><span class="hs-identifier hs-var">None</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-464"></span><span>              </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span>
</span><span id="line-465"></span><span>                </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;sys.exit&quot;</span></span><span>
</span><span id="line-466"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; [PyArg] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Call"><span class="hs-identifier hs-var">Call</span></a></span><span>
</span><span id="line-467"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; [Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Field"><span class="hs-identifier hs-var">Field</span></a></span><span>
</span><span id="line-468"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;No entry point '{}'.  Select another with --entry point.  Options are:\n{}&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>                        </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;format&quot;</span></span><span>
</span><span id="line-470"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyArg) -&gt; PyExp -&gt; PyArg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;entry_point&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-472"></span><span>                      </span><span class="annot"><span class="annottext">PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyArg) -&gt; PyExp -&gt; PyArg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-473"></span><span>                        </span><span class="annot"><span class="annottext">PyExp -&gt; [PyArg] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Call"><span class="hs-identifier hs-var">Call</span></a></span><span>
</span><span id="line-474"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp -&gt; [Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Field"><span class="hs-identifier hs-var">Field</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;join&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-475"></span><span>                          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyArg) -&gt; PyExp -&gt; PyArg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;entry_points.keys&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-476"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-477"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-478"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-479"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;entry_point_fun&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-480"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span id="local-6989586621684569656"><span id="local-6989586621684569657"><span id="local-6989586621684569658"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#withConstantSubsts"><span class="hs-identifier hs-type">withConstantSubsts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Constants"><span class="hs-identifier hs-type">Imp.Constants</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569658"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569658"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569657"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569656"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569658"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569657"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569656"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-483"></span><span id="withConstantSubsts"><span class="annot"><span class="annottext">withConstantSubsts :: forall op s a. Constants op -&gt; CompilerM op s a -&gt; CompilerM op s a
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#withConstantSubsts"><span class="hs-identifier hs-var hs-var">withConstantSubsts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Constants"><span class="hs-identifier hs-type">Imp.Constants</span></a></span><span> </span><span id="local-6989586621684568922"><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621684568922"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="annot"><span class="annottext">Code op
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-484"></span><span>  </span><span class="annot"><span class="annottext">(CompilerEnv op s -&gt; CompilerEnv op s)
-&gt; CompilerM op s a -&gt; CompilerM op s a
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="annot"><span class="annottext">((CompilerEnv op s -&gt; CompilerEnv op s)
 -&gt; CompilerM op s a -&gt; CompilerM op s a)
-&gt; (CompilerEnv op s -&gt; CompilerEnv op s)
-&gt; CompilerM op s a
-&gt; CompilerM op s a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684568920"><span class="annot"><span class="annottext">CompilerEnv op s
</span><a href="#local-6989586621684568920"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompilerEnv op s
</span><a href="#local-6989586621684568920"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">envVarExp :: Map VName PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envVarExp"><span class="hs-identifier hs-var">envVarExp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Param -&gt; Map VName PyExp) -&gt; [Param] -&gt; Map VName PyExp
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">Param -&gt; Map VName PyExp
</span><a href="#local-6989586621684568918"><span class="hs-identifier hs-var">constExp</span></a></span><span> </span><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621684568922"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-485"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-486"></span><span>    </span><span id="local-6989586621684568918"><span class="annot"><span class="annottext">constExp :: Param -&gt; Map VName PyExp
</span><a href="#local-6989586621684568918"><span class="hs-identifier hs-var hs-var">constExp</span></a></span></span><span> </span><span id="local-6989586621684568916"><span class="annot"><span class="annottext">Param
</span><a href="#local-6989586621684568916"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-487"></span><span>      </span><span class="annot"><span class="annottext">VName -&gt; PyExp -&gt; Map VName PyExp
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Param -&gt; VName
</span><a href="Futhark.CodeGen.ImpCode.html#paramName"><span class="hs-identifier hs-var">Imp.paramName</span></a></span><span> </span><span class="annot"><span class="annottext">Param
</span><a href="#local-6989586621684568916"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; Map VName PyExp) -&gt; PyExp -&gt; Map VName PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-488"></span><span>        </span><span class="annot"><span class="annottext">PyExp -&gt; PyIdx -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Index"><span class="hs-identifier hs-var">Index</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;self.constants&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyIdx -&gt; PyExp) -&gt; PyIdx -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-489"></span><span>          </span><span class="annot"><span class="annottext">PyExp -&gt; PyIdx
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#IdxExp"><span class="hs-identifier hs-var">IdxExp</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyIdx) -&gt; PyExp -&gt; PyIdx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [Char] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; [Char]) -&gt; VName -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Param -&gt; VName
</span><a href="Futhark.CodeGen.ImpCode.html#paramName"><span class="hs-identifier hs-var">Imp.paramName</span></a></span><span> </span><span class="annot"><span class="annottext">Param
</span><a href="#local-6989586621684568916"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span id="local-6989586621684569654"><span id="local-6989586621684569655"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileConstants"><span class="hs-identifier hs-type">compileConstants</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Constants"><span class="hs-identifier hs-type">Imp.Constants</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569655"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569655"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569654"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-492"></span><span id="compileConstants"><span class="annot"><span class="annottext">compileConstants :: forall op s. Constants op -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileConstants"><span class="hs-identifier hs-var hs-var">compileConstants</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Constants"><span class="hs-identifier hs-type">Imp.Constants</span></a></span><span> </span><span class="annot"><span class="annottext">[Param]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568909"><span class="annot"><span class="annottext">Code op
</span><a href="#local-6989586621684568909"><span class="hs-identifier hs-var">init_consts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-493"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#atInit"><span class="hs-identifier hs-var">atInit</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;self.constants&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(PyExp, PyExp)] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Dict"><span class="hs-identifier hs-var">Dict</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-494"></span><span>  </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; [PyStmt] -&gt; CompilerM op s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#atInit"><span class="hs-identifier hs-var">atInit</span></a></span><span> </span><span class="annot"><span class="annottext">([PyStmt] -&gt; CompilerM op s ())
-&gt; CompilerM op s [PyStmt] -&gt; CompilerM op s ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">CompilerM op s () -&gt; CompilerM op s [PyStmt]
forall op s. CompilerM op s () -&gt; CompilerM op s [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#collect"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Code op -&gt; CompilerM op s ()
forall op s. Code op -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="annot"><span class="annottext">Code op
</span><a href="#local-6989586621684568909"><span class="hs-identifier hs-var">init_consts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span id="local-6989586621684569648"><span id="local-6989586621684569649"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileFunc"><span class="hs-identifier hs-type">compileFunc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Function"><span class="hs-identifier hs-type">Imp.Function</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569649"><span class="hs-identifier hs-type">op</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569649"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569648"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyFunDef"><span class="hs-identifier hs-type">PyFunDef</span></a></span></span></span><span>
</span><span id="line-497"></span><span id="compileFunc"><span class="annot"><span class="annottext">compileFunc :: forall op s. (Name, Function op) -&gt; CompilerM op s PyFunDef
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileFunc"><span class="hs-identifier hs-var hs-var">compileFunc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684568903"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684568903"><span class="hs-identifier hs-var">fname</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Function"><span class="hs-identifier hs-type">Imp.Function</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568901"><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621684568901"><span class="hs-identifier hs-var">outputs</span></a></span></span><span> </span><span id="local-6989586621684568900"><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621684568900"><span class="hs-identifier hs-var">inputs</span></a></span></span><span> </span><span id="local-6989586621684568899"><span class="annot"><span class="annottext">Code op
</span><a href="#local-6989586621684568899"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="annot"><span class="annottext">[ExternalValue]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[(Name, ExternalValue)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-498"></span><span>  </span><span id="local-6989586621684568898"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568898"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompilerM op s () -&gt; CompilerM op s [PyStmt]
forall op s. CompilerM op s () -&gt; CompilerM op s [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#collect"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="annot"><span class="annottext">(CompilerM op s () -&gt; CompilerM op s [PyStmt])
-&gt; CompilerM op s () -&gt; CompilerM op s [PyStmt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code op -&gt; CompilerM op s ()
forall op s. Code op -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="annot"><span class="annottext">Code op
</span><a href="#local-6989586621684568899"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-499"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568897"><span class="annot"><span class="annottext">inputs' :: [[Char]]
</span><a href="#local-6989586621684568897"><span class="hs-identifier hs-var hs-var">inputs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Param -&gt; [Char]) -&gt; [Param] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileName"><span class="hs-identifier hs-var">compileName</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; [Char]) -&gt; (Param -&gt; VName) -&gt; Param -&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Param -&gt; VName
</span><a href="Futhark.CodeGen.ImpCode.html#paramName"><span class="hs-identifier hs-var">Imp.paramName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621684568900"><span class="hs-identifier hs-var">inputs</span></a></span><span>
</span><span id="line-500"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568896"><span class="annot"><span class="annottext">ret :: PyStmt
</span><a href="#local-6989586621684568896"><span class="hs-identifier hs-var hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#tupleOrSingle"><span class="hs-identifier hs-var">tupleOrSingle</span></a></span><span> </span><span class="annot"><span class="annottext">([PyExp] -&gt; PyExp) -&gt; [PyExp] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Param] -&gt; [PyExp]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileOutput"><span class="hs-identifier hs-var">compileOutput</span></a></span><span> </span><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621684568901"><span class="hs-identifier hs-var">outputs</span></a></span><span>
</span><span id="line-501"></span><span>  </span><span class="annot"><span class="annottext">PyFunDef -&gt; CompilerM op s PyFunDef
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PyFunDef -&gt; CompilerM op s PyFunDef)
-&gt; PyFunDef -&gt; CompilerM op s PyFunDef
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-502"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; [[Char]] -&gt; [PyStmt] -&gt; PyFunDef
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#futharkFun"><span class="hs-identifier hs-var">futharkFun</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; [Char]) -&gt; (Name -&gt; [Char]) -&gt; Name -&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Char]
</span><a href="Language.Futhark.Core.html#nameToString"><span class="hs-identifier hs-var">nameToString</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; [Char]) -&gt; Name -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684568903"><span class="hs-identifier hs-var">fname</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;self&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [[Char]] -&gt; [[Char]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568897"><span class="hs-identifier hs-var">inputs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([PyStmt] -&gt; PyFunDef) -&gt; [PyStmt] -&gt; PyFunDef
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-503"></span><span>      </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568898"><span class="hs-identifier hs-var">body'</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyStmt
</span><a href="#local-6989586621684568896"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#tupleOrSingle"><span class="hs-identifier hs-type">tupleOrSingle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span>
</span><span id="line-506"></span><span id="tupleOrSingle"><span class="annot"><span class="annottext">tupleOrSingle :: [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#tupleOrSingle"><span class="hs-identifier hs-var hs-var">tupleOrSingle</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621684568892"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568892"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568892"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-507"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#tupleOrSingle"><span class="hs-identifier hs-var">tupleOrSingle</span></a></span><span> </span><span id="local-6989586621684568891"><span class="annot"><span class="annottext">[PyExp]
</span><a href="#local-6989586621684568891"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Tuple"><span class="hs-identifier hs-var">Tuple</span></a></span><span> </span><span class="annot"><span class="annottext">[PyExp]
</span><a href="#local-6989586621684568891"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span class="hs-comment">-- | A 'Call' where the function is a variable and every argument is a</span><span>
</span><span id="line-510"></span><span class="hs-comment">-- simple 'Arg'.</span><span>
</span><span id="line-511"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-type">simpleCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span>
</span><span id="line-512"></span><span id="simpleCall"><span class="annot"><span class="annottext">simpleCall :: [Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var hs-var">simpleCall</span></a></span></span><span> </span><span id="local-6989586621684568890"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568890"><span class="hs-identifier hs-var">fname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; [PyArg] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Call"><span class="hs-identifier hs-var">Call</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568890"><span class="hs-identifier hs-var">fname</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([PyArg] -&gt; PyExp) -&gt; ([PyExp] -&gt; [PyArg]) -&gt; [PyExp] -&gt; PyExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyArg) -&gt; [PyExp] -&gt; [PyArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileName"><span class="hs-identifier hs-type">compileName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-515"></span><span id="compileName"><span class="annot"><span class="annottext">compileName :: VName -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileName"><span class="hs-identifier hs-var hs-var">compileName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="Futhark.Util.html#zEncodeString"><span class="hs-identifier hs-var">zEncodeString</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; [Char]) -&gt; (VName -&gt; [Char]) -&gt; VName -&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span>
</span><span id="line-516"></span><span>
</span><span id="line-517"></span><span id="local-6989586621684569604"><span id="local-6989586621684569605"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileDim"><span class="hs-identifier hs-type">compileDim</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#DimSize"><span class="hs-identifier hs-type">Imp.DimSize</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569605"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569604"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span></span></span><span>
</span><span id="line-518"></span><span id="compileDim"><span class="annot"><span class="annottext">compileDim :: forall op s. DimSize -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileDim"><span class="hs-identifier hs-var hs-var">compileDim</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Constant"><span class="hs-identifier hs-type">Imp.Constant</span></a></span><span> </span><span id="local-6989586621684568887"><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684568887"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; CompilerM op s PyExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; CompilerM op s PyExp) -&gt; PyExp -&gt; CompilerM op s PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimValue -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimValue"><span class="hs-identifier hs-var">compilePrimValue</span></a></span><span> </span><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684568887"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-519"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileDim"><span class="hs-identifier hs-var">compileDim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-type">Imp.Var</span></a></span><span> </span><span id="local-6989586621684568885"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568885"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568885"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span id="local-6989586621684569597"><span id="local-6989586621684569598"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#unpackDim"><span class="hs-identifier hs-type">unpackDim</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#DimSize"><span class="hs-identifier hs-type">Imp.DimSize</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569598"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569597"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-522"></span><span id="unpackDim"><span class="annot"><span class="annottext">unpackDim :: forall op s. PyExp -&gt; DimSize -&gt; Int32 -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#unpackDim"><span class="hs-identifier hs-var hs-var">unpackDim</span></a></span></span><span> </span><span id="local-6989586621684568883"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568883"><span class="hs-identifier hs-var">arr_name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Constant"><span class="hs-identifier hs-type">Imp.Constant</span></a></span><span> </span><span id="local-6989586621684568882"><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684568882"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684568881"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621684568881"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-523"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568880"><span class="annot"><span class="annottext">shape_name :: PyExp
</span><a href="#local-6989586621684568880"><span class="hs-identifier hs-var hs-var">shape_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; [Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Field"><span class="hs-identifier hs-var">Field</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568883"><span class="hs-identifier hs-var">arr_name</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;shape&quot;</span></span><span>
</span><span id="line-524"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568879"><span class="annot"><span class="annottext">constant_c :: PyExp
</span><a href="#local-6989586621684568879"><span class="hs-identifier hs-var hs-var">constant_c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimValue -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimValue"><span class="hs-identifier hs-var">compilePrimValue</span></a></span><span> </span><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684568882"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-525"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568877"><span class="annot"><span class="annottext">constant_i :: PyExp
</span><a href="#local-6989586621684568877"><span class="hs-identifier hs-var hs-var">constant_i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; PyExp) -&gt; Integer -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621684568881"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-526"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-527"></span><span>    </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assert"><span class="hs-identifier hs-var">Assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;==&quot;</span></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568879"><span class="hs-identifier hs-var">constant_c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp -&gt; PyIdx -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Index"><span class="hs-identifier hs-var">Index</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568880"><span class="hs-identifier hs-var">shape_name</span></a></span><span> </span><span class="annot"><span class="annottext">(PyIdx -&gt; PyExp) -&gt; PyIdx -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyIdx
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#IdxExp"><span class="hs-identifier hs-var">IdxExp</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568877"><span class="hs-identifier hs-var">constant_i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-528"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Entry point arguments have invalid sizes.&quot;</span></span><span>
</span><span id="line-529"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#unpackDim"><span class="hs-identifier hs-var">unpackDim</span></a></span><span> </span><span id="local-6989586621684568875"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568875"><span class="hs-identifier hs-var">arr_name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-type">Imp.Var</span></a></span><span> </span><span id="local-6989586621684568874"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568874"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684568873"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621684568873"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-530"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568872"><span class="annot"><span class="annottext">shape_name :: PyExp
</span><a href="#local-6989586621684568872"><span class="hs-identifier hs-var hs-var">shape_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; [Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Field"><span class="hs-identifier hs-var">Field</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568875"><span class="hs-identifier hs-var">arr_name</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;shape&quot;</span></span><span>
</span><span id="line-531"></span><span>      </span><span id="local-6989586621684568870"><span class="annot"><span class="annottext">src :: PyExp
</span><a href="#local-6989586621684568870"><span class="hs-identifier hs-var hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyIdx -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Index"><span class="hs-identifier hs-var">Index</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568872"><span class="hs-identifier hs-var">shape_name</span></a></span><span> </span><span class="annot"><span class="annottext">(PyIdx -&gt; PyExp) -&gt; PyIdx -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyIdx
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#IdxExp"><span class="hs-identifier hs-var">IdxExp</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyIdx) -&gt; PyExp -&gt; PyIdx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; PyExp) -&gt; Integer -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621684568873"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-532"></span><span>  </span><span id="local-6989586621684568869"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568869"><span class="hs-identifier hs-var">var'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568874"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-533"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-534"></span><span>    </span><span class="annot"><span class="annottext">PyExp -&gt; [PyStmt] -&gt; [PyStmt] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#If"><span class="hs-identifier hs-var">If</span></a></span><span>
</span><span id="line-535"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;==&quot;</span></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568869"><span class="hs-identifier hs-var">var'</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#None"><span class="hs-identifier hs-var">None</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-536"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568869"><span class="hs-identifier hs-var">var'</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.int64&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568870"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-537"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assert"><span class="hs-identifier hs-var">Assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;==&quot;</span></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568869"><span class="hs-identifier hs-var">var'</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568870"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-538"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Error: entry point arguments have invalid sizes.&quot;</span></span><span>
</span><span id="line-539"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span id="local-6989586621684569592"><span id="local-6989586621684569593"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#entryPointOutput"><span class="hs-identifier hs-type">entryPointOutput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ExternalValue"><span class="hs-identifier hs-type">Imp.ExternalValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569593"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569592"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span></span></span><span>
</span><span id="line-542"></span><span id="entryPointOutput"><span class="annot"><span class="annottext">entryPointOutput :: forall op s. ExternalValue -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#entryPointOutput"><span class="hs-identifier hs-var hs-var">entryPointOutput</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#OpaqueValue"><span class="hs-identifier hs-type">Imp.OpaqueValue</span></a></span><span> </span><span id="local-6989586621684568848"><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684568848"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621684568847"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568847"><span class="hs-identifier hs-var">desc</span></a></span></span><span> </span><span id="local-6989586621684568846"><span class="annot"><span class="annottext">[ValueDesc]
</span><a href="#local-6989586621684568846"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-543"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;opaque&quot;</span></span><span> </span><span class="annot"><span class="annottext">([PyExp] -&gt; PyExp) -&gt; ([PyExp] -&gt; [PyExp]) -&gt; [PyExp] -&gt; PyExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568847"><span class="hs-identifier hs-var">desc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; [PyExp] -&gt; [PyExp]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-544"></span><span>    </span><span class="annot"><span class="annottext">([PyExp] -&gt; PyExp)
-&gt; CompilerM op s [PyExp] -&gt; CompilerM op s PyExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(ValueDesc -&gt; CompilerM op s PyExp)
-&gt; [ValueDesc] -&gt; CompilerM op s [PyExp]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExternalValue -&gt; CompilerM op s PyExp
forall op s. ExternalValue -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#entryPointOutput"><span class="hs-identifier hs-var">entryPointOutput</span></a></span><span> </span><span class="annot"><span class="annottext">(ExternalValue -&gt; CompilerM op s PyExp)
-&gt; (ValueDesc -&gt; ExternalValue)
-&gt; ValueDesc
-&gt; CompilerM op s PyExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Uniqueness -&gt; ValueDesc -&gt; ExternalValue
</span><a href="Futhark.CodeGen.ImpCode.html#TransparentValue"><span class="hs-identifier hs-var">Imp.TransparentValue</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684568848"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ValueDesc]
</span><a href="#local-6989586621684568846"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-545"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#entryPointOutput"><span class="hs-identifier hs-var">entryPointOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#TransparentValue"><span class="hs-identifier hs-type">Imp.TransparentValue</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ScalarValue"><span class="hs-identifier hs-type">Imp.ScalarValue</span></a></span><span> </span><span id="local-6989586621684568845"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568845"><span class="hs-identifier hs-var">bt</span></a></span></span><span> </span><span id="local-6989586621684568844"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568844"><span class="hs-identifier hs-var">ept</span></a></span></span><span> </span><span id="local-6989586621684568843"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568843"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-546"></span><span>  </span><span id="local-6989586621684568842"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568842"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568843"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-547"></span><span>  </span><span class="annot"><span class="annottext">PyExp -&gt; CompilerM op s PyExp
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; CompilerM op s PyExp) -&gt; PyExp -&gt; CompilerM op s PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568841"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568842"><span class="hs-identifier hs-var">name'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-548"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-549"></span><span>    </span><span id="local-6989586621684568841"><span class="annot"><span class="annottext">tf :: [Char]
</span><a href="#local-6989586621684568841"><span class="hs-identifier hs-var hs-var">tf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; Signedness -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimToExtNp"><span class="hs-identifier hs-var">compilePrimToExtNp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568845"><span class="hs-identifier hs-var">bt</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568844"><span class="hs-identifier hs-var">ept</span></a></span><span>
</span><span id="line-550"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#entryPointOutput"><span class="hs-identifier hs-var">entryPointOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#TransparentValue"><span class="hs-identifier hs-type">Imp.TransparentValue</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ArrayValue"><span class="hs-identifier hs-type">Imp.ArrayValue</span></a></span><span> </span><span id="local-6989586621684568840"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568840"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Space"><span class="hs-identifier hs-type">Imp.Space</span></a></span><span> </span><span id="local-6989586621684568838"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568838"><span class="hs-identifier hs-var">sid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684568837"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568837"><span class="hs-identifier hs-var">bt</span></a></span></span><span> </span><span id="local-6989586621684568836"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568836"><span class="hs-identifier hs-var">ept</span></a></span></span><span> </span><span id="local-6989586621684568835"><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568835"><span class="hs-identifier hs-var">dims</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-551"></span><span>  </span><span id="local-6989586621684568834"><span class="annot"><span class="annottext">EntryOutput op s
</span><a href="#local-6989586621684568834"><span class="hs-identifier hs-var">pack_output</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CompilerEnv op s -&gt; EntryOutput op s)
-&gt; CompilerM op s (EntryOutput op s)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">CompilerEnv op s -&gt; EntryOutput op s
forall op s. CompilerEnv op s -&gt; EntryOutput op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envEntryOutput"><span class="hs-identifier hs-var">envEntryOutput</span></a></span><span>
</span><span id="line-552"></span><span>  </span><span class="annot"><span class="annottext">EntryOutput op s
</span><a href="#local-6989586621684568834"><span class="hs-identifier hs-var">pack_output</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568840"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568838"><span class="hs-identifier hs-var">sid</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568837"><span class="hs-identifier hs-var">bt</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568836"><span class="hs-identifier hs-var">ept</span></a></span><span> </span><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568835"><span class="hs-identifier hs-var">dims</span></a></span><span>
</span><span id="line-553"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#entryPointOutput"><span class="hs-identifier hs-var">entryPointOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#TransparentValue"><span class="hs-identifier hs-type">Imp.TransparentValue</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ArrayValue"><span class="hs-identifier hs-type">Imp.ArrayValue</span></a></span><span> </span><span id="local-6989586621684568832"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568832"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568831"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568831"><span class="hs-identifier hs-var">bt</span></a></span></span><span> </span><span id="local-6989586621684568830"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568830"><span class="hs-identifier hs-var">ept</span></a></span></span><span> </span><span id="local-6989586621684568829"><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568829"><span class="hs-identifier hs-var">dims</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-554"></span><span>  </span><span id="local-6989586621684568828"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568828"><span class="hs-identifier hs-var">mem'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; [Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Cast"><span class="hs-identifier hs-var">Cast</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; [Char] -&gt; PyExp)
-&gt; CompilerM op s PyExp -&gt; CompilerM op s ([Char] -&gt; PyExp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568832"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerM op s ([Char] -&gt; PyExp)
-&gt; CompilerM op s [Char] -&gt; CompilerM op s PyExp
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; CompilerM op s [Char]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType -&gt; Signedness -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimTypeExt"><span class="hs-identifier hs-var">compilePrimTypeExt</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568831"><span class="hs-identifier hs-var">bt</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568830"><span class="hs-identifier hs-var">ept</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>  </span><span id="local-6989586621684568826"><span class="annot"><span class="annottext">[PyExp]
</span><a href="#local-6989586621684568826"><span class="hs-identifier hs-var">dims'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(DimSize -&gt; CompilerM op s PyExp)
-&gt; [DimSize] -&gt; CompilerM op s [PyExp]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">DimSize -&gt; CompilerM op s PyExp
forall op s. DimSize -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileDim"><span class="hs-identifier hs-var">compileDim</span></a></span><span> </span><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568829"><span class="hs-identifier hs-var">dims</span></a></span><span>
</span><span id="line-556"></span><span>  </span><span class="annot"><span class="annottext">PyExp -&gt; CompilerM op s PyExp
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; CompilerM op s PyExp) -&gt; PyExp -&gt; CompilerM op s PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;createArray&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568828"><span class="hs-identifier hs-var">mem'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Tuple"><span class="hs-identifier hs-var">Tuple</span></a></span><span> </span><span class="annot"><span class="annottext">[PyExp]
</span><a href="#local-6989586621684568826"><span class="hs-identifier hs-var">dims'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [Char] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; Signedness -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimToExtNp"><span class="hs-identifier hs-var">compilePrimToExtNp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568831"><span class="hs-identifier hs-var">bt</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568830"><span class="hs-identifier hs-var">ept</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#badInput"><span class="hs-identifier hs-type">badInput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span>
</span><span id="line-559"></span><span id="badInput"><span class="annot"><span class="annottext">badInput :: Int -&gt; PyExp -&gt; [Char] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#badInput"><span class="hs-identifier hs-var hs-var">badInput</span></a></span></span><span> </span><span id="local-6989586621684568824"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568824"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621684568823"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568823"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684568822"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568822"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-560"></span><span>  </span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Raise"><span class="hs-identifier hs-var">Raise</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-561"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span>
</span><span id="line-562"></span><span>      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;TypeError&quot;</span></span><span>
</span><span id="line-563"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; [PyArg] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Call"><span class="hs-identifier hs-var">Call</span></a></span><span>
</span><span id="line-564"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp -&gt; [Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Field"><span class="hs-identifier hs-var">Field</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568820"><span class="hs-identifier hs-var">err_msg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;format&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568822"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyArg) -&gt; PyExp -&gt; PyArg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;type&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568823"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568823"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-566"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-567"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-568"></span><span>    </span><span id="local-6989586621684568820"><span class="annot"><span class="annottext">err_msg :: [Char]
</span><a href="#local-6989586621684568820"><span class="hs-identifier hs-var hs-var">err_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-569"></span><span>      </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
</span><span class="hs-identifier hs-var">unlines</span></span><span>
</span><span id="line-570"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Argument #&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568824"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; has invalid value&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-571"></span><span>          </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Futhark type: {}&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-572"></span><span>          </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Argument has Python type {} and value: {}&quot;</span></span><span>
</span><span id="line-573"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-574"></span><span>
</span><span id="line-575"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#badInputType"><span class="hs-identifier hs-type">badInputType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span>
</span><span id="line-576"></span><span id="badInputType"><span class="annot"><span class="annottext">badInputType :: Int -&gt; PyExp -&gt; [Char] -&gt; PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#badInputType"><span class="hs-identifier hs-var hs-var">badInputType</span></a></span></span><span> </span><span id="local-6989586621684568811"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568811"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621684568810"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568810"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684568809"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568809"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621684568808"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568808"><span class="hs-identifier hs-var">de</span></a></span></span><span> </span><span id="local-6989586621684568807"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568807"><span class="hs-identifier hs-var">dg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-577"></span><span>  </span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Raise"><span class="hs-identifier hs-var">Raise</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-578"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span>
</span><span id="line-579"></span><span>      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;TypeError&quot;</span></span><span>
</span><span id="line-580"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; [PyArg] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Call"><span class="hs-identifier hs-var">Call</span></a></span><span>
</span><span id="line-581"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp -&gt; [Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Field"><span class="hs-identifier hs-var">Field</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568806"><span class="hs-identifier hs-var">err_msg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;format&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-582"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568809"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyArg) -&gt; PyExp -&gt; PyArg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;type&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568810"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568810"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568808"><span class="hs-identifier hs-var">de</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568807"><span class="hs-identifier hs-var">dg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-583"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-584"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-585"></span><span>    </span><span id="local-6989586621684568806"><span class="annot"><span class="annottext">err_msg :: [Char]
</span><a href="#local-6989586621684568806"><span class="hs-identifier hs-var hs-var">err_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-586"></span><span>      </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
</span><span class="hs-identifier hs-var">unlines</span></span><span>
</span><span id="line-587"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Argument #&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568811"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; has invalid value&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-588"></span><span>          </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Futhark type: {}&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-589"></span><span>          </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Argument has Python type {} and value: {}&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-590"></span><span>          </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Expected array with elements of dtype: {}&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-591"></span><span>          </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;The array given has elements of dtype: {}&quot;</span></span><span>
</span><span id="line-592"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-593"></span><span>
</span><span id="line-594"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#badInputDim"><span class="hs-identifier hs-type">badInputDim</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span>
</span><span id="line-595"></span><span id="badInputDim"><span class="annot"><span class="annottext">badInputDim :: Int -&gt; PyExp -&gt; [Char] -&gt; Int -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#badInputDim"><span class="hs-identifier hs-var hs-var">badInputDim</span></a></span></span><span> </span><span id="local-6989586621684568800"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568800"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621684568799"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568799"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684568798"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568798"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span id="local-6989586621684568797"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568797"><span class="hs-identifier hs-var">dimf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-596"></span><span>  </span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Raise"><span class="hs-identifier hs-var">Raise</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-597"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span>
</span><span id="line-598"></span><span>      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;TypeError&quot;</span></span><span>
</span><span id="line-599"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; [PyArg] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Call"><span class="hs-identifier hs-var">Call</span></a></span><span>
</span><span id="line-600"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp -&gt; [Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Field"><span class="hs-identifier hs-var">Field</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568796"><span class="hs-identifier hs-var">err_msg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;format&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-601"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568795"><span class="hs-identifier hs-var">eft</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568794"><span class="hs-identifier hs-var">aft</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-602"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-603"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-604"></span><span>    </span><span id="local-6989586621684568795"><span class="annot"><span class="annottext">eft :: PyExp
</span><a href="#local-6989586621684568795"><span class="hs-identifier hs-var hs-var">eft</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Char] -&gt; [[Char]]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568797"><span class="hs-identifier hs-var">dimf</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;[]&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568798"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-605"></span><span>    </span><span id="local-6989586621684568794"><span class="annot"><span class="annottext">aft :: PyExp
</span><a href="#local-6989586621684568794"><span class="hs-identifier hs-var hs-var">aft</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;+&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;[]&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp -&gt; [Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Field"><span class="hs-identifier hs-var">Field</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568799"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ndim&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568798"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span>    </span><span id="local-6989586621684568796"><span class="annot"><span class="annottext">err_msg :: [Char]
</span><a href="#local-6989586621684568796"><span class="hs-identifier hs-var hs-var">err_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-607"></span><span>      </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
</span><span class="hs-identifier hs-var">unlines</span></span><span>
</span><span id="line-608"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Argument #&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568800"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; has invalid value&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-609"></span><span>          </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Dimensionality mismatch&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-610"></span><span>          </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Expected Futhark type: {}&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-611"></span><span>          </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Bad Python value passed&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-612"></span><span>          </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Actual Futhark type: {}&quot;</span></span><span>
</span><span id="line-613"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-614"></span><span>
</span><span id="line-615"></span><span id="local-6989586621684569583"><span id="local-6989586621684569584"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#declEntryPointInputSizes"><span class="hs-identifier hs-type">declEntryPointInputSizes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ExternalValue"><span class="hs-identifier hs-type">Imp.ExternalValue</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569584"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569583"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-616"></span><span id="declEntryPointInputSizes"><span class="annot"><span class="annottext">declEntryPointInputSizes :: forall op s. [ExternalValue] -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#declEntryPointInputSizes"><span class="hs-identifier hs-var hs-var">declEntryPointInputSizes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; CompilerM op s ()) -&gt; [VName] -&gt; CompilerM op s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s ()
forall {op} {s}. VName -&gt; CompilerM op s ()
</span><a href="#local-6989586621684568782"><span class="hs-identifier hs-var">onSize</span></a></span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; CompilerM op s ())
-&gt; ([ExternalValue] -&gt; [VName])
-&gt; [ExternalValue]
-&gt; CompilerM op s ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ExternalValue -&gt; [VName]) -&gt; [ExternalValue] -&gt; [VName]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">ExternalValue -&gt; [VName]
</span><a href="#local-6989586621684568781"><span class="hs-identifier hs-var">sizes</span></a></span><span>
</span><span id="line-617"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-618"></span><span>    </span><span id="local-6989586621684568781"><span class="annot"><span class="annottext">sizes :: ExternalValue -&gt; [VName]
</span><a href="#local-6989586621684568781"><span class="hs-identifier hs-var hs-var">sizes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#TransparentValue"><span class="hs-identifier hs-type">Imp.TransparentValue</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568779"><span class="annot"><span class="annottext">ValueDesc
</span><a href="#local-6989586621684568779"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ValueDesc -&gt; [VName]
</span><a href="#local-6989586621684568778"><span class="hs-identifier hs-var">valueSizes</span></a></span><span> </span><span class="annot"><span class="annottext">ValueDesc
</span><a href="#local-6989586621684568779"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-619"></span><span>    </span><span class="annot"><a href="#local-6989586621684568781"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#OpaqueValue"><span class="hs-identifier hs-type">Imp.OpaqueValue</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568777"><span class="annot"><span class="annottext">[ValueDesc]
</span><a href="#local-6989586621684568777"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ValueDesc -&gt; [VName]) -&gt; [ValueDesc] -&gt; [VName]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">ValueDesc -&gt; [VName]
</span><a href="#local-6989586621684568778"><span class="hs-identifier hs-var">valueSizes</span></a></span><span> </span><span class="annot"><span class="annottext">[ValueDesc]
</span><a href="#local-6989586621684568777"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-620"></span><span>    </span><span id="local-6989586621684568778"><span class="annot"><span class="annottext">valueSizes :: ValueDesc -&gt; [VName]
</span><a href="#local-6989586621684568778"><span class="hs-identifier hs-var hs-var">valueSizes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ArrayValue"><span class="hs-identifier hs-type">Imp.ArrayValue</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568776"><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568776"><span class="hs-identifier hs-var">dims</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DimSize] -&gt; [VName]
</span><a href="Futhark.IR.Prop.html#subExpVars"><span class="hs-identifier hs-var">subExpVars</span></a></span><span> </span><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568776"><span class="hs-identifier hs-var">dims</span></a></span><span>
</span><span id="line-621"></span><span>    </span><span class="annot"><a href="#local-6989586621684568778"><span class="hs-identifier hs-var">valueSizes</span></a></span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ScalarValue"><span class="hs-identifier hs-type">Imp.ScalarValue</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-622"></span><span>    </span><span id="local-6989586621684568782"><span class="annot"><span class="annottext">onSize :: VName -&gt; CompilerM op s ()
</span><a href="#local-6989586621684568782"><span class="hs-identifier hs-var hs-var">onSize</span></a></span></span><span> </span><span id="local-6989586621684568775"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568775"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileName"><span class="hs-identifier hs-var">compileName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568775"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#None"><span class="hs-identifier hs-var">None</span></a></span><span>
</span><span id="line-623"></span><span>
</span><span id="line-624"></span><span id="local-6989586621684569577"><span id="local-6989586621684569578"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#entryPointInput"><span class="hs-identifier hs-type">entryPointInput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ExternalValue"><span class="hs-identifier hs-type">Imp.ExternalValue</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569578"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569577"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-625"></span><span id="entryPointInput"><span class="annot"><span class="annottext">entryPointInput :: forall op s. (Int, ExternalValue, PyExp) -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#entryPointInput"><span class="hs-identifier hs-var hs-var">entryPointInput</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684568735"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568735"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#OpaqueValue"><span class="hs-identifier hs-type">Imp.OpaqueValue</span></a></span><span> </span><span id="local-6989586621684568734"><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684568734"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621684568733"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568733"><span class="hs-identifier hs-var">desc</span></a></span></span><span> </span><span id="local-6989586621684568732"><span class="annot"><span class="annottext">[ValueDesc]
</span><a href="#local-6989586621684568732"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568731"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568731"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-626"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568730"><span class="annot"><span class="annottext">type_is_ok :: PyExp
</span><a href="#local-6989586621684568730"><span class="hs-identifier hs-var hs-var">type_is_ok</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-627"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span>
</span><span id="line-628"></span><span>          </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;and&quot;</span></span><span>
</span><span id="line-629"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;isinstance&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568731"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;opaque&quot;</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-630"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;==&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp -&gt; [Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Field"><span class="hs-identifier hs-var">Field</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568731"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;desc&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568733"><span class="hs-identifier hs-var">desc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-631"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; [PyStmt] -&gt; [PyStmt] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#If"><span class="hs-identifier hs-var">If</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#UnOp"><span class="hs-identifier hs-var">UnOp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;not&quot;</span></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568730"><span class="hs-identifier hs-var">type_is_ok</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; PyExp -&gt; [Char] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#badInput"><span class="hs-identifier hs-var">badInput</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568735"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568731"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568733"><span class="hs-identifier hs-var">desc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-632"></span><span>  </span><span class="annot"><span class="annottext">((Int, ExternalValue, PyExp) -&gt; CompilerM op s ())
-&gt; [(Int, ExternalValue, PyExp)] -&gt; CompilerM op s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">(Int, ExternalValue, PyExp) -&gt; CompilerM op s ()
forall op s. (Int, ExternalValue, PyExp) -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#entryPointInput"><span class="hs-identifier hs-var">entryPointInput</span></a></span><span> </span><span class="annot"><span class="annottext">([(Int, ExternalValue, PyExp)] -&gt; CompilerM op s ())
-&gt; [(Int, ExternalValue, PyExp)] -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-633"></span><span>    </span><span class="annot"><span class="annottext">[Int]
-&gt; [ExternalValue] -&gt; [PyExp] -&gt; [(Int, ExternalValue, PyExp)]
forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><span class="hs-identifier hs-var">zip3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Int]
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568735"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ValueDesc -&gt; ExternalValue) -&gt; [ValueDesc] -&gt; [ExternalValue]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uniqueness -&gt; ValueDesc -&gt; ExternalValue
</span><a href="Futhark.CodeGen.ImpCode.html#TransparentValue"><span class="hs-identifier hs-var">Imp.TransparentValue</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684568734"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ValueDesc]
</span><a href="#local-6989586621684568732"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([PyExp] -&gt; [(Int, ExternalValue, PyExp)])
-&gt; [PyExp] -&gt; [(Int, ExternalValue, PyExp)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-634"></span><span>      </span><span class="annot"><span class="annottext">(Integer -&gt; PyExp) -&gt; [Integer] -&gt; [PyExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp -&gt; PyIdx -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Index"><span class="hs-identifier hs-var">Index</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp -&gt; [Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Field"><span class="hs-identifier hs-var">Field</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568731"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;data&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyIdx -&gt; PyExp) -&gt; (Integer -&gt; PyIdx) -&gt; Integer -&gt; PyExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyIdx
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#IdxExp"><span class="hs-identifier hs-var">IdxExp</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyIdx) -&gt; (Integer -&gt; PyExp) -&gt; Integer -&gt; PyIdx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-635"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#entryPointInput"><span class="hs-identifier hs-var">entryPointInput</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684568726"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568726"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#TransparentValue"><span class="hs-identifier hs-type">Imp.TransparentValue</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ScalarValue"><span class="hs-identifier hs-type">Imp.ScalarValue</span></a></span><span> </span><span id="local-6989586621684568725"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568725"><span class="hs-identifier hs-var">bt</span></a></span></span><span> </span><span id="local-6989586621684568724"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568724"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621684568723"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568723"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568722"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568722"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-636"></span><span>  </span><span id="local-6989586621684568721"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568721"><span class="hs-identifier hs-var">vname'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568723"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-637"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- HACK: A Numpy int64 will signal an OverflowError if we pass</span><span>
</span><span id="line-638"></span><span>      </span><span class="hs-comment">-- it a number bigger than 2**63.  This does not happen if we</span><span>
</span><span id="line-639"></span><span>      </span><span class="hs-comment">-- pass e.g. int8 a number bigger than 2**7.  As a workaround,</span><span>
</span><span id="line-640"></span><span>      </span><span class="hs-comment">-- we first go through the corresponding ctypes type, which does</span><span>
</span><span id="line-641"></span><span>      </span><span class="hs-comment">-- not have this problem.</span><span>
</span><span id="line-642"></span><span>      </span><span id="local-6989586621684568720"><span class="annot"><span class="annottext">ctobject :: [Char]
</span><a href="#local-6989586621684568720"><span class="hs-identifier hs-var hs-var">ctobject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimType"><span class="hs-identifier hs-var">compilePrimType</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568725"><span class="hs-identifier hs-var">bt</span></a></span><span>
</span><span id="line-643"></span><span>      </span><span id="local-6989586621684568719"><span class="annot"><span class="annottext">npobject :: [Char]
</span><a href="#local-6989586621684568719"><span class="hs-identifier hs-var hs-var">npobject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimToNp"><span class="hs-identifier hs-var">compilePrimToNp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568725"><span class="hs-identifier hs-var">bt</span></a></span><span>
</span><span id="line-644"></span><span>      </span><span id="local-6989586621684568718"><span class="annot"><span class="annottext">npcall :: PyExp
</span><a href="#local-6989586621684568718"><span class="hs-identifier hs-var hs-var">npcall</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-645"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span>
</span><span id="line-646"></span><span>          </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568719"><span class="hs-identifier hs-var">npobject</span></a></span><span>
</span><span id="line-647"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568725"><span class="hs-identifier hs-var">bt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-648"></span><span>              </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568720"><span class="hs-identifier hs-var">ctobject</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568722"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-649"></span><span>              </span><span class="annot"><span class="annottext">PrimType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568722"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-650"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-651"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-652"></span><span>    </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyExcept] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Try"><span class="hs-identifier hs-var">Try</span></a></span><span>
</span><span id="line-653"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568721"><span class="hs-identifier hs-var">vname'</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568718"><span class="hs-identifier hs-var">npcall</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-654"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; [PyStmt] -&gt; PyExcept
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Catch"><span class="hs-identifier hs-var">Catch</span></a></span><span>
</span><span id="line-655"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Tuple"><span class="hs-identifier hs-var">Tuple</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;TypeError&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;AssertionError&quot;</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; PyExp -&gt; [Char] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#badInput"><span class="hs-identifier hs-var">badInput</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568726"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568722"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyStmt) -&gt; [Char] -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; PrimType -&gt; [Char]
</span><a href="Futhark.IR.Primitive.html#prettySigned"><span class="hs-identifier hs-var">prettySigned</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568724"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness -&gt; Signedness -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">Imp.TypeUnsigned</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568725"><span class="hs-identifier hs-var">bt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-657"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-658"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#entryPointInput"><span class="hs-identifier hs-var">entryPointInput</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684568711"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568711"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#TransparentValue"><span class="hs-identifier hs-type">Imp.TransparentValue</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ArrayValue"><span class="hs-identifier hs-type">Imp.ArrayValue</span></a></span><span> </span><span id="local-6989586621684568710"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568710"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Space"><span class="hs-identifier hs-type">Imp.Space</span></a></span><span> </span><span id="local-6989586621684568709"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568709"><span class="hs-identifier hs-var">sid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684568708"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568708"><span class="hs-identifier hs-var">bt</span></a></span></span><span> </span><span id="local-6989586621684568707"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568707"><span class="hs-identifier hs-var">ept</span></a></span></span><span> </span><span id="local-6989586621684568706"><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568706"><span class="hs-identifier hs-var">dims</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568705"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568705"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-659"></span><span>  </span><span id="local-6989586621684568704"><span class="annot"><span class="annottext">EntryInput op s
</span><a href="#local-6989586621684568704"><span class="hs-identifier hs-var">unpack_input</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CompilerEnv op s -&gt; EntryInput op s)
-&gt; CompilerM op s (EntryInput op s)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">CompilerEnv op s -&gt; EntryInput op s
forall op s. CompilerEnv op s -&gt; EntryInput op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envEntryInput"><span class="hs-identifier hs-var">envEntryInput</span></a></span><span>
</span><span id="line-660"></span><span>  </span><span id="local-6989586621684568703"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568703"><span class="hs-identifier hs-var">mem'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568710"><span class="hs-identifier hs-var">mem</span></a></span><span>
</span><span id="line-661"></span><span>  </span><span id="local-6989586621684568702"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568702"><span class="hs-identifier hs-var">unpack</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompilerM op s () -&gt; CompilerM op s [PyStmt]
forall op s. CompilerM op s () -&gt; CompilerM op s [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#collect"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="annot"><span class="annottext">(CompilerM op s () -&gt; CompilerM op s [PyStmt])
-&gt; CompilerM op s () -&gt; CompilerM op s [PyStmt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntryInput op s
</span><a href="#local-6989586621684568704"><span class="hs-identifier hs-var">unpack_input</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568703"><span class="hs-identifier hs-var">mem'</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568709"><span class="hs-identifier hs-var">sid</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568708"><span class="hs-identifier hs-var">bt</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568707"><span class="hs-identifier hs-var">ept</span></a></span><span> </span><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568706"><span class="hs-identifier hs-var">dims</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568705"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-662"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-663"></span><span>    </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyExcept] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Try"><span class="hs-identifier hs-var">Try</span></a></span><span>
</span><span id="line-664"></span><span>      </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568702"><span class="hs-identifier hs-var">unpack</span></a></span><span>
</span><span id="line-665"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; [PyStmt] -&gt; PyExcept
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Catch"><span class="hs-identifier hs-var">Catch</span></a></span><span>
</span><span id="line-666"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Tuple"><span class="hs-identifier hs-var">Tuple</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;TypeError&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;AssertionError&quot;</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int -&gt; PyExp -&gt; [Char] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#badInput"><span class="hs-identifier hs-var">badInput</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568711"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568705"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyStmt) -&gt; [Char] -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-668"></span><span>              </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Char] -&gt; [[Char]]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DimSize] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568706"><span class="hs-identifier hs-var">dims</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;[]&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>                </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; PrimType -&gt; [Char]
</span><a href="Futhark.IR.Primitive.html#prettySigned"><span class="hs-identifier hs-var">prettySigned</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568707"><span class="hs-identifier hs-var">ept</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness -&gt; Signedness -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">Imp.TypeUnsigned</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568708"><span class="hs-identifier hs-var">bt</span></a></span><span>
</span><span id="line-670"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-671"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-672"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#entryPointInput"><span class="hs-identifier hs-var">entryPointInput</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684568701"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568701"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#TransparentValue"><span class="hs-identifier hs-type">Imp.TransparentValue</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ArrayValue"><span class="hs-identifier hs-type">Imp.ArrayValue</span></a></span><span> </span><span id="local-6989586621684568700"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568700"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568699"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568699"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621684568698"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568698"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621684568697"><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568697"><span class="hs-identifier hs-var">dims</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568696"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568696"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-673"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568695"><span class="annot"><span class="annottext">type_is_wrong :: PyExp
</span><a href="#local-6989586621684568695"><span class="hs-identifier hs-var hs-var">type_is_wrong</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#UnOp"><span class="hs-identifier hs-var">UnOp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;not&quot;</span></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyExp) -&gt; PyExp -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;in&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;type&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568696"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyExp) -&gt; PyExp -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#List"><span class="hs-identifier hs-var">List</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.ndarray&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-674"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568693"><span class="annot"><span class="annottext">dtype_is_wrong :: PyExp
</span><a href="#local-6989586621684568693"><span class="hs-identifier hs-var hs-var">dtype_is_wrong</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#UnOp"><span class="hs-identifier hs-var">UnOp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;not&quot;</span></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyExp) -&gt; PyExp -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;==&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp -&gt; [Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Field"><span class="hs-identifier hs-var">Field</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568696"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;dtype&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyExp) -&gt; PyExp -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [Char] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; Signedness -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimToExtNp"><span class="hs-identifier hs-var">compilePrimToExtNp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568699"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568698"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-675"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568689"><span class="annot"><span class="annottext">dim_is_wrong :: PyExp
</span><a href="#local-6989586621684568689"><span class="hs-identifier hs-var hs-var">dim_is_wrong</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#UnOp"><span class="hs-identifier hs-var">UnOp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;not&quot;</span></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyExp) -&gt; PyExp -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;==&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp -&gt; [Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Field"><span class="hs-identifier hs-var">Field</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568696"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ndim&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyExp) -&gt; PyExp -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; PyExp) -&gt; Integer -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Integer) -&gt; Int -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[DimSize] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568697"><span class="hs-identifier hs-var">dims</span></a></span><span>
</span><span id="line-676"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-677"></span><span>    </span><span class="annot"><span class="annottext">PyExp -&gt; [PyStmt] -&gt; [PyStmt] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#If"><span class="hs-identifier hs-var">If</span></a></span><span>
</span><span id="line-678"></span><span>      </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568695"><span class="hs-identifier hs-var">type_is_wrong</span></a></span><span>
</span><span id="line-679"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int -&gt; PyExp -&gt; [Char] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#badInput"><span class="hs-identifier hs-var">badInput</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568701"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568696"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyStmt) -&gt; [Char] -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-680"></span><span>          </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Char] -&gt; [[Char]]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DimSize] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568697"><span class="hs-identifier hs-var">dims</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;[]&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; PrimType -&gt; [Char]
</span><a href="Futhark.IR.Primitive.html#prettySigned"><span class="hs-identifier hs-var">prettySigned</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568698"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness -&gt; Signedness -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">Imp.TypeUnsigned</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568699"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-682"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-683"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-684"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-685"></span><span>    </span><span class="annot"><span class="annottext">PyExp -&gt; [PyStmt] -&gt; [PyStmt] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#If"><span class="hs-identifier hs-var">If</span></a></span><span>
</span><span id="line-686"></span><span>      </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568693"><span class="hs-identifier hs-var">dtype_is_wrong</span></a></span><span>
</span><span id="line-687"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int -&gt; PyExp -&gt; [Char] -&gt; PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#badInputType"><span class="hs-identifier hs-var">badInputType</span></a></span><span>
</span><span id="line-688"></span><span>          </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568701"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-689"></span><span>          </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568696"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-690"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Char] -&gt; [[Char]]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DimSize] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568697"><span class="hs-identifier hs-var">dims</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;[]&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; PrimType -&gt; [Char]
</span><a href="Futhark.IR.Primitive.html#prettySigned"><span class="hs-identifier hs-var">prettySigned</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568698"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness -&gt; Signedness -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">Imp.TypeUnsigned</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568699"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-691"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.dtype&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType -&gt; Signedness -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimToExtNp"><span class="hs-identifier hs-var">compilePrimToExtNp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568699"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568698"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-692"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp -&gt; [Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Field"><span class="hs-identifier hs-var">Field</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568696"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;dtype&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-693"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-694"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-695"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-696"></span><span>    </span><span class="annot"><span class="annottext">PyExp -&gt; [PyStmt] -&gt; [PyStmt] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#If"><span class="hs-identifier hs-var">If</span></a></span><span>
</span><span id="line-697"></span><span>      </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568689"><span class="hs-identifier hs-var">dim_is_wrong</span></a></span><span>
</span><span id="line-698"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; PyExp -&gt; [Char] -&gt; Int -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#badInputDim"><span class="hs-identifier hs-var">badInputDim</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568701"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568696"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; PrimType -&gt; [Char]
</span><a href="Futhark.IR.Primitive.html#prettySigned"><span class="hs-identifier hs-var">prettySigned</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568698"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness -&gt; Signedness -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">Imp.TypeUnsigned</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568699"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DimSize] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568697"><span class="hs-identifier hs-var">dims</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-699"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-700"></span><span>
</span><span id="line-701"></span><span>  </span><span class="annot"><span class="annottext">(DimSize -&gt; Int32 -&gt; CompilerM op s ())
-&gt; [DimSize] -&gt; [Int32] -&gt; CompilerM op s ()
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m ()
</span><span class="hs-identifier hs-var">zipWithM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp -&gt; DimSize -&gt; Int32 -&gt; CompilerM op s ()
forall op s. PyExp -&gt; DimSize -&gt; Int32 -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#unpackDim"><span class="hs-identifier hs-var">unpackDim</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568696"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568697"><span class="hs-identifier hs-var">dims</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int32
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-702"></span><span>  </span><span id="local-6989586621684568687"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568687"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568700"><span class="hs-identifier hs-var">mem</span></a></span><span>
</span><span id="line-703"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568686"><span class="annot"><span class="annottext">unwrap_call :: PyExp
</span><a href="#local-6989586621684568686"><span class="hs-identifier hs-var hs-var">unwrap_call</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;unwrapArray&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568696"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-704"></span><span>
</span><span id="line-705"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568687"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568686"><span class="hs-identifier hs-var">unwrap_call</span></a></span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#extValueDescName"><span class="hs-identifier hs-type">extValueDescName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ExternalValue"><span class="hs-identifier hs-type">Imp.ExternalValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-708"></span><span id="extValueDescName"><span class="annot"><span class="annottext">extValueDescName :: ExternalValue -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#extValueDescName"><span class="hs-identifier hs-var hs-var">extValueDescName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#TransparentValue"><span class="hs-identifier hs-type">Imp.TransparentValue</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568684"><span class="annot"><span class="annottext">ValueDesc
</span><a href="#local-6989586621684568684"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#extName"><span class="hs-identifier hs-var">extName</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; [Char]) -&gt; [Char] -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ValueDesc -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#valueDescName"><span class="hs-identifier hs-var">valueDescName</span></a></span><span> </span><span class="annot"><span class="annottext">ValueDesc
</span><a href="#local-6989586621684568684"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-709"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#extValueDescName"><span class="hs-identifier hs-var">extValueDescName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#OpaqueValue"><span class="hs-identifier hs-type">Imp.OpaqueValue</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568681"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568681"><span class="hs-identifier hs-var">desc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#extName"><span class="hs-identifier hs-var">extName</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; [Char]) -&gt; [Char] -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="Futhark.Util.html#zEncodeString"><span class="hs-identifier hs-var">zEncodeString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568681"><span class="hs-identifier hs-var">desc</span></a></span><span>
</span><span id="line-710"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#extValueDescName"><span class="hs-identifier hs-var">extValueDescName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#OpaqueValue"><span class="hs-identifier hs-type">Imp.OpaqueValue</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568680"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568680"><span class="hs-identifier hs-var">desc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684568679"><span class="annot"><span class="annottext">ValueDesc
</span><a href="#local-6989586621684568679"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[ValueDesc]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-711"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#extName"><span class="hs-identifier hs-var">extName</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; [Char]) -&gt; [Char] -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="Futhark.Util.html#zEncodeString"><span class="hs-identifier hs-var">zEncodeString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568680"><span class="hs-identifier hs-var">desc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Int
</span><a href="Language.Futhark.Core.html#baseTag"><span class="hs-identifier hs-var">baseTag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValueDesc -&gt; VName
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#valueDescVName"><span class="hs-identifier hs-var">valueDescVName</span></a></span><span> </span><span class="annot"><span class="annottext">ValueDesc
</span><a href="#local-6989586621684568679"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-712"></span><span>
</span><span id="line-713"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#extName"><span class="hs-identifier hs-type">extName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-714"></span><span id="extName"><span class="annot"><span class="annottext">extName :: [Char] -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#extName"><span class="hs-identifier hs-var hs-var">extName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;_ext&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#valueDescName"><span class="hs-identifier hs-type">valueDescName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ValueDesc"><span class="hs-identifier hs-type">Imp.ValueDesc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-717"></span><span id="valueDescName"><span class="annot"><span class="annottext">valueDescName :: ValueDesc -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#valueDescName"><span class="hs-identifier hs-var hs-var">valueDescName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileName"><span class="hs-identifier hs-var">compileName</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; [Char]) -&gt; (ValueDesc -&gt; VName) -&gt; ValueDesc -&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ValueDesc -&gt; VName
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#valueDescVName"><span class="hs-identifier hs-var">valueDescVName</span></a></span><span>
</span><span id="line-718"></span><span>
</span><span id="line-719"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#valueDescVName"><span class="hs-identifier hs-type">valueDescVName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ValueDesc"><span class="hs-identifier hs-type">Imp.ValueDesc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span>
</span><span id="line-720"></span><span id="valueDescVName"><span class="annot"><span class="annottext">valueDescVName :: ValueDesc -&gt; VName
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#valueDescVName"><span class="hs-identifier hs-var hs-var">valueDescVName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ScalarValue"><span class="hs-identifier hs-type">Imp.ScalarValue</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568676"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568676"><span class="hs-identifier hs-var">vname</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568676"><span class="hs-identifier hs-var">vname</span></a></span><span>
</span><span id="line-721"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#valueDescVName"><span class="hs-identifier hs-var">valueDescVName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ArrayValue"><span class="hs-identifier hs-type">Imp.ArrayValue</span></a></span><span> </span><span id="local-6989586621684568675"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568675"><span class="hs-identifier hs-var">vname</span></a></span></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[DimSize]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568675"><span class="hs-identifier hs-var">vname</span></a></span><span>
</span><span id="line-722"></span><span>
</span><span id="line-723"></span><span class="hs-comment">-- Key into the FUTHARK_PRIMTYPES dict.</span><span>
</span><span id="line-724"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#readTypeEnum"><span class="hs-identifier hs-type">readTypeEnum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Signedness"><span class="hs-identifier hs-type">Imp.Signedness</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-725"></span><span id="readTypeEnum"><span class="annot"><span class="annottext">readTypeEnum :: PrimType -&gt; Signedness -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#readTypeEnum"><span class="hs-identifier hs-var hs-var">readTypeEnum</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int8"><span class="hs-identifier hs-var">Int8</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">Imp.TypeUnsigned</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;u8&quot;</span></span><span>
</span><span id="line-726"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#readTypeEnum"><span class="hs-identifier hs-var">readTypeEnum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int16"><span class="hs-identifier hs-var">Int16</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">Imp.TypeUnsigned</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;u16&quot;</span></span><span>
</span><span id="line-727"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#readTypeEnum"><span class="hs-identifier hs-var">readTypeEnum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int32"><span class="hs-identifier hs-var">Int32</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">Imp.TypeUnsigned</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;u32&quot;</span></span><span>
</span><span id="line-728"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#readTypeEnum"><span class="hs-identifier hs-var">readTypeEnum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">Imp.TypeUnsigned</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;u64&quot;</span></span><span>
</span><span id="line-729"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#readTypeEnum"><span class="hs-identifier hs-var">readTypeEnum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int8"><span class="hs-identifier hs-var">Int8</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeDirect"><span class="hs-identifier hs-var">Imp.TypeDirect</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;i8&quot;</span></span><span>
</span><span id="line-730"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#readTypeEnum"><span class="hs-identifier hs-var">readTypeEnum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int16"><span class="hs-identifier hs-var">Int16</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeDirect"><span class="hs-identifier hs-var">Imp.TypeDirect</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;i16&quot;</span></span><span>
</span><span id="line-731"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#readTypeEnum"><span class="hs-identifier hs-var">readTypeEnum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int32"><span class="hs-identifier hs-var">Int32</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeDirect"><span class="hs-identifier hs-var">Imp.TypeDirect</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;i32&quot;</span></span><span>
</span><span id="line-732"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#readTypeEnum"><span class="hs-identifier hs-var">readTypeEnum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeDirect"><span class="hs-identifier hs-var">Imp.TypeDirect</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;i64&quot;</span></span><span>
</span><span id="line-733"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#readTypeEnum"><span class="hs-identifier hs-var">readTypeEnum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float16"><span class="hs-identifier hs-var">Float16</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;f16&quot;</span></span><span>
</span><span id="line-734"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#readTypeEnum"><span class="hs-identifier hs-var">readTypeEnum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float32"><span class="hs-identifier hs-var">Float32</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;f32&quot;</span></span><span>
</span><span id="line-735"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#readTypeEnum"><span class="hs-identifier hs-var">readTypeEnum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float64"><span class="hs-identifier hs-var">Float64</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;f64&quot;</span></span><span>
</span><span id="line-736"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#readTypeEnum"><span class="hs-identifier hs-var">readTypeEnum</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Primitive.html#Bool"><span class="hs-identifier hs-var">Imp.Bool</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;bool&quot;</span></span><span>
</span><span id="line-737"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#readTypeEnum"><span class="hs-identifier hs-var">readTypeEnum</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Primitive.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;bool&quot;</span></span><span>
</span><span id="line-738"></span><span>
</span><span id="line-739"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#readInput"><span class="hs-identifier hs-type">readInput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ExternalValue"><span class="hs-identifier hs-type">Imp.ExternalValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span>
</span><span id="line-740"></span><span id="readInput"><span class="annot"><span class="annottext">readInput :: ExternalValue -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#readInput"><span class="hs-identifier hs-var hs-var">readInput</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#OpaqueValue"><span class="hs-identifier hs-type">Imp.OpaqueValue</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568664"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568664"><span class="hs-identifier hs-var">desc</span></a></span></span><span> </span><span class="annot"><span class="annottext">[ValueDesc]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-741"></span><span>  </span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Raise"><span class="hs-identifier hs-var">Raise</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-742"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span>
</span><span id="line-743"></span><span>      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Exception&quot;</span></span><span>
</span><span id="line-744"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [Char] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Cannot read argument of type &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568664"><span class="hs-identifier hs-var">desc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-745"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#readInput"><span class="hs-identifier hs-var">readInput</span></a></span><span> </span><span id="local-6989586621684568663"><span class="annot"><span class="annottext">decl :: ExternalValue
</span><a href="#local-6989586621684568663"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#TransparentValue"><span class="hs-identifier hs-type">Imp.TransparentValue</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ScalarValue"><span class="hs-identifier hs-type">Imp.ScalarValue</span></a></span><span> </span><span id="local-6989586621684568662"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568662"><span class="hs-identifier hs-var">bt</span></a></span></span><span> </span><span id="local-6989586621684568661"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568661"><span class="hs-identifier hs-var">ept</span></a></span></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-746"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568660"><span class="annot"><span class="annottext">type_name :: [Char]
</span><a href="#local-6989586621684568660"><span class="hs-identifier hs-var hs-var">type_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; Signedness -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#readTypeEnum"><span class="hs-identifier hs-var">readTypeEnum</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568662"><span class="hs-identifier hs-var">bt</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568661"><span class="hs-identifier hs-var">ept</span></a></span><span>
</span><span id="line-747"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [Char] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExternalValue -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#extValueDescName"><span class="hs-identifier hs-var">extValueDescName</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalValue
</span><a href="#local-6989586621684568663"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;read_value&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568660"><span class="hs-identifier hs-var">type_name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-748"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#readInput"><span class="hs-identifier hs-var">readInput</span></a></span><span> </span><span id="local-6989586621684568659"><span class="annot"><span class="annottext">decl :: ExternalValue
</span><a href="#local-6989586621684568659"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#TransparentValue"><span class="hs-identifier hs-type">Imp.TransparentValue</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ArrayValue"><span class="hs-identifier hs-type">Imp.ArrayValue</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568658"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568658"><span class="hs-identifier hs-var">bt</span></a></span></span><span> </span><span id="local-6989586621684568657"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568657"><span class="hs-identifier hs-var">ept</span></a></span></span><span> </span><span id="local-6989586621684568656"><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568656"><span class="hs-identifier hs-var">dims</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-749"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568655"><span class="annot"><span class="annottext">type_name :: [Char]
</span><a href="#local-6989586621684568655"><span class="hs-identifier hs-var hs-var">type_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; Signedness -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#readTypeEnum"><span class="hs-identifier hs-var">readTypeEnum</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568658"><span class="hs-identifier hs-var">bt</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568657"><span class="hs-identifier hs-var">ept</span></a></span><span>
</span><span id="line-750"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [Char] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExternalValue -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#extValueDescName"><span class="hs-identifier hs-var">extValueDescName</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalValue
</span><a href="#local-6989586621684568659"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-751"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span>
</span><span id="line-752"></span><span>          </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;read_value&quot;</span></span><span>
</span><span id="line-753"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [Char] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Char] -&gt; [[Char]]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DimSize] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568656"><span class="hs-identifier hs-var">dims</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;[]&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568655"><span class="hs-identifier hs-var">type_name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-754"></span><span>
</span><span id="line-755"></span><span id="local-6989586621684569561"><span id="local-6989586621684569562"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#printValue"><span class="hs-identifier hs-type">printValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ExternalValue"><span class="hs-identifier hs-type">Imp.ExternalValue</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569562"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569561"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-756"></span><span id="printValue"><span class="annot"><span class="annottext">printValue :: forall op s. [(ExternalValue, PyExp)] -&gt; CompilerM op s [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#printValue"><span class="hs-identifier hs-var hs-var">printValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([[PyStmt]] -&gt; [PyStmt])
-&gt; CompilerM op s [[PyStmt]] -&gt; CompilerM op s [PyStmt]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[[PyStmt]] -&gt; [PyStmt]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">(CompilerM op s [[PyStmt]] -&gt; CompilerM op s [PyStmt])
-&gt; ([(ExternalValue, PyExp)] -&gt; CompilerM op s [[PyStmt]])
-&gt; [(ExternalValue, PyExp)]
-&gt; CompilerM op s [PyStmt]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((ExternalValue, PyExp) -&gt; CompilerM op s [PyStmt])
-&gt; [(ExternalValue, PyExp)] -&gt; CompilerM op s [[PyStmt]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ExternalValue -&gt; PyExp -&gt; CompilerM op s [PyStmt])
-&gt; (ExternalValue, PyExp) -&gt; CompilerM op s [PyStmt]
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">ExternalValue -&gt; PyExp -&gt; CompilerM op s [PyStmt]
forall {m :: * -&gt; *}.
Monad m =&gt;
ExternalValue -&gt; PyExp -&gt; m [PyStmt]
</span><a href="#local-6989586621684568647"><span class="hs-identifier hs-var">printValue'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-757"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-758"></span><span>    </span><span class="hs-comment">-- We copy non-host arrays to the host before printing.  This is</span><span>
</span><span id="line-759"></span><span>    </span><span class="hs-comment">-- done in a hacky way - we assume the value has a .get()-method</span><span>
</span><span id="line-760"></span><span>    </span><span class="hs-comment">-- that returns an equivalent Numpy array.  This works for PyOpenCL,</span><span>
</span><span id="line-761"></span><span>    </span><span class="hs-comment">-- but we will probably need yet another plugin mechanism here in</span><span>
</span><span id="line-762"></span><span>    </span><span class="hs-comment">-- the future.</span><span>
</span><span id="line-763"></span><span>    </span><span id="local-6989586621684568647"><span class="annot"><span class="annottext">printValue' :: ExternalValue -&gt; PyExp -&gt; m [PyStmt]
</span><a href="#local-6989586621684568647"><span class="hs-identifier hs-var hs-var">printValue'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#OpaqueValue"><span class="hs-identifier hs-type">Imp.OpaqueValue</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568637"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568637"><span class="hs-identifier hs-var">desc</span></a></span></span><span> </span><span class="annot"><span class="annottext">[ValueDesc]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-764"></span><span>      </span><span class="annot"><span class="annottext">[PyStmt] -&gt; m [PyStmt]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-765"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-766"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span>
</span><span id="line-767"></span><span>              </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;sys.stdout.write&quot;</span></span><span>
</span><span id="line-768"></span><span>              </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [Char] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;#&lt;opaque &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568637"><span class="hs-identifier hs-var">desc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&gt;&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-769"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-770"></span><span>    </span><span class="annot"><a href="#local-6989586621684568647"><span class="hs-identifier hs-var">printValue'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#TransparentValue"><span class="hs-identifier hs-type">Imp.TransparentValue</span></a></span><span> </span><span id="local-6989586621684568636"><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684568636"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ArrayValue"><span class="hs-identifier hs-type">Imp.ArrayValue</span></a></span><span> </span><span id="local-6989586621684568635"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568635"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Space"><span class="hs-identifier hs-type">Space</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684568634"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568634"><span class="hs-identifier hs-var">bt</span></a></span></span><span> </span><span id="local-6989586621684568633"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568633"><span class="hs-identifier hs-var">ept</span></a></span></span><span> </span><span id="local-6989586621684568632"><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568632"><span class="hs-identifier hs-var">shape</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621684568631"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568631"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-771"></span><span>      </span><span class="annot"><span class="annottext">ExternalValue -&gt; PyExp -&gt; m [PyStmt]
</span><a href="#local-6989586621684568647"><span class="hs-identifier hs-var">printValue'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uniqueness -&gt; ValueDesc -&gt; ExternalValue
</span><a href="Futhark.CodeGen.ImpCode.html#TransparentValue"><span class="hs-identifier hs-var">Imp.TransparentValue</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684568636"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Space -&gt; PrimType -&gt; Signedness -&gt; [DimSize] -&gt; ValueDesc
</span><a href="Futhark.CodeGen.ImpCode.html#ArrayValue"><span class="hs-identifier hs-var">Imp.ArrayValue</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568635"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="Futhark.IR.Syntax.Core.html#DefaultSpace"><span class="hs-identifier hs-var">DefaultSpace</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568634"><span class="hs-identifier hs-var">bt</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568633"><span class="hs-identifier hs-var">ept</span></a></span><span> </span><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568632"><span class="hs-identifier hs-var">shape</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; m [PyStmt]) -&gt; PyExp -&gt; m [PyStmt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-772"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568631"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;.get&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-773"></span><span>    </span><span class="annot"><a href="#local-6989586621684568647"><span class="hs-identifier hs-var">printValue'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#TransparentValue"><span class="hs-identifier hs-type">Imp.TransparentValue</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ValueDesc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684568629"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568629"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-774"></span><span>      </span><span class="annot"><span class="annottext">[PyStmt] -&gt; m [PyStmt]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-775"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-776"></span><span>            </span><span class="annot"><span class="annottext">PyExp -&gt; [PyArg] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Call"><span class="hs-identifier hs-var">Call</span></a></span><span>
</span><span id="line-777"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;write_value&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-778"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568629"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-779"></span><span>                </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#ArgKeyword"><span class="hs-identifier hs-var">ArgKeyword</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;binary&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;binary_output&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-780"></span><span>              </span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-781"></span><span>          </span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;sys.stdout.write&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-782"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-783"></span><span>
</span><span id="line-784"></span><span id="local-6989586621684569553"><span id="local-6989586621684569554"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#prepareEntry"><span class="hs-identifier hs-type">prepareEntry</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-785"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Function"><span class="hs-identifier hs-type">Imp.Function</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569554"><span class="hs-identifier hs-type">op</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-786"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span>
</span><span id="line-787"></span><span>    </span><span class="annot"><a href="#local-6989586621684569554"><span class="hs-identifier hs-type">op</span></a></span><span>
</span><span id="line-788"></span><span>    </span><span class="annot"><a href="#local-6989586621684569553"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-789"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-790"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-791"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-792"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-793"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-794"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ExternalValue"><span class="hs-identifier hs-type">Imp.ExternalValue</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-795"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-796"></span><span>    </span><span class="hs-special">)</span></span></span><span>
</span><span id="line-797"></span><span id="prepareEntry"><span class="annot"><span class="annottext">prepareEntry :: forall op s.
(Name, Function op)
-&gt; CompilerM
     op
     s
     ([[Char]], [PyStmt], [PyStmt], [PyStmt], [PyStmt],
      [(ExternalValue, PyExp)], [PyStmt])
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#prepareEntry"><span class="hs-identifier hs-var hs-var">prepareEntry</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684568597"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684568597"><span class="hs-identifier hs-var">fname</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Function"><span class="hs-identifier hs-type">Imp.Function</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568596"><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621684568596"><span class="hs-identifier hs-var">outputs</span></a></span></span><span> </span><span id="local-6989586621684568595"><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621684568595"><span class="hs-identifier hs-var">inputs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Code op
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568594"><span class="annot"><span class="annottext">[ExternalValue]
</span><a href="#local-6989586621684568594"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span id="local-6989586621684568593"><span class="annot"><span class="annottext">[(Name, ExternalValue)]
</span><a href="#local-6989586621684568593"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-798"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568592"><span class="annot"><span class="annottext">output_paramNames :: [[Char]]
</span><a href="#local-6989586621684568592"><span class="hs-identifier hs-var hs-var">output_paramNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Param -&gt; [Char]) -&gt; [Param] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileName"><span class="hs-identifier hs-var">compileName</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; [Char]) -&gt; (Param -&gt; VName) -&gt; Param -&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Param -&gt; VName
</span><a href="Futhark.CodeGen.ImpCode.html#paramName"><span class="hs-identifier hs-var">Imp.paramName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621684568596"><span class="hs-identifier hs-var">outputs</span></a></span><span>
</span><span id="line-799"></span><span>      </span><span id="local-6989586621684568589"><span class="annot"><span class="annottext">funTuple :: PyExp
</span><a href="#local-6989586621684568589"><span class="hs-identifier hs-var hs-var">funTuple</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#tupleOrSingle"><span class="hs-identifier hs-var">tupleOrSingle</span></a></span><span> </span><span class="annot"><span class="annottext">([PyExp] -&gt; PyExp) -&gt; [PyExp] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [[Char]] -&gt; [PyExp]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568592"><span class="hs-identifier hs-var">output_paramNames</span></a></span><span>
</span><span id="line-800"></span><span>
</span><span id="line-801"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684568588"><span class="annot"><span class="annottext">[Maybe [Char]]
</span><a href="#local-6989586621684568588"><span class="hs-identifier hs-var">argexps_mem_copies</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568587"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568587"><span class="hs-identifier hs-var">prepare_run</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompilerM op s [Maybe [Char]]
-&gt; CompilerM op s ([Maybe [Char]], [PyStmt])
forall op s a. CompilerM op s a -&gt; CompilerM op s (a, [PyStmt])
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#collect%27"><span class="hs-identifier hs-var">collect'</span></a></span><span> </span><span class="annot"><span class="annottext">(CompilerM op s [Maybe [Char]]
 -&gt; CompilerM op s ([Maybe [Char]], [PyStmt]))
-&gt; CompilerM op s [Maybe [Char]]
-&gt; CompilerM op s ([Maybe [Char]], [PyStmt])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-802"></span><span>    </span><span class="annot"><span class="annottext">[Param]
-&gt; (Param -&gt; CompilerM op s (Maybe [Char]))
-&gt; CompilerM op s [Maybe [Char]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621684568595"><span class="hs-identifier hs-var">inputs</span></a></span><span> </span><span class="annot"><span class="annottext">((Param -&gt; CompilerM op s (Maybe [Char]))
 -&gt; CompilerM op s [Maybe [Char]])
-&gt; (Param -&gt; CompilerM op s (Maybe [Char]))
-&gt; CompilerM op s [Maybe [Char]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-803"></span><span>      </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#MemParam"><span class="hs-identifier hs-type">Imp.MemParam</span></a></span><span> </span><span id="local-6989586621684568584"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568584"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621684568583"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684568583"><span class="hs-identifier hs-var">space</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-804"></span><span>        </span><span class="hs-comment">-- A program might write to its input parameters, so create a new memory</span><span>
</span><span id="line-805"></span><span>        </span><span class="hs-comment">-- block and copy the source there.  This way the program can be run more</span><span>
</span><span id="line-806"></span><span>        </span><span class="hs-comment">-- than once.</span><span>
</span><span id="line-807"></span><span>        </span><span id="local-6989586621684568582"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568582"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; CompilerM op s VName
forall (m :: * -&gt; *). MonadFreshNames m =&gt; [Char] -&gt; m VName
</span><a href="Futhark.MonadFreshNames.html#newVName"><span class="hs-identifier hs-var">newVName</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; CompilerM op s VName) -&gt; [Char] -&gt; CompilerM op s VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; [Char]
</span><a href="Language.Futhark.Core.html#baseString"><span class="hs-identifier hs-var">baseString</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568584"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;_copy&quot;</span></span><span>
</span><span id="line-808"></span><span>        </span><span id="local-6989586621684568579"><span class="annot"><span class="annottext">Copy op s
</span><a href="#local-6989586621684568579"><span class="hs-identifier hs-var">copy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CompilerEnv op s -&gt; Copy op s) -&gt; CompilerM op s (Copy op s)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">CompilerEnv op s -&gt; Copy op s
forall op s. CompilerEnv op s -&gt; Copy op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envCopy"><span class="hs-identifier hs-var">envCopy</span></a></span><span>
</span><span id="line-809"></span><span>        </span><span id="local-6989586621684568578"><span class="annot"><span class="annottext">Allocate op s
</span><a href="#local-6989586621684568578"><span class="hs-identifier hs-var">allocate</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CompilerEnv op s -&gt; Allocate op s)
-&gt; CompilerM op s (Allocate op s)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">CompilerEnv op s -&gt; Allocate op s
forall op s. CompilerEnv op s -&gt; Allocate op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envAllocate"><span class="hs-identifier hs-var">envAllocate</span></a></span><span>
</span><span id="line-810"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568575"><span class="annot"><span class="annottext">size :: PyExp
</span><a href="#local-6989586621684568575"><span class="hs-identifier hs-var hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#extName"><span class="hs-identifier hs-var">extName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileName"><span class="hs-identifier hs-var">compileName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568584"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;.nbytes&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- FIXME</span><span>
</span><span id="line-811"></span><span>            </span><span id="local-6989586621684568574"><span class="annot"><span class="annottext">dest :: VName
</span><a href="#local-6989586621684568574"><span class="hs-identifier hs-var hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568582"><span class="hs-identifier hs-var">name'</span></a></span><span>
</span><span id="line-812"></span><span>            </span><span id="local-6989586621684568573"><span class="annot"><span class="annottext">src :: VName
</span><a href="#local-6989586621684568573"><span class="hs-identifier hs-var hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568584"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-813"></span><span>            </span><span id="local-6989586621684568572"><span class="annot"><span class="annottext">offset :: PyExp
</span><a href="#local-6989586621684568572"><span class="hs-identifier hs-var hs-var">offset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-814"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684568583"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-815"></span><span>          </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Space"><span class="hs-identifier hs-type">Space</span></a></span><span> </span><span id="local-6989586621684568571"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568571"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-816"></span><span>            </span><span class="annot"><span class="annottext">Allocate op s
</span><a href="#local-6989586621684568578"><span class="hs-identifier hs-var">allocate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileName"><span class="hs-identifier hs-var">compileName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568582"><span class="hs-identifier hs-var">name'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568575"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568571"><span class="hs-identifier hs-var">sid</span></a></span><span>
</span><span id="line-817"></span><span>          </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-818"></span><span>            </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-819"></span><span>              </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span>
</span><span id="line-820"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileName"><span class="hs-identifier hs-var">compileName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568582"><span class="hs-identifier hs-var">name'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-821"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;allocateMem&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568575"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- FIXME</span><span>
</span><span id="line-822"></span><span>        </span><span id="local-6989586621684568570"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568570"><span class="hs-identifier hs-var">dest'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568574"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-823"></span><span>        </span><span id="local-6989586621684568569"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568569"><span class="hs-identifier hs-var">src'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568573"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-824"></span><span>        </span><span class="annot"><span class="annottext">Copy op s
</span><a href="#local-6989586621684568579"><span class="hs-identifier hs-var">copy</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568570"><span class="hs-identifier hs-var">dest'</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568572"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684568583"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568569"><span class="hs-identifier hs-var">src'</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568572"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684568583"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568575"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-var">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int32"><span class="hs-identifier hs-var">Int32</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- FIXME</span><span>
</span><span id="line-825"></span><span>        </span><span class="annot"><span class="annottext">Maybe [Char] -&gt; CompilerM op s (Maybe [Char])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe [Char] -&gt; CompilerM op s (Maybe [Char]))
-&gt; Maybe [Char] -&gt; CompilerM op s (Maybe [Char])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Maybe [Char]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Maybe [Char]) -&gt; [Char] -&gt; Maybe [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileName"><span class="hs-identifier hs-var">compileName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568582"><span class="hs-identifier hs-var">name'</span></a></span><span>
</span><span id="line-826"></span><span>      </span><span class="annot"><span class="annottext">Param
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe [Char] -&gt; CompilerM op s (Maybe [Char])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-827"></span><span>
</span><span id="line-828"></span><span>  </span><span id="local-6989586621684568568"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568568"><span class="hs-identifier hs-var">prepareIn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompilerM op s () -&gt; CompilerM op s [PyStmt]
forall op s. CompilerM op s () -&gt; CompilerM op s [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#collect"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="annot"><span class="annottext">(CompilerM op s () -&gt; CompilerM op s [PyStmt])
-&gt; CompilerM op s () -&gt; CompilerM op s [PyStmt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-829"></span><span>    </span><span class="annot"><span class="annottext">[ExternalValue] -&gt; CompilerM op s ()
forall op s. [ExternalValue] -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#declEntryPointInputSizes"><span class="hs-identifier hs-var">declEntryPointInputSizes</span></a></span><span> </span><span class="annot"><span class="annottext">([ExternalValue] -&gt; CompilerM op s ())
-&gt; [ExternalValue] -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Name, ExternalValue) -&gt; ExternalValue)
-&gt; [(Name, ExternalValue)] -&gt; [ExternalValue]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Name, ExternalValue) -&gt; ExternalValue
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Name, ExternalValue)]
</span><a href="#local-6989586621684568593"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-830"></span><span>    </span><span class="annot"><span class="annottext">((Int, ExternalValue, PyExp) -&gt; CompilerM op s ())
-&gt; [(Int, ExternalValue, PyExp)] -&gt; CompilerM op s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">(Int, ExternalValue, PyExp) -&gt; CompilerM op s ()
forall op s. (Int, ExternalValue, PyExp) -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#entryPointInput"><span class="hs-identifier hs-var">entryPointInput</span></a></span><span> </span><span class="annot"><span class="annottext">([(Int, ExternalValue, PyExp)] -&gt; CompilerM op s ())
-&gt; ([PyExp] -&gt; [(Int, ExternalValue, PyExp)])
-&gt; [PyExp]
-&gt; CompilerM op s ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Int]
-&gt; [ExternalValue] -&gt; [PyExp] -&gt; [(Int, ExternalValue, PyExp)]
forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><span class="hs-identifier hs-var">zip3</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Name, ExternalValue) -&gt; ExternalValue)
-&gt; [(Name, ExternalValue)] -&gt; [ExternalValue]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Name, ExternalValue) -&gt; ExternalValue
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Name, ExternalValue)]
</span><a href="#local-6989586621684568593"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([PyExp] -&gt; CompilerM op s ()) -&gt; [PyExp] -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-831"></span><span>      </span><span class="annot"><span class="annottext">((Name, ExternalValue) -&gt; PyExp)
-&gt; [(Name, ExternalValue)] -&gt; [PyExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyExp)
-&gt; ((Name, ExternalValue) -&gt; [Char])
-&gt; (Name, ExternalValue)
-&gt; PyExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ExternalValue -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#extValueDescName"><span class="hs-identifier hs-var">extValueDescName</span></a></span><span> </span><span class="annot"><span class="annottext">(ExternalValue -&gt; [Char])
-&gt; ((Name, ExternalValue) -&gt; ExternalValue)
-&gt; (Name, ExternalValue)
-&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name, ExternalValue) -&gt; ExternalValue
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, ExternalValue)]
</span><a href="#local-6989586621684568593"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-832"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684568567"><span class="annot"><span class="annottext">[PyExp]
</span><a href="#local-6989586621684568567"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568566"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568566"><span class="hs-identifier hs-var">prepareOut</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompilerM op s [PyExp] -&gt; CompilerM op s ([PyExp], [PyStmt])
forall op s a. CompilerM op s a -&gt; CompilerM op s (a, [PyStmt])
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#collect%27"><span class="hs-identifier hs-var">collect'</span></a></span><span> </span><span class="annot"><span class="annottext">(CompilerM op s [PyExp] -&gt; CompilerM op s ([PyExp], [PyStmt]))
-&gt; CompilerM op s [PyExp] -&gt; CompilerM op s ([PyExp], [PyStmt])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ExternalValue -&gt; CompilerM op s PyExp)
-&gt; [ExternalValue] -&gt; CompilerM op s [PyExp]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">ExternalValue -&gt; CompilerM op s PyExp
forall op s. ExternalValue -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#entryPointOutput"><span class="hs-identifier hs-var">entryPointOutput</span></a></span><span> </span><span class="annot"><span class="annottext">[ExternalValue]
</span><a href="#local-6989586621684568594"><span class="hs-identifier hs-var">results</span></a></span><span>
</span><span id="line-833"></span><span>
</span><span id="line-834"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568565"><span class="annot"><span class="annottext">argexps_lib :: [[Char]]
</span><a href="#local-6989586621684568565"><span class="hs-identifier hs-var hs-var">argexps_lib</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Param -&gt; [Char]) -&gt; [Param] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileName"><span class="hs-identifier hs-var">compileName</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; [Char]) -&gt; (Param -&gt; VName) -&gt; Param -&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Param -&gt; VName
</span><a href="Futhark.CodeGen.ImpCode.html#paramName"><span class="hs-identifier hs-var">Imp.paramName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Param]
</span><a href="#local-6989586621684568595"><span class="hs-identifier hs-var">inputs</span></a></span><span>
</span><span id="line-835"></span><span>      </span><span id="local-6989586621684568564"><span class="annot"><span class="annottext">argexps_bin :: [[Char]]
</span><a href="#local-6989586621684568564"><span class="hs-identifier hs-var hs-var">argexps_bin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Maybe [Char] -&gt; [Char])
-&gt; [[Char]] -&gt; [Maybe [Char]] -&gt; [[Char]]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Maybe [Char] -&gt; [Char]
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568565"><span class="hs-identifier hs-var">argexps_lib</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe [Char]]
</span><a href="#local-6989586621684568588"><span class="hs-identifier hs-var">argexps_mem_copies</span></a></span><span>
</span><span id="line-836"></span><span>      </span><span id="local-6989586621684568559"><span class="annot"><span class="annottext">fname' :: [Char]
</span><a href="#local-6989586621684568559"><span class="hs-identifier hs-var hs-var">fname'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;self.&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#futharkFun"><span class="hs-identifier hs-var">futharkFun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Char]
</span><a href="Language.Futhark.Core.html#nameToString"><span class="hs-identifier hs-var">nameToString</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684568597"><span class="hs-identifier hs-var">fname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-837"></span><span>
</span><span id="line-838"></span><span>      </span><span class="hs-comment">-- We ignore overflow errors and the like for executable entry</span><span>
</span><span id="line-839"></span><span>      </span><span class="hs-comment">-- points.  These are (somewhat) well-defined in Futhark.</span><span>
</span><span id="line-840"></span><span>      </span><span id="local-6989586621684568558"><span class="annot"><span class="annottext">ignore :: [Char] -&gt; PyArg
</span><a href="#local-6989586621684568558"><span class="hs-identifier hs-var hs-var">ignore</span></a></span></span><span> </span><span id="local-6989586621684568557"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568557"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#ArgKeyword"><span class="hs-identifier hs-var">ArgKeyword</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568557"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyArg) -&gt; PyExp -&gt; PyArg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ignore&quot;</span></span><span>
</span><span id="line-841"></span><span>      </span><span id="local-6989586621684568551"><span class="annot"><span class="annottext">errstate :: PyExp
</span><a href="#local-6989586621684568551"><span class="hs-identifier hs-var hs-var">errstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; [PyArg] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Call"><span class="hs-identifier hs-var">Call</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.errstate&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([PyArg] -&gt; PyExp) -&gt; [PyArg] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyArg) -&gt; [[Char]] -&gt; [PyArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyArg
</span><a href="#local-6989586621684568558"><span class="hs-identifier hs-var">ignore</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;divide&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;over&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;under&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;invalid&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span>      </span><span id="local-6989586621684568549"><span class="annot"><span class="annottext">call :: [[Char]] -&gt; [PyStmt]
</span><a href="#local-6989586621684568549"><span class="hs-identifier hs-var hs-var">call</span></a></span></span><span> </span><span id="local-6989586621684568548"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568548"><span class="hs-identifier hs-var">argexps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-844"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; [PyStmt] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#With"><span class="hs-identifier hs-var">With</span></a></span><span>
</span><span id="line-845"></span><span>            </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568551"><span class="hs-identifier hs-var">errstate</span></a></span><span>
</span><span id="line-846"></span><span>            </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568589"><span class="hs-identifier hs-var">funTuple</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568559"><span class="hs-identifier hs-var">fname'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [[Char]] -&gt; [PyExp]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568548"><span class="hs-identifier hs-var">argexps</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-847"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-848"></span><span>
</span><span id="line-849"></span><span>  </span><span class="annot"><span class="annottext">([[Char]], [PyStmt], [PyStmt], [PyStmt], [PyStmt],
 [(ExternalValue, PyExp)], [PyStmt])
-&gt; CompilerM
     op
     s
     ([[Char]], [PyStmt], [PyStmt], [PyStmt], [PyStmt],
      [(ExternalValue, PyExp)], [PyStmt])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-850"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">((Name, ExternalValue) -&gt; [Char])
-&gt; [(Name, ExternalValue)] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExternalValue -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#extValueDescName"><span class="hs-identifier hs-var">extValueDescName</span></a></span><span> </span><span class="annot"><span class="annottext">(ExternalValue -&gt; [Char])
-&gt; ((Name, ExternalValue) -&gt; ExternalValue)
-&gt; (Name, ExternalValue)
-&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name, ExternalValue) -&gt; ExternalValue
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, ExternalValue)]
</span><a href="#local-6989586621684568593"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-851"></span><span>      </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568568"><span class="hs-identifier hs-var">prepareIn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-852"></span><span>      </span><span class="annot"><span class="annottext">[[Char]] -&gt; [PyStmt]
</span><a href="#local-6989586621684568549"><span class="hs-identifier hs-var">call</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568565"><span class="hs-identifier hs-var">argexps_lib</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-853"></span><span>      </span><span class="annot"><span class="annottext">[[Char]] -&gt; [PyStmt]
</span><a href="#local-6989586621684568549"><span class="hs-identifier hs-var">call</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568564"><span class="hs-identifier hs-var">argexps_bin</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-854"></span><span>      </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568566"><span class="hs-identifier hs-var">prepareOut</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-855"></span><span>      </span><span class="annot"><span class="annottext">[ExternalValue] -&gt; [PyExp] -&gt; [(ExternalValue, PyExp)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[ExternalValue]
</span><a href="#local-6989586621684568594"><span class="hs-identifier hs-var">results</span></a></span><span> </span><span class="annot"><span class="annottext">[PyExp]
</span><a href="#local-6989586621684568567"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-856"></span><span>      </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568587"><span class="hs-identifier hs-var">prepare_run</span></a></span><span>
</span><span id="line-857"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-858"></span><span>
</span><span id="line-859"></span><span id="local-6989586621684569540"><span id="local-6989586621684569541"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#copyMemoryDefaultSpace"><span class="hs-identifier hs-type">copyMemoryDefaultSpace</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-860"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-861"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-862"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-863"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-864"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-865"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569541"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569540"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-866"></span><span id="copyMemoryDefaultSpace"><span class="annot"><span class="annottext">copyMemoryDefaultSpace :: forall op s.
PyExp -&gt; PyExp -&gt; PyExp -&gt; PyExp -&gt; PyExp -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#copyMemoryDefaultSpace"><span class="hs-identifier hs-var hs-var">copyMemoryDefaultSpace</span></a></span></span><span> </span><span id="local-6989586621684568546"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568546"><span class="hs-identifier hs-var">destmem</span></a></span></span><span> </span><span id="local-6989586621684568545"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568545"><span class="hs-identifier hs-var">destidx</span></a></span></span><span> </span><span id="local-6989586621684568544"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568544"><span class="hs-identifier hs-var">srcmem</span></a></span></span><span> </span><span id="local-6989586621684568543"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568543"><span class="hs-identifier hs-var">srcidx</span></a></span></span><span> </span><span id="local-6989586621684568542"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568542"><span class="hs-identifier hs-var">nbytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-867"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568541"><span class="annot"><span class="annottext">offset_call1 :: PyExp
</span><a href="#local-6989586621684568541"><span class="hs-identifier hs-var hs-var">offset_call1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-868"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span>
</span><span id="line-869"></span><span>          </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;addressOffset&quot;</span></span><span>
</span><span id="line-870"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568546"><span class="hs-identifier hs-var">destmem</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568545"><span class="hs-identifier hs-var">destidx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_byte&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-871"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568540"><span class="annot"><span class="annottext">offset_call2 :: PyExp
</span><a href="#local-6989586621684568540"><span class="hs-identifier hs-var hs-var">offset_call2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-872"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span>
</span><span id="line-873"></span><span>          </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;addressOffset&quot;</span></span><span>
</span><span id="line-874"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568544"><span class="hs-identifier hs-var">srcmem</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568543"><span class="hs-identifier hs-var">srcidx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_byte&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-875"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.memmove&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568541"><span class="hs-identifier hs-var">offset_call1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568540"><span class="hs-identifier hs-var">offset_call2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568542"><span class="hs-identifier hs-var">nbytes</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-876"></span><span>
</span><span id="line-877"></span><span class="hs-keyword">data</span><span> </span><span id="ReturnTiming"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#ReturnTiming"><span class="hs-identifier hs-var">ReturnTiming</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ReturnTiming"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#ReturnTiming"><span class="hs-identifier hs-var">ReturnTiming</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="DoNotReturnTiming"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#DoNotReturnTiming"><span class="hs-identifier hs-var">DoNotReturnTiming</span></a></span></span><span>
</span><span id="line-878"></span><span>
</span><span id="line-879"></span><span id="local-6989586621684569639"><span id="local-6989586621684569640"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileEntryFun"><span class="hs-identifier hs-type">compileEntryFun</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-880"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-881"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#ReturnTiming"><span class="hs-identifier hs-type">ReturnTiming</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-882"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Function"><span class="hs-identifier hs-type">Imp.Function</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569640"><span class="hs-identifier hs-type">op</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-883"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569640"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569639"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyFunDef"><span class="hs-identifier hs-type">PyFunDef</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-884"></span><span id="compileEntryFun"><span class="annot"><span class="annottext">compileEntryFun :: forall op s.
[PyStmt]
-&gt; ReturnTiming
-&gt; (Name, Function op)
-&gt; CompilerM op s (Maybe (PyFunDef, (PyExp, PyExp)))
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileEntryFun"><span class="hs-identifier hs-var hs-var">compileEntryFun</span></a></span></span><span> </span><span id="local-6989586621684568535"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568535"><span class="hs-identifier hs-var">sync</span></a></span></span><span> </span><span id="local-6989586621684568534"><span class="annot"><span class="annottext">ReturnTiming
</span><a href="#local-6989586621684568534"><span class="hs-identifier hs-var">timing</span></a></span></span><span> </span><span id="local-6989586621684568533"><span class="annot"><span class="annottext">(Name, Function op)
</span><a href="#local-6989586621684568533"><span class="hs-identifier hs-var">entry</span></a></span></span><span>
</span><span id="line-885"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684568532"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684568532"><span class="hs-identifier hs-var">ename</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Function op -&gt; Maybe Name
forall a. FunctionT a -&gt; Maybe Name
</span><a href="Futhark.CodeGen.ImpCode.html#functionEntry"><span class="hs-identifier hs-var hs-var">Imp.functionEntry</span></a></span><span> </span><span class="annot"><span class="annottext">(Function op -&gt; Maybe Name) -&gt; Function op -&gt; Maybe Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Name, Function op) -&gt; Function op
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(Name, Function op)
</span><a href="#local-6989586621684568533"><span class="hs-identifier hs-var">entry</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-886"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684568531"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568531"><span class="hs-identifier hs-var">params</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568530"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568530"><span class="hs-identifier hs-var">prepareIn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568529"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568529"><span class="hs-identifier hs-var">body_lib</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568528"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568528"><span class="hs-identifier hs-var">prepareOut</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568527"><span class="annot"><span class="annottext">[(ExternalValue, PyExp)]
</span><a href="#local-6989586621684568527"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Name, Function op)
-&gt; CompilerM
     op
     s
     ([[Char]], [PyStmt], [PyStmt], [PyStmt], [PyStmt],
      [(ExternalValue, PyExp)], [PyStmt])
forall op s.
(Name, Function op)
-&gt; CompilerM
     op
     s
     ([[Char]], [PyStmt], [PyStmt], [PyStmt], [PyStmt],
      [(ExternalValue, PyExp)], [PyStmt])
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#prepareEntry"><span class="hs-identifier hs-var">prepareEntry</span></a></span><span> </span><span class="annot"><span class="annottext">(Name, Function op)
</span><a href="#local-6989586621684568533"><span class="hs-identifier hs-var">entry</span></a></span><span>
</span><span id="line-887"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684568526"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568526"><span class="hs-identifier hs-var">maybe_sync</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568525"><span class="annot"><span class="annottext">PyStmt
</span><a href="#local-6989586621684568525"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-888"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ReturnTiming
</span><a href="#local-6989586621684568534"><span class="hs-identifier hs-var">timing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-889"></span><span>            </span><span class="annot"><span class="annottext">ReturnTiming
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#DoNotReturnTiming"><span class="hs-identifier hs-var">DoNotReturnTiming</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-890"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-891"></span><span>                </span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#tupleOrSingle"><span class="hs-identifier hs-var">tupleOrSingle</span></a></span><span> </span><span class="annot"><span class="annottext">([PyExp] -&gt; PyExp) -&gt; [PyExp] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((ExternalValue, PyExp) -&gt; PyExp)
-&gt; [(ExternalValue, PyExp)] -&gt; [PyExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(ExternalValue, PyExp) -&gt; PyExp
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(ExternalValue, PyExp)]
</span><a href="#local-6989586621684568527"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-892"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-893"></span><span>            </span><span class="annot"><span class="annottext">ReturnTiming
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#ReturnTiming"><span class="hs-identifier hs-var">ReturnTiming</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-894"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568535"><span class="hs-identifier hs-var">sync</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-895"></span><span>                </span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-896"></span><span>                  </span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Tuple"><span class="hs-identifier hs-var">Tuple</span></a></span><span>
</span><span id="line-897"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;runtime&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-898"></span><span>                      </span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#tupleOrSingle"><span class="hs-identifier hs-var">tupleOrSingle</span></a></span><span> </span><span class="annot"><span class="annottext">([PyExp] -&gt; PyExp) -&gt; [PyExp] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((ExternalValue, PyExp) -&gt; PyExp)
-&gt; [(ExternalValue, PyExp)] -&gt; [PyExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(ExternalValue, PyExp) -&gt; PyExp
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(ExternalValue, PyExp)]
</span><a href="#local-6989586621684568527"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-899"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-900"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-901"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621684568524"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568524"><span class="hs-identifier hs-var">pts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568523"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568523"><span class="hs-identifier hs-var">rts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Function op -&gt; ([[Char]], [[Char]])
forall op. Function op -&gt; ([[Char]], [[Char]])
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#entryTypes"><span class="hs-identifier hs-var">entryTypes</span></a></span><span> </span><span class="annot"><span class="annottext">(Function op -&gt; ([[Char]], [[Char]]))
-&gt; Function op -&gt; ([[Char]], [[Char]])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Name, Function op) -&gt; Function op
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(Name, Function op)
</span><a href="#local-6989586621684568533"><span class="hs-identifier hs-var">entry</span></a></span><span>
</span><span id="line-902"></span><span>
</span><span id="line-903"></span><span>        </span><span id="local-6989586621684568521"><span class="annot"><span class="annottext">do_run :: [PyStmt]
</span><a href="#local-6989586621684568521"><span class="hs-identifier hs-var hs-var">do_run</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-904"></span><span>          </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;time_start&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;time.time&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PyStmt -&gt; [PyStmt] -&gt; [PyStmt]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-905"></span><span>          </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568529"><span class="hs-identifier hs-var">body_lib</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568526"><span class="hs-identifier hs-var">maybe_sync</span></a></span><span>
</span><span id="line-906"></span><span>            </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;runtime&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-907"></span><span>                   </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span>
</span><span id="line-908"></span><span>                     </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;-&quot;</span></span><span>
</span><span id="line-909"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#toMicroseconds"><span class="hs-identifier hs-var">toMicroseconds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;time.time&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-910"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#toMicroseconds"><span class="hs-identifier hs-var">toMicroseconds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;time_start&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-911"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-912"></span><span>
</span><span id="line-913"></span><span>    </span><span class="annot"><span class="annottext">Maybe (PyFunDef, (PyExp, PyExp))
-&gt; CompilerM op s (Maybe (PyFunDef, (PyExp, PyExp)))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (PyFunDef, (PyExp, PyExp))
 -&gt; CompilerM op s (Maybe (PyFunDef, (PyExp, PyExp))))
-&gt; Maybe (PyFunDef, (PyExp, PyExp))
-&gt; CompilerM op s (Maybe (PyFunDef, (PyExp, PyExp)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-914"></span><span>      </span><span class="annot"><span class="annottext">(PyFunDef, (PyExp, PyExp)) -&gt; Maybe (PyFunDef, (PyExp, PyExp))
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-915"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [[Char]] -&gt; [PyStmt] -&gt; PyFunDef
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Char]
</span><a href="Language.Futhark.Core.html#nameToString"><span class="hs-identifier hs-var">nameToString</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684568532"><span class="hs-identifier hs-var">ename</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;self&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [[Char]] -&gt; [[Char]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568531"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([PyStmt] -&gt; PyFunDef) -&gt; [PyStmt] -&gt; PyFunDef
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-916"></span><span>            </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568530"><span class="hs-identifier hs-var">prepareIn</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568521"><span class="hs-identifier hs-var">do_run</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568528"><span class="hs-identifier hs-var">prepareOut</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568535"><span class="hs-identifier hs-var">sync</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyStmt
</span><a href="#local-6989586621684568525"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-917"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Char]
</span><a href="Language.Futhark.Core.html#nameToString"><span class="hs-identifier hs-var">nameToString</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684568532"><span class="hs-identifier hs-var">ename</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Tuple"><span class="hs-identifier hs-var">Tuple</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#List"><span class="hs-identifier hs-var">List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [[Char]] -&gt; [PyExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568524"><span class="hs-identifier hs-var">pts</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#List"><span class="hs-identifier hs-var">List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [[Char]] -&gt; [PyExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568523"><span class="hs-identifier hs-var">rts</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-918"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-919"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (PyFunDef, (PyExp, PyExp))
-&gt; CompilerM op s (Maybe (PyFunDef, (PyExp, PyExp)))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (PyFunDef, (PyExp, PyExp))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-920"></span><span>
</span><span id="line-921"></span><span id="local-6989586621684569535"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#entryTypes"><span class="hs-identifier hs-type">entryTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Function"><span class="hs-identifier hs-type">Imp.Function</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569535"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-922"></span><span id="entryTypes"><span class="annot"><span class="annottext">entryTypes :: forall op. Function op -&gt; ([[Char]], [[Char]])
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#entryTypes"><span class="hs-identifier hs-var hs-var">entryTypes</span></a></span></span><span> </span><span id="local-6989586621684568519"><span class="annot"><span class="annottext">Function op
</span><a href="#local-6989586621684568519"><span class="hs-identifier hs-var">func</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-923"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">((Name, ExternalValue) -&gt; [Char])
-&gt; [(Name, ExternalValue)] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExternalValue -&gt; [Char]
</span><a href="#local-6989586621684568518"><span class="hs-identifier hs-var">desc</span></a></span><span> </span><span class="annot"><span class="annottext">(ExternalValue -&gt; [Char])
-&gt; ((Name, ExternalValue) -&gt; ExternalValue)
-&gt; (Name, ExternalValue)
-&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name, ExternalValue) -&gt; ExternalValue
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Name, ExternalValue)] -&gt; [[Char]])
-&gt; [(Name, ExternalValue)] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Function op -&gt; [(Name, ExternalValue)]
forall a. FunctionT a -&gt; [(Name, ExternalValue)]
</span><a href="Futhark.CodeGen.ImpCode.html#functionArgs"><span class="hs-identifier hs-var hs-var">Imp.functionArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Function op
</span><a href="#local-6989586621684568519"><span class="hs-identifier hs-var">func</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-924"></span><span>    </span><span class="annot"><span class="annottext">(ExternalValue -&gt; [Char]) -&gt; [ExternalValue] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ExternalValue -&gt; [Char]
</span><a href="#local-6989586621684568518"><span class="hs-identifier hs-var">desc</span></a></span><span> </span><span class="annot"><span class="annottext">([ExternalValue] -&gt; [[Char]]) -&gt; [ExternalValue] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Function op -&gt; [ExternalValue]
forall a. Function a -&gt; [ExternalValue]
</span><a href="Futhark.CodeGen.ImpCode.html#functionResult"><span class="hs-identifier hs-var hs-var">Imp.functionResult</span></a></span><span> </span><span class="annot"><span class="annottext">Function op
</span><a href="#local-6989586621684568519"><span class="hs-identifier hs-var">func</span></a></span><span>
</span><span id="line-925"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-926"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-927"></span><span>    </span><span id="local-6989586621684568518"><span class="annot"><span class="annottext">desc :: ExternalValue -&gt; [Char]
</span><a href="#local-6989586621684568518"><span class="hs-identifier hs-var hs-var">desc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#OpaqueValue"><span class="hs-identifier hs-type">Imp.OpaqueValue</span></a></span><span> </span><span id="local-6989586621684568505"><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684568505"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621684568504"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568504"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="annot"><span class="annottext">[ValueDesc]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniqueness -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684568505"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568504"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-928"></span><span>    </span><span class="annot"><a href="#local-6989586621684568518"><span class="hs-identifier hs-var">desc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#TransparentValue"><span class="hs-identifier hs-type">Imp.TransparentValue</span></a></span><span> </span><span id="local-6989586621684568503"><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684568503"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ScalarValue"><span class="hs-identifier hs-type">Imp.ScalarValue</span></a></span><span> </span><span id="local-6989586621684568502"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568502"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621684568501"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568501"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniqueness -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684568503"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; Signedness -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#readTypeEnum"><span class="hs-identifier hs-var">readTypeEnum</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568502"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568501"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-929"></span><span>    </span><span class="annot"><a href="#local-6989586621684568518"><span class="hs-identifier hs-var">desc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#TransparentValue"><span class="hs-identifier hs-type">Imp.TransparentValue</span></a></span><span> </span><span id="local-6989586621684568500"><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684568500"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ArrayValue"><span class="hs-identifier hs-type">Imp.ArrayValue</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568499"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568499"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621684568498"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568498"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621684568497"><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568497"><span class="hs-identifier hs-var">dims</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-930"></span><span>      </span><span class="annot"><span class="annottext">Uniqueness -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="#local-6989586621684568500"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Char] -&gt; [[Char]]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DimSize] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684568497"><span class="hs-identifier hs-var">dims</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;[]&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; Signedness -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#readTypeEnum"><span class="hs-identifier hs-var">readTypeEnum</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568499"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568498"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-931"></span><span>
</span><span id="line-932"></span><span id="local-6989586621684569631"><span id="local-6989586621684569632"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#callEntryFun"><span class="hs-identifier hs-type">callEntryFun</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-933"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-934"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Function"><span class="hs-identifier hs-type">Imp.Function</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569632"><span class="hs-identifier hs-type">op</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-935"></span><span>  </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569632"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569631"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyFunDef"><span class="hs-identifier hs-type">PyFunDef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-936"></span><span id="callEntryFun"><span class="annot"><span class="annottext">callEntryFun :: forall op s.
[PyStmt]
-&gt; (Name, Function op)
-&gt; CompilerM op s (Maybe (PyFunDef, [Char], PyExp))
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#callEntryFun"><span class="hs-identifier hs-var hs-var">callEntryFun</span></a></span></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Function"><span class="hs-identifier hs-type">Imp.Function</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">[Param]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Param]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Code op
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[ExternalValue]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[(Name, ExternalValue)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (PyFunDef, [Char], PyExp)
-&gt; CompilerM op s (Maybe (PyFunDef, [Char], PyExp))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (PyFunDef, [Char], PyExp)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-937"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#callEntryFun"><span class="hs-identifier hs-var">callEntryFun</span></a></span><span> </span><span id="local-6989586621684568492"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568492"><span class="hs-identifier hs-var">pre_timing</span></a></span></span><span> </span><span id="local-6989586621684568491"><span class="annot"><span class="annottext">entry :: (Name, Function op)
</span><a href="#local-6989586621684568491"><span class="hs-identifier hs-var">entry</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621684568490"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684568490"><span class="hs-identifier hs-var">fname</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Function"><span class="hs-identifier hs-type">Imp.Function</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684568489"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684568489"><span class="hs-identifier hs-var">ename</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Param]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Param]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Code op
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[ExternalValue]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568488"><span class="annot"><span class="annottext">[(Name, ExternalValue)]
</span><a href="#local-6989586621684568488"><span class="hs-identifier hs-var">decl_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-938"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[Char]]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568487"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568487"><span class="hs-identifier hs-var">prepare_in</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568486"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568486"><span class="hs-identifier hs-var">body_bin</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568485"><span class="annot"><span class="annottext">[(ExternalValue, PyExp)]
</span><a href="#local-6989586621684568485"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568484"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568484"><span class="hs-identifier hs-var">prepare_run</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Name, Function op)
-&gt; CompilerM
     op
     s
     ([[Char]], [PyStmt], [PyStmt], [PyStmt], [PyStmt],
      [(ExternalValue, PyExp)], [PyStmt])
forall op s.
(Name, Function op)
-&gt; CompilerM
     op
     s
     ([[Char]], [PyStmt], [PyStmt], [PyStmt], [PyStmt],
      [(ExternalValue, PyExp)], [PyStmt])
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#prepareEntry"><span class="hs-identifier hs-var">prepareEntry</span></a></span><span> </span><span class="annot"><span class="annottext">(Name, Function op)
</span><a href="#local-6989586621684568491"><span class="hs-identifier hs-var">entry</span></a></span><span>
</span><span id="line-939"></span><span>
</span><span id="line-940"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568483"><span class="annot"><span class="annottext">str_input :: [PyStmt]
</span><a href="#local-6989586621684568483"><span class="hs-identifier hs-var hs-var">str_input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Name, ExternalValue) -&gt; PyStmt)
-&gt; [(Name, ExternalValue)] -&gt; [PyStmt]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExternalValue -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#readInput"><span class="hs-identifier hs-var">readInput</span></a></span><span> </span><span class="annot"><span class="annottext">(ExternalValue -&gt; PyStmt)
-&gt; ((Name, ExternalValue) -&gt; ExternalValue)
-&gt; (Name, ExternalValue)
-&gt; PyStmt
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name, ExternalValue) -&gt; ExternalValue
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, ExternalValue)]
</span><a href="#local-6989586621684568488"><span class="hs-identifier hs-var">decl_args</span></a></span><span>
</span><span id="line-941"></span><span>      </span><span id="local-6989586621684568480"><span class="annot"><span class="annottext">end_of_input :: [PyStmt]
</span><a href="#local-6989586621684568480"><span class="hs-identifier hs-var hs-var">end_of_input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;end_of_input&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [Char] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684568490"><span class="hs-identifier hs-var">fname</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-942"></span><span>
</span><span id="line-943"></span><span>      </span><span id="local-6989586621684568479"><span class="annot"><span class="annottext">exitcall :: [PyStmt]
</span><a href="#local-6989586621684568479"><span class="hs-identifier hs-var hs-var">exitcall</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;sys.exit&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp -&gt; [Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Field"><span class="hs-identifier hs-var">Field</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Assertion.{} failed&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;format(e)&quot;</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-944"></span><span>      </span><span id="local-6989586621684568478"><span class="annot"><span class="annottext">except' :: PyExcept
</span><a href="#local-6989586621684568478"><span class="hs-identifier hs-var hs-var">except'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; [PyStmt] -&gt; PyExcept
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Catch"><span class="hs-identifier hs-var">Catch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;AssertionError&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568479"><span class="hs-identifier hs-var">exitcall</span></a></span><span>
</span><span id="line-945"></span><span>      </span><span id="local-6989586621684568477"><span class="annot"><span class="annottext">do_run :: [PyStmt]
</span><a href="#local-6989586621684568477"><span class="hs-identifier hs-var hs-var">do_run</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568486"><span class="hs-identifier hs-var">body_bin</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568492"><span class="hs-identifier hs-var">pre_timing</span></a></span><span>
</span><span id="line-946"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684568476"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568476"><span class="hs-identifier hs-var">do_run_with_timing</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568475"><span class="annot"><span class="annottext">PyStmt
</span><a href="#local-6989586621684568475"><span class="hs-identifier hs-var">close_runtime_file</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PyStmt] -&gt; ([PyStmt], PyStmt)
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#addTiming"><span class="hs-identifier hs-var">addTiming</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568477"><span class="hs-identifier hs-var">do_run</span></a></span><span>
</span><span id="line-947"></span><span>
</span><span id="line-948"></span><span>      </span><span id="local-6989586621684568473"><span class="annot"><span class="annottext">do_warmup_run :: PyStmt
</span><a href="#local-6989586621684568473"><span class="hs-identifier hs-var hs-var">do_warmup_run</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-949"></span><span>        </span><span class="annot"><span class="annottext">PyExp -&gt; [PyStmt] -&gt; [PyStmt] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#If"><span class="hs-identifier hs-var">If</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;do_warmup_run&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568484"><span class="hs-identifier hs-var">prepare_run</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568477"><span class="hs-identifier hs-var">do_run</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-950"></span><span>
</span><span id="line-951"></span><span>      </span><span id="local-6989586621684568472"><span class="annot"><span class="annottext">do_num_runs :: PyStmt
</span><a href="#local-6989586621684568472"><span class="hs-identifier hs-var hs-var">do_num_runs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-952"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; [PyStmt] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#For"><span class="hs-identifier hs-var">For</span></a></span><span>
</span><span id="line-953"></span><span>          </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;i&quot;</span></span><span>
</span><span id="line-954"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;range&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;int&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;num_runs&quot;</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-955"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568484"><span class="hs-identifier hs-var">prepare_run</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568476"><span class="hs-identifier hs-var">do_run_with_timing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-956"></span><span>
</span><span id="line-957"></span><span>  </span><span id="local-6989586621684568470"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568470"><span class="hs-identifier hs-var">str_output</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(ExternalValue, PyExp)] -&gt; CompilerM op s [PyStmt]
forall op s. [(ExternalValue, PyExp)] -&gt; CompilerM op s [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#printValue"><span class="hs-identifier hs-var">printValue</span></a></span><span> </span><span class="annot"><span class="annottext">[(ExternalValue, PyExp)]
</span><a href="#local-6989586621684568485"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-958"></span><span>
</span><span id="line-959"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568467"><span class="annot"><span class="annottext">fname' :: [Char]
</span><a href="#local-6989586621684568467"><span class="hs-identifier hs-var hs-var">fname'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;entry_&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Char]
</span><a href="Language.Futhark.Core.html#nameToString"><span class="hs-identifier hs-var">nameToString</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684568490"><span class="hs-identifier hs-var">fname</span></a></span><span>
</span><span id="line-960"></span><span>
</span><span id="line-961"></span><span>  </span><span class="annot"><span class="annottext">Maybe (PyFunDef, [Char], PyExp)
-&gt; CompilerM op s (Maybe (PyFunDef, [Char], PyExp))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (PyFunDef, [Char], PyExp)
 -&gt; CompilerM op s (Maybe (PyFunDef, [Char], PyExp)))
-&gt; Maybe (PyFunDef, [Char], PyExp)
-&gt; CompilerM op s (Maybe (PyFunDef, [Char], PyExp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-962"></span><span>    </span><span class="annot"><span class="annottext">(PyFunDef, [Char], PyExp) -&gt; Maybe (PyFunDef, [Char], PyExp)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-963"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [[Char]] -&gt; [PyStmt] -&gt; PyFunDef
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568467"><span class="hs-identifier hs-var">fname'</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">([PyStmt] -&gt; PyFunDef) -&gt; [PyStmt] -&gt; PyFunDef
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-964"></span><span>          </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568483"><span class="hs-identifier hs-var">str_input</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568480"><span class="hs-identifier hs-var">end_of_input</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568487"><span class="hs-identifier hs-var">prepare_in</span></a></span><span>
</span><span id="line-965"></span><span>            </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyExcept] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Try"><span class="hs-identifier hs-var">Try</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyStmt
</span><a href="#local-6989586621684568473"><span class="hs-identifier hs-var">do_warmup_run</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyStmt
</span><a href="#local-6989586621684568472"><span class="hs-identifier hs-var">do_num_runs</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExcept
</span><a href="#local-6989586621684568478"><span class="hs-identifier hs-var">except'</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-966"></span><span>            </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyStmt
</span><a href="#local-6989586621684568475"><span class="hs-identifier hs-var">close_runtime_file</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-967"></span><span>            </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568470"><span class="hs-identifier hs-var">str_output</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-968"></span><span>        </span><span class="annot"><span class="annottext">Name -&gt; [Char]
</span><a href="Language.Futhark.Core.html#nameToString"><span class="hs-identifier hs-var">nameToString</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684568489"><span class="hs-identifier hs-var">ename</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-969"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568467"><span class="hs-identifier hs-var">fname'</span></a></span><span>
</span><span id="line-970"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-971"></span><span>
</span><span id="line-972"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#addTiming"><span class="hs-identifier hs-type">addTiming</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyStmt"><span class="hs-identifier hs-type">PyStmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-973"></span><span id="addTiming"><span class="annot"><span class="annottext">addTiming :: [PyStmt] -&gt; ([PyStmt], PyStmt)
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#addTiming"><span class="hs-identifier hs-var hs-var">addTiming</span></a></span></span><span> </span><span id="local-6989586621684568466"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568466"><span class="hs-identifier hs-var">statements</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-974"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;time_start&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;time.time&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-975"></span><span>      </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568466"><span class="hs-identifier hs-var">statements</span></a></span><span>
</span><span id="line-976"></span><span>      </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;time_end&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;time.time&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-977"></span><span>           </span><span class="annot"><span class="annottext">PyExp -&gt; [PyStmt] -&gt; [PyStmt] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#If"><span class="hs-identifier hs-var">If</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;runtime_file&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568465"><span class="hs-identifier hs-var">print_runtime</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-978"></span><span>         </span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-979"></span><span>    </span><span class="annot"><span class="annottext">PyExp -&gt; [PyStmt] -&gt; [PyStmt] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#If"><span class="hs-identifier hs-var">If</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;runtime_file&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;runtime_file.close&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-980"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-981"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-982"></span><span>    </span><span id="local-6989586621684568465"><span class="annot"><span class="annottext">print_runtime :: [PyStmt]
</span><a href="#local-6989586621684568465"><span class="hs-identifier hs-var hs-var">print_runtime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-983"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-984"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span>
</span><span id="line-985"></span><span>            </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;runtime_file.write&quot;</span></span><span>
</span><span id="line-986"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span>
</span><span id="line-987"></span><span>                </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;str&quot;</span></span><span>
</span><span id="line-988"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span>
</span><span id="line-989"></span><span>                    </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;-&quot;</span></span><span>
</span><span id="line-990"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#toMicroseconds"><span class="hs-identifier hs-var">toMicroseconds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;time_end&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-991"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#toMicroseconds"><span class="hs-identifier hs-var">toMicroseconds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;time_start&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-992"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-993"></span><span>            </span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-994"></span><span>        </span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;runtime_file.write&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-995"></span><span>        </span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;runtime_file.flush&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-996"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-997"></span><span>
</span><span id="line-998"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#toMicroseconds"><span class="hs-identifier hs-type">toMicroseconds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span>
</span><span id="line-999"></span><span id="toMicroseconds"><span class="annot"><span class="annottext">toMicroseconds :: PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#toMicroseconds"><span class="hs-identifier hs-var hs-var">toMicroseconds</span></a></span></span><span> </span><span id="local-6989586621684568464"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568464"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1000"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;int&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568464"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyExp) -&gt; PyExp -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1000000</span></span><span class="hs-special">]</span><span>
</span><span id="line-1001"></span><span>
</span><span id="line-1002"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileUnOp"><span class="hs-identifier hs-type">compileUnOp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#UnOp"><span class="hs-identifier hs-type">Imp.UnOp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-1003"></span><span id="compileUnOp"><span class="annot"><span class="annottext">compileUnOp :: UnOp -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileUnOp"><span class="hs-identifier hs-var hs-var">compileUnOp</span></a></span></span><span> </span><span id="local-6989586621684568462"><span class="annot"><span class="annottext">UnOp
</span><a href="#local-6989586621684568462"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1004"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnOp
</span><a href="#local-6989586621684568462"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1005"></span><span>    </span><span class="annot"><span class="annottext">UnOp
</span><a href="Futhark.IR.Primitive.html#Not"><span class="hs-identifier hs-var">Not</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;not&quot;</span></span><span>
</span><span id="line-1006"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#Complement"><span class="hs-identifier hs-type">Complement</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;~&quot;</span></span><span>
</span><span id="line-1007"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#Abs"><span class="hs-identifier hs-type">Abs</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;abs&quot;</span></span><span>
</span><span id="line-1008"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#FAbs"><span class="hs-identifier hs-type">FAbs</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;abs&quot;</span></span><span>
</span><span id="line-1009"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#SSignum"><span class="hs-identifier hs-type">SSignum</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ssignum&quot;</span></span><span>
</span><span id="line-1010"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#USignum"><span class="hs-identifier hs-type">USignum</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;usignum&quot;</span></span><span>
</span><span id="line-1011"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#FSignum"><span class="hs-identifier hs-type">FSignum</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.sign&quot;</span></span><span>
</span><span id="line-1012"></span><span>
</span><span id="line-1013"></span><span id="local-6989586621684569529"><span id="local-6989586621684569530"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileBinOpLike"><span class="hs-identifier hs-type">compileBinOpLike</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1014"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621684569530"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1015"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621684569529"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621684569530"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1016"></span><span>  </span><span class="annot"><a href="Futhark.Analysis.PrimExp.html#PrimExp"><span class="hs-identifier hs-type">Imp.PrimExp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569529"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1017"></span><span>  </span><span class="annot"><a href="Futhark.Analysis.PrimExp.html#PrimExp"><span class="hs-identifier hs-type">Imp.PrimExp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569529"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1018"></span><span>  </span><span class="annot"><a href="#local-6989586621684569530"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621684569530"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1019"></span><span id="compileBinOpLike"><span class="annot"><span class="annottext">compileBinOpLike :: forall (m :: * -&gt; *) v.
Monad m =&gt;
(v -&gt; m PyExp)
-&gt; PrimExp v -&gt; PrimExp v -&gt; m (PyExp, PyExp, [Char] -&gt; m PyExp)
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileBinOpLike"><span class="hs-identifier hs-var hs-var">compileBinOpLike</span></a></span></span><span> </span><span id="local-6989586621684568446"><span class="annot"><span class="annottext">v -&gt; m PyExp
</span><a href="#local-6989586621684568446"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621684568445"><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684568445"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621684568444"><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684568444"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1020"></span><span>  </span><span id="local-6989586621684568443"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568443"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(v -&gt; m PyExp) -&gt; PrimExp v -&gt; m PyExp
forall (m :: * -&gt; *) v.
Monad m =&gt;
(v -&gt; m PyExp) -&gt; PrimExp v -&gt; m PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimExp"><span class="hs-identifier hs-var">compilePrimExp</span></a></span><span> </span><span class="annot"><span class="annottext">v -&gt; m PyExp
</span><a href="#local-6989586621684568446"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684568445"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1021"></span><span>  </span><span id="local-6989586621684568442"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568442"><span class="hs-identifier hs-var">y'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(v -&gt; m PyExp) -&gt; PrimExp v -&gt; m PyExp
forall (m :: * -&gt; *) v.
Monad m =&gt;
(v -&gt; m PyExp) -&gt; PrimExp v -&gt; m PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimExp"><span class="hs-identifier hs-var">compilePrimExp</span></a></span><span> </span><span class="annot"><span class="annottext">v -&gt; m PyExp
</span><a href="#local-6989586621684568446"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684568444"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-1022"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568439"><span class="annot"><span class="annottext">simple :: [Char] -&gt; m PyExp
</span><a href="#local-6989586621684568439"><span class="hs-identifier hs-var hs-var">simple</span></a></span></span><span> </span><span id="local-6989586621684568438"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568438"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; m PyExp
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; m PyExp) -&gt; PyExp -&gt; m PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568438"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568443"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568442"><span class="hs-identifier hs-var">y'</span></a></span><span>
</span><span id="line-1023"></span><span>  </span><span class="annot"><span class="annottext">(PyExp, PyExp, [Char] -&gt; m PyExp)
-&gt; m (PyExp, PyExp, [Char] -&gt; m PyExp)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568443"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568442"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
forall {m :: * -&gt; *}. Monad m =&gt; [Char] -&gt; m PyExp
</span><a href="#local-6989586621684568439"><span class="hs-identifier hs-var">simple</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1024"></span><span>
</span><span id="line-1025"></span><span class="hs-comment">-- | The ctypes type corresponding to a 'PrimType'.</span><span>
</span><span id="line-1026"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimType"><span class="hs-identifier hs-type">compilePrimType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-1027"></span><span id="compilePrimType"><span class="annot"><span class="annottext">compilePrimType :: PrimType -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimType"><span class="hs-identifier hs-var hs-var">compilePrimType</span></a></span></span><span> </span><span id="local-6989586621684568437"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568437"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1028"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568437"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1029"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int8"><span class="hs-identifier hs-var">Int8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_int8&quot;</span></span><span>
</span><span id="line-1030"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int16"><span class="hs-identifier hs-var">Int16</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_int16&quot;</span></span><span>
</span><span id="line-1031"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int32"><span class="hs-identifier hs-var">Int32</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_int32&quot;</span></span><span>
</span><span id="line-1032"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_int64&quot;</span></span><span>
</span><span id="line-1033"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float16"><span class="hs-identifier hs-var">Float16</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_uint16&quot;</span></span><span>
</span><span id="line-1034"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float32"><span class="hs-identifier hs-var">Float32</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_float&quot;</span></span><span>
</span><span id="line-1035"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float64"><span class="hs-identifier hs-var">Float64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_double&quot;</span></span><span>
</span><span id="line-1036"></span><span>    </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Primitive.html#Bool"><span class="hs-identifier hs-var">Imp.Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_bool&quot;</span></span><span>
</span><span id="line-1037"></span><span>    </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Primitive.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_bool&quot;</span></span><span>
</span><span id="line-1038"></span><span>
</span><span id="line-1039"></span><span class="hs-comment">-- | The ctypes type corresponding to a 'PrimType', taking sign into account.</span><span>
</span><span id="line-1040"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimTypeExt"><span class="hs-identifier hs-type">compilePrimTypeExt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Signedness"><span class="hs-identifier hs-type">Imp.Signedness</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-1041"></span><span id="compilePrimTypeExt"><span class="annot"><span class="annottext">compilePrimTypeExt :: PrimType -&gt; Signedness -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimTypeExt"><span class="hs-identifier hs-var hs-var">compilePrimTypeExt</span></a></span></span><span> </span><span id="local-6989586621684568436"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568436"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621684568435"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568435"><span class="hs-identifier hs-var">ept</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1042"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568436"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568435"><span class="hs-identifier hs-var">ept</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1043"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int8"><span class="hs-identifier hs-var">Int8</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">Imp.TypeUnsigned</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_uint8&quot;</span></span><span>
</span><span id="line-1044"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int16"><span class="hs-identifier hs-var">Int16</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">Imp.TypeUnsigned</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_uint16&quot;</span></span><span>
</span><span id="line-1045"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int32"><span class="hs-identifier hs-var">Int32</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">Imp.TypeUnsigned</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_uint32&quot;</span></span><span>
</span><span id="line-1046"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">Imp.TypeUnsigned</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_uint64&quot;</span></span><span>
</span><span id="line-1047"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int8"><span class="hs-identifier hs-var">Int8</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_int8&quot;</span></span><span>
</span><span id="line-1048"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int16"><span class="hs-identifier hs-var">Int16</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_int16&quot;</span></span><span>
</span><span id="line-1049"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int32"><span class="hs-identifier hs-var">Int32</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_int32&quot;</span></span><span>
</span><span id="line-1050"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_int64&quot;</span></span><span>
</span><span id="line-1051"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float16"><span class="hs-identifier hs-var">Float16</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_uint16&quot;</span></span><span>
</span><span id="line-1052"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float32"><span class="hs-identifier hs-var">Float32</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_float&quot;</span></span><span>
</span><span id="line-1053"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float64"><span class="hs-identifier hs-var">Float64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_double&quot;</span></span><span>
</span><span id="line-1054"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Primitive.html#Bool"><span class="hs-identifier hs-var">Imp.Bool</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_bool&quot;</span></span><span>
</span><span id="line-1055"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Primitive.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_byte&quot;</span></span><span>
</span><span id="line-1056"></span><span>
</span><span id="line-1057"></span><span class="hs-comment">-- | The Numpy type corresponding to a 'PrimType'.</span><span>
</span><span id="line-1058"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimToNp"><span class="hs-identifier hs-type">compilePrimToNp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">Imp.PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-1059"></span><span id="compilePrimToNp"><span class="annot"><span class="annottext">compilePrimToNp :: PrimType -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimToNp"><span class="hs-identifier hs-var hs-var">compilePrimToNp</span></a></span></span><span> </span><span id="local-6989586621684568434"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568434"><span class="hs-identifier hs-var">bt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1060"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568434"><span class="hs-identifier hs-var">bt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1061"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int8"><span class="hs-identifier hs-var">Int8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.int8&quot;</span></span><span>
</span><span id="line-1062"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int16"><span class="hs-identifier hs-var">Int16</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.int16&quot;</span></span><span>
</span><span id="line-1063"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int32"><span class="hs-identifier hs-var">Int32</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.int32&quot;</span></span><span>
</span><span id="line-1064"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.int64&quot;</span></span><span>
</span><span id="line-1065"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float16"><span class="hs-identifier hs-var">Float16</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.float16&quot;</span></span><span>
</span><span id="line-1066"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float32"><span class="hs-identifier hs-var">Float32</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.float32&quot;</span></span><span>
</span><span id="line-1067"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float64"><span class="hs-identifier hs-var">Float64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.float64&quot;</span></span><span>
</span><span id="line-1068"></span><span>    </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Primitive.html#Bool"><span class="hs-identifier hs-var">Imp.Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.byte&quot;</span></span><span>
</span><span id="line-1069"></span><span>    </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Primitive.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.byte&quot;</span></span><span>
</span><span id="line-1070"></span><span>
</span><span id="line-1071"></span><span class="hs-comment">-- | The Numpy type corresponding to a 'PrimType', taking sign into account.</span><span>
</span><span id="line-1072"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimToExtNp"><span class="hs-identifier hs-type">compilePrimToExtNp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">Imp.PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Signedness"><span class="hs-identifier hs-type">Imp.Signedness</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-1073"></span><span id="compilePrimToExtNp"><span class="annot"><span class="annottext">compilePrimToExtNp :: PrimType -&gt; Signedness -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimToExtNp"><span class="hs-identifier hs-var hs-var">compilePrimToExtNp</span></a></span></span><span> </span><span id="local-6989586621684568433"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568433"><span class="hs-identifier hs-var">bt</span></a></span></span><span> </span><span id="local-6989586621684568432"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568432"><span class="hs-identifier hs-var">ept</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1074"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568433"><span class="hs-identifier hs-var">bt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684568432"><span class="hs-identifier hs-var">ept</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1075"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int8"><span class="hs-identifier hs-var">Int8</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">Imp.TypeUnsigned</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.uint8&quot;</span></span><span>
</span><span id="line-1076"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int16"><span class="hs-identifier hs-var">Int16</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">Imp.TypeUnsigned</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.uint16&quot;</span></span><span>
</span><span id="line-1077"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int32"><span class="hs-identifier hs-var">Int32</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">Imp.TypeUnsigned</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.uint32&quot;</span></span><span>
</span><span id="line-1078"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">Imp.TypeUnsigned</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.uint64&quot;</span></span><span>
</span><span id="line-1079"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int8"><span class="hs-identifier hs-var">Int8</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.int8&quot;</span></span><span>
</span><span id="line-1080"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int16"><span class="hs-identifier hs-var">Int16</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.int16&quot;</span></span><span>
</span><span id="line-1081"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int32"><span class="hs-identifier hs-var">Int32</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.int32&quot;</span></span><span>
</span><span id="line-1082"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.int64&quot;</span></span><span>
</span><span id="line-1083"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float16"><span class="hs-identifier hs-var">Float16</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.float16&quot;</span></span><span>
</span><span id="line-1084"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float32"><span class="hs-identifier hs-var">Float32</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.float32&quot;</span></span><span>
</span><span id="line-1085"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float64"><span class="hs-identifier hs-var">Float64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.float64&quot;</span></span><span>
</span><span id="line-1086"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Primitive.html#Bool"><span class="hs-identifier hs-var">Imp.Bool</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.bool_&quot;</span></span><span>
</span><span id="line-1087"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Primitive.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.byte&quot;</span></span><span>
</span><span id="line-1088"></span><span>
</span><span id="line-1089"></span><span class="hs-comment">-- | Convert from scalar to storage representation for the given type.</span><span>
</span><span id="line-1090"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#toStorage"><span class="hs-identifier hs-type">toStorage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span>
</span><span id="line-1091"></span><span id="toStorage"><span class="annot"><span class="annottext">toStorage :: PrimType -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#toStorage"><span class="hs-identifier hs-var hs-var">toStorage</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float16"><span class="hs-identifier hs-var">Float16</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684568431"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568431"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1092"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_int16&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;futhark_to_bits16&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568431"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1093"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#toStorage"><span class="hs-identifier hs-var">toStorage</span></a></span><span> </span><span id="local-6989586621684568430"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568430"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621684568429"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568429"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimType"><span class="hs-identifier hs-var">compilePrimType</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568430"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568429"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1094"></span><span>
</span><span id="line-1095"></span><span class="hs-comment">-- | Convert from storage to scalar representation for the given type.</span><span>
</span><span id="line-1096"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#fromStorage"><span class="hs-identifier hs-type">fromStorage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span>
</span><span id="line-1097"></span><span id="fromStorage"><span class="annot"><span class="annottext">fromStorage :: PrimType -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#fromStorage"><span class="hs-identifier hs-var hs-var">fromStorage</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float16"><span class="hs-identifier hs-var">Float16</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684568428"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568428"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1098"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;futhark_from_bits16&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.int16&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568428"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1099"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#fromStorage"><span class="hs-identifier hs-var">fromStorage</span></a></span><span> </span><span id="local-6989586621684568427"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568427"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621684568426"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568426"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimToNp"><span class="hs-identifier hs-var">compilePrimToNp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568427"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568426"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1100"></span><span>
</span><span id="line-1101"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimValue"><span class="hs-identifier hs-type">compilePrimValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimValue"><span class="hs-identifier hs-type">Imp.PrimValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span>
</span><span id="line-1102"></span><span id="compilePrimValue"><span class="annot"><span class="annottext">compilePrimValue :: PrimValue -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimValue"><span class="hs-identifier hs-var hs-var">compilePrimValue</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntValue"><span class="hs-identifier hs-type">IntValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#Int8Value"><span class="hs-identifier hs-type">Int8Value</span></a></span><span> </span><span id="local-6989586621684568423"><span class="annot"><span class="annottext">Int8
</span><a href="#local-6989586621684568423"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1103"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.int8&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; PyExp) -&gt; Integer -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int8 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">Int8
</span><a href="#local-6989586621684568423"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1104"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimValue"><span class="hs-identifier hs-var">compilePrimValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntValue"><span class="hs-identifier hs-type">IntValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#Int16Value"><span class="hs-identifier hs-type">Int16Value</span></a></span><span> </span><span id="local-6989586621684568421"><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621684568421"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1105"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.int16&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; PyExp) -&gt; Integer -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int16 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621684568421"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1106"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimValue"><span class="hs-identifier hs-var">compilePrimValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntValue"><span class="hs-identifier hs-type">IntValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#Int32Value"><span class="hs-identifier hs-type">Int32Value</span></a></span><span> </span><span id="local-6989586621684568419"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621684568419"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1107"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.int32&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; PyExp) -&gt; Integer -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int32 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621684568419"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1108"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimValue"><span class="hs-identifier hs-var">compilePrimValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntValue"><span class="hs-identifier hs-type">IntValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#Int64Value"><span class="hs-identifier hs-type">Int64Value</span></a></span><span> </span><span id="local-6989586621684568417"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621684568417"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1109"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.int64&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; PyExp) -&gt; Integer -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621684568417"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1110"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimValue"><span class="hs-identifier hs-var">compilePrimValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatValue"><span class="hs-identifier hs-type">FloatValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#Float16Value"><span class="hs-identifier hs-type">Float16Value</span></a></span><span> </span><span id="local-6989586621684568414"><span class="annot"><span class="annottext">Half
</span><a href="#local-6989586621684568414"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1111"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Half -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isInfinite</span></span><span> </span><span class="annot"><span class="annottext">Half
</span><a href="#local-6989586621684568414"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1112"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Half
</span><a href="#local-6989586621684568414"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Half -&gt; Half -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Half
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.inf&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;-np.inf&quot;</span></span><span>
</span><span id="line-1113"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Half -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isNaN</span></span><span> </span><span class="annot"><span class="annottext">Half
</span><a href="#local-6989586621684568414"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1114"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.nan&quot;</span></span><span>
</span><span id="line-1115"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.float16&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Float"><span class="hs-identifier hs-var">Float</span></a></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; PyExp) -&gt; Double -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Double
forall a. Fractional a =&gt; Rational -&gt; a
</span><span class="hs-identifier hs-var">fromRational</span></span><span> </span><span class="annot"><span class="annottext">(Rational -&gt; Double) -&gt; Rational -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Half -&gt; Rational
forall a. Real a =&gt; a -&gt; Rational
</span><span class="hs-identifier hs-var">toRational</span></span><span> </span><span class="annot"><span class="annottext">Half
</span><a href="#local-6989586621684568414"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1116"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimValue"><span class="hs-identifier hs-var">compilePrimValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatValue"><span class="hs-identifier hs-type">FloatValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#Float32Value"><span class="hs-identifier hs-type">Float32Value</span></a></span><span> </span><span id="local-6989586621684568408"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621684568408"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1117"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isInfinite</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621684568408"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1118"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621684568408"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.inf&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;-np.inf&quot;</span></span><span>
</span><span id="line-1119"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isNaN</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621684568408"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1120"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.nan&quot;</span></span><span>
</span><span id="line-1121"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.float32&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Float"><span class="hs-identifier hs-var">Float</span></a></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; PyExp) -&gt; Double -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Double
forall a. Fractional a =&gt; Rational -&gt; a
</span><span class="hs-identifier hs-var">fromRational</span></span><span> </span><span class="annot"><span class="annottext">(Rational -&gt; Double) -&gt; Rational -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Rational
forall a. Real a =&gt; a -&gt; Rational
</span><span class="hs-identifier hs-var">toRational</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621684568408"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1122"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimValue"><span class="hs-identifier hs-var">compilePrimValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatValue"><span class="hs-identifier hs-type">FloatValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#Float64Value"><span class="hs-identifier hs-type">Float64Value</span></a></span><span> </span><span id="local-6989586621684568406"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621684568406"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1123"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isInfinite</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621684568406"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1124"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621684568406"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.inf&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;-np.inf&quot;</span></span><span>
</span><span id="line-1125"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isNaN</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621684568406"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1126"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.nan&quot;</span></span><span>
</span><span id="line-1127"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.float64&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Float"><span class="hs-identifier hs-var">Float</span></a></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; PyExp) -&gt; Double -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Double
forall a. Fractional a =&gt; Rational -&gt; a
</span><span class="hs-identifier hs-var">fromRational</span></span><span> </span><span class="annot"><span class="annottext">(Rational -&gt; Double) -&gt; Rational -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Rational
forall a. Real a =&gt; a -&gt; Rational
</span><span class="hs-identifier hs-var">toRational</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621684568406"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1128"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimValue"><span class="hs-identifier hs-var">compilePrimValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#BoolValue"><span class="hs-identifier hs-type">BoolValue</span></a></span><span> </span><span id="local-6989586621684568404"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684568404"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Bool"><span class="hs-identifier hs-var">Bool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684568404"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1129"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimValue"><span class="hs-identifier hs-var">compilePrimValue</span></a></span><span> </span><span class="annot"><span class="annottext">PrimValue
</span><a href="Futhark.IR.Primitive.html#UnitValue"><span class="hs-identifier hs-var">UnitValue</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;None&quot;</span></span><span>
</span><span id="line-1130"></span><span>
</span><span id="line-1131"></span><span id="local-6989586621684569599"><span id="local-6989586621684569600"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-type">compileVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569600"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569599"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span></span></span><span>
</span><span id="line-1132"></span><span id="compileVar"><span class="annot"><span class="annottext">compileVar :: forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var hs-var">compileVar</span></a></span></span><span> </span><span id="local-6989586621684568400"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568400"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1133"></span><span>  </span><span class="annot"><span class="annottext">(CompilerEnv op s -&gt; PyExp) -&gt; CompilerM op s PyExp
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">((CompilerEnv op s -&gt; PyExp) -&gt; CompilerM op s PyExp)
-&gt; (CompilerEnv op s -&gt; PyExp) -&gt; CompilerM op s PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; Maybe PyExp -&gt; PyExp
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [Char] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileName"><span class="hs-identifier hs-var">compileName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568400"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe PyExp -&gt; PyExp)
-&gt; (CompilerEnv op s -&gt; Maybe PyExp) -&gt; CompilerEnv op s -&gt; PyExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Map VName PyExp -&gt; Maybe PyExp
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568400"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(Map VName PyExp -&gt; Maybe PyExp)
-&gt; (CompilerEnv op s -&gt; Map VName PyExp)
-&gt; CompilerEnv op s
-&gt; Maybe PyExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CompilerEnv op s -&gt; Map VName PyExp
forall op s. CompilerEnv op s -&gt; Map VName PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envVarExp"><span class="hs-identifier hs-var hs-var">envVarExp</span></a></span><span>
</span><span id="line-1134"></span><span>
</span><span id="line-1135"></span><span class="hs-comment">-- | Tell me how to compile a @v@, and I'll Compile any @PrimExp v@ for you.</span><span>
</span><span id="line-1136"></span><span id="local-6989586621684569524"><span id="local-6989586621684569525"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimExp"><span class="hs-identifier hs-type">compilePrimExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621684569525"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621684569524"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621684569525"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.PrimExp.html#PrimExp"><span class="hs-identifier hs-type">Imp.PrimExp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569524"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621684569525"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span></span></span><span>
</span><span id="line-1137"></span><span id="compilePrimExp"><span class="annot"><span class="annottext">compilePrimExp :: forall (m :: * -&gt; *) v.
Monad m =&gt;
(v -&gt; m PyExp) -&gt; PrimExp v -&gt; m PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimExp"><span class="hs-identifier hs-var hs-var">compilePrimExp</span></a></span></span><span> </span><span class="annot"><span class="annottext">v -&gt; m PyExp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.PrimExp.html#ValueExp"><span class="hs-identifier hs-type">Imp.ValueExp</span></a></span><span> </span><span id="local-6989586621684568368"><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684568368"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; m PyExp
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; m PyExp) -&gt; PyExp -&gt; m PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimValue -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimValue"><span class="hs-identifier hs-var">compilePrimValue</span></a></span><span> </span><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684568368"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1138"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimExp"><span class="hs-identifier hs-var">compilePrimExp</span></a></span><span> </span><span id="local-6989586621684568367"><span class="annot"><span class="annottext">v -&gt; m PyExp
</span><a href="#local-6989586621684568367"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.PrimExp.html#LeafExp"><span class="hs-identifier hs-type">Imp.LeafExp</span></a></span><span> </span><span id="local-6989586621684568365"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621684568365"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">v -&gt; m PyExp
</span><a href="#local-6989586621684568367"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621684568365"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1139"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimExp"><span class="hs-identifier hs-var">compilePrimExp</span></a></span><span> </span><span id="local-6989586621684568364"><span class="annot"><span class="annottext">v -&gt; m PyExp
</span><a href="#local-6989586621684568364"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.PrimExp.html#BinOpExp"><span class="hs-identifier hs-type">Imp.BinOpExp</span></a></span><span> </span><span id="local-6989586621684568362"><span class="annot"><span class="annottext">BinOp
</span><a href="#local-6989586621684568362"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621684568361"><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684568361"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621684568360"><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684568360"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1140"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684568359"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568359"><span class="hs-identifier hs-var">x'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568358"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568358"><span class="hs-identifier hs-var">y'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568357"><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568357"><span class="hs-identifier hs-var">simple</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(v -&gt; m PyExp)
-&gt; PrimExp v -&gt; PrimExp v -&gt; m (PyExp, PyExp, [Char] -&gt; m PyExp)
forall (m :: * -&gt; *) v.
Monad m =&gt;
(v -&gt; m PyExp)
-&gt; PrimExp v -&gt; PrimExp v -&gt; m (PyExp, PyExp, [Char] -&gt; m PyExp)
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileBinOpLike"><span class="hs-identifier hs-var">compileBinOpLike</span></a></span><span> </span><span class="annot"><span class="annottext">v -&gt; m PyExp
</span><a href="#local-6989586621684568364"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684568361"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684568360"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-1141"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BinOp
</span><a href="#local-6989586621684568362"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1142"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#Add"><span class="hs-identifier hs-type">Add</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568357"><span class="hs-identifier hs-var">simple</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;+&quot;</span></span><span>
</span><span id="line-1143"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#Sub"><span class="hs-identifier hs-type">Sub</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568357"><span class="hs-identifier hs-var">simple</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;-&quot;</span></span><span>
</span><span id="line-1144"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#Mul"><span class="hs-identifier hs-type">Mul</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568357"><span class="hs-identifier hs-var">simple</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;*&quot;</span></span><span>
</span><span id="line-1145"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#FAdd"><span class="hs-identifier hs-type">FAdd</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568357"><span class="hs-identifier hs-var">simple</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;+&quot;</span></span><span>
</span><span id="line-1146"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#FSub"><span class="hs-identifier hs-type">FSub</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568357"><span class="hs-identifier hs-var">simple</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;-&quot;</span></span><span>
</span><span id="line-1147"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#FMul"><span class="hs-identifier hs-type">FMul</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568357"><span class="hs-identifier hs-var">simple</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;*&quot;</span></span><span>
</span><span id="line-1148"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#FDiv"><span class="hs-identifier hs-type">FDiv</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568357"><span class="hs-identifier hs-var">simple</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;/&quot;</span></span><span>
</span><span id="line-1149"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#FMod"><span class="hs-identifier hs-type">FMod</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568357"><span class="hs-identifier hs-var">simple</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;%&quot;</span></span><span>
</span><span id="line-1150"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#Xor"><span class="hs-identifier hs-type">Xor</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568357"><span class="hs-identifier hs-var">simple</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;^&quot;</span></span><span>
</span><span id="line-1151"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#And"><span class="hs-identifier hs-type">And</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568357"><span class="hs-identifier hs-var">simple</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&amp;&quot;</span></span><span>
</span><span id="line-1152"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#Or"><span class="hs-identifier hs-type">Or</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568357"><span class="hs-identifier hs-var">simple</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;|&quot;</span></span><span>
</span><span id="line-1153"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#Shl"><span class="hs-identifier hs-type">Shl</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568357"><span class="hs-identifier hs-var">simple</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&lt;&lt;&quot;</span></span><span>
</span><span id="line-1154"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#LogAnd"><span class="hs-identifier hs-type">LogAnd</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568357"><span class="hs-identifier hs-var">simple</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;and&quot;</span></span><span>
</span><span id="line-1155"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#LogOr"><span class="hs-identifier hs-type">LogOr</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568357"><span class="hs-identifier hs-var">simple</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;or&quot;</span></span><span>
</span><span id="line-1156"></span><span>    </span><span class="annot"><span class="annottext">BinOp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; m PyExp
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; m PyExp) -&gt; PyExp -&gt; m PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BinOp -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">BinOp
</span><a href="#local-6989586621684568362"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568359"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568358"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1157"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimExp"><span class="hs-identifier hs-var">compilePrimExp</span></a></span><span> </span><span id="local-6989586621684568342"><span class="annot"><span class="annottext">v -&gt; m PyExp
</span><a href="#local-6989586621684568342"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.PrimExp.html#ConvOpExp"><span class="hs-identifier hs-type">Imp.ConvOpExp</span></a></span><span> </span><span id="local-6989586621684568340"><span class="annot"><span class="annottext">ConvOp
</span><a href="#local-6989586621684568340"><span class="hs-identifier hs-var">conv</span></a></span></span><span> </span><span id="local-6989586621684568339"><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684568339"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1158"></span><span>  </span><span id="local-6989586621684568338"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568338"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(v -&gt; m PyExp) -&gt; PrimExp v -&gt; m PyExp
forall (m :: * -&gt; *) v.
Monad m =&gt;
(v -&gt; m PyExp) -&gt; PrimExp v -&gt; m PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimExp"><span class="hs-identifier hs-var">compilePrimExp</span></a></span><span> </span><span class="annot"><span class="annottext">v -&gt; m PyExp
</span><a href="#local-6989586621684568342"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684568339"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1159"></span><span>  </span><span class="annot"><span class="annottext">PyExp -&gt; m PyExp
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; m PyExp) -&gt; PyExp -&gt; m PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConvOp -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">ConvOp
</span><a href="#local-6989586621684568340"><span class="hs-identifier hs-var">conv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568338"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1160"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimExp"><span class="hs-identifier hs-var">compilePrimExp</span></a></span><span> </span><span id="local-6989586621684568337"><span class="annot"><span class="annottext">v -&gt; m PyExp
</span><a href="#local-6989586621684568337"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.PrimExp.html#CmpOpExp"><span class="hs-identifier hs-type">Imp.CmpOpExp</span></a></span><span> </span><span id="local-6989586621684568335"><span class="annot"><span class="annottext">CmpOp
</span><a href="#local-6989586621684568335"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621684568334"><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684568334"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621684568333"><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684568333"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1161"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684568332"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568332"><span class="hs-identifier hs-var">x'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568331"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568331"><span class="hs-identifier hs-var">y'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568330"><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568330"><span class="hs-identifier hs-var">simple</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(v -&gt; m PyExp)
-&gt; PrimExp v -&gt; PrimExp v -&gt; m (PyExp, PyExp, [Char] -&gt; m PyExp)
forall (m :: * -&gt; *) v.
Monad m =&gt;
(v -&gt; m PyExp)
-&gt; PrimExp v -&gt; PrimExp v -&gt; m (PyExp, PyExp, [Char] -&gt; m PyExp)
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileBinOpLike"><span class="hs-identifier hs-var">compileBinOpLike</span></a></span><span> </span><span class="annot"><span class="annottext">v -&gt; m PyExp
</span><a href="#local-6989586621684568337"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684568334"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684568333"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-1162"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CmpOp
</span><a href="#local-6989586621684568335"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1163"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#CmpEq"><span class="hs-identifier hs-type">CmpEq</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568330"><span class="hs-identifier hs-var">simple</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;==&quot;</span></span><span>
</span><span id="line-1164"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#FCmpLt"><span class="hs-identifier hs-type">FCmpLt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568330"><span class="hs-identifier hs-var">simple</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&lt;&quot;</span></span><span>
</span><span id="line-1165"></span><span>    </span><span class="annot"><a href="Futhark.IR.Primitive.html#FCmpLe"><span class="hs-identifier hs-type">FCmpLe</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568330"><span class="hs-identifier hs-var">simple</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&lt;=&quot;</span></span><span>
</span><span id="line-1166"></span><span>    </span><span class="annot"><span class="annottext">CmpOp
</span><a href="Futhark.IR.Primitive.html#CmpLlt"><span class="hs-identifier hs-var">CmpLlt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568330"><span class="hs-identifier hs-var">simple</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&lt;&quot;</span></span><span>
</span><span id="line-1167"></span><span>    </span><span class="annot"><span class="annottext">CmpOp
</span><a href="Futhark.IR.Primitive.html#CmpLle"><span class="hs-identifier hs-var">CmpLle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m PyExp
</span><a href="#local-6989586621684568330"><span class="hs-identifier hs-var">simple</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&lt;=&quot;</span></span><span>
</span><span id="line-1168"></span><span>    </span><span class="annot"><span class="annottext">CmpOp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; m PyExp
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; m PyExp) -&gt; PyExp -&gt; m PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmpOp -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">CmpOp
</span><a href="#local-6989586621684568335"><span class="hs-identifier hs-var">cmp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568332"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568331"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1169"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimExp"><span class="hs-identifier hs-var">compilePrimExp</span></a></span><span> </span><span id="local-6989586621684568324"><span class="annot"><span class="annottext">v -&gt; m PyExp
</span><a href="#local-6989586621684568324"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.PrimExp.html#UnOpExp"><span class="hs-identifier hs-type">Imp.UnOpExp</span></a></span><span> </span><span id="local-6989586621684568322"><span class="annot"><span class="annottext">UnOp
</span><a href="#local-6989586621684568322"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621684568321"><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684568321"><span class="hs-identifier hs-var">exp1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1170"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#UnOp"><span class="hs-identifier hs-var">UnOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnOp -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileUnOp"><span class="hs-identifier hs-var">compileUnOp</span></a></span><span> </span><span class="annot"><span class="annottext">UnOp
</span><a href="#local-6989586621684568322"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyExp) -&gt; m PyExp -&gt; m PyExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(v -&gt; m PyExp) -&gt; PrimExp v -&gt; m PyExp
forall (m :: * -&gt; *) v.
Monad m =&gt;
(v -&gt; m PyExp) -&gt; PrimExp v -&gt; m PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimExp"><span class="hs-identifier hs-var">compilePrimExp</span></a></span><span> </span><span class="annot"><span class="annottext">v -&gt; m PyExp
</span><a href="#local-6989586621684568324"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">PrimExp v
</span><a href="#local-6989586621684568321"><span class="hs-identifier hs-var">exp1</span></a></span><span>
</span><span id="line-1171"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimExp"><span class="hs-identifier hs-var">compilePrimExp</span></a></span><span> </span><span id="local-6989586621684568320"><span class="annot"><span class="annottext">v -&gt; m PyExp
</span><a href="#local-6989586621684568320"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.PrimExp.html#FunExp"><span class="hs-identifier hs-type">Imp.FunExp</span></a></span><span> </span><span id="local-6989586621684568318"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568318"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621684568317"><span class="annot"><span class="annottext">[PrimExp v]
</span><a href="#local-6989586621684568317"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1172"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#futharkFun"><span class="hs-identifier hs-var">futharkFun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568318"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([PyExp] -&gt; PyExp) -&gt; m [PyExp] -&gt; m PyExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(PrimExp v -&gt; m PyExp) -&gt; [PrimExp v] -&gt; m [PyExp]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(v -&gt; m PyExp) -&gt; PrimExp v -&gt; m PyExp
forall (m :: * -&gt; *) v.
Monad m =&gt;
(v -&gt; m PyExp) -&gt; PrimExp v -&gt; m PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimExp"><span class="hs-identifier hs-var">compilePrimExp</span></a></span><span> </span><span class="annot"><span class="annottext">v -&gt; m PyExp
</span><a href="#local-6989586621684568320"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PrimExp v]
</span><a href="#local-6989586621684568317"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1173"></span><span>
</span><span id="line-1174"></span><span id="local-6989586621684569505"><span id="local-6989586621684569506"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-type">compileExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Exp"><span class="hs-identifier hs-type">Imp.Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569506"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569505"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span></span></span><span>
</span><span id="line-1175"></span><span id="compileExp"><span class="annot"><span class="annottext">compileExp :: forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var hs-var">compileExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; CompilerM op s PyExp) -&gt; Exp -&gt; CompilerM op s PyExp
forall (m :: * -&gt; *) v.
Monad m =&gt;
(v -&gt; m PyExp) -&gt; PrimExp v -&gt; m PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimExp"><span class="hs-identifier hs-var">compilePrimExp</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span>
</span><span id="line-1176"></span><span>
</span><span id="line-1177"></span><span id="local-6989586621684569500"><span id="local-6989586621684569501"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#errorMsgString"><span class="hs-identifier hs-type">errorMsgString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ErrorMsg"><span class="hs-identifier hs-type">Imp.ErrorMsg</span></a></span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Exp"><span class="hs-identifier hs-type">Imp.Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569501"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569500"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#PyExp"><span class="hs-identifier hs-type">PyExp</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1178"></span><span id="errorMsgString"><span class="annot"><span class="annottext">errorMsgString :: forall op s. ErrorMsg Exp -&gt; CompilerM op s ([Char], [PyExp])
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#errorMsgString"><span class="hs-identifier hs-var hs-var">errorMsgString</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ErrorMsg"><span class="hs-identifier hs-type">Imp.ErrorMsg</span></a></span><span> </span><span id="local-6989586621684568306"><span class="annot"><span class="annottext">[ErrorMsgPart Exp]
</span><a href="#local-6989586621684568306"><span class="hs-identifier hs-var">parts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1179"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568294"><span class="annot"><span class="annottext">onPart :: ErrorMsgPart Exp -&gt; CompilerM op s (a, PyExp)
</span><a href="#local-6989586621684568294"><span class="hs-identifier hs-var hs-var">onPart</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ErrorString"><span class="hs-identifier hs-type">Imp.ErrorString</span></a></span><span> </span><span id="local-6989586621684568292"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568292"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, PyExp) -&gt; CompilerM op s (a, PyExp)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;%s&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568292"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1180"></span><span>      </span><span class="annot"><a href="#local-6989586621684568294"><span class="hs-identifier hs-var">onPart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ErrorVal"><span class="hs-identifier hs-type">Imp.ErrorVal</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span id="local-6989586621684568290"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568290"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;%d&quot;</span></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; (a, PyExp))
-&gt; CompilerM op s PyExp -&gt; CompilerM op s (a, PyExp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568290"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1181"></span><span>      </span><span class="annot"><a href="#local-6989586621684568294"><span class="hs-identifier hs-var">onPart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ErrorVal"><span class="hs-identifier hs-type">Imp.ErrorVal</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span id="local-6989586621684568289"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568289"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;%f&quot;</span></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; (a, PyExp))
-&gt; CompilerM op s PyExp -&gt; CompilerM op s (a, PyExp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568289"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1182"></span><span>      </span><span class="annot"><a href="#local-6989586621684568294"><span class="hs-identifier hs-var">onPart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ErrorVal"><span class="hs-identifier hs-type">Imp.ErrorVal</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Primitive.html#Bool"><span class="hs-identifier hs-var">Imp.Bool</span></a></span><span> </span><span id="local-6989586621684568288"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568288"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;%r&quot;</span></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; (a, PyExp))
-&gt; CompilerM op s PyExp -&gt; CompilerM op s (a, PyExp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568288"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1183"></span><span>      </span><span class="annot"><a href="#local-6989586621684568294"><span class="hs-identifier hs-var">onPart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#ErrorVal"><span class="hs-identifier hs-type">Imp.ErrorVal</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span id="local-6989586621684568287"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568287"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;%r&quot;</span></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; (a, PyExp))
-&gt; CompilerM op s PyExp -&gt; CompilerM op s (a, PyExp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568287"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1184"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684568286"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568286"><span class="hs-identifier hs-var">formatstrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568285"><span class="annot"><span class="annottext">[PyExp]
</span><a href="#local-6989586621684568285"><span class="hs-identifier hs-var">formatargs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[([Char], PyExp)] -&gt; ([[Char]], [PyExp])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([([Char], PyExp)] -&gt; ([[Char]], [PyExp]))
-&gt; CompilerM op s [([Char], PyExp)]
-&gt; CompilerM op s ([[Char]], [PyExp])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(ErrorMsgPart Exp -&gt; CompilerM op s ([Char], PyExp))
-&gt; [ErrorMsgPart Exp] -&gt; CompilerM op s [([Char], PyExp)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">ErrorMsgPart Exp -&gt; CompilerM op s ([Char], PyExp)
forall {a} {op} {s}.
IsString a =&gt;
ErrorMsgPart Exp -&gt; CompilerM op s (a, PyExp)
</span><a href="#local-6989586621684568294"><span class="hs-identifier hs-var">onPart</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrorMsgPart Exp]
</span><a href="#local-6989586621684568306"><span class="hs-identifier hs-var">parts</span></a></span><span>
</span><span id="line-1185"></span><span>  </span><span class="annot"><span class="annottext">([Char], [PyExp]) -&gt; CompilerM op s ([Char], [PyExp])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621684568286"><span class="hs-identifier hs-var">formatstrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PyExp]
</span><a href="#local-6989586621684568285"><span class="hs-identifier hs-var">formatargs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1186"></span><span>
</span><span id="line-1187"></span><span id="local-6989586621684569608"><span id="local-6989586621684569609"><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-type">compileCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Code"><span class="hs-identifier hs-type">Imp.Code</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569609"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#CompilerM"><span class="hs-identifier hs-type">CompilerM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569609"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684569608"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1188"></span><span id="compileCode"><span class="annot"><span class="annottext">compileCode :: forall op s. Code op -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var hs-var">compileCode</span></a></span></span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#DebugPrint"><span class="hs-identifier hs-type">Imp.DebugPrint</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1189"></span><span>  </span><span class="annot"><span class="annottext">() -&gt; CompilerM op s ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1190"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#TracePrint"><span class="hs-identifier hs-type">Imp.TracePrint</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1191"></span><span>  </span><span class="annot"><span class="annottext">() -&gt; CompilerM op s ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1192"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Op"><span class="hs-identifier hs-type">Imp.Op</span></a></span><span> </span><span id="local-6989586621684568154"><span class="annot"><span class="annottext">op
</span><a href="#local-6989586621684568154"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1193"></span><span>  </span><span class="annot"><span class="annottext">CompilerM op s (CompilerM op s ()) -&gt; CompilerM op s ()
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">(CompilerM op s (CompilerM op s ()) -&gt; CompilerM op s ())
-&gt; CompilerM op s (CompilerM op s ()) -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(CompilerEnv op s -&gt; OpCompiler op s)
-&gt; CompilerM op s (OpCompiler op s)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">CompilerEnv op s -&gt; OpCompiler op s
forall op s. CompilerEnv op s -&gt; OpCompiler op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envOpCompiler"><span class="hs-identifier hs-var">envOpCompiler</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerM op s (OpCompiler op s)
-&gt; CompilerM op s op -&gt; CompilerM op s (CompilerM op s ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">op -&gt; CompilerM op s op
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">op
</span><a href="#local-6989586621684568154"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-1194"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#If"><span class="hs-identifier hs-type">Imp.If</span></a></span><span> </span><span id="local-6989586621684568152"><span class="annot"><span class="annottext">TExp Bool
</span><a href="#local-6989586621684568152"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span id="local-6989586621684568151"><span class="annot"><span class="annottext">Code op
</span><a href="#local-6989586621684568151"><span class="hs-identifier hs-var">tb</span></a></span></span><span> </span><span id="local-6989586621684568150"><span class="annot"><span class="annottext">Code op
</span><a href="#local-6989586621684568150"><span class="hs-identifier hs-var">fb</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1195"></span><span>  </span><span id="local-6989586621684568149"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568149"><span class="hs-identifier hs-var">cond'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; CompilerM op s PyExp) -&gt; Exp -&gt; CompilerM op s PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TExp Bool -&gt; Exp
forall t v. TPrimExp t v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#untyped"><span class="hs-identifier hs-var hs-var">Imp.untyped</span></a></span><span> </span><span class="annot"><span class="annottext">TExp Bool
</span><a href="#local-6989586621684568152"><span class="hs-identifier hs-var">cond</span></a></span><span>
</span><span id="line-1196"></span><span>  </span><span id="local-6989586621684568147"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568147"><span class="hs-identifier hs-var">tb'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompilerM op s () -&gt; CompilerM op s [PyStmt]
forall op s. CompilerM op s () -&gt; CompilerM op s [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#collect"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="annot"><span class="annottext">(CompilerM op s () -&gt; CompilerM op s [PyStmt])
-&gt; CompilerM op s () -&gt; CompilerM op s [PyStmt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code op -&gt; CompilerM op s ()
forall op s. Code op -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="annot"><span class="annottext">Code op
</span><a href="#local-6989586621684568151"><span class="hs-identifier hs-var">tb</span></a></span><span>
</span><span id="line-1197"></span><span>  </span><span id="local-6989586621684568146"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568146"><span class="hs-identifier hs-var">fb'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompilerM op s () -&gt; CompilerM op s [PyStmt]
forall op s. CompilerM op s () -&gt; CompilerM op s [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#collect"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="annot"><span class="annottext">(CompilerM op s () -&gt; CompilerM op s [PyStmt])
-&gt; CompilerM op s () -&gt; CompilerM op s [PyStmt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code op -&gt; CompilerM op s ()
forall op s. Code op -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="annot"><span class="annottext">Code op
</span><a href="#local-6989586621684568150"><span class="hs-identifier hs-var">fb</span></a></span><span>
</span><span id="line-1198"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; [PyStmt] -&gt; [PyStmt] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#If"><span class="hs-identifier hs-var">If</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568149"><span class="hs-identifier hs-var">cond'</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568147"><span class="hs-identifier hs-var">tb'</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568146"><span class="hs-identifier hs-var">fb'</span></a></span><span>
</span><span id="line-1199"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684568145"><span class="annot"><span class="annottext">Code op
</span><a href="#local-6989586621684568145"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#%3A%3E%3E%3A"><span class="hs-operator hs-type">Imp.:&gt;&gt;:</span></a></span><span> </span><span id="local-6989586621684568143"><span class="annot"><span class="annottext">Code op
</span><a href="#local-6989586621684568143"><span class="hs-identifier hs-var">c2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1200"></span><span>  </span><span class="annot"><span class="annottext">Code op -&gt; CompilerM op s ()
forall op s. Code op -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="annot"><span class="annottext">Code op
</span><a href="#local-6989586621684568145"><span class="hs-identifier hs-var">c1</span></a></span><span>
</span><span id="line-1201"></span><span>  </span><span class="annot"><span class="annottext">Code op -&gt; CompilerM op s ()
forall op s. Code op -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="annot"><span class="annottext">Code op
</span><a href="#local-6989586621684568143"><span class="hs-identifier hs-var">c2</span></a></span><span>
</span><span id="line-1202"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#While"><span class="hs-identifier hs-type">Imp.While</span></a></span><span> </span><span id="local-6989586621684568141"><span class="annot"><span class="annottext">TExp Bool
</span><a href="#local-6989586621684568141"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span id="local-6989586621684568140"><span class="annot"><span class="annottext">Code op
</span><a href="#local-6989586621684568140"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1203"></span><span>  </span><span id="local-6989586621684568139"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568139"><span class="hs-identifier hs-var">cond'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; CompilerM op s PyExp) -&gt; Exp -&gt; CompilerM op s PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TExp Bool -&gt; Exp
forall t v. TPrimExp t v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#untyped"><span class="hs-identifier hs-var hs-var">Imp.untyped</span></a></span><span> </span><span class="annot"><span class="annottext">TExp Bool
</span><a href="#local-6989586621684568141"><span class="hs-identifier hs-var">cond</span></a></span><span>
</span><span id="line-1204"></span><span>  </span><span id="local-6989586621684568138"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568138"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompilerM op s () -&gt; CompilerM op s [PyStmt]
forall op s. CompilerM op s () -&gt; CompilerM op s [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#collect"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="annot"><span class="annottext">(CompilerM op s () -&gt; CompilerM op s [PyStmt])
-&gt; CompilerM op s () -&gt; CompilerM op s [PyStmt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code op -&gt; CompilerM op s ()
forall op s. Code op -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="annot"><span class="annottext">Code op
</span><a href="#local-6989586621684568140"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1205"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; [PyStmt] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#While"><span class="hs-identifier hs-var">While</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568139"><span class="hs-identifier hs-var">cond'</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568138"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-1206"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#For"><span class="hs-identifier hs-type">Imp.For</span></a></span><span> </span><span id="local-6989586621684568135"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568135"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621684568134"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568134"><span class="hs-identifier hs-var">bound</span></a></span></span><span> </span><span id="local-6989586621684568133"><span class="annot"><span class="annottext">Code op
</span><a href="#local-6989586621684568133"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1207"></span><span>  </span><span id="local-6989586621684568132"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568132"><span class="hs-identifier hs-var">bound'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568134"><span class="hs-identifier hs-var">bound</span></a></span><span>
</span><span id="line-1208"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568131"><span class="annot"><span class="annottext">i' :: [Char]
</span><a href="#local-6989586621684568131"><span class="hs-identifier hs-var hs-var">i'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileName"><span class="hs-identifier hs-var">compileName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568135"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1209"></span><span>  </span><span id="local-6989586621684568130"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568130"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompilerM op s () -&gt; CompilerM op s [PyStmt]
forall op s. CompilerM op s () -&gt; CompilerM op s [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#collect"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="annot"><span class="annottext">(CompilerM op s () -&gt; CompilerM op s [PyStmt])
-&gt; CompilerM op s () -&gt; CompilerM op s [PyStmt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code op -&gt; CompilerM op s ()
forall op s. Code op -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="annot"><span class="annottext">Code op
</span><a href="#local-6989586621684568133"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1210"></span><span>  </span><span id="local-6989586621684568129"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568129"><span class="hs-identifier hs-var">counter</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; [Char]) -&gt; CompilerM op s VName -&gt; CompilerM op s [Char]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; CompilerM op s VName
forall (m :: * -&gt; *). MonadFreshNames m =&gt; [Char] -&gt; m VName
</span><a href="Futhark.MonadFreshNames.html#newVName"><span class="hs-identifier hs-var">newVName</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;counter&quot;</span></span><span>
</span><span id="line-1211"></span><span>  </span><span id="local-6989586621684568128"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568128"><span class="hs-identifier hs-var">one</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; [Char]) -&gt; CompilerM op s VName -&gt; CompilerM op s [Char]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; CompilerM op s VName
forall (m :: * -&gt; *). MonadFreshNames m =&gt; [Char] -&gt; m VName
</span><a href="Futhark.MonadFreshNames.html#newVName"><span class="hs-identifier hs-var">newVName</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;one&quot;</span></span><span>
</span><span id="line-1212"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568131"><span class="hs-identifier hs-var">i'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimToNp"><span class="hs-identifier hs-var">compilePrimToNp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; PrimType
forall v. PrimExp v -&gt; PrimType
</span><a href="Futhark.Analysis.PrimExp.html#primExpType"><span class="hs-identifier hs-var">Imp.primExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568134"><span class="hs-identifier hs-var">bound</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span>
</span><span id="line-1213"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568128"><span class="hs-identifier hs-var">one</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimToNp"><span class="hs-identifier hs-var">compilePrimToNp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; PrimType
forall v. PrimExp v -&gt; PrimType
</span><a href="Futhark.Analysis.PrimExp.html#primExpType"><span class="hs-identifier hs-var">Imp.primExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568134"><span class="hs-identifier hs-var">bound</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-1214"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1215"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; [PyStmt] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#For"><span class="hs-identifier hs-var">For</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568129"><span class="hs-identifier hs-var">counter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;range&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568132"><span class="hs-identifier hs-var">bound'</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([PyStmt] -&gt; PyStmt) -&gt; [PyStmt] -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1216"></span><span>      </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568130"><span class="hs-identifier hs-var">body'</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt] -&gt; [PyStmt] -&gt; [PyStmt]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#AssignOp"><span class="hs-identifier hs-var">AssignOp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;+&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568131"><span class="hs-identifier hs-var">i'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568128"><span class="hs-identifier hs-var">one</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1217"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#SetScalar"><span class="hs-identifier hs-type">Imp.SetScalar</span></a></span><span> </span><span id="local-6989586621684568124"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568124"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621684568123"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568123"><span class="hs-identifier hs-var">exp1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1218"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ())
-&gt; CompilerM op s PyStmt -&gt; CompilerM op s ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyExp -&gt; PyStmt)
-&gt; CompilerM op s PyExp -&gt; CompilerM op s (PyExp -&gt; PyStmt)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568124"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerM op s (PyExp -&gt; PyStmt)
-&gt; CompilerM op s PyExp -&gt; CompilerM op s PyStmt
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568123"><span class="hs-identifier hs-var">exp1</span></a></span><span>
</span><span id="line-1219"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#DeclareMem"><span class="hs-identifier hs-type">Imp.DeclareMem</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; CompilerM op s ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1220"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#DeclareScalar"><span class="hs-identifier hs-type">Imp.DeclareScalar</span></a></span><span> </span><span id="local-6989586621684568120"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568120"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">Volatility
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Primitive.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1221"></span><span>  </span><span id="local-6989586621684568119"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568119"><span class="hs-identifier hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568120"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1222"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568119"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;True&quot;</span></span><span>
</span><span id="line-1223"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#DeclareScalar"><span class="hs-identifier hs-type">Imp.DeclareScalar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; CompilerM op s ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1224"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#DeclareArray"><span class="hs-identifier hs-type">Imp.DeclareArray</span></a></span><span> </span><span id="local-6989586621684568117"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568117"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Space"><span class="hs-identifier hs-type">Space</span></a></span><span> </span><span id="local-6989586621684568116"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568116"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684568115"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568115"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621684568114"><span class="annot"><span class="annottext">ArrayContents
</span><a href="#local-6989586621684568114"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1225"></span><span>  </span><span class="annot"><span class="annottext">CompilerM op s (CompilerM op s ()) -&gt; CompilerM op s ()
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">(CompilerM op s (CompilerM op s ()) -&gt; CompilerM op s ())
-&gt; CompilerM op s (CompilerM op s ()) -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1226"></span><span>    </span><span class="annot"><span class="annottext">(CompilerEnv op s -&gt; StaticArray op s)
-&gt; CompilerM op s (StaticArray op s)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">CompilerEnv op s -&gt; StaticArray op s
forall op s. CompilerEnv op s -&gt; StaticArray op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envStaticArray"><span class="hs-identifier hs-var">envStaticArray</span></a></span><span>
</span><span id="line-1227"></span><span>      </span><span class="annot"><span class="annottext">CompilerM op s (StaticArray op s)
-&gt; CompilerM op s VName
-&gt; CompilerM
     op s ([Char] -&gt; PrimType -&gt; ArrayContents -&gt; CompilerM op s ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s VName
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568117"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1228"></span><span>      </span><span class="annot"><span class="annottext">CompilerM
  op s ([Char] -&gt; PrimType -&gt; ArrayContents -&gt; CompilerM op s ())
-&gt; CompilerM op s [Char]
-&gt; CompilerM op s (PrimType -&gt; ArrayContents -&gt; CompilerM op s ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; CompilerM op s [Char]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568116"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-1229"></span><span>      </span><span class="annot"><span class="annottext">CompilerM op s (PrimType -&gt; ArrayContents -&gt; CompilerM op s ())
-&gt; CompilerM op s PrimType
-&gt; CompilerM op s (ArrayContents -&gt; CompilerM op s ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; CompilerM op s PrimType
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568115"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1230"></span><span>      </span><span class="annot"><span class="annottext">CompilerM op s (ArrayContents -&gt; CompilerM op s ())
-&gt; CompilerM op s ArrayContents
-&gt; CompilerM op s (CompilerM op s ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">ArrayContents -&gt; CompilerM op s ArrayContents
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ArrayContents
</span><a href="#local-6989586621684568114"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-1231"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#DeclareArray"><span class="hs-identifier hs-type">Imp.DeclareArray</span></a></span><span> </span><span id="local-6989586621684568113"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568113"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568112"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568112"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621684568111"><span class="annot"><span class="annottext">ArrayContents
</span><a href="#local-6989586621684568111"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1232"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568107"><span class="annot"><span class="annottext">arr_name :: [Char]
</span><a href="#local-6989586621684568107"><span class="hs-identifier hs-var hs-var">arr_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileName"><span class="hs-identifier hs-var">compileName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568113"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;_arr&quot;</span></span><span>
</span><span id="line-1233"></span><span>  </span><span class="hs-comment">-- It is important to store the Numpy array in a temporary variable</span><span>
</span><span id="line-1234"></span><span>  </span><span class="hs-comment">-- to prevent it from going &quot;out-of-scope&quot; before calling</span><span>
</span><span id="line-1235"></span><span>  </span><span class="hs-comment">-- unwrapArray (which internally uses the .ctype method); see</span><span>
</span><span id="line-1236"></span><span>  </span><span class="hs-comment">-- https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.ctypes.html</span><span>
</span><span id="line-1237"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#atInit"><span class="hs-identifier hs-var">atInit</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1238"></span><span>    </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp -&gt; [Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Field"><span class="hs-identifier hs-var">Field</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;self&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568107"><span class="hs-identifier hs-var">arr_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ArrayContents
</span><a href="#local-6989586621684568111"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1239"></span><span>      </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ArrayValues"><span class="hs-identifier hs-type">Imp.ArrayValues</span></a></span><span> </span><span id="local-6989586621684568105"><span class="annot"><span class="annottext">[PrimValue]
</span><a href="#local-6989586621684568105"><span class="hs-identifier hs-var">vs'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1240"></span><span>        </span><span class="annot"><span class="annottext">PyExp -&gt; [PyArg] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Call"><span class="hs-identifier hs-var">Call</span></a></span><span>
</span><span id="line-1241"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.array&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1242"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyArg) -&gt; PyExp -&gt; PyArg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#List"><span class="hs-identifier hs-var">List</span></a></span><span> </span><span class="annot"><span class="annottext">([PyExp] -&gt; PyExp) -&gt; [PyExp] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PrimValue -&gt; PyExp) -&gt; [PrimValue] -&gt; [PyExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PrimValue -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimValue"><span class="hs-identifier hs-var">compilePrimValue</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimValue]
</span><a href="#local-6989586621684568105"><span class="hs-identifier hs-var">vs'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1243"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#ArgKeyword"><span class="hs-identifier hs-var">ArgKeyword</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;dtype&quot;</span></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyArg) -&gt; PyExp -&gt; PyArg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [Char] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimToNp"><span class="hs-identifier hs-var">compilePrimToNp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568112"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1244"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1245"></span><span>      </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ArrayZeros"><span class="hs-identifier hs-type">Imp.ArrayZeros</span></a></span><span> </span><span id="local-6989586621684568103"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568103"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1246"></span><span>        </span><span class="annot"><span class="annottext">PyExp -&gt; [PyArg] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Call"><span class="hs-identifier hs-var">Call</span></a></span><span>
</span><span id="line-1247"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;np.zeros&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1248"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyArg) -&gt; PyExp -&gt; PyArg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Integer"><span class="hs-identifier hs-var">Integer</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; PyExp) -&gt; Integer -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684568103"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1249"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyArg
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#ArgKeyword"><span class="hs-identifier hs-var">ArgKeyword</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;dtype&quot;</span></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyArg) -&gt; PyExp -&gt; PyArg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [Char] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimToNp"><span class="hs-identifier hs-var">compilePrimToNp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568112"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1250"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1251"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#atInit"><span class="hs-identifier hs-var">atInit</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1252"></span><span>    </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PyExp -&gt; [Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Field"><span class="hs-identifier hs-var">Field</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;self&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileName"><span class="hs-identifier hs-var">compileName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568113"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1253"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;unwrapArray&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp -&gt; [Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Field"><span class="hs-identifier hs-var">Field</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;self&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568107"><span class="hs-identifier hs-var">arr_name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1254"></span><span>  </span><span id="local-6989586621684568102"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568102"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568113"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1255"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568102"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; [Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Field"><span class="hs-identifier hs-var">Field</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;self&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileName"><span class="hs-identifier hs-var">compileName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568113"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1256"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Comment"><span class="hs-identifier hs-type">Imp.Comment</span></a></span><span> </span><span id="local-6989586621684568100"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568100"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621684568099"><span class="annot"><span class="annottext">Code op
</span><a href="#local-6989586621684568099"><span class="hs-identifier hs-var">code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1257"></span><span>  </span><span id="local-6989586621684568098"><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568098"><span class="hs-identifier hs-var">code'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompilerM op s () -&gt; CompilerM op s [PyStmt]
forall op s. CompilerM op s () -&gt; CompilerM op s [PyStmt]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#collect"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="annot"><span class="annottext">(CompilerM op s () -&gt; CompilerM op s [PyStmt])
-&gt; CompilerM op s () -&gt; CompilerM op s [PyStmt]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code op -&gt; CompilerM op s ()
forall op s. Code op -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="annot"><span class="annottext">Code op
</span><a href="#local-6989586621684568099"><span class="hs-identifier hs-var">code</span></a></span><span>
</span><span id="line-1258"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyStmt] -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Comment"><span class="hs-identifier hs-var">Comment</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568100"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">[PyStmt]
</span><a href="#local-6989586621684568098"><span class="hs-identifier hs-var">code'</span></a></span><span>
</span><span id="line-1259"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Assert"><span class="hs-identifier hs-type">Imp.Assert</span></a></span><span> </span><span id="local-6989586621684568095"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568095"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684568094"><span class="annot"><span class="annottext">ErrorMsg Exp
</span><a href="#local-6989586621684568094"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684568093"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684568093"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568092"><span class="annot"><span class="annottext">[SrcLoc]
</span><a href="#local-6989586621684568092"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1260"></span><span>  </span><span id="local-6989586621684568091"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568091"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568095"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1261"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684568090"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568090"><span class="hs-identifier hs-var">formatstr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684568089"><span class="annot"><span class="annottext">[PyExp]
</span><a href="#local-6989586621684568089"><span class="hs-identifier hs-var">formatargs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ErrorMsg Exp -&gt; CompilerM op s ([Char], [PyExp])
forall op s. ErrorMsg Exp -&gt; CompilerM op s ([Char], [PyExp])
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#errorMsgString"><span class="hs-identifier hs-var">errorMsgString</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMsg Exp
</span><a href="#local-6989586621684568094"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1262"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1263"></span><span>    </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assert"><span class="hs-identifier hs-var">Assert</span></a></span><span>
</span><span id="line-1264"></span><span>      </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568091"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-1265"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span>
</span><span id="line-1266"></span><span>          </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;%&quot;</span></span><span>
</span><span id="line-1267"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PyExp) -&gt; [Char] -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Error: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568090"><span class="hs-identifier hs-var">formatstr</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\n\nBacktrace:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568088"><span class="hs-identifier hs-var">stacktrace</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1268"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Tuple"><span class="hs-identifier hs-var">Tuple</span></a></span><span> </span><span class="annot"><span class="annottext">[PyExp]
</span><a href="#local-6989586621684568089"><span class="hs-identifier hs-var">formatargs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1269"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-1270"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1271"></span><span>    </span><span id="local-6989586621684568088"><span class="annot"><span class="annottext">stacktrace :: [Char]
</span><a href="#local-6989586621684568088"><span class="hs-identifier hs-var hs-var">stacktrace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [[Char]] -&gt; [Char]
</span><a href="Language.Futhark.Core.html#prettyStacktrace"><span class="hs-identifier hs-var">prettyStacktrace</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">([[Char]] -&gt; [Char]) -&gt; [[Char]] -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(SrcLoc -&gt; [Char]) -&gt; [SrcLoc] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; [Char]
forall a. Located a =&gt; a -&gt; [Char]
</span><a href="Language.Futhark.Core.html#locStr"><span class="hs-identifier hs-var">locStr</span></a></span><span> </span><span class="annot"><span class="annottext">([SrcLoc] -&gt; [[Char]]) -&gt; [SrcLoc] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684568093"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; [SrcLoc] -&gt; [SrcLoc]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[SrcLoc]
</span><a href="#local-6989586621684568092"><span class="hs-identifier hs-var">locs</span></a></span><span>
</span><span id="line-1272"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Call"><span class="hs-identifier hs-type">Imp.Call</span></a></span><span> </span><span id="local-6989586621684568082"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684568082"><span class="hs-identifier hs-var">dests</span></a></span></span><span> </span><span id="local-6989586621684568081"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684568081"><span class="hs-identifier hs-var">fname</span></a></span></span><span> </span><span id="local-6989586621684568080"><span class="annot"><span class="annottext">[Arg]
</span><a href="#local-6989586621684568080"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1273"></span><span>  </span><span id="local-6989586621684568079"><span class="annot"><span class="annottext">[PyExp]
</span><a href="#local-6989586621684568079"><span class="hs-identifier hs-var">args'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Arg -&gt; CompilerM op s PyExp) -&gt; [Arg] -&gt; CompilerM op s [PyExp]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Arg -&gt; CompilerM op s PyExp
forall {op} {s}. Arg -&gt; CompilerM op s PyExp
</span><a href="#local-6989586621684568078"><span class="hs-identifier hs-var">compileArg</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg]
</span><a href="#local-6989586621684568080"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1274"></span><span>  </span><span id="local-6989586621684568077"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568077"><span class="hs-identifier hs-var">dests'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#tupleOrSingle"><span class="hs-identifier hs-var">tupleOrSingle</span></a></span><span> </span><span class="annot"><span class="annottext">([PyExp] -&gt; PyExp)
-&gt; CompilerM op s [PyExp] -&gt; CompilerM op s PyExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; CompilerM op s PyExp)
-&gt; [VName] -&gt; CompilerM op s [PyExp]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684568082"><span class="hs-identifier hs-var">dests</span></a></span><span>
</span><span id="line-1275"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568072"><span class="annot"><span class="annottext">fname' :: [Char]
</span><a href="#local-6989586621684568072"><span class="hs-identifier hs-var hs-var">fname'</span></a></span></span><span>
</span><span id="line-1276"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="Futhark.IR.Prop.html#isBuiltInFunction"><span class="hs-identifier hs-var">isBuiltInFunction</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684568081"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#futharkFun"><span class="hs-identifier hs-var">futharkFun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684568081"><span class="hs-identifier hs-var">fname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1277"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;self.&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#futharkFun"><span class="hs-identifier hs-var">futharkFun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684568081"><span class="hs-identifier hs-var">fname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1278"></span><span>      </span><span id="local-6989586621684568071"><span class="annot"><span class="annottext">call' :: PyExp
</span><a href="#local-6989586621684568071"><span class="hs-identifier hs-var hs-var">call'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568072"><span class="hs-identifier hs-var">fname'</span></a></span><span> </span><span class="annot"><span class="annottext">[PyExp]
</span><a href="#local-6989586621684568079"><span class="hs-identifier hs-var">args'</span></a></span><span>
</span><span id="line-1279"></span><span>  </span><span class="hs-comment">-- If the function returns nothing (is called only for side</span><span>
</span><span id="line-1280"></span><span>  </span><span class="hs-comment">-- effects), take care not to assign to an empty tuple.</span><span>
</span><span id="line-1281"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1282"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684568082"><span class="hs-identifier hs-var">dests</span></a></span><span>
</span><span id="line-1283"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568071"><span class="hs-identifier hs-var">call'</span></a></span><span>
</span><span id="line-1284"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568077"><span class="hs-identifier hs-var">dests'</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568071"><span class="hs-identifier hs-var">call'</span></a></span><span>
</span><span id="line-1285"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1286"></span><span>    </span><span id="local-6989586621684568078"><span class="annot"><span class="annottext">compileArg :: Arg -&gt; CompilerM op s PyExp
</span><a href="#local-6989586621684568078"><span class="hs-identifier hs-var hs-var">compileArg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#MemArg"><span class="hs-identifier hs-type">Imp.MemArg</span></a></span><span> </span><span id="local-6989586621684568068"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568068"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568068"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1287"></span><span>    </span><span class="annot"><a href="#local-6989586621684568078"><span class="hs-identifier hs-var">compileArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ExpArg"><span class="hs-identifier hs-type">Imp.ExpArg</span></a></span><span> </span><span id="local-6989586621684568066"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568066"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568066"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1288"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#SetMem"><span class="hs-identifier hs-type">Imp.SetMem</span></a></span><span> </span><span id="local-6989586621684568064"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568064"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span id="local-6989586621684568063"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568063"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1289"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ())
-&gt; CompilerM op s PyStmt -&gt; CompilerM op s ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyExp -&gt; PyStmt)
-&gt; CompilerM op s PyExp -&gt; CompilerM op s (PyExp -&gt; PyStmt)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568064"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerM op s (PyExp -&gt; PyStmt)
-&gt; CompilerM op s PyExp -&gt; CompilerM op s PyStmt
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568063"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1290"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Allocate"><span class="hs-identifier hs-type">Imp.Allocate</span></a></span><span> </span><span id="local-6989586621684568061"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568061"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Sizes.html#Count"><span class="hs-identifier hs-type">Imp.Count</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.PrimExp.html#TPrimExp"><span class="hs-identifier hs-type">Imp.TPrimExp</span></a></span><span> </span><span id="local-6989586621684568058"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568058"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Space"><span class="hs-identifier hs-type">Imp.Space</span></a></span><span> </span><span id="local-6989586621684568057"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568057"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1291"></span><span>  </span><span class="annot"><span class="annottext">CompilerM op s (CompilerM op s ()) -&gt; CompilerM op s ()
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">(CompilerM op s (CompilerM op s ()) -&gt; CompilerM op s ())
-&gt; CompilerM op s (CompilerM op s ()) -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1292"></span><span>    </span><span class="annot"><span class="annottext">(CompilerEnv op s -&gt; Allocate op s)
-&gt; CompilerM op s (Allocate op s)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">CompilerEnv op s -&gt; Allocate op s
forall op s. CompilerEnv op s -&gt; Allocate op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envAllocate"><span class="hs-identifier hs-var">envAllocate</span></a></span><span>
</span><span id="line-1293"></span><span>      </span><span class="annot"><span class="annottext">CompilerM op s (Allocate op s)
-&gt; CompilerM op s PyExp
-&gt; CompilerM op s (PyExp -&gt; [Char] -&gt; CompilerM op s ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568061"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1294"></span><span>      </span><span class="annot"><span class="annottext">CompilerM op s (PyExp -&gt; [Char] -&gt; CompilerM op s ())
-&gt; CompilerM op s PyExp
-&gt; CompilerM op s ([Char] -&gt; CompilerM op s ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568058"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1295"></span><span>      </span><span class="annot"><span class="annottext">CompilerM op s ([Char] -&gt; CompilerM op s ())
-&gt; CompilerM op s [Char] -&gt; CompilerM op s (CompilerM op s ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; CompilerM op s [Char]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568057"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-1296"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Allocate"><span class="hs-identifier hs-type">Imp.Allocate</span></a></span><span> </span><span id="local-6989586621684568056"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568056"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Sizes.html#Count"><span class="hs-identifier hs-type">Imp.Count</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.PrimExp.html#TPrimExp"><span class="hs-identifier hs-type">Imp.TPrimExp</span></a></span><span> </span><span id="local-6989586621684568055"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568055"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1297"></span><span>  </span><span id="local-6989586621684568054"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568054"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568055"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1298"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568053"><span class="annot"><span class="annottext">allocate' :: PyExp
</span><a href="#local-6989586621684568053"><span class="hs-identifier hs-var hs-var">allocate'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;allocateMem&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568054"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1299"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ())
-&gt; CompilerM op s PyStmt -&gt; CompilerM op s ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyExp -&gt; PyStmt)
-&gt; CompilerM op s PyExp -&gt; CompilerM op s (PyExp -&gt; PyStmt)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568056"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerM op s (PyExp -&gt; PyStmt)
-&gt; CompilerM op s PyExp -&gt; CompilerM op s PyStmt
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; CompilerM op s PyExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568053"><span class="hs-identifier hs-var">allocate'</span></a></span><span>
</span><span id="line-1300"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Free"><span class="hs-identifier hs-type">Imp.Free</span></a></span><span> </span><span id="local-6989586621684568051"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568051"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1301"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ())
-&gt; CompilerM op s PyStmt -&gt; CompilerM op s ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyExp -&gt; PyStmt)
-&gt; CompilerM op s PyExp -&gt; CompilerM op s (PyExp -&gt; PyStmt)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568051"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerM op s (PyExp -&gt; PyStmt)
-&gt; CompilerM op s PyExp -&gt; CompilerM op s PyStmt
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; CompilerM op s PyExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#None"><span class="hs-identifier hs-var">None</span></a></span><span>
</span><span id="line-1302"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Copy"><span class="hs-identifier hs-type">Imp.Copy</span></a></span><span> </span><span id="local-6989586621684568049"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568049"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Sizes.html#Count"><span class="hs-identifier hs-type">Imp.Count</span></a></span><span> </span><span id="local-6989586621684568048"><span class="annot"><span class="annottext">TExp Int64
</span><a href="#local-6989586621684568048"><span class="hs-identifier hs-var">destoffset</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="Futhark.IR.Syntax.Core.html#DefaultSpace"><span class="hs-identifier hs-var">DefaultSpace</span></a></span><span> </span><span id="local-6989586621684568047"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568047"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Sizes.html#Count"><span class="hs-identifier hs-type">Imp.Count</span></a></span><span> </span><span id="local-6989586621684568046"><span class="annot"><span class="annottext">TExp Int64
</span><a href="#local-6989586621684568046"><span class="hs-identifier hs-var">srcoffset</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="Futhark.IR.Syntax.Core.html#DefaultSpace"><span class="hs-identifier hs-var">DefaultSpace</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Sizes.html#Count"><span class="hs-identifier hs-type">Imp.Count</span></a></span><span> </span><span id="local-6989586621684568045"><span class="annot"><span class="annottext">TExp Int64
</span><a href="#local-6989586621684568045"><span class="hs-identifier hs-var">size</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1303"></span><span>  </span><span id="local-6989586621684568044"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568044"><span class="hs-identifier hs-var">destoffset'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; CompilerM op s PyExp) -&gt; Exp -&gt; CompilerM op s PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TExp Int64 -&gt; Exp
forall t v. TPrimExp t v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#untyped"><span class="hs-identifier hs-var hs-var">Imp.untyped</span></a></span><span> </span><span class="annot"><span class="annottext">TExp Int64
</span><a href="#local-6989586621684568048"><span class="hs-identifier hs-var">destoffset</span></a></span><span>
</span><span id="line-1304"></span><span>  </span><span id="local-6989586621684568043"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568043"><span class="hs-identifier hs-var">srcoffset'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; CompilerM op s PyExp) -&gt; Exp -&gt; CompilerM op s PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TExp Int64 -&gt; Exp
forall t v. TPrimExp t v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#untyped"><span class="hs-identifier hs-var hs-var">Imp.untyped</span></a></span><span> </span><span class="annot"><span class="annottext">TExp Int64
</span><a href="#local-6989586621684568046"><span class="hs-identifier hs-var">srcoffset</span></a></span><span>
</span><span id="line-1305"></span><span>  </span><span id="local-6989586621684568042"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568042"><span class="hs-identifier hs-var">dest'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568049"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-1306"></span><span>  </span><span id="local-6989586621684568041"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568041"><span class="hs-identifier hs-var">src'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568047"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1307"></span><span>  </span><span id="local-6989586621684568040"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568040"><span class="hs-identifier hs-var">size'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; CompilerM op s PyExp) -&gt; Exp -&gt; CompilerM op s PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TExp Int64 -&gt; Exp
forall t v. TPrimExp t v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#untyped"><span class="hs-identifier hs-var hs-var">Imp.untyped</span></a></span><span> </span><span class="annot"><span class="annottext">TExp Int64
</span><a href="#local-6989586621684568045"><span class="hs-identifier hs-var">size</span></a></span><span>
</span><span id="line-1308"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568039"><span class="annot"><span class="annottext">offset_call1 :: PyExp
</span><a href="#local-6989586621684568039"><span class="hs-identifier hs-var hs-var">offset_call1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;addressOffset&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568042"><span class="hs-identifier hs-var">dest'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568044"><span class="hs-identifier hs-var">destoffset'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_byte&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1309"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568038"><span class="annot"><span class="annottext">offset_call2 :: PyExp
</span><a href="#local-6989586621684568038"><span class="hs-identifier hs-var hs-var">offset_call2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;addressOffset&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568041"><span class="hs-identifier hs-var">src'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568043"><span class="hs-identifier hs-var">srcoffset'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.c_byte&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1310"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ct.memmove&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568039"><span class="hs-identifier hs-var">offset_call1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568038"><span class="hs-identifier hs-var">offset_call2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568040"><span class="hs-identifier hs-var">size'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1311"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Copy"><span class="hs-identifier hs-type">Imp.Copy</span></a></span><span> </span><span id="local-6989586621684568037"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568037"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Sizes.html#Count"><span class="hs-identifier hs-type">Imp.Count</span></a></span><span> </span><span id="local-6989586621684568036"><span class="annot"><span class="annottext">TExp Int64
</span><a href="#local-6989586621684568036"><span class="hs-identifier hs-var">destoffset</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684568035"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684568035"><span class="hs-identifier hs-var">destspace</span></a></span></span><span> </span><span id="local-6989586621684568034"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568034"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Sizes.html#Count"><span class="hs-identifier hs-type">Imp.Count</span></a></span><span> </span><span id="local-6989586621684568033"><span class="annot"><span class="annottext">TExp Int64
</span><a href="#local-6989586621684568033"><span class="hs-identifier hs-var">srcoffset</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684568032"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684568032"><span class="hs-identifier hs-var">srcspace</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Sizes.html#Count"><span class="hs-identifier hs-type">Imp.Count</span></a></span><span> </span><span id="local-6989586621684568031"><span class="annot"><span class="annottext">TExp Int64
</span><a href="#local-6989586621684568031"><span class="hs-identifier hs-var">size</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1312"></span><span>  </span><span id="local-6989586621684568030"><span class="annot"><span class="annottext">Copy op s
</span><a href="#local-6989586621684568030"><span class="hs-identifier hs-var">copy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CompilerEnv op s -&gt; Copy op s) -&gt; CompilerM op s (Copy op s)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">CompilerEnv op s -&gt; Copy op s
forall op s. CompilerEnv op s -&gt; Copy op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envCopy"><span class="hs-identifier hs-var">envCopy</span></a></span><span>
</span><span id="line-1313"></span><span>  </span><span class="annot"><span class="annottext">CompilerM op s (CompilerM op s ()) -&gt; CompilerM op s ()
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">(CompilerM op s (CompilerM op s ()) -&gt; CompilerM op s ())
-&gt; CompilerM op s (CompilerM op s ()) -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1314"></span><span>    </span><span class="annot"><span class="annottext">Copy op s
</span><a href="#local-6989586621684568030"><span class="hs-identifier hs-var">copy</span></a></span><span>
</span><span id="line-1315"></span><span>      </span><span class="annot"><span class="annottext">Copy op s
-&gt; CompilerM op s PyExp
-&gt; CompilerM
     op
     s
     (PyExp
      -&gt; Space
      -&gt; PyExp
      -&gt; PyExp
      -&gt; Space
      -&gt; PyExp
      -&gt; PrimType
      -&gt; CompilerM op s ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568037"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-1316"></span><span>      </span><span class="annot"><span class="annottext">CompilerM
  op
  s
  (PyExp
   -&gt; Space
   -&gt; PyExp
   -&gt; PyExp
   -&gt; Space
   -&gt; PyExp
   -&gt; PrimType
   -&gt; CompilerM op s ())
-&gt; CompilerM op s PyExp
-&gt; CompilerM
     op
     s
     (Space
      -&gt; PyExp
      -&gt; PyExp
      -&gt; Space
      -&gt; PyExp
      -&gt; PrimType
      -&gt; CompilerM op s ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TExp Int64 -&gt; Exp
forall t v. TPrimExp t v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#untyped"><span class="hs-identifier hs-var hs-var">Imp.untyped</span></a></span><span> </span><span class="annot"><span class="annottext">TExp Int64
</span><a href="#local-6989586621684568036"><span class="hs-identifier hs-var">destoffset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1317"></span><span>      </span><span class="annot"><span class="annottext">CompilerM
  op
  s
  (Space
   -&gt; PyExp
   -&gt; PyExp
   -&gt; Space
   -&gt; PyExp
   -&gt; PrimType
   -&gt; CompilerM op s ())
-&gt; CompilerM op s Space
-&gt; CompilerM
     op
     s
     (PyExp -&gt; PyExp -&gt; Space -&gt; PyExp -&gt; PrimType -&gt; CompilerM op s ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Space -&gt; CompilerM op s Space
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684568035"><span class="hs-identifier hs-var">destspace</span></a></span><span>
</span><span id="line-1318"></span><span>      </span><span class="annot"><span class="annottext">CompilerM
  op
  s
  (PyExp -&gt; PyExp -&gt; Space -&gt; PyExp -&gt; PrimType -&gt; CompilerM op s ())
-&gt; CompilerM op s PyExp
-&gt; CompilerM
     op s (PyExp -&gt; Space -&gt; PyExp -&gt; PrimType -&gt; CompilerM op s ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568034"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1319"></span><span>      </span><span class="annot"><span class="annottext">CompilerM
  op s (PyExp -&gt; Space -&gt; PyExp -&gt; PrimType -&gt; CompilerM op s ())
-&gt; CompilerM op s PyExp
-&gt; CompilerM op s (Space -&gt; PyExp -&gt; PrimType -&gt; CompilerM op s ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TExp Int64 -&gt; Exp
forall t v. TPrimExp t v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#untyped"><span class="hs-identifier hs-var hs-var">Imp.untyped</span></a></span><span> </span><span class="annot"><span class="annottext">TExp Int64
</span><a href="#local-6989586621684568033"><span class="hs-identifier hs-var">srcoffset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1320"></span><span>      </span><span class="annot"><span class="annottext">CompilerM op s (Space -&gt; PyExp -&gt; PrimType -&gt; CompilerM op s ())
-&gt; CompilerM op s Space
-&gt; CompilerM op s (PyExp -&gt; PrimType -&gt; CompilerM op s ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Space -&gt; CompilerM op s Space
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684568032"><span class="hs-identifier hs-var">srcspace</span></a></span><span>
</span><span id="line-1321"></span><span>      </span><span class="annot"><span class="annottext">CompilerM op s (PyExp -&gt; PrimType -&gt; CompilerM op s ())
-&gt; CompilerM op s PyExp
-&gt; CompilerM op s (PrimType -&gt; CompilerM op s ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TExp Int64 -&gt; Exp
forall t v. TPrimExp t v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#untyped"><span class="hs-identifier hs-var hs-var">Imp.untyped</span></a></span><span> </span><span class="annot"><span class="annottext">TExp Int64
</span><a href="#local-6989586621684568031"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1322"></span><span>      </span><span class="annot"><span class="annottext">CompilerM op s (PrimType -&gt; CompilerM op s ())
-&gt; CompilerM op s PrimType -&gt; CompilerM op s (CompilerM op s ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; CompilerM op s PrimType
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-var">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int32"><span class="hs-identifier hs-var">Int32</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- FIXME</span><span>
</span><span id="line-1323"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Write"><span class="hs-identifier hs-type">Imp.Write</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Count Elements (TExp Int64)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Primitive.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Volatility
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; CompilerM op s ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1324"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Write"><span class="hs-identifier hs-type">Imp.Write</span></a></span><span> </span><span id="local-6989586621684568028"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568028"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Sizes.html#Count"><span class="hs-identifier hs-type">Imp.Count</span></a></span><span> </span><span id="local-6989586621684568027"><span class="annot"><span class="annottext">TExp Int64
</span><a href="#local-6989586621684568027"><span class="hs-identifier hs-var">idx</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684568026"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568026"><span class="hs-identifier hs-var">elemtype</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Space"><span class="hs-identifier hs-type">Imp.Space</span></a></span><span> </span><span id="local-6989586621684568025"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568025"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Volatility
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568024"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568024"><span class="hs-identifier hs-var">elemexp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1325"></span><span>  </span><span class="annot"><span class="annottext">CompilerM op s (CompilerM op s ()) -&gt; CompilerM op s ()
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">(CompilerM op s (CompilerM op s ()) -&gt; CompilerM op s ())
-&gt; CompilerM op s (CompilerM op s ()) -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1326"></span><span>    </span><span class="annot"><span class="annottext">(CompilerEnv op s -&gt; WriteScalar op s)
-&gt; CompilerM op s (WriteScalar op s)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">CompilerEnv op s -&gt; WriteScalar op s
forall op s. CompilerEnv op s -&gt; WriteScalar op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envWriteScalar"><span class="hs-identifier hs-var">envWriteScalar</span></a></span><span>
</span><span id="line-1327"></span><span>      </span><span class="annot"><span class="annottext">CompilerM op s (WriteScalar op s)
-&gt; CompilerM op s PyExp
-&gt; CompilerM
     op s (PyExp -&gt; PrimType -&gt; [Char] -&gt; PyExp -&gt; CompilerM op s ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568028"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-1328"></span><span>      </span><span class="annot"><span class="annottext">CompilerM
  op s (PyExp -&gt; PrimType -&gt; [Char] -&gt; PyExp -&gt; CompilerM op s ())
-&gt; CompilerM op s PyExp
-&gt; CompilerM
     op s (PrimType -&gt; [Char] -&gt; PyExp -&gt; CompilerM op s ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TExp Int64 -&gt; Exp
forall t v. TPrimExp t v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#untyped"><span class="hs-identifier hs-var hs-var">Imp.untyped</span></a></span><span> </span><span class="annot"><span class="annottext">TExp Int64
</span><a href="#local-6989586621684568027"><span class="hs-identifier hs-var">idx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1329"></span><span>      </span><span class="annot"><span class="annottext">CompilerM op s (PrimType -&gt; [Char] -&gt; PyExp -&gt; CompilerM op s ())
-&gt; CompilerM op s PrimType
-&gt; CompilerM op s ([Char] -&gt; PyExp -&gt; CompilerM op s ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; CompilerM op s PrimType
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568026"><span class="hs-identifier hs-var">elemtype</span></a></span><span>
</span><span id="line-1330"></span><span>      </span><span class="annot"><span class="annottext">CompilerM op s ([Char] -&gt; PyExp -&gt; CompilerM op s ())
-&gt; CompilerM op s [Char]
-&gt; CompilerM op s (PyExp -&gt; CompilerM op s ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; CompilerM op s [Char]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568025"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-1331"></span><span>      </span><span class="annot"><span class="annottext">CompilerM op s (PyExp -&gt; CompilerM op s ())
-&gt; CompilerM op s PyExp -&gt; CompilerM op s (CompilerM op s ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568024"><span class="hs-identifier hs-var">elemexp</span></a></span><span>
</span><span id="line-1332"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Write"><span class="hs-identifier hs-type">Imp.Write</span></a></span><span> </span><span id="local-6989586621684568023"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568023"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Sizes.html#Count"><span class="hs-identifier hs-type">Imp.Count</span></a></span><span> </span><span id="local-6989586621684568022"><span class="annot"><span class="annottext">TExp Int64
</span><a href="#local-6989586621684568022"><span class="hs-identifier hs-var">idx</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684568021"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568021"><span class="hs-identifier hs-var">elemtype</span></a></span></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Volatility
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684568020"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568020"><span class="hs-identifier hs-var">elemexp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1333"></span><span>  </span><span id="local-6989586621684568019"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568019"><span class="hs-identifier hs-var">idx'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; CompilerM op s PyExp) -&gt; Exp -&gt; CompilerM op s PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TExp Int64 -&gt; Exp
forall t v. TPrimExp t v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#untyped"><span class="hs-identifier hs-var hs-var">Imp.untyped</span></a></span><span> </span><span class="annot"><span class="annottext">TExp Int64
</span><a href="#local-6989586621684568022"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-1334"></span><span>  </span><span id="local-6989586621684568018"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568018"><span class="hs-identifier hs-var">elemexp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#toStorage"><span class="hs-identifier hs-var">toStorage</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568021"><span class="hs-identifier hs-var">elemtype</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyExp) -&gt; CompilerM op s PyExp -&gt; CompilerM op s PyExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684568020"><span class="hs-identifier hs-var">elemexp</span></a></span><span>
</span><span id="line-1335"></span><span>  </span><span id="local-6989586621684568017"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568017"><span class="hs-identifier hs-var">dest'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568023"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-1336"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;writeScalarArray&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568017"><span class="hs-identifier hs-var">dest'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568019"><span class="hs-identifier hs-var">idx'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568018"><span class="hs-identifier hs-var">elemexp'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1337"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Read"><span class="hs-identifier hs-type">Imp.Read</span></a></span><span> </span><span id="local-6989586621684568015"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568015"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Count Elements (TExp Int64)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Primitive.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Volatility
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1338"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ())
-&gt; CompilerM op s PyStmt -&gt; CompilerM op s ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyExp -&gt; PyStmt)
-&gt; CompilerM op s PyExp -&gt; CompilerM op s (PyExp -&gt; PyStmt)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568015"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerM op s (PyExp -&gt; PyStmt)
-&gt; CompilerM op s PyExp -&gt; CompilerM op s PyStmt
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; CompilerM op s PyExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimValue -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimValue"><span class="hs-identifier hs-var">compilePrimValue</span></a></span><span> </span><span class="annot"><span class="annottext">PrimValue
</span><a href="Futhark.IR.Primitive.html#UnitValue"><span class="hs-identifier hs-var">UnitValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1339"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Read"><span class="hs-identifier hs-type">Imp.Read</span></a></span><span> </span><span id="local-6989586621684568014"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568014"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621684568013"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568013"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Sizes.html#Count"><span class="hs-identifier hs-type">Imp.Count</span></a></span><span> </span><span id="local-6989586621684568012"><span class="annot"><span class="annottext">TExp Int64
</span><a href="#local-6989586621684568012"><span class="hs-identifier hs-var">iexp</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684568011"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568011"><span class="hs-identifier hs-var">restype</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Space"><span class="hs-identifier hs-type">Imp.Space</span></a></span><span> </span><span id="local-6989586621684568010"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568010"><span class="hs-identifier hs-var">space</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Volatility
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1340"></span><span>  </span><span id="local-6989586621684568009"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568009"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568014"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1341"></span><span>  </span><span id="local-6989586621684568008"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568008"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1342"></span><span>    </span><span class="annot"><span class="annottext">CompilerM op s (CompilerM op s PyExp) -&gt; CompilerM op s PyExp
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">(CompilerM op s (CompilerM op s PyExp) -&gt; CompilerM op s PyExp)
-&gt; CompilerM op s (CompilerM op s PyExp) -&gt; CompilerM op s PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1343"></span><span>      </span><span class="annot"><span class="annottext">(CompilerEnv op s -&gt; ReadScalar op s)
-&gt; CompilerM op s (ReadScalar op s)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">CompilerEnv op s -&gt; ReadScalar op s
forall op s. CompilerEnv op s -&gt; ReadScalar op s
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#envReadScalar"><span class="hs-identifier hs-var">envReadScalar</span></a></span><span>
</span><span id="line-1344"></span><span>        </span><span class="annot"><span class="annottext">CompilerM op s (ReadScalar op s)
-&gt; CompilerM op s PyExp
-&gt; CompilerM
     op s (PyExp -&gt; PrimType -&gt; [Char] -&gt; CompilerM op s PyExp)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568013"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1345"></span><span>        </span><span class="annot"><span class="annottext">CompilerM
  op s (PyExp -&gt; PrimType -&gt; [Char] -&gt; CompilerM op s PyExp)
-&gt; CompilerM op s PyExp
-&gt; CompilerM op s (PrimType -&gt; [Char] -&gt; CompilerM op s PyExp)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TExp Int64 -&gt; Exp
forall t v. TPrimExp t v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#untyped"><span class="hs-identifier hs-var hs-var">Imp.untyped</span></a></span><span> </span><span class="annot"><span class="annottext">TExp Int64
</span><a href="#local-6989586621684568012"><span class="hs-identifier hs-var">iexp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1346"></span><span>        </span><span class="annot"><span class="annottext">CompilerM op s (PrimType -&gt; [Char] -&gt; CompilerM op s PyExp)
-&gt; CompilerM op s PrimType
-&gt; CompilerM op s ([Char] -&gt; CompilerM op s PyExp)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; CompilerM op s PrimType
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568011"><span class="hs-identifier hs-var">restype</span></a></span><span>
</span><span id="line-1347"></span><span>        </span><span class="annot"><span class="annottext">CompilerM op s ([Char] -&gt; CompilerM op s PyExp)
-&gt; CompilerM op s [Char] -&gt; CompilerM op s (CompilerM op s PyExp)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; CompilerM op s [Char]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568010"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-1348"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568009"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568008"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1349"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Read"><span class="hs-identifier hs-type">Imp.Read</span></a></span><span> </span><span id="local-6989586621684568007"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568007"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621684568006"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568006"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPU.Sizes.html#Count"><span class="hs-identifier hs-type">Imp.Count</span></a></span><span> </span><span id="local-6989586621684568005"><span class="annot"><span class="annottext">TExp Int64
</span><a href="#local-6989586621684568005"><span class="hs-identifier hs-var">iexp</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684568004"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568004"><span class="hs-identifier hs-var">bt</span></a></span></span><span> </span><span class="annot"><span class="annottext">Space
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Volatility
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1350"></span><span>  </span><span id="local-6989586621684568003"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568003"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568007"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1351"></span><span>  </span><span id="local-6989586621684568002"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568002"><span class="hs-identifier hs-var">iexp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; CompilerM op s PyExp
forall op s. Exp -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileExp"><span class="hs-identifier hs-var">compileExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; CompilerM op s PyExp) -&gt; Exp -&gt; CompilerM op s PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TExp Int64 -&gt; Exp
forall t v. TPrimExp t v -&gt; PrimExp v
</span><a href="Futhark.Analysis.PrimExp.html#untyped"><span class="hs-identifier hs-var hs-var">Imp.untyped</span></a></span><span> </span><span class="annot"><span class="annottext">TExp Int64
</span><a href="#local-6989586621684568005"><span class="hs-identifier hs-var">iexp</span></a></span><span>
</span><span id="line-1352"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684568001"><span class="annot"><span class="annottext">bt' :: [Char]
</span><a href="#local-6989586621684568001"><span class="hs-identifier hs-var hs-var">bt'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; [Char]
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compilePrimType"><span class="hs-identifier hs-var">compilePrimType</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568004"><span class="hs-identifier hs-var">bt</span></a></span><span>
</span><span id="line-1353"></span><span>  </span><span id="local-6989586621684568000"><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568000"><span class="hs-identifier hs-var">src'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VName -&gt; CompilerM op s PyExp
forall op s. VName -&gt; CompilerM op s PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#compileVar"><span class="hs-identifier hs-var">compileVar</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684568006"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1354"></span><span>  </span><span class="annot"><span class="annottext">PyStmt -&gt; CompilerM op s ()
forall op s. PyStmt -&gt; CompilerM op s ()
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#stm"><span class="hs-identifier hs-var">stm</span></a></span><span> </span><span class="annot"><span class="annottext">(PyStmt -&gt; CompilerM op s ()) -&gt; PyStmt -&gt; CompilerM op s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PyExp -&gt; PyExp -&gt; PyStmt
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568003"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyStmt) -&gt; PyExp -&gt; PyStmt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; PyExp -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#fromStorage"><span class="hs-identifier hs-var">fromStorage</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684568004"><span class="hs-identifier hs-var">bt</span></a></span><span> </span><span class="annot"><span class="annottext">(PyExp -&gt; PyExp) -&gt; PyExp -&gt; PyExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [PyExp] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.html#simpleCall"><span class="hs-identifier hs-var">simpleCall</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;indexArray&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568000"><span class="hs-identifier hs-var">src'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PyExp
</span><a href="#local-6989586621684568002"><span class="hs-identifier hs-var">iexp'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PyExp
</span><a href="Futhark.CodeGen.Backends.GenericPython.AST.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684568001"><span class="hs-identifier hs-var">bt'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1355"></span><span class="annot"><a href="Futhark.CodeGen.Backends.GenericPython.html#compileCode"><span class="hs-identifier hs-var">compileCode</span></a></span><span> </span><span class="annot"><span class="annottext">Code op
</span><a href="Futhark.CodeGen.ImpCode.html#Skip"><span class="hs-identifier hs-var">Imp.Skip</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; CompilerM op s ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1356"></span></pre></body></html>