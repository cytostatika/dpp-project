<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">-- | Facilities for inspecting the data dependencies of a program.</span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Futhark.Analysis.DataDependencies</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Futhark.Analysis.DataDependencies.html#Dependencies"><span class="hs-identifier">Dependencies</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.DataDependencies.html#dataDependencies"><span class="hs-identifier">dataDependencies</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.DataDependencies.html#findNecessaryForReturned"><span class="hs-identifier">findNecessaryForReturned</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">where</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.html"><span class="hs-identifier">Futhark.IR</span></a></span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-comment">-- | A mapping from a variable name @v@, to those variables on which</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- the value of @v@ is dependent.  The intuition is that we could</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- remove all other variables, and @v@ would still be computable.</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- This also includes names bound in loops or by lambdas.</span><span>
</span><span id="line-18"></span><span class="hs-keyword">type</span><span> </span><span id="Dependencies"><span class="annot"><a href="Futhark.Analysis.DataDependencies.html#Dependencies"><span class="hs-identifier hs-var">Dependencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#Names"><span class="hs-identifier hs-type">Names</span></a></span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-comment">-- | Compute the data dependencies for an entire body.</span><span>
</span><span id="line-21"></span><span id="local-6989586621684347592"><span class="annot"><a href="Futhark.Analysis.DataDependencies.html#dataDependencies"><span class="hs-identifier hs-type">dataDependencies</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.html#ASTRep"><span class="hs-identifier hs-type">ASTRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684347592"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Body"><span class="hs-identifier hs-type">Body</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684347592"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.DataDependencies.html#Dependencies"><span class="hs-identifier hs-type">Dependencies</span></a></span></span><span>
</span><span id="line-22"></span><span id="dataDependencies"><span class="annot"><span class="annottext">dataDependencies :: forall rep. ASTRep rep =&gt; Body rep -&gt; Dependencies
</span><a href="Futhark.Analysis.DataDependencies.html#dataDependencies"><span class="hs-identifier hs-var hs-var">dataDependencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; Body rep -&gt; Dependencies
forall rep. ASTRep rep =&gt; Dependencies -&gt; Body rep -&gt; Dependencies
</span><a href="Futhark.Analysis.DataDependencies.html#dataDependencies%27"><span class="hs-identifier hs-var">dataDependencies'</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
forall k a. Map k a
</span><span class="hs-identifier hs-var">M.empty</span></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span id="local-6989586621684347587"><span class="annot"><a href="Futhark.Analysis.DataDependencies.html#dataDependencies%27"><span class="hs-identifier hs-type">dataDependencies'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.html#ASTRep"><span class="hs-identifier hs-type">ASTRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684347587"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="Futhark.Analysis.DataDependencies.html#Dependencies"><span class="hs-identifier hs-type">Dependencies</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="Futhark.IR.Syntax.html#Body"><span class="hs-identifier hs-type">Body</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684347587"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="Futhark.Analysis.DataDependencies.html#Dependencies"><span class="hs-identifier hs-type">Dependencies</span></a></span></span><span>
</span><span id="line-29"></span><span id="dataDependencies%27"><span class="annot"><span class="annottext">dataDependencies' :: forall rep. ASTRep rep =&gt; Dependencies -&gt; Body rep -&gt; Dependencies
</span><a href="Futhark.Analysis.DataDependencies.html#dataDependencies%27"><span class="hs-identifier hs-var hs-var">dataDependencies'</span></a></span></span><span> </span><span id="local-6989586621684347483"><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347483"><span class="hs-identifier hs-var">startdeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Dependencies -&gt; Stm rep -&gt; Dependencies)
-&gt; Dependencies -&gt; Seq (Stm rep) -&gt; Dependencies
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; Stm rep -&gt; Dependencies
forall {rep}. ASTRep rep =&gt; Dependencies -&gt; Stm rep -&gt; Dependencies
</span><a href="#local-6989586621684347481"><span class="hs-identifier hs-var">grow</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347483"><span class="hs-identifier hs-var">startdeps</span></a></span><span> </span><span class="annot"><span class="annottext">(Seq (Stm rep) -&gt; Dependencies)
-&gt; (BodyT rep -&gt; Seq (Stm rep)) -&gt; BodyT rep -&gt; Dependencies
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BodyT rep -&gt; Seq (Stm rep)
forall rep. BodyT rep -&gt; Stms rep
</span><a href="Futhark.IR.Syntax.html#bodyStms"><span class="hs-identifier hs-var hs-var">bodyStms</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-31"></span><span>    </span><span id="local-6989586621684347481"><span class="annot"><span class="annottext">grow :: Dependencies -&gt; Stm rep -&gt; Dependencies
</span><a href="#local-6989586621684347481"><span class="hs-identifier hs-var hs-var">grow</span></a></span></span><span> </span><span id="local-6989586621684347436"><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347436"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621684347434"><span class="annot"><span class="annottext">Pat rep
</span><a href="#local-6989586621684347434"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="annot"><span class="annottext">StmAux (ExpDec rep)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#If"><span class="hs-identifier hs-type">If</span></a></span><span> </span><span id="local-6989586621684347432"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684347432"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621684347431"><span class="annot"><span class="annottext">BodyT rep
</span><a href="#local-6989586621684347431"><span class="hs-identifier hs-var">tb</span></a></span></span><span> </span><span id="local-6989586621684347430"><span class="annot"><span class="annottext">BodyT rep
</span><a href="#local-6989586621684347430"><span class="hs-identifier hs-var">fb</span></a></span></span><span> </span><span class="annot"><span class="annottext">IfDec (BranchType rep)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-32"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684347428"><span class="annot"><span class="annottext">tdeps :: Dependencies
</span><a href="#local-6989586621684347428"><span class="hs-identifier hs-var hs-var">tdeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; BodyT rep -&gt; Dependencies
forall rep. ASTRep rep =&gt; Dependencies -&gt; Body rep -&gt; Dependencies
</span><a href="Futhark.Analysis.DataDependencies.html#dataDependencies%27"><span class="hs-identifier hs-var">dataDependencies'</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347436"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="annot"><span class="annottext">BodyT rep
</span><a href="#local-6989586621684347431"><span class="hs-identifier hs-var">tb</span></a></span><span>
</span><span id="line-33"></span><span>          </span><span id="local-6989586621684347426"><span class="annot"><span class="annottext">fdeps :: Dependencies
</span><a href="#local-6989586621684347426"><span class="hs-identifier hs-var hs-var">fdeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; BodyT rep -&gt; Dependencies
forall rep. ASTRep rep =&gt; Dependencies -&gt; Body rep -&gt; Dependencies
</span><a href="Futhark.Analysis.DataDependencies.html#dataDependencies%27"><span class="hs-identifier hs-var">dataDependencies'</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347436"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="annot"><span class="annottext">BodyT rep
</span><a href="#local-6989586621684347430"><span class="hs-identifier hs-var">fb</span></a></span><span>
</span><span id="line-34"></span><span>          </span><span id="local-6989586621684347425"><span class="annot"><span class="annottext">cdeps :: Names
</span><a href="#local-6989586621684347425"><span class="hs-identifier hs-var hs-var">cdeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; SubExp -&gt; Names
</span><a href="Futhark.Analysis.DataDependencies.html#depsOf"><span class="hs-identifier hs-var">depsOf</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347436"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684347432"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-35"></span><span>          </span><span id="local-6989586621684347417"><span class="annot"><span class="annottext">comb :: (PatElemT dec, SubExpRes, SubExpRes) -&gt; (VName, Names)
</span><a href="#local-6989586621684347417"><span class="hs-identifier hs-var hs-var">comb</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684347416"><span class="annot"><span class="annottext">PatElemT dec
</span><a href="#local-6989586621684347416"><span class="hs-identifier hs-var">pe</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#SubExpRes"><span class="hs-identifier hs-type">SubExpRes</span></a></span><span> </span><span class="annot"><span class="annottext">Certs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684347414"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684347414"><span class="hs-identifier hs-var">tres</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#SubExpRes"><span class="hs-identifier hs-type">SubExpRes</span></a></span><span> </span><span class="annot"><span class="annottext">Certs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684347413"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684347413"><span class="hs-identifier hs-var">fres</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-36"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">PatElemT dec -&gt; VName
forall dec. PatElemT dec -&gt; VName
</span><a href="Futhark.IR.Syntax.Core.html#patElemName"><span class="hs-identifier hs-var hs-var">patElemName</span></a></span><span> </span><span class="annot"><span class="annottext">PatElemT dec
</span><a href="#local-6989586621684347416"><span class="hs-identifier hs-var">pe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>              </span><span class="annot"><span class="annottext">[Names] -&gt; Names
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Names] -&gt; Names) -&gt; [Names] -&gt; Names
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-38"></span><span>                </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PatElemT dec -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">PatElemT dec
</span><a href="#local-6989586621684347416"><span class="hs-identifier hs-var">pe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684347425"><span class="hs-identifier hs-var">cdeps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; SubExp -&gt; Names
</span><a href="Futhark.Analysis.DataDependencies.html#depsOf"><span class="hs-identifier hs-var">depsOf</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347428"><span class="hs-identifier hs-var">tdeps</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684347414"><span class="hs-identifier hs-var">tres</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; SubExp -&gt; Names
</span><a href="Futhark.Analysis.DataDependencies.html#depsOf"><span class="hs-identifier hs-var">depsOf</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347426"><span class="hs-identifier hs-var">fdeps</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684347413"><span class="hs-identifier hs-var">fres</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-39"></span><span>                  </span><span class="annot"><span class="annottext">[Names] -&gt; [Names] -&gt; [Names]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Names) -&gt; [VName] -&gt; [Names]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependencies -&gt; VName -&gt; Names
</span><a href="Futhark.Analysis.DataDependencies.html#depsOfVar"><span class="hs-identifier hs-var">depsOfVar</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347436"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; [VName]
</span><a href="Futhark.IR.Prop.Names.html#namesToList"><span class="hs-identifier hs-var">namesToList</span></a></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; [VName]) -&gt; Names -&gt; [VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatElemT dec -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">PatElemT dec
</span><a href="#local-6989586621684347416"><span class="hs-identifier hs-var">pe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>          </span><span id="local-6989586621684347403"><span class="annot"><span class="annottext">branchdeps :: Dependencies
</span><a href="#local-6989586621684347403"><span class="hs-identifier hs-var hs-var">branchdeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-42"></span><span>            </span><span class="annot"><span class="annottext">[(VName, Names)] -&gt; Dependencies
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(VName, Names)] -&gt; Dependencies)
-&gt; [(VName, Names)] -&gt; Dependencies
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-43"></span><span>              </span><span class="annot"><span class="annottext">((PatElemT (LetDec rep), SubExpRes, SubExpRes) -&gt; (VName, Names))
-&gt; [(PatElemT (LetDec rep), SubExpRes, SubExpRes)]
-&gt; [(VName, Names)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(PatElemT (LetDec rep), SubExpRes, SubExpRes) -&gt; (VName, Names)
forall {dec}.
FreeIn dec =&gt;
(PatElemT dec, SubExpRes, SubExpRes) -&gt; (VName, Names)
</span><a href="#local-6989586621684347417"><span class="hs-identifier hs-var">comb</span></a></span><span> </span><span class="annot"><span class="annottext">([(PatElemT (LetDec rep), SubExpRes, SubExpRes)]
 -&gt; [(VName, Names)])
-&gt; [(PatElemT (LetDec rep), SubExpRes, SubExpRes)]
-&gt; [(VName, Names)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-44"></span><span>                </span><span class="annot"><span class="annottext">[PatElemT (LetDec rep)]
-&gt; [SubExpRes]
-&gt; [SubExpRes]
-&gt; [(PatElemT (LetDec rep), SubExpRes, SubExpRes)]
forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><span class="hs-identifier hs-var">zip3</span></span><span>
</span><span id="line-45"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat rep -&gt; [PatElemT (LetDec rep)]
forall dec. PatT dec -&gt; [PatElemT dec]
</span><a href="Futhark.IR.Syntax.html#patElems"><span class="hs-identifier hs-var hs-var">patElems</span></a></span><span> </span><span class="annot"><span class="annottext">Pat rep
</span><a href="#local-6989586621684347434"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BodyT rep -&gt; [SubExpRes]
forall rep. BodyT rep -&gt; [SubExpRes]
</span><a href="Futhark.IR.Syntax.html#bodyResult"><span class="hs-identifier hs-var hs-var">bodyResult</span></a></span><span> </span><span class="annot"><span class="annottext">BodyT rep
</span><a href="#local-6989586621684347431"><span class="hs-identifier hs-var">tb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BodyT rep -&gt; [SubExpRes]
forall rep. BodyT rep -&gt; [SubExpRes]
</span><a href="Futhark.IR.Syntax.html#bodyResult"><span class="hs-identifier hs-var hs-var">bodyResult</span></a></span><span> </span><span class="annot"><span class="annottext">BodyT rep
</span><a href="#local-6989586621684347430"><span class="hs-identifier hs-var">fb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Dependencies] -&gt; Dependencies
forall (f :: * -&gt; *) k a.
(Foldable f, Ord k) =&gt;
f (Map k a) -&gt; Map k a
</span><span class="hs-identifier hs-var">M.unions</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347403"><span class="hs-identifier hs-var">branchdeps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347436"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347428"><span class="hs-identifier hs-var">tdeps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347426"><span class="hs-identifier hs-var">fdeps</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><a href="#local-6989586621684347481"><span class="hs-identifier hs-var">grow</span></a></span><span> </span><span id="local-6989586621684347397"><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347397"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621684347396"><span class="annot"><span class="annottext">Pat rep
</span><a href="#local-6989586621684347396"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="annot"><span class="annottext">StmAux (ExpDec rep)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684347395"><span class="annot"><span class="annottext">ExpT rep
</span><a href="#local-6989586621684347395"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-50"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684347349"><span class="annot"><span class="annottext">free :: Names
</span><a href="#local-6989586621684347349"><span class="hs-identifier hs-var hs-var">free</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pat rep -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">Pat rep
</span><a href="#local-6989586621684347396"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ExpT rep -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">ExpT rep
</span><a href="#local-6989586621684347395"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-51"></span><span>          </span><span id="local-6989586621684347347"><span class="annot"><span class="annottext">freeDeps :: Names
</span><a href="#local-6989586621684347347"><span class="hs-identifier hs-var hs-var">freeDeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Names] -&gt; Names
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Names] -&gt; Names) -&gt; [Names] -&gt; Names
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Names) -&gt; [VName] -&gt; [Names]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dependencies -&gt; VName -&gt; Names
</span><a href="Futhark.Analysis.DataDependencies.html#depsOfVar"><span class="hs-identifier hs-var">depsOfVar</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347397"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; [Names]) -&gt; [VName] -&gt; [Names]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; [VName]
</span><a href="Futhark.IR.Prop.Names.html#namesToList"><span class="hs-identifier hs-var">namesToList</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684347349"><span class="hs-identifier hs-var">free</span></a></span><span>
</span><span id="line-52"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(VName, Names)] -&gt; Dependencies
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684347346"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684347347"><span class="hs-identifier hs-var">freeDeps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621684347346"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684347346"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pat rep -&gt; [VName]
forall dec. PatT dec -&gt; [VName]
</span><a href="Futhark.IR.Prop.Patterns.html#patNames"><span class="hs-identifier hs-var">patNames</span></a></span><span> </span><span class="annot"><span class="annottext">Pat rep
</span><a href="#local-6989586621684347396"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; Dependencies -&gt; Dependencies
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-operator hs-var">`M.union`</span></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347397"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="annot"><a href="Futhark.Analysis.DataDependencies.html#depsOf"><span class="hs-identifier hs-type">depsOf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Analysis.DataDependencies.html#Dependencies"><span class="hs-identifier hs-type">Dependencies</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#Names"><span class="hs-identifier hs-type">Names</span></a></span><span>
</span><span id="line-55"></span><span id="depsOf"><span class="annot"><span class="annottext">depsOf :: Dependencies -&gt; SubExp -&gt; Names
</span><a href="Futhark.Analysis.DataDependencies.html#depsOf"><span class="hs-identifier hs-var hs-var">depsOf</span></a></span></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span> </span><span class="annot"><span class="annottext">PrimValue
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-56"></span><span class="annot"><a href="Futhark.Analysis.DataDependencies.html#depsOf"><span class="hs-identifier hs-var">depsOf</span></a></span><span> </span><span id="local-6989586621684347342"><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347342"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684347340"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684347340"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; VName -&gt; Names
</span><a href="Futhark.Analysis.DataDependencies.html#depsOfVar"><span class="hs-identifier hs-var">depsOfVar</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347342"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684347340"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="annot"><a href="Futhark.Analysis.DataDependencies.html#depsOfVar"><span class="hs-identifier hs-type">depsOfVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Analysis.DataDependencies.html#Dependencies"><span class="hs-identifier hs-type">Dependencies</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#Names"><span class="hs-identifier hs-type">Names</span></a></span><span>
</span><span id="line-59"></span><span id="depsOfVar"><span class="annot"><span class="annottext">depsOfVar :: Dependencies -&gt; VName -&gt; Names
</span><a href="Futhark.Analysis.DataDependencies.html#depsOfVar"><span class="hs-identifier hs-var hs-var">depsOfVar</span></a></span></span><span> </span><span id="local-6989586621684347339"><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347339"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span id="local-6989586621684347338"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684347338"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#oneName"><span class="hs-identifier hs-var">oneName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684347338"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; VName -&gt; Dependencies -&gt; Names
forall k a. Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a
</span><span class="hs-identifier hs-var">M.findWithDefault</span></span><span> </span><span class="annot"><span class="annottext">Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684347338"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347339"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-comment">-- | @findNecessaryForReturned p merge deps@ computes which of the</span><span>
</span><span id="line-62"></span><span class="hs-comment">-- loop parameters (@merge@) are necessary for the result of the loop,</span><span>
</span><span id="line-63"></span><span class="hs-comment">-- where @p@ given a loop parameter indicates whether the final value</span><span>
</span><span id="line-64"></span><span class="hs-comment">-- of that parameter is live after the loop.  @deps@ is the data</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- dependencies of the loop body.  This is computed by straightforward</span><span>
</span><span id="line-66"></span><span class="hs-comment">-- fixpoint iteration.</span><span>
</span><span id="line-67"></span><span id="local-6989586621684347510"><span class="annot"><a href="Futhark.Analysis.DataDependencies.html#findNecessaryForReturned"><span class="hs-identifier hs-type">findNecessaryForReturned</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Param"><span class="hs-identifier hs-type">Param</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684347510"><span class="hs-identifier hs-type">dec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Param"><span class="hs-identifier hs-type">Param</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684347510"><span class="hs-identifier hs-type">dec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#Names"><span class="hs-identifier hs-type">Names</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-71"></span><span>  </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#Names"><span class="hs-identifier hs-type">Names</span></a></span></span><span>
</span><span id="line-72"></span><span id="findNecessaryForReturned"><span class="annot"><span class="annottext">findNecessaryForReturned :: forall dec.
(Param dec -&gt; Bool)
-&gt; [(Param dec, SubExp)] -&gt; Dependencies -&gt; Names
</span><a href="Futhark.Analysis.DataDependencies.html#findNecessaryForReturned"><span class="hs-identifier hs-var hs-var">findNecessaryForReturned</span></a></span></span><span> </span><span id="local-6989586621684347333"><span class="annot"><span class="annottext">Param dec -&gt; Bool
</span><a href="#local-6989586621684347333"><span class="hs-identifier hs-var">usedAfterLoop</span></a></span></span><span> </span><span id="local-6989586621684347332"><span class="annot"><span class="annottext">[(Param dec, SubExp)]
</span><a href="#local-6989586621684347332"><span class="hs-identifier hs-var">merge_and_res</span></a></span></span><span> </span><span id="local-6989586621684347331"><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347331"><span class="hs-identifier hs-var">allDependencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><span class="annottext">Names -&gt; Names
</span><a href="#local-6989586621684347330"><span class="hs-identifier hs-var">iterateNecessary</span></a></span><span> </span><span class="annot"><span class="annottext">Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#namesFromList"><span class="hs-identifier hs-var">namesFromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Param dec -&gt; VName) -&gt; [Param dec] -&gt; [VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Param dec -&gt; VName
forall dec. Param dec -&gt; VName
</span><a href="Futhark.IR.Syntax.Core.html#paramName"><span class="hs-identifier hs-var hs-var">paramName</span></a></span><span> </span><span class="annot"><span class="annottext">([Param dec] -&gt; [VName]) -&gt; [Param dec] -&gt; [VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Param dec -&gt; Bool) -&gt; [Param dec] -&gt; [Param dec]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">Param dec -&gt; Bool
</span><a href="#local-6989586621684347333"><span class="hs-identifier hs-var">usedAfterLoop</span></a></span><span> </span><span class="annot"><span class="annottext">([Param dec] -&gt; [Param dec]) -&gt; [Param dec] -&gt; [Param dec]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Param dec, SubExp) -&gt; Param dec)
-&gt; [(Param dec, SubExp)] -&gt; [Param dec]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Param dec, SubExp) -&gt; Param dec
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Param dec, SubExp)]
</span><a href="#local-6989586621684347332"><span class="hs-identifier hs-var">merge_and_res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-76"></span><span>    </span><span id="local-6989586621684347330"><span class="annot"><span class="annottext">iterateNecessary :: Names -&gt; Names
</span><a href="#local-6989586621684347330"><span class="hs-identifier hs-var hs-var">iterateNecessary</span></a></span></span><span> </span><span id="local-6989586621684347325"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684347325"><span class="hs-identifier hs-var">prev_necessary</span></a></span></span><span>
</span><span id="line-77"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684347324"><span class="hs-identifier hs-var">necessary</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684347325"><span class="hs-identifier hs-var">prev_necessary</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684347324"><span class="hs-identifier hs-var">necessary</span></a></span><span>
</span><span id="line-78"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names
</span><a href="#local-6989586621684347330"><span class="hs-identifier hs-var">iterateNecessary</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684347324"><span class="hs-identifier hs-var">necessary</span></a></span><span>
</span><span id="line-79"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-80"></span><span>        </span><span id="local-6989586621684347324"><span class="annot"><span class="annottext">necessary :: Names
</span><a href="#local-6989586621684347324"><span class="hs-identifier hs-var hs-var">necessary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Names] -&gt; Names
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Names] -&gt; Names) -&gt; [Names] -&gt; Names
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(SubExp -&gt; Names) -&gt; [SubExp] -&gt; [Names]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; Names
</span><a href="#local-6989586621684347322"><span class="hs-identifier hs-var">dependencies</span></a></span><span> </span><span class="annot"><span class="annottext">[SubExp]
</span><a href="#local-6989586621684347321"><span class="hs-identifier hs-var">returnedResultSubExps</span></a></span><span>
</span><span id="line-81"></span><span>        </span><span id="local-6989586621684347320"><span class="annot"><span class="annottext">usedAfterLoopOrNecessary :: Param dec -&gt; Bool
</span><a href="#local-6989586621684347320"><span class="hs-identifier hs-var hs-var">usedAfterLoopOrNecessary</span></a></span></span><span> </span><span id="local-6989586621684347319"><span class="annot"><span class="annottext">Param dec
</span><a href="#local-6989586621684347319"><span class="hs-identifier hs-var">param</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-82"></span><span>          </span><span class="annot"><span class="annottext">Param dec -&gt; Bool
</span><a href="#local-6989586621684347333"><span class="hs-identifier hs-var">usedAfterLoop</span></a></span><span> </span><span class="annot"><span class="annottext">Param dec
</span><a href="#local-6989586621684347319"><span class="hs-identifier hs-var">param</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Param dec -&gt; VName
forall dec. Param dec -&gt; VName
</span><a href="Futhark.IR.Syntax.Core.html#paramName"><span class="hs-identifier hs-var hs-var">paramName</span></a></span><span> </span><span class="annot"><span class="annottext">Param dec
</span><a href="#local-6989586621684347319"><span class="hs-identifier hs-var">param</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Names -&gt; Bool
</span><a href="Futhark.IR.Prop.Names.html#nameIn"><span class="hs-operator hs-var">`nameIn`</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621684347325"><span class="hs-identifier hs-var">prev_necessary</span></a></span><span>
</span><span id="line-83"></span><span>        </span><span id="local-6989586621684347321"><span class="annot"><span class="annottext">returnedResultSubExps :: [SubExp]
</span><a href="#local-6989586621684347321"><span class="hs-identifier hs-var hs-var">returnedResultSubExps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-84"></span><span>          </span><span class="annot"><span class="annottext">((Param dec, SubExp) -&gt; SubExp)
-&gt; [(Param dec, SubExp)] -&gt; [SubExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Param dec, SubExp) -&gt; SubExp
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(Param dec, SubExp)] -&gt; [SubExp])
-&gt; [(Param dec, SubExp)] -&gt; [SubExp]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Param dec, SubExp) -&gt; Bool)
-&gt; [(Param dec, SubExp)] -&gt; [(Param dec, SubExp)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Param dec -&gt; Bool
</span><a href="#local-6989586621684347320"><span class="hs-identifier hs-var">usedAfterLoopOrNecessary</span></a></span><span> </span><span class="annot"><span class="annottext">(Param dec -&gt; Bool)
-&gt; ((Param dec, SubExp) -&gt; Param dec)
-&gt; (Param dec, SubExp)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Param dec, SubExp) -&gt; Param dec
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Param dec, SubExp)]
</span><a href="#local-6989586621684347332"><span class="hs-identifier hs-var">merge_and_res</span></a></span><span>
</span><span id="line-85"></span><span>        </span><span id="local-6989586621684347322"><span class="annot"><span class="annottext">dependencies :: SubExp -&gt; Names
</span><a href="#local-6989586621684347322"><span class="hs-identifier hs-var hs-var">dependencies</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span> </span><span class="annot"><span class="annottext">PrimValue
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-86"></span><span>          </span><span class="annot"><span class="annottext">Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-87"></span><span>        </span><span class="annot"><a href="#local-6989586621684347322"><span class="hs-identifier hs-var">dependencies</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684347314"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684347314"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-88"></span><span>          </span><span class="annot"><span class="annottext">Names -&gt; VName -&gt; Dependencies -&gt; Names
forall k a. Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a
</span><span class="hs-identifier hs-var">M.findWithDefault</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#oneName"><span class="hs-identifier hs-var">oneName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684347314"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684347314"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies
</span><a href="#local-6989586621684347331"><span class="hs-identifier hs-var">allDependencies</span></a></span><span>
</span><span id="line-89"></span></pre></body></html>