<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">-- | All (almost) compiler pipelines end with an 'Action', which does</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- something with the result of the pipeline.</span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Futhark.Actions</span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Futhark.Actions.html#printAction"><span class="hs-identifier">printAction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Futhark.Actions.html#printAliasesAction"><span class="hs-identifier">printAliasesAction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Futhark.Actions.html#printLastUseGPU"><span class="hs-identifier">printLastUseGPU</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Futhark.Actions.html#printInterferenceGPU"><span class="hs-identifier">printInterferenceGPU</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Futhark.Actions.html#printMemAliasGPU"><span class="hs-identifier">printMemAliasGPU</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Futhark.Actions.html#callGraphAction"><span class="hs-identifier">callGraphAction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Futhark.Actions.html#impCodeGenAction"><span class="hs-identifier">impCodeGenAction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Futhark.Actions.html#kernelImpCodeGenAction"><span class="hs-identifier">kernelImpCodeGenAction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Futhark.Actions.html#multicoreImpCodeGenAction"><span class="hs-identifier">multicoreImpCodeGenAction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Futhark.Actions.html#metricsAction"><span class="hs-identifier">metricsAction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Futhark.Actions.html#compileCAction"><span class="hs-identifier">compileCAction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Futhark.Actions.html#compileCtoWASMAction"><span class="hs-identifier">compileCtoWASMAction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Futhark.Actions.html#compileOpenCLAction"><span class="hs-identifier">compileOpenCLAction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Futhark.Actions.html#compileCUDAAction"><span class="hs-identifier">compileCUDAAction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Futhark.Actions.html#compileMulticoreAction"><span class="hs-identifier">compileMulticoreAction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Futhark.Actions.html#compileMulticoreToWASMAction"><span class="hs-identifier">compileMulticoreToWASMAction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Futhark.Actions.html#compilePythonAction"><span class="hs-identifier">compilePythonAction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Futhark.Actions.html#compilePyOpenCLAction"><span class="hs-identifier">compilePyOpenCLAction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">where</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">intercalate</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.IO</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Analysis.Alias.html"><span class="hs-identifier">Futhark.Analysis.Alias</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Analysis.CallGraph.html"><span class="hs-identifier">Futhark.Analysis.CallGraph</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.CallGraph.html#buildCallGraph"><span class="hs-identifier">buildCallGraph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.Analysis.Interference.html"><span class="hs-identifier">Futhark.Analysis.Interference</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Interference</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.Analysis.LastUse.html"><span class="hs-identifier">Futhark.Analysis.LastUse</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LastUse</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.Analysis.MemAlias.html"><span class="hs-identifier">Futhark.Analysis.MemAlias</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MemAlias</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Analysis.Metrics.html"><span class="hs-identifier">Futhark.Analysis.Metrics</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.CCUDA.html"><span class="hs-identifier">Futhark.CodeGen.Backends.CCUDA</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CCUDA</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.COpenCL.html"><span class="hs-identifier">Futhark.CodeGen.Backends.COpenCL</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">COpenCL</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.MulticoreC.html"><span class="hs-identifier">Futhark.CodeGen.Backends.MulticoreC</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MulticoreC</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.MulticoreWASM.html"><span class="hs-identifier">Futhark.CodeGen.Backends.MulticoreWASM</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MulticoreWASM</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.PyOpenCL.html"><span class="hs-identifier">Futhark.CodeGen.Backends.PyOpenCL</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PyOpenCL</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.SequentialC.html"><span class="hs-identifier">Futhark.CodeGen.Backends.SequentialC</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SequentialC</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.SequentialPython.html"><span class="hs-identifier">Futhark.CodeGen.Backends.SequentialPython</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SequentialPy</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.SequentialWASM.html"><span class="hs-identifier">Futhark.CodeGen.Backends.SequentialWASM</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SequentialWASM</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpGen.GPU.html"><span class="hs-identifier">Futhark.CodeGen.ImpGen.GPU</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ImpGenGPU</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpGen.Multicore.html"><span class="hs-identifier">Futhark.CodeGen.ImpGen.Multicore</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ImpGenMulticore</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpGen.Sequential.html"><span class="hs-identifier">Futhark.CodeGen.ImpGen.Sequential</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ImpGenSequential</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Compiler.CLI.html"><span class="hs-identifier">Futhark.Compiler.CLI</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.html"><span class="hs-identifier">Futhark.IR</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html"><span class="hs-identifier">Futhark.IR.GPUMem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier">GPUMem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.MCMem.html"><span class="hs-identifier">Futhark.IR.MCMem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.MCMem.html#MCMem"><span class="hs-identifier">MCMem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html"><span class="hs-identifier">Futhark.IR.Prop.Aliases</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html"><span class="hs-identifier">Futhark.IR.SOACS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier">SOACS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.SeqMem.html"><span class="hs-identifier">Futhark.IR.SeqMem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.SeqMem.html#SeqMem"><span class="hs-identifier">SeqMem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Util.html"><span class="hs-identifier">Futhark.Util</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Util.html#runProgramWithExitCode"><span class="hs-identifier">runProgramWithExitCode</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Util.html#unixEnvironment"><span class="hs-identifier">unixEnvironment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Version.html"><span class="hs-identifier">Futhark.Version</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Version.html#versionString"><span class="hs-identifier">versionString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Exit</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">System.Info</span></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-comment">-- | Print the result to stdout.</span><span>
</span><span id="line-66"></span><span id="local-6989586621684582824"><span class="annot"><a href="Futhark.Actions.html#printAction"><span class="hs-identifier hs-type">printAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.html#ASTRep"><span class="hs-identifier hs-type">ASTRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684582824"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684582824"><span class="hs-identifier hs-type">rep</span></a></span></span><span>
</span><span id="line-67"></span><span id="printAction"><span class="annot"><span class="annottext">printAction :: forall rep. ASTRep rep =&gt; Action rep
</span><a href="Futhark.Actions.html#printAction"><span class="hs-identifier hs-var hs-var">printAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><span class="annottext">Action :: forall rep.
String -&gt; String -&gt; (Prog rep -&gt; FutharkM ()) -&gt; Action rep
</span><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">actionName :: String
</span><a href="Futhark.Pipeline.html#actionName"><span class="hs-identifier hs-var">actionName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Prettyprint&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>      </span><span class="annot"><span class="annottext">actionDescription :: String
</span><a href="Futhark.Pipeline.html#actionDescription"><span class="hs-identifier hs-var">actionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Prettyprint the resulting internal representation on standard output.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>      </span><span class="annot"><span class="annottext">actionProcedure :: Prog rep -&gt; FutharkM ()
</span><a href="Futhark.Pipeline.html#actionProcedure"><span class="hs-identifier hs-var">actionProcedure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ())
-&gt; (Prog rep -&gt; IO ()) -&gt; Prog rep -&gt; FutharkM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; (Prog rep -&gt; String) -&gt; Prog rep -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Prog rep -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- | Print the result to stdout, alias annotations.</span><span>
</span><span id="line-75"></span><span id="local-6989586621684582809"><span class="annot"><a href="Futhark.Actions.html#printAliasesAction"><span class="hs-identifier hs-type">printAliasesAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.html#ASTRep"><span class="hs-identifier hs-type">ASTRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684582809"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#CanBeAliased"><span class="hs-identifier hs-type">CanBeAliased</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Rep.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684582809"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684582809"><span class="hs-identifier hs-type">rep</span></a></span></span><span>
</span><span id="line-76"></span><span id="printAliasesAction"><span class="annot"><span class="annottext">printAliasesAction :: forall rep. (ASTRep rep, CanBeAliased (Op rep)) =&gt; Action rep
</span><a href="Futhark.Actions.html#printAliasesAction"><span class="hs-identifier hs-var hs-var">printAliasesAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><span class="annottext">Action :: forall rep.
String -&gt; String -&gt; (Prog rep -&gt; FutharkM ()) -&gt; Action rep
</span><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">actionName :: String
</span><a href="Futhark.Pipeline.html#actionName"><span class="hs-identifier hs-var">actionName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Prettyprint&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>      </span><span class="annot"><span class="annottext">actionDescription :: String
</span><a href="Futhark.Pipeline.html#actionDescription"><span class="hs-identifier hs-var">actionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Prettyprint the resulting internal representation on standard output.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>      </span><span class="annot"><span class="annottext">actionProcedure :: Prog rep -&gt; FutharkM ()
</span><a href="Futhark.Pipeline.html#actionProcedure"><span class="hs-identifier hs-var">actionProcedure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ())
-&gt; (Prog rep -&gt; IO ()) -&gt; Prog rep -&gt; FutharkM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; (Prog rep -&gt; String) -&gt; Prog rep -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Prog (Aliases rep) -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(Prog (Aliases rep) -&gt; String)
-&gt; (Prog rep -&gt; Prog (Aliases rep)) -&gt; Prog rep -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Prog rep -&gt; Prog (Aliases rep)
forall rep.
(ASTRep rep, CanBeAliased (Op rep)) =&gt;
Prog rep -&gt; Prog (Aliases rep)
</span><a href="Futhark.Analysis.Alias.html#aliasAnalysis"><span class="hs-identifier hs-var">aliasAnalysis</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">-- | Print last use information to stdout.</span><span>
</span><span id="line-84"></span><span class="annot"><a href="Futhark.Actions.html#printLastUseGPU"><span class="hs-identifier hs-type">printLastUseGPU</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span>
</span><span id="line-85"></span><span id="printLastUseGPU"><span class="annot"><span class="annottext">printLastUseGPU :: Action GPUMem
</span><a href="Futhark.Actions.html#printLastUseGPU"><span class="hs-identifier hs-var hs-var">printLastUseGPU</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><span class="annottext">Action :: forall rep.
String -&gt; String -&gt; (Prog rep -&gt; FutharkM ()) -&gt; Action rep
</span><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">actionName :: String
</span><a href="Futhark.Pipeline.html#actionName"><span class="hs-identifier hs-var">actionName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;print last use gpu&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>      </span><span class="annot"><span class="annottext">actionDescription :: String
</span><a href="Futhark.Pipeline.html#actionDescription"><span class="hs-identifier hs-var">actionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Print last use information on gpu.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>      </span><span class="annot"><span class="annottext">actionProcedure :: Prog GPUMem -&gt; FutharkM ()
</span><a href="Futhark.Pipeline.html#actionProcedure"><span class="hs-identifier hs-var">actionProcedure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ())
-&gt; (Prog GPUMem -&gt; IO ()) -&gt; Prog GPUMem -&gt; FutharkM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ())
-&gt; (Prog GPUMem -&gt; String) -&gt; Prog GPUMem -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LastUseMap, Used) -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">((LastUseMap, Used) -&gt; String)
-&gt; (Prog GPUMem -&gt; (LastUseMap, Used)) -&gt; Prog GPUMem -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Prog GPUMem -&gt; (LastUseMap, Used)
</span><a href="Futhark.Analysis.LastUse.html#analyseGPUMem"><span class="hs-identifier hs-var">LastUse.analyseGPUMem</span></a></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-comment">-- | Print interference information to stdout.</span><span>
</span><span id="line-93"></span><span class="annot"><a href="Futhark.Actions.html#printInterferenceGPU"><span class="hs-identifier hs-type">printInterferenceGPU</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span>
</span><span id="line-94"></span><span id="printInterferenceGPU"><span class="annot"><span class="annottext">printInterferenceGPU :: Action GPUMem
</span><a href="Futhark.Actions.html#printInterferenceGPU"><span class="hs-identifier hs-var hs-var">printInterferenceGPU</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><span class="annottext">Action :: forall rep.
String -&gt; String -&gt; (Prog rep -&gt; FutharkM ()) -&gt; Action rep
</span><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">actionName :: String
</span><a href="Futhark.Pipeline.html#actionName"><span class="hs-identifier hs-var">actionName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;print interference gpu&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>      </span><span class="annot"><span class="annottext">actionDescription :: String
</span><a href="Futhark.Pipeline.html#actionDescription"><span class="hs-identifier hs-var">actionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Print interference information on gpu.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>      </span><span class="annot"><span class="annottext">actionProcedure :: Prog GPUMem -&gt; FutharkM ()
</span><a href="Futhark.Pipeline.html#actionProcedure"><span class="hs-identifier hs-var">actionProcedure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ())
-&gt; (Prog GPUMem -&gt; IO ()) -&gt; Prog GPUMem -&gt; FutharkM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ())
-&gt; (Prog GPUMem -&gt; String) -&gt; Prog GPUMem -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Graph VName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(Graph VName -&gt; String)
-&gt; (Prog GPUMem -&gt; Graph VName) -&gt; Prog GPUMem -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Prog GPUMem -&gt; Graph VName
</span><a href="Futhark.Analysis.Interference.html#analyseProgGPU"><span class="hs-identifier hs-var">Interference.analyseProgGPU</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-comment">-- | Print memory alias information to stdout</span><span>
</span><span id="line-102"></span><span class="annot"><a href="Futhark.Actions.html#printMemAliasGPU"><span class="hs-identifier hs-type">printMemAliasGPU</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span>
</span><span id="line-103"></span><span id="printMemAliasGPU"><span class="annot"><span class="annottext">printMemAliasGPU :: Action GPUMem
</span><a href="Futhark.Actions.html#printMemAliasGPU"><span class="hs-identifier hs-var hs-var">printMemAliasGPU</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><span class="annottext">Action :: forall rep.
String -&gt; String -&gt; (Prog rep -&gt; FutharkM ()) -&gt; Action rep
</span><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">actionName :: String
</span><a href="Futhark.Pipeline.html#actionName"><span class="hs-identifier hs-var">actionName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;print mem alias gpu&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>      </span><span class="annot"><span class="annottext">actionDescription :: String
</span><a href="Futhark.Pipeline.html#actionDescription"><span class="hs-identifier hs-var">actionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Print memory alias information on gpu.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>      </span><span class="annot"><span class="annottext">actionProcedure :: Prog GPUMem -&gt; FutharkM ()
</span><a href="Futhark.Pipeline.html#actionProcedure"><span class="hs-identifier hs-var">actionProcedure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ())
-&gt; (Prog GPUMem -&gt; IO ()) -&gt; Prog GPUMem -&gt; FutharkM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ())
-&gt; (Prog GPUMem -&gt; String) -&gt; Prog GPUMem -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MemAliases -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(MemAliases -&gt; String)
-&gt; (Prog GPUMem -&gt; MemAliases) -&gt; Prog GPUMem -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Prog GPUMem -&gt; MemAliases
</span><a href="Futhark.Analysis.MemAlias.html#analyzeGPUMem"><span class="hs-identifier hs-var">MemAlias.analyzeGPUMem</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">-- | Print call graph to stdout.</span><span>
</span><span id="line-111"></span><span class="annot"><a href="Futhark.Actions.html#callGraphAction"><span class="hs-identifier hs-type">callGraphAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SOACS.html#SOACS"><span class="hs-identifier hs-type">SOACS</span></a></span><span>
</span><span id="line-112"></span><span id="callGraphAction"><span class="annot"><span class="annottext">callGraphAction :: Action SOACS
</span><a href="Futhark.Actions.html#callGraphAction"><span class="hs-identifier hs-var hs-var">callGraphAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-113"></span><span>  </span><span class="annot"><span class="annottext">Action :: forall rep.
String -&gt; String -&gt; (Prog rep -&gt; FutharkM ()) -&gt; Action rep
</span><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">actionName :: String
</span><a href="Futhark.Pipeline.html#actionName"><span class="hs-identifier hs-var">actionName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;call-graph&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-115"></span><span>      </span><span class="annot"><span class="annottext">actionDescription :: String
</span><a href="Futhark.Pipeline.html#actionDescription"><span class="hs-identifier hs-var">actionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Prettyprint the callgraph of the result to standard output.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span>      </span><span class="annot"><span class="annottext">actionProcedure :: Prog SOACS -&gt; FutharkM ()
</span><a href="Futhark.Pipeline.html#actionProcedure"><span class="hs-identifier hs-var">actionProcedure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ())
-&gt; (Prog SOACS -&gt; IO ()) -&gt; Prog SOACS -&gt; FutharkM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; (Prog SOACS -&gt; String) -&gt; Prog SOACS -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CallGraph -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(CallGraph -&gt; String)
-&gt; (Prog SOACS -&gt; CallGraph) -&gt; Prog SOACS -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Prog SOACS -&gt; CallGraph
</span><a href="Futhark.Analysis.CallGraph.html#buildCallGraph"><span class="hs-identifier hs-var">buildCallGraph</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-comment">-- | Print metrics about AST node counts to stdout.</span><span>
</span><span id="line-120"></span><span id="local-6989586621684582800"><span class="annot"><a href="Futhark.Actions.html#metricsAction"><span class="hs-identifier hs-type">metricsAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Analysis.Metrics.html#OpMetrics"><span class="hs-identifier hs-type">OpMetrics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Rep.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684582800"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684582800"><span class="hs-identifier hs-type">rep</span></a></span></span><span>
</span><span id="line-121"></span><span id="metricsAction"><span class="annot"><span class="annottext">metricsAction :: forall rep. OpMetrics (Op rep) =&gt; Action rep
</span><a href="Futhark.Actions.html#metricsAction"><span class="hs-identifier hs-var hs-var">metricsAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-122"></span><span>  </span><span class="annot"><span class="annottext">Action :: forall rep.
String -&gt; String -&gt; (Prog rep -&gt; FutharkM ()) -&gt; Action rep
</span><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">actionName :: String
</span><a href="Futhark.Pipeline.html#actionName"><span class="hs-identifier hs-var">actionName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compute metrics&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-124"></span><span>      </span><span class="annot"><span class="annottext">actionDescription :: String
</span><a href="Futhark.Pipeline.html#actionDescription"><span class="hs-identifier hs-var">actionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Print metrics on the final AST.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-125"></span><span>      </span><span class="annot"><span class="annottext">actionProcedure :: Prog rep -&gt; FutharkM ()
</span><a href="Futhark.Pipeline.html#actionProcedure"><span class="hs-identifier hs-var">actionProcedure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ())
-&gt; (Prog rep -&gt; IO ()) -&gt; Prog rep -&gt; FutharkM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStr</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; (Prog rep -&gt; String) -&gt; Prog rep -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AstMetrics -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(AstMetrics -&gt; String)
-&gt; (Prog rep -&gt; AstMetrics) -&gt; Prog rep -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Prog rep -&gt; AstMetrics
forall rep. OpMetrics (Op rep) =&gt; Prog rep -&gt; AstMetrics
</span><a href="Futhark.Analysis.Metrics.html#progMetrics"><span class="hs-identifier hs-var">progMetrics</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-comment">-- | Convert the program to sequential ImpCode and print it to stdout.</span><span>
</span><span id="line-129"></span><span class="annot"><a href="Futhark.Actions.html#impCodeGenAction"><span class="hs-identifier hs-type">impCodeGenAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SeqMem.html#SeqMem"><span class="hs-identifier hs-type">SeqMem</span></a></span><span>
</span><span id="line-130"></span><span id="impCodeGenAction"><span class="annot"><span class="annottext">impCodeGenAction :: Action SeqMem
</span><a href="Futhark.Actions.html#impCodeGenAction"><span class="hs-identifier hs-var hs-var">impCodeGenAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><span class="annottext">Action :: forall rep.
String -&gt; String -&gt; (Prog rep -&gt; FutharkM ()) -&gt; Action rep
</span><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">actionName :: String
</span><a href="Futhark.Pipeline.html#actionName"><span class="hs-identifier hs-var">actionName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compile imperative&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-133"></span><span>      </span><span class="annot"><span class="annottext">actionDescription :: String
</span><a href="Futhark.Pipeline.html#actionDescription"><span class="hs-identifier hs-var">actionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Translate program into imperative IL and write it on standard output.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-134"></span><span>      </span><span class="annot"><span class="annottext">actionProcedure :: Prog SeqMem -&gt; FutharkM ()
</span><a href="Futhark.Pipeline.html#actionProcedure"><span class="hs-identifier hs-var">actionProcedure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ())
-&gt; ((Warnings, Program) -&gt; IO ())
-&gt; (Warnings, Program)
-&gt; FutharkM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ())
-&gt; ((Warnings, Program) -&gt; String) -&gt; (Warnings, Program) -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Program -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(Program -&gt; String)
-&gt; ((Warnings, Program) -&gt; Program)
-&gt; (Warnings, Program)
-&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Warnings, Program) -&gt; Program
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Warnings, Program) -&gt; FutharkM ())
-&gt; (Prog SeqMem -&gt; FutharkM (Warnings, Program))
-&gt; Prog SeqMem
-&gt; FutharkM ()
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">Prog SeqMem -&gt; FutharkM (Warnings, Program)
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Prog SeqMem -&gt; m (Warnings, Program)
</span><a href="Futhark.CodeGen.ImpGen.Sequential.html#compileProg"><span class="hs-identifier hs-var">ImpGenSequential.compileProg</span></a></span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-comment">-- | Convert the program to GPU ImpCode and print it to stdout.</span><span>
</span><span id="line-138"></span><span class="annot"><a href="Futhark.Actions.html#kernelImpCodeGenAction"><span class="hs-identifier hs-type">kernelImpCodeGenAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span>
</span><span id="line-139"></span><span id="kernelImpCodeGenAction"><span class="annot"><span class="annottext">kernelImpCodeGenAction :: Action GPUMem
</span><a href="Futhark.Actions.html#kernelImpCodeGenAction"><span class="hs-identifier hs-var hs-var">kernelImpCodeGenAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-140"></span><span>  </span><span class="annot"><span class="annottext">Action :: forall rep.
String -&gt; String -&gt; (Prog rep -&gt; FutharkM ()) -&gt; Action rep
</span><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">actionName :: String
</span><a href="Futhark.Pipeline.html#actionName"><span class="hs-identifier hs-var">actionName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compile imperative kernels&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-142"></span><span>      </span><span class="annot"><span class="annottext">actionDescription :: String
</span><a href="Futhark.Pipeline.html#actionDescription"><span class="hs-identifier hs-var">actionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Translate program into imperative IL with kernels and write it on standard output.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-143"></span><span>      </span><span class="annot"><span class="annottext">actionProcedure :: Prog GPUMem -&gt; FutharkM ()
</span><a href="Futhark.Pipeline.html#actionProcedure"><span class="hs-identifier hs-var">actionProcedure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ())
-&gt; ((Warnings, Program) -&gt; IO ())
-&gt; (Warnings, Program)
-&gt; FutharkM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ())
-&gt; ((Warnings, Program) -&gt; String) -&gt; (Warnings, Program) -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Program -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(Program -&gt; String)
-&gt; ((Warnings, Program) -&gt; Program)
-&gt; (Warnings, Program)
-&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Warnings, Program) -&gt; Program
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Warnings, Program) -&gt; FutharkM ())
-&gt; (Prog GPUMem -&gt; FutharkM (Warnings, Program))
-&gt; Prog GPUMem
-&gt; FutharkM ()
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">Prog GPUMem -&gt; FutharkM (Warnings, Program)
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Prog GPUMem -&gt; m (Warnings, Program)
</span><a href="Futhark.CodeGen.ImpGen.GPU.html#compileProgOpenCL"><span class="hs-identifier hs-var">ImpGenGPU.compileProgOpenCL</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-comment">-- | Convert the program to CPU multicore ImpCode and print it to stdout.</span><span>
</span><span id="line-147"></span><span class="annot"><a href="Futhark.Actions.html#multicoreImpCodeGenAction"><span class="hs-identifier hs-type">multicoreImpCodeGenAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.MCMem.html#MCMem"><span class="hs-identifier hs-type">MCMem</span></a></span><span>
</span><span id="line-148"></span><span id="multicoreImpCodeGenAction"><span class="annot"><span class="annottext">multicoreImpCodeGenAction :: Action MCMem
</span><a href="Futhark.Actions.html#multicoreImpCodeGenAction"><span class="hs-identifier hs-var hs-var">multicoreImpCodeGenAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-149"></span><span>  </span><span class="annot"><span class="annottext">Action :: forall rep.
String -&gt; String -&gt; (Prog rep -&gt; FutharkM ()) -&gt; Action rep
</span><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">actionName :: String
</span><a href="Futhark.Pipeline.html#actionName"><span class="hs-identifier hs-var">actionName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compile to imperative multicore&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-151"></span><span>      </span><span class="annot"><span class="annottext">actionDescription :: String
</span><a href="Futhark.Pipeline.html#actionDescription"><span class="hs-identifier hs-var">actionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Translate program into imperative multicore IL and write it on standard output.&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-152"></span><span>      </span><span class="annot"><span class="annottext">actionProcedure :: Prog MCMem -&gt; FutharkM ()
</span><a href="Futhark.Pipeline.html#actionProcedure"><span class="hs-identifier hs-var">actionProcedure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ())
-&gt; ((Warnings, Definitions Multicore) -&gt; IO ())
-&gt; (Warnings, Definitions Multicore)
-&gt; FutharkM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ())
-&gt; ((Warnings, Definitions Multicore) -&gt; String)
-&gt; (Warnings, Definitions Multicore)
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Definitions Multicore -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(Definitions Multicore -&gt; String)
-&gt; ((Warnings, Definitions Multicore) -&gt; Definitions Multicore)
-&gt; (Warnings, Definitions Multicore)
-&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Warnings, Definitions Multicore) -&gt; Definitions Multicore
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Warnings, Definitions Multicore) -&gt; FutharkM ())
-&gt; (Prog MCMem -&gt; FutharkM (Warnings, Definitions Multicore))
-&gt; Prog MCMem
-&gt; FutharkM ()
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">Prog MCMem -&gt; FutharkM (Warnings, Definitions Multicore)
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Prog MCMem -&gt; m (Warnings, Definitions Multicore)
</span><a href="Futhark.CodeGen.ImpGen.Multicore.html#compileProg"><span class="hs-identifier hs-var">ImpGenMulticore.compileProg</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="hs-comment">-- Lines that we prepend (in comments) to generated code.</span><span>
</span><span id="line-156"></span><span class="annot"><a href="Futhark.Actions.html#headerLines"><span class="hs-identifier hs-type">headerLines</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span>
</span><span id="line-157"></span><span id="headerLines"><span class="annot"><span class="annottext">headerLines :: [Text]
</span><a href="Futhark.Actions.html#headerLines"><span class="hs-identifier hs-var hs-var">headerLines</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text]
</span><span class="hs-identifier hs-var">T.lines</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Text]) -&gt; Text -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Generated by Futhark &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Futhark.Version.html#versionString"><span class="hs-identifier hs-var">versionString</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="annot"><a href="Futhark.Actions.html#cHeaderLines"><span class="hs-identifier hs-type">cHeaderLines</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span>
</span><span id="line-160"></span><span id="cHeaderLines"><span class="annot"><span class="annottext">cHeaderLines :: [Text]
</span><a href="Futhark.Actions.html#cHeaderLines"><span class="hs-identifier hs-var hs-var">cHeaderLines</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; [Text] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;// &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="Futhark.Actions.html#headerLines"><span class="hs-identifier hs-var">headerLines</span></a></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="annot"><a href="Futhark.Actions.html#pyHeaderLines"><span class="hs-identifier hs-type">pyHeaderLines</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span>
</span><span id="line-163"></span><span id="pyHeaderLines"><span class="annot"><span class="annottext">pyHeaderLines :: [Text]
</span><a href="Futhark.Actions.html#pyHeaderLines"><span class="hs-identifier hs-var hs-var">pyHeaderLines</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; [Text] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;# &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="Futhark.Actions.html#headerLines"><span class="hs-identifier hs-var">headerLines</span></a></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="annot"><a href="Futhark.Actions.html#cPrependHeader"><span class="hs-identifier hs-type">cPrependHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-166"></span><span id="cPrependHeader"><span class="annot"><span class="annottext">cPrependHeader :: Text -&gt; Text
</span><a href="Futhark.Actions.html#cPrependHeader"><span class="hs-identifier hs-var hs-var">cPrependHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.unlines</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="Futhark.Actions.html#cHeaderLines"><span class="hs-identifier hs-var">cHeaderLines</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="annot"><a href="Futhark.Actions.html#pyPrependHeader"><span class="hs-identifier hs-type">pyPrependHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-169"></span><span id="pyPrependHeader"><span class="annot"><span class="annottext">pyPrependHeader :: Text -&gt; Text
</span><a href="Futhark.Actions.html#pyPrependHeader"><span class="hs-identifier hs-var hs-var">pyPrependHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.unlines</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="Futhark.Actions.html#pyHeaderLines"><span class="hs-identifier hs-var">pyHeaderLines</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="annot"><a href="Futhark.Actions.html#cmdCC"><span class="hs-identifier hs-type">cmdCC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-172"></span><span id="cmdCC"><span class="annot"><span class="annottext">cmdCC :: String
</span><a href="Futhark.Actions.html#cmdCC"><span class="hs-identifier hs-var hs-var">cmdCC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; String
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cc&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; String) -&gt; Maybe String -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [(String, String)] -&gt; Maybe String
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CC&quot;</span></span><span> </span><span class="annot"><span class="annottext">[(String, String)]
</span><a href="Futhark.Util.html#unixEnvironment"><span class="hs-identifier hs-var">unixEnvironment</span></a></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="annot"><a href="Futhark.Actions.html#cmdCFLAGS"><span class="hs-identifier hs-type">cmdCFLAGS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>
</span><span id="line-175"></span><span id="cmdCFLAGS"><span class="annot"><span class="annottext">cmdCFLAGS :: [String] -&gt; [String]
</span><a href="Futhark.Actions.html#cmdCFLAGS"><span class="hs-identifier hs-var hs-var">cmdCFLAGS</span></a></span></span><span> </span><span id="local-6989586621684582559"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582559"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; (String -&gt; [String]) -&gt; Maybe String -&gt; [String]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582559"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><span class="hs-identifier hs-var">words</span></span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; [String]) -&gt; Maybe String -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [(String, String)] -&gt; Maybe String
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CFLAGS&quot;</span></span><span> </span><span class="annot"><span class="annottext">[(String, String)]
</span><a href="Futhark.Util.html#unixEnvironment"><span class="hs-identifier hs-var">unixEnvironment</span></a></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="annot"><a href="Futhark.Actions.html#runCC"><span class="hs-identifier hs-type">runCC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#FutharkM"><span class="hs-identifier hs-type">FutharkM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span id="runCC"><span class="annot"><span class="annottext">runCC :: String -&gt; String -&gt; [String] -&gt; [String] -&gt; FutharkM ()
</span><a href="Futhark.Actions.html#runCC"><span class="hs-identifier hs-var hs-var">runCC</span></a></span></span><span> </span><span id="local-6989586621684582555"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582555"><span class="hs-identifier hs-var">cpath</span></a></span></span><span> </span><span id="local-6989586621684582554"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582554"><span class="hs-identifier hs-var">outpath</span></a></span></span><span> </span><span id="local-6989586621684582553"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582553"><span class="hs-identifier hs-var">cflags_def</span></a></span></span><span> </span><span id="local-6989586621684582552"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582552"><span class="hs-identifier hs-var">ldflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-179"></span><span>  </span><span id="local-6989586621684582551"><span class="annot"><span class="annottext">Either IOException (ExitCode, String, String)
</span><a href="#local-6989586621684582551"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><span class="annottext">IO (Either IOException (ExitCode, String, String))
-&gt; FutharkM (Either IOException (ExitCode, String, String))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either IOException (ExitCode, String, String))
 -&gt; FutharkM (Either IOException (ExitCode, String, String)))
-&gt; IO (Either IOException (ExitCode, String, String))
-&gt; FutharkM (Either IOException (ExitCode, String, String))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-181"></span><span>      </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; ByteString
-&gt; IO (Either IOException (ExitCode, String, String))
</span><a href="Futhark.Util.html#runProgramWithExitCode"><span class="hs-identifier hs-var">runProgramWithExitCode</span></a></span><span>
</span><span id="line-182"></span><span>        </span><span class="annot"><span class="annottext">String
</span><a href="Futhark.Actions.html#cmdCC"><span class="hs-identifier hs-var">cmdCC</span></a></span><span>
</span><span id="line-183"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582555"><span class="hs-identifier hs-var">cpath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-o&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582554"><span class="hs-identifier hs-var">outpath</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-184"></span><span>            </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String]
</span><a href="Futhark.Actions.html#cmdCFLAGS"><span class="hs-identifier hs-var">cmdCFLAGS</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582553"><span class="hs-identifier hs-var">cflags_def</span></a></span><span>
</span><span id="line-185"></span><span>            </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-186"></span><span>            </span><span class="hs-comment">-- The default LDFLAGS are always added.</span><span>
</span><span id="line-187"></span><span>            </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582552"><span class="hs-identifier hs-var">ldflags</span></a></span><span>
</span><span id="line-188"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>        </span><span class="annot"><span class="annottext">ByteString
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOException (ExitCode, String, String)
</span><a href="#local-6989586621684582551"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621684582550"><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621684582550"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-192"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadError CompilerError m =&gt; String -&gt; m a
</span><a href="Futhark.Error.html#externalErrorS"><span class="hs-identifier hs-var">externalErrorS</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; FutharkM ()) -&gt; String -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Failed to run &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Futhark.Actions.html#cmdCC"><span class="hs-identifier hs-var">cmdCC</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">IOException -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621684582550"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ExitFailure</span></span><span> </span><span id="local-6989586621684582547"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684582547"><span class="hs-identifier hs-var">code</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684582546"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582546"><span class="hs-identifier hs-var">gccerr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-194"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadError CompilerError m =&gt; String -&gt; m a
</span><a href="Futhark.Error.html#externalErrorS"><span class="hs-identifier hs-var">externalErrorS</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; FutharkM ()) -&gt; String -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-195"></span><span>        </span><span class="annot"><span class="annottext">String
</span><a href="Futhark.Actions.html#cmdCC"><span class="hs-identifier hs-var">cmdCC</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; failed with code &quot;</span></span><span>
</span><span id="line-196"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684582547"><span class="hs-identifier hs-var">code</span></a></span><span>
</span><span id="line-197"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:\n&quot;</span></span><span>
</span><span id="line-198"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582546"><span class="hs-identifier hs-var">gccerr</span></a></span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExitCode
</span><span class="hs-identifier hs-var">ExitSuccess</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-200"></span><span>      </span><span class="annot"><span class="annottext">() -&gt; FutharkM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="hs-comment">-- | The @futhark c@ action.</span><span>
</span><span id="line-203"></span><span class="annot"><a href="Futhark.Actions.html#compileCAction"><span class="hs-identifier hs-type">compileCAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Compiler.Config.html#FutharkConfig"><span class="hs-identifier hs-type">FutharkConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Compiler.CLI.html#CompilerMode"><span class="hs-identifier hs-type">CompilerMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SeqMem.html#SeqMem"><span class="hs-identifier hs-type">SeqMem</span></a></span><span>
</span><span id="line-204"></span><span id="compileCAction"><span class="annot"><span class="annottext">compileCAction :: FutharkConfig -&gt; CompilerMode -&gt; String -&gt; Action SeqMem
</span><a href="Futhark.Actions.html#compileCAction"><span class="hs-identifier hs-var hs-var">compileCAction</span></a></span></span><span> </span><span id="local-6989586621684582543"><span class="annot"><span class="annottext">FutharkConfig
</span><a href="#local-6989586621684582543"><span class="hs-identifier hs-var">fcfg</span></a></span></span><span> </span><span id="local-6989586621684582542"><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684582542"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621684582541"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582541"><span class="hs-identifier hs-var">outpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-205"></span><span>  </span><span class="annot"><span class="annottext">Action :: forall rep.
String -&gt; String -&gt; (Prog rep -&gt; FutharkM ()) -&gt; Action rep
</span><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">actionName :: String
</span><a href="Futhark.Pipeline.html#actionName"><span class="hs-identifier hs-var">actionName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compile to sequential C&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-207"></span><span>      </span><span class="annot"><span class="annottext">actionDescription :: String
</span><a href="Futhark.Pipeline.html#actionDescription"><span class="hs-identifier hs-var">actionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compile to sequential C&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-208"></span><span>      </span><span class="annot"><span class="annottext">actionProcedure :: Prog SeqMem -&gt; FutharkM ()
</span><a href="Futhark.Pipeline.html#actionProcedure"><span class="hs-identifier hs-var">actionProcedure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Prog SeqMem -&gt; FutharkM ()
</span><a href="#local-6989586621684582540"><span class="hs-identifier hs-var">helper</span></a></span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-211"></span><span>    </span><span id="local-6989586621684582540"><span class="annot"><span class="annottext">helper :: Prog SeqMem -&gt; FutharkM ()
</span><a href="#local-6989586621684582540"><span class="hs-identifier hs-var hs-var">helper</span></a></span></span><span> </span><span id="local-6989586621684582528"><span class="annot"><span class="annottext">Prog SeqMem
</span><a href="#local-6989586621684582528"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-212"></span><span>      </span><span id="local-6989586621684582527"><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582527"><span class="hs-identifier hs-var">cprog</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FutharkConfig -&gt; FutharkM (Warnings, CParts) -&gt; FutharkM CParts
forall a. FutharkConfig -&gt; FutharkM (Warnings, a) -&gt; FutharkM a
</span><a href="Futhark.Compiler.html#handleWarnings"><span class="hs-identifier hs-var">handleWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">FutharkConfig
</span><a href="#local-6989586621684582543"><span class="hs-identifier hs-var">fcfg</span></a></span><span> </span><span class="annot"><span class="annottext">(FutharkM (Warnings, CParts) -&gt; FutharkM CParts)
-&gt; FutharkM (Warnings, CParts) -&gt; FutharkM CParts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Prog SeqMem -&gt; FutharkM (Warnings, CParts)
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Text -&gt; Prog SeqMem -&gt; m (Warnings, CParts)
</span><a href="Futhark.CodeGen.Backends.SequentialC.html#compileProg"><span class="hs-identifier hs-var">SequentialC.compileProg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Futhark.Version.html#versionString"><span class="hs-identifier hs-var">versionString</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Prog SeqMem
</span><a href="#local-6989586621684582528"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-213"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684582524"><span class="annot"><span class="annottext">cpath :: String
</span><a href="#local-6989586621684582524"><span class="hs-identifier hs-var hs-var">cpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582541"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;c&quot;</span></span><span>
</span><span id="line-214"></span><span>          </span><span id="local-6989586621684582522"><span class="annot"><span class="annottext">hpath :: String
</span><a href="#local-6989586621684582522"><span class="hs-identifier hs-var hs-var">hpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582541"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h&quot;</span></span><span>
</span><span id="line-215"></span><span>          </span><span id="local-6989586621684582521"><span class="annot"><span class="annottext">jsonpath :: String
</span><a href="#local-6989586621684582521"><span class="hs-identifier hs-var hs-var">jsonpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582541"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;json&quot;</span></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684582542"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-218"></span><span>        </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="Futhark.Compiler.CLI.html#ToLibrary"><span class="hs-identifier hs-var">ToLibrary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-219"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684582519"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582519"><span class="hs-identifier hs-var">header</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684582518"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582518"><span class="hs-identifier hs-var">impl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684582517"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582517"><span class="hs-identifier hs-var">manifest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CParts -&gt; (Text, Text, Text)
</span><a href="Futhark.CodeGen.Backends.GenericC.html#asLibrary"><span class="hs-identifier hs-var">SequentialC.asLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582527"><span class="hs-identifier hs-var">cprog</span></a></span><span>
</span><span id="line-220"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582522"><span class="hs-identifier hs-var">hpath</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Futhark.Actions.html#cPrependHeader"><span class="hs-identifier hs-var">cPrependHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582519"><span class="hs-identifier hs-var">header</span></a></span><span>
</span><span id="line-221"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582524"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Futhark.Actions.html#cPrependHeader"><span class="hs-identifier hs-var">cPrependHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582518"><span class="hs-identifier hs-var">impl</span></a></span><span>
</span><span id="line-222"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582521"><span class="hs-identifier hs-var">jsonpath</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582517"><span class="hs-identifier hs-var">manifest</span></a></span><span>
</span><span id="line-223"></span><span>        </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="Futhark.Compiler.CLI.html#ToExecutable"><span class="hs-identifier hs-var">ToExecutable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-224"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582524"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CParts -&gt; Text
</span><a href="Futhark.CodeGen.Backends.GenericC.html#asExecutable"><span class="hs-identifier hs-var">SequentialC.asExecutable</span></a></span><span> </span><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582527"><span class="hs-identifier hs-var">cprog</span></a></span><span>
</span><span id="line-225"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; [String] -&gt; [String] -&gt; FutharkM ()
</span><a href="Futhark.Actions.html#runCC"><span class="hs-identifier hs-var">runCC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582524"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582541"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O3&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-std=c99&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-lm&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-226"></span><span>        </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="Futhark.Compiler.CLI.html#ToServer"><span class="hs-identifier hs-var">ToServer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-227"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582524"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CParts -&gt; Text
</span><a href="Futhark.CodeGen.Backends.GenericC.html#asServer"><span class="hs-identifier hs-var">SequentialC.asServer</span></a></span><span> </span><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582527"><span class="hs-identifier hs-var">cprog</span></a></span><span>
</span><span id="line-228"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; [String] -&gt; [String] -&gt; FutharkM ()
</span><a href="Futhark.Actions.html#runCC"><span class="hs-identifier hs-var">runCC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582524"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582541"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O3&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-std=c99&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-lm&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="hs-comment">-- | The @futhark opencl@ action.</span><span>
</span><span id="line-231"></span><span class="annot"><a href="Futhark.Actions.html#compileOpenCLAction"><span class="hs-identifier hs-type">compileOpenCLAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Compiler.Config.html#FutharkConfig"><span class="hs-identifier hs-type">FutharkConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Compiler.CLI.html#CompilerMode"><span class="hs-identifier hs-type">CompilerMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span>
</span><span id="line-232"></span><span id="compileOpenCLAction"><span class="annot"><span class="annottext">compileOpenCLAction :: FutharkConfig -&gt; CompilerMode -&gt; String -&gt; Action GPUMem
</span><a href="Futhark.Actions.html#compileOpenCLAction"><span class="hs-identifier hs-var hs-var">compileOpenCLAction</span></a></span></span><span> </span><span id="local-6989586621684582510"><span class="annot"><span class="annottext">FutharkConfig
</span><a href="#local-6989586621684582510"><span class="hs-identifier hs-var">fcfg</span></a></span></span><span> </span><span id="local-6989586621684582509"><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684582509"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621684582508"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582508"><span class="hs-identifier hs-var">outpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-233"></span><span>  </span><span class="annot"><span class="annottext">Action :: forall rep.
String -&gt; String -&gt; (Prog rep -&gt; FutharkM ()) -&gt; Action rep
</span><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">actionName :: String
</span><a href="Futhark.Pipeline.html#actionName"><span class="hs-identifier hs-var">actionName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compile to OpenCL&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-235"></span><span>      </span><span class="annot"><span class="annottext">actionDescription :: String
</span><a href="Futhark.Pipeline.html#actionDescription"><span class="hs-identifier hs-var">actionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compile to OpenCL&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-236"></span><span>      </span><span class="annot"><span class="annottext">actionProcedure :: Prog GPUMem -&gt; FutharkM ()
</span><a href="Futhark.Pipeline.html#actionProcedure"><span class="hs-identifier hs-var">actionProcedure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Prog GPUMem -&gt; FutharkM ()
</span><a href="#local-6989586621684582507"><span class="hs-identifier hs-var">helper</span></a></span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-239"></span><span>    </span><span id="local-6989586621684582507"><span class="annot"><span class="annottext">helper :: Prog GPUMem -&gt; FutharkM ()
</span><a href="#local-6989586621684582507"><span class="hs-identifier hs-var hs-var">helper</span></a></span></span><span> </span><span id="local-6989586621684582492"><span class="annot"><span class="annottext">Prog GPUMem
</span><a href="#local-6989586621684582492"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-240"></span><span>      </span><span id="local-6989586621684582491"><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582491"><span class="hs-identifier hs-var">cprog</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FutharkConfig -&gt; FutharkM (Warnings, CParts) -&gt; FutharkM CParts
forall a. FutharkConfig -&gt; FutharkM (Warnings, a) -&gt; FutharkM a
</span><a href="Futhark.Compiler.html#handleWarnings"><span class="hs-identifier hs-var">handleWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">FutharkConfig
</span><a href="#local-6989586621684582510"><span class="hs-identifier hs-var">fcfg</span></a></span><span> </span><span class="annot"><span class="annottext">(FutharkM (Warnings, CParts) -&gt; FutharkM CParts)
-&gt; FutharkM (Warnings, CParts) -&gt; FutharkM CParts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Prog GPUMem -&gt; FutharkM (Warnings, CParts)
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Text -&gt; Prog GPUMem -&gt; m (Warnings, CParts)
</span><a href="Futhark.CodeGen.Backends.COpenCL.html#compileProg"><span class="hs-identifier hs-var">COpenCL.compileProg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Futhark.Version.html#versionString"><span class="hs-identifier hs-var">versionString</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Prog GPUMem
</span><a href="#local-6989586621684582492"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-241"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684582489"><span class="annot"><span class="annottext">cpath :: String
</span><a href="#local-6989586621684582489"><span class="hs-identifier hs-var hs-var">cpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582508"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;c&quot;</span></span><span>
</span><span id="line-242"></span><span>          </span><span id="local-6989586621684582488"><span class="annot"><span class="annottext">hpath :: String
</span><a href="#local-6989586621684582488"><span class="hs-identifier hs-var hs-var">hpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582508"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h&quot;</span></span><span>
</span><span id="line-243"></span><span>          </span><span id="local-6989586621684582487"><span class="annot"><span class="annottext">jsonpath :: String
</span><a href="#local-6989586621684582487"><span class="hs-identifier hs-var hs-var">jsonpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582508"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;json&quot;</span></span><span>
</span><span id="line-244"></span><span>          </span><span id="local-6989586621684582476"><span class="annot"><span class="annottext">extra_options :: [String]
</span><a href="#local-6989586621684582476"><span class="hs-identifier hs-var hs-var">extra_options</span></a></span></span><span>
</span><span id="line-245"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier hs-var">System.Info.os</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;darwin&quot;</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-246"></span><span>              </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-framework&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;OpenCL&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-247"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier hs-var">System.Info.os</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mingw32&quot;</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-248"></span><span>              </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-lOpenCL64&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-249"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-250"></span><span>              </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-lOpenCL&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684582509"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-253"></span><span>        </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="Futhark.Compiler.CLI.html#ToLibrary"><span class="hs-identifier hs-var">ToLibrary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-254"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684582474"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582474"><span class="hs-identifier hs-var">header</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684582473"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582473"><span class="hs-identifier hs-var">impl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684582472"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582472"><span class="hs-identifier hs-var">manifest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CParts -&gt; (Text, Text, Text)
</span><a href="Futhark.CodeGen.Backends.GenericC.html#asLibrary"><span class="hs-identifier hs-var">COpenCL.asLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582491"><span class="hs-identifier hs-var">cprog</span></a></span><span>
</span><span id="line-255"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582488"><span class="hs-identifier hs-var">hpath</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Futhark.Actions.html#cPrependHeader"><span class="hs-identifier hs-var">cPrependHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582474"><span class="hs-identifier hs-var">header</span></a></span><span>
</span><span id="line-256"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582489"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Futhark.Actions.html#cPrependHeader"><span class="hs-identifier hs-var">cPrependHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582473"><span class="hs-identifier hs-var">impl</span></a></span><span>
</span><span id="line-257"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582487"><span class="hs-identifier hs-var">jsonpath</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582472"><span class="hs-identifier hs-var">manifest</span></a></span><span>
</span><span id="line-258"></span><span>        </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="Futhark.Compiler.CLI.html#ToExecutable"><span class="hs-identifier hs-var">ToExecutable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-259"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582489"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Futhark.Actions.html#cPrependHeader"><span class="hs-identifier hs-var">cPrependHeader</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CParts -&gt; Text
</span><a href="Futhark.CodeGen.Backends.GenericC.html#asExecutable"><span class="hs-identifier hs-var">COpenCL.asExecutable</span></a></span><span> </span><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582491"><span class="hs-identifier hs-var">cprog</span></a></span><span>
</span><span id="line-260"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; [String] -&gt; [String] -&gt; FutharkM ()
</span><a href="Futhark.Actions.html#runCC"><span class="hs-identifier hs-var">runCC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582489"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582508"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-std=c99&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-lm&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582476"><span class="hs-identifier hs-var">extra_options</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>        </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="Futhark.Compiler.CLI.html#ToServer"><span class="hs-identifier hs-var">ToServer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-262"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582489"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Futhark.Actions.html#cPrependHeader"><span class="hs-identifier hs-var">cPrependHeader</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CParts -&gt; Text
</span><a href="Futhark.CodeGen.Backends.GenericC.html#asServer"><span class="hs-identifier hs-var">COpenCL.asServer</span></a></span><span> </span><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582491"><span class="hs-identifier hs-var">cprog</span></a></span><span>
</span><span id="line-263"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; [String] -&gt; [String] -&gt; FutharkM ()
</span><a href="Futhark.Actions.html#runCC"><span class="hs-identifier hs-var">runCC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582489"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582508"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-std=c99&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-lm&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582476"><span class="hs-identifier hs-var">extra_options</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span class="hs-comment">-- | The @futhark cuda@ action.</span><span>
</span><span id="line-266"></span><span class="annot"><a href="Futhark.Actions.html#compileCUDAAction"><span class="hs-identifier hs-type">compileCUDAAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Compiler.Config.html#FutharkConfig"><span class="hs-identifier hs-type">FutharkConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Compiler.CLI.html#CompilerMode"><span class="hs-identifier hs-type">CompilerMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span>
</span><span id="line-267"></span><span id="compileCUDAAction"><span class="annot"><span class="annottext">compileCUDAAction :: FutharkConfig -&gt; CompilerMode -&gt; String -&gt; Action GPUMem
</span><a href="Futhark.Actions.html#compileCUDAAction"><span class="hs-identifier hs-var hs-var">compileCUDAAction</span></a></span></span><span> </span><span id="local-6989586621684582471"><span class="annot"><span class="annottext">FutharkConfig
</span><a href="#local-6989586621684582471"><span class="hs-identifier hs-var">fcfg</span></a></span></span><span> </span><span id="local-6989586621684582470"><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684582470"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621684582469"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582469"><span class="hs-identifier hs-var">outpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-268"></span><span>  </span><span class="annot"><span class="annottext">Action :: forall rep.
String -&gt; String -&gt; (Prog rep -&gt; FutharkM ()) -&gt; Action rep
</span><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">actionName :: String
</span><a href="Futhark.Pipeline.html#actionName"><span class="hs-identifier hs-var">actionName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compile to CUDA&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-270"></span><span>      </span><span class="annot"><span class="annottext">actionDescription :: String
</span><a href="Futhark.Pipeline.html#actionDescription"><span class="hs-identifier hs-var">actionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compile to CUDA&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-271"></span><span>      </span><span class="annot"><span class="annottext">actionProcedure :: Prog GPUMem -&gt; FutharkM ()
</span><a href="Futhark.Pipeline.html#actionProcedure"><span class="hs-identifier hs-var">actionProcedure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Prog GPUMem -&gt; FutharkM ()
</span><a href="#local-6989586621684582468"><span class="hs-identifier hs-var">helper</span></a></span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-273"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-274"></span><span>    </span><span id="local-6989586621684582468"><span class="annot"><span class="annottext">helper :: Prog GPUMem -&gt; FutharkM ()
</span><a href="#local-6989586621684582468"><span class="hs-identifier hs-var hs-var">helper</span></a></span></span><span> </span><span id="local-6989586621684582453"><span class="annot"><span class="annottext">Prog GPUMem
</span><a href="#local-6989586621684582453"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-275"></span><span>      </span><span id="local-6989586621684582452"><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582452"><span class="hs-identifier hs-var">cprog</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FutharkConfig -&gt; FutharkM (Warnings, CParts) -&gt; FutharkM CParts
forall a. FutharkConfig -&gt; FutharkM (Warnings, a) -&gt; FutharkM a
</span><a href="Futhark.Compiler.html#handleWarnings"><span class="hs-identifier hs-var">handleWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">FutharkConfig
</span><a href="#local-6989586621684582471"><span class="hs-identifier hs-var">fcfg</span></a></span><span> </span><span class="annot"><span class="annottext">(FutharkM (Warnings, CParts) -&gt; FutharkM CParts)
-&gt; FutharkM (Warnings, CParts) -&gt; FutharkM CParts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Prog GPUMem -&gt; FutharkM (Warnings, CParts)
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Text -&gt; Prog GPUMem -&gt; m (Warnings, CParts)
</span><a href="Futhark.CodeGen.Backends.CCUDA.html#compileProg"><span class="hs-identifier hs-var">CCUDA.compileProg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Futhark.Version.html#versionString"><span class="hs-identifier hs-var">versionString</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Prog GPUMem
</span><a href="#local-6989586621684582453"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-276"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684582450"><span class="annot"><span class="annottext">cpath :: String
</span><a href="#local-6989586621684582450"><span class="hs-identifier hs-var hs-var">cpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582469"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;c&quot;</span></span><span>
</span><span id="line-277"></span><span>          </span><span id="local-6989586621684582449"><span class="annot"><span class="annottext">hpath :: String
</span><a href="#local-6989586621684582449"><span class="hs-identifier hs-var hs-var">hpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582469"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h&quot;</span></span><span>
</span><span id="line-278"></span><span>          </span><span id="local-6989586621684582448"><span class="annot"><span class="annottext">jsonpath :: String
</span><a href="#local-6989586621684582448"><span class="hs-identifier hs-var hs-var">jsonpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582469"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;json&quot;</span></span><span>
</span><span id="line-279"></span><span>          </span><span id="local-6989586621684582444"><span class="annot"><span class="annottext">extra_options :: [String]
</span><a href="#local-6989586621684582444"><span class="hs-identifier hs-var hs-var">extra_options</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-280"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-lcuda&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-281"></span><span>              </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-lcudart&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-282"></span><span>              </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-lnvrtc&quot;</span></span><span>
</span><span id="line-283"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-284"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684582470"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-285"></span><span>        </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="Futhark.Compiler.CLI.html#ToLibrary"><span class="hs-identifier hs-var">ToLibrary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-286"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684582443"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582443"><span class="hs-identifier hs-var">header</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684582442"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582442"><span class="hs-identifier hs-var">impl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684582441"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582441"><span class="hs-identifier hs-var">manifest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CParts -&gt; (Text, Text, Text)
</span><a href="Futhark.CodeGen.Backends.GenericC.html#asLibrary"><span class="hs-identifier hs-var">CCUDA.asLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582452"><span class="hs-identifier hs-var">cprog</span></a></span><span>
</span><span id="line-287"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582449"><span class="hs-identifier hs-var">hpath</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Futhark.Actions.html#cPrependHeader"><span class="hs-identifier hs-var">cPrependHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582443"><span class="hs-identifier hs-var">header</span></a></span><span>
</span><span id="line-288"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582450"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Futhark.Actions.html#cPrependHeader"><span class="hs-identifier hs-var">cPrependHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582442"><span class="hs-identifier hs-var">impl</span></a></span><span>
</span><span id="line-289"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582448"><span class="hs-identifier hs-var">jsonpath</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582441"><span class="hs-identifier hs-var">manifest</span></a></span><span>
</span><span id="line-290"></span><span>        </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="Futhark.Compiler.CLI.html#ToExecutable"><span class="hs-identifier hs-var">ToExecutable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-291"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582450"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Futhark.Actions.html#cPrependHeader"><span class="hs-identifier hs-var">cPrependHeader</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CParts -&gt; Text
</span><a href="Futhark.CodeGen.Backends.GenericC.html#asExecutable"><span class="hs-identifier hs-var">CCUDA.asExecutable</span></a></span><span> </span><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582452"><span class="hs-identifier hs-var">cprog</span></a></span><span>
</span><span id="line-292"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; [String] -&gt; [String] -&gt; FutharkM ()
</span><a href="Futhark.Actions.html#runCC"><span class="hs-identifier hs-var">runCC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582450"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582469"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-std=c99&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-lm&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582444"><span class="hs-identifier hs-var">extra_options</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>        </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="Futhark.Compiler.CLI.html#ToServer"><span class="hs-identifier hs-var">ToServer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-294"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582450"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Futhark.Actions.html#cPrependHeader"><span class="hs-identifier hs-var">cPrependHeader</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CParts -&gt; Text
</span><a href="Futhark.CodeGen.Backends.GenericC.html#asServer"><span class="hs-identifier hs-var">CCUDA.asServer</span></a></span><span> </span><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582452"><span class="hs-identifier hs-var">cprog</span></a></span><span>
</span><span id="line-295"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; [String] -&gt; [String] -&gt; FutharkM ()
</span><a href="Futhark.Actions.html#runCC"><span class="hs-identifier hs-var">runCC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582450"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582469"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-std=c99&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-lm&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582444"><span class="hs-identifier hs-var">extra_options</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="hs-comment">-- | The @futhark multicore@ action.</span><span>
</span><span id="line-298"></span><span class="annot"><a href="Futhark.Actions.html#compileMulticoreAction"><span class="hs-identifier hs-type">compileMulticoreAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Compiler.Config.html#FutharkConfig"><span class="hs-identifier hs-type">FutharkConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Compiler.CLI.html#CompilerMode"><span class="hs-identifier hs-type">CompilerMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.MCMem.html#MCMem"><span class="hs-identifier hs-type">MCMem</span></a></span><span>
</span><span id="line-299"></span><span id="compileMulticoreAction"><span class="annot"><span class="annottext">compileMulticoreAction :: FutharkConfig -&gt; CompilerMode -&gt; String -&gt; Action MCMem
</span><a href="Futhark.Actions.html#compileMulticoreAction"><span class="hs-identifier hs-var hs-var">compileMulticoreAction</span></a></span></span><span> </span><span id="local-6989586621684582440"><span class="annot"><span class="annottext">FutharkConfig
</span><a href="#local-6989586621684582440"><span class="hs-identifier hs-var">fcfg</span></a></span></span><span> </span><span id="local-6989586621684582439"><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684582439"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621684582438"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582438"><span class="hs-identifier hs-var">outpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-300"></span><span>  </span><span class="annot"><span class="annottext">Action :: forall rep.
String -&gt; String -&gt; (Prog rep -&gt; FutharkM ()) -&gt; Action rep
</span><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">actionName :: String
</span><a href="Futhark.Pipeline.html#actionName"><span class="hs-identifier hs-var">actionName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compile to multicore&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-302"></span><span>      </span><span class="annot"><span class="annottext">actionDescription :: String
</span><a href="Futhark.Pipeline.html#actionDescription"><span class="hs-identifier hs-var">actionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compile to multicore&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-303"></span><span>      </span><span class="annot"><span class="annottext">actionProcedure :: Prog MCMem -&gt; FutharkM ()
</span><a href="Futhark.Pipeline.html#actionProcedure"><span class="hs-identifier hs-var">actionProcedure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Prog MCMem -&gt; FutharkM ()
</span><a href="#local-6989586621684582437"><span class="hs-identifier hs-var">helper</span></a></span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-306"></span><span>    </span><span id="local-6989586621684582437"><span class="annot"><span class="annottext">helper :: Prog MCMem -&gt; FutharkM ()
</span><a href="#local-6989586621684582437"><span class="hs-identifier hs-var hs-var">helper</span></a></span></span><span> </span><span id="local-6989586621684582425"><span class="annot"><span class="annottext">Prog MCMem
</span><a href="#local-6989586621684582425"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-307"></span><span>      </span><span id="local-6989586621684582424"><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582424"><span class="hs-identifier hs-var">cprog</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FutharkConfig -&gt; FutharkM (Warnings, CParts) -&gt; FutharkM CParts
forall a. FutharkConfig -&gt; FutharkM (Warnings, a) -&gt; FutharkM a
</span><a href="Futhark.Compiler.html#handleWarnings"><span class="hs-identifier hs-var">handleWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">FutharkConfig
</span><a href="#local-6989586621684582440"><span class="hs-identifier hs-var">fcfg</span></a></span><span> </span><span class="annot"><span class="annottext">(FutharkM (Warnings, CParts) -&gt; FutharkM CParts)
-&gt; FutharkM (Warnings, CParts) -&gt; FutharkM CParts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Prog MCMem -&gt; FutharkM (Warnings, CParts)
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Text -&gt; Prog MCMem -&gt; m (Warnings, CParts)
</span><a href="Futhark.CodeGen.Backends.MulticoreC.html#compileProg"><span class="hs-identifier hs-var">MulticoreC.compileProg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Futhark.Version.html#versionString"><span class="hs-identifier hs-var">versionString</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Prog MCMem
</span><a href="#local-6989586621684582425"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-308"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684582422"><span class="annot"><span class="annottext">cpath :: String
</span><a href="#local-6989586621684582422"><span class="hs-identifier hs-var hs-var">cpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582438"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;c&quot;</span></span><span>
</span><span id="line-309"></span><span>          </span><span id="local-6989586621684582421"><span class="annot"><span class="annottext">hpath :: String
</span><a href="#local-6989586621684582421"><span class="hs-identifier hs-var hs-var">hpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582438"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h&quot;</span></span><span>
</span><span id="line-310"></span><span>          </span><span id="local-6989586621684582420"><span class="annot"><span class="annottext">jsonpath :: String
</span><a href="#local-6989586621684582420"><span class="hs-identifier hs-var hs-var">jsonpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582438"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;json&quot;</span></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684582439"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-313"></span><span>        </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="Futhark.Compiler.CLI.html#ToLibrary"><span class="hs-identifier hs-var">ToLibrary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-314"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684582419"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582419"><span class="hs-identifier hs-var">header</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684582418"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582418"><span class="hs-identifier hs-var">impl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684582417"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582417"><span class="hs-identifier hs-var">manifest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CParts -&gt; (Text, Text, Text)
</span><a href="Futhark.CodeGen.Backends.GenericC.html#asLibrary"><span class="hs-identifier hs-var">MulticoreC.asLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582424"><span class="hs-identifier hs-var">cprog</span></a></span><span>
</span><span id="line-315"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582421"><span class="hs-identifier hs-var">hpath</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Futhark.Actions.html#cPrependHeader"><span class="hs-identifier hs-var">cPrependHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582419"><span class="hs-identifier hs-var">header</span></a></span><span>
</span><span id="line-316"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582422"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Futhark.Actions.html#cPrependHeader"><span class="hs-identifier hs-var">cPrependHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582418"><span class="hs-identifier hs-var">impl</span></a></span><span>
</span><span id="line-317"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582420"><span class="hs-identifier hs-var">jsonpath</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582417"><span class="hs-identifier hs-var">manifest</span></a></span><span>
</span><span id="line-318"></span><span>        </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="Futhark.Compiler.CLI.html#ToExecutable"><span class="hs-identifier hs-var">ToExecutable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-319"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582422"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Futhark.Actions.html#cPrependHeader"><span class="hs-identifier hs-var">cPrependHeader</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CParts -&gt; Text
</span><a href="Futhark.CodeGen.Backends.GenericC.html#asExecutable"><span class="hs-identifier hs-var">MulticoreC.asExecutable</span></a></span><span> </span><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582424"><span class="hs-identifier hs-var">cprog</span></a></span><span>
</span><span id="line-320"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; [String] -&gt; [String] -&gt; FutharkM ()
</span><a href="Futhark.Actions.html#runCC"><span class="hs-identifier hs-var">runCC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582422"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582438"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O3&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-std=c99&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-lm&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-pthread&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-321"></span><span>        </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="Futhark.Compiler.CLI.html#ToServer"><span class="hs-identifier hs-var">ToServer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-322"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582422"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Futhark.Actions.html#cPrependHeader"><span class="hs-identifier hs-var">cPrependHeader</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CParts -&gt; Text
</span><a href="Futhark.CodeGen.Backends.GenericC.html#asServer"><span class="hs-identifier hs-var">MulticoreC.asServer</span></a></span><span> </span><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582424"><span class="hs-identifier hs-var">cprog</span></a></span><span>
</span><span id="line-323"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; [String] -&gt; [String] -&gt; FutharkM ()
</span><a href="Futhark.Actions.html#runCC"><span class="hs-identifier hs-var">runCC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582422"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582438"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O3&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-std=c99&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-lm&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-pthread&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span id="local-6989586621684582755"><span class="annot"><a href="Futhark.Actions.html#pythonCommon"><span class="hs-identifier hs-type">pythonCommon</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Compiler.CLI.html#CompilerMode"><span class="hs-identifier hs-type">CompilerMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621684582755"><span class="hs-identifier hs-type">prog</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#FutharkM"><span class="hs-identifier hs-type">FutharkM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Warnings.html#Warnings"><span class="hs-identifier hs-type">Warnings</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-327"></span><span>  </span><span class="annot"><a href="Futhark.Compiler.Config.html#FutharkConfig"><span class="hs-identifier hs-type">FutharkConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-328"></span><span>  </span><span class="annot"><a href="Futhark.Compiler.CLI.html#CompilerMode"><span class="hs-identifier hs-type">CompilerMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-329"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-330"></span><span>  </span><span class="annot"><a href="#local-6989586621684582755"><span class="hs-identifier hs-type">prog</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-331"></span><span>  </span><span class="annot"><a href="Futhark.Pipeline.html#FutharkM"><span class="hs-identifier hs-type">FutharkM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-332"></span><span id="pythonCommon"><span class="annot"><span class="annottext">pythonCommon :: forall prog.
(CompilerMode -&gt; String -&gt; prog -&gt; FutharkM (Warnings, Text))
-&gt; FutharkConfig -&gt; CompilerMode -&gt; String -&gt; prog -&gt; FutharkM ()
</span><a href="Futhark.Actions.html#pythonCommon"><span class="hs-identifier hs-var hs-var">pythonCommon</span></a></span></span><span> </span><span id="local-6989586621684582405"><span class="annot"><span class="annottext">CompilerMode -&gt; String -&gt; prog -&gt; FutharkM (Warnings, Text)
</span><a href="#local-6989586621684582405"><span class="hs-identifier hs-var">codegen</span></a></span></span><span> </span><span id="local-6989586621684582404"><span class="annot"><span class="annottext">FutharkConfig
</span><a href="#local-6989586621684582404"><span class="hs-identifier hs-var">fcfg</span></a></span></span><span> </span><span id="local-6989586621684582403"><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684582403"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621684582402"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582402"><span class="hs-identifier hs-var">outpath</span></a></span></span><span> </span><span id="local-6989586621684582401"><span class="annot"><span class="annottext">prog
</span><a href="#local-6989586621684582401"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684582400"><span class="annot"><span class="annottext">class_name :: String
</span><a href="#local-6989586621684582400"><span class="hs-identifier hs-var hs-var">class_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-334"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684582403"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-335"></span><span>          </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="Futhark.Compiler.CLI.html#ToLibrary"><span class="hs-identifier hs-var">ToLibrary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><span class="hs-identifier hs-var">takeBaseName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582402"><span class="hs-identifier hs-var">outpath</span></a></span><span>
</span><span id="line-336"></span><span>          </span><span class="annot"><span class="annottext">CompilerMode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;internal&quot;</span></span><span>
</span><span id="line-337"></span><span>  </span><span id="local-6989586621684582398"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582398"><span class="hs-identifier hs-var">pyprog</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FutharkConfig -&gt; FutharkM (Warnings, Text) -&gt; FutharkM Text
forall a. FutharkConfig -&gt; FutharkM (Warnings, a) -&gt; FutharkM a
</span><a href="Futhark.Compiler.html#handleWarnings"><span class="hs-identifier hs-var">handleWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">FutharkConfig
</span><a href="#local-6989586621684582404"><span class="hs-identifier hs-var">fcfg</span></a></span><span> </span><span class="annot"><span class="annottext">(FutharkM (Warnings, Text) -&gt; FutharkM Text)
-&gt; FutharkM (Warnings, Text) -&gt; FutharkM Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CompilerMode -&gt; String -&gt; prog -&gt; FutharkM (Warnings, Text)
</span><a href="#local-6989586621684582405"><span class="hs-identifier hs-var">codegen</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684582403"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582400"><span class="hs-identifier hs-var">class_name</span></a></span><span> </span><span class="annot"><span class="annottext">prog
</span><a href="#local-6989586621684582401"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684582403"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-340"></span><span>    </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="Futhark.Compiler.CLI.html#ToLibrary"><span class="hs-identifier hs-var">ToLibrary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-341"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582402"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;py&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Futhark.Actions.html#pyPrependHeader"><span class="hs-identifier hs-var">pyPrependHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582398"><span class="hs-identifier hs-var">pyprog</span></a></span><span>
</span><span id="line-342"></span><span>    </span><span class="annot"><span class="annottext">CompilerMode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-343"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582402"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;#!/usr/bin/env python3\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Futhark.Actions.html#pyPrependHeader"><span class="hs-identifier hs-var">pyPrependHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582398"><span class="hs-identifier hs-var">pyprog</span></a></span><span>
</span><span id="line-344"></span><span>      </span><span id="local-6989586621684582397"><span class="annot"><span class="annottext">Permissions
</span><a href="#local-6989586621684582397"><span class="hs-identifier hs-var">perms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Permissions -&gt; IO Permissions
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Permissions -&gt; IO Permissions)
-&gt; IO Permissions -&gt; IO Permissions
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Permissions
</span><span class="hs-identifier hs-var">getPermissions</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582402"><span class="hs-identifier hs-var">outpath</span></a></span><span>
</span><span id="line-345"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Permissions -&gt; IO ()
</span><span class="hs-identifier hs-var">setPermissions</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582402"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">(Permissions -&gt; IO ()) -&gt; Permissions -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Permissions -&gt; Permissions
</span><span class="hs-identifier hs-var">setOwnerExecutable</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Permissions
</span><a href="#local-6989586621684582397"><span class="hs-identifier hs-var">perms</span></a></span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span class="hs-comment">-- | The @futhark python@ action.</span><span>
</span><span id="line-348"></span><span class="annot"><a href="Futhark.Actions.html#compilePythonAction"><span class="hs-identifier hs-type">compilePythonAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Compiler.Config.html#FutharkConfig"><span class="hs-identifier hs-type">FutharkConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Compiler.CLI.html#CompilerMode"><span class="hs-identifier hs-type">CompilerMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SeqMem.html#SeqMem"><span class="hs-identifier hs-type">SeqMem</span></a></span><span>
</span><span id="line-349"></span><span id="compilePythonAction"><span class="annot"><span class="annottext">compilePythonAction :: FutharkConfig -&gt; CompilerMode -&gt; String -&gt; Action SeqMem
</span><a href="Futhark.Actions.html#compilePythonAction"><span class="hs-identifier hs-var hs-var">compilePythonAction</span></a></span></span><span> </span><span id="local-6989586621684582393"><span class="annot"><span class="annottext">FutharkConfig
</span><a href="#local-6989586621684582393"><span class="hs-identifier hs-var">fcfg</span></a></span></span><span> </span><span id="local-6989586621684582392"><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684582392"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621684582391"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582391"><span class="hs-identifier hs-var">outpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-350"></span><span>  </span><span class="annot"><span class="annottext">Action :: forall rep.
String -&gt; String -&gt; (Prog rep -&gt; FutharkM ()) -&gt; Action rep
</span><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">actionName :: String
</span><a href="Futhark.Pipeline.html#actionName"><span class="hs-identifier hs-var">actionName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compile to PyOpenCL&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-352"></span><span>      </span><span class="annot"><span class="annottext">actionDescription :: String
</span><a href="Futhark.Pipeline.html#actionDescription"><span class="hs-identifier hs-var">actionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compile to Python with OpenCL&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-353"></span><span>      </span><span class="annot"><span class="annottext">actionProcedure :: Prog SeqMem -&gt; FutharkM ()
</span><a href="Futhark.Pipeline.html#actionProcedure"><span class="hs-identifier hs-var">actionProcedure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CompilerMode
 -&gt; String -&gt; Prog SeqMem -&gt; FutharkM (Warnings, Text))
-&gt; FutharkConfig
-&gt; CompilerMode
-&gt; String
-&gt; Prog SeqMem
-&gt; FutharkM ()
forall prog.
(CompilerMode -&gt; String -&gt; prog -&gt; FutharkM (Warnings, Text))
-&gt; FutharkConfig -&gt; CompilerMode -&gt; String -&gt; prog -&gt; FutharkM ()
</span><a href="Futhark.Actions.html#pythonCommon"><span class="hs-identifier hs-var">pythonCommon</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerMode -&gt; String -&gt; Prog SeqMem -&gt; FutharkM (Warnings, Text)
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
CompilerMode -&gt; String -&gt; Prog SeqMem -&gt; m (Warnings, Text)
</span><a href="Futhark.CodeGen.Backends.SequentialPython.html#compileProg"><span class="hs-identifier hs-var">SequentialPy.compileProg</span></a></span><span> </span><span class="annot"><span class="annottext">FutharkConfig
</span><a href="#local-6989586621684582393"><span class="hs-identifier hs-var">fcfg</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684582392"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582391"><span class="hs-identifier hs-var">outpath</span></a></span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span class="hs-comment">-- | The @futhark pyopencl@ action.</span><span>
</span><span id="line-357"></span><span class="annot"><a href="Futhark.Actions.html#compilePyOpenCLAction"><span class="hs-identifier hs-type">compilePyOpenCLAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Compiler.Config.html#FutharkConfig"><span class="hs-identifier hs-type">FutharkConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Compiler.CLI.html#CompilerMode"><span class="hs-identifier hs-type">CompilerMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.GPUMem.html#GPUMem"><span class="hs-identifier hs-type">GPUMem</span></a></span><span>
</span><span id="line-358"></span><span id="compilePyOpenCLAction"><span class="annot"><span class="annottext">compilePyOpenCLAction :: FutharkConfig -&gt; CompilerMode -&gt; String -&gt; Action GPUMem
</span><a href="Futhark.Actions.html#compilePyOpenCLAction"><span class="hs-identifier hs-var hs-var">compilePyOpenCLAction</span></a></span></span><span> </span><span id="local-6989586621684582389"><span class="annot"><span class="annottext">FutharkConfig
</span><a href="#local-6989586621684582389"><span class="hs-identifier hs-var">fcfg</span></a></span></span><span> </span><span id="local-6989586621684582388"><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684582388"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621684582387"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582387"><span class="hs-identifier hs-var">outpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-359"></span><span>  </span><span class="annot"><span class="annottext">Action :: forall rep.
String -&gt; String -&gt; (Prog rep -&gt; FutharkM ()) -&gt; Action rep
</span><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">actionName :: String
</span><a href="Futhark.Pipeline.html#actionName"><span class="hs-identifier hs-var">actionName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compile to PyOpenCL&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-361"></span><span>      </span><span class="annot"><span class="annottext">actionDescription :: String
</span><a href="Futhark.Pipeline.html#actionDescription"><span class="hs-identifier hs-var">actionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compile to Python with OpenCL&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-362"></span><span>      </span><span class="annot"><span class="annottext">actionProcedure :: Prog GPUMem -&gt; FutharkM ()
</span><a href="Futhark.Pipeline.html#actionProcedure"><span class="hs-identifier hs-var">actionProcedure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CompilerMode
 -&gt; String -&gt; Prog GPUMem -&gt; FutharkM (Warnings, Text))
-&gt; FutharkConfig
-&gt; CompilerMode
-&gt; String
-&gt; Prog GPUMem
-&gt; FutharkM ()
forall prog.
(CompilerMode -&gt; String -&gt; prog -&gt; FutharkM (Warnings, Text))
-&gt; FutharkConfig -&gt; CompilerMode -&gt; String -&gt; prog -&gt; FutharkM ()
</span><a href="Futhark.Actions.html#pythonCommon"><span class="hs-identifier hs-var">pythonCommon</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerMode -&gt; String -&gt; Prog GPUMem -&gt; FutharkM (Warnings, Text)
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
CompilerMode -&gt; String -&gt; Prog GPUMem -&gt; m (Warnings, Text)
</span><a href="Futhark.CodeGen.Backends.PyOpenCL.html#compileProg"><span class="hs-identifier hs-var">PyOpenCL.compileProg</span></a></span><span> </span><span class="annot"><span class="annottext">FutharkConfig
</span><a href="#local-6989586621684582389"><span class="hs-identifier hs-var">fcfg</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684582388"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582387"><span class="hs-identifier hs-var">outpath</span></a></span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span class="annot"><a href="Futhark.Actions.html#cmdEMCFLAGS"><span class="hs-identifier hs-type">cmdEMCFLAGS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>
</span><span id="line-366"></span><span id="cmdEMCFLAGS"><span class="annot"><span class="annottext">cmdEMCFLAGS :: [String] -&gt; [String]
</span><a href="Futhark.Actions.html#cmdEMCFLAGS"><span class="hs-identifier hs-var hs-var">cmdEMCFLAGS</span></a></span></span><span> </span><span id="local-6989586621684582384"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582384"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; (String -&gt; [String]) -&gt; Maybe String -&gt; [String]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582384"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><span class="hs-identifier hs-var">words</span></span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; [String]) -&gt; Maybe String -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [(String, String)] -&gt; Maybe String
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EMCFLAGS&quot;</span></span><span> </span><span class="annot"><span class="annottext">[(String, String)]
</span><a href="Futhark.Util.html#unixEnvironment"><span class="hs-identifier hs-var">unixEnvironment</span></a></span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span class="annot"><a href="Futhark.Actions.html#runEMCC"><span class="hs-identifier hs-type">runEMCC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#FutharkM"><span class="hs-identifier hs-type">FutharkM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span id="runEMCC"><span class="annot"><span class="annottext">runEMCC :: String
-&gt; String
-&gt; String
-&gt; [String]
-&gt; [String]
-&gt; [String]
-&gt; Bool
-&gt; FutharkM ()
</span><a href="Futhark.Actions.html#runEMCC"><span class="hs-identifier hs-var hs-var">runEMCC</span></a></span></span><span> </span><span id="local-6989586621684582382"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582382"><span class="hs-identifier hs-var">cpath</span></a></span></span><span> </span><span id="local-6989586621684582381"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582381"><span class="hs-identifier hs-var">outpath</span></a></span></span><span> </span><span id="local-6989586621684582380"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582380"><span class="hs-identifier hs-var">classpath</span></a></span></span><span> </span><span id="local-6989586621684582379"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582379"><span class="hs-identifier hs-var">cflags_def</span></a></span></span><span> </span><span id="local-6989586621684582378"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582378"><span class="hs-identifier hs-var">ldflags</span></a></span></span><span> </span><span id="local-6989586621684582377"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582377"><span class="hs-identifier hs-var">expfuns</span></a></span></span><span> </span><span id="local-6989586621684582376"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684582376"><span class="hs-identifier hs-var">lib</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-370"></span><span>  </span><span id="local-6989586621684582375"><span class="annot"><span class="annottext">Either IOException (ExitCode, String, String)
</span><a href="#local-6989586621684582375"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-371"></span><span>    </span><span class="annot"><span class="annottext">IO (Either IOException (ExitCode, String, String))
-&gt; FutharkM (Either IOException (ExitCode, String, String))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either IOException (ExitCode, String, String))
 -&gt; FutharkM (Either IOException (ExitCode, String, String)))
-&gt; IO (Either IOException (ExitCode, String, String))
-&gt; FutharkM (Either IOException (ExitCode, String, String))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-372"></span><span>      </span><span class="annot"><span class="annottext">String
-&gt; [String]
-&gt; ByteString
-&gt; IO (Either IOException (ExitCode, String, String))
</span><a href="Futhark.Util.html#runProgramWithExitCode"><span class="hs-identifier hs-var">runProgramWithExitCode</span></a></span><span>
</span><span id="line-373"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;emcc&quot;</span></span><span>
</span><span id="line-374"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582382"><span class="hs-identifier hs-var">cpath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-o&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582381"><span class="hs-identifier hs-var">outpath</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-375"></span><span>            </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-lnodefs.js&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-376"></span><span>            </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-s&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;--extern-post-js&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582380"><span class="hs-identifier hs-var">classpath</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-377"></span><span>            </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684582376"><span class="hs-identifier hs-var">lib</span></a></span><span>
</span><span id="line-378"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-s&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EXPORT_NAME=loadWASM&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-379"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-380"></span><span>               </span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>            </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-s&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WASM_BIGINT&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-382"></span><span>            </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String]
</span><a href="Futhark.Actions.html#cmdCFLAGS"><span class="hs-identifier hs-var">cmdCFLAGS</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582379"><span class="hs-identifier hs-var">cflags_def</span></a></span><span>
</span><span id="line-383"></span><span>            </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String]
</span><a href="Futhark.Actions.html#cmdEMCFLAGS"><span class="hs-identifier hs-var">cmdEMCFLAGS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-384"></span><span>            </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-s&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-385"></span><span>                 </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EXPORTED_FUNCTIONS=[&quot;</span></span><span>
</span><span id="line-386"></span><span>                   </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String
forall a. [a] -&gt; [[a]] -&gt; [a]
</span><span class="hs-identifier hs-var">intercalate</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;'_malloc'&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;'_free'&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582377"><span class="hs-identifier hs-var">expfuns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>                   </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;]&quot;</span></span><span>
</span><span id="line-388"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-389"></span><span>            </span><span class="hs-comment">-- The default LDFLAGS are always added.</span><span>
</span><span id="line-390"></span><span>            </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582378"><span class="hs-identifier hs-var">ldflags</span></a></span><span>
</span><span id="line-391"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>        </span><span class="annot"><span class="annottext">ByteString
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-393"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOException (ExitCode, String, String)
</span><a href="#local-6989586621684582375"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-394"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621684582374"><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621684582374"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-395"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadError CompilerError m =&gt; String -&gt; m a
</span><a href="Futhark.Error.html#externalErrorS"><span class="hs-identifier hs-var">externalErrorS</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; FutharkM ()) -&gt; String -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Failed to run emcc: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">IOException -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621684582374"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-396"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ExitFailure</span></span><span> </span><span id="local-6989586621684582373"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684582373"><span class="hs-identifier hs-var">code</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684582372"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582372"><span class="hs-identifier hs-var">emccerr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-397"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadError CompilerError m =&gt; String -&gt; m a
</span><a href="Futhark.Error.html#externalErrorS"><span class="hs-identifier hs-var">externalErrorS</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; FutharkM ()) -&gt; String -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-398"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;emcc failed with code &quot;</span></span><span>
</span><span id="line-399"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684582373"><span class="hs-identifier hs-var">code</span></a></span><span>
</span><span id="line-400"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:\n&quot;</span></span><span>
</span><span id="line-401"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582372"><span class="hs-identifier hs-var">emccerr</span></a></span><span>
</span><span id="line-402"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExitCode
</span><span class="hs-identifier hs-var">ExitSuccess</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-403"></span><span>      </span><span class="annot"><span class="annottext">() -&gt; FutharkM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span class="hs-comment">-- | The @futhark wasm@ action.</span><span>
</span><span id="line-406"></span><span class="annot"><a href="Futhark.Actions.html#compileCtoWASMAction"><span class="hs-identifier hs-type">compileCtoWASMAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Compiler.Config.html#FutharkConfig"><span class="hs-identifier hs-type">FutharkConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Compiler.CLI.html#CompilerMode"><span class="hs-identifier hs-type">CompilerMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.SeqMem.html#SeqMem"><span class="hs-identifier hs-type">SeqMem</span></a></span><span>
</span><span id="line-407"></span><span id="compileCtoWASMAction"><span class="annot"><span class="annottext">compileCtoWASMAction :: FutharkConfig -&gt; CompilerMode -&gt; String -&gt; Action SeqMem
</span><a href="Futhark.Actions.html#compileCtoWASMAction"><span class="hs-identifier hs-var hs-var">compileCtoWASMAction</span></a></span></span><span> </span><span id="local-6989586621684582371"><span class="annot"><span class="annottext">FutharkConfig
</span><a href="#local-6989586621684582371"><span class="hs-identifier hs-var">fcfg</span></a></span></span><span> </span><span id="local-6989586621684582370"><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684582370"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621684582369"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582369"><span class="hs-identifier hs-var">outpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-408"></span><span>  </span><span class="annot"><span class="annottext">Action :: forall rep.
String -&gt; String -&gt; (Prog rep -&gt; FutharkM ()) -&gt; Action rep
</span><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span>
</span><span id="line-409"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">actionName :: String
</span><a href="Futhark.Pipeline.html#actionName"><span class="hs-identifier hs-var">actionName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compile to sequential C&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-410"></span><span>      </span><span class="annot"><span class="annottext">actionDescription :: String
</span><a href="Futhark.Pipeline.html#actionDescription"><span class="hs-identifier hs-var">actionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compile to sequential C&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-411"></span><span>      </span><span class="annot"><span class="annottext">actionProcedure :: Prog SeqMem -&gt; FutharkM ()
</span><a href="Futhark.Pipeline.html#actionProcedure"><span class="hs-identifier hs-var">actionProcedure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Prog SeqMem -&gt; FutharkM ()
</span><a href="#local-6989586621684582368"><span class="hs-identifier hs-var">helper</span></a></span><span>
</span><span id="line-412"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-413"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-414"></span><span>    </span><span id="local-6989586621684582368"><span class="annot"><span class="annottext">helper :: Prog SeqMem -&gt; FutharkM ()
</span><a href="#local-6989586621684582368"><span class="hs-identifier hs-var hs-var">helper</span></a></span></span><span> </span><span id="local-6989586621684582357"><span class="annot"><span class="annottext">Prog SeqMem
</span><a href="#local-6989586621684582357"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-415"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684582356"><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582356"><span class="hs-identifier hs-var">cprog</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684582355"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582355"><span class="hs-identifier hs-var">jsprog</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684582354"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582354"><span class="hs-identifier hs-var">exps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-416"></span><span>        </span><span class="annot"><span class="annottext">FutharkConfig
-&gt; FutharkM (Warnings, (CParts, Text, [String]))
-&gt; FutharkM (CParts, Text, [String])
forall a. FutharkConfig -&gt; FutharkM (Warnings, a) -&gt; FutharkM a
</span><a href="Futhark.Compiler.html#handleWarnings"><span class="hs-identifier hs-var">handleWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">FutharkConfig
</span><a href="#local-6989586621684582371"><span class="hs-identifier hs-var">fcfg</span></a></span><span> </span><span class="annot"><span class="annottext">(FutharkM (Warnings, (CParts, Text, [String]))
 -&gt; FutharkM (CParts, Text, [String]))
-&gt; FutharkM (Warnings, (CParts, Text, [String]))
-&gt; FutharkM (CParts, Text, [String])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-417"></span><span>          </span><span class="annot"><span class="annottext">Text
-&gt; Prog SeqMem -&gt; FutharkM (Warnings, (CParts, Text, [String]))
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Text -&gt; Prog SeqMem -&gt; m (Warnings, (CParts, Text, [String]))
</span><a href="Futhark.CodeGen.Backends.SequentialWASM.html#compileProg"><span class="hs-identifier hs-var">SequentialWASM.compileProg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Futhark.Version.html#versionString"><span class="hs-identifier hs-var">versionString</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Prog SeqMem
</span><a href="#local-6989586621684582357"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-418"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684582370"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-419"></span><span>        </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="Futhark.Compiler.CLI.html#ToLibrary"><span class="hs-identifier hs-var">ToLibrary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-420"></span><span>          </span><span class="annot"><span class="annottext">CParts -&gt; Text -&gt; FutharkM ()
forall {m :: * -&gt; *}. MonadIO m =&gt; CParts -&gt; Text -&gt; m ()
</span><a href="#local-6989586621684582352"><span class="hs-identifier hs-var">writeLibs</span></a></span><span> </span><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582356"><span class="hs-identifier hs-var">cprog</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582355"><span class="hs-identifier hs-var">jsprog</span></a></span><span>
</span><span id="line-421"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.appendFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582350"><span class="hs-identifier hs-var">classpath</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Futhark.CodeGen.Backends.GenericWASM.html#libraryExports"><span class="hs-identifier hs-var">SequentialWASM.libraryExports</span></a></span><span>
</span><span id="line-422"></span><span>          </span><span class="annot"><span class="annottext">String
-&gt; String
-&gt; String
-&gt; [String]
-&gt; [String]
-&gt; [String]
-&gt; Bool
-&gt; FutharkM ()
</span><a href="Futhark.Actions.html#runEMCC"><span class="hs-identifier hs-var">runEMCC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582348"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582347"><span class="hs-identifier hs-var">mjspath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582350"><span class="hs-identifier hs-var">classpath</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O3&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-msimd128&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-lm&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582354"><span class="hs-identifier hs-var">exps</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-423"></span><span>        </span><span class="annot"><span class="annottext">CompilerMode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-424"></span><span>          </span><span class="hs-comment">-- Non-server executables are not supported.</span><span>
</span><span id="line-425"></span><span>          </span><span class="annot"><span class="annottext">CParts -&gt; Text -&gt; FutharkM ()
forall {m :: * -&gt; *}. MonadIO m =&gt; CParts -&gt; Text -&gt; m ()
</span><a href="#local-6989586621684582352"><span class="hs-identifier hs-var">writeLibs</span></a></span><span> </span><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582356"><span class="hs-identifier hs-var">cprog</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582355"><span class="hs-identifier hs-var">jsprog</span></a></span><span>
</span><span id="line-426"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.appendFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582350"><span class="hs-identifier hs-var">classpath</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Futhark.CodeGen.Backends.GenericWASM.html#runServer"><span class="hs-identifier hs-var">SequentialWASM.runServer</span></a></span><span>
</span><span id="line-427"></span><span>          </span><span class="annot"><span class="annottext">String
-&gt; String
-&gt; String
-&gt; [String]
-&gt; [String]
-&gt; [String]
-&gt; Bool
-&gt; FutharkM ()
</span><a href="Futhark.Actions.html#runEMCC"><span class="hs-identifier hs-var">runEMCC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582348"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582369"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582350"><span class="hs-identifier hs-var">classpath</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O3&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-msimd128&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-lm&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582354"><span class="hs-identifier hs-var">exps</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-428"></span><span>    </span><span id="local-6989586621684582352"><span class="annot"><span class="annottext">writeLibs :: CParts -&gt; Text -&gt; m ()
</span><a href="#local-6989586621684582352"><span class="hs-identifier hs-var hs-var">writeLibs</span></a></span></span><span> </span><span id="local-6989586621684582337"><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582337"><span class="hs-identifier hs-var">cprog</span></a></span></span><span> </span><span id="local-6989586621684582336"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582336"><span class="hs-identifier hs-var">jsprog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-429"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684582335"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582335"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684582334"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582334"><span class="hs-identifier hs-var">imp</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CParts -&gt; (Text, Text, Text)
</span><a href="Futhark.CodeGen.Backends.GenericC.html#asLibrary"><span class="hs-identifier hs-var">SequentialC.asLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582337"><span class="hs-identifier hs-var">cprog</span></a></span><span>
</span><span id="line-430"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582333"><span class="hs-identifier hs-var">hpath</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582335"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-431"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582348"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582334"><span class="hs-identifier hs-var">imp</span></a></span><span>
</span><span id="line-432"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582350"><span class="hs-identifier hs-var">classpath</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582336"><span class="hs-identifier hs-var">jsprog</span></a></span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span>    </span><span id="local-6989586621684582348"><span class="annot"><span class="annottext">cpath :: String
</span><a href="#local-6989586621684582348"><span class="hs-identifier hs-var hs-var">cpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582369"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;c&quot;</span></span><span>
</span><span id="line-435"></span><span>    </span><span id="local-6989586621684582333"><span class="annot"><span class="annottext">hpath :: String
</span><a href="#local-6989586621684582333"><span class="hs-identifier hs-var hs-var">hpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582369"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h&quot;</span></span><span>
</span><span id="line-436"></span><span>    </span><span id="local-6989586621684582347"><span class="annot"><span class="annottext">mjspath :: String
</span><a href="#local-6989586621684582347"><span class="hs-identifier hs-var hs-var">mjspath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582369"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mjs&quot;</span></span><span>
</span><span id="line-437"></span><span>    </span><span id="local-6989586621684582350"><span class="annot"><span class="annottext">classpath :: String
</span><a href="#local-6989586621684582350"><span class="hs-identifier hs-var hs-var">classpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582369"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.class.js&quot;</span></span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span class="hs-comment">-- | The @futhark wasm-multicore@ action.</span><span>
</span><span id="line-440"></span><span class="annot"><a href="Futhark.Actions.html#compileMulticoreToWASMAction"><span class="hs-identifier hs-type">compileMulticoreToWASMAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Compiler.Config.html#FutharkConfig"><span class="hs-identifier hs-type">FutharkConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Compiler.CLI.html#CompilerMode"><span class="hs-identifier hs-type">CompilerMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="Futhark.IR.MCMem.html#MCMem"><span class="hs-identifier hs-type">MCMem</span></a></span><span>
</span><span id="line-441"></span><span id="compileMulticoreToWASMAction"><span class="annot"><span class="annottext">compileMulticoreToWASMAction :: FutharkConfig -&gt; CompilerMode -&gt; String -&gt; Action MCMem
</span><a href="Futhark.Actions.html#compileMulticoreToWASMAction"><span class="hs-identifier hs-var hs-var">compileMulticoreToWASMAction</span></a></span></span><span> </span><span id="local-6989586621684582332"><span class="annot"><span class="annottext">FutharkConfig
</span><a href="#local-6989586621684582332"><span class="hs-identifier hs-var">fcfg</span></a></span></span><span> </span><span id="local-6989586621684582331"><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684582331"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621684582330"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582330"><span class="hs-identifier hs-var">outpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-442"></span><span>  </span><span class="annot"><span class="annottext">Action :: forall rep.
String -&gt; String -&gt; (Prog rep -&gt; FutharkM ()) -&gt; Action rep
</span><a href="Futhark.Pipeline.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span>
</span><span id="line-443"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">actionName :: String
</span><a href="Futhark.Pipeline.html#actionName"><span class="hs-identifier hs-var">actionName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compile to sequential C&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-444"></span><span>      </span><span class="annot"><span class="annottext">actionDescription :: String
</span><a href="Futhark.Pipeline.html#actionDescription"><span class="hs-identifier hs-var">actionDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compile to sequential C&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-445"></span><span>      </span><span class="annot"><span class="annottext">actionProcedure :: Prog MCMem -&gt; FutharkM ()
</span><a href="Futhark.Pipeline.html#actionProcedure"><span class="hs-identifier hs-var">actionProcedure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Prog MCMem -&gt; FutharkM ()
</span><a href="#local-6989586621684582329"><span class="hs-identifier hs-var">helper</span></a></span><span>
</span><span id="line-446"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-448"></span><span>    </span><span id="local-6989586621684582329"><span class="annot"><span class="annottext">helper :: Prog MCMem -&gt; FutharkM ()
</span><a href="#local-6989586621684582329"><span class="hs-identifier hs-var hs-var">helper</span></a></span></span><span> </span><span id="local-6989586621684582318"><span class="annot"><span class="annottext">Prog MCMem
</span><a href="#local-6989586621684582318"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-449"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684582317"><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582317"><span class="hs-identifier hs-var">cprog</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684582316"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582316"><span class="hs-identifier hs-var">jsprog</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684582315"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582315"><span class="hs-identifier hs-var">exps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-450"></span><span>        </span><span class="annot"><span class="annottext">FutharkConfig
-&gt; FutharkM (Warnings, (CParts, Text, [String]))
-&gt; FutharkM (CParts, Text, [String])
forall a. FutharkConfig -&gt; FutharkM (Warnings, a) -&gt; FutharkM a
</span><a href="Futhark.Compiler.html#handleWarnings"><span class="hs-identifier hs-var">handleWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">FutharkConfig
</span><a href="#local-6989586621684582332"><span class="hs-identifier hs-var">fcfg</span></a></span><span> </span><span class="annot"><span class="annottext">(FutharkM (Warnings, (CParts, Text, [String]))
 -&gt; FutharkM (CParts, Text, [String]))
-&gt; FutharkM (Warnings, (CParts, Text, [String]))
-&gt; FutharkM (CParts, Text, [String])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-451"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Prog MCMem -&gt; FutharkM (Warnings, (CParts, Text, [String]))
forall (m :: * -&gt; *).
MonadFreshNames m =&gt;
Text -&gt; Prog MCMem -&gt; m (Warnings, (CParts, Text, [String]))
</span><a href="Futhark.CodeGen.Backends.MulticoreWASM.html#compileProg"><span class="hs-identifier hs-var">MulticoreWASM.compileProg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Futhark.Version.html#versionString"><span class="hs-identifier hs-var">versionString</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Prog MCMem
</span><a href="#local-6989586621684582318"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="#local-6989586621684582331"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-454"></span><span>        </span><span class="annot"><span class="annottext">CompilerMode
</span><a href="Futhark.Compiler.CLI.html#ToLibrary"><span class="hs-identifier hs-var">ToLibrary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-455"></span><span>          </span><span class="annot"><span class="annottext">CParts -&gt; Text -&gt; FutharkM ()
forall {m :: * -&gt; *}. MonadIO m =&gt; CParts -&gt; Text -&gt; m ()
</span><a href="#local-6989586621684582313"><span class="hs-identifier hs-var">writeLibs</span></a></span><span> </span><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582317"><span class="hs-identifier hs-var">cprog</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582316"><span class="hs-identifier hs-var">jsprog</span></a></span><span>
</span><span id="line-456"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.appendFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582312"><span class="hs-identifier hs-var">classpath</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Futhark.CodeGen.Backends.GenericWASM.html#libraryExports"><span class="hs-identifier hs-var">MulticoreWASM.libraryExports</span></a></span><span>
</span><span id="line-457"></span><span>          </span><span class="annot"><span class="annottext">String
-&gt; String
-&gt; String
-&gt; [String]
-&gt; [String]
-&gt; [String]
-&gt; Bool
-&gt; FutharkM ()
</span><a href="Futhark.Actions.html#runEMCC"><span class="hs-identifier hs-var">runEMCC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582311"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582310"><span class="hs-identifier hs-var">mjspath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582312"><span class="hs-identifier hs-var">classpath</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O3&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-msimd128&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-lm&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-pthread&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582315"><span class="hs-identifier hs-var">exps</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-458"></span><span>        </span><span class="annot"><span class="annottext">CompilerMode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-459"></span><span>          </span><span class="hs-comment">-- Non-server executables are not supported.</span><span>
</span><span id="line-460"></span><span>          </span><span class="annot"><span class="annottext">CParts -&gt; Text -&gt; FutharkM ()
forall {m :: * -&gt; *}. MonadIO m =&gt; CParts -&gt; Text -&gt; m ()
</span><a href="#local-6989586621684582313"><span class="hs-identifier hs-var">writeLibs</span></a></span><span> </span><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582317"><span class="hs-identifier hs-var">cprog</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582316"><span class="hs-identifier hs-var">jsprog</span></a></span><span>
</span><span id="line-461"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; FutharkM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; FutharkM ()) -&gt; IO () -&gt; FutharkM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.appendFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582312"><span class="hs-identifier hs-var">classpath</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Futhark.CodeGen.Backends.GenericWASM.html#runServer"><span class="hs-identifier hs-var">MulticoreWASM.runServer</span></a></span><span>
</span><span id="line-462"></span><span>          </span><span class="annot"><span class="annottext">String
-&gt; String
-&gt; String
-&gt; [String]
-&gt; [String]
-&gt; [String]
-&gt; Bool
-&gt; FutharkM ()
</span><a href="Futhark.Actions.html#runEMCC"><span class="hs-identifier hs-var">runEMCC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582311"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582330"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582312"><span class="hs-identifier hs-var">classpath</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O3&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-msimd128&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-lm&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-pthread&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621684582315"><span class="hs-identifier hs-var">exps</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span>    </span><span id="local-6989586621684582313"><span class="annot"><span class="annottext">writeLibs :: CParts -&gt; Text -&gt; m ()
</span><a href="#local-6989586621684582313"><span class="hs-identifier hs-var hs-var">writeLibs</span></a></span></span><span> </span><span id="local-6989586621684582302"><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582302"><span class="hs-identifier hs-var">cprog</span></a></span></span><span> </span><span id="local-6989586621684582301"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582301"><span class="hs-identifier hs-var">jsprog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-465"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684582300"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582300"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684582299"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582299"><span class="hs-identifier hs-var">imp</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CParts -&gt; (Text, Text, Text)
</span><a href="Futhark.CodeGen.Backends.GenericC.html#asLibrary"><span class="hs-identifier hs-var">MulticoreC.asLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">CParts
</span><a href="#local-6989586621684582302"><span class="hs-identifier hs-var">cprog</span></a></span><span>
</span><span id="line-466"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582298"><span class="hs-identifier hs-var">hpath</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582300"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-467"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582311"><span class="hs-identifier hs-var">cpath</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582299"><span class="hs-identifier hs-var">imp</span></a></span><span>
</span><span id="line-468"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582312"><span class="hs-identifier hs-var">classpath</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684582301"><span class="hs-identifier hs-var">jsprog</span></a></span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span>    </span><span id="local-6989586621684582311"><span class="annot"><span class="annottext">cpath :: String
</span><a href="#local-6989586621684582311"><span class="hs-identifier hs-var hs-var">cpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582330"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;c&quot;</span></span><span>
</span><span id="line-471"></span><span>    </span><span id="local-6989586621684582298"><span class="annot"><span class="annottext">hpath :: String
</span><a href="#local-6989586621684582298"><span class="hs-identifier hs-var hs-var">hpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582330"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h&quot;</span></span><span>
</span><span id="line-472"></span><span>    </span><span id="local-6989586621684582310"><span class="annot"><span class="annottext">mjspath :: String
</span><a href="#local-6989586621684582310"><span class="hs-identifier hs-var hs-var">mjspath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582330"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mjs&quot;</span></span><span>
</span><span id="line-473"></span><span>    </span><span id="local-6989586621684582312"><span class="annot"><span class="annottext">classpath :: String
</span><a href="#local-6989586621684582312"><span class="hs-identifier hs-var hs-var">classpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684582330"><span class="hs-identifier hs-var">outpath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">`addExtension`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.class.js&quot;</span></span><span>
</span><span id="line-474"></span></pre></body></html>