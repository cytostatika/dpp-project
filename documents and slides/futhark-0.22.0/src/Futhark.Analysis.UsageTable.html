<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE Strict #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">-- | A usage-table is sort of a bottom-up symbol table, describing how</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- (and if) a variable is used.</span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Futhark.Analysis.UsageTable</span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier">UsageTable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#without"><span class="hs-identifier">without</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#lookup"><span class="hs-identifier">lookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#used"><span class="hs-identifier">used</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#expand"><span class="hs-identifier">expand</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#isConsumed"><span class="hs-identifier">isConsumed</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#isInResult"><span class="hs-identifier">isInResult</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#isUsedDirectly"><span class="hs-identifier">isUsedDirectly</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#isSize"><span class="hs-identifier">isSize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#usages"><span class="hs-identifier">usages</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#usage"><span class="hs-identifier">usage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#consumedUsage"><span class="hs-identifier">consumedUsage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#inResultUsage"><span class="hs-identifier">inResultUsage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#sizeUsage"><span class="hs-identifier">sizeUsage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#sizeUsages"><span class="hs-identifier">sizeUsages</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#withoutU"><span class="hs-identifier">withoutU</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier">Usages</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#consumedU"><span class="hs-identifier">consumedU</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#presentU"><span class="hs-identifier">presentU</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#usageInStm"><span class="hs-identifier">usageInStm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">where</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bits</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Foldable</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IM</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldl'</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.html"><span class="hs-identifier">Futhark.IR</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html"><span class="hs-identifier">Futhark.IR.Prop.Aliases</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lookup</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-comment">-- | A usage table.</span><span>
</span><span id="line-38"></span><span class="hs-keyword">newtype</span><span> </span><span id="UsageTable"><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-var">UsageTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UsageTable"><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-var">UsageTable</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IM.IntMap</span></span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-type">Usages</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684346364"><span id="local-6989586621684346370"><span class="annot"><span class="annottext">UsageTable -&gt; UsageTable -&gt; Bool
(UsageTable -&gt; UsageTable -&gt; Bool)
-&gt; (UsageTable -&gt; UsageTable -&gt; Bool) -&gt; Eq UsageTable
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: UsageTable -&gt; UsageTable -&gt; Bool
$c/= :: UsageTable -&gt; UsageTable -&gt; Bool
== :: UsageTable -&gt; UsageTable -&gt; Bool
$c== :: UsageTable -&gt; UsageTable -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684346347"><span id="local-6989586621684346349"><span id="local-6989586621684346356"><span class="annot"><span class="annottext">Int -&gt; UsageTable -&gt; ShowS
[UsageTable] -&gt; ShowS
UsageTable -&gt; String
(Int -&gt; UsageTable -&gt; ShowS)
-&gt; (UsageTable -&gt; String)
-&gt; ([UsageTable] -&gt; ShowS)
-&gt; Show UsageTable
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [UsageTable] -&gt; ShowS
$cshowList :: [UsageTable] -&gt; ShowS
show :: UsageTable -&gt; String
$cshow :: UsageTable -&gt; String
showsPrec :: Int -&gt; UsageTable -&gt; ShowS
$cshowsPrec :: Int -&gt; UsageTable -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621684346341"><span id="local-6989586621684346343"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span> </span><span id="local-6989586621684346338"><span class="annot"><span class="annottext">IntMap Usages
</span><a href="#local-6989586621684346338"><span class="hs-identifier hs-var">table1</span></a></span></span><span> </span><span id="local-6989586621684346337"><span class="annot"><span class="annottext">&lt;&gt; :: UsageTable -&gt; UsageTable -&gt; UsageTable
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span> </span><span id="local-6989586621684346336"><span class="annot"><span class="annottext">IntMap Usages
</span><a href="#local-6989586621684346336"><span class="hs-identifier hs-var">table2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><span class="annottext">IntMap Usages -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-var">UsageTable</span></a></span><span> </span><span class="annot"><span class="annottext">(IntMap Usages -&gt; UsageTable) -&gt; IntMap Usages -&gt; UsageTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Usages -&gt; Usages -&gt; Usages)
-&gt; IntMap Usages -&gt; IntMap Usages -&gt; IntMap Usages
forall a. (a -&gt; a -&gt; a) -&gt; IntMap a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IM.unionWith</span></span><span> </span><span class="annot"><span class="annottext">Usages -&gt; Usages -&gt; Usages
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">IntMap Usages
</span><a href="#local-6989586621684346338"><span class="hs-identifier hs-var">table1</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Usages
</span><a href="#local-6989586621684346336"><span class="hs-identifier hs-var">table2</span></a></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621684346328"><span id="local-6989586621684346330"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-46"></span><span>  </span><span id="local-6989586621684346324"><span class="annot"><span class="annottext">mempty :: UsageTable
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap Usages -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-var">UsageTable</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Usages
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-comment">-- | Remove these entries from the usage table.</span><span>
</span><span id="line-49"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#without"><span class="hs-identifier hs-type">without</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span>
</span><span id="line-50"></span><span id="without"><span class="annot"><span class="annottext">without :: UsageTable -&gt; [VName] -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#without"><span class="hs-identifier hs-var hs-var">without</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span> </span><span id="local-6989586621684346323"><span class="annot"><span class="annottext">IntMap Usages
</span><a href="#local-6989586621684346323"><span class="hs-identifier hs-var">table</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><span class="annottext">IntMap Usages -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-var">UsageTable</span></a></span><span> </span><span class="annot"><span class="annottext">(IntMap Usages -&gt; UsageTable)
-&gt; ([VName] -&gt; IntMap Usages) -&gt; [VName] -&gt; UsageTable
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(IntMap Usages -&gt; Int -&gt; IntMap Usages)
-&gt; IntMap Usages -&gt; [Int] -&gt; IntMap Usages
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">Foldable.foldl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; IntMap Usages -&gt; IntMap Usages)
-&gt; IntMap Usages -&gt; Int -&gt; IntMap Usages
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntMap Usages -&gt; IntMap Usages
forall a. Int -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IM.delete</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IntMap Usages
</span><a href="#local-6989586621684346323"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; IntMap Usages)
-&gt; ([VName] -&gt; [Int]) -&gt; [VName] -&gt; IntMap Usages
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Int) -&gt; [VName] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Int
</span><a href="Language.Futhark.Core.html#baseTag"><span class="hs-identifier hs-var">baseTag</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-comment">-- | Look up a variable in the usage table.</span><span>
</span><span id="line-54"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#lookup"><span class="hs-identifier hs-type">lookup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-type">Usages</span></a></span><span>
</span><span id="line-55"></span><span id="lookup"><span class="annot"><span class="annottext">lookup :: VName -&gt; UsageTable -&gt; Maybe Usages
</span><a href="Futhark.Analysis.UsageTable.html#lookup"><span class="hs-identifier hs-var hs-var">lookup</span></a></span></span><span> </span><span id="local-6989586621684346317"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684346317"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span> </span><span id="local-6989586621684346316"><span class="annot"><span class="annottext">IntMap Usages
</span><a href="#local-6989586621684346316"><span class="hs-identifier hs-var">table</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntMap Usages -&gt; Maybe Usages
forall a. Int -&gt; IntMap a -&gt; Maybe a
</span><span class="hs-identifier hs-var">IM.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Int
</span><a href="Language.Futhark.Core.html#baseTag"><span class="hs-identifier hs-var">baseTag</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684346317"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IntMap Usages
</span><a href="#local-6989586621684346316"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#lookupPred"><span class="hs-identifier hs-type">lookupPred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-type">Usages</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-58"></span><span id="lookupPred"><span class="annot"><span class="annottext">lookupPred :: (Usages -&gt; Bool) -&gt; VName -&gt; UsageTable -&gt; Bool
</span><a href="Futhark.Analysis.UsageTable.html#lookupPred"><span class="hs-identifier hs-var hs-var">lookupPred</span></a></span></span><span> </span><span id="local-6989586621684346313"><span class="annot"><span class="annottext">Usages -&gt; Bool
</span><a href="#local-6989586621684346313"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621684346312"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684346312"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (Usages -&gt; Bool) -&gt; Maybe Usages -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Usages -&gt; Bool
</span><a href="#local-6989586621684346313"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Usages -&gt; Bool)
-&gt; (UsageTable -&gt; Maybe Usages) -&gt; UsageTable -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; UsageTable -&gt; Maybe Usages
</span><a href="Futhark.Analysis.UsageTable.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684346312"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">-- | Is the variable present in the usage table?  That is, has it been used?</span><span>
</span><span id="line-61"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#used"><span class="hs-identifier hs-type">used</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-62"></span><span id="used"><span class="annot"><span class="annottext">used :: VName -&gt; UsageTable -&gt; Bool
</span><a href="Futhark.Analysis.UsageTable.html#used"><span class="hs-identifier hs-var hs-var">used</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Usages -&gt; Bool) -&gt; VName -&gt; UsageTable -&gt; Bool
</span><a href="Futhark.Analysis.UsageTable.html#lookupPred"><span class="hs-identifier hs-var">lookupPred</span></a></span><span> </span><span class="annot"><span class="annottext">((Usages -&gt; Bool) -&gt; VName -&gt; UsageTable -&gt; Bool)
-&gt; (Usages -&gt; Bool) -&gt; VName -&gt; UsageTable -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Usages -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-comment">-- | Expand the usage table based on aliasing information.</span><span>
</span><span id="line-65"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#expand"><span class="hs-identifier hs-type">expand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#Names"><span class="hs-identifier hs-type">Names</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span>
</span><span id="line-66"></span><span id="expand"><span class="annot"><span class="annottext">expand :: (VName -&gt; Names) -&gt; UsageTable -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#expand"><span class="hs-identifier hs-var hs-var">expand</span></a></span></span><span> </span><span id="local-6989586621684346309"><span class="annot"><span class="annottext">VName -&gt; Names
</span><a href="#local-6989586621684346309"><span class="hs-identifier hs-var">look</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span> </span><span id="local-6989586621684346308"><span class="annot"><span class="annottext">IntMap Usages
</span><a href="#local-6989586621684346308"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap Usages -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-var">UsageTable</span></a></span><span> </span><span class="annot"><span class="annottext">(IntMap Usages -&gt; UsageTable) -&gt; IntMap Usages -&gt; UsageTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(IntMap Usages -&gt; (Int, Usages) -&gt; IntMap Usages)
-&gt; IntMap Usages -&gt; [(Int, Usages)] -&gt; IntMap Usages
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">IntMap Usages -&gt; (Int, Usages) -&gt; IntMap Usages
</span><a href="#local-6989586621684346307"><span class="hs-identifier hs-var">grow</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Usages
</span><a href="#local-6989586621684346308"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">([(Int, Usages)] -&gt; IntMap Usages)
-&gt; [(Int, Usages)] -&gt; IntMap Usages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IntMap Usages -&gt; [(Int, Usages)]
forall a. IntMap a -&gt; [(Int, a)]
</span><span class="hs-identifier hs-var">IM.toList</span></span><span> </span><span class="annot"><span class="annottext">IntMap Usages
</span><a href="#local-6989586621684346308"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-68"></span><span>    </span><span id="local-6989586621684346307"><span class="annot"><span class="annottext">grow :: IntMap Usages -&gt; (Int, Usages) -&gt; IntMap Usages
</span><a href="#local-6989586621684346307"><span class="hs-identifier hs-var hs-var">grow</span></a></span></span><span> </span><span id="local-6989586621684346302"><span class="annot"><span class="annottext">IntMap Usages
</span><a href="#local-6989586621684346302"><span class="hs-identifier hs-var">m'</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684346301"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684346301"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684346300"><span class="annot"><span class="annottext">Usages
</span><a href="#local-6989586621684346300"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-69"></span><span>      </span><span class="annot"><span class="annottext">(IntMap Usages -&gt; VName -&gt; IntMap Usages)
-&gt; IntMap Usages -&gt; IntMap VName -&gt; IntMap Usages
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Usages -&gt; IntMap Usages -&gt; VName -&gt; IntMap Usages
forall {a}. Semigroup a =&gt; a -&gt; IntMap a -&gt; VName -&gt; IntMap a
</span><a href="#local-6989586621684346299"><span class="hs-identifier hs-var">grow''</span></a></span><span> </span><span class="annot"><span class="annottext">(Usages -&gt; IntMap Usages -&gt; VName -&gt; IntMap Usages)
-&gt; Usages -&gt; IntMap Usages -&gt; VName -&gt; IntMap Usages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Usages
</span><a href="#local-6989586621684346300"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Usages -&gt; Usages -&gt; Usages
</span><a href="Futhark.Analysis.UsageTable.html#withoutU"><span class="hs-operator hs-var">`withoutU`</span></a></span><span> </span><span class="annot"><span class="annottext">Usages
</span><a href="Futhark.Analysis.UsageTable.html#presentU"><span class="hs-identifier hs-var">presentU</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IntMap Usages
</span><a href="#local-6989586621684346302"><span class="hs-identifier hs-var">m'</span></a></span><span> </span><span class="annot"><span class="annottext">(IntMap VName -&gt; IntMap Usages) -&gt; IntMap VName -&gt; IntMap Usages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-70"></span><span>        </span><span class="annot"><span class="annottext">Names -&gt; IntMap VName
</span><a href="Futhark.IR.Prop.Names.html#namesIntMap"><span class="hs-identifier hs-var">namesIntMap</span></a></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; IntMap VName) -&gt; Names -&gt; IntMap VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Names
</span><a href="#local-6989586621684346309"><span class="hs-identifier hs-var">look</span></a></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Names) -&gt; VName -&gt; Names
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Int -&gt; VName
</span><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-var">VName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><a href="Language.Futhark.Core.html#nameFromString"><span class="hs-identifier hs-var">nameFromString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684346301"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-71"></span><span>    </span><span id="local-6989586621684346299"><span class="annot"><span class="annottext">grow'' :: a -&gt; IntMap a -&gt; VName -&gt; IntMap a
</span><a href="#local-6989586621684346299"><span class="hs-identifier hs-var hs-var">grow''</span></a></span></span><span> </span><span id="local-6989586621684346293"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684346293"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621684346292"><span class="annot"><span class="annottext">IntMap a
</span><a href="#local-6989586621684346292"><span class="hs-identifier hs-var">m''</span></a></span></span><span> </span><span id="local-6989586621684346291"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684346291"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; a) -&gt; Int -&gt; a -&gt; IntMap a -&gt; IntMap a
forall a. (a -&gt; a -&gt; a) -&gt; Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IM.insertWith</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Int
</span><a href="Language.Futhark.Core.html#baseTag"><span class="hs-identifier hs-var">baseTag</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684346291"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684346293"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap a
</span><a href="#local-6989586621684346292"><span class="hs-identifier hs-var">m''</span></a></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#is"><span class="hs-identifier hs-type">is</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-type">Usages</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-74"></span><span id="is"><span class="annot"><span class="annottext">is :: Usages -&gt; VName -&gt; UsageTable -&gt; Bool
</span><a href="Futhark.Analysis.UsageTable.html#is"><span class="hs-identifier hs-var hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Usages -&gt; Bool) -&gt; VName -&gt; UsageTable -&gt; Bool
</span><a href="Futhark.Analysis.UsageTable.html#lookupPred"><span class="hs-identifier hs-var">lookupPred</span></a></span><span> </span><span class="annot"><span class="annottext">((Usages -&gt; Bool) -&gt; VName -&gt; UsageTable -&gt; Bool)
-&gt; (Usages -&gt; Usages -&gt; Bool)
-&gt; Usages
-&gt; VName
-&gt; UsageTable
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Usages -&gt; Usages -&gt; Bool
</span><a href="Futhark.Analysis.UsageTable.html#matches"><span class="hs-identifier hs-var">matches</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-comment">-- | Has the variable been consumed?</span><span>
</span><span id="line-77"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#isConsumed"><span class="hs-identifier hs-type">isConsumed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-78"></span><span id="isConsumed"><span class="annot"><span class="annottext">isConsumed :: VName -&gt; UsageTable -&gt; Bool
</span><a href="Futhark.Analysis.UsageTable.html#isConsumed"><span class="hs-identifier hs-var hs-var">isConsumed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Usages -&gt; VName -&gt; UsageTable -&gt; Bool
</span><a href="Futhark.Analysis.UsageTable.html#is"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">Usages
</span><a href="Futhark.Analysis.UsageTable.html#consumedU"><span class="hs-identifier hs-var">consumedU</span></a></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-comment">-- | Has the variable been used in the 'Result' of a body?</span><span>
</span><span id="line-81"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#isInResult"><span class="hs-identifier hs-type">isInResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-82"></span><span id="isInResult"><span class="annot"><span class="annottext">isInResult :: VName -&gt; UsageTable -&gt; Bool
</span><a href="Futhark.Analysis.UsageTable.html#isInResult"><span class="hs-identifier hs-var hs-var">isInResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Usages -&gt; VName -&gt; UsageTable -&gt; Bool
</span><a href="Futhark.Analysis.UsageTable.html#is"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">Usages
</span><a href="Futhark.Analysis.UsageTable.html#inResultU"><span class="hs-identifier hs-var">inResultU</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-comment">-- | Has the given name been used directly (i.e. could we rename it or</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- remove it without anyone noticing?)</span><span>
</span><span id="line-86"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#isUsedDirectly"><span class="hs-identifier hs-type">isUsedDirectly</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-87"></span><span id="isUsedDirectly"><span class="annot"><span class="annottext">isUsedDirectly :: VName -&gt; UsageTable -&gt; Bool
</span><a href="Futhark.Analysis.UsageTable.html#isUsedDirectly"><span class="hs-identifier hs-var hs-var">isUsedDirectly</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Usages -&gt; VName -&gt; UsageTable -&gt; Bool
</span><a href="Futhark.Analysis.UsageTable.html#is"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">Usages
</span><a href="Futhark.Analysis.UsageTable.html#presentU"><span class="hs-identifier hs-var">presentU</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-comment">-- | Is this name used as the size of something (array or memory block)?</span><span>
</span><span id="line-90"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#isSize"><span class="hs-identifier hs-type">isSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-91"></span><span id="isSize"><span class="annot"><span class="annottext">isSize :: VName -&gt; UsageTable -&gt; Bool
</span><a href="Futhark.Analysis.UsageTable.html#isSize"><span class="hs-identifier hs-var hs-var">isSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Usages -&gt; VName -&gt; UsageTable -&gt; Bool
</span><a href="Futhark.Analysis.UsageTable.html#is"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">Usages
</span><a href="Futhark.Analysis.UsageTable.html#sizeU"><span class="hs-identifier hs-var">sizeU</span></a></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-comment">-- | Construct a usage table reflecting that these variables have been</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- used.</span><span>
</span><span id="line-95"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#usages"><span class="hs-identifier hs-type">usages</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#Names"><span class="hs-identifier hs-type">Names</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span>
</span><span id="line-96"></span><span id="usages"><span class="annot"><span class="annottext">usages :: Names -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#usages"><span class="hs-identifier hs-var hs-var">usages</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap Usages -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-var">UsageTable</span></a></span><span> </span><span class="annot"><span class="annottext">(IntMap Usages -&gt; UsageTable)
-&gt; (Names -&gt; IntMap Usages) -&gt; Names -&gt; UsageTable
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Usages) -&gt; IntMap VName -&gt; IntMap Usages
forall a b. (a -&gt; b) -&gt; IntMap a -&gt; IntMap b
</span><span class="hs-identifier hs-var">IM.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Usages -&gt; VName -&gt; Usages
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Usages
</span><a href="Futhark.Analysis.UsageTable.html#presentU"><span class="hs-identifier hs-var">presentU</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IntMap VName -&gt; IntMap Usages)
-&gt; (Names -&gt; IntMap VName) -&gt; Names -&gt; IntMap Usages
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; IntMap VName
</span><a href="Futhark.IR.Prop.Names.html#namesIntMap"><span class="hs-identifier hs-var">namesIntMap</span></a></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">-- | Construct a usage table where the given variable has been used in</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- this specific way.</span><span>
</span><span id="line-100"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#usage"><span class="hs-identifier hs-type">usage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-type">Usages</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span>
</span><span id="line-101"></span><span id="usage"><span class="annot"><span class="annottext">usage :: VName -&gt; Usages -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#usage"><span class="hs-identifier hs-var hs-var">usage</span></a></span></span><span> </span><span id="local-6989586621684346284"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684346284"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621684346283"><span class="annot"><span class="annottext">Usages
</span><a href="#local-6989586621684346283"><span class="hs-identifier hs-var">uses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap Usages -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-var">UsageTable</span></a></span><span> </span><span class="annot"><span class="annottext">(IntMap Usages -&gt; UsageTable) -&gt; IntMap Usages -&gt; UsageTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Usages -&gt; IntMap Usages
forall a. Int -&gt; a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IM.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Int
</span><a href="Language.Futhark.Core.html#baseTag"><span class="hs-identifier hs-var">baseTag</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684346284"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Usages
</span><a href="#local-6989586621684346283"><span class="hs-identifier hs-var">uses</span></a></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-comment">-- | Construct a usage table where the given variable has been consumed.</span><span>
</span><span id="line-104"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#consumedUsage"><span class="hs-identifier hs-type">consumedUsage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span>
</span><span id="line-105"></span><span id="consumedUsage"><span class="annot"><span class="annottext">consumedUsage :: VName -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#consumedUsage"><span class="hs-identifier hs-var hs-var">consumedUsage</span></a></span></span><span> </span><span id="local-6989586621684346281"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684346281"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap Usages -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-var">UsageTable</span></a></span><span> </span><span class="annot"><span class="annottext">(IntMap Usages -&gt; UsageTable) -&gt; IntMap Usages -&gt; UsageTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Usages -&gt; IntMap Usages
forall a. Int -&gt; a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IM.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Int
</span><a href="Language.Futhark.Core.html#baseTag"><span class="hs-identifier hs-var">baseTag</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684346281"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Usages
</span><a href="Futhark.Analysis.UsageTable.html#consumedU"><span class="hs-identifier hs-var">consumedU</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-comment">-- | Construct a usage table where the given variable has been used in</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- the 'Result' of a body.</span><span>
</span><span id="line-109"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#inResultUsage"><span class="hs-identifier hs-type">inResultUsage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span>
</span><span id="line-110"></span><span id="inResultUsage"><span class="annot"><span class="annottext">inResultUsage :: VName -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#inResultUsage"><span class="hs-identifier hs-var hs-var">inResultUsage</span></a></span></span><span> </span><span id="local-6989586621684346280"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684346280"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap Usages -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-var">UsageTable</span></a></span><span> </span><span class="annot"><span class="annottext">(IntMap Usages -&gt; UsageTable) -&gt; IntMap Usages -&gt; UsageTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Usages -&gt; IntMap Usages
forall a. Int -&gt; a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IM.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Int
</span><a href="Language.Futhark.Core.html#baseTag"><span class="hs-identifier hs-var">baseTag</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684346280"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Usages
</span><a href="Futhark.Analysis.UsageTable.html#inResultU"><span class="hs-identifier hs-var">inResultU</span></a></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-comment">-- | Construct a usage table where the given variable has been used as</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- an array or memory size.</span><span>
</span><span id="line-114"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#sizeUsage"><span class="hs-identifier hs-type">sizeUsage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span>
</span><span id="line-115"></span><span id="sizeUsage"><span class="annot"><span class="annottext">sizeUsage :: VName -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#sizeUsage"><span class="hs-identifier hs-var hs-var">sizeUsage</span></a></span></span><span> </span><span id="local-6989586621684346279"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684346279"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap Usages -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-var">UsageTable</span></a></span><span> </span><span class="annot"><span class="annottext">(IntMap Usages -&gt; UsageTable) -&gt; IntMap Usages -&gt; UsageTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Usages -&gt; IntMap Usages
forall a. Int -&gt; a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IM.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Int
</span><a href="Language.Futhark.Core.html#baseTag"><span class="hs-identifier hs-var">baseTag</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684346279"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Usages
</span><a href="Futhark.Analysis.UsageTable.html#sizeU"><span class="hs-identifier hs-var">sizeU</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-comment">-- | Construct a usage table where the given names have been used as</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- an array or memory size.</span><span>
</span><span id="line-119"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#sizeUsages"><span class="hs-identifier hs-type">sizeUsages</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Names.html#Names"><span class="hs-identifier hs-type">Names</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span><span>
</span><span id="line-120"></span><span id="sizeUsages"><span class="annot"><span class="annottext">sizeUsages :: Names -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#sizeUsages"><span class="hs-identifier hs-var hs-var">sizeUsages</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap Usages -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-var">UsageTable</span></a></span><span> </span><span class="annot"><span class="annottext">(IntMap Usages -&gt; UsageTable)
-&gt; (Names -&gt; IntMap Usages) -&gt; Names -&gt; UsageTable
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Usages) -&gt; IntMap VName -&gt; IntMap Usages
forall a b. (a -&gt; b) -&gt; IntMap a -&gt; IntMap b
</span><span class="hs-identifier hs-var">IM.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Usages -&gt; VName -&gt; Usages
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Usages
</span><a href="Futhark.Analysis.UsageTable.html#sizeU"><span class="hs-identifier hs-var">sizeU</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IntMap VName -&gt; IntMap Usages)
-&gt; (Names -&gt; IntMap VName) -&gt; Names -&gt; IntMap Usages
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; IntMap VName
</span><a href="Futhark.IR.Prop.Names.html#namesIntMap"><span class="hs-identifier hs-var">namesIntMap</span></a></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-comment">-- | A description of how a single variable has been used.</span><span>
</span><span id="line-123"></span><span class="hs-keyword">newtype</span><span> </span><span id="Usages"><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-var">Usages</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Usages"><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-var">Usages</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-comment">-- Bitmap representation for speed.</span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684346272"><span id="local-6989586621684346276"><span class="annot"><span class="annottext">Usages -&gt; Usages -&gt; Bool
(Usages -&gt; Usages -&gt; Bool)
-&gt; (Usages -&gt; Usages -&gt; Bool) -&gt; Eq Usages
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Usages -&gt; Usages -&gt; Bool
$c/= :: Usages -&gt; Usages -&gt; Bool
== :: Usages -&gt; Usages -&gt; Bool
$c== :: Usages -&gt; Usages -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684346242"><span id="local-6989586621684346246"><span id="local-6989586621684346250"><span id="local-6989586621684346254"><span id="local-6989586621684346258"><span id="local-6989586621684346262"><span id="local-6989586621684346266"><span class="annot"><span class="annottext">Eq Usages
Eq Usages
-&gt; (Usages -&gt; Usages -&gt; Ordering)
-&gt; (Usages -&gt; Usages -&gt; Bool)
-&gt; (Usages -&gt; Usages -&gt; Bool)
-&gt; (Usages -&gt; Usages -&gt; Bool)
-&gt; (Usages -&gt; Usages -&gt; Bool)
-&gt; (Usages -&gt; Usages -&gt; Usages)
-&gt; (Usages -&gt; Usages -&gt; Usages)
-&gt; Ord Usages
Usages -&gt; Usages -&gt; Bool
Usages -&gt; Usages -&gt; Ordering
Usages -&gt; Usages -&gt; Usages
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: Usages -&gt; Usages -&gt; Usages
$cmin :: Usages -&gt; Usages -&gt; Usages
max :: Usages -&gt; Usages -&gt; Usages
$cmax :: Usages -&gt; Usages -&gt; Usages
&gt;= :: Usages -&gt; Usages -&gt; Bool
$c&gt;= :: Usages -&gt; Usages -&gt; Bool
&gt; :: Usages -&gt; Usages -&gt; Bool
$c&gt; :: Usages -&gt; Usages -&gt; Bool
&lt;= :: Usages -&gt; Usages -&gt; Bool
$c&lt;= :: Usages -&gt; Usages -&gt; Bool
&lt; :: Usages -&gt; Usages -&gt; Bool
$c&lt; :: Usages -&gt; Usages -&gt; Bool
compare :: Usages -&gt; Usages -&gt; Ordering
$ccompare :: Usages -&gt; Usages -&gt; Ordering
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684346229"><span id="local-6989586621684346231"><span id="local-6989586621684346236"><span class="annot"><span class="annottext">Int -&gt; Usages -&gt; ShowS
[Usages] -&gt; ShowS
Usages -&gt; String
(Int -&gt; Usages -&gt; ShowS)
-&gt; (Usages -&gt; String) -&gt; ([Usages] -&gt; ShowS) -&gt; Show Usages
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Usages] -&gt; ShowS
$cshowList :: [Usages] -&gt; ShowS
show :: Usages -&gt; String
$cshow :: Usages -&gt; String
showsPrec :: Int -&gt; Usages -&gt; ShowS
$cshowsPrec :: Int -&gt; Usages -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621684346224"><span id="local-6989586621684346226"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-type">Usages</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-type">Usages</span></a></span><span> </span><span id="local-6989586621684346222"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684346222"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621684346221"><span class="annot"><span class="annottext">&lt;&gt; :: Usages -&gt; Usages -&gt; Usages
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-type">Usages</span></a></span><span> </span><span id="local-6989586621684346220"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684346220"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Usages
</span><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-var">Usages</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Usages) -&gt; Int -&gt; Usages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684346222"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684346220"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621684346212"><span id="local-6989586621684346214"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-type">Usages</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-130"></span><span>  </span><span id="local-6989586621684346211"><span class="annot"><span class="annottext">mempty :: Usages
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Usages
</span><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-var">Usages</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#consumedU"><span class="hs-identifier hs-type">consumedU</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#inResultU"><span class="hs-identifier hs-type">inResultU</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#presentU"><span class="hs-identifier hs-type">presentU</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#sizeU"><span class="hs-identifier hs-type">sizeU</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-type">Usages</span></a></span><span>
</span><span id="line-133"></span><span id="consumedU"><span class="annot"><span class="annottext">consumedU :: Usages
</span><a href="Futhark.Analysis.UsageTable.html#consumedU"><span class="hs-identifier hs-var hs-var">consumedU</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Usages
</span><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-var">Usages</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-134"></span><span id="inResultU"><span class="annot"><span class="annottext">inResultU :: Usages
</span><a href="Futhark.Analysis.UsageTable.html#inResultU"><span class="hs-identifier hs-var hs-var">inResultU</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Usages
</span><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-var">Usages</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-135"></span><span id="presentU"><span class="annot"><span class="annottext">presentU :: Usages
</span><a href="Futhark.Analysis.UsageTable.html#presentU"><span class="hs-identifier hs-var hs-var">presentU</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Usages
</span><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-var">Usages</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span>
</span><span id="line-136"></span><span id="sizeU"><span class="annot"><span class="annottext">sizeU :: Usages
</span><a href="Futhark.Analysis.UsageTable.html#sizeU"><span class="hs-identifier hs-var hs-var">sizeU</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Usages
</span><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-var">Usages</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-comment">-- | Check whether the bits that are set in the first argument are</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- also set in the second.</span><span>
</span><span id="line-140"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#matches"><span class="hs-identifier hs-type">matches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-type">Usages</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-type">Usages</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-141"></span><span id="matches"><span class="annot"><span class="annottext">matches :: Usages -&gt; Usages -&gt; Bool
</span><a href="Futhark.Analysis.UsageTable.html#matches"><span class="hs-identifier hs-var hs-var">matches</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-type">Usages</span></a></span><span> </span><span id="local-6989586621684346210"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684346210"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-type">Usages</span></a></span><span> </span><span id="local-6989586621684346209"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684346209"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684346210"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684346210"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684346209"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-comment">-- | x - y, but for 'Usages'.</span><span>
</span><span id="line-144"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#withoutU"><span class="hs-identifier hs-type">withoutU</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-type">Usages</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-type">Usages</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-type">Usages</span></a></span><span>
</span><span id="line-145"></span><span id="withoutU"><span class="annot"><span class="annottext">withoutU :: Usages -&gt; Usages -&gt; Usages
</span><a href="Futhark.Analysis.UsageTable.html#withoutU"><span class="hs-identifier hs-var hs-var">withoutU</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-type">Usages</span></a></span><span> </span><span id="local-6989586621684346207"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684346207"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-type">Usages</span></a></span><span> </span><span id="local-6989586621684346206"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684346206"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Usages
</span><a href="Futhark.Analysis.UsageTable.html#Usages"><span class="hs-identifier hs-var">Usages</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Usages) -&gt; Int -&gt; Usages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684346207"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">complement</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684346206"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span id="local-6989586621684346499"><span class="annot"><a href="Futhark.Analysis.UsageTable.html#usageInBody"><span class="hs-identifier hs-type">usageInBody</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#Aliased"><span class="hs-identifier hs-type">Aliased</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684346499"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Body"><span class="hs-identifier hs-type">Body</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684346499"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span></span><span>
</span><span id="line-148"></span><span id="usageInBody"><span class="annot"><span class="annottext">usageInBody :: forall rep. Aliased rep =&gt; Body rep -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#usageInBody"><span class="hs-identifier hs-var hs-var">usageInBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; UsageTable) -&gt; [VName] -&gt; UsageTable
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#consumedUsage"><span class="hs-identifier hs-var">consumedUsage</span></a></span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; UsageTable)
-&gt; (Body rep -&gt; [VName]) -&gt; Body rep -&gt; UsageTable
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; [VName]
</span><a href="Futhark.IR.Prop.Names.html#namesToList"><span class="hs-identifier hs-var">namesToList</span></a></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; [VName]) -&gt; (Body rep -&gt; Names) -&gt; Body rep -&gt; [VName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Body rep -&gt; Names
forall rep. Aliased rep =&gt; Body rep -&gt; Names
</span><a href="Futhark.IR.Prop.Aliases.html#consumedInBody"><span class="hs-identifier hs-var">consumedInBody</span></a></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-comment">-- | Produce a usage table reflecting the use of the free variables in</span><span>
</span><span id="line-151"></span><span class="hs-comment">-- a single statement.</span><span>
</span><span id="line-152"></span><span id="local-6989586621684346492"><span class="annot"><a href="Futhark.Analysis.UsageTable.html#usageInStm"><span class="hs-identifier hs-type">usageInStm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Prop.html#ASTRep"><span class="hs-identifier hs-type">ASTRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684346492"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#Aliased"><span class="hs-identifier hs-type">Aliased</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684346492"><span class="hs-identifier hs-type">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Stm"><span class="hs-identifier hs-type">Stm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684346492"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span></span><span>
</span><span id="line-153"></span><span id="usageInStm"><span class="annot"><span class="annottext">usageInStm :: forall rep. (ASTRep rep, Aliased rep) =&gt; Stm rep -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#usageInStm"><span class="hs-identifier hs-var hs-var">usageInStm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621684346137"><span class="annot"><span class="annottext">Pat rep
</span><a href="#local-6989586621684346137"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621684346136"><span class="annot"><span class="annottext">StmAux (ExpDec rep)
</span><a href="#local-6989586621684346136"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span id="local-6989586621684346135"><span class="annot"><span class="annottext">Exp rep
</span><a href="#local-6989586621684346135"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-154"></span><span>  </span><span class="annot"><span class="annottext">[UsageTable] -&gt; UsageTable
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">UsageTable
</span><a href="#local-6989586621684346134"><span class="hs-identifier hs-var">usageInPat</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-156"></span><span>      </span><span class="annot"><span class="annottext">UsageTable
</span><a href="#local-6989586621684346133"><span class="hs-identifier hs-var">usageInExpDec</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-157"></span><span>      </span><span class="annot"><span class="annottext">Exp rep -&gt; UsageTable
forall rep. Aliased rep =&gt; Exp rep -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#usageInExp"><span class="hs-identifier hs-var">usageInExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp rep
</span><a href="#local-6989586621684346135"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-158"></span><span>      </span><span class="annot"><span class="annottext">Names -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#usages"><span class="hs-identifier hs-var">usages</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp rep -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">Exp rep
</span><a href="#local-6989586621684346135"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-161"></span><span>    </span><span id="local-6989586621684346134"><span class="annot"><span class="annottext">usageInPat :: UsageTable
</span><a href="#local-6989586621684346134"><span class="hs-identifier hs-var hs-var">usageInPat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-162"></span><span>      </span><span class="annot"><span class="annottext">Names -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#usages"><span class="hs-identifier hs-var">usages</span></a></span><span>
</span><span id="line-163"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Names] -&gt; Names
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PatElemT (LetDec rep) -&gt; Names)
-&gt; [PatElemT (LetDec rep)] -&gt; [Names]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PatElemT (LetDec rep) -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">([PatElemT (LetDec rep)] -&gt; [Names])
-&gt; [PatElemT (LetDec rep)] -&gt; [Names]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat rep -&gt; [PatElemT (LetDec rep)]
forall dec. PatT dec -&gt; [PatElemT dec]
</span><a href="Futhark.IR.Syntax.html#patElems"><span class="hs-identifier hs-var hs-var">patElems</span></a></span><span> </span><span class="annot"><span class="annottext">Pat rep
</span><a href="#local-6989586621684346137"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>            </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#namesSubtract"><span class="hs-operator hs-var">`namesSubtract`</span></a></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#namesFromList"><span class="hs-identifier hs-var">namesFromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat rep -&gt; [VName]
forall dec. PatT dec -&gt; [VName]
</span><a href="Futhark.IR.Prop.Patterns.html#patNames"><span class="hs-identifier hs-var">patNames</span></a></span><span> </span><span class="annot"><span class="annottext">Pat rep
</span><a href="#local-6989586621684346137"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>        </span><span class="annot"><span class="annottext">UsageTable -&gt; UsageTable -&gt; UsageTable
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#sizeUsages"><span class="hs-identifier hs-var">sizeUsages</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PatElemT (LetDec rep) -&gt; Names)
-&gt; [PatElemT (LetDec rep)] -&gt; Names
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Names)
-&gt; (PatElemT (LetDec rep) -&gt; Type)
-&gt; PatElemT (LetDec rep)
-&gt; Names
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PatElemT (LetDec rep) -&gt; Type
forall dec. Typed dec =&gt; PatElemT dec -&gt; Type
</span><a href="Futhark.IR.Prop.Patterns.html#patElemType"><span class="hs-identifier hs-var">patElemType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat rep -&gt; [PatElemT (LetDec rep)]
forall dec. PatT dec -&gt; [PatElemT dec]
</span><a href="Futhark.IR.Syntax.html#patElems"><span class="hs-identifier hs-var hs-var">patElems</span></a></span><span> </span><span class="annot"><span class="annottext">Pat rep
</span><a href="#local-6989586621684346137"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621684346133"><span class="annot"><span class="annottext">usageInExpDec :: UsageTable
</span><a href="#local-6989586621684346133"><span class="hs-identifier hs-var hs-var">usageInExpDec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-168"></span><span>      </span><span class="annot"><span class="annottext">Names -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#usages"><span class="hs-identifier hs-var">usages</span></a></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; UsageTable) -&gt; Names -&gt; UsageTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StmAux (ExpDec rep) -&gt; Names
forall a. FreeIn a =&gt; a -&gt; Names
</span><a href="Futhark.IR.Prop.Names.html#freeIn"><span class="hs-identifier hs-var">freeIn</span></a></span><span> </span><span class="annot"><span class="annottext">StmAux (ExpDec rep)
</span><a href="#local-6989586621684346136"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span id="local-6989586621684346459"><span class="annot"><a href="Futhark.Analysis.UsageTable.html#usageInExp"><span class="hs-identifier hs-type">usageInExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Prop.Aliases.html#Aliased"><span class="hs-identifier hs-type">Aliased</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684346459"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684346459"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#UsageTable"><span class="hs-identifier hs-type">UsageTable</span></a></span></span><span>
</span><span id="line-171"></span><span id="usageInExp"><span class="annot"><span class="annottext">usageInExp :: forall rep. Aliased rep =&gt; Exp rep -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#usageInExp"><span class="hs-identifier hs-var hs-var">usageInExp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684346081"><span class="annot"><span class="annottext">[(SubExp, Diet)]
</span><a href="#local-6989586621684346081"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="annot"><span class="annottext">[RetType rep]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(Safety, SrcLoc, [SrcLoc])
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-172"></span><span>  </span><span class="annot"><span class="annottext">[UsageTable] -&gt; UsageTable
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[UsageTable] -&gt; UsageTable
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([UsageTable] -&gt; UsageTable) -&gt; [UsageTable] -&gt; UsageTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-174"></span><span>        </span><span class="annot"><span class="annottext">(VName -&gt; UsageTable) -&gt; [VName] -&gt; [UsageTable]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#consumedUsage"><span class="hs-identifier hs-var">consumedUsage</span></a></span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; [UsageTable]) -&gt; [VName] -&gt; [UsageTable]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-175"></span><span>          </span><span class="annot"><span class="annottext">Names -&gt; [VName]
</span><a href="Futhark.IR.Prop.Names.html#namesToList"><span class="hs-identifier hs-var">namesToList</span></a></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; [VName]) -&gt; Names -&gt; [VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SubExp -&gt; Names
</span><a href="Futhark.IR.Prop.Aliases.html#subExpAliases"><span class="hs-identifier hs-var">subExpAliases</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684346079"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-176"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684346079"><span class="annot"><span class="annottext">SubExp
</span><a href="#local-6989586621684346079"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684346078"><span class="annot"><span class="annottext">Diet
</span><a href="#local-6989586621684346078"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(SubExp, Diet)]
</span><a href="#local-6989586621684346081"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-177"></span><span>        </span><span class="annot"><span class="annottext">Diet
</span><a href="#local-6989586621684346078"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Diet -&gt; Diet -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Diet
</span><a href="Futhark.IR.Syntax.Core.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-179"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#usageInExp"><span class="hs-identifier hs-var">usageInExp</span></a></span><span> </span><span id="local-6989586621684346076"><span class="annot"><span class="annottext">e :: ExpT rep
</span><a href="#local-6989586621684346076"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Futhark.IR.Syntax.html#DoLoop"><span class="hs-identifier hs-type">DoLoop</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-180"></span><span>  </span><span class="annot"><span class="annottext">(VName -&gt; UsageTable) -&gt; [VName] -&gt; UsageTable
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#consumedUsage"><span class="hs-identifier hs-var">consumedUsage</span></a></span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; UsageTable) -&gt; [VName] -&gt; UsageTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; [VName]
</span><a href="Futhark.IR.Prop.Names.html#namesToList"><span class="hs-identifier hs-var">namesToList</span></a></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; [VName]) -&gt; Names -&gt; [VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExpT rep -&gt; Names
forall rep. Aliased rep =&gt; Exp rep -&gt; Names
</span><a href="Futhark.IR.Prop.Aliases.html#consumedInExp"><span class="hs-identifier hs-var">consumedInExp</span></a></span><span> </span><span class="annot"><span class="annottext">ExpT rep
</span><a href="#local-6989586621684346076"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-181"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#usageInExp"><span class="hs-identifier hs-var">usageInExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#If"><span class="hs-identifier hs-type">If</span></a></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684346072"><span class="annot"><span class="annottext">BodyT rep
</span><a href="#local-6989586621684346072"><span class="hs-identifier hs-var">tbranch</span></a></span></span><span> </span><span id="local-6989586621684346071"><span class="annot"><span class="annottext">BodyT rep
</span><a href="#local-6989586621684346071"><span class="hs-identifier hs-var">fbranch</span></a></span></span><span> </span><span class="annot"><span class="annottext">IfDec (BranchType rep)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><span class="annottext">BodyT rep -&gt; UsageTable
forall rep. Aliased rep =&gt; Body rep -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#usageInBody"><span class="hs-identifier hs-var">usageInBody</span></a></span><span> </span><span class="annot"><span class="annottext">BodyT rep
</span><a href="#local-6989586621684346072"><span class="hs-identifier hs-var">tbranch</span></a></span><span> </span><span class="annot"><span class="annottext">UsageTable -&gt; UsageTable -&gt; UsageTable
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">BodyT rep -&gt; UsageTable
forall rep. Aliased rep =&gt; Body rep -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#usageInBody"><span class="hs-identifier hs-var">usageInBody</span></a></span><span> </span><span class="annot"><span class="annottext">BodyT rep
</span><a href="#local-6989586621684346071"><span class="hs-identifier hs-var">fbranch</span></a></span><span>
</span><span id="line-183"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#usageInExp"><span class="hs-identifier hs-var">usageInExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#WithAcc"><span class="hs-identifier hs-type">WithAcc</span></a></span><span> </span><span id="local-6989586621684346069"><span class="annot"><span class="annottext">[WithAccInput rep]
</span><a href="#local-6989586621684346069"><span class="hs-identifier hs-var">inputs</span></a></span></span><span> </span><span id="local-6989586621684346068"><span class="annot"><span class="annottext">Lambda rep
</span><a href="#local-6989586621684346068"><span class="hs-identifier hs-var">lam</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><span class="annottext">(WithAccInput rep -&gt; UsageTable)
-&gt; [WithAccInput rep] -&gt; UsageTable
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">WithAccInput rep -&gt; UsageTable
forall {t :: * -&gt; *} {a} {c}.
Foldable t =&gt;
(a, t VName, c) -&gt; UsageTable
</span><a href="#local-6989586621684346067"><span class="hs-identifier hs-var">inputUsage</span></a></span><span> </span><span class="annot"><span class="annottext">[WithAccInput rep]
</span><a href="#local-6989586621684346069"><span class="hs-identifier hs-var">inputs</span></a></span><span> </span><span class="annot"><span class="annottext">UsageTable -&gt; UsageTable -&gt; UsageTable
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">BodyT rep -&gt; UsageTable
forall rep. Aliased rep =&gt; Body rep -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#usageInBody"><span class="hs-identifier hs-var">usageInBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lambda rep -&gt; BodyT rep
forall rep. LambdaT rep -&gt; BodyT rep
</span><a href="Futhark.IR.Syntax.html#lambdaBody"><span class="hs-identifier hs-var hs-var">lambdaBody</span></a></span><span> </span><span class="annot"><span class="annottext">Lambda rep
</span><a href="#local-6989586621684346068"><span class="hs-identifier hs-var">lam</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-186"></span><span>    </span><span id="local-6989586621684346067"><span class="annot"><span class="annottext">inputUsage :: (a, t VName, c) -&gt; UsageTable
</span><a href="#local-6989586621684346067"><span class="hs-identifier hs-var hs-var">inputUsage</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684346062"><span class="annot"><span class="annottext">t VName
</span><a href="#local-6989586621684346062"><span class="hs-identifier hs-var">arrs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; UsageTable) -&gt; t VName -&gt; UsageTable
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#consumedUsage"><span class="hs-identifier hs-var">consumedUsage</span></a></span><span> </span><span class="annot"><span class="annottext">t VName
</span><a href="#local-6989586621684346062"><span class="hs-identifier hs-var">arrs</span></a></span><span>
</span><span id="line-187"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#usageInExp"><span class="hs-identifier hs-var">usageInExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-type">BasicOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Update"><span class="hs-identifier hs-type">Update</span></a></span><span> </span><span class="annot"><span class="annottext">Safety
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684346059"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684346059"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="annot"><span class="annottext">Slice SubExp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SubExp
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><span class="annottext">VName -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#consumedUsage"><span class="hs-identifier hs-var">consumedUsage</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684346059"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-189"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#usageInExp"><span class="hs-identifier hs-var">usageInExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-type">BasicOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#FlatUpdate"><span class="hs-identifier hs-type">FlatUpdate</span></a></span><span> </span><span id="local-6989586621684346057"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684346057"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="annot"><span class="annottext">FlatSlice SubExp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-190"></span><span>  </span><span class="annot"><span class="annottext">VName -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#consumedUsage"><span class="hs-identifier hs-var">consumedUsage</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684346057"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-191"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#usageInExp"><span class="hs-identifier hs-var">usageInExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span id="local-6989586621684346055"><span class="annot"><span class="annottext">Op rep
</span><a href="#local-6989586621684346055"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-192"></span><span>  </span><span class="annot"><span class="annottext">[UsageTable] -&gt; UsageTable
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([UsageTable] -&gt; UsageTable) -&gt; [UsageTable] -&gt; UsageTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; UsageTable) -&gt; [VName] -&gt; [UsageTable]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; UsageTable
</span><a href="Futhark.Analysis.UsageTable.html#consumedUsage"><span class="hs-identifier hs-var">consumedUsage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; [VName]
</span><a href="Futhark.IR.Prop.Names.html#namesToList"><span class="hs-identifier hs-var">namesToList</span></a></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; [VName]) -&gt; Names -&gt; [VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Op rep -&gt; Names
forall op. AliasedOp op =&gt; op -&gt; Names
</span><a href="Futhark.IR.Prop.Aliases.html#consumedInOp"><span class="hs-identifier hs-var">consumedInOp</span></a></span><span> </span><span class="annot"><span class="annottext">Op rep
</span><a href="#local-6989586621684346055"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span class="annot"><a href="Futhark.Analysis.UsageTable.html#usageInExp"><span class="hs-identifier hs-var">usageInExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.html#BasicOp"><span class="hs-identifier hs-type">BasicOp</span></a></span><span> </span><span class="annot"><span class="annottext">BasicOp
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UsageTable
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-194"></span></pre></body></html>