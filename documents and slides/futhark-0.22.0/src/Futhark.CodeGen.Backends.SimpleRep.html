<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE Trustworthy #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">-- | Simple C runtime representation.</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Most types use the same memory and scalar variable representation.</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- For those that do not (as of this writing, only `Float16`), we use</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- 'primStorageType' for the array element representation, and</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- 'primTypeToCType' for their scalar representation.  Use 'toStorage'</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- and 'fromStorage' to convert back and forth.</span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Futhark.CodeGen.Backends.SimpleRep</span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#tupleField"><span class="hs-identifier">tupleField</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#funName"><span class="hs-identifier">funName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#defaultMemBlockType"><span class="hs-identifier">defaultMemBlockType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#intTypeToCType"><span class="hs-identifier">intTypeToCType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#primTypeToCType"><span class="hs-identifier">primTypeToCType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#primStorageType"><span class="hs-identifier">primStorageType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#primAPIType"><span class="hs-identifier">primAPIType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#arrayName"><span class="hs-identifier">arrayName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#opaqueName"><span class="hs-identifier">opaqueName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#toStorage"><span class="hs-identifier">toStorage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#fromStorage"><span class="hs-identifier">fromStorage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#cproduct"><span class="hs-identifier">cproduct</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#csum"><span class="hs-identifier">csum</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#scalarToPrim"><span class="hs-identifier">scalarToPrim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Primitive value operations</span></span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#cScalarDefs"><span class="hs-identifier">cScalarDefs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Storing/restoring values in byte sequences</span></span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#storageSize"><span class="hs-identifier">storageSize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#storeValueHeader"><span class="hs-identifier">storeValueHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#loadValueHeader"><span class="hs-identifier">loadValueHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">where</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bits</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">shiftR</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">xor</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isAlphaNum</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isDigit</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ord</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html"><span class="hs-identifier">Futhark.CodeGen.ImpCode</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.CodeGen.RTS.C.html"><span class="hs-identifier">Futhark.CodeGen.RTS.C</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.RTS.C.html#scalarF16H"><span class="hs-identifier">scalarF16H</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.CodeGen.RTS.C.html#scalarH"><span class="hs-identifier">scalarH</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Util.html"><span class="hs-identifier">Futhark.Util</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.Util.html#zEncodeString"><span class="hs-identifier">zEncodeString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Language.C.Quote.C</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Language.C.Syntax</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Printf</span></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-comment">-- | The C type corresponding to a signed integer type.</span><span>
</span><span id="line-51"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#intTypeToCType"><span class="hs-identifier hs-type">intTypeToCType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Type</span></span><span>
</span><span id="line-52"></span><span id="intTypeToCType"><span class="annot"><span class="annottext">intTypeToCType :: IntType -&gt; Type
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#intTypeToCType"><span class="hs-identifier hs-var hs-var">intTypeToCType</span></a></span></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int8"><span class="hs-identifier hs-var">Int8</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cty|typename int8_t|]</span></span><span>
</span><span id="line-53"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#intTypeToCType"><span class="hs-identifier hs-var">intTypeToCType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int16"><span class="hs-identifier hs-var">Int16</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cty|typename int16_t|]</span></span><span>
</span><span id="line-54"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#intTypeToCType"><span class="hs-identifier hs-var">intTypeToCType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int32"><span class="hs-identifier hs-var">Int32</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cty|typename int32_t|]</span></span><span>
</span><span id="line-55"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#intTypeToCType"><span class="hs-identifier hs-var">intTypeToCType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cty|typename int64_t|]</span></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-comment">-- | The C type corresponding to an unsigned integer type.</span><span>
</span><span id="line-58"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#uintTypeToCType"><span class="hs-identifier hs-type">uintTypeToCType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Type</span></span><span>
</span><span id="line-59"></span><span id="uintTypeToCType"><span class="annot"><span class="annottext">uintTypeToCType :: IntType -&gt; Type
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#uintTypeToCType"><span class="hs-identifier hs-var hs-var">uintTypeToCType</span></a></span></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int8"><span class="hs-identifier hs-var">Int8</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cty|typename uint8_t|]</span></span><span>
</span><span id="line-60"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#uintTypeToCType"><span class="hs-identifier hs-var">uintTypeToCType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int16"><span class="hs-identifier hs-var">Int16</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cty|typename uint16_t|]</span></span><span>
</span><span id="line-61"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#uintTypeToCType"><span class="hs-identifier hs-var">uintTypeToCType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int32"><span class="hs-identifier hs-var">Int32</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cty|typename uint32_t|]</span></span><span>
</span><span id="line-62"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#uintTypeToCType"><span class="hs-identifier hs-var">uintTypeToCType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cty|typename uint64_t|]</span></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-comment">-- | The C type corresponding to a primitive type.  Integers are</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- assumed to be unsigned.</span><span>
</span><span id="line-66"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#primTypeToCType"><span class="hs-identifier hs-type">primTypeToCType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Type</span></span><span>
</span><span id="line-67"></span><span id="primTypeToCType"><span class="annot"><span class="annottext">primTypeToCType :: PrimType -&gt; Type
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#primTypeToCType"><span class="hs-identifier hs-var hs-var">primTypeToCType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span id="local-6989586621684474503"><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684474503"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntType -&gt; Type
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#intTypeToCType"><span class="hs-identifier hs-var">intTypeToCType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684474503"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-68"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#primTypeToCType"><span class="hs-identifier hs-var">primTypeToCType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float16"><span class="hs-identifier hs-var">Float16</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cty|typename f16|]</span></span><span>
</span><span id="line-69"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#primTypeToCType"><span class="hs-identifier hs-var">primTypeToCType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float32"><span class="hs-identifier hs-var">Float32</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cty|float|]</span></span><span>
</span><span id="line-70"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#primTypeToCType"><span class="hs-identifier hs-var">primTypeToCType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float64"><span class="hs-identifier hs-var">Float64</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cty|double|]</span></span><span>
</span><span id="line-71"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#primTypeToCType"><span class="hs-identifier hs-var">primTypeToCType</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Primitive.html#Bool"><span class="hs-identifier hs-var">Bool</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cty|typename bool|]</span></span><span>
</span><span id="line-72"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#primTypeToCType"><span class="hs-identifier hs-var">primTypeToCType</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Primitive.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cty|typename bool|]</span></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- | The C storage type for arrays of this primitive type.</span><span>
</span><span id="line-75"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#primStorageType"><span class="hs-identifier hs-type">primStorageType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Type</span></span><span>
</span><span id="line-76"></span><span id="primStorageType"><span class="annot"><span class="annottext">primStorageType :: PrimType -&gt; Type
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#primStorageType"><span class="hs-identifier hs-var hs-var">primStorageType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float16"><span class="hs-identifier hs-var">Float16</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cty|typename uint16_t|]</span></span><span>
</span><span id="line-77"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#primStorageType"><span class="hs-identifier hs-var">primStorageType</span></a></span><span> </span><span id="local-6989586621684474494"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684474494"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; Type
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#primTypeToCType"><span class="hs-identifier hs-var">primTypeToCType</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684474494"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">-- | The C API corresponding to a primitive type.  Integers are</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- assumed to have the specified sign.</span><span>
</span><span id="line-81"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#primAPIType"><span class="hs-identifier hs-type">primAPIType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Signedness"><span class="hs-identifier hs-type">Signedness</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Type</span></span><span>
</span><span id="line-82"></span><span id="primAPIType"><span class="annot"><span class="annottext">primAPIType :: Signedness -&gt; PrimType -&gt; Type
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#primAPIType"><span class="hs-identifier hs-var hs-var">primAPIType</span></a></span></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">TypeUnsigned</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span id="local-6989586621684474492"><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684474492"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntType -&gt; Type
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#uintTypeToCType"><span class="hs-identifier hs-var">uintTypeToCType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684474492"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-83"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#primAPIType"><span class="hs-identifier hs-var">primAPIType</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeDirect"><span class="hs-identifier hs-var">TypeDirect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span id="local-6989586621684474490"><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684474490"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntType -&gt; Type
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#intTypeToCType"><span class="hs-identifier hs-var">intTypeToCType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="#local-6989586621684474490"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-84"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#primAPIType"><span class="hs-identifier hs-var">primAPIType</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684474489"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684474489"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; Type
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#primStorageType"><span class="hs-identifier hs-var">primStorageType</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684474489"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-comment">-- | Convert from scalar to storage representation for the given type.</span><span>
</span><span id="line-87"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#toStorage"><span class="hs-identifier hs-type">toStorage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Exp</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Exp</span></span><span>
</span><span id="line-88"></span><span id="toStorage"><span class="annot"><span class="annottext">toStorage :: PrimType -&gt; Exp -&gt; Exp
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#toStorage"><span class="hs-identifier hs-var hs-var">toStorage</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float16"><span class="hs-identifier hs-var">Float16</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684474488"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684474488"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cexp|futrts_to_bits16($exp:e)|]</span></span><span>
</span><span id="line-89"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#toStorage"><span class="hs-identifier hs-var">toStorage</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684474484"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684474484"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684474484"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">-- | Convert from storage to scalar representation for the given type.</span><span>
</span><span id="line-92"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#fromStorage"><span class="hs-identifier hs-type">fromStorage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Exp</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Exp</span></span><span>
</span><span id="line-93"></span><span id="fromStorage"><span class="annot"><span class="annottext">fromStorage :: PrimType -&gt; Exp -&gt; Exp
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#fromStorage"><span class="hs-identifier hs-var hs-var">fromStorage</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float16"><span class="hs-identifier hs-var">Float16</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684474483"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684474483"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cexp|futrts_from_bits16($exp:e)|]</span></span><span>
</span><span id="line-94"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#fromStorage"><span class="hs-identifier hs-var">fromStorage</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684474482"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684474482"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684474482"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-comment">-- | @tupleField i@ is the name of field number @i@ in a tuple.</span><span>
</span><span id="line-97"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#tupleField"><span class="hs-identifier hs-type">tupleField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-98"></span><span id="tupleField"><span class="annot"><span class="annottext">tupleField :: Int -&gt; String
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#tupleField"><span class="hs-identifier hs-var hs-var">tupleField</span></a></span></span><span> </span><span id="local-6989586621684474481"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684474481"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;v&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684474481"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-comment">-- | @funName f@ is the name of the C function corresponding to</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- the Futhark function @f@.</span><span>
</span><span id="line-102"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#funName"><span class="hs-identifier hs-type">funName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-103"></span><span id="funName"><span class="annot"><span class="annottext">funName :: Name -&gt; String
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#funName"><span class="hs-identifier hs-var hs-var">funName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;futrts_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; (Name -&gt; String) -&gt; Name -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="Futhark.Util.html#zEncodeString"><span class="hs-identifier hs-var">zEncodeString</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; (Name -&gt; String) -&gt; Name -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
</span><a href="Language.Futhark.Core.html#nameToString"><span class="hs-identifier hs-var">nameToString</span></a></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-comment">-- | The type of memory blocks in the default memory space.</span><span>
</span><span id="line-106"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#defaultMemBlockType"><span class="hs-identifier hs-type">defaultMemBlockType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Type</span></span><span>
</span><span id="line-107"></span><span id="defaultMemBlockType"><span class="annot"><span class="annottext">defaultMemBlockType :: Type
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#defaultMemBlockType"><span class="hs-identifier hs-var hs-var">defaultMemBlockType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cty|unsigned char*|]</span></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">-- | The name of exposed array type structs.</span><span>
</span><span id="line-110"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#arrayName"><span class="hs-identifier hs-type">arrayName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Signedness"><span class="hs-identifier hs-type">Signedness</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-111"></span><span id="arrayName"><span class="annot"><span class="annottext">arrayName :: PrimType -&gt; Signedness -&gt; Int -&gt; String
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#arrayName"><span class="hs-identifier hs-var hs-var">arrayName</span></a></span></span><span> </span><span id="local-6989586621684474474"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684474474"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621684474473"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684474473"><span class="hs-identifier hs-var">signed</span></a></span></span><span> </span><span id="local-6989586621684474472"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684474472"><span class="hs-identifier hs-var">rank</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; PrimType -&gt; String
</span><a href="Futhark.IR.Primitive.html#prettySigned"><span class="hs-identifier hs-var">prettySigned</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684474473"><span class="hs-identifier hs-var">signed</span></a></span><span> </span><span class="annot"><span class="annottext">Signedness -&gt; Signedness -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">TypeUnsigned</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684474474"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684474472"><span class="hs-identifier hs-var">rank</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;d&quot;</span></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-comment">-- | The name of exposed opaque types.</span><span>
</span><span id="line-115"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#opaqueName"><span class="hs-identifier hs-type">opaqueName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ValueDesc"><span class="hs-identifier hs-type">ValueDesc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-116"></span><span id="opaqueName"><span class="annot"><span class="annottext">opaqueName :: String -&gt; [ValueDesc] -&gt; String
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#opaqueName"><span class="hs-identifier hs-var hs-var">opaqueName</span></a></span></span><span> </span><span id="local-6989586621684474470"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684474470"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="annottext">[ValueDesc]
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684474469"><span class="hs-identifier hs-var">valid</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;opaque_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684474470"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-119"></span><span>    </span><span id="local-6989586621684474469"><span class="annot"><span class="annottext">valid :: Bool
</span><a href="#local-6989586621684474469"><span class="hs-identifier hs-var hs-var">valid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-120"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Char
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684474470"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'_'</span></span><span>
</span><span id="line-121"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isDigit</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Char -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Char
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684474470"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; String -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="#local-6989586621684474460"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684474470"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span id="local-6989586621684474460"><span class="annot"><span class="annottext">ok :: Char -&gt; Bool
</span><a href="#local-6989586621684474460"><span class="hs-identifier hs-var hs-var">ok</span></a></span></span><span> </span><span id="local-6989586621684474458"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621684474458"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isAlphaNum</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621684474458"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621684474458"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'_'</span></span><span>
</span><span id="line-124"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#opaqueName"><span class="hs-identifier hs-var">opaqueName</span></a></span><span> </span><span id="local-6989586621684474456"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684474456"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621684474455"><span class="annot"><span class="annottext">[ValueDesc]
</span><a href="#local-6989586621684474455"><span class="hs-identifier hs-var">vds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;opaque_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; String
</span><a href="#local-6989586621684474454"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int) -&gt; [Int] -&gt; [Int] -&gt; [Int]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">xor</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int]) -&gt; [Int] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Int) -&gt; String -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621684474456"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(ValueDesc -&gt; String) -&gt; [ValueDesc] -&gt; String
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">ValueDesc -&gt; String
</span><a href="#local-6989586621684474451"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[ValueDesc]
</span><a href="#local-6989586621684474455"><span class="hs-identifier hs-var">vds</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-126"></span><span>    </span><span id="local-6989586621684474451"><span class="annot"><span class="annottext">p :: ValueDesc -&gt; String
</span><a href="#local-6989586621684474451"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ScalarValue"><span class="hs-identifier hs-type">ScalarValue</span></a></span><span> </span><span id="local-6989586621684474437"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684474437"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621684474436"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684474436"><span class="hs-identifier hs-var">signed</span></a></span></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-127"></span><span>      </span><span class="annot"><span class="annottext">(PrimType, Signedness) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684474437"><span class="hs-identifier hs-var">pt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684474436"><span class="hs-identifier hs-var">signed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>    </span><span class="annot"><a href="#local-6989586621684474451"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#ArrayValue"><span class="hs-identifier hs-type">ArrayValue</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684474434"><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684474434"><span class="hs-identifier hs-var">space</span></a></span></span><span> </span><span id="local-6989586621684474433"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684474433"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621684474432"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684474432"><span class="hs-identifier hs-var">signed</span></a></span></span><span> </span><span id="local-6989586621684474431"><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684474431"><span class="hs-identifier hs-var">dims</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-129"></span><span>      </span><span class="annot"><span class="annottext">(Space, PrimType, Signedness, Int) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Space
</span><a href="#local-6989586621684474434"><span class="hs-identifier hs-var">space</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684474433"><span class="hs-identifier hs-var">pt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684474432"><span class="hs-identifier hs-var">signed</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[DimSize] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[DimSize]
</span><a href="#local-6989586621684474431"><span class="hs-identifier hs-var">dims</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-comment">-- FIXME: a stupid hash algorithm; may have collisions.</span><span>
</span><span id="line-132"></span><span>    </span><span id="local-6989586621684474454"><span class="annot"><span class="annottext">hash :: [Int] -&gt; String
</span><a href="#local-6989586621684474454"><span class="hs-identifier hs-var hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-133"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Word32 -&gt; String
forall r. PrintfType r =&gt; String -&gt; r
</span><span class="hs-identifier hs-var">printf</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;%x&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; String) -&gt; ([Int] -&gt; Word32) -&gt; [Int] -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Word32 -&gt; Word32) -&gt; Word32 -&gt; [Word32] -&gt; Word32
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">xor</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span>
</span><span id="line-134"></span><span>        </span><span class="annot"><span class="annottext">([Word32] -&gt; Word32) -&gt; ([Int] -&gt; [Word32]) -&gt; [Int] -&gt; Word32
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word32) -&gt; [Int] -&gt; [Word32]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span>
</span><span id="line-135"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32
</span><a href="#local-6989586621684474408"><span class="hs-identifier hs-var">iter</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Word32) -&gt; (Int -&gt; Word32) -&gt; Int -&gt; Word32
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0x45d9f3b</span></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>              </span><span class="annot"><span class="annottext">(Word32 -&gt; Word32) -&gt; (Int -&gt; Word32) -&gt; Int -&gt; Word32
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32
</span><a href="#local-6989586621684474408"><span class="hs-identifier hs-var">iter</span></a></span><span>
</span><span id="line-137"></span><span>              </span><span class="annot"><span class="annottext">(Word32 -&gt; Word32) -&gt; (Int -&gt; Word32) -&gt; Int -&gt; Word32
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0x45d9f3b</span></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>              </span><span class="annot"><span class="annottext">(Word32 -&gt; Word32) -&gt; (Int -&gt; Word32) -&gt; Int -&gt; Word32
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32
</span><a href="#local-6989586621684474408"><span class="hs-identifier hs-var">iter</span></a></span><span>
</span><span id="line-139"></span><span>              </span><span class="annot"><span class="annottext">(Word32 -&gt; Word32) -&gt; (Int -&gt; Word32) -&gt; Int -&gt; Word32
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span>
</span><span id="line-140"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>    </span><span id="local-6989586621684474408"><span class="annot"><span class="annottext">iter :: Word32 -&gt; Word32
</span><a href="#local-6989586621684474408"><span class="hs-identifier hs-var hs-var">iter</span></a></span></span><span> </span><span id="local-6989586621684474404"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621684474404"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621684474404"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Int -&gt; Word32
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftR`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`xor`</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621684474404"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-comment">-- | The 'PrimType' (and sign) correspond to a human-readable scalar</span><span>
</span><span id="line-144"></span><span class="hs-comment">-- type name (e.g. @f64@).  Beware: partial!</span><span>
</span><span id="line-145"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#scalarToPrim"><span class="hs-identifier hs-type">scalarToPrim</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Signedness"><span class="hs-identifier hs-type">Signedness</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span id="scalarToPrim"><span class="annot"><span class="annottext">scalarToPrim :: Text -&gt; (Signedness, PrimType)
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#scalarToPrim"><span class="hs-identifier hs-var hs-var">scalarToPrim</span></a></span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;bool&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeDirect"><span class="hs-identifier hs-var">TypeDirect</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Primitive.html#Bool"><span class="hs-identifier hs-var">Bool</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#scalarToPrim"><span class="hs-identifier hs-var">scalarToPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;i8&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeDirect"><span class="hs-identifier hs-var">TypeDirect</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-var">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int8"><span class="hs-identifier hs-var">Int8</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#scalarToPrim"><span class="hs-identifier hs-var">scalarToPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;i16&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeDirect"><span class="hs-identifier hs-var">TypeDirect</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-var">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int16"><span class="hs-identifier hs-var">Int16</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#scalarToPrim"><span class="hs-identifier hs-var">scalarToPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;i32&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeDirect"><span class="hs-identifier hs-var">TypeDirect</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-var">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int32"><span class="hs-identifier hs-var">Int32</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#scalarToPrim"><span class="hs-identifier hs-var">scalarToPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;i64&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeDirect"><span class="hs-identifier hs-var">TypeDirect</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-var">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#scalarToPrim"><span class="hs-identifier hs-var">scalarToPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;u8&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">TypeUnsigned</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-var">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int8"><span class="hs-identifier hs-var">Int8</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#scalarToPrim"><span class="hs-identifier hs-var">scalarToPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;u16&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">TypeUnsigned</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-var">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int16"><span class="hs-identifier hs-var">Int16</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#scalarToPrim"><span class="hs-identifier hs-var">scalarToPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;u32&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">TypeUnsigned</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-var">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int32"><span class="hs-identifier hs-var">Int32</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#scalarToPrim"><span class="hs-identifier hs-var">scalarToPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;u64&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">TypeUnsigned</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-var">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#scalarToPrim"><span class="hs-identifier hs-var">scalarToPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;f16&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeDirect"><span class="hs-identifier hs-var">TypeDirect</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FloatType -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-var">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float16"><span class="hs-identifier hs-var">Float16</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#scalarToPrim"><span class="hs-identifier hs-var">scalarToPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;f32&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeDirect"><span class="hs-identifier hs-var">TypeDirect</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FloatType -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-var">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float32"><span class="hs-identifier hs-var">Float32</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#scalarToPrim"><span class="hs-identifier hs-var">scalarToPrim</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;f64&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeDirect"><span class="hs-identifier hs-var">TypeDirect</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FloatType -&gt; PrimType
</span><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-var">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float64"><span class="hs-identifier hs-var">Float64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#scalarToPrim"><span class="hs-identifier hs-var">scalarToPrim</span></a></span><span> </span><span id="local-6989586621684474403"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684474403"><span class="hs-identifier hs-var">tname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (Signedness, PrimType)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; (Signedness, PrimType))
-&gt; String -&gt; (Signedness, PrimType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;scalarToPrim: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621684474403"><span class="hs-identifier hs-var">tname</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-comment">-- | Return an expression multiplying together the given expressions.</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- If an empty list is given, the expression @1@ is returned.</span><span>
</span><span id="line-162"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#cproduct"><span class="hs-identifier hs-type">cproduct</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">C.Exp</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Exp</span></span><span>
</span><span id="line-163"></span><span id="cproduct"><span class="annot"><span class="annottext">cproduct :: [Exp] -&gt; Exp
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#cproduct"><span class="hs-identifier hs-var hs-var">cproduct</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cexp|1|]</span></span><span>
</span><span id="line-164"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#cproduct"><span class="hs-identifier hs-var">cproduct</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684474397"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684474397"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684474396"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621684474396"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp -&gt; Exp) -&gt; Exp -&gt; [Exp] -&gt; Exp
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
forall {a} {a}. (ToExp a, ToExp a) =&gt; a -&gt; a -&gt; Exp
</span><a href="#local-6989586621684474395"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684474397"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621684474396"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-166"></span><span>    </span><span id="local-6989586621684474395"><span class="annot"><span class="annottext">mult :: a -&gt; a -&gt; Exp
</span><a href="#local-6989586621684474395"><span class="hs-identifier hs-var hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621684474390"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684474390"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621684474389"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684474389"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cexp|$exp:x * $exp:y|]</span></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="hs-comment">-- | Return an expression summing the given expressions.</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- If an empty list is given, the expression @0@ is returned.</span><span>
</span><span id="line-170"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#csum"><span class="hs-identifier hs-type">csum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">C.Exp</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Exp</span></span><span>
</span><span id="line-171"></span><span id="csum"><span class="annot"><span class="annottext">csum :: [Exp] -&gt; Exp
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#csum"><span class="hs-identifier hs-var hs-var">csum</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cexp|0|]</span></span><span>
</span><span id="line-172"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#csum"><span class="hs-identifier hs-var">csum</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684474386"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684474386"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684474385"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621684474385"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; Exp -&gt; Exp) -&gt; Exp -&gt; [Exp] -&gt; Exp
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
forall {a} {a}. (ToExp a, ToExp a) =&gt; a -&gt; a -&gt; Exp
</span><a href="#local-6989586621684474384"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684474386"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621684474385"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-174"></span><span>    </span><span id="local-6989586621684474384"><span class="annot"><span class="annottext">mult :: a -&gt; a -&gt; Exp
</span><a href="#local-6989586621684474384"><span class="hs-identifier hs-var hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621684474379"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684474379"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621684474378"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684474378"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cexp|$exp:x + $exp:y|]</span></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.ToIdent</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-177"></span><span>  </span><span id="local-6989586621684474371"><span class="annot"><span class="annottext">toIdent :: Name -&gt; SrcLoc -&gt; Id
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toIdent</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SrcLoc -&gt; Id
forall a. ToIdent a =&gt; a -&gt; SrcLoc -&gt; Id
</span><span class="hs-identifier hs-var">C.toIdent</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SrcLoc -&gt; Id)
-&gt; (Name -&gt; String) -&gt; Name -&gt; SrcLoc -&gt; Id
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="Futhark.Util.html#zEncodeString"><span class="hs-identifier hs-var">zEncodeString</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; (Name -&gt; String) -&gt; Name -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
</span><a href="Language.Futhark.Core.html#nameToString"><span class="hs-identifier hs-var">nameToString</span></a></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="hs-comment">-- Orphan!</span><span>
</span><span id="line-180"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.ToIdent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-181"></span><span>  </span><span id="local-6989586621684474366"><span class="annot"><span class="annottext">toIdent :: Text -&gt; SrcLoc -&gt; Id
</span><a href="#local-6989586621684474366"><span class="hs-identifier hs-var hs-var hs-var hs-var">toIdent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SrcLoc -&gt; Id
forall a. ToIdent a =&gt; a -&gt; SrcLoc -&gt; Id
</span><span class="hs-identifier hs-var">C.toIdent</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SrcLoc -&gt; Id)
-&gt; (Text -&gt; String) -&gt; Text -&gt; SrcLoc -&gt; Id
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.ToIdent</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-184"></span><span>  </span><span id="local-6989586621684474360"><span class="annot"><span class="annottext">toIdent :: VName -&gt; SrcLoc -&gt; Id
</span><a href="#local-6989586621684474360"><span class="hs-identifier hs-var hs-var hs-var hs-var">toIdent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SrcLoc -&gt; Id
forall a. ToIdent a =&gt; a -&gt; SrcLoc -&gt; Id
</span><span class="hs-identifier hs-var">C.toIdent</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SrcLoc -&gt; Id)
-&gt; (VName -&gt; String) -&gt; VName -&gt; SrcLoc -&gt; Id
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="Futhark.Util.html#zEncodeString"><span class="hs-identifier hs-var">zEncodeString</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; (VName -&gt; String) -&gt; VName -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Futhark.Util.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.ToExp</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-187"></span><span>  </span><span id="local-6989586621684474354"><span class="annot"><span class="annottext">toExp :: VName -&gt; SrcLoc -&gt; Exp
</span><a href="#local-6989586621684474354"><span class="hs-identifier hs-var hs-var hs-var hs-var">toExp</span></a></span></span><span> </span><span id="local-6989586621684474353"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684474353"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cexp|$id:v|]</span></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.ToExp</span></span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntValue"><span class="hs-identifier hs-type">IntValue</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-190"></span><span>  </span><span id="local-6989586621684474330"><span class="annot"><span class="annottext">toExp :: IntValue -&gt; SrcLoc -&gt; Exp
</span><a href="#local-6989586621684474330"><span class="hs-identifier hs-var hs-var hs-var hs-var">toExp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#Int8Value"><span class="hs-identifier hs-type">Int8Value</span></a></span><span> </span><span id="local-6989586621684474328"><span class="annot"><span class="annottext">Int8
</span><a href="#local-6989586621684474328"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cexp|(typename int8_t)$int:k|]</span></span><span>
</span><span id="line-191"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">toExp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#Int16Value"><span class="hs-identifier hs-type">Int16Value</span></a></span><span> </span><span id="local-6989586621684474325"><span class="annot"><span class="annottext">Int16
</span><a href="#local-6989586621684474325"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cexp|(typename int16_t)$int:k|]</span></span><span>
</span><span id="line-192"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">toExp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#Int32Value"><span class="hs-identifier hs-type">Int32Value</span></a></span><span> </span><span id="local-6989586621684474323"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621684474323"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cexp|$int:k|]</span></span><span>
</span><span id="line-193"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">toExp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#Int64Value"><span class="hs-identifier hs-type">Int64Value</span></a></span><span> </span><span id="local-6989586621684474321"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621684474321"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cexp|(typename int64_t)$int:k|]</span></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.ToExp</span></span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatValue"><span class="hs-identifier hs-type">FloatValue</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-196"></span><span>  </span><span id="local-6989586621684474288"><span class="annot"><span class="annottext">toExp :: FloatValue -&gt; SrcLoc -&gt; Exp
</span><a href="#local-6989586621684474288"><span class="hs-identifier hs-var hs-var hs-var hs-var">toExp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#Float16Value"><span class="hs-identifier hs-type">Float16Value</span></a></span><span> </span><span id="local-6989586621684474286"><span class="annot"><span class="annottext">Half
</span><a href="#local-6989586621684474286"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Half -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isInfinite</span></span><span> </span><span class="annot"><span class="annottext">Half
</span><a href="#local-6989586621684474286"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-198"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Half
</span><a href="#local-6989586621684474286"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Half -&gt; Half -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Half
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="">[C.cexp|INFINITY|]</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="">[C.cexp|-INFINITY|]</span></span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Half -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isNaN</span></span><span> </span><span class="annot"><span class="annottext">Half
</span><a href="#local-6989586621684474286"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-200"></span><span>      </span><span class="annot"><span class="">[C.cexp|NAN|]</span></span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-202"></span><span>      </span><span class="annot"><span class="">[C.cexp|$float:(fromRational (toRational x))|]</span></span><span>
</span><span id="line-203"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">toExp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#Float32Value"><span class="hs-identifier hs-type">Float32Value</span></a></span><span> </span><span id="local-6989586621684474278"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621684474278"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isInfinite</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621684474278"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-205"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621684474278"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="">[C.cexp|INFINITY|]</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="">[C.cexp|-INFINITY|]</span></span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isNaN</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621684474278"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-207"></span><span>      </span><span class="annot"><span class="">[C.cexp|NAN|]</span></span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-209"></span><span>      </span><span class="annot"><span class="">[C.cexp|$float:x|]</span></span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">toExp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#Float64Value"><span class="hs-identifier hs-type">Float64Value</span></a></span><span> </span><span id="local-6989586621684474276"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621684474276"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isInfinite</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621684474276"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-212"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621684474276"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="">[C.cexp|INFINITY|]</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="">[C.cexp|-INFINITY|]</span></span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isNaN</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621684474276"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-214"></span><span>      </span><span class="annot"><span class="">[C.cexp|NAN|]</span></span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-216"></span><span>      </span><span class="annot"><span class="">[C.cexp|$double:x|]</span></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.ToExp</span></span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimValue"><span class="hs-identifier hs-type">PrimValue</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-219"></span><span>  </span><span id="local-6989586621684474263"><span class="annot"><span class="annottext">toExp :: PrimValue -&gt; SrcLoc -&gt; Exp
</span><a href="#local-6989586621684474263"><span class="hs-identifier hs-var hs-var hs-var hs-var">toExp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#IntValue"><span class="hs-identifier hs-type">IntValue</span></a></span><span> </span><span id="local-6989586621684474261"><span class="annot"><span class="annottext">IntValue
</span><a href="#local-6989586621684474261"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntValue -&gt; SrcLoc -&gt; Exp
forall a. ToExp a =&gt; a -&gt; SrcLoc -&gt; Exp
</span><span class="hs-identifier hs-var">C.toExp</span></span><span> </span><span class="annot"><span class="annottext">IntValue
</span><a href="#local-6989586621684474261"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-220"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">toExp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatValue"><span class="hs-identifier hs-type">FloatValue</span></a></span><span> </span><span id="local-6989586621684474259"><span class="annot"><span class="annottext">FloatValue
</span><a href="#local-6989586621684474259"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FloatValue -&gt; SrcLoc -&gt; Exp
forall a. ToExp a =&gt; a -&gt; SrcLoc -&gt; Exp
</span><span class="hs-identifier hs-var">C.toExp</span></span><span> </span><span class="annot"><span class="annottext">FloatValue
</span><a href="#local-6989586621684474259"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-221"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">toExp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#BoolValue"><span class="hs-identifier hs-type">BoolValue</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int8 -&gt; SrcLoc -&gt; Exp
forall a. ToExp a =&gt; a -&gt; SrcLoc -&gt; Exp
</span><span class="hs-identifier hs-var">C.toExp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int8
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int8</span></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">toExp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Primitive.html#BoolValue"><span class="hs-identifier hs-type">BoolValue</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int8 -&gt; SrcLoc -&gt; Exp
forall a. ToExp a =&gt; a -&gt; SrcLoc -&gt; Exp
</span><span class="hs-identifier hs-var">C.toExp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int8
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int8</span></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">toExp</span></span><span> </span><span class="annot"><span class="annottext">PrimValue
</span><a href="Futhark.IR.Primitive.html#UnitValue"><span class="hs-identifier hs-var">UnitValue</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int8 -&gt; SrcLoc -&gt; Exp
forall a. ToExp a =&gt; a -&gt; SrcLoc -&gt; Exp
</span><span class="hs-identifier hs-var">C.toExp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int8
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int8</span></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.ToExp</span></span><span> </span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#SubExp"><span class="hs-identifier hs-type">SubExp</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-226"></span><span>  </span><span id="local-6989586621684474251"><span class="annot"><span class="annottext">toExp :: DimSize -&gt; SrcLoc -&gt; Exp
</span><a href="#local-6989586621684474251"><span class="hs-identifier hs-var hs-var hs-var hs-var">toExp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621684474249"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684474249"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; SrcLoc -&gt; Exp
forall a. ToExp a =&gt; a -&gt; SrcLoc -&gt; Exp
</span><span class="hs-identifier hs-var">C.toExp</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684474249"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-227"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">toExp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.IR.Syntax.Core.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span> </span><span id="local-6989586621684474247"><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684474247"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimValue -&gt; SrcLoc -&gt; Exp
forall a. ToExp a =&gt; a -&gt; SrcLoc -&gt; Exp
</span><span class="hs-identifier hs-var">C.toExp</span></span><span> </span><span class="annot"><span class="annottext">PrimValue
</span><a href="#local-6989586621684474247"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="hs-comment">-- | Implementations of scalar operations.</span><span>
</span><span id="line-230"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#cScalarDefs"><span class="hs-identifier hs-type">cScalarDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-231"></span><span id="cScalarDefs"><span class="annot"><span class="annottext">cScalarDefs :: Text
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#cScalarDefs"><span class="hs-identifier hs-var hs-var">cScalarDefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Futhark.CodeGen.RTS.C.html#scalarH"><span class="hs-identifier hs-var">scalarH</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Futhark.CodeGen.RTS.C.html#scalarF16H"><span class="hs-identifier hs-var">scalarF16H</span></a></span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#storageSize"><span class="hs-identifier hs-type">storageSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Exp</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Exp</span></span><span>
</span><span id="line-234"></span><span id="storageSize"><span class="annot"><span class="annottext">storageSize :: PrimType -&gt; Int -&gt; Exp -&gt; Exp
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#storageSize"><span class="hs-identifier hs-var hs-var">storageSize</span></a></span></span><span> </span><span id="local-6989586621684474246"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684474246"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621684474245"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684474245"><span class="hs-identifier hs-var">rank</span></a></span></span><span> </span><span id="local-6989586621684474244"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684474244"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-235"></span><span>  </span><span class="annot"><span class="">[C.cexp|$int:header_size +
          $int:rank * sizeof(typename int64_t) +
          $exp:(cproduct dims) * $int:pt_size|]</span></span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-239"></span><span>    </span><span class="annot"><a href="#local-6989586621684474243"><span class="hs-identifier hs-type">header_size</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621684474242"><span class="hs-identifier hs-type">pt_size</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-240"></span><span>    </span><span id="local-6989586621684474243"><span class="annot"><span class="annottext">header_size :: Int
</span><a href="#local-6989586621684474243"><span class="hs-identifier hs-var hs-var">header_size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="hs-comment">-- 'b' &lt;version&gt; &lt;num_dims&gt; &lt;type&gt;</span><span>
</span><span id="line-241"></span><span>    </span><span id="local-6989586621684474242"><span class="annot"><span class="annottext">pt_size :: Int
</span><a href="#local-6989586621684474242"><span class="hs-identifier hs-var hs-var">pt_size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; Int
forall a. Num a =&gt; PrimType -&gt; a
</span><a href="Futhark.IR.Primitive.html#primByteSize"><span class="hs-identifier hs-var">primByteSize</span></a></span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684474246"><span class="hs-identifier hs-var">pt</span></a></span><span>
</span><span id="line-242"></span><span>    </span><span id="local-6989586621684474241"><span class="annot"><span class="annottext">dims :: [Exp]
</span><a href="#local-6989586621684474241"><span class="hs-identifier hs-var hs-var">dims</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="">[C.cexp|$exp:shape[$int:i]|]</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621684474229"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684474229"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684474245"><span class="hs-identifier hs-var">rank</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#typeStr"><span class="hs-identifier hs-type">typeStr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Signedness"><span class="hs-identifier hs-type">Signedness</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-245"></span><span id="typeStr"><span class="annot"><span class="annottext">typeStr :: Signedness -&gt; PrimType -&gt; String
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#typeStr"><span class="hs-identifier hs-var hs-var">typeStr</span></a></span></span><span> </span><span id="local-6989586621684474226"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684474226"><span class="hs-identifier hs-var">sign</span></a></span></span><span> </span><span id="local-6989586621684474225"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684474225"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684474226"><span class="hs-identifier hs-var">sign</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684474225"><span class="hs-identifier hs-var">pt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Primitive.html#Bool"><span class="hs-identifier hs-var">Bool</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bool&quot;</span></span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimType
</span><a href="Futhark.IR.Primitive.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bool&quot;</span></span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float16"><span class="hs-identifier hs-var">Float16</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; f16&quot;</span></span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float32"><span class="hs-identifier hs-var">Float32</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; f32&quot;</span></span><span>
</span><span id="line-251"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#FloatType"><span class="hs-identifier hs-type">FloatType</span></a></span><span> </span><span class="annot"><span class="annottext">FloatType
</span><a href="Futhark.IR.Primitive.html#Float64"><span class="hs-identifier hs-var">Float64</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; f64&quot;</span></span><span>
</span><span id="line-252"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeDirect"><span class="hs-identifier hs-var">TypeDirect</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int8"><span class="hs-identifier hs-var">Int8</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  i8&quot;</span></span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeDirect"><span class="hs-identifier hs-var">TypeDirect</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int16"><span class="hs-identifier hs-var">Int16</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; i16&quot;</span></span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeDirect"><span class="hs-identifier hs-var">TypeDirect</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int32"><span class="hs-identifier hs-var">Int32</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; i32&quot;</span></span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeDirect"><span class="hs-identifier hs-var">TypeDirect</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; i64&quot;</span></span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">TypeUnsigned</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int8"><span class="hs-identifier hs-var">Int8</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  u8&quot;</span></span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">TypeUnsigned</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int16"><span class="hs-identifier hs-var">Int16</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; u16&quot;</span></span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">TypeUnsigned</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int32"><span class="hs-identifier hs-var">Int32</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; u32&quot;</span></span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Signedness
</span><a href="Futhark.CodeGen.ImpCode.html#TypeUnsigned"><span class="hs-identifier hs-var">TypeUnsigned</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#IntType"><span class="hs-identifier hs-type">IntType</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; u64&quot;</span></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#storeValueHeader"><span class="hs-identifier hs-type">storeValueHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Signedness"><span class="hs-identifier hs-type">Signedness</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Exp</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Exp</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">C.Stm</span></span><span class="hs-special">]</span><span>
</span><span id="line-262"></span><span id="storeValueHeader"><span class="annot"><span class="annottext">storeValueHeader :: Signedness -&gt; PrimType -&gt; Int -&gt; Exp -&gt; Exp -&gt; [Stm]
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#storeValueHeader"><span class="hs-identifier hs-var hs-var">storeValueHeader</span></a></span></span><span> </span><span id="local-6989586621684474224"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684474224"><span class="hs-identifier hs-var">sign</span></a></span></span><span> </span><span id="local-6989586621684474223"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684474223"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621684474222"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684474222"><span class="hs-identifier hs-var">rank</span></a></span></span><span> </span><span id="local-6989586621684474221"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684474221"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span id="local-6989586621684474220"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684474220"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-263"></span><span>  </span><span class="annot"><span class="">[C.cstms|
          *$exp:dest++ = 'b';
          *$exp:dest++ = 2;
          *$exp:dest++ = $int:rank;
          memcpy($exp:dest, $string:(typeStr sign pt), 4);
          $exp:dest += 4;
          $stms:copy_shape
          |]</span></span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-272"></span><span>    </span><span id="local-6989586621684474219"><span class="annot"><span class="annottext">copy_shape :: [Stm]
</span><a href="#local-6989586621684474219"><span class="hs-identifier hs-var hs-var">copy_shape</span></a></span></span><span>
</span><span id="line-273"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684474222"><span class="hs-identifier hs-var">rank</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-274"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-275"></span><span>        </span><span class="annot"><span class="">[C.cstms|
                memcpy($exp:dest, $exp:shape, $int:rank*sizeof(typename int64_t));
                $exp:dest += $int:rank*sizeof(typename int64_t);|]</span></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="annot"><a href="Futhark.CodeGen.Backends.SimpleRep.html#loadValueHeader"><span class="hs-identifier hs-type">loadValueHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Futhark.CodeGen.ImpCode.html#Signedness"><span class="hs-identifier hs-type">Signedness</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Futhark.IR.Primitive.html#PrimType"><span class="hs-identifier hs-type">PrimType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Exp</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Exp</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">C.Stm</span></span><span class="hs-special">]</span><span>
</span><span id="line-280"></span><span id="loadValueHeader"><span class="annot"><span class="annottext">loadValueHeader :: Signedness -&gt; PrimType -&gt; Int -&gt; Exp -&gt; Exp -&gt; [Stm]
</span><a href="Futhark.CodeGen.Backends.SimpleRep.html#loadValueHeader"><span class="hs-identifier hs-var hs-var">loadValueHeader</span></a></span></span><span> </span><span id="local-6989586621684474198"><span class="annot"><span class="annottext">Signedness
</span><a href="#local-6989586621684474198"><span class="hs-identifier hs-var">sign</span></a></span></span><span> </span><span id="local-6989586621684474197"><span class="annot"><span class="annottext">PrimType
</span><a href="#local-6989586621684474197"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621684474196"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684474196"><span class="hs-identifier hs-var">rank</span></a></span></span><span> </span><span id="local-6989586621684474195"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684474195"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span id="local-6989586621684474194"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684474194"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-281"></span><span>  </span><span class="annot"><span class="">[C.cstms|
     err |= (*$exp:src++ != 'b');
     err |= (*$exp:src++ != 2);
     err |= (*$exp:src++ != $exp:rank);
     err |= (memcmp($exp:src, $string:(typeStr sign pt), 4) != 0);
     $exp:src += 4;
     if (err == 0) {
       $stms:load_shape
       $exp:src += $int:rank*sizeof(typename int64_t);
     }|]</span></span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-292"></span><span>    </span><span id="local-6989586621684474193"><span class="annot"><span class="annottext">load_shape :: [Stm]
</span><a href="#local-6989586621684474193"><span class="hs-identifier hs-var hs-var">load_shape</span></a></span></span><span>
</span><span id="line-293"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621684474196"><span class="hs-identifier hs-var">rank</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-294"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[C.cstms|memcpy($exp:shape, src, $int:rank*sizeof(typename int64_t));|]</span></span><span>
</span><span id="line-295"></span></pre></body></html>