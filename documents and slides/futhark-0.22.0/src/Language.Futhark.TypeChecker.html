<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">-- | The type checker checks whether the program is type-consistent</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- and adds type annotations and various other elaborations.  The</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- program does not need to have any particular properties for the</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- type checker to function; in particular it does not need unique</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- names.</span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.Futhark.TypeChecker</span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkProg"><span class="hs-identifier">checkProg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkExp"><span class="hs-identifier">checkExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkDec"><span class="hs-identifier">checkDec</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkModExp"><span class="hs-identifier">checkModExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeError"><span class="hs-identifier">TypeError</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Language.Futhark.Warnings.html#Warnings"><span class="hs-identifier">Warnings</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Language.Futhark.TypeChecker.html#initialEnv"><span class="hs-identifier">initialEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Writer</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Sum</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">first</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">second</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isAlpha</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isAlphaNum</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isPrefixOf</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Ord</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.FreshNames.html"><span class="hs-identifier">Futhark.FreshNames</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Futhark.FreshNames.html#newName"><span class="hs-identifier">newName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Futhark.Util.Pretty.html"><span class="hs-identifier">Futhark.Util.Pretty</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">space</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.html"><span class="hs-identifier">Language.Futhark</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html"><span class="hs-identifier">Language.Futhark.Semantic</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Modules.html"><span class="hs-identifier">Language.Futhark.TypeChecker.Modules</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html"><span class="hs-identifier">Language.Futhark.TypeChecker.Monad</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Terms.html"><span class="hs-identifier">Language.Futhark.TypeChecker.Terms</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Types.html"><span class="hs-identifier">Language.Futhark.TypeChecker.Types</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">abs</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mod</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-comment">--- The main checker</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-comment">-- | Type check a program containing no type information, yielding</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- either a type error or a program with complete type information.</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- Accepts a mapping from file names (excluding extension) to</span><span>
</span><span id="line-45"></span><span class="hs-comment">-- previously type checked results.  The 'ImportName' is used to resolve</span><span>
</span><span id="line-46"></span><span class="hs-comment">-- relative @import@s.</span><span>
</span><span id="line-47"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkProg"><span class="hs-identifier hs-type">checkProg</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><a href="Language.Futhark.Semantic.html#Imports"><span class="hs-identifier hs-type">Imports</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><a href="Futhark.FreshNames.html#VNameSource"><span class="hs-identifier hs-type">VNameSource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><a href="Language.Futhark.Semantic.html#ImportName"><span class="hs-identifier hs-type">ImportName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedProg"><span class="hs-identifier hs-type">UncheckedProg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Warnings.html#Warnings"><span class="hs-identifier hs-type">Warnings</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeError"><span class="hs-identifier hs-type">TypeError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Semantic.html#FileModule"><span class="hs-identifier hs-type">FileModule</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.FreshNames.html#VNameSource"><span class="hs-identifier hs-type">VNameSource</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span id="checkProg"><span class="annot"><span class="annottext">checkProg :: Imports
-&gt; VNameSource
-&gt; ImportName
-&gt; UncheckedProg
-&gt; (Warnings, Either TypeError (FileModule, VNameSource))
</span><a href="Language.Futhark.TypeChecker.html#checkProg"><span class="hs-identifier hs-var hs-var">checkProg</span></a></span></span><span> </span><span id="local-6989586621684565960"><span class="annot"><span class="annottext">Imports
</span><a href="#local-6989586621684565960"><span class="hs-identifier hs-var">files</span></a></span></span><span> </span><span id="local-6989586621684565959"><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684565959"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621684565958"><span class="annot"><span class="annottext">ImportName
</span><a href="#local-6989586621684565958"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621684565957"><span class="annot"><span class="annottext">UncheckedProg
</span><a href="#local-6989586621684565957"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><span class="annottext">Env
-&gt; ImportTable
-&gt; ImportName
-&gt; VNameSource
-&gt; TypeM FileModule
-&gt; (Warnings, Either TypeError (FileModule, VNameSource))
forall a.
Env
-&gt; ImportTable
-&gt; ImportName
-&gt; VNameSource
-&gt; TypeM a
-&gt; (Warnings, Either TypeError (a, VNameSource))
</span><a href="Language.Futhark.TypeChecker.Monad.html#runTypeM"><span class="hs-identifier hs-var">runTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="Language.Futhark.TypeChecker.html#initialEnv"><span class="hs-identifier hs-var">initialEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ImportTable
</span><a href="#local-6989586621684565955"><span class="hs-identifier hs-var">files'</span></a></span><span> </span><span class="annot"><span class="annottext">ImportName
</span><a href="#local-6989586621684565958"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684565959"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeM FileModule
 -&gt; (Warnings, Either TypeError (FileModule, VNameSource)))
-&gt; TypeM FileModule
-&gt; (Warnings, Either TypeError (FileModule, VNameSource))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UncheckedProg -&gt; TypeM FileModule
</span><a href="Language.Futhark.TypeChecker.html#checkProgM"><span class="hs-identifier hs-var">checkProgM</span></a></span><span> </span><span class="annot"><span class="annottext">UncheckedProg
</span><a href="#local-6989586621684565957"><span class="hs-identifier hs-var">prog</span></a></span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-56"></span><span>    </span><span id="local-6989586621684565955"><span class="annot"><span class="annottext">files' :: ImportTable
</span><a href="#local-6989586621684565955"><span class="hs-identifier hs-var hs-var">files'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FileModule -&gt; Env) -&gt; Map [Char] FileModule -&gt; ImportTable
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="annot"><span class="annottext">FileModule -&gt; Env
</span><a href="Language.Futhark.Semantic.html#fileEnv"><span class="hs-identifier hs-var hs-var">fileEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Map [Char] FileModule -&gt; ImportTable)
-&gt; Map [Char] FileModule -&gt; ImportTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Imports -&gt; Map [Char] FileModule
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">Imports
</span><a href="#local-6989586621684565960"><span class="hs-identifier hs-var">files</span></a></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-comment">-- | Type check a single expression containing no type information,</span><span>
</span><span id="line-59"></span><span class="hs-comment">-- yielding either a type error or the same expression annotated with</span><span>
</span><span id="line-60"></span><span class="hs-comment">-- type information.  Also returns a list of type parameters, which</span><span>
</span><span id="line-61"></span><span class="hs-comment">-- will be nonempty if the expression is polymorphic.  See also</span><span>
</span><span id="line-62"></span><span class="hs-comment">-- 'checkProg'.</span><span>
</span><span id="line-63"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkExp"><span class="hs-identifier hs-type">checkExp</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="Language.Futhark.Semantic.html#Imports"><span class="hs-identifier hs-type">Imports</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><a href="Futhark.FreshNames.html#VNameSource"><span class="hs-identifier hs-type">VNameSource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><a href="Language.Futhark.Semantic.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-67"></span><span>  </span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedExp"><span class="hs-identifier hs-type">UncheckedExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Warnings.html#Warnings"><span class="hs-identifier hs-type">Warnings</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeError"><span class="hs-identifier hs-type">TypeError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#TypeParam"><span class="hs-identifier hs-type">TypeParam</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span id="checkExp"><span class="annot"><span class="annottext">checkExp :: Imports
-&gt; VNameSource
-&gt; Env
-&gt; UncheckedExp
-&gt; (Warnings, Either TypeError ([TypeParamBase VName], Exp))
</span><a href="Language.Futhark.TypeChecker.html#checkExp"><span class="hs-identifier hs-var hs-var">checkExp</span></a></span></span><span> </span><span id="local-6989586621684565945"><span class="annot"><span class="annottext">Imports
</span><a href="#local-6989586621684565945"><span class="hs-identifier hs-var">files</span></a></span></span><span> </span><span id="local-6989586621684565944"><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684565944"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621684565943"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565943"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621684565942"><span class="annot"><span class="annottext">UncheckedExp
</span><a href="#local-6989586621684565942"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><span class="annottext">(Either TypeError (([TypeParamBase VName], Exp), VNameSource)
 -&gt; Either TypeError ([TypeParamBase VName], Exp))
-&gt; (Warnings,
    Either TypeError (([TypeParamBase VName], Exp), VNameSource))
-&gt; (Warnings, Either TypeError ([TypeParamBase VName], Exp))
forall (p :: * -&gt; * -&gt; *) b c a.
Bifunctor p =&gt;
(b -&gt; c) -&gt; p a b -&gt; p a c
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((([TypeParamBase VName], Exp), VNameSource)
 -&gt; ([TypeParamBase VName], Exp))
-&gt; Either TypeError (([TypeParamBase VName], Exp), VNameSource)
-&gt; Either TypeError ([TypeParamBase VName], Exp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(([TypeParamBase VName], Exp), VNameSource)
-&gt; ([TypeParamBase VName], Exp)
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Warnings,
  Either TypeError (([TypeParamBase VName], Exp), VNameSource))
 -&gt; (Warnings, Either TypeError ([TypeParamBase VName], Exp)))
-&gt; (Warnings,
    Either TypeError (([TypeParamBase VName], Exp), VNameSource))
-&gt; (Warnings, Either TypeError ([TypeParamBase VName], Exp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Env
-&gt; ImportTable
-&gt; ImportName
-&gt; VNameSource
-&gt; TypeM ([TypeParamBase VName], Exp)
-&gt; (Warnings,
    Either TypeError (([TypeParamBase VName], Exp), VNameSource))
forall a.
Env
-&gt; ImportTable
-&gt; ImportName
-&gt; VNameSource
-&gt; TypeM a
-&gt; (Warnings, Either TypeError (a, VNameSource))
</span><a href="Language.Futhark.TypeChecker.Monad.html#runTypeM"><span class="hs-identifier hs-var">runTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565943"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">ImportTable
</span><a href="#local-6989586621684565941"><span class="hs-identifier hs-var">files'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; ImportName
</span><a href="Language.Futhark.Semantic.html#mkInitialImport"><span class="hs-identifier hs-var">mkInitialImport</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684565944"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeM ([TypeParamBase VName], Exp)
 -&gt; (Warnings,
     Either TypeError (([TypeParamBase VName], Exp), VNameSource)))
-&gt; TypeM ([TypeParamBase VName], Exp)
-&gt; (Warnings,
    Either TypeError (([TypeParamBase VName], Exp), VNameSource))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UncheckedExp -&gt; TypeM ([TypeParamBase VName], Exp)
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkOneExp"><span class="hs-identifier hs-var">checkOneExp</span></a></span><span> </span><span class="annot"><span class="annottext">UncheckedExp
</span><a href="#local-6989586621684565942"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-72"></span><span>    </span><span id="local-6989586621684565941"><span class="annot"><span class="annottext">files' :: ImportTable
</span><a href="#local-6989586621684565941"><span class="hs-identifier hs-var hs-var">files'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FileModule -&gt; Env) -&gt; Map [Char] FileModule -&gt; ImportTable
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="annot"><span class="annottext">FileModule -&gt; Env
</span><a href="Language.Futhark.Semantic.html#fileEnv"><span class="hs-identifier hs-var hs-var">fileEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Map [Char] FileModule -&gt; ImportTable)
-&gt; Map [Char] FileModule -&gt; ImportTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Imports -&gt; Map [Char] FileModule
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">Imports
</span><a href="#local-6989586621684565945"><span class="hs-identifier hs-var">files</span></a></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- | Type check a single declaration containing no type information,</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- yielding either a type error or the same declaration annotated with</span><span>
</span><span id="line-76"></span><span class="hs-comment">-- type information along the Env produced by that declaration.  See</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- also 'checkProg'.</span><span>
</span><span id="line-78"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkDec"><span class="hs-identifier hs-type">checkDec</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><a href="Language.Futhark.Semantic.html#Imports"><span class="hs-identifier hs-type">Imports</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><a href="Futhark.FreshNames.html#VNameSource"><span class="hs-identifier hs-type">VNameSource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-81"></span><span>  </span><span class="annot"><a href="Language.Futhark.Semantic.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-82"></span><span>  </span><span class="annot"><a href="Language.Futhark.Semantic.html#ImportName"><span class="hs-identifier hs-type">ImportName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-83"></span><span>  </span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedDec"><span class="hs-identifier hs-type">UncheckedDec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Warnings.html#Warnings"><span class="hs-identifier hs-type">Warnings</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeError"><span class="hs-identifier hs-type">TypeError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Semantic.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.html#Dec"><span class="hs-identifier hs-type">Dec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Futhark.FreshNames.html#VNameSource"><span class="hs-identifier hs-type">VNameSource</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span id="checkDec"><span class="annot"><span class="annottext">checkDec :: Imports
-&gt; VNameSource
-&gt; Env
-&gt; ImportName
-&gt; UncheckedDec
-&gt; (Warnings, Either TypeError (Env, Dec, VNameSource))
</span><a href="Language.Futhark.TypeChecker.html#checkDec"><span class="hs-identifier hs-var hs-var">checkDec</span></a></span></span><span> </span><span id="local-6989586621684565936"><span class="annot"><span class="annottext">Imports
</span><a href="#local-6989586621684565936"><span class="hs-identifier hs-var">files</span></a></span></span><span> </span><span id="local-6989586621684565935"><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684565935"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621684565934"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565934"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621684565933"><span class="annot"><span class="annottext">ImportName
</span><a href="#local-6989586621684565933"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621684565932"><span class="annot"><span class="annottext">UncheckedDec
</span><a href="#local-6989586621684565932"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><span class="annottext">(Either TypeError ((Env, Dec), VNameSource)
 -&gt; Either TypeError (Env, Dec, VNameSource))
-&gt; (Warnings, Either TypeError ((Env, Dec), VNameSource))
-&gt; (Warnings, Either TypeError (Env, Dec, VNameSource))
forall (p :: * -&gt; * -&gt; *) b c a.
Bifunctor p =&gt;
(b -&gt; c) -&gt; p a b -&gt; p a c
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((Env, Dec), VNameSource) -&gt; (Env, Dec, VNameSource))
-&gt; Either TypeError ((Env, Dec), VNameSource)
-&gt; Either TypeError (Env, Dec, VNameSource)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((Env, Dec), VNameSource) -&gt; (Env, Dec, VNameSource)
forall {a} {b} {c}. ((a, b), c) -&gt; (a, b, c)
</span><a href="#local-6989586621684565931"><span class="hs-identifier hs-var">massage</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Warnings, Either TypeError ((Env, Dec), VNameSource))
 -&gt; (Warnings, Either TypeError (Env, Dec, VNameSource)))
-&gt; (Warnings, Either TypeError ((Env, Dec), VNameSource))
-&gt; (Warnings, Either TypeError (Env, Dec, VNameSource))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><span class="annottext">Env
-&gt; ImportTable
-&gt; ImportName
-&gt; VNameSource
-&gt; TypeM (Env, Dec)
-&gt; (Warnings, Either TypeError ((Env, Dec), VNameSource))
forall a.
Env
-&gt; ImportTable
-&gt; ImportName
-&gt; VNameSource
-&gt; TypeM a
-&gt; (Warnings, Either TypeError (a, VNameSource))
</span><a href="Language.Futhark.TypeChecker.Monad.html#runTypeM"><span class="hs-identifier hs-var">runTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565934"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">ImportTable
</span><a href="#local-6989586621684565930"><span class="hs-identifier hs-var">files'</span></a></span><span> </span><span class="annot"><span class="annottext">ImportName
</span><a href="#local-6989586621684565933"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684565935"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeM (Env, Dec)
 -&gt; (Warnings, Either TypeError ((Env, Dec), VNameSource)))
-&gt; TypeM (Env, Dec)
-&gt; (Warnings, Either TypeError ((Env, Dec), VNameSource))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-88"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySet
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565929"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565929"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565928"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621684565928"><span class="hs-identifier hs-var">d'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UncheckedDec -&gt; TypeM (TySet, Env, Dec)
</span><a href="Language.Futhark.TypeChecker.html#checkOneDec"><span class="hs-identifier hs-var">checkOneDec</span></a></span><span> </span><span class="annot"><span class="annottext">UncheckedDec
</span><a href="#local-6989586621684565932"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-89"></span><span>      </span><span class="annot"><span class="annottext">(Env, Dec) -&gt; TypeM (Env, Dec)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565929"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">Env -&gt; Env -&gt; Env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565934"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621684565928"><span class="hs-identifier hs-var">d'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-91"></span><span>    </span><span id="local-6989586621684565931"><span class="annot"><span class="annottext">massage :: ((a, b), c) -&gt; (a, b, c)
</span><a href="#local-6989586621684565931"><span class="hs-identifier hs-var hs-var">massage</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621684565926"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684565926"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565925"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621684565925"><span class="hs-identifier hs-var">d'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565924"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621684565924"><span class="hs-identifier hs-var">src'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-92"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684565926"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621684565925"><span class="hs-identifier hs-var">d'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621684565924"><span class="hs-identifier hs-var">src'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>    </span><span id="local-6989586621684565930"><span class="annot"><span class="annottext">files' :: ImportTable
</span><a href="#local-6989586621684565930"><span class="hs-identifier hs-var hs-var">files'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FileModule -&gt; Env) -&gt; Map [Char] FileModule -&gt; ImportTable
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="annot"><span class="annottext">FileModule -&gt; Env
</span><a href="Language.Futhark.Semantic.html#fileEnv"><span class="hs-identifier hs-var hs-var">fileEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Map [Char] FileModule -&gt; ImportTable)
-&gt; Map [Char] FileModule -&gt; ImportTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Imports -&gt; Map [Char] FileModule
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">Imports
</span><a href="#local-6989586621684565936"><span class="hs-identifier hs-var">files</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-comment">-- | Type check a single module expression containing no type information,</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- yielding either a type error or the same expression annotated with</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- type information along the Env produced by that declaration.  See</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- also 'checkProg'.</span><span>
</span><span id="line-99"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkModExp"><span class="hs-identifier hs-type">checkModExp</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><a href="Language.Futhark.Semantic.html#Imports"><span class="hs-identifier hs-type">Imports</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><a href="Futhark.FreshNames.html#VNameSource"><span class="hs-identifier hs-type">VNameSource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><a href="Language.Futhark.Semantic.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#ModExpBase"><span class="hs-identifier hs-type">ModExpBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Warnings.html#Warnings"><span class="hs-identifier hs-type">Warnings</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeError"><span class="hs-identifier hs-type">TypeError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Semantic.html#MTy"><span class="hs-identifier hs-type">MTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#ModExpBase"><span class="hs-identifier hs-type">ModExpBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span id="checkModExp"><span class="annot"><span class="annottext">checkModExp :: Imports
-&gt; VNameSource
-&gt; Env
-&gt; ModExpBase NoInfo Name
-&gt; (Warnings, Either TypeError (MTy, ModExpBase Info VName))
</span><a href="Language.Futhark.TypeChecker.html#checkModExp"><span class="hs-identifier hs-var hs-var">checkModExp</span></a></span></span><span> </span><span id="local-6989586621684565921"><span class="annot"><span class="annottext">Imports
</span><a href="#local-6989586621684565921"><span class="hs-identifier hs-var">files</span></a></span></span><span> </span><span id="local-6989586621684565920"><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684565920"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621684565919"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565919"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621684565918"><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565918"><span class="hs-identifier hs-var">me</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><span class="annottext">(Either TypeError ((MTy, ModExpBase Info VName), VNameSource)
 -&gt; Either TypeError (MTy, ModExpBase Info VName))
-&gt; (Warnings,
    Either TypeError ((MTy, ModExpBase Info VName), VNameSource))
-&gt; (Warnings, Either TypeError (MTy, ModExpBase Info VName))
forall (p :: * -&gt; * -&gt; *) b c a.
Bifunctor p =&gt;
(b -&gt; c) -&gt; p a b -&gt; p a c
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((MTy, ModExpBase Info VName), VNameSource)
 -&gt; (MTy, ModExpBase Info VName))
-&gt; Either TypeError ((MTy, ModExpBase Info VName), VNameSource)
-&gt; Either TypeError (MTy, ModExpBase Info VName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((MTy, ModExpBase Info VName), VNameSource)
-&gt; (MTy, ModExpBase Info VName)
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Warnings,
  Either TypeError ((MTy, ModExpBase Info VName), VNameSource))
 -&gt; (Warnings, Either TypeError (MTy, ModExpBase Info VName)))
-&gt; (TypeM (MTy, ModExpBase Info VName)
    -&gt; (Warnings,
        Either TypeError ((MTy, ModExpBase Info VName), VNameSource)))
-&gt; TypeM (MTy, ModExpBase Info VName)
-&gt; (Warnings, Either TypeError (MTy, ModExpBase Info VName))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Env
-&gt; ImportTable
-&gt; ImportName
-&gt; VNameSource
-&gt; TypeM (MTy, ModExpBase Info VName)
-&gt; (Warnings,
    Either TypeError ((MTy, ModExpBase Info VName), VNameSource))
forall a.
Env
-&gt; ImportTable
-&gt; ImportName
-&gt; VNameSource
-&gt; TypeM a
-&gt; (Warnings, Either TypeError (a, VNameSource))
</span><a href="Language.Futhark.TypeChecker.Monad.html#runTypeM"><span class="hs-identifier hs-var">runTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565919"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">ImportTable
</span><a href="#local-6989586621684565916"><span class="hs-identifier hs-var">files'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; ImportName
</span><a href="Language.Futhark.Semantic.html#mkInitialImport"><span class="hs-identifier hs-var">mkInitialImport</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VNameSource
</span><a href="#local-6989586621684565920"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeM (MTy, ModExpBase Info VName)
 -&gt; (Warnings, Either TypeError (MTy, ModExpBase Info VName)))
-&gt; TypeM (MTy, ModExpBase Info VName)
-&gt; (Warnings, Either TypeError (MTy, ModExpBase Info VName))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684565915"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565915"><span class="hs-identifier hs-var">_abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565914"><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565914"><span class="hs-identifier hs-var">mty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565913"><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565913"><span class="hs-identifier hs-var">me'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name -&gt; TypeM (TySet, MTy, ModExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkOneModExp"><span class="hs-identifier hs-var">checkOneModExp</span></a></span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565918"><span class="hs-identifier hs-var">me</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><span class="annottext">(MTy, ModExpBase Info VName) -&gt; TypeM (MTy, ModExpBase Info VName)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565914"><span class="hs-identifier hs-var">mty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565913"><span class="hs-identifier hs-var">me'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621684565916"><span class="annot"><span class="annottext">files' :: ImportTable
</span><a href="#local-6989586621684565916"><span class="hs-identifier hs-var hs-var">files'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FileModule -&gt; Env) -&gt; Map [Char] FileModule -&gt; ImportTable
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="annot"><span class="annottext">FileModule -&gt; Env
</span><a href="Language.Futhark.Semantic.html#fileEnv"><span class="hs-identifier hs-var hs-var">fileEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Map [Char] FileModule -&gt; ImportTable)
-&gt; Map [Char] FileModule -&gt; ImportTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Imports -&gt; Map [Char] FileModule
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">Imports
</span><a href="#local-6989586621684565921"><span class="hs-identifier hs-var">files</span></a></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-comment">-- | An initial environment for the type checker, containing</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- intrinsics and such.</span><span>
</span><span id="line-114"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#initialEnv"><span class="hs-identifier hs-type">initialEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span>
</span><span id="line-115"></span><span id="initialEnv"><span class="annot"><span class="annottext">initialEnv :: Env
</span><a href="Language.Futhark.TypeChecker.html#initialEnv"><span class="hs-identifier hs-var hs-var">initialEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-116"></span><span>  </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565909"><span class="hs-identifier hs-var">intrinsicsModule</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">envModTable :: Map VName Mod
</span><a href="Language.Futhark.Semantic.html#envModTable"><span class="hs-identifier hs-var">envModTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map VName Mod
</span><a href="#local-6989586621684565907"><span class="hs-identifier hs-var">initialModTable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-118"></span><span>      </span><span class="annot"><span class="annottext">envNameMap :: NameMap
</span><a href="Language.Futhark.Semantic.html#envNameMap"><span class="hs-identifier hs-var">envNameMap</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-119"></span><span>        </span><span class="annot"><span class="annottext">(Namespace, Name) -&gt; QualName VName -&gt; NameMap -&gt; NameMap
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span>
</span><span id="line-120"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Name
</span><a href="Language.Futhark.Core.html#nameFromString"><span class="hs-identifier hs-var">nameFromString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;intrinsics&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565901"><span class="hs-identifier hs-var">intrinsics_v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>          </span><span class="annot"><span class="annottext">NameMap
</span><a href="Language.Futhark.TypeChecker.Monad.html#topLevelNameMap"><span class="hs-identifier hs-var">topLevelNameMap</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-125"></span><span>    </span><span id="local-6989586621684565898"><span class="annot"><span class="annottext">initialTypeTable :: Map VName TypeBinding
</span><a href="#local-6989586621684565898"><span class="hs-identifier hs-var hs-var">initialTypeTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(VName, TypeBinding)] -&gt; Map VName TypeBinding
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(VName, TypeBinding)] -&gt; Map VName TypeBinding)
-&gt; [(VName, TypeBinding)] -&gt; Map VName TypeBinding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((VName, Intrinsic) -&gt; Maybe (VName, TypeBinding))
-&gt; [(VName, Intrinsic)] -&gt; [(VName, TypeBinding)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">(VName, Intrinsic) -&gt; Maybe (VName, TypeBinding)
forall {a}. (a, Intrinsic) -&gt; Maybe (a, TypeBinding)
</span><a href="#local-6989586621684565896"><span class="hs-identifier hs-var">addIntrinsicT</span></a></span><span> </span><span class="annot"><span class="annottext">([(VName, Intrinsic)] -&gt; [(VName, TypeBinding)])
-&gt; [(VName, Intrinsic)] -&gt; [(VName, TypeBinding)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map VName Intrinsic -&gt; [(VName, Intrinsic)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">Map VName Intrinsic
</span><a href="Language.Futhark.Prop.html#intrinsics"><span class="hs-identifier hs-var">intrinsics</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span id="local-6989586621684565907"><span class="annot"><span class="annottext">initialModTable :: Map VName Mod
</span><a href="#local-6989586621684565907"><span class="hs-identifier hs-var hs-var">initialModTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Mod -&gt; Map VName Mod
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565901"><span class="hs-identifier hs-var">intrinsics_v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env -&gt; Mod
</span><a href="Language.Futhark.Semantic.html#ModEnv"><span class="hs-identifier hs-var">ModEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565909"><span class="hs-identifier hs-var">intrinsicsModule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span>    </span><span id="local-6989586621684565901"><span class="annot"><span class="annottext">intrinsics_v :: VName
</span><a href="#local-6989586621684565901"><span class="hs-identifier hs-var hs-var">intrinsics_v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Int -&gt; VName
</span><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-var">VName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Name
</span><a href="Language.Futhark.Core.html#nameFromString"><span class="hs-identifier hs-var">nameFromString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;intrinsics&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span>    </span><span id="local-6989586621684565909"><span class="annot"><span class="annottext">intrinsicsModule :: Env
</span><a href="#local-6989586621684565909"><span class="hs-identifier hs-var hs-var">intrinsicsModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map VName BoundV
-&gt; Map VName TypeBinding
-&gt; Map VName MTy
-&gt; Map VName Mod
-&gt; NameMap
-&gt; Env
</span><a href="Language.Futhark.Semantic.html#Env"><span class="hs-identifier hs-var">Env</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName BoundV
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Map VName TypeBinding
</span><a href="#local-6989586621684565898"><span class="hs-identifier hs-var">initialTypeTable</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName MTy
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Map VName Mod
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">NameMap
</span><a href="Language.Futhark.TypeChecker.Monad.html#intrinsicsNameMap"><span class="hs-identifier hs-var">intrinsicsNameMap</span></a></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span>    </span><span id="local-6989586621684565896"><span class="annot"><span class="annottext">addIntrinsicT :: (a, Intrinsic) -&gt; Maybe (a, TypeBinding)
</span><a href="#local-6989586621684565896"><span class="hs-identifier hs-var hs-var">addIntrinsicT</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684565884"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684565884"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Prop.html#IntrinsicType"><span class="hs-identifier hs-type">IntrinsicType</span></a></span><span> </span><span id="local-6989586621684565882"><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684565882"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621684565881"><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565881"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621684565880"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565880"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-133"></span><span>      </span><span class="annot"><span class="annottext">(a, TypeBinding) -&gt; Maybe (a, TypeBinding)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684565884"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Liftedness -&gt; [TypeParamBase VName] -&gt; StructRetType -&gt; TypeBinding
</span><a href="Language.Futhark.Semantic.html#TypeAbbr"><span class="hs-identifier hs-var">TypeAbbr</span></a></span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684565882"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565881"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">(StructRetType -&gt; TypeBinding) -&gt; StructRetType -&gt; TypeBinding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; StructType -&gt; StructRetType
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565880"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><a href="#local-6989586621684565896"><span class="hs-identifier hs-var">addIntrinsicT</span></a></span><span> </span><span class="annot"><span class="annottext">(a, Intrinsic)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-135"></span><span>      </span><span class="annot"><span class="annottext">Maybe (a, TypeBinding)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkProgM"><span class="hs-identifier hs-type">checkProgM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Prop.html#UncheckedProg"><span class="hs-identifier hs-type">UncheckedProg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#FileModule"><span class="hs-identifier hs-type">FileModule</span></a></span><span>
</span><span id="line-138"></span><span id="checkProgM"><span class="annot"><span class="annottext">checkProgM :: UncheckedProg -&gt; TypeM FileModule
</span><a href="Language.Futhark.TypeChecker.html#checkProgM"><span class="hs-identifier hs-var hs-var">checkProgM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span> </span><span id="local-6989586621684565876"><span class="annot"><span class="annottext">Maybe DocComment
</span><a href="#local-6989586621684565876"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span id="local-6989586621684565875"><span class="annot"><span class="annottext">[UncheckedDec]
</span><a href="#local-6989586621684565875"><span class="hs-identifier hs-var">decs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-139"></span><span>  </span><span class="annot"><span class="annottext">[UncheckedDec] -&gt; TypeM ()
</span><a href="Language.Futhark.TypeChecker.html#checkForDuplicateDecs"><span class="hs-identifier hs-var">checkForDuplicateDecs</span></a></span><span> </span><span class="annot"><span class="annottext">[UncheckedDec]
</span><a href="#local-6989586621684565875"><span class="hs-identifier hs-var">decs</span></a></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565873"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565873"><span class="hs-identifier hs-var">abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565872"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565872"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565871"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621684565871"><span class="hs-identifier hs-var">decs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[UncheckedDec] -&gt; TypeM (TySet, Env, [Dec])
</span><a href="Language.Futhark.TypeChecker.html#checkDecs"><span class="hs-identifier hs-var">checkDecs</span></a></span><span> </span><span class="annot"><span class="annottext">[UncheckedDec]
</span><a href="#local-6989586621684565875"><span class="hs-identifier hs-var">decs</span></a></span><span>
</span><span id="line-141"></span><span>  </span><span class="annot"><span class="annottext">FileModule -&gt; TypeM FileModule
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySet -&gt; Env -&gt; Prog -&gt; FileModule
</span><a href="Language.Futhark.Semantic.html#FileModule"><span class="hs-identifier hs-var">FileModule</span></a></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565873"><span class="hs-identifier hs-var">abs</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565872"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">(Prog -&gt; FileModule) -&gt; Prog -&gt; FileModule
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment -&gt; [Dec] -&gt; Prog
forall (f :: * -&gt; *) vn.
Maybe DocComment -&gt; [DecBase f vn] -&gt; ProgBase f vn
</span><a href="Language.Futhark.Syntax.html#Prog"><span class="hs-identifier hs-var">Prog</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><a href="#local-6989586621684565876"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621684565871"><span class="hs-identifier hs-var">decs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span id="local-6989586621684566547"><span id="local-6989586621684566548"><span class="annot"><a href="Language.Futhark.TypeChecker.html#dupDefinitionError"><span class="hs-identifier hs-type">dupDefinitionError</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-144"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#MonadTypeChecker"><span class="hs-identifier hs-type">MonadTypeChecker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684566548"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-145"></span><span>  </span><span class="annot"><a href="Language.Futhark.Semantic.html#Namespace"><span class="hs-identifier hs-type">Namespace</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-149"></span><span>  </span><span class="annot"><a href="#local-6989586621684566548"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684566547"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-150"></span><span id="dupDefinitionError"><span class="annot"><span class="annottext">dupDefinitionError :: forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
Namespace -&gt; Name -&gt; SrcLoc -&gt; SrcLoc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.html#dupDefinitionError"><span class="hs-identifier hs-var hs-var">dupDefinitionError</span></a></span></span><span> </span><span id="local-6989586621684565854"><span class="annot"><span class="annottext">Namespace
</span><a href="#local-6989586621684565854"><span class="hs-identifier hs-var">space</span></a></span></span><span> </span><span id="local-6989586621684565853"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565853"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621684565852"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565852"><span class="hs-identifier hs-var">loc1</span></a></span></span><span> </span><span id="local-6989586621684565851"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565851"><span class="hs-identifier hs-var">loc2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-151"></span><span>  </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; m a
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565852"><span class="hs-identifier hs-var">loc1</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; m a) -&gt; Doc -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Duplicate definition of&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Namespace -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="#local-6989586621684565854"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-153"></span><span>      </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Doc
forall v. IsName v =&gt; v -&gt; Doc
</span><a href="Language.Futhark.Pretty.html#pprName"><span class="hs-identifier hs-var">pprName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565853"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;.  Previously defined at&quot;</span></span><span>
</span><span id="line-154"></span><span>      </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Doc
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc -&gt; [Char]
forall a. Located a =&gt; a -&gt; [Char]
</span><a href="Language.Futhark.Core.html#locStr"><span class="hs-identifier hs-var">locStr</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565851"><span class="hs-identifier hs-var">loc2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkForDuplicateDecs"><span class="hs-identifier hs-type">checkForDuplicateDecs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Syntax.html#DecBase"><span class="hs-identifier hs-type">DecBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span id="checkForDuplicateDecs"><span class="annot"><span class="annottext">checkForDuplicateDecs :: [UncheckedDec] -&gt; TypeM ()
</span><a href="Language.Futhark.TypeChecker.html#checkForDuplicateDecs"><span class="hs-identifier hs-var hs-var">checkForDuplicateDecs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><span class="annottext">(Map (Namespace, Name) SrcLoc
 -&gt; UncheckedDec -&gt; TypeM (Map (Namespace, Name) SrcLoc))
-&gt; Map (Namespace, Name) SrcLoc -&gt; [UncheckedDec] -&gt; TypeM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">foldM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UncheckedDec
 -&gt; Map (Namespace, Name) SrcLoc
 -&gt; TypeM (Map (Namespace, Name) SrcLoc))
-&gt; Map (Namespace, Name) SrcLoc
-&gt; UncheckedDec
-&gt; TypeM (Map (Namespace, Name) SrcLoc)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">UncheckedDec
-&gt; Map (Namespace, Name) SrcLoc
-&gt; TypeM (Map (Namespace, Name) SrcLoc)
forall {m :: * -&gt; *} {f :: * -&gt; *}.
MonadTypeChecker m =&gt;
DecBase f Name
-&gt; Map (Namespace, Name) SrcLoc -&gt; m (Map (Namespace, Name) SrcLoc)
</span><a href="#local-6989586621684565842"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (Namespace, Name) SrcLoc
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621684565832"><span class="annot"><span class="annottext">check :: Namespace
-&gt; Name
-&gt; SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
-&gt; m (Map (Namespace, Name) SrcLoc)
</span><a href="#local-6989586621684565832"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span id="local-6989586621684565831"><span class="annot"><span class="annottext">Namespace
</span><a href="#local-6989586621684565831"><span class="hs-identifier hs-var">namespace</span></a></span></span><span> </span><span id="local-6989586621684565830"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565830"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621684565829"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565829"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621684565828"><span class="annot"><span class="annottext">Map (Namespace, Name) SrcLoc
</span><a href="#local-6989586621684565828"><span class="hs-identifier hs-var">known</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-161"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Namespace, Name) -&gt; Map (Namespace, Name) SrcLoc -&gt; Maybe SrcLoc
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="#local-6989586621684565831"><span class="hs-identifier hs-var">namespace</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565830"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (Namespace, Name) SrcLoc
</span><a href="#local-6989586621684565828"><span class="hs-identifier hs-var">known</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-162"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684565826"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565826"><span class="hs-identifier hs-var">loc'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-163"></span><span>          </span><span class="annot"><span class="annottext">Namespace
-&gt; Name -&gt; SrcLoc -&gt; SrcLoc -&gt; m (Map (Namespace, Name) SrcLoc)
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
Namespace -&gt; Name -&gt; SrcLoc -&gt; SrcLoc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.html#dupDefinitionError"><span class="hs-identifier hs-var">dupDefinitionError</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="#local-6989586621684565831"><span class="hs-identifier hs-var">namespace</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565830"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565829"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565826"><span class="hs-identifier hs-var">loc'</span></a></span><span>
</span><span id="line-164"></span><span>        </span><span class="annot"><span class="annottext">Maybe SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map (Namespace, Name) SrcLoc -&gt; m (Map (Namespace, Name) SrcLoc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Map (Namespace, Name) SrcLoc -&gt; m (Map (Namespace, Name) SrcLoc))
-&gt; Map (Namespace, Name) SrcLoc -&gt; m (Map (Namespace, Name) SrcLoc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Namespace, Name)
-&gt; SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="#local-6989586621684565831"><span class="hs-identifier hs-var">namespace</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565830"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565829"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Namespace, Name) SrcLoc
</span><a href="#local-6989586621684565828"><span class="hs-identifier hs-var">known</span></a></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span>    </span><span id="local-6989586621684565842"><span class="annot"><span class="annottext">f :: DecBase f Name
-&gt; Map (Namespace, Name) SrcLoc -&gt; m (Map (Namespace, Name) SrcLoc)
</span><a href="#local-6989586621684565842"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ValDec"><span class="hs-identifier hs-type">ValDec</span></a></span><span> </span><span id="local-6989586621684565813"><span class="annot"><span class="annottext">ValBindBase f Name
</span><a href="#local-6989586621684565813"><span class="hs-identifier hs-var">vb</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-167"></span><span>      </span><span class="annot"><span class="annottext">Namespace
-&gt; Name
-&gt; SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
-&gt; m (Map (Namespace, Name) SrcLoc)
forall {m :: * -&gt; *}.
MonadTypeChecker m =&gt;
Namespace
-&gt; Name
-&gt; SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
-&gt; m (Map (Namespace, Name) SrcLoc)
</span><a href="#local-6989586621684565832"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValBindBase f Name -&gt; Name
forall (f :: * -&gt; *) vn. ValBindBase f vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#valBindName"><span class="hs-identifier hs-var hs-var">valBindName</span></a></span><span> </span><span class="annot"><span class="annottext">ValBindBase f Name
</span><a href="#local-6989586621684565813"><span class="hs-identifier hs-var">vb</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValBindBase f Name -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">ValBindBase f Name
</span><a href="#local-6989586621684565813"><span class="hs-identifier hs-var">vb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><a href="#local-6989586621684565842"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeDec"><span class="hs-identifier hs-type">TypeDec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span> </span><span id="local-6989586621684565808"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565808"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TypeExp Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">f StructRetType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684565807"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565807"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-169"></span><span>      </span><span class="annot"><span class="annottext">Namespace
-&gt; Name
-&gt; SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
-&gt; m (Map (Namespace, Name) SrcLoc)
forall {m :: * -&gt; *}.
MonadTypeChecker m =&gt;
Namespace
-&gt; Name
-&gt; SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
-&gt; m (Map (Namespace, Name) SrcLoc)
</span><a href="#local-6989586621684565832"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565808"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565807"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span class="annot"><a href="#local-6989586621684565842"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#SigDec"><span class="hs-identifier hs-type">SigDec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#SigBind"><span class="hs-identifier hs-type">SigBind</span></a></span><span> </span><span id="local-6989586621684565803"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565803"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">SigExpBase f Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684565802"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565802"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-171"></span><span>      </span><span class="annot"><span class="annottext">Namespace
-&gt; Name
-&gt; SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
-&gt; m (Map (Namespace, Name) SrcLoc)
forall {m :: * -&gt; *}.
MonadTypeChecker m =&gt;
Namespace
-&gt; Name
-&gt; SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
-&gt; m (Map (Namespace, Name) SrcLoc)
</span><a href="#local-6989586621684565832"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Signature"><span class="hs-identifier hs-var">Signature</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565803"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565802"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="annot"><a href="#local-6989586621684565842"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModDec"><span class="hs-identifier hs-type">ModDec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModBind"><span class="hs-identifier hs-type">ModBind</span></a></span><span> </span><span id="local-6989586621684565798"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565798"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">[ModParamBase f Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (SigExpBase f Name, f (Map VName VName))
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ModExpBase f Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684565797"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565797"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-173"></span><span>      </span><span class="annot"><span class="annottext">Namespace
-&gt; Name
-&gt; SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
-&gt; m (Map (Namespace, Name) SrcLoc)
forall {m :: * -&gt; *}.
MonadTypeChecker m =&gt;
Namespace
-&gt; Name
-&gt; SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
-&gt; m (Map (Namespace, Name) SrcLoc)
</span><a href="#local-6989586621684565832"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565798"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565797"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><a href="#local-6989586621684565842"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#OpenDec"><span class="hs-identifier hs-type">OpenDec</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Namespace, Name) SrcLoc -&gt; m (Map (Namespace, Name) SrcLoc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><a href="#local-6989586621684565842"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#LocalDec"><span class="hs-identifier hs-type">LocalDec</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Namespace, Name) SrcLoc -&gt; m (Map (Namespace, Name) SrcLoc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-176"></span><span>    </span><span class="annot"><a href="#local-6989586621684565842"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#ImportDec"><span class="hs-identifier hs-type">ImportDec</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Namespace, Name) SrcLoc -&gt; m (Map (Namespace, Name) SrcLoc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span id="local-6989586621684566515"><span class="annot"><a href="Language.Futhark.TypeChecker.html#bindingTypeParams"><span class="hs-identifier hs-type">bindingTypeParams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#TypeParam"><span class="hs-identifier hs-type">TypeParam</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684566515"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684566515"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-179"></span><span id="bindingTypeParams"><span class="annot"><span class="annottext">bindingTypeParams :: forall a. [TypeParamBase VName] -&gt; TypeM a -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.html#bindingTypeParams"><span class="hs-identifier hs-var hs-var">bindingTypeParams</span></a></span></span><span> </span><span id="local-6989586621684565792"><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565792"><span class="hs-identifier hs-var">tparams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env -&gt; TypeM a -&gt; TypeM a
forall a. Env -&gt; TypeM a -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.Monad.html#localEnv"><span class="hs-identifier hs-var">localEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565790"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621684565790"><span class="annot"><span class="annottext">env :: Env
</span><a href="#local-6989586621684565790"><span class="hs-identifier hs-var hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Env] -&gt; Env
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Env] -&gt; Env) -&gt; [Env] -&gt; Env
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TypeParamBase VName -&gt; Env) -&gt; [TypeParamBase VName] -&gt; [Env]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TypeParamBase VName -&gt; Env
</span><a href="#local-6989586621684565788"><span class="hs-identifier hs-var">typeParamEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565792"><span class="hs-identifier hs-var">tparams</span></a></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621684565788"><span class="annot"><span class="annottext">typeParamEnv :: TypeParamBase VName -&gt; Env
</span><a href="#local-6989586621684565788"><span class="hs-identifier hs-var hs-var">typeParamEnv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeParamDim"><span class="hs-identifier hs-type">TypeParamDim</span></a></span><span> </span><span id="local-6989586621684565784"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565784"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-184"></span><span>      </span><span class="annot"><span class="annottext">Env
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-185"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">envVtable :: Map VName BoundV
</span><a href="Language.Futhark.Semantic.html#envVtable"><span class="hs-identifier hs-var">envVtable</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-186"></span><span>            </span><span class="annot"><span class="annottext">VName -&gt; BoundV -&gt; Map VName BoundV
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565784"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundV -&gt; Map VName BoundV) -&gt; BoundV -&gt; Map VName BoundV
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName] -&gt; StructType -&gt; BoundV
</span><a href="Language.Futhark.Semantic.html#BoundV"><span class="hs-identifier hs-var">BoundV</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; StructType
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) () -&gt; StructType)
-&gt; ScalarTypeBase (DimDecl VName) () -&gt; StructType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimType -&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as. PrimType -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-var">Prim</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimType -&gt; ScalarTypeBase (DimDecl VName) ())
-&gt; PrimType -&gt; ScalarTypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IntType -&gt; PrimType
</span><a href="Language.Futhark.Syntax.html#Signed"><span class="hs-identifier hs-var">Signed</span></a></span><span> </span><span class="annot"><span class="annottext">IntType
</span><a href="Futhark.IR.Primitive.html#Int64"><span class="hs-identifier hs-var">Int64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><a href="#local-6989586621684565788"><span class="hs-identifier hs-var">typeParamEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeParamType"><span class="hs-identifier hs-type">TypeParamType</span></a></span><span> </span><span id="local-6989586621684565776"><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684565776"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621684565775"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565775"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-189"></span><span>      </span><span class="annot"><span class="annottext">Env
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-190"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">envTypeTable :: Map VName TypeBinding
</span><a href="Language.Futhark.Semantic.html#envTypeTable"><span class="hs-identifier hs-var">envTypeTable</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-191"></span><span>            </span><span class="annot"><span class="annottext">VName -&gt; TypeBinding -&gt; Map VName TypeBinding
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565775"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBinding -&gt; Map VName TypeBinding)
-&gt; TypeBinding -&gt; Map VName TypeBinding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-192"></span><span>              </span><span class="annot"><span class="annottext">Liftedness -&gt; [TypeParamBase VName] -&gt; StructRetType -&gt; TypeBinding
</span><a href="Language.Futhark.Semantic.html#TypeAbbr"><span class="hs-identifier hs-var">TypeAbbr</span></a></span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684565776"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(StructRetType -&gt; TypeBinding)
-&gt; (ScalarTypeBase (DimDecl VName) () -&gt; StructRetType)
-&gt; ScalarTypeBase (DimDecl VName) ()
-&gt; TypeBinding
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; StructType -&gt; StructRetType
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(StructType -&gt; StructRetType)
-&gt; (ScalarTypeBase (DimDecl VName) () -&gt; StructType)
-&gt; ScalarTypeBase (DimDecl VName) ()
-&gt; StructRetType
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; StructType
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) () -&gt; TypeBinding)
-&gt; ScalarTypeBase (DimDecl VName) () -&gt; TypeBinding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-193"></span><span>                </span><span class="annot"><span class="annottext">()
-&gt; Uniqueness
-&gt; TypeName
-&gt; [TypeArg (DimDecl VName)]
-&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as.
as
-&gt; Uniqueness -&gt; TypeName -&gt; [TypeArg dim] -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Nonunique"><span class="hs-identifier hs-var">Nonunique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; TypeName
</span><a href="Language.Futhark.Prop.html#typeName"><span class="hs-identifier hs-var">typeName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565775"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-194"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkTypeDecl"><span class="hs-identifier hs-type">checkTypeDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeDeclBase"><span class="hs-identifier hs-type">TypeDeclBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-198"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeDeclBase"><span class="hs-identifier hs-type">TypeDeclBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Liftedness"><span class="hs-identifier hs-type">Liftedness</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span id="checkTypeDecl"><span class="annot"><span class="annottext">checkTypeDecl :: TypeDeclBase NoInfo Name
-&gt; TypeM ([VName], TypeDeclBase Info VName, Liftedness)
</span><a href="Language.Futhark.TypeChecker.html#checkTypeDecl"><span class="hs-identifier hs-var hs-var">checkTypeDecl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeDecl"><span class="hs-identifier hs-type">TypeDecl</span></a></span><span> </span><span id="local-6989586621684565768"><span class="annot"><span class="annottext">TypeExp Name
</span><a href="#local-6989586621684565768"><span class="hs-identifier hs-var">te</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo StructType
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-200"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565766"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565766"><span class="hs-identifier hs-var">te'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565765"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684565765"><span class="hs-identifier hs-var">svars</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-type">RetType</span></a></span><span> </span><span id="local-6989586621684565764"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684565764"><span class="hs-identifier hs-var">dims</span></a></span></span><span> </span><span id="local-6989586621684565763"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565763"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565762"><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684565762"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeExp Name
-&gt; TypeM (TypeExp VName, [VName], StructRetType, Liftedness)
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
TypeExp Name
-&gt; m (TypeExp VName, [VName], StructRetType, Liftedness)
</span><a href="Language.Futhark.TypeChecker.Types.html#checkTypeExp"><span class="hs-identifier hs-var">checkTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp Name
</span><a href="#local-6989586621684565768"><span class="hs-identifier hs-var">te</span></a></span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><span class="annottext">([VName], TypeDeclBase Info VName, Liftedness)
-&gt; TypeM ([VName], TypeDeclBase Info VName, Liftedness)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684565765"><span class="hs-identifier hs-var">svars</span></a></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; [VName] -&gt; [VName]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684565764"><span class="hs-identifier hs-var">dims</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeExp VName -&gt; Info StructType -&gt; TypeDeclBase Info VName
forall (f :: * -&gt; *) vn.
TypeExp vn -&gt; f StructType -&gt; TypeDeclBase f vn
</span><a href="Language.Futhark.Syntax.html#TypeDecl"><span class="hs-identifier hs-var">TypeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565766"><span class="hs-identifier hs-var">te'</span></a></span><span> </span><span class="annot"><span class="annottext">(Info StructType -&gt; TypeDeclBase Info VName)
-&gt; Info StructType -&gt; TypeDeclBase Info VName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StructType -&gt; Info StructType
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565763"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684565762"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="hs-comment">-- In this function, after the recursion, we add the Env of the</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- current Spec *after* the one that is returned from the recursive</span><span>
</span><span id="line-205"></span><span class="hs-comment">-- call.  This implements the behaviour that specs later in a module</span><span>
</span><span id="line-206"></span><span class="hs-comment">-- type can override those earlier (it rarely matters, but it affects</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- the specific structure of substitutions in case some module type is</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- redundantly imported multiple times).</span><span>
</span><span id="line-209"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkSpecs"><span class="hs-identifier hs-type">checkSpecs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Syntax.html#SpecBase"><span class="hs-identifier hs-type">SpecBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Semantic.html#TySet"><span class="hs-identifier hs-type">TySet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Syntax.html#SpecBase"><span class="hs-identifier hs-type">SpecBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span id="checkSpecs"><span class="annot"><span class="annottext">checkSpecs :: [SpecBase NoInfo Name] -&gt; TypeM (TySet, Env, [SpecBase Info VName])
</span><a href="Language.Futhark.TypeChecker.html#checkSpecs"><span class="hs-identifier hs-var hs-var">checkSpecs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySet
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Env
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkSpecs"><span class="hs-identifier hs-var">checkSpecs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ValSpec"><span class="hs-identifier hs-type">ValSpec</span></a></span><span> </span><span id="local-6989586621684565757"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565757"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621684565756"><span class="annot"><span class="annottext">[TypeParamBase Name]
</span><a href="#local-6989586621684565756"><span class="hs-identifier hs-var">tparams</span></a></span></span><span> </span><span id="local-6989586621684565755"><span class="annot"><span class="annottext">TypeDeclBase NoInfo Name
</span><a href="#local-6989586621684565755"><span class="hs-identifier hs-var">vtype</span></a></span></span><span> </span><span id="local-6989586621684565754"><span class="annot"><span class="annottext">Maybe DocComment
</span><a href="#local-6989586621684565754"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span id="local-6989586621684565753"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565753"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684565752"><span class="annot"><span class="annottext">[SpecBase NoInfo Name]
</span><a href="#local-6989586621684565752"><span class="hs-identifier hs-var">specs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-212"></span><span>  </span><span class="annot"><span class="annottext">[(Namespace, Name)]
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
[(Namespace, Name)] -&gt; m a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#bindSpaced"><span class="hs-identifier hs-var">bindSpaced</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565757"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TypeM (TySet, Env, [SpecBase Info VName])
 -&gt; TypeM (TySet, Env, [SpecBase Info VName]))
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621684565750"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565750"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Namespace -&gt; Name -&gt; SrcLoc -&gt; TypeM VName
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
Namespace -&gt; Name -&gt; SrcLoc -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Monad.html#checkName"><span class="hs-identifier hs-var">checkName</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565757"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565753"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684565748"><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565748"><span class="hs-identifier hs-var">tparams'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565747"><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684565747"><span class="hs-identifier hs-var">vtype'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-215"></span><span>      </span><span class="annot"><span class="annottext">[TypeParamBase Name]
-&gt; ([TypeParamBase VName]
    -&gt; TypeM ([TypeParamBase VName], TypeDeclBase Info VName))
-&gt; TypeM ([TypeParamBase VName], TypeDeclBase Info VName)
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
[TypeParamBase Name] -&gt; ([TypeParamBase VName] -&gt; m a) -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Types.html#checkTypeParams"><span class="hs-identifier hs-var">checkTypeParams</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase Name]
</span><a href="#local-6989586621684565756"><span class="hs-identifier hs-var">tparams</span></a></span><span> </span><span class="annot"><span class="annottext">(([TypeParamBase VName]
  -&gt; TypeM ([TypeParamBase VName], TypeDeclBase Info VName))
 -&gt; TypeM ([TypeParamBase VName], TypeDeclBase Info VName))
-&gt; ([TypeParamBase VName]
    -&gt; TypeM ([TypeParamBase VName], TypeDeclBase Info VName))
-&gt; TypeM ([TypeParamBase VName], TypeDeclBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684565745"><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565745"><span class="hs-identifier hs-var">tparams'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
-&gt; TypeM ([TypeParamBase VName], TypeDeclBase Info VName)
-&gt; TypeM ([TypeParamBase VName], TypeDeclBase Info VName)
forall a. [TypeParamBase VName] -&gt; TypeM a -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.html#bindingTypeParams"><span class="hs-identifier hs-var">bindingTypeParams</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565745"><span class="hs-identifier hs-var">tparams'</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeM ([TypeParamBase VName], TypeDeclBase Info VName)
 -&gt; TypeM ([TypeParamBase VName], TypeDeclBase Info VName))
-&gt; TypeM ([TypeParamBase VName], TypeDeclBase Info VName)
-&gt; TypeM ([TypeParamBase VName], TypeDeclBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621684565744"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684565744"><span class="hs-identifier hs-var">ext</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565743"><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684565743"><span class="hs-identifier hs-var">vtype'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeDeclBase NoInfo Name
-&gt; TypeM ([VName], TypeDeclBase Info VName, Liftedness)
</span><a href="Language.Futhark.TypeChecker.html#checkTypeDecl"><span class="hs-identifier hs-var">checkTypeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase NoInfo Name
</span><a href="#local-6989586621684565755"><span class="hs-identifier hs-var">vtype</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; TypeM () -&gt; TypeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[VName] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684565744"><span class="hs-identifier hs-var">ext</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TypeM () -&gt; TypeM ()) -&gt; TypeM () -&gt; TypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-219"></span><span>          </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565753"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TypeM ()) -&gt; Doc -&gt; TypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-220"></span><span>            </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;All function parameters must have non-anonymous sizes.&quot;</span></span><span>
</span><span id="line-221"></span><span>              </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Hint: add size parameters to&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Doc
forall v. IsName v =&gt; v -&gt; Doc
</span><a href="Language.Futhark.Pretty.html#pprName"><span class="hs-identifier hs-var">pprName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565750"><span class="hs-identifier hs-var">name'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span>        </span><span class="annot"><span class="annottext">([TypeParamBase VName], TypeDeclBase Info VName)
-&gt; TypeM ([TypeParamBase VName], TypeDeclBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565745"><span class="hs-identifier hs-var">tparams'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684565743"><span class="hs-identifier hs-var">vtype'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684565738"><span class="annot"><span class="annottext">binding :: BoundV
</span><a href="#local-6989586621684565738"><span class="hs-identifier hs-var hs-var">binding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName] -&gt; StructType -&gt; BoundV
</span><a href="Language.Futhark.Semantic.html#BoundV"><span class="hs-identifier hs-var">BoundV</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565748"><span class="hs-identifier hs-var">tparams'</span></a></span><span> </span><span class="annot"><span class="annottext">(StructType -&gt; BoundV) -&gt; StructType -&gt; BoundV
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Info StructType -&gt; StructType
forall a. Info a -&gt; a
</span><a href="Language.Futhark.Syntax.html#unInfo"><span class="hs-identifier hs-var hs-var">unInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Info StructType -&gt; StructType) -&gt; Info StructType -&gt; StructType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName -&gt; Info StructType
forall (f :: * -&gt; *) vn. TypeDeclBase f vn -&gt; f StructType
</span><a href="Language.Futhark.Syntax.html#expandedType"><span class="hs-identifier hs-var hs-var">expandedType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684565747"><span class="hs-identifier hs-var">vtype'</span></a></span><span>
</span><span id="line-226"></span><span>        </span><span id="local-6989586621684565734"><span class="annot"><span class="annottext">valenv :: Env
</span><a href="#local-6989586621684565734"><span class="hs-identifier hs-var hs-var">valenv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-227"></span><span>          </span><span class="annot"><span class="annottext">Env
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-228"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">envVtable :: Map VName BoundV
</span><a href="Language.Futhark.Semantic.html#envVtable"><span class="hs-identifier hs-var">envVtable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; BoundV -&gt; Map VName BoundV
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565750"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">BoundV
</span><a href="#local-6989586621684565738"><span class="hs-identifier hs-var">binding</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-229"></span><span>              </span><span class="annot"><span class="annottext">envNameMap :: NameMap
</span><a href="Language.Futhark.Semantic.html#envNameMap"><span class="hs-identifier hs-var">envNameMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Namespace, Name) -&gt; QualName VName -&gt; NameMap
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565757"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QualName VName -&gt; NameMap) -&gt; QualName VName -&gt; NameMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565750"><span class="hs-identifier hs-var">name'</span></a></span><span>
</span><span id="line-230"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684565733"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565733"><span class="hs-identifier hs-var">abstypes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565732"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565732"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565731"><span class="annot"><span class="annottext">[SpecBase Info VName]
</span><a href="#local-6989586621684565731"><span class="hs-identifier hs-var">specs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Env
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall a. Env -&gt; TypeM a -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.Monad.html#localEnv"><span class="hs-identifier hs-var">localEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565734"><span class="hs-identifier hs-var">valenv</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeM (TySet, Env, [SpecBase Info VName])
 -&gt; TypeM (TySet, Env, [SpecBase Info VName]))
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SpecBase NoInfo Name] -&gt; TypeM (TySet, Env, [SpecBase Info VName])
</span><a href="Language.Futhark.TypeChecker.html#checkSpecs"><span class="hs-identifier hs-var">checkSpecs</span></a></span><span> </span><span class="annot"><span class="annottext">[SpecBase NoInfo Name]
</span><a href="#local-6989586621684565752"><span class="hs-identifier hs-var">specs</span></a></span><span>
</span><span id="line-232"></span><span>    </span><span class="annot"><span class="annottext">(TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-233"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565733"><span class="hs-identifier hs-var">abstypes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-234"></span><span>        </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565732"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Env -&gt; Env -&gt; Env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565734"><span class="hs-identifier hs-var">valenv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-235"></span><span>        </span><span class="annot"><span class="annottext">VName
-&gt; [TypeParamBase VName]
-&gt; TypeDeclBase Info VName
-&gt; Maybe DocComment
-&gt; SrcLoc
-&gt; SpecBase Info VName
forall (f :: * -&gt; *) vn.
vn
-&gt; [TypeParamBase vn]
-&gt; TypeDeclBase f vn
-&gt; Maybe DocComment
-&gt; SrcLoc
-&gt; SpecBase f vn
</span><a href="Language.Futhark.Syntax.html#ValSpec"><span class="hs-identifier hs-var">ValSpec</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565750"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565748"><span class="hs-identifier hs-var">tparams'</span></a></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684565747"><span class="hs-identifier hs-var">vtype'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><a href="#local-6989586621684565754"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565753"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SpecBase Info VName
-&gt; [SpecBase Info VName] -&gt; [SpecBase Info VName]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[SpecBase Info VName]
</span><a href="#local-6989586621684565731"><span class="hs-identifier hs-var">specs'</span></a></span><span>
</span><span id="line-236"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkSpecs"><span class="hs-identifier hs-var">checkSpecs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeAbbrSpec"><span class="hs-identifier hs-type">TypeAbbrSpec</span></a></span><span> </span><span id="local-6989586621684565729"><span class="annot"><span class="annottext">TypeBindBase NoInfo Name
</span><a href="#local-6989586621684565729"><span class="hs-identifier hs-var">tdec</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684565728"><span class="annot"><span class="annottext">[SpecBase NoInfo Name]
</span><a href="#local-6989586621684565728"><span class="hs-identifier hs-var">specs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><span class="annottext">[(Namespace, Name)]
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
[(Namespace, Name)] -&gt; m a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#bindSpaced"><span class="hs-identifier hs-var">bindSpaced</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBindBase NoInfo Name -&gt; Name
forall (f :: * -&gt; *) vn. TypeBindBase f vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#typeAlias"><span class="hs-identifier hs-var hs-var">typeAlias</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBindBase NoInfo Name
</span><a href="#local-6989586621684565729"><span class="hs-identifier hs-var">tdec</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TypeM (TySet, Env, [SpecBase Info VName])
 -&gt; TypeM (TySet, Env, [SpecBase Info VName]))
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-239"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684565726"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565726"><span class="hs-identifier hs-var">tenv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565725"><span class="annot"><span class="annottext">TypeBindBase Info VName
</span><a href="#local-6989586621684565725"><span class="hs-identifier hs-var">tdec'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBindBase NoInfo Name -&gt; TypeM (Env, TypeBindBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkTypeBind"><span class="hs-identifier hs-var">checkTypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBindBase NoInfo Name
</span><a href="#local-6989586621684565729"><span class="hs-identifier hs-var">tdec</span></a></span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684565723"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565723"><span class="hs-identifier hs-var">abstypes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565722"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565722"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565721"><span class="annot"><span class="annottext">[SpecBase Info VName]
</span><a href="#local-6989586621684565721"><span class="hs-identifier hs-var">specs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Env
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall a. Env -&gt; TypeM a -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.Monad.html#localEnv"><span class="hs-identifier hs-var">localEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565726"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeM (TySet, Env, [SpecBase Info VName])
 -&gt; TypeM (TySet, Env, [SpecBase Info VName]))
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SpecBase NoInfo Name] -&gt; TypeM (TySet, Env, [SpecBase Info VName])
</span><a href="Language.Futhark.TypeChecker.html#checkSpecs"><span class="hs-identifier hs-var">checkSpecs</span></a></span><span> </span><span class="annot"><span class="annottext">[SpecBase NoInfo Name]
</span><a href="#local-6989586621684565728"><span class="hs-identifier hs-var">specs</span></a></span><span>
</span><span id="line-241"></span><span>    </span><span class="annot"><span class="annottext">(TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-242"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565723"><span class="hs-identifier hs-var">abstypes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-243"></span><span>        </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565722"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Env -&gt; Env -&gt; Env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565726"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-244"></span><span>        </span><span class="annot"><span class="annottext">TypeBindBase Info VName -&gt; SpecBase Info VName
forall (f :: * -&gt; *) vn. TypeBindBase f vn -&gt; SpecBase f vn
</span><a href="Language.Futhark.Syntax.html#TypeAbbrSpec"><span class="hs-identifier hs-var">TypeAbbrSpec</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBindBase Info VName
</span><a href="#local-6989586621684565725"><span class="hs-identifier hs-var">tdec'</span></a></span><span> </span><span class="annot"><span class="annottext">SpecBase Info VName
-&gt; [SpecBase Info VName] -&gt; [SpecBase Info VName]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[SpecBase Info VName]
</span><a href="#local-6989586621684565721"><span class="hs-identifier hs-var">specs'</span></a></span><span>
</span><span id="line-245"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkSpecs"><span class="hs-identifier hs-var">checkSpecs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeSpec"><span class="hs-identifier hs-type">TypeSpec</span></a></span><span> </span><span id="local-6989586621684565719"><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684565719"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621684565718"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565718"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621684565717"><span class="annot"><span class="annottext">[TypeParamBase Name]
</span><a href="#local-6989586621684565717"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621684565716"><span class="annot"><span class="annottext">Maybe DocComment
</span><a href="#local-6989586621684565716"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span id="local-6989586621684565715"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565715"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684565714"><span class="annot"><span class="annottext">[SpecBase NoInfo Name]
</span><a href="#local-6989586621684565714"><span class="hs-identifier hs-var">specs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-247"></span><span>  </span><span class="annot"><span class="annottext">[TypeParamBase Name]
-&gt; ([TypeParamBase VName]
    -&gt; TypeM (TySet, Env, [SpecBase Info VName]))
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
[TypeParamBase Name] -&gt; ([TypeParamBase VName] -&gt; m a) -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Types.html#checkTypeParams"><span class="hs-identifier hs-var">checkTypeParams</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase Name]
</span><a href="#local-6989586621684565717"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">(([TypeParamBase VName]
  -&gt; TypeM (TySet, Env, [SpecBase Info VName]))
 -&gt; TypeM (TySet, Env, [SpecBase Info VName]))
-&gt; ([TypeParamBase VName]
    -&gt; TypeM (TySet, Env, [SpecBase Info VName]))
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684565713"><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565713"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><span class="annottext">[(Namespace, Name)]
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
[(Namespace, Name)] -&gt; m a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#bindSpaced"><span class="hs-identifier hs-var">bindSpaced</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565718"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TypeM (TySet, Env, [SpecBase Info VName])
 -&gt; TypeM (TySet, Env, [SpecBase Info VName]))
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-249"></span><span>      </span><span id="local-6989586621684565712"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565712"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Namespace -&gt; Name -&gt; SrcLoc -&gt; TypeM VName
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
Namespace -&gt; Name -&gt; SrcLoc -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Monad.html#checkName"><span class="hs-identifier hs-var">checkName</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565718"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565715"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-250"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684565710"><span class="annot"><span class="annottext">tenv :: Env
</span><a href="#local-6989586621684565710"><span class="hs-identifier hs-var hs-var">tenv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-251"></span><span>            </span><span class="annot"><span class="annottext">Env
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-252"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">envNameMap :: NameMap
</span><a href="Language.Futhark.Semantic.html#envNameMap"><span class="hs-identifier hs-var">envNameMap</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-253"></span><span>                  </span><span class="annot"><span class="annottext">(Namespace, Name) -&gt; QualName VName -&gt; NameMap
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565718"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QualName VName -&gt; NameMap) -&gt; QualName VName -&gt; NameMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565712"><span class="hs-identifier hs-var">name'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-254"></span><span>                </span><span class="annot"><span class="annottext">envTypeTable :: Map VName TypeBinding
</span><a href="Language.Futhark.Semantic.html#envTypeTable"><span class="hs-identifier hs-var">envTypeTable</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-255"></span><span>                  </span><span class="annot"><span class="annottext">VName -&gt; TypeBinding -&gt; Map VName TypeBinding
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565712"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBinding -&gt; Map VName TypeBinding)
-&gt; TypeBinding -&gt; Map VName TypeBinding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-256"></span><span>                    </span><span class="annot"><span class="annottext">Liftedness -&gt; [TypeParamBase VName] -&gt; StructRetType -&gt; TypeBinding
</span><a href="Language.Futhark.Semantic.html#TypeAbbr"><span class="hs-identifier hs-var">TypeAbbr</span></a></span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684565719"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565713"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">(StructRetType -&gt; TypeBinding)
-&gt; (ScalarTypeBase (DimDecl VName) () -&gt; StructRetType)
-&gt; ScalarTypeBase (DimDecl VName) ()
-&gt; TypeBinding
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; StructType -&gt; StructRetType
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(StructType -&gt; StructRetType)
-&gt; (ScalarTypeBase (DimDecl VName) () -&gt; StructType)
-&gt; ScalarTypeBase (DimDecl VName) ()
-&gt; StructRetType
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ScalarTypeBase (DimDecl VName) () -&gt; StructType
forall dim as. ScalarTypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">(ScalarTypeBase (DimDecl VName) () -&gt; TypeBinding)
-&gt; ScalarTypeBase (DimDecl VName) () -&gt; TypeBinding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-257"></span><span>                      </span><span class="annot"><span class="annottext">()
-&gt; Uniqueness
-&gt; TypeName
-&gt; [TypeArg (DimDecl VName)]
-&gt; ScalarTypeBase (DimDecl VName) ()
forall dim as.
as
-&gt; Uniqueness -&gt; TypeName -&gt; [TypeArg dim] -&gt; ScalarTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Uniqueness
</span><a href="Language.Futhark.Core.html#Nonunique"><span class="hs-identifier hs-var">Nonunique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; TypeName
</span><a href="Language.Futhark.Prop.html#typeName"><span class="hs-identifier hs-var">typeName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565712"><span class="hs-identifier hs-var">name'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TypeArg (DimDecl VName)] -&gt; ScalarTypeBase (DimDecl VName) ())
-&gt; [TypeArg (DimDecl VName)] -&gt; ScalarTypeBase (DimDecl VName) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-258"></span><span>                        </span><span class="annot"><span class="annottext">(TypeParamBase VName -&gt; TypeArg (DimDecl VName))
-&gt; [TypeParamBase VName] -&gt; [TypeArg (DimDecl VName)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TypeParamBase VName -&gt; TypeArg (DimDecl VName)
</span><a href="Language.Futhark.TypeChecker.Types.html#typeParamToArg"><span class="hs-identifier hs-var">typeParamToArg</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565713"><span class="hs-identifier hs-var">ps'</span></a></span><span>
</span><span id="line-259"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-260"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684565708"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565708"><span class="hs-identifier hs-var">abstypes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565707"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565707"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565706"><span class="annot"><span class="annottext">[SpecBase Info VName]
</span><a href="#local-6989586621684565706"><span class="hs-identifier hs-var">specs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Env
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall a. Env -&gt; TypeM a -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.Monad.html#localEnv"><span class="hs-identifier hs-var">localEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565710"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeM (TySet, Env, [SpecBase Info VName])
 -&gt; TypeM (TySet, Env, [SpecBase Info VName]))
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SpecBase NoInfo Name] -&gt; TypeM (TySet, Env, [SpecBase Info VName])
</span><a href="Language.Futhark.TypeChecker.html#checkSpecs"><span class="hs-identifier hs-var">checkSpecs</span></a></span><span> </span><span class="annot"><span class="annottext">[SpecBase NoInfo Name]
</span><a href="#local-6989586621684565714"><span class="hs-identifier hs-var">specs</span></a></span><span>
</span><span id="line-261"></span><span>      </span><span class="annot"><span class="annottext">(TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-262"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; Liftedness -&gt; TySet -&gt; TySet
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565712"><span class="hs-identifier hs-var">name'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684565719"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565708"><span class="hs-identifier hs-var">abstypes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-263"></span><span>          </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565707"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Env -&gt; Env -&gt; Env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565710"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-264"></span><span>          </span><span class="annot"><span class="annottext">Liftedness
-&gt; VName
-&gt; [TypeParamBase VName]
-&gt; Maybe DocComment
-&gt; SrcLoc
-&gt; SpecBase Info VName
forall (f :: * -&gt; *) vn.
Liftedness
-&gt; vn
-&gt; [TypeParamBase vn]
-&gt; Maybe DocComment
-&gt; SrcLoc
-&gt; SpecBase f vn
</span><a href="Language.Futhark.Syntax.html#TypeSpec"><span class="hs-identifier hs-var">TypeSpec</span></a></span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684565719"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565712"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565713"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><a href="#local-6989586621684565716"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565715"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SpecBase Info VName
-&gt; [SpecBase Info VName] -&gt; [SpecBase Info VName]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[SpecBase Info VName]
</span><a href="#local-6989586621684565706"><span class="hs-identifier hs-var">specs'</span></a></span><span>
</span><span id="line-265"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkSpecs"><span class="hs-identifier hs-var">checkSpecs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModSpec"><span class="hs-identifier hs-type">ModSpec</span></a></span><span> </span><span id="local-6989586621684565704"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565704"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621684565703"><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565703"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span id="local-6989586621684565702"><span class="annot"><span class="annottext">Maybe DocComment
</span><a href="#local-6989586621684565702"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span id="local-6989586621684565701"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565701"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684565700"><span class="annot"><span class="annottext">[SpecBase NoInfo Name]
</span><a href="#local-6989586621684565700"><span class="hs-identifier hs-var">specs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-267"></span><span>  </span><span class="annot"><span class="annottext">[(Namespace, Name)]
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
[(Namespace, Name)] -&gt; m a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#bindSpaced"><span class="hs-identifier hs-var">bindSpaced</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565704"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TypeM (TySet, Env, [SpecBase Info VName])
 -&gt; TypeM (TySet, Env, [SpecBase Info VName]))
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-268"></span><span>    </span><span id="local-6989586621684565699"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565699"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Namespace -&gt; Name -&gt; SrcLoc -&gt; TypeM VName
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
Namespace -&gt; Name -&gt; SrcLoc -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Monad.html#checkName"><span class="hs-identifier hs-var">checkName</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565704"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565701"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684565698"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565698"><span class="hs-identifier hs-var">_sig_abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565697"><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565697"><span class="hs-identifier hs-var">mty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565696"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565696"><span class="hs-identifier hs-var">sig'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name -&gt; TypeM (TySet, MTy, SigExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkSigExp"><span class="hs-identifier hs-var">checkSigExp</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565703"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684565693"><span class="annot"><span class="annottext">senv :: Env
</span><a href="#local-6989586621684565693"><span class="hs-identifier hs-var hs-var">senv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-271"></span><span>          </span><span class="annot"><span class="annottext">Env
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-272"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">envNameMap :: NameMap
</span><a href="Language.Futhark.Semantic.html#envNameMap"><span class="hs-identifier hs-var">envNameMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Namespace, Name) -&gt; QualName VName -&gt; NameMap
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565704"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QualName VName -&gt; NameMap) -&gt; QualName VName -&gt; NameMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565699"><span class="hs-identifier hs-var">name'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-273"></span><span>              </span><span class="annot"><span class="annottext">envModTable :: Map VName Mod
</span><a href="Language.Futhark.Semantic.html#envModTable"><span class="hs-identifier hs-var">envModTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Mod -&gt; Map VName Mod
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565699"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">(Mod -&gt; Map VName Mod) -&gt; Mod -&gt; Map VName Mod
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MTy -&gt; Mod
</span><a href="Language.Futhark.Semantic.html#mtyMod"><span class="hs-identifier hs-var hs-var">mtyMod</span></a></span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565697"><span class="hs-identifier hs-var">mty</span></a></span><span>
</span><span id="line-274"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684565691"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565691"><span class="hs-identifier hs-var">abstypes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565690"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565690"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565689"><span class="annot"><span class="annottext">[SpecBase Info VName]
</span><a href="#local-6989586621684565689"><span class="hs-identifier hs-var">specs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Env
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall a. Env -&gt; TypeM a -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.Monad.html#localEnv"><span class="hs-identifier hs-var">localEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565693"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeM (TySet, Env, [SpecBase Info VName])
 -&gt; TypeM (TySet, Env, [SpecBase Info VName]))
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SpecBase NoInfo Name] -&gt; TypeM (TySet, Env, [SpecBase Info VName])
</span><a href="Language.Futhark.TypeChecker.html#checkSpecs"><span class="hs-identifier hs-var">checkSpecs</span></a></span><span> </span><span class="annot"><span class="annottext">[SpecBase NoInfo Name]
</span><a href="#local-6989586621684565700"><span class="hs-identifier hs-var">specs</span></a></span><span>
</span><span id="line-276"></span><span>    </span><span class="annot"><span class="annottext">(TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-277"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(QualName VName -&gt; QualName VName) -&gt; TySet -&gt; TySet
forall k2 k1 a. Ord k2 =&gt; (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">M.mapKeys</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; QualName VName -&gt; QualName VName
forall v. v -&gt; QualName v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualify"><span class="hs-identifier hs-var">qualify</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565699"><span class="hs-identifier hs-var">name'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MTy -&gt; TySet
</span><a href="Language.Futhark.Semantic.html#mtyAbs"><span class="hs-identifier hs-var hs-var">mtyAbs</span></a></span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565697"><span class="hs-identifier hs-var">mty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TySet -&gt; TySet -&gt; TySet
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565691"><span class="hs-identifier hs-var">abstypes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565690"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Env -&gt; Env -&gt; Env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565693"><span class="hs-identifier hs-var">senv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-279"></span><span>        </span><span class="annot"><span class="annottext">VName
-&gt; SigExpBase Info VName
-&gt; Maybe DocComment
-&gt; SrcLoc
-&gt; SpecBase Info VName
forall (f :: * -&gt; *) vn.
vn
-&gt; SigExpBase f vn -&gt; Maybe DocComment -&gt; SrcLoc -&gt; SpecBase f vn
</span><a href="Language.Futhark.Syntax.html#ModSpec"><span class="hs-identifier hs-var">ModSpec</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565699"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565696"><span class="hs-identifier hs-var">sig'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><a href="#local-6989586621684565702"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565701"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SpecBase Info VName
-&gt; [SpecBase Info VName] -&gt; [SpecBase Info VName]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[SpecBase Info VName]
</span><a href="#local-6989586621684565689"><span class="hs-identifier hs-var">specs'</span></a></span><span>
</span><span id="line-280"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkSpecs"><span class="hs-identifier hs-var">checkSpecs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#IncludeSpec"><span class="hs-identifier hs-type">IncludeSpec</span></a></span><span> </span><span id="local-6989586621684565684"><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565684"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684565683"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565683"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684565682"><span class="annot"><span class="annottext">[SpecBase NoInfo Name]
</span><a href="#local-6989586621684565682"><span class="hs-identifier hs-var">specs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-282"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565681"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565681"><span class="hs-identifier hs-var">e_abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565680"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565680"><span class="hs-identifier hs-var">env_abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565679"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565679"><span class="hs-identifier hs-var">e_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565678"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565678"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name
-&gt; TypeM (TySet, TySet, Env, SigExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkSigExpToEnv"><span class="hs-identifier hs-var">checkSigExpToEnv</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565684"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span>  </span><span class="annot"><span class="annottext">(QualName VName -&gt; TypeM ()) -&gt; [QualName VName] -&gt; TypeM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName Name -&gt; TypeM ()
forall {e} {m :: * -&gt; *}.
(MonadError e m, MonadTypeChecker m) =&gt;
QualName Name -&gt; m ()
</span><a href="#local-6989586621684565675"><span class="hs-identifier hs-var">warnIfShadowing</span></a></span><span> </span><span class="annot"><span class="annottext">(QualName Name -&gt; TypeM ())
-&gt; (QualName VName -&gt; QualName Name) -&gt; QualName VName -&gt; TypeM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Name) -&gt; QualName VName -&gt; QualName Name
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Name
</span><a href="Language.Futhark.Core.html#baseName"><span class="hs-identifier hs-var">baseName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([QualName VName] -&gt; TypeM ()) -&gt; [QualName VName] -&gt; TypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TySet -&gt; [QualName VName]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">M.keys</span></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565680"><span class="hs-identifier hs-var">env_abs</span></a></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565672"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565672"><span class="hs-identifier hs-var">abstypes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565671"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565671"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565670"><span class="annot"><span class="annottext">[SpecBase Info VName]
</span><a href="#local-6989586621684565670"><span class="hs-identifier hs-var">specs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Env
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall a. Env -&gt; TypeM a -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.Monad.html#localEnv"><span class="hs-identifier hs-var">localEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565679"><span class="hs-identifier hs-var">e_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeM (TySet, Env, [SpecBase Info VName])
 -&gt; TypeM (TySet, Env, [SpecBase Info VName]))
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SpecBase NoInfo Name] -&gt; TypeM (TySet, Env, [SpecBase Info VName])
</span><a href="Language.Futhark.TypeChecker.html#checkSpecs"><span class="hs-identifier hs-var">checkSpecs</span></a></span><span> </span><span class="annot"><span class="annottext">[SpecBase NoInfo Name]
</span><a href="#local-6989586621684565682"><span class="hs-identifier hs-var">specs</span></a></span><span>
</span><span id="line-287"></span><span>  </span><span class="annot"><span class="annottext">(TySet, Env, [SpecBase Info VName])
-&gt; TypeM (TySet, Env, [SpecBase Info VName])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565681"><span class="hs-identifier hs-var">e_abs</span></a></span><span> </span><span class="annot"><span class="annottext">TySet -&gt; TySet -&gt; TySet
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565680"><span class="hs-identifier hs-var">env_abs</span></a></span><span> </span><span class="annot"><span class="annottext">TySet -&gt; TySet -&gt; TySet
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565672"><span class="hs-identifier hs-var">abstypes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-289"></span><span>      </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565671"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Env -&gt; Env -&gt; Env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565679"><span class="hs-identifier hs-var">e_env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-290"></span><span>      </span><span class="annot"><span class="annottext">SigExpBase Info VName -&gt; SrcLoc -&gt; SpecBase Info VName
forall (f :: * -&gt; *) vn. SigExpBase f vn -&gt; SrcLoc -&gt; SpecBase f vn
</span><a href="Language.Futhark.Syntax.html#IncludeSpec"><span class="hs-identifier hs-var">IncludeSpec</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565678"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565683"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SpecBase Info VName
-&gt; [SpecBase Info VName] -&gt; [SpecBase Info VName]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[SpecBase Info VName]
</span><a href="#local-6989586621684565670"><span class="hs-identifier hs-var">specs'</span></a></span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-293"></span><span>    </span><span id="local-6989586621684565675"><span class="annot"><span class="annottext">warnIfShadowing :: QualName Name -&gt; m ()
</span><a href="#local-6989586621684565675"><span class="hs-identifier hs-var hs-var">warnIfShadowing</span></a></span></span><span> </span><span id="local-6989586621684565657"><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684565657"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-294"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcLoc
-&gt; QualName Name
-&gt; m (QualName VName, [TypeParamBase VName], StructRetType,
      Liftedness)
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
SrcLoc
-&gt; QualName Name
-&gt; m (QualName VName, [TypeParamBase VName], StructRetType,
      Liftedness)
</span><a href="Language.Futhark.TypeChecker.Monad.html#lookupType"><span class="hs-identifier hs-var">lookupType</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565683"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684565657"><span class="hs-identifier hs-var">qn</span></a></span><span> </span><span class="annot"><span class="annottext">m (QualName VName, [TypeParamBase VName], StructRetType,
   Liftedness)
-&gt; m () -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">QualName Name -&gt; m ()
forall {m :: * -&gt; *} {a}.
(MonadTypeChecker m, Pretty a) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621684565655"><span class="hs-identifier hs-var">warnAbout</span></a></span><span> </span><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684565657"><span class="hs-identifier hs-var">qn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>        </span><span class="annot"><span class="annottext">m () -&gt; (e -&gt; m ()) -&gt; m ()
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catchError`</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">e
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>    </span><span id="local-6989586621684565655"><span class="annot"><span class="annottext">warnAbout :: a -&gt; m ()
</span><a href="#local-6989586621684565655"><span class="hs-identifier hs-var hs-var">warnAbout</span></a></span></span><span> </span><span id="local-6989586621684565646"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684565646"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-297"></span><span>      </span><span class="annot"><span class="annottext">SrcLoc -&gt; Doc -&gt; m ()
forall (m :: * -&gt; *) loc.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Doc -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Monad.html#warn"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565683"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; m ()) -&gt; Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Inclusion shadows type&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621684565646"><span class="hs-identifier hs-var">qn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkSigExp"><span class="hs-identifier hs-type">checkSigExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#SigExpBase"><span class="hs-identifier hs-type">SigExpBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Semantic.html#TySet"><span class="hs-identifier hs-type">TySet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#MTy"><span class="hs-identifier hs-type">MTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#SigExpBase"><span class="hs-identifier hs-type">SigExpBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span id="checkSigExp"><span class="annot"><span class="annottext">checkSigExp :: SigExpBase NoInfo Name -&gt; TypeM (TySet, MTy, SigExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkSigExp"><span class="hs-identifier hs-var hs-var">checkSigExp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#SigParens"><span class="hs-identifier hs-type">SigParens</span></a></span><span> </span><span id="local-6989586621684565643"><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565643"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684565642"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565642"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565641"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565641"><span class="hs-identifier hs-var">abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565640"><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565640"><span class="hs-identifier hs-var">mty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565639"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565639"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name -&gt; TypeM (TySet, MTy, SigExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkSigExp"><span class="hs-identifier hs-var">checkSigExp</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565643"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-302"></span><span>  </span><span class="annot"><span class="annottext">(TySet, MTy, SigExpBase Info VName)
-&gt; TypeM (TySet, MTy, SigExpBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565641"><span class="hs-identifier hs-var">abs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565640"><span class="hs-identifier hs-var">mty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName -&gt; SrcLoc -&gt; SigExpBase Info VName
forall (f :: * -&gt; *) vn.
SigExpBase f vn -&gt; SrcLoc -&gt; SigExpBase f vn
</span><a href="Language.Futhark.Syntax.html#SigParens"><span class="hs-identifier hs-var">SigParens</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565639"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565642"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkSigExp"><span class="hs-identifier hs-var">checkSigExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#SigVar"><span class="hs-identifier hs-type">SigVar</span></a></span><span> </span><span id="local-6989586621684565637"><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684565637"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (Map VName VName)
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684565636"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565636"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-304"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565635"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684565635"><span class="hs-identifier hs-var">name'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565634"><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565634"><span class="hs-identifier hs-var">mty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; QualName Name -&gt; TypeM (QualName VName, MTy)
</span><a href="Language.Futhark.TypeChecker.Monad.html#lookupMTy"><span class="hs-identifier hs-var">lookupMTy</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565636"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684565637"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565632"><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565632"><span class="hs-identifier hs-var">mty'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565631"><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684565631"><span class="hs-identifier hs-var">substs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MTy -&gt; TypeM (MTy, Map VName VName)
</span><a href="Language.Futhark.TypeChecker.Modules.html#newNamesForMTy"><span class="hs-identifier hs-var">newNamesForMTy</span></a></span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565634"><span class="hs-identifier hs-var">mty</span></a></span><span>
</span><span id="line-306"></span><span>  </span><span class="annot"><span class="annottext">(TySet, MTy, SigExpBase Info VName)
-&gt; TypeM (TySet, MTy, SigExpBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MTy -&gt; TySet
</span><a href="Language.Futhark.Semantic.html#mtyAbs"><span class="hs-identifier hs-var hs-var">mtyAbs</span></a></span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565632"><span class="hs-identifier hs-var">mty'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565632"><span class="hs-identifier hs-var">mty'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QualName VName
-&gt; Info (Map VName VName) -&gt; SrcLoc -&gt; SigExpBase Info VName
forall (f :: * -&gt; *) vn.
QualName vn -&gt; f (Map VName VName) -&gt; SrcLoc -&gt; SigExpBase f vn
</span><a href="Language.Futhark.Syntax.html#SigVar"><span class="hs-identifier hs-var">SigVar</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684565635"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map VName VName -&gt; Info (Map VName VName)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684565631"><span class="hs-identifier hs-var">substs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565636"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkSigExp"><span class="hs-identifier hs-var">checkSigExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#SigSpecs"><span class="hs-identifier hs-type">SigSpecs</span></a></span><span> </span><span id="local-6989586621684565628"><span class="annot"><span class="annottext">[SpecBase NoInfo Name]
</span><a href="#local-6989586621684565628"><span class="hs-identifier hs-var">specs</span></a></span></span><span> </span><span id="local-6989586621684565627"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565627"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-308"></span><span>  </span><span class="annot"><span class="annottext">[SpecBase NoInfo Name] -&gt; TypeM ()
</span><a href="Language.Futhark.TypeChecker.html#checkForDuplicateSpecs"><span class="hs-identifier hs-var">checkForDuplicateSpecs</span></a></span><span> </span><span class="annot"><span class="annottext">[SpecBase NoInfo Name]
</span><a href="#local-6989586621684565628"><span class="hs-identifier hs-var">specs</span></a></span><span>
</span><span id="line-309"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565625"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565625"><span class="hs-identifier hs-var">abstypes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565624"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565624"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565623"><span class="annot"><span class="annottext">[SpecBase Info VName]
</span><a href="#local-6989586621684565623"><span class="hs-identifier hs-var">specs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SpecBase NoInfo Name] -&gt; TypeM (TySet, Env, [SpecBase Info VName])
</span><a href="Language.Futhark.TypeChecker.html#checkSpecs"><span class="hs-identifier hs-var">checkSpecs</span></a></span><span> </span><span class="annot"><span class="annottext">[SpecBase NoInfo Name]
</span><a href="#local-6989586621684565628"><span class="hs-identifier hs-var">specs</span></a></span><span>
</span><span id="line-310"></span><span>  </span><span class="annot"><span class="annottext">(TySet, MTy, SigExpBase Info VName)
-&gt; TypeM (TySet, MTy, SigExpBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565625"><span class="hs-identifier hs-var">abstypes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySet -&gt; Mod -&gt; MTy
</span><a href="Language.Futhark.Semantic.html#MTy"><span class="hs-identifier hs-var">MTy</span></a></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565625"><span class="hs-identifier hs-var">abstypes</span></a></span><span> </span><span class="annot"><span class="annottext">(Mod -&gt; MTy) -&gt; Mod -&gt; MTy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; Mod
</span><a href="Language.Futhark.Semantic.html#ModEnv"><span class="hs-identifier hs-var">ModEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565624"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SpecBase Info VName] -&gt; SrcLoc -&gt; SigExpBase Info VName
forall (f :: * -&gt; *) vn.
[SpecBase f vn] -&gt; SrcLoc -&gt; SigExpBase f vn
</span><a href="Language.Futhark.Syntax.html#SigSpecs"><span class="hs-identifier hs-var">SigSpecs</span></a></span><span> </span><span class="annot"><span class="annottext">[SpecBase Info VName]
</span><a href="#local-6989586621684565623"><span class="hs-identifier hs-var">specs'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565627"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkSigExp"><span class="hs-identifier hs-var">checkSigExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#SigWith"><span class="hs-identifier hs-type">SigWith</span></a></span><span> </span><span id="local-6989586621684565620"><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565620"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeRef"><span class="hs-identifier hs-type">TypeRef</span></a></span><span> </span><span id="local-6989586621684565618"><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684565618"><span class="hs-identifier hs-var">tname</span></a></span></span><span> </span><span id="local-6989586621684565617"><span class="annot"><span class="annottext">[TypeParamBase Name]
</span><a href="#local-6989586621684565617"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621684565616"><span class="annot"><span class="annottext">TypeDeclBase NoInfo Name
</span><a href="#local-6989586621684565616"><span class="hs-identifier hs-var">td</span></a></span></span><span> </span><span id="local-6989586621684565615"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565615"><span class="hs-identifier hs-var">trloc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684565614"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565614"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565613"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565613"><span class="hs-identifier hs-var">abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565612"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565612"><span class="hs-identifier hs-var">s_abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565611"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565611"><span class="hs-identifier hs-var">s_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565610"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565610"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name
-&gt; TypeM (TySet, TySet, Env, SigExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkSigExpToEnv"><span class="hs-identifier hs-var">checkSigExpToEnv</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565620"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-313"></span><span>  </span><span class="annot"><span class="annottext">[TypeParamBase Name]
-&gt; ([TypeParamBase VName]
    -&gt; TypeM (TySet, MTy, SigExpBase Info VName))
-&gt; TypeM (TySet, MTy, SigExpBase Info VName)
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
[TypeParamBase Name] -&gt; ([TypeParamBase VName] -&gt; m a) -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Types.html#checkTypeParams"><span class="hs-identifier hs-var">checkTypeParams</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase Name]
</span><a href="#local-6989586621684565617"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">(([TypeParamBase VName]
  -&gt; TypeM (TySet, MTy, SigExpBase Info VName))
 -&gt; TypeM (TySet, MTy, SigExpBase Info VName))
-&gt; ([TypeParamBase VName]
    -&gt; TypeM (TySet, MTy, SigExpBase Info VName))
-&gt; TypeM (TySet, MTy, SigExpBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684565609"><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565609"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684565608"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684565608"><span class="hs-identifier hs-var">ext</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565607"><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684565607"><span class="hs-identifier hs-var">td'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
-&gt; TypeM ([VName], TypeDeclBase Info VName, Liftedness)
-&gt; TypeM ([VName], TypeDeclBase Info VName, Liftedness)
forall a. [TypeParamBase VName] -&gt; TypeM a -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.html#bindingTypeParams"><span class="hs-identifier hs-var">bindingTypeParams</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565609"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeM ([VName], TypeDeclBase Info VName, Liftedness)
 -&gt; TypeM ([VName], TypeDeclBase Info VName, Liftedness))
-&gt; TypeM ([VName], TypeDeclBase Info VName, Liftedness)
-&gt; TypeM ([VName], TypeDeclBase Info VName, Liftedness)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase NoInfo Name
-&gt; TypeM ([VName], TypeDeclBase Info VName, Liftedness)
</span><a href="Language.Futhark.TypeChecker.html#checkTypeDecl"><span class="hs-identifier hs-var">checkTypeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase NoInfo Name
</span><a href="#local-6989586621684565616"><span class="hs-identifier hs-var">td</span></a></span><span>
</span><span id="line-315"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; TypeM () -&gt; TypeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[VName] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684565608"><span class="hs-identifier hs-var">ext</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TypeM () -&gt; TypeM ()) -&gt; TypeM () -&gt; TypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-316"></span><span>      </span><span class="annot"><span class="annottext">TypeDeclBase Info VName -&gt; Notes -&gt; Doc -&gt; TypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684565607"><span class="hs-identifier hs-var">td'</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Anonymous dimensions are not allowed here.&quot;</span></span><span>
</span><span id="line-317"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684565606"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684565606"><span class="hs-identifier hs-var">tname'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565605"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565605"><span class="hs-identifier hs-var">s_abs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565604"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565604"><span class="hs-identifier hs-var">s_env'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; TySet
-&gt; Env
-&gt; QualName Name
-&gt; [TypeParamBase VName]
-&gt; StructType
-&gt; TypeM (QualName VName, TySet, Env)
</span><a href="Language.Futhark.TypeChecker.Modules.html#refineEnv"><span class="hs-identifier hs-var">refineEnv</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565614"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565612"><span class="hs-identifier hs-var">s_abs</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565611"><span class="hs-identifier hs-var">s_env</span></a></span><span> </span><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684565618"><span class="hs-identifier hs-var">tname</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565609"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">(StructType -&gt; TypeM (QualName VName, TySet, Env))
-&gt; StructType -&gt; TypeM (QualName VName, TySet, Env)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Info StructType -&gt; StructType
forall a. Info a -&gt; a
</span><a href="Language.Futhark.Syntax.html#unInfo"><span class="hs-identifier hs-var hs-var">unInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Info StructType -&gt; StructType) -&gt; Info StructType -&gt; StructType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName -&gt; Info StructType
forall (f :: * -&gt; *) vn. TypeDeclBase f vn -&gt; f StructType
</span><a href="Language.Futhark.Syntax.html#expandedType"><span class="hs-identifier hs-var hs-var">expandedType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684565607"><span class="hs-identifier hs-var">td'</span></a></span><span>
</span><span id="line-318"></span><span>    </span><span class="annot"><span class="annottext">(TySet, MTy, SigExpBase Info VName)
-&gt; TypeM (TySet, MTy, SigExpBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565613"><span class="hs-identifier hs-var">abs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySet -&gt; Mod -&gt; MTy
</span><a href="Language.Futhark.Semantic.html#MTy"><span class="hs-identifier hs-var">MTy</span></a></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565605"><span class="hs-identifier hs-var">s_abs'</span></a></span><span> </span><span class="annot"><span class="annottext">(Mod -&gt; MTy) -&gt; Mod -&gt; MTy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; Mod
</span><a href="Language.Futhark.Semantic.html#ModEnv"><span class="hs-identifier hs-var">ModEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565604"><span class="hs-identifier hs-var">s_env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
-&gt; TypeRefBase Info VName -&gt; SrcLoc -&gt; SigExpBase Info VName
forall (f :: * -&gt; *) vn.
SigExpBase f vn -&gt; TypeRefBase f vn -&gt; SrcLoc -&gt; SigExpBase f vn
</span><a href="Language.Futhark.Syntax.html#SigWith"><span class="hs-identifier hs-var">SigWith</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565610"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName VName
-&gt; [TypeParamBase VName]
-&gt; TypeDeclBase Info VName
-&gt; SrcLoc
-&gt; TypeRefBase Info VName
forall (f :: * -&gt; *) vn.
QualName vn
-&gt; [TypeParamBase vn]
-&gt; TypeDeclBase f vn
-&gt; SrcLoc
-&gt; TypeRefBase f vn
</span><a href="Language.Futhark.Syntax.html#TypeRef"><span class="hs-identifier hs-var">TypeRef</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684565606"><span class="hs-identifier hs-var">tname'</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565609"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684565607"><span class="hs-identifier hs-var">td'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565615"><span class="hs-identifier hs-var">trloc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565614"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkSigExp"><span class="hs-identifier hs-var">checkSigExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#SigArrow"><span class="hs-identifier hs-type">SigArrow</span></a></span><span> </span><span id="local-6989586621684565601"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621684565601"><span class="hs-identifier hs-var">maybe_pname</span></a></span></span><span> </span><span id="local-6989586621684565600"><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565600"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621684565599"><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565599"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621684565598"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565598"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565597"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565597"><span class="hs-identifier hs-var">e1_abs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#MTy"><span class="hs-identifier hs-type">MTy</span></a></span><span> </span><span id="local-6989586621684565596"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565596"><span class="hs-identifier hs-var">s_abs</span></a></span></span><span> </span><span id="local-6989586621684565595"><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684565595"><span class="hs-identifier hs-var">e1_mod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565594"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565594"><span class="hs-identifier hs-var">e1'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name -&gt; TypeM (TySet, MTy, SigExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkSigExp"><span class="hs-identifier hs-var">checkSigExp</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565600"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-321"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565593"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565593"><span class="hs-identifier hs-var">env_for_e2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565592"><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684565592"><span class="hs-identifier hs-var">maybe_pname'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621684565601"><span class="hs-identifier hs-var">maybe_pname</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-323"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684565591"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565591"><span class="hs-identifier hs-var">pname</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Namespace, Name)]
-&gt; TypeM (Env, Maybe VName) -&gt; TypeM (Env, Maybe VName)
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
[(Namespace, Name)] -&gt; m a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#bindSpaced"><span class="hs-identifier hs-var">bindSpaced</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565591"><span class="hs-identifier hs-var">pname</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TypeM (Env, Maybe VName) -&gt; TypeM (Env, Maybe VName))
-&gt; TypeM (Env, Maybe VName) -&gt; TypeM (Env, Maybe VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-324"></span><span>        </span><span id="local-6989586621684565590"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565590"><span class="hs-identifier hs-var">pname'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Namespace -&gt; Name -&gt; SrcLoc -&gt; TypeM VName
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
Namespace -&gt; Name -&gt; SrcLoc -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Monad.html#checkName"><span class="hs-identifier hs-var">checkName</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565591"><span class="hs-identifier hs-var">pname</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565598"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-325"></span><span>        </span><span class="annot"><span class="annottext">(Env, Maybe VName) -&gt; TypeM (Env, Maybe VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-326"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Env
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-327"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">envNameMap :: NameMap
</span><a href="Language.Futhark.Semantic.html#envNameMap"><span class="hs-identifier hs-var">envNameMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Namespace, Name) -&gt; QualName VName -&gt; NameMap
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565591"><span class="hs-identifier hs-var">pname</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QualName VName -&gt; NameMap) -&gt; QualName VName -&gt; NameMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565590"><span class="hs-identifier hs-var">pname'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-328"></span><span>                </span><span class="annot"><span class="annottext">envModTable :: Map VName Mod
</span><a href="Language.Futhark.Semantic.html#envModTable"><span class="hs-identifier hs-var">envModTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Mod -&gt; Map VName Mod
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565590"><span class="hs-identifier hs-var">pname'</span></a></span><span> </span><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684565595"><span class="hs-identifier hs-var">e1_mod</span></a></span><span>
</span><span id="line-329"></span><span>              </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-330"></span><span>            </span><span class="annot"><span class="annottext">VName -&gt; Maybe VName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565590"><span class="hs-identifier hs-var">pname'</span></a></span><span>
</span><span id="line-331"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>      </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-333"></span><span>        </span><span class="annot"><span class="annottext">(Env, Maybe VName) -&gt; TypeM (Env, Maybe VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe VName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565589"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565589"><span class="hs-identifier hs-var">e2_abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565588"><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565588"><span class="hs-identifier hs-var">e2_mod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565587"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565587"><span class="hs-identifier hs-var">e2'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Env
-&gt; TypeM (TySet, MTy, SigExpBase Info VName)
-&gt; TypeM (TySet, MTy, SigExpBase Info VName)
forall a. Env -&gt; TypeM a -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.Monad.html#localEnv"><span class="hs-identifier hs-var">localEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565593"><span class="hs-identifier hs-var">env_for_e2</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeM (TySet, MTy, SigExpBase Info VName)
 -&gt; TypeM (TySet, MTy, SigExpBase Info VName))
-&gt; TypeM (TySet, MTy, SigExpBase Info VName)
-&gt; TypeM (TySet, MTy, SigExpBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name -&gt; TypeM (TySet, MTy, SigExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkSigExp"><span class="hs-identifier hs-var">checkSigExp</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565599"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-335"></span><span>  </span><span class="annot"><span class="annottext">(TySet, MTy, SigExpBase Info VName)
-&gt; TypeM (TySet, MTy, SigExpBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565597"><span class="hs-identifier hs-var">e1_abs</span></a></span><span> </span><span class="annot"><span class="annottext">TySet -&gt; TySet -&gt; TySet
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565589"><span class="hs-identifier hs-var">e2_abs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-337"></span><span>      </span><span class="annot"><span class="annottext">TySet -&gt; Mod -&gt; MTy
</span><a href="Language.Futhark.Semantic.html#MTy"><span class="hs-identifier hs-var">MTy</span></a></span><span> </span><span class="annot"><span class="annottext">TySet
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Mod -&gt; MTy) -&gt; Mod -&gt; MTy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FunSig -&gt; Mod
</span><a href="Language.Futhark.Semantic.html#ModFun"><span class="hs-identifier hs-var">ModFun</span></a></span><span> </span><span class="annot"><span class="annottext">(FunSig -&gt; Mod) -&gt; FunSig -&gt; Mod
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TySet -&gt; Mod -&gt; MTy -&gt; FunSig
</span><a href="Language.Futhark.Semantic.html#FunSig"><span class="hs-identifier hs-var">FunSig</span></a></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565596"><span class="hs-identifier hs-var">s_abs</span></a></span><span> </span><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684565595"><span class="hs-identifier hs-var">e1_mod</span></a></span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565588"><span class="hs-identifier hs-var">e2_mod</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-338"></span><span>      </span><span class="annot"><span class="annottext">Maybe VName
-&gt; SigExpBase Info VName
-&gt; SigExpBase Info VName
-&gt; SrcLoc
-&gt; SigExpBase Info VName
forall (f :: * -&gt; *) vn.
Maybe vn
-&gt; SigExpBase f vn -&gt; SigExpBase f vn -&gt; SrcLoc -&gt; SigExpBase f vn
</span><a href="Language.Futhark.Syntax.html#SigArrow"><span class="hs-identifier hs-var">SigArrow</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684565592"><span class="hs-identifier hs-var">maybe_pname'</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565594"><span class="hs-identifier hs-var">e1'</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565587"><span class="hs-identifier hs-var">e2'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565598"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkSigExpToEnv"><span class="hs-identifier hs-type">checkSigExpToEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-342"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#SigExpBase"><span class="hs-identifier hs-type">SigExpBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-343"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Semantic.html#TySet"><span class="hs-identifier hs-type">TySet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#TySet"><span class="hs-identifier hs-type">TySet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#SigExpBase"><span class="hs-identifier hs-type">SigExpBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span id="checkSigExpToEnv"><span class="annot"><span class="annottext">checkSigExpToEnv :: SigExpBase NoInfo Name
-&gt; TypeM (TySet, TySet, Env, SigExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkSigExpToEnv"><span class="hs-identifier hs-var hs-var">checkSigExpToEnv</span></a></span></span><span> </span><span id="local-6989586621684565584"><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565584"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565583"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565583"><span class="hs-identifier hs-var">abs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#MTy"><span class="hs-identifier hs-type">MTy</span></a></span><span> </span><span id="local-6989586621684565582"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565582"><span class="hs-identifier hs-var">mod_abs</span></a></span></span><span> </span><span id="local-6989586621684565581"><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684565581"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565580"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565580"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name -&gt; TypeM (TySet, MTy, SigExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkSigExp"><span class="hs-identifier hs-var">checkSigExp</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565584"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684565581"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-347"></span><span>    </span><span class="annot"><a href="Language.Futhark.Semantic.html#ModEnv"><span class="hs-identifier hs-type">ModEnv</span></a></span><span> </span><span id="local-6989586621684565579"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565579"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TySet, TySet, Env, SigExpBase Info VName)
-&gt; TypeM (TySet, TySet, Env, SigExpBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565583"><span class="hs-identifier hs-var">abs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565582"><span class="hs-identifier hs-var">mod_abs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565579"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565580"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>    </span><span class="annot"><a href="Language.Futhark.Semantic.html#ModFun"><span class="hs-identifier hs-type">ModFun</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; TypeM (TySet, TySet, Env, SigExpBase Info VName)
forall (m :: * -&gt; *) a. MonadTypeChecker m =&gt; SrcLoc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#unappliedFunctor"><span class="hs-identifier hs-var">unappliedFunctor</span></a></span><span> </span><span class="annot"><span class="annottext">(SrcLoc -&gt; TypeM (TySet, TySet, Env, SigExpBase Info VName))
-&gt; SrcLoc -&gt; TypeM (TySet, TySet, Env, SigExpBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565584"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkSigBind"><span class="hs-identifier hs-type">checkSigBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#SigBindBase"><span class="hs-identifier hs-type">SigBindBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Semantic.html#TySet"><span class="hs-identifier hs-type">TySet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#SigBindBase"><span class="hs-identifier hs-type">SigBindBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span id="checkSigBind"><span class="annot"><span class="annottext">checkSigBind :: SigBindBase NoInfo Name
-&gt; TypeM (TySet, Env, SigBindBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkSigBind"><span class="hs-identifier hs-var hs-var">checkSigBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#SigBind"><span class="hs-identifier hs-type">SigBind</span></a></span><span> </span><span id="local-6989586621684565576"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565576"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621684565575"><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565575"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684565574"><span class="annot"><span class="annottext">Maybe DocComment
</span><a href="#local-6989586621684565574"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span id="local-6989586621684565573"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565573"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-352"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565572"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565572"><span class="hs-identifier hs-var">abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565571"><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565571"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565570"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565570"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name -&gt; TypeM (TySet, MTy, SigExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkSigExp"><span class="hs-identifier hs-var">checkSigExp</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565575"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-353"></span><span>  </span><span class="annot"><span class="annottext">[(Namespace, Name)]
-&gt; TypeM (TySet, Env, SigBindBase Info VName)
-&gt; TypeM (TySet, Env, SigBindBase Info VName)
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
[(Namespace, Name)] -&gt; m a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#bindSpaced"><span class="hs-identifier hs-var">bindSpaced</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Signature"><span class="hs-identifier hs-var">Signature</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565576"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TypeM (TySet, Env, SigBindBase Info VName)
 -&gt; TypeM (TySet, Env, SigBindBase Info VName))
-&gt; TypeM (TySet, Env, SigBindBase Info VName)
-&gt; TypeM (TySet, Env, SigBindBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-354"></span><span>    </span><span id="local-6989586621684565569"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565569"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Namespace -&gt; Name -&gt; SrcLoc -&gt; TypeM VName
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
Namespace -&gt; Name -&gt; SrcLoc -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Monad.html#checkName"><span class="hs-identifier hs-var">checkName</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Signature"><span class="hs-identifier hs-var">Signature</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565576"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565573"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-355"></span><span>    </span><span class="annot"><span class="annottext">(TySet, Env, SigBindBase Info VName)
-&gt; TypeM (TySet, Env, SigBindBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-356"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565572"><span class="hs-identifier hs-var">abs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-357"></span><span>        </span><span class="annot"><span class="annottext">Env
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-358"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">envSigTable :: Map VName MTy
</span><a href="Language.Futhark.Semantic.html#envSigTable"><span class="hs-identifier hs-var">envSigTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; MTy -&gt; Map VName MTy
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565569"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565571"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-359"></span><span>            </span><span class="annot"><span class="annottext">envNameMap :: NameMap
</span><a href="Language.Futhark.Semantic.html#envNameMap"><span class="hs-identifier hs-var">envNameMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Namespace, Name) -&gt; QualName VName -&gt; NameMap
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Signature"><span class="hs-identifier hs-var">Signature</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565576"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565569"><span class="hs-identifier hs-var">name'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>          </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-361"></span><span>        </span><span class="annot"><span class="annottext">VName
-&gt; SigExpBase Info VName
-&gt; Maybe DocComment
-&gt; SrcLoc
-&gt; SigBindBase Info VName
forall (f :: * -&gt; *) vn.
vn
-&gt; SigExpBase f vn
-&gt; Maybe DocComment
-&gt; SrcLoc
-&gt; SigBindBase f vn
</span><a href="Language.Futhark.Syntax.html#SigBind"><span class="hs-identifier hs-var">SigBind</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565569"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565570"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><a href="#local-6989586621684565574"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565573"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-362"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkOneModExp"><span class="hs-identifier hs-type">checkOneModExp</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-365"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#ModExpBase"><span class="hs-identifier hs-type">ModExpBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-366"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Semantic.html#TySet"><span class="hs-identifier hs-type">TySet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#MTy"><span class="hs-identifier hs-type">MTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#ModExpBase"><span class="hs-identifier hs-type">ModExpBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span id="checkOneModExp"><span class="annot"><span class="annottext">checkOneModExp :: ModExpBase NoInfo Name -&gt; TypeM (TySet, MTy, ModExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkOneModExp"><span class="hs-identifier hs-var hs-var">checkOneModExp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModParens"><span class="hs-identifier hs-type">ModParens</span></a></span><span> </span><span id="local-6989586621684565566"><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565566"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684565565"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565565"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-368"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565564"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565564"><span class="hs-identifier hs-var">abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565563"><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565563"><span class="hs-identifier hs-var">mty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565562"><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565562"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name -&gt; TypeM (TySet, MTy, ModExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkOneModExp"><span class="hs-identifier hs-var">checkOneModExp</span></a></span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565566"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-369"></span><span>  </span><span class="annot"><span class="annottext">(TySet, MTy, ModExpBase Info VName)
-&gt; TypeM (TySet, MTy, ModExpBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565564"><span class="hs-identifier hs-var">abs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565563"><span class="hs-identifier hs-var">mty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModExpBase Info VName -&gt; SrcLoc -&gt; ModExpBase Info VName
forall (f :: * -&gt; *) vn.
ModExpBase f vn -&gt; SrcLoc -&gt; ModExpBase f vn
</span><a href="Language.Futhark.Syntax.html#ModParens"><span class="hs-identifier hs-var">ModParens</span></a></span><span> </span><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565562"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565565"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkOneModExp"><span class="hs-identifier hs-var">checkOneModExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModDecs"><span class="hs-identifier hs-type">ModDecs</span></a></span><span> </span><span id="local-6989586621684565560"><span class="annot"><span class="annottext">[UncheckedDec]
</span><a href="#local-6989586621684565560"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span id="local-6989586621684565559"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565559"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-371"></span><span>  </span><span class="annot"><span class="annottext">[UncheckedDec] -&gt; TypeM ()
</span><a href="Language.Futhark.TypeChecker.html#checkForDuplicateDecs"><span class="hs-identifier hs-var">checkForDuplicateDecs</span></a></span><span> </span><span class="annot"><span class="annottext">[UncheckedDec]
</span><a href="#local-6989586621684565560"><span class="hs-identifier hs-var">decs</span></a></span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565558"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565558"><span class="hs-identifier hs-var">abstypes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565557"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565557"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565556"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621684565556"><span class="hs-identifier hs-var">decs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[UncheckedDec] -&gt; TypeM (TySet, Env, [Dec])
</span><a href="Language.Futhark.TypeChecker.html#checkDecs"><span class="hs-identifier hs-var">checkDecs</span></a></span><span> </span><span class="annot"><span class="annottext">[UncheckedDec]
</span><a href="#local-6989586621684565560"><span class="hs-identifier hs-var">decs</span></a></span><span>
</span><span id="line-373"></span><span>  </span><span class="annot"><span class="annottext">(TySet, MTy, ModExpBase Info VName)
-&gt; TypeM (TySet, MTy, ModExpBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-374"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565558"><span class="hs-identifier hs-var">abstypes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-375"></span><span>      </span><span class="annot"><span class="annottext">TySet -&gt; Mod -&gt; MTy
</span><a href="Language.Futhark.Semantic.html#MTy"><span class="hs-identifier hs-var">MTy</span></a></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565558"><span class="hs-identifier hs-var">abstypes</span></a></span><span> </span><span class="annot"><span class="annottext">(Mod -&gt; MTy) -&gt; Mod -&gt; MTy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; Mod
</span><a href="Language.Futhark.Semantic.html#ModEnv"><span class="hs-identifier hs-var">ModEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565557"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-376"></span><span>      </span><span class="annot"><span class="annottext">[Dec] -&gt; SrcLoc -&gt; ModExpBase Info VName
forall (f :: * -&gt; *) vn.
[DecBase f vn] -&gt; SrcLoc -&gt; ModExpBase f vn
</span><a href="Language.Futhark.Syntax.html#ModDecs"><span class="hs-identifier hs-var">ModDecs</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621684565556"><span class="hs-identifier hs-var">decs'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565559"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkOneModExp"><span class="hs-identifier hs-var">checkOneModExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModVar"><span class="hs-identifier hs-type">ModVar</span></a></span><span> </span><span id="local-6989586621684565554"><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684565554"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621684565553"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565553"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-379"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565552"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684565552"><span class="hs-identifier hs-var">v'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565551"><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684565551"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; QualName Name -&gt; TypeM (QualName VName, Mod)
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
SrcLoc -&gt; QualName Name -&gt; m (QualName VName, Mod)
</span><a href="Language.Futhark.TypeChecker.Monad.html#lookupMod"><span class="hs-identifier hs-var">lookupMod</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565553"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">QualName Name
</span><a href="#local-6989586621684565554"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-380"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TypeM () -&gt; TypeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span>
</span><span id="line-381"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Name
</span><a href="Language.Futhark.Core.html#baseName"><span class="hs-identifier hs-var">baseName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName VName -&gt; VName
forall vn. QualName vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#qualLeaf"><span class="hs-identifier hs-var hs-var">qualLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684565552"><span class="hs-identifier hs-var">v'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Name
</span><a href="Language.Futhark.Core.html#nameFromString"><span class="hs-identifier hs-var">nameFromString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;intrinsics&quot;</span></span><span>
</span><span id="line-382"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Int
</span><a href="Language.Futhark.Core.html#baseTag"><span class="hs-identifier hs-var">baseTag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualName VName -&gt; VName
forall vn. QualName vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#qualLeaf"><span class="hs-identifier hs-var hs-var">qualLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684565552"><span class="hs-identifier hs-var">v'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Language.Futhark.Prop.html#maxIntrinsicTag"><span class="hs-identifier hs-var">maxIntrinsicTag</span></a></span><span>
</span><span id="line-383"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>    </span><span class="annot"><span class="annottext">(TypeM () -&gt; TypeM ()) -&gt; TypeM () -&gt; TypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565553"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;The 'intrinsics' module may not be used in module expressions.&quot;</span></span><span>
</span><span id="line-385"></span><span>  </span><span class="annot"><span class="annottext">(TySet, MTy, ModExpBase Info VName)
-&gt; TypeM (TySet, MTy, ModExpBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySet
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySet -&gt; Mod -&gt; MTy
</span><a href="Language.Futhark.Semantic.html#MTy"><span class="hs-identifier hs-var">MTy</span></a></span><span> </span><span class="annot"><span class="annottext">TySet
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684565551"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; SrcLoc -&gt; ModExpBase Info VName
forall (f :: * -&gt; *) vn. QualName vn -&gt; SrcLoc -&gt; ModExpBase f vn
</span><a href="Language.Futhark.Syntax.html#ModVar"><span class="hs-identifier hs-var">ModVar</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684565552"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565553"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkOneModExp"><span class="hs-identifier hs-var">checkOneModExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModImport"><span class="hs-identifier hs-type">ModImport</span></a></span><span> </span><span id="local-6989586621684565542"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684565542"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo [Char]
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684565541"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565541"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565540"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684565540"><span class="hs-identifier hs-var">name'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565539"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565539"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; [Char] -&gt; TypeM ([Char], Env)
</span><a href="Language.Futhark.TypeChecker.Monad.html#lookupImport"><span class="hs-identifier hs-var">lookupImport</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565541"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684565542"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-388"></span><span>  </span><span class="annot"><span class="annottext">(TySet, MTy, ModExpBase Info VName)
-&gt; TypeM (TySet, MTy, ModExpBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-389"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TySet
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span>
</span><span id="line-390"></span><span>      </span><span class="annot"><span class="annottext">TySet -&gt; Mod -&gt; MTy
</span><a href="Language.Futhark.Semantic.html#MTy"><span class="hs-identifier hs-var">MTy</span></a></span><span> </span><span class="annot"><span class="annottext">TySet
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Mod -&gt; MTy) -&gt; Mod -&gt; MTy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; Mod
</span><a href="Language.Futhark.Semantic.html#ModEnv"><span class="hs-identifier hs-var">ModEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565539"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-391"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Info [Char] -&gt; SrcLoc -&gt; ModExpBase Info VName
forall (f :: * -&gt; *) vn.
[Char] -&gt; f [Char] -&gt; SrcLoc -&gt; ModExpBase f vn
</span><a href="Language.Futhark.Syntax.html#ModImport"><span class="hs-identifier hs-var">ModImport</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684565542"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Info [Char]
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684565540"><span class="hs-identifier hs-var">name'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565541"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-392"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkOneModExp"><span class="hs-identifier hs-var">checkOneModExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModApply"><span class="hs-identifier hs-type">ModApply</span></a></span><span> </span><span id="local-6989586621684565536"><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565536"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621684565535"><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565535"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (Map VName VName)
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span class="annot"><span class="annottext">NoInfo (Map VName VName)
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684565534"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565534"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-394"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565533"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565533"><span class="hs-identifier hs-var">f_abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565532"><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565532"><span class="hs-identifier hs-var">f_mty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565531"><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565531"><span class="hs-identifier hs-var">f'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name -&gt; TypeM (TySet, MTy, ModExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkOneModExp"><span class="hs-identifier hs-var">checkOneModExp</span></a></span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565536"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MTy -&gt; Mod
</span><a href="Language.Futhark.Semantic.html#mtyMod"><span class="hs-identifier hs-var hs-var">mtyMod</span></a></span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565532"><span class="hs-identifier hs-var">f_mty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-396"></span><span>    </span><span class="annot"><a href="Language.Futhark.Semantic.html#ModFun"><span class="hs-identifier hs-type">ModFun</span></a></span><span> </span><span id="local-6989586621684565530"><span class="annot"><span class="annottext">FunSig
</span><a href="#local-6989586621684565530"><span class="hs-identifier hs-var">functor</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-397"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684565529"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565529"><span class="hs-identifier hs-var">e_abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565528"><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565528"><span class="hs-identifier hs-var">e_mty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565527"><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565527"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name -&gt; TypeM (TySet, MTy, ModExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkOneModExp"><span class="hs-identifier hs-var">checkOneModExp</span></a></span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565535"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-398"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684565526"><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565526"><span class="hs-identifier hs-var">mty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565525"><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684565525"><span class="hs-identifier hs-var">psubsts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565524"><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684565524"><span class="hs-identifier hs-var">rsubsts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc
-&gt; FunSig -&gt; MTy -&gt; TypeM (MTy, Map VName VName, Map VName VName)
</span><a href="Language.Futhark.TypeChecker.Modules.html#applyFunctor"><span class="hs-identifier hs-var">applyFunctor</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565534"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">FunSig
</span><a href="#local-6989586621684565530"><span class="hs-identifier hs-var">functor</span></a></span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565528"><span class="hs-identifier hs-var">e_mty</span></a></span><span>
</span><span id="line-399"></span><span>      </span><span class="annot"><span class="annottext">(TySet, MTy, ModExpBase Info VName)
-&gt; TypeM (TySet, MTy, ModExpBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-400"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">MTy -&gt; TySet
</span><a href="Language.Futhark.Semantic.html#mtyAbs"><span class="hs-identifier hs-var hs-var">mtyAbs</span></a></span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565526"><span class="hs-identifier hs-var">mty</span></a></span><span> </span><span class="annot"><span class="annottext">TySet -&gt; TySet -&gt; TySet
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565533"><span class="hs-identifier hs-var">f_abs</span></a></span><span> </span><span class="annot"><span class="annottext">TySet -&gt; TySet -&gt; TySet
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565529"><span class="hs-identifier hs-var">e_abs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-401"></span><span>          </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565526"><span class="hs-identifier hs-var">mty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-402"></span><span>          </span><span class="annot"><span class="annottext">ModExpBase Info VName
-&gt; ModExpBase Info VName
-&gt; Info (Map VName VName)
-&gt; Info (Map VName VName)
-&gt; SrcLoc
-&gt; ModExpBase Info VName
forall (f :: * -&gt; *) vn.
ModExpBase f vn
-&gt; ModExpBase f vn
-&gt; f (Map VName VName)
-&gt; f (Map VName VName)
-&gt; SrcLoc
-&gt; ModExpBase f vn
</span><a href="Language.Futhark.Syntax.html#ModApply"><span class="hs-identifier hs-var">ModApply</span></a></span><span> </span><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565531"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565527"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map VName VName -&gt; Info (Map VName VName)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684565525"><span class="hs-identifier hs-var">psubsts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map VName VName -&gt; Info (Map VName VName)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684565524"><span class="hs-identifier hs-var">rsubsts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565534"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-403"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>    </span><span class="annot"><span class="annottext">Mod
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-405"></span><span>      </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TypeM (TySet, MTy, ModExpBase Info VName)
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565534"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Cannot apply non-parametric module.&quot;</span></span><span>
</span><span id="line-406"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkOneModExp"><span class="hs-identifier hs-var">checkOneModExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModAscript"><span class="hs-identifier hs-type">ModAscript</span></a></span><span> </span><span id="local-6989586621684565521"><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565521"><span class="hs-identifier hs-var">me</span></a></span></span><span> </span><span id="local-6989586621684565520"><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565520"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo (Map VName VName)
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684565519"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565519"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-407"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565518"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565518"><span class="hs-identifier hs-var">me_abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565517"><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565517"><span class="hs-identifier hs-var">me_mod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565516"><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565516"><span class="hs-identifier hs-var">me'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name -&gt; TypeM (TySet, MTy, ModExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkOneModExp"><span class="hs-identifier hs-var">checkOneModExp</span></a></span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565521"><span class="hs-identifier hs-var">me</span></a></span><span>
</span><span id="line-408"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565515"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565515"><span class="hs-identifier hs-var">se_abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565514"><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565514"><span class="hs-identifier hs-var">se_mty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565513"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565513"><span class="hs-identifier hs-var">se'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name -&gt; TypeM (TySet, MTy, SigExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkSigExp"><span class="hs-identifier hs-var">checkSigExp</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565520"><span class="hs-identifier hs-var">se</span></a></span><span>
</span><span id="line-409"></span><span>  </span><span id="local-6989586621684565512"><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684565512"><span class="hs-identifier hs-var">match_subst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Either TypeError (Map VName VName) -&gt; TypeM (Map VName VName)
forall a. Either TypeError a -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.Monad.html#badOnLeft"><span class="hs-identifier hs-var">badOnLeft</span></a></span><span> </span><span class="annot"><span class="annottext">(Either TypeError (Map VName VName) -&gt; TypeM (Map VName VName))
-&gt; Either TypeError (Map VName VName) -&gt; TypeM (Map VName VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MTy -&gt; MTy -&gt; SrcLoc -&gt; Either TypeError (Map VName VName)
</span><a href="Language.Futhark.TypeChecker.Modules.html#matchMTys"><span class="hs-identifier hs-var">matchMTys</span></a></span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565517"><span class="hs-identifier hs-var">me_mod</span></a></span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565514"><span class="hs-identifier hs-var">se_mty</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565519"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-410"></span><span>  </span><span class="annot"><span class="annottext">(TySet, MTy, ModExpBase Info VName)
-&gt; TypeM (TySet, MTy, ModExpBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565515"><span class="hs-identifier hs-var">se_abs</span></a></span><span> </span><span class="annot"><span class="annottext">TySet -&gt; TySet -&gt; TySet
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565518"><span class="hs-identifier hs-var">me_abs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565514"><span class="hs-identifier hs-var">se_mty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModExpBase Info VName
-&gt; SigExpBase Info VName
-&gt; Info (Map VName VName)
-&gt; SrcLoc
-&gt; ModExpBase Info VName
forall (f :: * -&gt; *) vn.
ModExpBase f vn
-&gt; SigExpBase f vn
-&gt; f (Map VName VName)
-&gt; SrcLoc
-&gt; ModExpBase f vn
</span><a href="Language.Futhark.Syntax.html#ModAscript"><span class="hs-identifier hs-var">ModAscript</span></a></span><span> </span><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565516"><span class="hs-identifier hs-var">me'</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565513"><span class="hs-identifier hs-var">se'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map VName VName -&gt; Info (Map VName VName)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684565512"><span class="hs-identifier hs-var">match_subst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565519"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkOneModExp"><span class="hs-identifier hs-var">checkOneModExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModLambda"><span class="hs-identifier hs-type">ModLambda</span></a></span><span> </span><span id="local-6989586621684565508"><span class="annot"><span class="annottext">ModParamBase NoInfo Name
</span><a href="#local-6989586621684565508"><span class="hs-identifier hs-var">param</span></a></span></span><span> </span><span id="local-6989586621684565507"><span class="annot"><span class="annottext">Maybe (SigExpBase NoInfo Name, NoInfo (Map VName VName))
</span><a href="#local-6989586621684565507"><span class="hs-identifier hs-var">maybe_fsig_e</span></a></span></span><span> </span><span id="local-6989586621684565506"><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565506"><span class="hs-identifier hs-var">body_e</span></a></span></span><span> </span><span id="local-6989586621684565505"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565505"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-412"></span><span>  </span><span class="annot"><span class="annottext">ModParamBase NoInfo Name
-&gt; (ModParamBase Info VName
    -&gt; TySet -&gt; Mod -&gt; TypeM (TySet, MTy, ModExpBase Info VName))
-&gt; TypeM (TySet, MTy, ModExpBase Info VName)
forall a.
ModParamBase NoInfo Name
-&gt; (ModParamBase Info VName -&gt; TySet -&gt; Mod -&gt; TypeM a) -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.html#withModParam"><span class="hs-identifier hs-var">withModParam</span></a></span><span> </span><span class="annot"><span class="annottext">ModParamBase NoInfo Name
</span><a href="#local-6989586621684565508"><span class="hs-identifier hs-var">param</span></a></span><span> </span><span class="annot"><span class="annottext">((ModParamBase Info VName
  -&gt; TySet -&gt; Mod -&gt; TypeM (TySet, MTy, ModExpBase Info VName))
 -&gt; TypeM (TySet, MTy, ModExpBase Info VName))
-&gt; (ModParamBase Info VName
    -&gt; TySet -&gt; Mod -&gt; TypeM (TySet, MTy, ModExpBase Info VName))
-&gt; TypeM (TySet, MTy, ModExpBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684565503"><span class="annot"><span class="annottext">ModParamBase Info VName
</span><a href="#local-6989586621684565503"><span class="hs-identifier hs-var">param'</span></a></span></span><span> </span><span id="local-6989586621684565502"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565502"><span class="hs-identifier hs-var">param_abs</span></a></span></span><span> </span><span id="local-6989586621684565501"><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684565501"><span class="hs-identifier hs-var">param_mod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-413"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684565500"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565500"><span class="hs-identifier hs-var">abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565499"><span class="annot"><span class="annottext">Maybe (SigExpBase Info VName, Info (Map VName VName))
</span><a href="#local-6989586621684565499"><span class="hs-identifier hs-var">maybe_fsig_e'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565498"><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565498"><span class="hs-identifier hs-var">body_e'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565497"><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565497"><span class="hs-identifier hs-var">mty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-414"></span><span>      </span><span class="annot"><span class="annottext">Maybe (SigExpBase NoInfo Name)
-&gt; ModExpBase NoInfo Name
-&gt; SrcLoc
-&gt; TypeM
     (TySet, Maybe (SigExpBase Info VName, Info (Map VName VName)),
      ModExpBase Info VName, MTy)
</span><a href="Language.Futhark.TypeChecker.html#checkModBody"><span class="hs-identifier hs-var">checkModBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SigExpBase NoInfo Name, NoInfo (Map VName VName))
-&gt; SigExpBase NoInfo Name
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((SigExpBase NoInfo Name, NoInfo (Map VName VName))
 -&gt; SigExpBase NoInfo Name)
-&gt; Maybe (SigExpBase NoInfo Name, NoInfo (Map VName VName))
-&gt; Maybe (SigExpBase NoInfo Name)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (SigExpBase NoInfo Name, NoInfo (Map VName VName))
</span><a href="#local-6989586621684565507"><span class="hs-identifier hs-var">maybe_fsig_e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565506"><span class="hs-identifier hs-var">body_e</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565505"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-415"></span><span>    </span><span class="annot"><span class="annottext">(TySet, MTy, ModExpBase Info VName)
-&gt; TypeM (TySet, MTy, ModExpBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-416"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565500"><span class="hs-identifier hs-var">abs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-417"></span><span>        </span><span class="annot"><span class="annottext">TySet -&gt; Mod -&gt; MTy
</span><a href="Language.Futhark.Semantic.html#MTy"><span class="hs-identifier hs-var">MTy</span></a></span><span> </span><span class="annot"><span class="annottext">TySet
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Mod -&gt; MTy) -&gt; Mod -&gt; MTy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FunSig -&gt; Mod
</span><a href="Language.Futhark.Semantic.html#ModFun"><span class="hs-identifier hs-var">ModFun</span></a></span><span> </span><span class="annot"><span class="annottext">(FunSig -&gt; Mod) -&gt; FunSig -&gt; Mod
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TySet -&gt; Mod -&gt; MTy -&gt; FunSig
</span><a href="Language.Futhark.Semantic.html#FunSig"><span class="hs-identifier hs-var">FunSig</span></a></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565502"><span class="hs-identifier hs-var">param_abs</span></a></span><span> </span><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684565501"><span class="hs-identifier hs-var">param_mod</span></a></span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565497"><span class="hs-identifier hs-var">mty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-418"></span><span>        </span><span class="annot"><span class="annottext">ModParamBase Info VName
-&gt; Maybe (SigExpBase Info VName, Info (Map VName VName))
-&gt; ModExpBase Info VName
-&gt; SrcLoc
-&gt; ModExpBase Info VName
forall (f :: * -&gt; *) vn.
ModParamBase f vn
-&gt; Maybe (SigExpBase f vn, f (Map VName VName))
-&gt; ModExpBase f vn
-&gt; SrcLoc
-&gt; ModExpBase f vn
</span><a href="Language.Futhark.Syntax.html#ModLambda"><span class="hs-identifier hs-var">ModLambda</span></a></span><span> </span><span class="annot"><span class="annottext">ModParamBase Info VName
</span><a href="#local-6989586621684565503"><span class="hs-identifier hs-var">param'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SigExpBase Info VName, Info (Map VName VName))
</span><a href="#local-6989586621684565499"><span class="hs-identifier hs-var">maybe_fsig_e'</span></a></span><span> </span><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565498"><span class="hs-identifier hs-var">body_e'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565505"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-419"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkOneModExpToEnv"><span class="hs-identifier hs-type">checkOneModExpToEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#ModExpBase"><span class="hs-identifier hs-type">ModExpBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Semantic.html#TySet"><span class="hs-identifier hs-type">TySet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#ModExpBase"><span class="hs-identifier hs-type">ModExpBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span id="checkOneModExpToEnv"><span class="annot"><span class="annottext">checkOneModExpToEnv :: ModExpBase NoInfo Name -&gt; TypeM (TySet, Env, ModExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkOneModExpToEnv"><span class="hs-identifier hs-var hs-var">checkOneModExpToEnv</span></a></span></span><span> </span><span id="local-6989586621684565493"><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565493"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565492"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565492"><span class="hs-identifier hs-var">e_abs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#MTy"><span class="hs-identifier hs-type">MTy</span></a></span><span> </span><span id="local-6989586621684565491"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565491"><span class="hs-identifier hs-var">abs</span></a></span></span><span> </span><span id="local-6989586621684565490"><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684565490"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565489"><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565489"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name -&gt; TypeM (TySet, MTy, ModExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkOneModExp"><span class="hs-identifier hs-var">checkOneModExp</span></a></span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565493"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-424"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684565490"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-425"></span><span>    </span><span class="annot"><a href="Language.Futhark.Semantic.html#ModEnv"><span class="hs-identifier hs-type">ModEnv</span></a></span><span> </span><span id="local-6989586621684565488"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565488"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TySet, Env, ModExpBase Info VName)
-&gt; TypeM (TySet, Env, ModExpBase Info VName)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565492"><span class="hs-identifier hs-var">e_abs</span></a></span><span> </span><span class="annot"><span class="annottext">TySet -&gt; TySet -&gt; TySet
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565491"><span class="hs-identifier hs-var">abs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565488"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565489"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>    </span><span class="annot"><a href="Language.Futhark.Semantic.html#ModFun"><span class="hs-identifier hs-type">ModFun</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; TypeM (TySet, Env, ModExpBase Info VName)
forall (m :: * -&gt; *) a. MonadTypeChecker m =&gt; SrcLoc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#unappliedFunctor"><span class="hs-identifier hs-var">unappliedFunctor</span></a></span><span> </span><span class="annot"><span class="annottext">(SrcLoc -&gt; TypeM (TySet, Env, ModExpBase Info VName))
-&gt; SrcLoc -&gt; TypeM (TySet, Env, ModExpBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name -&gt; SrcLoc
forall a. Located a =&gt; a -&gt; SrcLoc
</span><span class="hs-identifier hs-var">srclocOf</span></span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565493"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span id="local-6989586621684566445"><span class="annot"><a href="Language.Futhark.TypeChecker.html#withModParam"><span class="hs-identifier hs-type">withModParam</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-429"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#ModParamBase"><span class="hs-identifier hs-type">ModParamBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-430"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModParamBase"><span class="hs-identifier hs-type">ModParamBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#TySet"><span class="hs-identifier hs-type">TySet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#Mod"><span class="hs-identifier hs-type">Mod</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684566445"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-431"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684566445"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-432"></span><span id="withModParam"><span class="annot"><span class="annottext">withModParam :: forall a.
ModParamBase NoInfo Name
-&gt; (ModParamBase Info VName -&gt; TySet -&gt; Mod -&gt; TypeM a) -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.html#withModParam"><span class="hs-identifier hs-var hs-var">withModParam</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModParam"><span class="hs-identifier hs-type">ModParam</span></a></span><span> </span><span id="local-6989586621684565482"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565482"><span class="hs-identifier hs-var">pname</span></a></span></span><span> </span><span id="local-6989586621684565481"><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565481"><span class="hs-identifier hs-var">psig_e</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo [VName]
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684565480"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565480"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684565479"><span class="annot"><span class="annottext">ModParamBase Info VName -&gt; TySet -&gt; Mod -&gt; TypeM a
</span><a href="#local-6989586621684565479"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-433"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565478"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565478"><span class="hs-identifier hs-var">_abs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#MTy"><span class="hs-identifier hs-type">MTy</span></a></span><span> </span><span id="local-6989586621684565477"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565477"><span class="hs-identifier hs-var">p_abs</span></a></span></span><span> </span><span id="local-6989586621684565476"><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684565476"><span class="hs-identifier hs-var">p_mod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565475"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565475"><span class="hs-identifier hs-var">psig_e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name -&gt; TypeM (TySet, MTy, SigExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkSigExp"><span class="hs-identifier hs-var">checkSigExp</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565481"><span class="hs-identifier hs-var">psig_e</span></a></span><span>
</span><span id="line-434"></span><span>  </span><span class="annot"><span class="annottext">[(Namespace, Name)] -&gt; TypeM a -&gt; TypeM a
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
[(Namespace, Name)] -&gt; m a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#bindSpaced"><span class="hs-identifier hs-var">bindSpaced</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565482"><span class="hs-identifier hs-var">pname</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TypeM a -&gt; TypeM a) -&gt; TypeM a -&gt; TypeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-435"></span><span>    </span><span id="local-6989586621684565474"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565474"><span class="hs-identifier hs-var">pname'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Namespace -&gt; Name -&gt; SrcLoc -&gt; TypeM VName
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
Namespace -&gt; Name -&gt; SrcLoc -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Monad.html#checkName"><span class="hs-identifier hs-var">checkName</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565482"><span class="hs-identifier hs-var">pname</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565480"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-436"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684565472"><span class="annot"><span class="annottext">in_body_env :: Env
</span><a href="#local-6989586621684565472"><span class="hs-identifier hs-var hs-var">in_body_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">envModTable :: Map VName Mod
</span><a href="Language.Futhark.Semantic.html#envModTable"><span class="hs-identifier hs-var">envModTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Mod -&gt; Map VName Mod
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565474"><span class="hs-identifier hs-var">pname'</span></a></span><span> </span><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684565476"><span class="hs-identifier hs-var">p_mod</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-437"></span><span>    </span><span class="annot"><span class="annottext">Env -&gt; TypeM a -&gt; TypeM a
forall a. Env -&gt; TypeM a -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.Monad.html#localEnv"><span class="hs-identifier hs-var">localEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565472"><span class="hs-identifier hs-var">in_body_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeM a -&gt; TypeM a) -&gt; TypeM a -&gt; TypeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-438"></span><span>      </span><span class="annot"><span class="annottext">ModParamBase Info VName -&gt; TySet -&gt; Mod -&gt; TypeM a
</span><a href="#local-6989586621684565479"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName
-&gt; SigExpBase Info VName
-&gt; Info [VName]
-&gt; SrcLoc
-&gt; ModParamBase Info VName
forall (f :: * -&gt; *) vn.
vn -&gt; SigExpBase f vn -&gt; f [VName] -&gt; SrcLoc -&gt; ModParamBase f vn
</span><a href="Language.Futhark.Syntax.html#ModParam"><span class="hs-identifier hs-var">ModParam</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565474"><span class="hs-identifier hs-var">pname'</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565475"><span class="hs-identifier hs-var">psig_e'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[VName] -&gt; Info [VName]
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; Info [VName]) -&gt; [VName] -&gt; Info [VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(QualName VName -&gt; VName) -&gt; [QualName VName] -&gt; [VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; VName
forall vn. QualName vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#qualLeaf"><span class="hs-identifier hs-var hs-var">qualLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">([QualName VName] -&gt; [VName]) -&gt; [QualName VName] -&gt; [VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TySet -&gt; [QualName VName]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">M.keys</span></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565477"><span class="hs-identifier hs-var">p_abs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565480"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565477"><span class="hs-identifier hs-var">p_abs</span></a></span><span> </span><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684565476"><span class="hs-identifier hs-var">p_mod</span></a></span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span id="local-6989586621684566438"><span class="annot"><a href="Language.Futhark.TypeChecker.html#withModParams"><span class="hs-identifier hs-type">withModParams</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-441"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModParamBase"><span class="hs-identifier hs-type">ModParamBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-442"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModParamBase"><span class="hs-identifier hs-type">ModParamBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#TySet"><span class="hs-identifier hs-type">TySet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#Mod"><span class="hs-identifier hs-type">Mod</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684566438"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-443"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684566438"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-444"></span><span id="withModParams"><span class="annot"><span class="annottext">withModParams :: forall a.
[ModParamBase NoInfo Name]
-&gt; ([(ModParamBase Info VName, TySet, Mod)] -&gt; TypeM a) -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.html#withModParams"><span class="hs-identifier hs-var hs-var">withModParams</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621684565470"><span class="annot"><span class="annottext">[(ModParamBase Info VName, TySet, Mod)] -&gt; TypeM a
</span><a href="#local-6989586621684565470"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ModParamBase Info VName, TySet, Mod)] -&gt; TypeM a
</span><a href="#local-6989586621684565470"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-445"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#withModParams"><span class="hs-identifier hs-var">withModParams</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684565469"><span class="annot"><span class="annottext">ModParamBase NoInfo Name
</span><a href="#local-6989586621684565469"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684565468"><span class="annot"><span class="annottext">[ModParamBase NoInfo Name]
</span><a href="#local-6989586621684565468"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684565467"><span class="annot"><span class="annottext">[(ModParamBase Info VName, TySet, Mod)] -&gt; TypeM a
</span><a href="#local-6989586621684565467"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-446"></span><span>  </span><span class="annot"><span class="annottext">ModParamBase NoInfo Name
-&gt; (ModParamBase Info VName -&gt; TySet -&gt; Mod -&gt; TypeM a) -&gt; TypeM a
forall a.
ModParamBase NoInfo Name
-&gt; (ModParamBase Info VName -&gt; TySet -&gt; Mod -&gt; TypeM a) -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.html#withModParam"><span class="hs-identifier hs-var">withModParam</span></a></span><span> </span><span class="annot"><span class="annottext">ModParamBase NoInfo Name
</span><a href="#local-6989586621684565469"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">((ModParamBase Info VName -&gt; TySet -&gt; Mod -&gt; TypeM a) -&gt; TypeM a)
-&gt; (ModParamBase Info VName -&gt; TySet -&gt; Mod -&gt; TypeM a) -&gt; TypeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684565466"><span class="annot"><span class="annottext">ModParamBase Info VName
</span><a href="#local-6989586621684565466"><span class="hs-identifier hs-var">p'</span></a></span></span><span> </span><span id="local-6989586621684565465"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565465"><span class="hs-identifier hs-var">pabs</span></a></span></span><span> </span><span id="local-6989586621684565464"><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684565464"><span class="hs-identifier hs-var">pmod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-447"></span><span>    </span><span class="annot"><span class="annottext">[ModParamBase NoInfo Name]
-&gt; ([(ModParamBase Info VName, TySet, Mod)] -&gt; TypeM a) -&gt; TypeM a
forall a.
[ModParamBase NoInfo Name]
-&gt; ([(ModParamBase Info VName, TySet, Mod)] -&gt; TypeM a) -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.html#withModParams"><span class="hs-identifier hs-var">withModParams</span></a></span><span> </span><span class="annot"><span class="annottext">[ModParamBase NoInfo Name]
</span><a href="#local-6989586621684565468"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">(([(ModParamBase Info VName, TySet, Mod)] -&gt; TypeM a) -&gt; TypeM a)
-&gt; ([(ModParamBase Info VName, TySet, Mod)] -&gt; TypeM a) -&gt; TypeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684565463"><span class="annot"><span class="annottext">[(ModParamBase Info VName, TySet, Mod)]
</span><a href="#local-6989586621684565463"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(ModParamBase Info VName, TySet, Mod)] -&gt; TypeM a
</span><a href="#local-6989586621684565467"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">([(ModParamBase Info VName, TySet, Mod)] -&gt; TypeM a)
-&gt; [(ModParamBase Info VName, TySet, Mod)] -&gt; TypeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModParamBase Info VName
</span><a href="#local-6989586621684565466"><span class="hs-identifier hs-var">p'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565465"><span class="hs-identifier hs-var">pabs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684565464"><span class="hs-identifier hs-var">pmod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ModParamBase Info VName, TySet, Mod)
-&gt; [(ModParamBase Info VName, TySet, Mod)]
-&gt; [(ModParamBase Info VName, TySet, Mod)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(ModParamBase Info VName, TySet, Mod)]
</span><a href="#local-6989586621684565463"><span class="hs-identifier hs-var">ps'</span></a></span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkModBody"><span class="hs-identifier hs-type">checkModBody</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-450"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#SigExpBase"><span class="hs-identifier hs-type">SigExpBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-451"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#ModExpBase"><span class="hs-identifier hs-type">ModExpBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-452"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SrcLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-453"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span>
</span><span id="line-454"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#TySet"><span class="hs-identifier hs-type">TySet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-455"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.html#SigExp"><span class="hs-identifier hs-type">SigExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-456"></span><span>      </span><span class="annot"><a href="Language.Futhark.html#ModExp"><span class="hs-identifier hs-type">ModExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-457"></span><span>      </span><span class="annot"><a href="Language.Futhark.Semantic.html#MTy"><span class="hs-identifier hs-type">MTy</span></a></span><span>
</span><span id="line-458"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span id="checkModBody"><span class="annot"><span class="annottext">checkModBody :: Maybe (SigExpBase NoInfo Name)
-&gt; ModExpBase NoInfo Name
-&gt; SrcLoc
-&gt; TypeM
     (TySet, Maybe (SigExpBase Info VName, Info (Map VName VName)),
      ModExpBase Info VName, MTy)
</span><a href="Language.Futhark.TypeChecker.html#checkModBody"><span class="hs-identifier hs-var hs-var">checkModBody</span></a></span></span><span> </span><span id="local-6989586621684565460"><span class="annot"><span class="annottext">Maybe (SigExpBase NoInfo Name)
</span><a href="#local-6989586621684565460"><span class="hs-identifier hs-var">maybe_fsig_e</span></a></span></span><span> </span><span id="local-6989586621684565459"><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565459"><span class="hs-identifier hs-var">body_e</span></a></span></span><span> </span><span id="local-6989586621684565458"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565458"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeM
  (TySet, Maybe (SigExpBase Info VName, Info (Map VName VName)),
   ModExpBase Info VName, MTy)
-&gt; TypeM
     (TySet, Maybe (SigExpBase Info VName, Info (Map VName VName)),
      ModExpBase Info VName, MTy)
forall a. TypeM a -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.Monad.html#enteringModule"><span class="hs-identifier hs-var">enteringModule</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeM
   (TySet, Maybe (SigExpBase Info VName, Info (Map VName VName)),
    ModExpBase Info VName, MTy)
 -&gt; TypeM
      (TySet, Maybe (SigExpBase Info VName, Info (Map VName VName)),
       ModExpBase Info VName, MTy))
-&gt; TypeM
     (TySet, Maybe (SigExpBase Info VName, Info (Map VName VName)),
      ModExpBase Info VName, MTy)
-&gt; TypeM
     (TySet, Maybe (SigExpBase Info VName, Info (Map VName VName)),
      ModExpBase Info VName, MTy)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-460"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565456"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565456"><span class="hs-identifier hs-var">body_e_abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565455"><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565455"><span class="hs-identifier hs-var">body_mty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565454"><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565454"><span class="hs-identifier hs-var">body_e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name -&gt; TypeM (TySet, MTy, ModExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkOneModExp"><span class="hs-identifier hs-var">checkOneModExp</span></a></span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565459"><span class="hs-identifier hs-var">body_e</span></a></span><span>
</span><span id="line-461"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (SigExpBase NoInfo Name)
</span><a href="#local-6989586621684565460"><span class="hs-identifier hs-var">maybe_fsig_e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-462"></span><span>    </span><span class="annot"><span class="annottext">Maybe (SigExpBase NoInfo Name)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-463"></span><span>      </span><span class="annot"><span class="annottext">(TySet, Maybe (SigExpBase Info VName, Info (Map VName VName)),
 ModExpBase Info VName, MTy)
-&gt; TypeM
     (TySet, Maybe (SigExpBase Info VName, Info (Map VName VName)),
      ModExpBase Info VName, MTy)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-464"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">MTy -&gt; TySet
</span><a href="Language.Futhark.Semantic.html#mtyAbs"><span class="hs-identifier hs-var hs-var">mtyAbs</span></a></span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565455"><span class="hs-identifier hs-var">body_mty</span></a></span><span> </span><span class="annot"><span class="annottext">TySet -&gt; TySet -&gt; TySet
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565456"><span class="hs-identifier hs-var">body_e_abs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-465"></span><span>          </span><span class="annot"><span class="annottext">Maybe (SigExpBase Info VName, Info (Map VName VName))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-466"></span><span>          </span><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565454"><span class="hs-identifier hs-var">body_e'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-467"></span><span>          </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565455"><span class="hs-identifier hs-var">body_mty</span></a></span><span>
</span><span id="line-468"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684565453"><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565453"><span class="hs-identifier hs-var">fsig_e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-470"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621684565452"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565452"><span class="hs-identifier hs-var">fsig_abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565451"><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565451"><span class="hs-identifier hs-var">fsig_mty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565450"><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565450"><span class="hs-identifier hs-var">fsig_e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name -&gt; TypeM (TySet, MTy, SigExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkSigExp"><span class="hs-identifier hs-var">checkSigExp</span></a></span><span> </span><span class="annot"><span class="annottext">SigExpBase NoInfo Name
</span><a href="#local-6989586621684565453"><span class="hs-identifier hs-var">fsig_e</span></a></span><span>
</span><span id="line-471"></span><span>      </span><span id="local-6989586621684565449"><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684565449"><span class="hs-identifier hs-var">fsig_subst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Either TypeError (Map VName VName) -&gt; TypeM (Map VName VName)
forall a. Either TypeError a -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.Monad.html#badOnLeft"><span class="hs-identifier hs-var">badOnLeft</span></a></span><span> </span><span class="annot"><span class="annottext">(Either TypeError (Map VName VName) -&gt; TypeM (Map VName VName))
-&gt; Either TypeError (Map VName VName) -&gt; TypeM (Map VName VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MTy -&gt; MTy -&gt; SrcLoc -&gt; Either TypeError (Map VName VName)
</span><a href="Language.Futhark.TypeChecker.Modules.html#matchMTys"><span class="hs-identifier hs-var">matchMTys</span></a></span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565455"><span class="hs-identifier hs-var">body_mty</span></a></span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565451"><span class="hs-identifier hs-var">fsig_mty</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565458"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-472"></span><span>      </span><span class="annot"><span class="annottext">(TySet, Maybe (SigExpBase Info VName, Info (Map VName VName)),
 ModExpBase Info VName, MTy)
-&gt; TypeM
     (TySet, Maybe (SigExpBase Info VName, Info (Map VName VName)),
      ModExpBase Info VName, MTy)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-473"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565452"><span class="hs-identifier hs-var">fsig_abs</span></a></span><span> </span><span class="annot"><span class="annottext">TySet -&gt; TySet -&gt; TySet
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565456"><span class="hs-identifier hs-var">body_e_abs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-474"></span><span>          </span><span class="annot"><span class="annottext">(SigExpBase Info VName, Info (Map VName VName))
-&gt; Maybe (SigExpBase Info VName, Info (Map VName VName))
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SigExpBase Info VName
</span><a href="#local-6989586621684565450"><span class="hs-identifier hs-var">fsig_e'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map VName VName -&gt; Info (Map VName VName)
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">Map VName VName
</span><a href="#local-6989586621684565449"><span class="hs-identifier hs-var">fsig_subst</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-475"></span><span>          </span><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565454"><span class="hs-identifier hs-var">body_e'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-476"></span><span>          </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565451"><span class="hs-identifier hs-var">fsig_mty</span></a></span><span>
</span><span id="line-477"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkModBind"><span class="hs-identifier hs-type">checkModBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#ModBindBase"><span class="hs-identifier hs-type">ModBindBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Semantic.html#TySet"><span class="hs-identifier hs-type">TySet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#ModBindBase"><span class="hs-identifier hs-type">ModBindBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span id="checkModBind"><span class="annot"><span class="annottext">checkModBind :: ModBindBase NoInfo Name
-&gt; TypeM (TySet, Env, ModBindBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkModBind"><span class="hs-identifier hs-var hs-var">checkModBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModBind"><span class="hs-identifier hs-type">ModBind</span></a></span><span> </span><span id="local-6989586621684565447"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565447"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621684565446"><span class="annot"><span class="annottext">Maybe (SigExpBase NoInfo Name, NoInfo (Map VName VName))
</span><a href="#local-6989586621684565446"><span class="hs-identifier hs-var">maybe_fsig_e</span></a></span></span><span> </span><span id="local-6989586621684565445"><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565445"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621684565444"><span class="annot"><span class="annottext">Maybe DocComment
</span><a href="#local-6989586621684565444"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span id="local-6989586621684565443"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565443"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-481"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565442"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565442"><span class="hs-identifier hs-var">e_abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565441"><span class="annot"><span class="annottext">Maybe (SigExpBase Info VName, Info (Map VName VName))
</span><a href="#local-6989586621684565441"><span class="hs-identifier hs-var">maybe_fsig_e'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565440"><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565440"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565439"><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565439"><span class="hs-identifier hs-var">mty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (SigExpBase NoInfo Name)
-&gt; ModExpBase NoInfo Name
-&gt; SrcLoc
-&gt; TypeM
     (TySet, Maybe (SigExpBase Info VName, Info (Map VName VName)),
      ModExpBase Info VName, MTy)
</span><a href="Language.Futhark.TypeChecker.html#checkModBody"><span class="hs-identifier hs-var">checkModBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SigExpBase NoInfo Name, NoInfo (Map VName VName))
-&gt; SigExpBase NoInfo Name
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((SigExpBase NoInfo Name, NoInfo (Map VName VName))
 -&gt; SigExpBase NoInfo Name)
-&gt; Maybe (SigExpBase NoInfo Name, NoInfo (Map VName VName))
-&gt; Maybe (SigExpBase NoInfo Name)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (SigExpBase NoInfo Name, NoInfo (Map VName VName))
</span><a href="#local-6989586621684565446"><span class="hs-identifier hs-var">maybe_fsig_e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565445"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565443"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-482"></span><span>  </span><span class="annot"><span class="annottext">[(Namespace, Name)]
-&gt; TypeM (TySet, Env, ModBindBase Info VName)
-&gt; TypeM (TySet, Env, ModBindBase Info VName)
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
[(Namespace, Name)] -&gt; m a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#bindSpaced"><span class="hs-identifier hs-var">bindSpaced</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565447"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TypeM (TySet, Env, ModBindBase Info VName)
 -&gt; TypeM (TySet, Env, ModBindBase Info VName))
-&gt; TypeM (TySet, Env, ModBindBase Info VName)
-&gt; TypeM (TySet, Env, ModBindBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-483"></span><span>    </span><span id="local-6989586621684565438"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565438"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Namespace -&gt; Name -&gt; SrcLoc -&gt; TypeM VName
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
Namespace -&gt; Name -&gt; SrcLoc -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Monad.html#checkName"><span class="hs-identifier hs-var">checkName</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565447"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565443"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-484"></span><span>    </span><span class="annot"><span class="annottext">(TySet, Env, ModBindBase Info VName)
-&gt; TypeM (TySet, Env, ModBindBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-485"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565442"><span class="hs-identifier hs-var">e_abs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-486"></span><span>        </span><span class="annot"><span class="annottext">Env
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-487"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">envModTable :: Map VName Mod
</span><a href="Language.Futhark.Semantic.html#envModTable"><span class="hs-identifier hs-var">envModTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Mod -&gt; Map VName Mod
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565438"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">(Mod -&gt; Map VName Mod) -&gt; Mod -&gt; Map VName Mod
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MTy -&gt; Mod
</span><a href="Language.Futhark.Semantic.html#mtyMod"><span class="hs-identifier hs-var hs-var">mtyMod</span></a></span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565439"><span class="hs-identifier hs-var">mty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-488"></span><span>            </span><span class="annot"><span class="annottext">envNameMap :: NameMap
</span><a href="Language.Futhark.Semantic.html#envNameMap"><span class="hs-identifier hs-var">envNameMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Namespace, Name) -&gt; QualName VName -&gt; NameMap
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565447"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QualName VName -&gt; NameMap) -&gt; QualName VName -&gt; NameMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565438"><span class="hs-identifier hs-var">name'</span></a></span><span>
</span><span id="line-489"></span><span>          </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-490"></span><span>        </span><span class="annot"><span class="annottext">VName
-&gt; [ModParamBase Info VName]
-&gt; Maybe (SigExpBase Info VName, Info (Map VName VName))
-&gt; ModExpBase Info VName
-&gt; Maybe DocComment
-&gt; SrcLoc
-&gt; ModBindBase Info VName
forall (f :: * -&gt; *) vn.
vn
-&gt; [ModParamBase f vn]
-&gt; Maybe (SigExpBase f vn, f (Map VName VName))
-&gt; ModExpBase f vn
-&gt; Maybe DocComment
-&gt; SrcLoc
-&gt; ModBindBase f vn
</span><a href="Language.Futhark.Syntax.html#ModBind"><span class="hs-identifier hs-var">ModBind</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565438"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe (SigExpBase Info VName, Info (Map VName VName))
</span><a href="#local-6989586621684565441"><span class="hs-identifier hs-var">maybe_fsig_e'</span></a></span><span> </span><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565440"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><a href="#local-6989586621684565444"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565443"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-491"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkModBind"><span class="hs-identifier hs-var">checkModBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModBind"><span class="hs-identifier hs-type">ModBind</span></a></span><span> </span><span id="local-6989586621684565437"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565437"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684565436"><span class="annot"><span class="annottext">ModParamBase NoInfo Name
</span><a href="#local-6989586621684565436"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684565435"><span class="annot"><span class="annottext">[ModParamBase NoInfo Name]
</span><a href="#local-6989586621684565435"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684565434"><span class="annot"><span class="annottext">Maybe (SigExpBase NoInfo Name, NoInfo (Map VName VName))
</span><a href="#local-6989586621684565434"><span class="hs-identifier hs-var">maybe_fsig_e</span></a></span></span><span> </span><span id="local-6989586621684565433"><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565433"><span class="hs-identifier hs-var">body_e</span></a></span></span><span> </span><span id="local-6989586621684565432"><span class="annot"><span class="annottext">Maybe DocComment
</span><a href="#local-6989586621684565432"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span id="local-6989586621684565431"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565431"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-493"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565430"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565430"><span class="hs-identifier hs-var">abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565429"><span class="annot"><span class="annottext">[ModParamBase Info VName]
</span><a href="#local-6989586621684565429"><span class="hs-identifier hs-var">params'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565428"><span class="annot"><span class="annottext">Maybe (SigExpBase Info VName, Info (Map VName VName))
</span><a href="#local-6989586621684565428"><span class="hs-identifier hs-var">maybe_fsig_e'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565427"><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565427"><span class="hs-identifier hs-var">body_e'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565426"><span class="annot"><span class="annottext">FunSig
</span><a href="#local-6989586621684565426"><span class="hs-identifier hs-var">funsig</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-494"></span><span>    </span><span class="annot"><span class="annottext">ModParamBase NoInfo Name
-&gt; (ModParamBase Info VName
    -&gt; TySet
    -&gt; Mod
    -&gt; TypeM
         (TySet, [ModParamBase Info VName],
          Maybe (SigExpBase Info VName, Info (Map VName VName)),
          ModExpBase Info VName, FunSig))
-&gt; TypeM
     (TySet, [ModParamBase Info VName],
      Maybe (SigExpBase Info VName, Info (Map VName VName)),
      ModExpBase Info VName, FunSig)
forall a.
ModParamBase NoInfo Name
-&gt; (ModParamBase Info VName -&gt; TySet -&gt; Mod -&gt; TypeM a) -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.html#withModParam"><span class="hs-identifier hs-var">withModParam</span></a></span><span> </span><span class="annot"><span class="annottext">ModParamBase NoInfo Name
</span><a href="#local-6989586621684565436"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">((ModParamBase Info VName
  -&gt; TySet
  -&gt; Mod
  -&gt; TypeM
       (TySet, [ModParamBase Info VName],
        Maybe (SigExpBase Info VName, Info (Map VName VName)),
        ModExpBase Info VName, FunSig))
 -&gt; TypeM
      (TySet, [ModParamBase Info VName],
       Maybe (SigExpBase Info VName, Info (Map VName VName)),
       ModExpBase Info VName, FunSig))
-&gt; (ModParamBase Info VName
    -&gt; TySet
    -&gt; Mod
    -&gt; TypeM
         (TySet, [ModParamBase Info VName],
          Maybe (SigExpBase Info VName, Info (Map VName VName)),
          ModExpBase Info VName, FunSig))
-&gt; TypeM
     (TySet, [ModParamBase Info VName],
      Maybe (SigExpBase Info VName, Info (Map VName VName)),
      ModExpBase Info VName, FunSig)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684565425"><span class="annot"><span class="annottext">ModParamBase Info VName
</span><a href="#local-6989586621684565425"><span class="hs-identifier hs-var">p'</span></a></span></span><span> </span><span id="local-6989586621684565424"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565424"><span class="hs-identifier hs-var">p_abs</span></a></span></span><span> </span><span id="local-6989586621684565423"><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684565423"><span class="hs-identifier hs-var">p_mod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-495"></span><span>      </span><span class="annot"><span class="annottext">[ModParamBase NoInfo Name]
-&gt; ([(ModParamBase Info VName, TySet, Mod)]
    -&gt; TypeM
         (TySet, [ModParamBase Info VName],
          Maybe (SigExpBase Info VName, Info (Map VName VName)),
          ModExpBase Info VName, FunSig))
-&gt; TypeM
     (TySet, [ModParamBase Info VName],
      Maybe (SigExpBase Info VName, Info (Map VName VName)),
      ModExpBase Info VName, FunSig)
forall a.
[ModParamBase NoInfo Name]
-&gt; ([(ModParamBase Info VName, TySet, Mod)] -&gt; TypeM a) -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.html#withModParams"><span class="hs-identifier hs-var">withModParams</span></a></span><span> </span><span class="annot"><span class="annottext">[ModParamBase NoInfo Name]
</span><a href="#local-6989586621684565435"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">(([(ModParamBase Info VName, TySet, Mod)]
  -&gt; TypeM
       (TySet, [ModParamBase Info VName],
        Maybe (SigExpBase Info VName, Info (Map VName VName)),
        ModExpBase Info VName, FunSig))
 -&gt; TypeM
      (TySet, [ModParamBase Info VName],
       Maybe (SigExpBase Info VName, Info (Map VName VName)),
       ModExpBase Info VName, FunSig))
-&gt; ([(ModParamBase Info VName, TySet, Mod)]
    -&gt; TypeM
         (TySet, [ModParamBase Info VName],
          Maybe (SigExpBase Info VName, Info (Map VName VName)),
          ModExpBase Info VName, FunSig))
-&gt; TypeM
     (TySet, [ModParamBase Info VName],
      Maybe (SigExpBase Info VName, Info (Map VName VName)),
      ModExpBase Info VName, FunSig)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684565422"><span class="annot"><span class="annottext">[(ModParamBase Info VName, TySet, Mod)]
</span><a href="#local-6989586621684565422"><span class="hs-identifier hs-var">params_stuff</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-496"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684565421"><span class="annot"><span class="annottext">[ModParamBase Info VName]
</span><a href="#local-6989586621684565421"><span class="hs-identifier hs-var">ps'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565420"><span class="annot"><span class="annottext">[TySet]
</span><a href="#local-6989586621684565420"><span class="hs-identifier hs-var">ps_abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565419"><span class="annot"><span class="annottext">[Mod]
</span><a href="#local-6989586621684565419"><span class="hs-identifier hs-var">ps_mod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ModParamBase Info VName, TySet, Mod)]
-&gt; ([ModParamBase Info VName], [TySet], [Mod])
forall a b c. [(a, b, c)] -&gt; ([a], [b], [c])
</span><span class="hs-identifier hs-var">unzip3</span></span><span> </span><span class="annot"><span class="annottext">[(ModParamBase Info VName, TySet, Mod)]
</span><a href="#local-6989586621684565422"><span class="hs-identifier hs-var">params_stuff</span></a></span><span>
</span><span id="line-497"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621684565417"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565417"><span class="hs-identifier hs-var">abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565416"><span class="annot"><span class="annottext">Maybe (SigExpBase Info VName, Info (Map VName VName))
</span><a href="#local-6989586621684565416"><span class="hs-identifier hs-var">maybe_fsig_e'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565415"><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565415"><span class="hs-identifier hs-var">body_e'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565414"><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565414"><span class="hs-identifier hs-var">mty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (SigExpBase NoInfo Name)
-&gt; ModExpBase NoInfo Name
-&gt; SrcLoc
-&gt; TypeM
     (TySet, Maybe (SigExpBase Info VName, Info (Map VName VName)),
      ModExpBase Info VName, MTy)
</span><a href="Language.Futhark.TypeChecker.html#checkModBody"><span class="hs-identifier hs-var">checkModBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SigExpBase NoInfo Name, NoInfo (Map VName VName))
-&gt; SigExpBase NoInfo Name
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((SigExpBase NoInfo Name, NoInfo (Map VName VName))
 -&gt; SigExpBase NoInfo Name)
-&gt; Maybe (SigExpBase NoInfo Name, NoInfo (Map VName VName))
-&gt; Maybe (SigExpBase NoInfo Name)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (SigExpBase NoInfo Name, NoInfo (Map VName VName))
</span><a href="#local-6989586621684565434"><span class="hs-identifier hs-var">maybe_fsig_e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565433"><span class="hs-identifier hs-var">body_e</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565431"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-498"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684565411"><span class="annot"><span class="annottext">addParam :: (TySet, Mod) -&gt; MTy -&gt; MTy
</span><a href="#local-6989586621684565411"><span class="hs-identifier hs-var hs-var">addParam</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684565410"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565410"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565409"><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684565409"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621684565408"><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565408"><span class="hs-identifier hs-var">mty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TySet -&gt; Mod -&gt; MTy
</span><a href="Language.Futhark.Semantic.html#MTy"><span class="hs-identifier hs-var">MTy</span></a></span><span> </span><span class="annot"><span class="annottext">TySet
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Mod -&gt; MTy) -&gt; Mod -&gt; MTy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FunSig -&gt; Mod
</span><a href="Language.Futhark.Semantic.html#ModFun"><span class="hs-identifier hs-var">ModFun</span></a></span><span> </span><span class="annot"><span class="annottext">(FunSig -&gt; Mod) -&gt; FunSig -&gt; Mod
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TySet -&gt; Mod -&gt; MTy -&gt; FunSig
</span><a href="Language.Futhark.Semantic.html#FunSig"><span class="hs-identifier hs-var">FunSig</span></a></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565410"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684565409"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565408"><span class="hs-identifier hs-var">mty'</span></a></span><span>
</span><span id="line-499"></span><span>        </span><span class="annot"><span class="annottext">(TySet, [ModParamBase Info VName],
 Maybe (SigExpBase Info VName, Info (Map VName VName)),
 ModExpBase Info VName, FunSig)
-&gt; TypeM
     (TySet, [ModParamBase Info VName],
      Maybe (SigExpBase Info VName, Info (Map VName VName)),
      ModExpBase Info VName, FunSig)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-500"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565417"><span class="hs-identifier hs-var">abs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-501"></span><span>            </span><span class="annot"><span class="annottext">ModParamBase Info VName
</span><a href="#local-6989586621684565425"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">ModParamBase Info VName
-&gt; [ModParamBase Info VName] -&gt; [ModParamBase Info VName]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ModParamBase Info VName]
</span><a href="#local-6989586621684565421"><span class="hs-identifier hs-var">ps'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-502"></span><span>            </span><span class="annot"><span class="annottext">Maybe (SigExpBase Info VName, Info (Map VName VName))
</span><a href="#local-6989586621684565416"><span class="hs-identifier hs-var">maybe_fsig_e'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-503"></span><span>            </span><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565415"><span class="hs-identifier hs-var">body_e'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-504"></span><span>            </span><span class="annot"><span class="annottext">TySet -&gt; Mod -&gt; MTy -&gt; FunSig
</span><a href="Language.Futhark.Semantic.html#FunSig"><span class="hs-identifier hs-var">FunSig</span></a></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565424"><span class="hs-identifier hs-var">p_abs</span></a></span><span> </span><span class="annot"><span class="annottext">Mod
</span><a href="#local-6989586621684565423"><span class="hs-identifier hs-var">p_mod</span></a></span><span> </span><span class="annot"><span class="annottext">(MTy -&gt; FunSig) -&gt; MTy -&gt; FunSig
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((TySet, Mod) -&gt; MTy -&gt; MTy) -&gt; MTy -&gt; [(TySet, Mod)] -&gt; MTy
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">(TySet, Mod) -&gt; MTy -&gt; MTy
</span><a href="#local-6989586621684565411"><span class="hs-identifier hs-var">addParam</span></a></span><span> </span><span class="annot"><span class="annottext">MTy
</span><a href="#local-6989586621684565414"><span class="hs-identifier hs-var">mty</span></a></span><span> </span><span class="annot"><span class="annottext">([(TySet, Mod)] -&gt; MTy) -&gt; [(TySet, Mod)] -&gt; MTy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TySet] -&gt; [Mod] -&gt; [(TySet, Mod)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[TySet]
</span><a href="#local-6989586621684565420"><span class="hs-identifier hs-var">ps_abs</span></a></span><span> </span><span class="annot"><span class="annottext">[Mod]
</span><a href="#local-6989586621684565419"><span class="hs-identifier hs-var">ps_mod</span></a></span><span>
</span><span id="line-505"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-506"></span><span>  </span><span class="annot"><span class="annottext">[(Namespace, Name)]
-&gt; TypeM (TySet, Env, ModBindBase Info VName)
-&gt; TypeM (TySet, Env, ModBindBase Info VName)
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
[(Namespace, Name)] -&gt; m a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#bindSpaced"><span class="hs-identifier hs-var">bindSpaced</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565437"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TypeM (TySet, Env, ModBindBase Info VName)
 -&gt; TypeM (TySet, Env, ModBindBase Info VName))
-&gt; TypeM (TySet, Env, ModBindBase Info VName)
-&gt; TypeM (TySet, Env, ModBindBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-507"></span><span>    </span><span id="local-6989586621684565406"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565406"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Namespace -&gt; Name -&gt; SrcLoc -&gt; TypeM VName
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
Namespace -&gt; Name -&gt; SrcLoc -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Monad.html#checkName"><span class="hs-identifier hs-var">checkName</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565437"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565431"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-508"></span><span>    </span><span class="annot"><span class="annottext">(TySet, Env, ModBindBase Info VName)
-&gt; TypeM (TySet, Env, ModBindBase Info VName)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-509"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565430"><span class="hs-identifier hs-var">abs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-510"></span><span>        </span><span class="annot"><span class="annottext">Env
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-511"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">envModTable :: Map VName Mod
</span><a href="Language.Futhark.Semantic.html#envModTable"><span class="hs-identifier hs-var">envModTable</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-512"></span><span>              </span><span class="annot"><span class="annottext">VName -&gt; Mod -&gt; Map VName Mod
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565406"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">(Mod -&gt; Map VName Mod) -&gt; Mod -&gt; Map VName Mod
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FunSig -&gt; Mod
</span><a href="Language.Futhark.Semantic.html#ModFun"><span class="hs-identifier hs-var">ModFun</span></a></span><span> </span><span class="annot"><span class="annottext">FunSig
</span><a href="#local-6989586621684565426"><span class="hs-identifier hs-var">funsig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-513"></span><span>            </span><span class="annot"><span class="annottext">envNameMap :: NameMap
</span><a href="Language.Futhark.Semantic.html#envNameMap"><span class="hs-identifier hs-var">envNameMap</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-514"></span><span>              </span><span class="annot"><span class="annottext">(Namespace, Name) -&gt; QualName VName -&gt; NameMap
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565437"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QualName VName -&gt; NameMap) -&gt; QualName VName -&gt; NameMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565406"><span class="hs-identifier hs-var">name'</span></a></span><span>
</span><span id="line-515"></span><span>          </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-516"></span><span>        </span><span class="annot"><span class="annottext">VName
-&gt; [ModParamBase Info VName]
-&gt; Maybe (SigExpBase Info VName, Info (Map VName VName))
-&gt; ModExpBase Info VName
-&gt; Maybe DocComment
-&gt; SrcLoc
-&gt; ModBindBase Info VName
forall (f :: * -&gt; *) vn.
vn
-&gt; [ModParamBase f vn]
-&gt; Maybe (SigExpBase f vn, f (Map VName VName))
-&gt; ModExpBase f vn
-&gt; Maybe DocComment
-&gt; SrcLoc
-&gt; ModBindBase f vn
</span><a href="Language.Futhark.Syntax.html#ModBind"><span class="hs-identifier hs-var">ModBind</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565406"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">[ModParamBase Info VName]
</span><a href="#local-6989586621684565429"><span class="hs-identifier hs-var">params'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SigExpBase Info VName, Info (Map VName VName))
</span><a href="#local-6989586621684565428"><span class="hs-identifier hs-var">maybe_fsig_e'</span></a></span><span> </span><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565427"><span class="hs-identifier hs-var">body_e'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><a href="#local-6989586621684565432"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565431"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-517"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkForDuplicateSpecs"><span class="hs-identifier hs-type">checkForDuplicateSpecs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Syntax.html#SpecBase"><span class="hs-identifier hs-type">SpecBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span id="checkForDuplicateSpecs"><span class="annot"><span class="annottext">checkForDuplicateSpecs :: [SpecBase NoInfo Name] -&gt; TypeM ()
</span><a href="Language.Futhark.TypeChecker.html#checkForDuplicateSpecs"><span class="hs-identifier hs-var hs-var">checkForDuplicateSpecs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-521"></span><span>  </span><span class="annot"><span class="annottext">(Map (Namespace, Name) SrcLoc
 -&gt; SpecBase NoInfo Name -&gt; TypeM (Map (Namespace, Name) SrcLoc))
-&gt; Map (Namespace, Name) SrcLoc
-&gt; [SpecBase NoInfo Name]
-&gt; TypeM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">foldM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SpecBase NoInfo Name
 -&gt; Map (Namespace, Name) SrcLoc
 -&gt; TypeM (Map (Namespace, Name) SrcLoc))
-&gt; Map (Namespace, Name) SrcLoc
-&gt; SpecBase NoInfo Name
-&gt; TypeM (Map (Namespace, Name) SrcLoc)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">SpecBase NoInfo Name
-&gt; Map (Namespace, Name) SrcLoc
-&gt; TypeM (Map (Namespace, Name) SrcLoc)
forall {m :: * -&gt; *} {f :: * -&gt; *}.
MonadTypeChecker m =&gt;
SpecBase f Name
-&gt; Map (Namespace, Name) SrcLoc -&gt; m (Map (Namespace, Name) SrcLoc)
</span><a href="#local-6989586621684565405"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (Namespace, Name) SrcLoc
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-522"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-523"></span><span>    </span><span id="local-6989586621684565396"><span class="annot"><span class="annottext">check :: Namespace
-&gt; Name
-&gt; SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
-&gt; m (Map (Namespace, Name) SrcLoc)
</span><a href="#local-6989586621684565396"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span id="local-6989586621684565395"><span class="annot"><span class="annottext">Namespace
</span><a href="#local-6989586621684565395"><span class="hs-identifier hs-var">namespace</span></a></span></span><span> </span><span id="local-6989586621684565394"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565394"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621684565393"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565393"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621684565392"><span class="annot"><span class="annottext">Map (Namespace, Name) SrcLoc
</span><a href="#local-6989586621684565392"><span class="hs-identifier hs-var">known</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-524"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Namespace, Name) -&gt; Map (Namespace, Name) SrcLoc -&gt; Maybe SrcLoc
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="#local-6989586621684565395"><span class="hs-identifier hs-var">namespace</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565394"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (Namespace, Name) SrcLoc
</span><a href="#local-6989586621684565392"><span class="hs-identifier hs-var">known</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-525"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684565391"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565391"><span class="hs-identifier hs-var">loc'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-526"></span><span>          </span><span class="annot"><span class="annottext">Namespace
-&gt; Name -&gt; SrcLoc -&gt; SrcLoc -&gt; m (Map (Namespace, Name) SrcLoc)
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
Namespace -&gt; Name -&gt; SrcLoc -&gt; SrcLoc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.html#dupDefinitionError"><span class="hs-identifier hs-var">dupDefinitionError</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="#local-6989586621684565395"><span class="hs-identifier hs-var">namespace</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565394"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565393"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565391"><span class="hs-identifier hs-var">loc'</span></a></span><span>
</span><span id="line-527"></span><span>        </span><span class="annot"><span class="annottext">Maybe SrcLoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map (Namespace, Name) SrcLoc -&gt; m (Map (Namespace, Name) SrcLoc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Map (Namespace, Name) SrcLoc -&gt; m (Map (Namespace, Name) SrcLoc))
-&gt; Map (Namespace, Name) SrcLoc -&gt; m (Map (Namespace, Name) SrcLoc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Namespace, Name)
-&gt; SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="#local-6989586621684565395"><span class="hs-identifier hs-var">namespace</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565394"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565393"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Namespace, Name) SrcLoc
</span><a href="#local-6989586621684565392"><span class="hs-identifier hs-var">known</span></a></span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span>    </span><span id="local-6989586621684565405"><span class="annot"><span class="annottext">f :: SpecBase f Name
-&gt; Map (Namespace, Name) SrcLoc -&gt; m (Map (Namespace, Name) SrcLoc)
</span><a href="#local-6989586621684565405"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ValSpec"><span class="hs-identifier hs-type">ValSpec</span></a></span><span> </span><span id="local-6989586621684565383"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565383"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase f Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684565382"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565382"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-530"></span><span>      </span><span class="annot"><span class="annottext">Namespace
-&gt; Name
-&gt; SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
-&gt; m (Map (Namespace, Name) SrcLoc)
forall {m :: * -&gt; *}.
MonadTypeChecker m =&gt;
Namespace
-&gt; Name
-&gt; SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
-&gt; m (Map (Namespace, Name) SrcLoc)
</span><a href="#local-6989586621684565396"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565383"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565382"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-531"></span><span>    </span><span class="annot"><a href="#local-6989586621684565405"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeAbbrSpec"><span class="hs-identifier hs-type">TypeAbbrSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span> </span><span id="local-6989586621684565381"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565381"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TypeExp Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">f StructRetType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684565380"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565380"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-532"></span><span>      </span><span class="annot"><span class="annottext">Namespace
-&gt; Name
-&gt; SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
-&gt; m (Map (Namespace, Name) SrcLoc)
forall {m :: * -&gt; *}.
MonadTypeChecker m =&gt;
Namespace
-&gt; Name
-&gt; SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
-&gt; m (Map (Namespace, Name) SrcLoc)
</span><a href="#local-6989586621684565396"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565381"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565380"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-533"></span><span>    </span><span class="annot"><a href="#local-6989586621684565405"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeSpec"><span class="hs-identifier hs-type">TypeSpec</span></a></span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684565379"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565379"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684565378"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565378"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-534"></span><span>      </span><span class="annot"><span class="annottext">Namespace
-&gt; Name
-&gt; SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
-&gt; m (Map (Namespace, Name) SrcLoc)
forall {m :: * -&gt; *}.
MonadTypeChecker m =&gt;
Namespace
-&gt; Name
-&gt; SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
-&gt; m (Map (Namespace, Name) SrcLoc)
</span><a href="#local-6989586621684565396"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565379"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565378"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-535"></span><span>    </span><span class="annot"><a href="#local-6989586621684565405"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModSpec"><span class="hs-identifier hs-type">ModSpec</span></a></span><span> </span><span id="local-6989586621684565377"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565377"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">SigExpBase f Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684565376"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565376"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-536"></span><span>      </span><span class="annot"><span class="annottext">Namespace
-&gt; Name
-&gt; SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
-&gt; m (Map (Namespace, Name) SrcLoc)
forall {m :: * -&gt; *}.
MonadTypeChecker m =&gt;
Namespace
-&gt; Name
-&gt; SrcLoc
-&gt; Map (Namespace, Name) SrcLoc
-&gt; m (Map (Namespace, Name) SrcLoc)
</span><a href="#local-6989586621684565396"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565377"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565376"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-537"></span><span>    </span><span class="annot"><a href="#local-6989586621684565405"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#IncludeSpec"><span class="hs-identifier hs-type">IncludeSpec</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-538"></span><span>      </span><span class="annot"><span class="annottext">Map (Namespace, Name) SrcLoc -&gt; m (Map (Namespace, Name) SrcLoc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-539"></span><span>
</span><span id="line-540"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkTypeBind"><span class="hs-identifier hs-type">checkTypeBind</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-541"></span><span>  </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeBindBase"><span class="hs-identifier hs-type">TypeBindBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-542"></span><span>  </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Semantic.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeBindBase"><span class="hs-identifier hs-type">TypeBindBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-543"></span><span id="checkTypeBind"><span class="annot"><span class="annottext">checkTypeBind :: TypeBindBase NoInfo Name -&gt; TypeM (Env, TypeBindBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkTypeBind"><span class="hs-identifier hs-var hs-var">checkTypeBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span> </span><span id="local-6989586621684565375"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565375"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621684565374"><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684565374"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621684565373"><span class="annot"><span class="annottext">[TypeParamBase Name]
</span><a href="#local-6989586621684565373"><span class="hs-identifier hs-var">tps</span></a></span></span><span> </span><span id="local-6989586621684565372"><span class="annot"><span class="annottext">TypeExp Name
</span><a href="#local-6989586621684565372"><span class="hs-identifier hs-var">te</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo StructRetType
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684565371"><span class="annot"><span class="annottext">Maybe DocComment
</span><a href="#local-6989586621684565371"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span id="local-6989586621684565370"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565370"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-544"></span><span>  </span><span class="annot"><span class="annottext">[TypeParamBase Name]
-&gt; ([TypeParamBase VName] -&gt; TypeM (Env, TypeBindBase Info VName))
-&gt; TypeM (Env, TypeBindBase Info VName)
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
[TypeParamBase Name] -&gt; ([TypeParamBase VName] -&gt; m a) -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Types.html#checkTypeParams"><span class="hs-identifier hs-var">checkTypeParams</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase Name]
</span><a href="#local-6989586621684565373"><span class="hs-identifier hs-var">tps</span></a></span><span> </span><span class="annot"><span class="annottext">(([TypeParamBase VName] -&gt; TypeM (Env, TypeBindBase Info VName))
 -&gt; TypeM (Env, TypeBindBase Info VName))
-&gt; ([TypeParamBase VName] -&gt; TypeM (Env, TypeBindBase Info VName))
-&gt; TypeM (Env, TypeBindBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621684565369"><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565369"><span class="hs-identifier hs-var">tps'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-545"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684565368"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565368"><span class="hs-identifier hs-var">te'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565367"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684565367"><span class="hs-identifier hs-var">svars</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-type">RetType</span></a></span><span> </span><span id="local-6989586621684565366"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684565366"><span class="hs-identifier hs-var">dims</span></a></span></span><span> </span><span id="local-6989586621684565365"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565365"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565364"><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684565364"><span class="hs-identifier hs-var">l'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
-&gt; TypeM (TypeExp VName, [VName], StructRetType, Liftedness)
-&gt; TypeM (TypeExp VName, [VName], StructRetType, Liftedness)
forall a. [TypeParamBase VName] -&gt; TypeM a -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.html#bindingTypeParams"><span class="hs-identifier hs-var">bindingTypeParams</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565369"><span class="hs-identifier hs-var">tps'</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeM (TypeExp VName, [VName], StructRetType, Liftedness)
 -&gt; TypeM (TypeExp VName, [VName], StructRetType, Liftedness))
-&gt; TypeM (TypeExp VName, [VName], StructRetType, Liftedness)
-&gt; TypeM (TypeExp VName, [VName], StructRetType, Liftedness)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeExp Name
-&gt; TypeM (TypeExp VName, [VName], StructRetType, Liftedness)
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
TypeExp Name
-&gt; m (TypeExp VName, [VName], StructRetType, Liftedness)
</span><a href="Language.Futhark.TypeChecker.Types.html#checkTypeExp"><span class="hs-identifier hs-var">checkTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp Name
</span><a href="#local-6989586621684565372"><span class="hs-identifier hs-var">te</span></a></span><span>
</span><span id="line-546"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684565363"><span class="annot"><span class="annottext">elab_t :: StructRetType
</span><a href="#local-6989586621684565363"><span class="hs-identifier hs-var hs-var">elab_t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; StructType -&gt; StructRetType
forall dim as. [VName] -&gt; TypeBase dim as -&gt; RetTypeBase dim as
</span><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-var">RetType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684565367"><span class="hs-identifier hs-var">svars</span></a></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; [VName] -&gt; [VName]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684565366"><span class="hs-identifier hs-var">dims</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565365"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684565362"><span class="annot"><span class="annottext">used_dims :: Set VName
</span><a href="#local-6989586621684565362"><span class="hs-identifier hs-var hs-var">used_dims</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StructType -&gt; Set VName
forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="Language.Futhark.Prop.html#typeDimNames"><span class="hs-identifier hs-var">typeDimNames</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565365"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-549"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(TypeParamBase VName -&gt; Bool)
-&gt; [TypeParamBase VName] -&gt; [TypeParamBase VName]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">VName -&gt; Set VName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.notMember`</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684565362"><span class="hs-identifier hs-var">used_dims</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(VName -&gt; Bool)
-&gt; (TypeParamBase VName -&gt; VName) -&gt; TypeParamBase VName -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TypeParamBase VName -&gt; VName
forall vn. TypeParamBase vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#typeParamName"><span class="hs-identifier hs-var">typeParamName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TypeParamBase VName] -&gt; [TypeParamBase VName])
-&gt; [TypeParamBase VName] -&gt; [TypeParamBase VName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-550"></span><span>      </span><span class="annot"><span class="annottext">(TypeParamBase VName -&gt; Bool)
-&gt; [TypeParamBase VName] -&gt; [TypeParamBase VName]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">TypeParamBase VName -&gt; Bool
forall vn. TypeParamBase vn -&gt; Bool
</span><a href="Language.Futhark.Prop.html#isSizeParam"><span class="hs-identifier hs-var">isSizeParam</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565369"><span class="hs-identifier hs-var">tps'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-551"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TypeM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span>      </span><span id="local-6989586621684565357"><span class="annot"><span class="annottext">TypeParamBase VName
</span><a href="#local-6989586621684565357"><span class="hs-identifier hs-var">tp</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-553"></span><span>        </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565370"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TypeM ()) -&gt; Doc -&gt; TypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-554"></span><span>          </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Size parameter&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeParamBase VName -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">TypeParamBase VName
</span><a href="#local-6989586621684565357"><span class="hs-identifier hs-var">tp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;unused.&quot;</span></span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684565374"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684565364"><span class="hs-identifier hs-var">l'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-557"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Liftedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><a href="Language.Futhark.Syntax.html#Lifted"><span class="hs-identifier hs-var">Lifted</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-558"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684565374"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Liftedness -&gt; Liftedness -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><a href="Language.Futhark.Syntax.html#Lifted"><span class="hs-identifier hs-var">Lifted</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-559"></span><span>          </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565370"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TypeM ()) -&gt; Doc -&gt; TypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-560"></span><span>            </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Non-lifted type abbreviations may not contain functions.&quot;</span></span><span>
</span><span id="line-561"></span><span>              </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Hint: consider using 'type^'.&quot;</span></span><span>
</span><span id="line-562"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Liftedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><a href="Language.Futhark.Syntax.html#SizeLifted"><span class="hs-identifier hs-var">SizeLifted</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684565374"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Liftedness -&gt; Liftedness -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><a href="Language.Futhark.Syntax.html#SizeLifted"><span class="hs-identifier hs-var">SizeLifted</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-564"></span><span>          </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565370"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TypeM ()) -&gt; Doc -&gt; TypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-565"></span><span>            </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Non-size-lifted type abbreviations may not contain size-lifted types.&quot;</span></span><span>
</span><span id="line-566"></span><span>              </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Hint: consider using 'type~'.&quot;</span></span><span>
</span><span id="line-567"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Liftedness
</span><a href="Language.Futhark.Syntax.html#Unlifted"><span class="hs-identifier hs-var">Unlifted</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-568"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">([VName] -&gt; Bool) -&gt; [VName] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684565367"><span class="hs-identifier hs-var">svars</span></a></span><span> </span><span class="annot"><span class="annottext">[VName] -&gt; [VName] -&gt; [VName]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684565366"><span class="hs-identifier hs-var">dims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-569"></span><span>          </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565370"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TypeM ()) -&gt; Doc -&gt; TypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-570"></span><span>            </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Non-lifted type abbreviations may not use existential sizes in their definition.&quot;</span></span><span>
</span><span id="line-571"></span><span>              </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Hint: use 'type~' or add size parameters to&quot;</span></span><span>
</span><span id="line-572"></span><span>              </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc
</span><a href="Language.Futhark.Core.html#pquote"><span class="hs-identifier hs-var">pquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Doc
forall v. IsName v =&gt; v -&gt; Doc
</span><a href="Language.Futhark.Pretty.html#pprName"><span class="hs-identifier hs-var">pprName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565375"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-573"></span><span>      </span><span class="annot"><span class="annottext">(Liftedness, Liftedness)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TypeM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span>
</span><span id="line-575"></span><span>    </span><span class="annot"><span class="annottext">[(Namespace, Name)]
-&gt; TypeM (Env, TypeBindBase Info VName)
-&gt; TypeM (Env, TypeBindBase Info VName)
forall (m :: * -&gt; *) a.
MonadTypeChecker m =&gt;
[(Namespace, Name)] -&gt; m a -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#bindSpaced"><span class="hs-identifier hs-var">bindSpaced</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565375"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TypeM (Env, TypeBindBase Info VName)
 -&gt; TypeM (Env, TypeBindBase Info VName))
-&gt; TypeM (Env, TypeBindBase Info VName)
-&gt; TypeM (Env, TypeBindBase Info VName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-576"></span><span>      </span><span id="local-6989586621684565351"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565351"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Namespace -&gt; Name -&gt; SrcLoc -&gt; TypeM VName
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
Namespace -&gt; Name -&gt; SrcLoc -&gt; m VName
</span><a href="Language.Futhark.TypeChecker.Monad.html#checkName"><span class="hs-identifier hs-var">checkName</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565375"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565370"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-577"></span><span>      </span><span class="annot"><span class="annottext">(Env, TypeBindBase Info VName)
-&gt; TypeM (Env, TypeBindBase Info VName)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-578"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Env
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-579"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">envTypeTable :: Map VName TypeBinding
</span><a href="Language.Futhark.Semantic.html#envTypeTable"><span class="hs-identifier hs-var">envTypeTable</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-580"></span><span>                </span><span class="annot"><span class="annottext">VName -&gt; TypeBinding -&gt; Map VName TypeBinding
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565351"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBinding -&gt; Map VName TypeBinding)
-&gt; TypeBinding -&gt; Map VName TypeBinding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Liftedness -&gt; [TypeParamBase VName] -&gt; StructRetType -&gt; TypeBinding
</span><a href="Language.Futhark.Semantic.html#TypeAbbr"><span class="hs-identifier hs-var">TypeAbbr</span></a></span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684565374"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565369"><span class="hs-identifier hs-var">tps'</span></a></span><span> </span><span class="annot"><span class="annottext">StructRetType
</span><a href="#local-6989586621684565363"><span class="hs-identifier hs-var">elab_t</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-581"></span><span>              </span><span class="annot"><span class="annottext">envNameMap :: NameMap
</span><a href="Language.Futhark.Semantic.html#envNameMap"><span class="hs-identifier hs-var">envNameMap</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-582"></span><span>                </span><span class="annot"><span class="annottext">(Namespace, Name) -&gt; QualName VName -&gt; NameMap
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565375"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QualName VName -&gt; NameMap) -&gt; QualName VName -&gt; NameMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565351"><span class="hs-identifier hs-var">name'</span></a></span><span>
</span><span id="line-583"></span><span>            </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-584"></span><span>          </span><span class="annot"><span class="annottext">VName
-&gt; Liftedness
-&gt; [TypeParamBase VName]
-&gt; TypeExp VName
-&gt; Info StructRetType
-&gt; Maybe DocComment
-&gt; SrcLoc
-&gt; TypeBindBase Info VName
forall (f :: * -&gt; *) vn.
vn
-&gt; Liftedness
-&gt; [TypeParamBase vn]
-&gt; TypeExp vn
-&gt; f StructRetType
-&gt; Maybe DocComment
-&gt; SrcLoc
-&gt; TypeBindBase f vn
</span><a href="Language.Futhark.Syntax.html#TypeBind"><span class="hs-identifier hs-var">TypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565351"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">Liftedness
</span><a href="#local-6989586621684565374"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565369"><span class="hs-identifier hs-var">tps'</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565368"><span class="hs-identifier hs-var">te'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StructRetType -&gt; Info StructRetType
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">StructRetType
</span><a href="#local-6989586621684565363"><span class="hs-identifier hs-var">elab_t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><a href="#local-6989586621684565371"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565370"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-585"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span>
</span><span id="line-587"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#entryPoint"><span class="hs-identifier hs-type">entryPoint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeExp"><span class="hs-identifier hs-type">TypeExp</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#StructRetType"><span class="hs-identifier hs-type">StructRetType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#EntryPoint"><span class="hs-identifier hs-type">EntryPoint</span></a></span><span>
</span><span id="line-588"></span><span id="entryPoint"><span class="annot"><span class="annottext">entryPoint :: [Pat] -&gt; Maybe (TypeExp VName) -&gt; StructRetType -&gt; EntryPoint
</span><a href="Language.Futhark.TypeChecker.html#entryPoint"><span class="hs-identifier hs-var hs-var">entryPoint</span></a></span></span><span> </span><span id="local-6989586621684565349"><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621684565349"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621684565348"><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684565348"><span class="hs-identifier hs-var">orig_ret_te</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-type">RetType</span></a></span><span> </span><span id="local-6989586621684565347"><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684565347"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span id="local-6989586621684565346"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565346"><span class="hs-identifier hs-var">orig_ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-589"></span><span>  </span><span class="annot"><span class="annottext">[EntryParam] -&gt; EntryType -&gt; EntryPoint
</span><a href="Language.Futhark.Syntax.html#EntryPoint"><span class="hs-identifier hs-var">EntryPoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Pat -&gt; EntryParam) -&gt; [Pat] -&gt; [EntryParam]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; EntryParam
</span><a href="#local-6989586621684565344"><span class="hs-identifier hs-var">patternEntry</span></a></span><span> </span><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621684565349"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">[EntryParam] -&gt; [EntryParam] -&gt; [EntryParam]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[EntryParam]
</span><a href="#local-6989586621684565343"><span class="hs-identifier hs-var">more_params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EntryType
</span><a href="#local-6989586621684565342"><span class="hs-identifier hs-var">rettype'</span></a></span><span>
</span><span id="line-590"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-591"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621684565343"><span class="annot"><span class="annottext">[EntryParam]
</span><a href="#local-6989586621684565343"><span class="hs-identifier hs-var">more_params</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565342"><span class="annot"><span class="annottext">EntryType
</span><a href="#local-6989586621684565342"><span class="hs-identifier hs-var">rettype'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName) -&gt; StructType -&gt; ([EntryParam], EntryType)
</span><a href="#local-6989586621684565339"><span class="hs-identifier hs-var">onRetType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684565348"><span class="hs-identifier hs-var">orig_ret_te</span></a></span><span> </span><span class="annot"><span class="annottext">(StructType -&gt; ([EntryParam], EntryType))
-&gt; StructType -&gt; ([EntryParam], EntryType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DimDecl VName -&gt; DimDecl VName) -&gt; StructType -&gt; StructType
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">DimDecl VName -&gt; DimDecl VName
</span><a href="#local-6989586621684565338"><span class="hs-identifier hs-var">extToAny</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565346"><span class="hs-identifier hs-var">orig_ret</span></a></span><span>
</span><span id="line-592"></span><span>
</span><span id="line-593"></span><span>    </span><span class="hs-comment">-- Since the entry point type is not a RetType but just a plain</span><span>
</span><span id="line-594"></span><span>    </span><span class="hs-comment">-- StructType, we have to remove any existentially bound sizes.</span><span>
</span><span id="line-595"></span><span>    </span><span id="local-6989586621684565338"><span class="annot"><span class="annottext">extToAny :: DimDecl VName -&gt; DimDecl VName
</span><a href="#local-6989586621684565338"><span class="hs-identifier hs-var hs-var">extToAny</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#NamedDim"><span class="hs-identifier hs-type">NamedDim</span></a></span><span> </span><span id="local-6989586621684565334"><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684565334"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QualName VName -&gt; VName
forall vn. QualName vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#qualLeaf"><span class="hs-identifier hs-var hs-var">qualLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">QualName VName
</span><a href="#local-6989586621684565334"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">VName -&gt; [VName] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><a href="#local-6989586621684565347"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe VName -&gt; DimDecl VName
forall vn. Maybe vn -&gt; DimDecl vn
</span><a href="Language.Futhark.Syntax.html#AnyDim"><span class="hs-identifier hs-var">AnyDim</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe VName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-596"></span><span>    </span><span class="annot"><a href="#local-6989586621684565338"><span class="hs-identifier hs-var">extToAny</span></a></span><span> </span><span id="local-6989586621684565331"><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684565331"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DimDecl VName
</span><a href="#local-6989586621684565331"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-597"></span><span>
</span><span id="line-598"></span><span>    </span><span id="local-6989586621684565344"><span class="annot"><span class="annottext">patternEntry :: Pat -&gt; EntryParam
</span><a href="#local-6989586621684565344"><span class="hs-identifier hs-var hs-var">patternEntry</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatParens"><span class="hs-identifier hs-type">PatParens</span></a></span><span> </span><span id="local-6989586621684565329"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684565329"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-599"></span><span>      </span><span class="annot"><span class="annottext">Pat -&gt; EntryParam
</span><a href="#local-6989586621684565344"><span class="hs-identifier hs-var">patternEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684565329"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-600"></span><span>    </span><span class="annot"><a href="#local-6989586621684565344"><span class="hs-identifier hs-var">patternEntry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatAscription"><span class="hs-identifier hs-type">PatAscription</span></a></span><span> </span><span id="local-6989586621684565327"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684565327"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621684565326"><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684565326"><span class="hs-identifier hs-var">tdecl</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-601"></span><span>      </span><span class="annot"><span class="annottext">Name -&gt; EntryType -&gt; EntryParam
</span><a href="Language.Futhark.Syntax.html#EntryParam"><span class="hs-identifier hs-var">EntryParam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat -&gt; Name
forall {f :: * -&gt; *}. PatBase f VName -&gt; Name
</span><a href="#local-6989586621684565324"><span class="hs-identifier hs-var">patternName</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684565327"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(EntryType -&gt; EntryParam) -&gt; EntryType -&gt; EntryParam
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-602"></span><span>        </span><span class="annot"><span class="annottext">StructType -&gt; Maybe (TypeExp VName) -&gt; EntryType
</span><a href="Language.Futhark.Syntax.html#EntryType"><span class="hs-identifier hs-var">EntryType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Info StructType -&gt; StructType
forall a. Info a -&gt; a
</span><a href="Language.Futhark.Syntax.html#unInfo"><span class="hs-identifier hs-var hs-var">unInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeDeclBase Info VName -&gt; Info StructType
forall (f :: * -&gt; *) vn. TypeDeclBase f vn -&gt; f StructType
</span><a href="Language.Futhark.Syntax.html#expandedType"><span class="hs-identifier hs-var hs-var">expandedType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684565326"><span class="hs-identifier hs-var">tdecl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeExp VName -&gt; Maybe (TypeExp VName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeDeclBase Info VName -&gt; TypeExp VName
forall (f :: * -&gt; *) vn. TypeDeclBase f vn -&gt; TypeExp vn
</span><a href="Language.Futhark.Syntax.html#declaredType"><span class="hs-identifier hs-var hs-var">declaredType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeDeclBase Info VName
</span><a href="#local-6989586621684565326"><span class="hs-identifier hs-var">tdecl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>    </span><span class="annot"><a href="#local-6989586621684565344"><span class="hs-identifier hs-var">patternEntry</span></a></span><span> </span><span id="local-6989586621684565321"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684565321"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-604"></span><span>      </span><span class="annot"><span class="annottext">Name -&gt; EntryType -&gt; EntryParam
</span><a href="Language.Futhark.Syntax.html#EntryParam"><span class="hs-identifier hs-var">EntryParam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat -&gt; Name
forall {f :: * -&gt; *}. PatBase f VName -&gt; Name
</span><a href="#local-6989586621684565324"><span class="hs-identifier hs-var">patternName</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684565321"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(EntryType -&gt; EntryParam) -&gt; EntryType -&gt; EntryParam
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-605"></span><span>        </span><span class="annot"><span class="annottext">StructType -&gt; Maybe (TypeExp VName) -&gt; EntryType
</span><a href="Language.Futhark.Syntax.html#EntryType"><span class="hs-identifier hs-var">EntryType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat -&gt; StructType
</span><a href="Language.Futhark.Prop.html#patternStructType"><span class="hs-identifier hs-var">patternStructType</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684565321"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-606"></span><span>
</span><span id="line-607"></span><span>    </span><span id="local-6989586621684565324"><span class="annot"><span class="annottext">patternName :: PatBase f VName -&gt; Name
</span><a href="#local-6989586621684565324"><span class="hs-identifier hs-var hs-var">patternName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span id="local-6989586621684565316"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565316"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">f PatType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Name
</span><a href="Language.Futhark.Core.html#baseName"><span class="hs-identifier hs-var">baseName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565316"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-608"></span><span>    </span><span class="annot"><a href="#local-6989586621684565324"><span class="hs-identifier hs-var">patternName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatParens"><span class="hs-identifier hs-type">PatParens</span></a></span><span> </span><span id="local-6989586621684565315"><span class="annot"><span class="annottext">PatBase f VName
</span><a href="#local-6989586621684565315"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatBase f VName -&gt; Name
</span><a href="#local-6989586621684565324"><span class="hs-identifier hs-var">patternName</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase f VName
</span><a href="#local-6989586621684565315"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-609"></span><span>    </span><span class="annot"><a href="#local-6989586621684565324"><span class="hs-identifier hs-var">patternName</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase f VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;_&quot;</span></span><span>
</span><span id="line-610"></span><span>
</span><span id="line-611"></span><span>    </span><span id="local-6989586621684565313"><span class="annot"><span class="annottext">pname :: PName -&gt; Name
</span><a href="#local-6989586621684565313"><span class="hs-identifier hs-var hs-var">pname</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span id="local-6989586621684565311"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565311"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VName -&gt; Name
</span><a href="Language.Futhark.Core.html#baseName"><span class="hs-identifier hs-var">baseName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565311"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-612"></span><span>    </span><span class="annot"><a href="#local-6989586621684565313"><span class="hs-identifier hs-var">pname</span></a></span><span> </span><span class="annot"><span class="annottext">PName
</span><a href="Language.Futhark.Syntax.html#Unnamed"><span class="hs-identifier hs-var">Unnamed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;_&quot;</span></span><span>
</span><span id="line-613"></span><span>    </span><span id="local-6989586621684565339"><span class="annot"><span class="annottext">onRetType :: Maybe (TypeExp VName) -&gt; StructType -&gt; ([EntryParam], EntryType)
</span><a href="#local-6989586621684565339"><span class="hs-identifier hs-var hs-var">onRetType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TEArrow"><span class="hs-identifier hs-type">TEArrow</span></a></span><span> </span><span id="local-6989586621684565307"><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684565307"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621684565306"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565306"><span class="hs-identifier hs-var">t1_te</span></a></span></span><span> </span><span id="local-6989586621684565305"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565305"><span class="hs-identifier hs-var">t2_te</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-type">Arrow</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684565303"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565303"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-type">RetType</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684565302"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565302"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-614"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684565301"><span class="annot"><span class="annottext">[EntryParam]
</span><a href="#local-6989586621684565301"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565300"><span class="annot"><span class="annottext">EntryType
</span><a href="#local-6989586621684565300"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName) -&gt; StructType -&gt; ([EntryParam], EntryType)
</span><a href="#local-6989586621684565339"><span class="hs-identifier hs-var">onRetType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeExp VName -&gt; Maybe (TypeExp VName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565305"><span class="hs-identifier hs-var">t2_te</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565302"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-615"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; EntryType -&gt; EntryParam
</span><a href="Language.Futhark.Syntax.html#EntryParam"><span class="hs-identifier hs-var">EntryParam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; (VName -&gt; Name) -&gt; Maybe VName -&gt; Name
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; Name
</span><a href="Language.Futhark.Core.html#baseName"><span class="hs-identifier hs-var">baseName</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe VName
</span><a href="#local-6989586621684565307"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StructType -&gt; Maybe (TypeExp VName) -&gt; EntryType
</span><a href="Language.Futhark.Syntax.html#EntryType"><span class="hs-identifier hs-var">EntryType</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565303"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeExp VName -&gt; Maybe (TypeExp VName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565306"><span class="hs-identifier hs-var">t1_te</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EntryParam -&gt; [EntryParam] -&gt; [EntryParam]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[EntryParam]
</span><a href="#local-6989586621684565301"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EntryType
</span><a href="#local-6989586621684565300"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-616"></span><span>    </span><span class="annot"><a href="#local-6989586621684565339"><span class="hs-identifier hs-var">onRetType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-type">Arrow</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684565298"><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684565298"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621684565297"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565297"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-type">RetType</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684565296"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565296"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-617"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684565295"><span class="annot"><span class="annottext">[EntryParam]
</span><a href="#local-6989586621684565295"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565294"><span class="annot"><span class="annottext">EntryType
</span><a href="#local-6989586621684565294"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName) -&gt; StructType -&gt; ([EntryParam], EntryType)
</span><a href="#local-6989586621684565339"><span class="hs-identifier hs-var">onRetType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565296"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-618"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; EntryType -&gt; EntryParam
</span><a href="Language.Futhark.Syntax.html#EntryParam"><span class="hs-identifier hs-var">EntryParam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PName -&gt; Name
</span><a href="#local-6989586621684565313"><span class="hs-identifier hs-var">pname</span></a></span><span> </span><span class="annot"><span class="annottext">PName
</span><a href="#local-6989586621684565298"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StructType -&gt; Maybe (TypeExp VName) -&gt; EntryType
</span><a href="Language.Futhark.Syntax.html#EntryType"><span class="hs-identifier hs-var">EntryType</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565297"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EntryParam -&gt; [EntryParam] -&gt; [EntryParam]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[EntryParam]
</span><a href="#local-6989586621684565295"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EntryType
</span><a href="#local-6989586621684565294"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-619"></span><span>    </span><span class="annot"><a href="#local-6989586621684565339"><span class="hs-identifier hs-var">onRetType</span></a></span><span> </span><span id="local-6989586621684565293"><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684565293"><span class="hs-identifier hs-var">te</span></a></span></span><span> </span><span id="local-6989586621684565292"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565292"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-620"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StructType -&gt; Maybe (TypeExp VName) -&gt; EntryType
</span><a href="Language.Futhark.Syntax.html#EntryType"><span class="hs-identifier hs-var">EntryType</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565292"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684565293"><span class="hs-identifier hs-var">te</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span>
</span><span id="line-622"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#entryPointNameIsAcceptable"><span class="hs-identifier hs-type">entryPointNameIsAcceptable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-623"></span><span id="entryPointNameIsAcceptable"><span class="annot"><span class="annottext">entryPointNameIsAcceptable :: Name -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#entryPointNameIsAcceptable"><span class="hs-identifier hs-var hs-var">entryPointNameIsAcceptable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Bool
</span><a href="#local-6989586621684565290"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Bool) -&gt; (Name -&gt; [Char]) -&gt; Name -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Char]
</span><a href="Language.Futhark.Core.html#nameToString"><span class="hs-identifier hs-var">nameToString</span></a></span><span>
</span><span id="line-624"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-625"></span><span>    </span><span id="local-6989586621684565290"><span class="annot"><span class="annottext">check :: [Char] -&gt; Bool
</span><a href="#local-6989586621684565290"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-comment">-- academic</span><span>
</span><span id="line-626"></span><span>    </span><span class="annot"><a href="#local-6989586621684565290"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684565287"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621684565287"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684565286"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684565286"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isAlpha</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621684565287"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; [Char] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="#local-6989586621684565284"><span class="hs-identifier hs-var">constituent</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684565286"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-627"></span><span>    </span><span id="local-6989586621684565284"><span class="annot"><span class="annottext">constituent :: Char -&gt; Bool
</span><a href="#local-6989586621684565284"><span class="hs-identifier hs-var hs-var">constituent</span></a></span></span><span> </span><span id="local-6989586621684565282"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621684565282"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isAlphaNum</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621684565282"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621684565282"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'_'</span></span><span>
</span><span id="line-628"></span><span>
</span><span id="line-629"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkValBind"><span class="hs-identifier hs-type">checkValBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#ValBindBase"><span class="hs-identifier hs-type">ValBindBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Semantic.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.html#ValBind"><span class="hs-identifier hs-type">ValBind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-630"></span><span id="checkValBind"><span class="annot"><span class="annottext">checkValBind :: ValBindBase NoInfo Name -&gt; TypeM (Env, ValBind)
</span><a href="Language.Futhark.TypeChecker.html#checkValBind"><span class="hs-identifier hs-var hs-var">checkValBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ValBind"><span class="hs-identifier hs-type">ValBind</span></a></span><span> </span><span id="local-6989586621684565278"><span class="annot"><span class="annottext">Maybe (NoInfo EntryPoint)
</span><a href="#local-6989586621684565278"><span class="hs-identifier hs-var">entry</span></a></span></span><span> </span><span id="local-6989586621684565277"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565277"><span class="hs-identifier hs-var">fname</span></a></span></span><span> </span><span id="local-6989586621684565276"><span class="annot"><span class="annottext">Maybe (TypeExp Name)
</span><a href="#local-6989586621684565276"><span class="hs-identifier hs-var">maybe_tdecl</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo StructRetType
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684565275"><span class="annot"><span class="annottext">[TypeParamBase Name]
</span><a href="#local-6989586621684565275"><span class="hs-identifier hs-var">tparams</span></a></span></span><span> </span><span id="local-6989586621684565274"><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684565274"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621684565273"><span class="annot"><span class="annottext">UncheckedExp
</span><a href="#local-6989586621684565273"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621684565272"><span class="annot"><span class="annottext">Maybe DocComment
</span><a href="#local-6989586621684565272"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span id="local-6989586621684565271"><span class="annot"><span class="annottext">[AttrInfo Name]
</span><a href="#local-6989586621684565271"><span class="hs-identifier hs-var">attrs</span></a></span></span><span> </span><span id="local-6989586621684565270"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565270"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-631"></span><span>  </span><span id="local-6989586621684565269"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684565269"><span class="hs-identifier hs-var">top_level</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeM Bool
</span><a href="Language.Futhark.TypeChecker.Monad.html#atTopLevel"><span class="hs-identifier hs-var">atTopLevel</span></a></span><span>
</span><span id="line-632"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TypeM () -&gt; TypeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621684565269"><span class="hs-identifier hs-var">top_level</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (NoInfo EntryPoint) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe (NoInfo EntryPoint)
</span><a href="#local-6989586621684565278"><span class="hs-identifier hs-var">entry</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TypeM () -&gt; TypeM ()) -&gt; TypeM () -&gt; TypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-633"></span><span>    </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565270"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TypeM ()) -&gt; Doc -&gt; TypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-634"></span><span>      </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><a href="Language.Futhark.TypeChecker.Monad.html#withIndexLink"><span class="hs-identifier hs-var">withIndexLink</span></a></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;nested-entry&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Entry points may not be declared inside modules.&quot;</span></span><span>
</span><span id="line-635"></span><span>
</span><span id="line-636"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565265"><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565265"><span class="hs-identifier hs-var">fname'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565264"><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565264"><span class="hs-identifier hs-var">tparams'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565263"><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621684565263"><span class="hs-identifier hs-var">params'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565262"><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684565262"><span class="hs-identifier hs-var">maybe_tdecl'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565261"><span class="annot"><span class="annottext">rettype :: StructRetType
</span><a href="#local-6989586621684565261"><span class="hs-identifier hs-var">rettype</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-type">RetType</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684565260"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565260"><span class="hs-identifier hs-var">rettype_t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565259"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684565259"><span class="hs-identifier hs-var">body'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-637"></span><span>    </span><span class="annot"><span class="annottext">(Name, Maybe (TypeExp Name), [TypeParamBase Name],
 [PatBase NoInfo Name], UncheckedExp, SrcLoc)
-&gt; TypeM
     (VName, [TypeParamBase VName], [Pat], Maybe (TypeExp VName),
      StructRetType, Exp)
</span><a href="Language.Futhark.TypeChecker.Terms.html#checkFunDef"><span class="hs-identifier hs-var">checkFunDef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565277"><span class="hs-identifier hs-var">fname</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp Name)
</span><a href="#local-6989586621684565276"><span class="hs-identifier hs-var">maybe_tdecl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TypeParamBase Name]
</span><a href="#local-6989586621684565275"><span class="hs-identifier hs-var">tparams</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PatBase NoInfo Name]
</span><a href="#local-6989586621684565274"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UncheckedExp
</span><a href="#local-6989586621684565273"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565270"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621684565257"><span class="annot"><span class="annottext">[StructType]
</span><a href="#local-6989586621684565257"><span class="hs-identifier hs-var">rettype_params</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565256"><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565256"><span class="hs-identifier hs-var">rettype'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StructType -&gt; ([StructType], StructType)
forall dim as.
TypeBase dim as -&gt; ([TypeBase dim as], TypeBase dim as)
</span><a href="Language.Futhark.Prop.html#unfoldFunType"><span class="hs-identifier hs-var">unfoldFunType</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565260"><span class="hs-identifier hs-var">rettype_t</span></a></span><span>
</span><span id="line-640"></span><span>      </span><span id="local-6989586621684565253"><span class="annot"><span class="annottext">entry' :: Maybe (Info EntryPoint)
</span><a href="#local-6989586621684565253"><span class="hs-identifier hs-var hs-var">entry'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntryPoint -&gt; Info EntryPoint
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Pat] -&gt; Maybe (TypeExp VName) -&gt; StructRetType -&gt; EntryPoint
</span><a href="Language.Futhark.TypeChecker.html#entryPoint"><span class="hs-identifier hs-var">entryPoint</span></a></span><span> </span><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621684565263"><span class="hs-identifier hs-var">params'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684565262"><span class="hs-identifier hs-var">maybe_tdecl'</span></a></span><span> </span><span class="annot"><span class="annottext">StructRetType
</span><a href="#local-6989586621684565261"><span class="hs-identifier hs-var">rettype</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Info EntryPoint
-&gt; Maybe (NoInfo EntryPoint) -&gt; Maybe (Info EntryPoint)
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Maybe (NoInfo EntryPoint)
</span><a href="#local-6989586621684565278"><span class="hs-identifier hs-var">entry</span></a></span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Info EntryPoint)
</span><a href="#local-6989586621684565253"><span class="hs-identifier hs-var">entry'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-643"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Info EntryPoint
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-644"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#entryPointNameIsAcceptable"><span class="hs-identifier hs-var">entryPointNameIsAcceptable</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565277"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-645"></span><span>        </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565270"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Entry point names must start with a letter and contain only letters, digits, and underscores.&quot;</span></span><span>
</span><span id="line-646"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(TypeParamBase VName -&gt; Bool) -&gt; [TypeParamBase VName] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">TypeParamBase VName -&gt; Bool
forall vn. TypeParamBase vn -&gt; Bool
</span><a href="Language.Futhark.Prop.html#isTypeParam"><span class="hs-identifier hs-var">isTypeParam</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565264"><span class="hs-identifier hs-var">tparams'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-647"></span><span>        </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565270"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Entry point functions may not be polymorphic.&quot;</span></span><span>
</span><span id="line-648"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Pat -&gt; Bool) -&gt; [Pat] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; Bool
forall vn. PatBase Info vn -&gt; Bool
</span><a href="Language.Futhark.Prop.html#patternOrderZero"><span class="hs-identifier hs-var">patternOrderZero</span></a></span><span> </span><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621684565263"><span class="hs-identifier hs-var">params'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-649"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(StructType -&gt; Bool) -&gt; [StructType] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">StructType -&gt; Bool
forall dim as. TypeBase dim as -&gt; Bool
</span><a href="Language.Futhark.Prop.html#orderZero"><span class="hs-identifier hs-var">orderZero</span></a></span><span> </span><span class="annot"><span class="annottext">[StructType]
</span><a href="#local-6989586621684565257"><span class="hs-identifier hs-var">rettype_params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-650"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StructType -&gt; Bool
forall dim as. TypeBase dim as -&gt; Bool
</span><a href="Language.Futhark.Prop.html#orderZero"><span class="hs-identifier hs-var">orderZero</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565256"><span class="hs-identifier hs-var">rettype'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-651"></span><span>        </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565270"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Entry point functions may not be higher-order.&quot;</span></span><span>
</span><span id="line-652"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621684565247"><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684565247"><span class="hs-identifier hs-var">sizes_only_in_ret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-653"></span><span>          </span><span class="annot"><span class="annottext">[VName] -&gt; Set VName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeParamBase VName -&gt; VName) -&gt; [TypeParamBase VName] -&gt; [VName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TypeParamBase VName -&gt; VName
forall vn. TypeParamBase vn -&gt; vn
</span><a href="Language.Futhark.Syntax.html#typeParamName"><span class="hs-identifier hs-var">typeParamName</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565264"><span class="hs-identifier hs-var">tparams'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-654"></span><span>            </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`S.intersection`</span></span><span> </span><span class="annot"><span class="annottext">StructType -&gt; Set VName
forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="Language.Futhark.Prop.html#typeDimNames"><span class="hs-identifier hs-var">typeDimNames</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565256"><span class="hs-identifier hs-var">rettype'</span></a></span><span>
</span><span id="line-655"></span><span>            </span><span class="annot"><span class="annottext">Set VName -&gt; Set VName -&gt; Set VName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`S.difference`</span></span><span> </span><span class="annot"><span class="annottext">(StructType -&gt; Set VName) -&gt; [StructType] -&gt; Set VName
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">StructType -&gt; Set VName
forall als. TypeBase (DimDecl VName) als -&gt; Set VName
</span><a href="Language.Futhark.Prop.html#typeDimNames"><span class="hs-identifier hs-var">typeDimNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Pat -&gt; StructType) -&gt; [Pat] -&gt; [StructType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; StructType
</span><a href="Language.Futhark.Prop.html#patternStructType"><span class="hs-identifier hs-var">patternStructType</span></a></span><span> </span><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621684565263"><span class="hs-identifier hs-var">params'</span></a></span><span> </span><span class="annot"><span class="annottext">[StructType] -&gt; [StructType] -&gt; [StructType]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[StructType]
</span><a href="#local-6989586621684565257"><span class="hs-identifier hs-var">rettype_params</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-656"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set VName -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">S.null</span></span><span> </span><span class="annot"><span class="annottext">Set VName
</span><a href="#local-6989586621684565247"><span class="hs-identifier hs-var">sizes_only_in_ret</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-657"></span><span>        </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565270"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Entry point functions must not be size-polymorphic in their return type.&quot;</span></span><span>
</span><span id="line-658"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621684565241"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684565241"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Pat]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Pat -&gt; Bool) -&gt; [Pat] -&gt; [Pat]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#nastyParameter"><span class="hs-identifier hs-var">nastyParameter</span></a></span><span> </span><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621684565263"><span class="hs-identifier hs-var">params'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-659"></span><span>        </span><span class="annot"><span class="annottext">SrcLoc -&gt; Doc -&gt; TypeM ()
forall (m :: * -&gt; *) loc.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Doc -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Monad.html#warn"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565270"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TypeM ()) -&gt; Doc -&gt; TypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-660"></span><span>          </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Entry point parameter\n&quot;</span></span><span>
</span><span id="line-661"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
</span><span class="hs-identifier hs-var">indent</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684565241"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-662"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;\nwill have an opaque type, so the entry point will likely not be callable.&quot;</span></span><span>
</span><span id="line-663"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName) -&gt; StructType -&gt; Bool
forall als dim.
Monoid als =&gt;
Maybe (TypeExp VName) -&gt; TypeBase dim als -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#nastyReturnType"><span class="hs-identifier hs-var">nastyReturnType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684565262"><span class="hs-identifier hs-var">maybe_tdecl'</span></a></span><span> </span><span class="annot"><span class="annottext">StructType
</span><a href="#local-6989586621684565260"><span class="hs-identifier hs-var">rettype_t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-664"></span><span>        </span><span class="annot"><span class="annottext">SrcLoc -&gt; Doc -&gt; TypeM ()
forall (m :: * -&gt; *) loc.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Doc -&gt; m ()
</span><a href="Language.Futhark.TypeChecker.Monad.html#warn"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565270"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TypeM ()) -&gt; Doc -&gt; TypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-665"></span><span>          </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;Entry point return type\n&quot;</span></span><span>
</span><span id="line-666"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc -&gt; Doc
</span><span class="hs-identifier hs-var">indent</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StructRetType -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">StructRetType
</span><a href="#local-6989586621684565261"><span class="hs-identifier hs-var">rettype</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>            </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;\nwill have an opaque type, so the result will likely not be usable.&quot;</span></span><span>
</span><span id="line-668"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Info EntryPoint)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TypeM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>
</span><span id="line-670"></span><span>  </span><span id="local-6989586621684565237"><span class="annot"><span class="annottext">[AttrInfo VName]
</span><a href="#local-6989586621684565237"><span class="hs-identifier hs-var">attrs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(AttrInfo Name -&gt; TypeM (AttrInfo VName))
-&gt; [AttrInfo Name] -&gt; TypeM [AttrInfo VName]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">AttrInfo Name -&gt; TypeM (AttrInfo VName)
forall (m :: * -&gt; *).
MonadTypeChecker m =&gt;
AttrInfo Name -&gt; m (AttrInfo VName)
</span><a href="Language.Futhark.TypeChecker.Monad.html#checkAttr"><span class="hs-identifier hs-var">checkAttr</span></a></span><span> </span><span class="annot"><span class="annottext">[AttrInfo Name]
</span><a href="#local-6989586621684565271"><span class="hs-identifier hs-var">attrs</span></a></span><span>
</span><span id="line-671"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621684565234"><span class="annot"><span class="annottext">vb :: ValBind
</span><a href="#local-6989586621684565234"><span class="hs-identifier hs-var hs-var">vb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Info EntryPoint)
-&gt; VName
-&gt; Maybe (TypeExp VName)
-&gt; Info StructRetType
-&gt; [TypeParamBase VName]
-&gt; [Pat]
-&gt; Exp
-&gt; Maybe DocComment
-&gt; [AttrInfo VName]
-&gt; SrcLoc
-&gt; ValBind
forall (f :: * -&gt; *) vn.
Maybe (f EntryPoint)
-&gt; vn
-&gt; Maybe (TypeExp vn)
-&gt; f StructRetType
-&gt; [TypeParamBase vn]
-&gt; [PatBase f vn]
-&gt; ExpBase f vn
-&gt; Maybe DocComment
-&gt; [AttrInfo vn]
-&gt; SrcLoc
-&gt; ValBindBase f vn
</span><a href="Language.Futhark.Syntax.html#ValBind"><span class="hs-identifier hs-var">ValBind</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Info EntryPoint)
</span><a href="#local-6989586621684565253"><span class="hs-identifier hs-var">entry'</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565265"><span class="hs-identifier hs-var">fname'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684565262"><span class="hs-identifier hs-var">maybe_tdecl'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StructRetType -&gt; Info StructRetType
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">StructRetType
</span><a href="#local-6989586621684565261"><span class="hs-identifier hs-var">rettype</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName]
</span><a href="#local-6989586621684565264"><span class="hs-identifier hs-var">tparams'</span></a></span><span> </span><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621684565263"><span class="hs-identifier hs-var">params'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621684565259"><span class="hs-identifier hs-var">body'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DocComment
</span><a href="#local-6989586621684565272"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">[AttrInfo VName]
</span><a href="#local-6989586621684565237"><span class="hs-identifier hs-var">attrs'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565270"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-672"></span><span>  </span><span class="annot"><span class="annottext">(Env, ValBind) -&gt; TypeM (Env, ValBind)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-673"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Env
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-674"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">envVtable :: Map VName BoundV
</span><a href="Language.Futhark.Semantic.html#envVtable"><span class="hs-identifier hs-var">envVtable</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-675"></span><span>            </span><span class="annot"><span class="annottext">VName -&gt; BoundV -&gt; Map VName BoundV
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565265"><span class="hs-identifier hs-var">fname'</span></a></span><span> </span><span class="annot"><span class="annottext">(BoundV -&gt; Map VName BoundV) -&gt; BoundV -&gt; Map VName BoundV
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([TypeParamBase VName] -&gt; StructType -&gt; BoundV)
-&gt; ([TypeParamBase VName], StructType) -&gt; BoundV
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">[TypeParamBase VName] -&gt; StructType -&gt; BoundV
</span><a href="Language.Futhark.Semantic.html#BoundV"><span class="hs-identifier hs-var">BoundV</span></a></span><span> </span><span class="annot"><span class="annottext">(([TypeParamBase VName], StructType) -&gt; BoundV)
-&gt; ([TypeParamBase VName], StructType) -&gt; BoundV
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ValBind -&gt; ([TypeParamBase VName], StructType)
</span><a href="Language.Futhark.Prop.html#valBindTypeScheme"><span class="hs-identifier hs-var">valBindTypeScheme</span></a></span><span> </span><span class="annot"><span class="annottext">ValBind
</span><a href="#local-6989586621684565234"><span class="hs-identifier hs-var">vb</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-676"></span><span>          </span><span class="annot"><span class="annottext">envNameMap :: NameMap
</span><a href="Language.Futhark.Semantic.html#envNameMap"><span class="hs-identifier hs-var">envNameMap</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-677"></span><span>            </span><span class="annot"><span class="annottext">(Namespace, Name) -&gt; QualName VName -&gt; NameMap
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Namespace
</span><a href="Language.Futhark.Semantic.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621684565277"><span class="hs-identifier hs-var">fname</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QualName VName -&gt; NameMap) -&gt; QualName VName -&gt; NameMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VName -&gt; QualName VName
forall v. v -&gt; QualName v
</span><a href="Language.Futhark.Prop.html#qualName"><span class="hs-identifier hs-var">qualName</span></a></span><span> </span><span class="annot"><span class="annottext">VName
</span><a href="#local-6989586621684565265"><span class="hs-identifier hs-var">fname'</span></a></span><span>
</span><span id="line-678"></span><span>        </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-679"></span><span>      </span><span class="annot"><span class="annottext">ValBind
</span><a href="#local-6989586621684565234"><span class="hs-identifier hs-var">vb</span></a></span><span>
</span><span id="line-680"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>
</span><span id="line-682"></span><span id="local-6989586621684566376"><span id="local-6989586621684566377"><span class="annot"><a href="Language.Futhark.TypeChecker.html#nastyType"><span class="hs-identifier hs-type">nastyType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621684566377"><span class="hs-identifier hs-type">als</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684566376"><span class="hs-identifier hs-type">dim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684566377"><span class="hs-identifier hs-type">als</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-683"></span><span id="nastyType"><span class="annot"><span class="annottext">nastyType :: forall als dim. Monoid als =&gt; TypeBase dim als -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#nastyType"><span class="hs-identifier hs-var hs-var">nastyType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-684"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#nastyType"><span class="hs-identifier hs-var">nastyType</span></a></span><span> </span><span id="local-6989586621684565228"><span class="annot"><span class="annottext">t :: TypeBase dim als
</span><a href="#local-6989586621684565228"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Language.Futhark.Syntax.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase dim als -&gt; Bool
forall als dim. Monoid als =&gt; TypeBase dim als -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#nastyType"><span class="hs-identifier hs-var">nastyType</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeBase dim als -&gt; Bool) -&gt; TypeBase dim als -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; TypeBase dim als -&gt; TypeBase dim als
forall dim as. Int -&gt; TypeBase dim as -&gt; TypeBase dim as
</span><a href="Language.Futhark.Prop.html#stripArray"><span class="hs-identifier hs-var">stripArray</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">TypeBase dim als
</span><a href="#local-6989586621684565228"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-685"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#nastyType"><span class="hs-identifier hs-var">nastyType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase dim als
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-686"></span><span>
</span><span id="line-687"></span><span id="local-6989586621684566387"><span id="local-6989586621684566388"><span class="annot"><a href="Language.Futhark.TypeChecker.html#nastyReturnType"><span class="hs-identifier hs-type">nastyReturnType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621684566388"><span class="hs-identifier hs-type">als</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeExp"><span class="hs-identifier hs-type">TypeExp</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeBase"><span class="hs-identifier hs-type">TypeBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684566387"><span class="hs-identifier hs-type">dim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621684566388"><span class="hs-identifier hs-type">als</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-688"></span><span id="nastyReturnType"><span class="annot"><span class="annottext">nastyReturnType :: forall als dim.
Monoid als =&gt;
Maybe (TypeExp VName) -&gt; TypeBase dim als -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#nastyReturnType"><span class="hs-identifier hs-var hs-var">nastyReturnType</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-type">Arrow</span></a></span><span> </span><span class="annot"><span class="annottext">als
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684565215"><span class="annot"><span class="annottext">TypeBase dim als
</span><a href="#local-6989586621684565215"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-type">RetType</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684565214"><span class="annot"><span class="annottext">TypeBase dim als
</span><a href="#local-6989586621684565214"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-689"></span><span>  </span><span class="annot"><span class="annottext">TypeBase dim als -&gt; Bool
forall als dim. Monoid als =&gt; TypeBase dim als -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#nastyType"><span class="hs-identifier hs-var">nastyType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase dim als
</span><a href="#local-6989586621684565215"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName) -&gt; TypeBase dim als -&gt; Bool
forall als dim.
Monoid als =&gt;
Maybe (TypeExp VName) -&gt; TypeBase dim als -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#nastyReturnType"><span class="hs-identifier hs-var">nastyReturnType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">TypeBase dim als
</span><a href="#local-6989586621684565214"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-690"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#nastyReturnType"><span class="hs-identifier hs-var">nastyReturnType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TEArrow"><span class="hs-identifier hs-type">TEArrow</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe VName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684565213"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565213"><span class="hs-identifier hs-var">te1</span></a></span></span><span> </span><span id="local-6989586621684565212"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565212"><span class="hs-identifier hs-var">te2</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#Arrow"><span class="hs-identifier hs-type">Arrow</span></a></span><span> </span><span class="annot"><span class="annottext">als
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684565211"><span class="annot"><span class="annottext">TypeBase dim als
</span><a href="#local-6989586621684565211"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#RetType"><span class="hs-identifier hs-type">RetType</span></a></span><span> </span><span class="annot"><span class="annottext">[VName]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684565210"><span class="annot"><span class="annottext">TypeBase dim als
</span><a href="#local-6989586621684565210"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-691"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeExp VName -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#niceTypeExp"><span class="hs-identifier hs-var">niceTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565213"><span class="hs-identifier hs-var">te1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">TypeBase dim als -&gt; Bool
forall als dim. Monoid als =&gt; TypeBase dim als -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#nastyType"><span class="hs-identifier hs-var">nastyType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase dim als
</span><a href="#local-6989586621684565211"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-692"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName) -&gt; TypeBase dim als -&gt; Bool
forall als dim.
Monoid als =&gt;
Maybe (TypeExp VName) -&gt; TypeBase dim als -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#nastyReturnType"><span class="hs-identifier hs-var">nastyReturnType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeExp VName -&gt; Maybe (TypeExp VName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565212"><span class="hs-identifier hs-var">te2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase dim als
</span><a href="#local-6989586621684565210"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-693"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#nastyReturnType"><span class="hs-identifier hs-var">nastyReturnType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684565208"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565208"><span class="hs-identifier hs-var">te</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase dim als
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-694"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TypeExp VName -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#niceTypeExp"><span class="hs-identifier hs-var">niceTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565208"><span class="hs-identifier hs-var">te</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-695"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#nastyReturnType"><span class="hs-identifier hs-var">nastyReturnType</span></a></span><span> </span><span id="local-6989586621684565207"><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684565207"><span class="hs-identifier hs-var">te</span></a></span></span><span> </span><span id="local-6989586621684565206"><span class="annot"><span class="annottext">TypeBase dim als
</span><a href="#local-6989586621684565206"><span class="hs-identifier hs-var">t</span></a></span></span><span>
</span><span id="line-696"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684565205"><span class="annot"><span class="annottext">[TypeBase dim als]
</span><a href="#local-6989586621684565205"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBase dim als -&gt; Maybe [TypeBase dim als]
forall dim as. TypeBase dim as -&gt; Maybe [TypeBase dim as]
</span><a href="Language.Futhark.Prop.html#isTupleRecord"><span class="hs-identifier hs-var">isTupleRecord</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase dim als
</span><a href="#local-6989586621684565206"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-697"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684565207"><span class="hs-identifier hs-var">te</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-698"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TETuple"><span class="hs-identifier hs-type">TETuple</span></a></span><span> </span><span id="local-6989586621684565202"><span class="annot"><span class="annottext">[TypeExp VName]
</span><a href="#local-6989586621684565202"><span class="hs-identifier hs-var">tes</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">or</span></span><span> </span><span class="annot"><span class="annottext">([Bool] -&gt; Bool) -&gt; [Bool] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (TypeExp VName) -&gt; TypeBase dim als -&gt; Bool)
-&gt; [Maybe (TypeExp VName)] -&gt; [TypeBase dim als] -&gt; [Bool]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName) -&gt; TypeBase dim als -&gt; Bool
forall als dim.
Monoid als =&gt;
Maybe (TypeExp VName) -&gt; TypeBase dim als -&gt; Bool
</span><a href="#local-6989586621684565199"><span class="hs-identifier hs-var">nastyType'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeExp VName -&gt; Maybe (TypeExp VName))
-&gt; [TypeExp VName] -&gt; [Maybe (TypeExp VName)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TypeExp VName -&gt; Maybe (TypeExp VName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">[TypeExp VName]
</span><a href="#local-6989586621684565202"><span class="hs-identifier hs-var">tes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TypeBase dim als]
</span><a href="#local-6989586621684565205"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-699"></span><span>      </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TypeBase dim als -&gt; Bool) -&gt; [TypeBase dim als] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">TypeBase dim als -&gt; Bool
forall als dim. Monoid als =&gt; TypeBase dim als -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#nastyType"><span class="hs-identifier hs-var">nastyType</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeBase dim als]
</span><a href="#local-6989586621684565205"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-700"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName) -&gt; TypeBase dim als -&gt; Bool
forall als dim.
Monoid als =&gt;
Maybe (TypeExp VName) -&gt; TypeBase dim als -&gt; Bool
</span><a href="#local-6989586621684565199"><span class="hs-identifier hs-var">nastyType'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><a href="#local-6989586621684565207"><span class="hs-identifier hs-var">te</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase dim als
</span><a href="#local-6989586621684565206"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-701"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-702"></span><span>    </span><span id="local-6989586621684565199"><span class="annot"><span class="annottext">nastyType' :: Maybe (TypeExp VName) -&gt; TypeBase dim als -&gt; Bool
</span><a href="#local-6989586621684565199"><span class="hs-identifier hs-var hs-var">nastyType'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621684565196"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565196"><span class="hs-identifier hs-var">te'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeBase dim als
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TypeExp VName -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#niceTypeExp"><span class="hs-identifier hs-var">niceTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565196"><span class="hs-identifier hs-var">te'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-703"></span><span>    </span><span class="annot"><a href="#local-6989586621684565199"><span class="hs-identifier hs-var">nastyType'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypeExp VName)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621684565195"><span class="annot"><span class="annottext">TypeBase dim als
</span><a href="#local-6989586621684565195"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeBase dim als -&gt; Bool
forall als dim. Monoid als =&gt; TypeBase dim als -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#nastyType"><span class="hs-identifier hs-var">nastyType</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBase dim als
</span><a href="#local-6989586621684565195"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-704"></span><span>
</span><span id="line-705"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#nastyParameter"><span class="hs-identifier hs-type">nastyParameter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-706"></span><span id="nastyParameter"><span class="annot"><span class="annottext">nastyParameter :: Pat -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#nastyParameter"><span class="hs-identifier hs-var hs-var">nastyParameter</span></a></span></span><span> </span><span id="local-6989586621684565194"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684565194"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatType -&gt; Bool
forall als dim. Monoid als =&gt; TypeBase dim als -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#nastyType"><span class="hs-identifier hs-var">nastyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat -&gt; PatType
</span><a href="Language.Futhark.Prop.html#patternType"><span class="hs-identifier hs-var">patternType</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684565194"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat -&gt; Bool
forall {f :: * -&gt; *}. PatBase f VName -&gt; Bool
</span><a href="#local-6989586621684565192"><span class="hs-identifier hs-var">ascripted</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621684565194"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-707"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-708"></span><span>    </span><span id="local-6989586621684565192"><span class="annot"><span class="annottext">ascripted :: PatBase f VName -&gt; Bool
</span><a href="#local-6989586621684565192"><span class="hs-identifier hs-var hs-var">ascripted</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatAscription"><span class="hs-identifier hs-type">PatAscription</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase f VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeDecl"><span class="hs-identifier hs-type">TypeDecl</span></a></span><span> </span><span id="local-6989586621684565191"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565191"><span class="hs-identifier hs-var">te</span></a></span></span><span> </span><span class="annot"><span class="annottext">f StructType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeExp VName -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#niceTypeExp"><span class="hs-identifier hs-var">niceTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565191"><span class="hs-identifier hs-var">te</span></a></span><span>
</span><span id="line-709"></span><span>    </span><span class="annot"><a href="#local-6989586621684565192"><span class="hs-identifier hs-var">ascripted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#PatParens"><span class="hs-identifier hs-type">PatParens</span></a></span><span> </span><span id="local-6989586621684565190"><span class="annot"><span class="annottext">PatBase f VName
</span><a href="#local-6989586621684565190"><span class="hs-identifier hs-var">p'</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatBase f VName -&gt; Bool
</span><a href="#local-6989586621684565192"><span class="hs-identifier hs-var">ascripted</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase f VName
</span><a href="#local-6989586621684565190"><span class="hs-identifier hs-var">p'</span></a></span><span>
</span><span id="line-710"></span><span>    </span><span class="annot"><a href="#local-6989586621684565192"><span class="hs-identifier hs-var">ascripted</span></a></span><span> </span><span class="annot"><span class="annottext">PatBase f VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-711"></span><span>
</span><span id="line-712"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#niceTypeExp"><span class="hs-identifier hs-type">niceTypeExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeExp"><span class="hs-identifier hs-type">TypeExp</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-713"></span><span id="niceTypeExp"><span class="annot"><span class="annottext">niceTypeExp :: TypeExp VName -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#niceTypeExp"><span class="hs-identifier hs-var hs-var">niceTypeExp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TEVar"><span class="hs-identifier hs-type">TEVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#QualName"><span class="hs-identifier hs-type">QualName</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">VName
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-714"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#niceTypeExp"><span class="hs-identifier hs-var">niceTypeExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TEApply"><span class="hs-identifier hs-type">TEApply</span></a></span><span> </span><span id="local-6989586621684565186"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565186"><span class="hs-identifier hs-var">te</span></a></span></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeArgExpDim"><span class="hs-identifier hs-type">TypeArgExpDim</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeExp VName -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#niceTypeExp"><span class="hs-identifier hs-var">niceTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565186"><span class="hs-identifier hs-var">te</span></a></span><span>
</span><span id="line-715"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#niceTypeExp"><span class="hs-identifier hs-var">niceTypeExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TEArray"><span class="hs-identifier hs-type">TEArray</span></a></span><span> </span><span id="local-6989586621684565183"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565183"><span class="hs-identifier hs-var">te</span></a></span></span><span> </span><span class="annot"><span class="annottext">DimExp VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeExp VName -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#niceTypeExp"><span class="hs-identifier hs-var">niceTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565183"><span class="hs-identifier hs-var">te</span></a></span><span>
</span><span id="line-716"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#niceTypeExp"><span class="hs-identifier hs-var">niceTypeExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TEUnique"><span class="hs-identifier hs-type">TEUnique</span></a></span><span> </span><span id="local-6989586621684565181"><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565181"><span class="hs-identifier hs-var">te</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeExp VName -&gt; Bool
</span><a href="Language.Futhark.TypeChecker.html#niceTypeExp"><span class="hs-identifier hs-var">niceTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><a href="#local-6989586621684565181"><span class="hs-identifier hs-var">te</span></a></span><span>
</span><span id="line-717"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#niceTypeExp"><span class="hs-identifier hs-var">niceTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">TypeExp VName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-718"></span><span>
</span><span id="line-719"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkOneDec"><span class="hs-identifier hs-type">checkOneDec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#DecBase"><span class="hs-identifier hs-type">DecBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Semantic.html#TySet"><span class="hs-identifier hs-type">TySet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#DecBase"><span class="hs-identifier hs-type">DecBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span id="checkOneDec"><span class="annot"><span class="annottext">checkOneDec :: UncheckedDec -&gt; TypeM (TySet, Env, Dec)
</span><a href="Language.Futhark.TypeChecker.html#checkOneDec"><span class="hs-identifier hs-var hs-var">checkOneDec</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ModDec"><span class="hs-identifier hs-type">ModDec</span></a></span><span> </span><span id="local-6989586621684565180"><span class="annot"><span class="annottext">ModBindBase NoInfo Name
</span><a href="#local-6989586621684565180"><span class="hs-identifier hs-var">struct</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-721"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565179"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565179"><span class="hs-identifier hs-var">abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565178"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565178"><span class="hs-identifier hs-var">modenv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565177"><span class="annot"><span class="annottext">ModBindBase Info VName
</span><a href="#local-6989586621684565177"><span class="hs-identifier hs-var">struct'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModBindBase NoInfo Name
-&gt; TypeM (TySet, Env, ModBindBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkModBind"><span class="hs-identifier hs-var">checkModBind</span></a></span><span> </span><span class="annot"><span class="annottext">ModBindBase NoInfo Name
</span><a href="#local-6989586621684565180"><span class="hs-identifier hs-var">struct</span></a></span><span>
</span><span id="line-722"></span><span>  </span><span class="annot"><span class="annottext">(TySet, Env, Dec) -&gt; TypeM (TySet, Env, Dec)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565179"><span class="hs-identifier hs-var">abs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565178"><span class="hs-identifier hs-var">modenv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModBindBase Info VName -&gt; Dec
forall (f :: * -&gt; *) vn. ModBindBase f vn -&gt; DecBase f vn
</span><a href="Language.Futhark.Syntax.html#ModDec"><span class="hs-identifier hs-var">ModDec</span></a></span><span> </span><span class="annot"><span class="annottext">ModBindBase Info VName
</span><a href="#local-6989586621684565177"><span class="hs-identifier hs-var">struct'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-723"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkOneDec"><span class="hs-identifier hs-var">checkOneDec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#SigDec"><span class="hs-identifier hs-type">SigDec</span></a></span><span> </span><span id="local-6989586621684565176"><span class="annot"><span class="annottext">SigBindBase NoInfo Name
</span><a href="#local-6989586621684565176"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-724"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565175"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565175"><span class="hs-identifier hs-var">abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565174"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565174"><span class="hs-identifier hs-var">sigenv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565173"><span class="annot"><span class="annottext">SigBindBase Info VName
</span><a href="#local-6989586621684565173"><span class="hs-identifier hs-var">sig'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SigBindBase NoInfo Name
-&gt; TypeM (TySet, Env, SigBindBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkSigBind"><span class="hs-identifier hs-var">checkSigBind</span></a></span><span> </span><span class="annot"><span class="annottext">SigBindBase NoInfo Name
</span><a href="#local-6989586621684565176"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-725"></span><span>  </span><span class="annot"><span class="annottext">(TySet, Env, Dec) -&gt; TypeM (TySet, Env, Dec)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565175"><span class="hs-identifier hs-var">abs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565174"><span class="hs-identifier hs-var">sigenv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SigBindBase Info VName -&gt; Dec
forall (f :: * -&gt; *) vn. SigBindBase f vn -&gt; DecBase f vn
</span><a href="Language.Futhark.Syntax.html#SigDec"><span class="hs-identifier hs-var">SigDec</span></a></span><span> </span><span class="annot"><span class="annottext">SigBindBase Info VName
</span><a href="#local-6989586621684565173"><span class="hs-identifier hs-var">sig'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-726"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkOneDec"><span class="hs-identifier hs-var">checkOneDec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#TypeDec"><span class="hs-identifier hs-type">TypeDec</span></a></span><span> </span><span id="local-6989586621684565172"><span class="annot"><span class="annottext">TypeBindBase NoInfo Name
</span><a href="#local-6989586621684565172"><span class="hs-identifier hs-var">tdec</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-727"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565171"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565171"><span class="hs-identifier hs-var">tenv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565170"><span class="annot"><span class="annottext">TypeBindBase Info VName
</span><a href="#local-6989586621684565170"><span class="hs-identifier hs-var">tdec'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeBindBase NoInfo Name -&gt; TypeM (Env, TypeBindBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkTypeBind"><span class="hs-identifier hs-var">checkTypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBindBase NoInfo Name
</span><a href="#local-6989586621684565172"><span class="hs-identifier hs-var">tdec</span></a></span><span>
</span><span id="line-728"></span><span>  </span><span class="annot"><span class="annottext">(TySet, Env, Dec) -&gt; TypeM (TySet, Env, Dec)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySet
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565171"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeBindBase Info VName -&gt; Dec
forall (f :: * -&gt; *) vn. TypeBindBase f vn -&gt; DecBase f vn
</span><a href="Language.Futhark.Syntax.html#TypeDec"><span class="hs-identifier hs-var">TypeDec</span></a></span><span> </span><span class="annot"><span class="annottext">TypeBindBase Info VName
</span><a href="#local-6989586621684565170"><span class="hs-identifier hs-var">tdec'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-729"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkOneDec"><span class="hs-identifier hs-var">checkOneDec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#OpenDec"><span class="hs-identifier hs-type">OpenDec</span></a></span><span> </span><span id="local-6989586621684565169"><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565169"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621684565168"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565168"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-730"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565167"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565167"><span class="hs-identifier hs-var">x_abs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565166"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565166"><span class="hs-identifier hs-var">x_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565165"><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565165"><span class="hs-identifier hs-var">x'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name -&gt; TypeM (TySet, Env, ModExpBase Info VName)
</span><a href="Language.Futhark.TypeChecker.html#checkOneModExpToEnv"><span class="hs-identifier hs-var">checkOneModExpToEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ModExpBase NoInfo Name
</span><a href="#local-6989586621684565169"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-731"></span><span>  </span><span class="annot"><span class="annottext">(TySet, Env, Dec) -&gt; TypeM (TySet, Env, Dec)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565167"><span class="hs-identifier hs-var">x_abs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565166"><span class="hs-identifier hs-var">x_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModExpBase Info VName -&gt; SrcLoc -&gt; Dec
forall (f :: * -&gt; *) vn. ModExpBase f vn -&gt; SrcLoc -&gt; DecBase f vn
</span><a href="Language.Futhark.Syntax.html#OpenDec"><span class="hs-identifier hs-var">OpenDec</span></a></span><span> </span><span class="annot"><span class="annottext">ModExpBase Info VName
</span><a href="#local-6989586621684565165"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565168"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-732"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkOneDec"><span class="hs-identifier hs-var">checkOneDec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#LocalDec"><span class="hs-identifier hs-type">LocalDec</span></a></span><span> </span><span id="local-6989586621684565164"><span class="annot"><span class="annottext">UncheckedDec
</span><a href="#local-6989586621684565164"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621684565163"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565163"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-733"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565162"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565162"><span class="hs-identifier hs-var">abstypes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565161"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565161"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565160"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621684565160"><span class="hs-identifier hs-var">d'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UncheckedDec -&gt; TypeM (TySet, Env, Dec)
</span><a href="Language.Futhark.TypeChecker.html#checkOneDec"><span class="hs-identifier hs-var">checkOneDec</span></a></span><span> </span><span class="annot"><span class="annottext">UncheckedDec
</span><a href="#local-6989586621684565164"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-734"></span><span>  </span><span class="annot"><span class="annottext">(TySet, Env, Dec) -&gt; TypeM (TySet, Env, Dec)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565162"><span class="hs-identifier hs-var">abstypes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565161"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec -&gt; SrcLoc -&gt; Dec
forall (f :: * -&gt; *) vn. DecBase f vn -&gt; SrcLoc -&gt; DecBase f vn
</span><a href="Language.Futhark.Syntax.html#LocalDec"><span class="hs-identifier hs-var">LocalDec</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621684565160"><span class="hs-identifier hs-var">d'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565163"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-735"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkOneDec"><span class="hs-identifier hs-var">checkOneDec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ImportDec"><span class="hs-identifier hs-type">ImportDec</span></a></span><span> </span><span id="local-6989586621684565159"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684565159"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoInfo [Char]
</span><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a></span><span> </span><span id="local-6989586621684565158"><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565158"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-736"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565157"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684565157"><span class="hs-identifier hs-var">name'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565156"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565156"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; [Char] -&gt; TypeM ([Char], Env)
</span><a href="Language.Futhark.TypeChecker.Monad.html#lookupImport"><span class="hs-identifier hs-var">lookupImport</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565158"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684565159"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-737"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TypeM () -&gt; TypeM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;/prelude&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><span class="hs-operator hs-var">`isPrefixOf`</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684565159"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TypeM () -&gt; TypeM ()) -&gt; TypeM () -&gt; TypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-738"></span><span>    </span><span class="annot"><span class="annottext">SrcLoc -&gt; Notes -&gt; Doc -&gt; TypeM ()
forall (m :: * -&gt; *) loc a.
(MonadTypeChecker m, Located loc) =&gt;
loc -&gt; Notes -&gt; Doc -&gt; m a
</span><a href="Language.Futhark.TypeChecker.Monad.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565158"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Notes
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; TypeM ()) -&gt; Doc -&gt; TypeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Doc
forall a. Pretty a =&gt; a -&gt; Doc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684565159"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Doc -&gt; Doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><span class="hs-string">&quot;may not be explicitly imported.&quot;</span></span><span>
</span><span id="line-739"></span><span>  </span><span class="annot"><span class="annottext">(TySet, Env, Dec) -&gt; TypeM (TySet, Env, Dec)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySet
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565156"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Info [Char] -&gt; SrcLoc -&gt; Dec
forall (f :: * -&gt; *) vn.
[Char] -&gt; f [Char] -&gt; SrcLoc -&gt; DecBase f vn
</span><a href="Language.Futhark.Syntax.html#ImportDec"><span class="hs-identifier hs-var">ImportDec</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684565159"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Info [Char]
forall a. a -&gt; Info a
</span><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-var">Info</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621684565157"><span class="hs-identifier hs-var">name'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="#local-6989586621684565158"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-740"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkOneDec"><span class="hs-identifier hs-var">checkOneDec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Syntax.html#ValDec"><span class="hs-identifier hs-type">ValDec</span></a></span><span> </span><span id="local-6989586621684565155"><span class="annot"><span class="annottext">ValBindBase NoInfo Name
</span><a href="#local-6989586621684565155"><span class="hs-identifier hs-var">vb</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-741"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565154"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565154"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565153"><span class="annot"><span class="annottext">ValBind
</span><a href="#local-6989586621684565153"><span class="hs-identifier hs-var">vb'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ValBindBase NoInfo Name -&gt; TypeM (Env, ValBind)
</span><a href="Language.Futhark.TypeChecker.html#checkValBind"><span class="hs-identifier hs-var">checkValBind</span></a></span><span> </span><span class="annot"><span class="annottext">ValBindBase NoInfo Name
</span><a href="#local-6989586621684565155"><span class="hs-identifier hs-var">vb</span></a></span><span>
</span><span id="line-742"></span><span>  </span><span class="annot"><span class="annottext">(TySet, Env, Dec) -&gt; TypeM (TySet, Env, Dec)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySet
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565154"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ValBind -&gt; Dec
forall (f :: * -&gt; *) vn. ValBindBase f vn -&gt; DecBase f vn
</span><a href="Language.Futhark.Syntax.html#ValDec"><span class="hs-identifier hs-var">ValDec</span></a></span><span> </span><span class="annot"><span class="annottext">ValBind
</span><a href="#local-6989586621684565153"><span class="hs-identifier hs-var">vb'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>
</span><span id="line-744"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkDecs"><span class="hs-identifier hs-type">checkDecs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Syntax.html#DecBase"><span class="hs-identifier hs-type">DecBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#NoInfo"><span class="hs-identifier hs-type">NoInfo</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Futhark.TypeChecker.Monad.html#TypeM"><span class="hs-identifier hs-type">TypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Futhark.Semantic.html#TySet"><span class="hs-identifier hs-type">TySet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Futhark.Semantic.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Futhark.Syntax.html#DecBase"><span class="hs-identifier hs-type">DecBase</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Syntax.html#Info"><span class="hs-identifier hs-type">Info</span></a></span><span> </span><span class="annot"><a href="Language.Futhark.Core.html#VName"><span class="hs-identifier hs-type">VName</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-745"></span><span id="checkDecs"><span class="annot"><span class="annottext">checkDecs :: [UncheckedDec] -&gt; TypeM (TySet, Env, [Dec])
</span><a href="Language.Futhark.TypeChecker.html#checkDecs"><span class="hs-identifier hs-var hs-var">checkDecs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621684565152"><span class="annot"><span class="annottext">UncheckedDec
</span><a href="#local-6989586621684565152"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621684565151"><span class="annot"><span class="annottext">[UncheckedDec]
</span><a href="#local-6989586621684565151"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-746"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565150"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565150"><span class="hs-identifier hs-var">d_abstypes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565149"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565149"><span class="hs-identifier hs-var">d_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565148"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621684565148"><span class="hs-identifier hs-var">d'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UncheckedDec -&gt; TypeM (TySet, Env, Dec)
</span><a href="Language.Futhark.TypeChecker.html#checkOneDec"><span class="hs-identifier hs-var">checkOneDec</span></a></span><span> </span><span class="annot"><span class="annottext">UncheckedDec
</span><a href="#local-6989586621684565152"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-747"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621684565147"><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565147"><span class="hs-identifier hs-var">ds_abstypes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565146"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565146"><span class="hs-identifier hs-var">ds_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621684565145"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621684565145"><span class="hs-identifier hs-var">ds'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Env -&gt; TypeM (TySet, Env, [Dec]) -&gt; TypeM (TySet, Env, [Dec])
forall a. Env -&gt; TypeM a -&gt; TypeM a
</span><a href="Language.Futhark.TypeChecker.Monad.html#localEnv"><span class="hs-identifier hs-var">localEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565149"><span class="hs-identifier hs-var">d_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeM (TySet, Env, [Dec]) -&gt; TypeM (TySet, Env, [Dec]))
-&gt; TypeM (TySet, Env, [Dec]) -&gt; TypeM (TySet, Env, [Dec])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[UncheckedDec] -&gt; TypeM (TySet, Env, [Dec])
</span><a href="Language.Futhark.TypeChecker.html#checkDecs"><span class="hs-identifier hs-var">checkDecs</span></a></span><span> </span><span class="annot"><span class="annottext">[UncheckedDec]
</span><a href="#local-6989586621684565151"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-748"></span><span>  </span><span class="annot"><span class="annottext">(TySet, Env, [Dec]) -&gt; TypeM (TySet, Env, [Dec])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-749"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565150"><span class="hs-identifier hs-var">d_abstypes</span></a></span><span> </span><span class="annot"><span class="annottext">TySet -&gt; TySet -&gt; TySet
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TySet
</span><a href="#local-6989586621684565147"><span class="hs-identifier hs-var">ds_abstypes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-750"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621684565148"><span class="hs-identifier hs-var">d'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-751"></span><span>        </span><span class="annot"><a href="Language.Futhark.Syntax.html#LocalDec"><span class="hs-identifier hs-type">LocalDec</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565146"><span class="hs-identifier hs-var">ds_env</span></a></span><span>
</span><span id="line-752"></span><span>        </span><span class="annot"><a href="Language.Futhark.Syntax.html#ImportDec"><span class="hs-identifier hs-type">ImportDec</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565146"><span class="hs-identifier hs-var">ds_env</span></a></span><span>
</span><span id="line-753"></span><span>        </span><span class="annot"><span class="annottext">Dec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565146"><span class="hs-identifier hs-var">ds_env</span></a></span><span> </span><span class="annot"><span class="annottext">Env -&gt; Env -&gt; Env
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621684565149"><span class="hs-identifier hs-var">d_env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-754"></span><span>      </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621684565148"><span class="hs-identifier hs-var">d'</span></a></span><span> </span><span class="annot"><span class="annottext">Dec -&gt; [Dec] -&gt; [Dec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621684565145"><span class="hs-identifier hs-var">ds'</span></a></span><span>
</span><span id="line-755"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-756"></span><span class="annot"><a href="Language.Futhark.TypeChecker.html#checkDecs"><span class="hs-identifier hs-var">checkDecs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-757"></span><span>  </span><span class="annot"><span class="annottext">(TySet, Env, [Dec]) -&gt; TypeM (TySet, Env, [Dec])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySet
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Env
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-758"></span></pre></body></html>